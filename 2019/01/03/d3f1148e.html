<!DOCTYPE html>
<html lang="en">
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="description" content="API Gatewayæ˜¯ä¸€ä¸ªæœåŠ¡å™¨ï¼Œä¹Ÿå¯ä»¥è¯´æ˜¯è¿›å…¥ç³»ç»Ÿçš„å”¯ä¸€èŠ‚ç‚¹ã€‚è¿™è·Ÿé¢å‘å¯¹è±¡è®¾è®¡æ¨¡å¼ä¸­çš„Facadeæ¨¡å¼å¾ˆåƒã€‚API Gatewayå°è£…å†…éƒ¨ç³»ç»Ÿçš„æ¶æ„ï¼Œå¹¶ä¸”æä¾›APIç»™å„ä¸ªå®¢æˆ·ç«¯ã€‚å®ƒè¿˜å¯èƒ½æœ‰å…¶ä»–åŠŸèƒ½ï¼Œå¦‚æˆæƒã€ç›‘æ§ã€è´Ÿè½½å‡è¡¡ã€ç¼“å­˜ã€è¯·æ±‚åˆ†ç‰‡å’Œç®¡ç†ã€é™æ€å“åº”å¤„ç†ç­‰ã€‚">
<meta property="og:type" content="article">
<meta property="og:title" content="SpringCloudï¼ˆæœåŠ¡ç½‘å…³zuulï¼‰">
<meta property="og:url" content="https://www.cayzlh.com/blog">
<meta property="og:site_name" content="CAYZLH">
<meta property="og:description" content="API Gatewayæ˜¯ä¸€ä¸ªæœåŠ¡å™¨ï¼Œä¹Ÿå¯ä»¥è¯´æ˜¯è¿›å…¥ç³»ç»Ÿçš„å”¯ä¸€èŠ‚ç‚¹ã€‚è¿™è·Ÿé¢å‘å¯¹è±¡è®¾è®¡æ¨¡å¼ä¸­çš„Facadeæ¨¡å¼å¾ˆåƒã€‚API Gatewayå°è£…å†…éƒ¨ç³»ç»Ÿçš„æ¶æ„ï¼Œå¹¶ä¸”æä¾›APIç»™å„ä¸ªå®¢æˆ·ç«¯ã€‚å®ƒè¿˜å¯èƒ½æœ‰å…¶ä»–åŠŸèƒ½ï¼Œå¦‚æˆæƒã€ç›‘æ§ã€è´Ÿè½½å‡è¡¡ã€ç¼“å­˜ã€è¯·æ±‚åˆ†ç‰‡å’Œç®¡ç†ã€é™æ€å“åº”å¤„ç†ç­‰ã€‚">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://gitee.com/cayzlh/img-repo/raw/master/2020/04/17/lzchLT.png">
<meta property="og:image" content="https://gitee.com/cayzlh/img-repo/raw/master/2020/04/17/zmVnNy.png">
<meta property="og:image" content="https://gitee.com/cayzlh/img-repo/raw/master/2020/04/17/06aKRo.png">
<meta property="og:image" content="https://gitee.com/cayzlh/img-repo/raw/master/2020/04/17/8upBZN.png">
<meta property="og:image" content="https://gitee.com/cayzlh/img-repo/raw/master/2020/04/17/McjnNy.png">
<meta property="og:image" content="https://gitee.com/cayzlh/img-repo/raw/master/2020/04/17/K9vzNb.png">
<meta property="article:published_time" content="2019-01-03T02:00:46.000Z">
<meta property="article:modified_time" content="2020-06-22T01:29:05.874Z">
<meta property="article:author" content="ğŸ³Antä¸¶">
<meta property="article:tag" content="Spring">
<meta property="article:tag" content="SpringCloud">
<meta property="article:tag" content="å¾®æœåŠ¡">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://gitee.com/cayzlh/img-repo/raw/master/2020/04/17/lzchLT.png">
    
    
      
        
          <link rel="shortcut icon" href="/blog/images/favicon.ico">
        
      
      
        
          <link rel="icon" type="image/png" href="/blog/images/favicon-192x192.png" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/blog/images/apple-touch-icon.png">
        
      
    
    <!-- title -->
    <title>SpringCloudï¼ˆæœåŠ¡ç½‘å…³zuulï¼‰</title>
    <!-- styles -->
    
<link rel="stylesheet" href="/blog/css/style.css">

    <!-- persian styles -->
    
      
<link rel="stylesheet" href="/blog/css/rtl.css">

    
    <!-- rss -->
    
    
      <link rel="alternate" href="/blog/true" title="CAYZLH" type="application/atom+xml">
    
<meta name="generator" content="Hexo 5.3.0"></head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
        
          <li><a href="/blog/">Home</a></li>
        
          <li><a href="/blog/archives/">Articles</a></li>
        
          <li><a href="/blog/about/">About</a></li>
        
          <li><a href="/blog/search/">Search</a></li>
        
      </ul>
    </span>
    <br>
    <span id="actions">
      <ul>
        
        <li><a class="icon" href="/blog/2019/01/04/a773bf3d.html"><i class="fas fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" href="/blog/2019/01/01/94bbf97f.html"><i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
<!--        <li><a class="icon" href="#"><i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>-->
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous</span>
      <span id="i-next" class="info" style="display:none;">Next</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="external nofollow noopener noreferrer" href="http://www.facebook.com/sharer.php?u=https://www.cayzlh.com/2019/01/03/d3f1148e.html"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="external nofollow noopener noreferrer" href="https://twitter.com/share?url=https://www.cayzlh.com/2019/01/03/d3f1148e.html&text=SpringCloudï¼ˆæœåŠ¡ç½‘å…³zuulï¼‰"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="external nofollow noopener noreferrer" href="http://www.linkedin.com/shareArticle?url=https://www.cayzlh.com/2019/01/03/d3f1148e.html&title=SpringCloudï¼ˆæœåŠ¡ç½‘å…³zuulï¼‰"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="external nofollow noopener noreferrer" href="https://pinterest.com/pin/create/bookmarklet/?url=https://www.cayzlh.com/2019/01/03/d3f1148e.html&is_video=false&description=SpringCloudï¼ˆæœåŠ¡ç½‘å…³zuulï¼‰"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=SpringCloudï¼ˆæœåŠ¡ç½‘å…³zuulï¼‰&body=Check out this article: https://www.cayzlh.com/2019/01/03/d3f1148e.html"><i class="fas fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="external nofollow noopener noreferrer" href="https://getpocket.com/save?url=https://www.cayzlh.com/2019/01/03/d3f1148e.html&title=SpringCloudï¼ˆæœåŠ¡ç½‘å…³zuulï¼‰"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="external nofollow noopener noreferrer" href="http://reddit.com/submit?url=https://www.cayzlh.com/2019/01/03/d3f1148e.html&title=SpringCloudï¼ˆæœåŠ¡ç½‘å…³zuulï¼‰"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="external nofollow noopener noreferrer" href="http://www.stumbleupon.com/submit?url=https://www.cayzlh.com/2019/01/03/d3f1148e.html&title=SpringCloudï¼ˆæœåŠ¡ç½‘å…³zuulï¼‰"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="external nofollow noopener noreferrer" href="http://digg.com/submit?url=https://www.cayzlh.com/2019/01/03/d3f1148e.html&title=SpringCloudï¼ˆæœåŠ¡ç½‘å…³zuulï¼‰"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="external nofollow noopener noreferrer" href="http://www.tumblr.com/share/link?url=https://www.cayzlh.com/2019/01/03/d3f1148e.html&name=SpringCloudï¼ˆæœåŠ¡ç½‘å…³zuulï¼‰&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="external nofollow noopener noreferrer" href="https://news.ycombinator.com/submitlink?u=https://www.cayzlh.com/2019/01/03/d3f1148e.html&t=SpringCloudï¼ˆæœåŠ¡ç½‘å…³zuulï¼‰"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#API-Gateway"><span class="toc-number">1.</span> <span class="toc-text">API Gateway</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#API-Gateway%E7%9A%84%E4%BC%98%E7%82%B9%E5%92%8C%E7%BC%BA%E7%82%B9"><span class="toc-number">1.1.</span> <span class="toc-text">API Gatewayçš„ä¼˜ç‚¹å’Œç¼ºç‚¹</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Zuul"><span class="toc-number">2.</span> <span class="toc-text">Zuul</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Zuul%E8%BF%87%E6%BB%A4%E5%99%A8"><span class="toc-number">3.</span> <span class="toc-text">Zuulè¿‡æ»¤å™¨</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Spring-Cloud-Zuul"><span class="toc-number">4.</span> <span class="toc-text">Spring Cloud Zuul</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C"><span class="toc-number">4.1.</span> <span class="toc-text">å‡†å¤‡å·¥ä½œ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#POM%E9%85%8D%E7%BD%AE"><span class="toc-number">4.2.</span> <span class="toc-text">POMé…ç½®</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">4.3.</span> <span class="toc-text">é…ç½®æ–‡ä»¶</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%AF%E5%8A%A8%E7%B1%BB"><span class="toc-number">4.4.</span> <span class="toc-text">å¯åŠ¨ç±»</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95"><span class="toc-number">4.5.</span> <span class="toc-text">æµ‹è¯•</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%87%E6%BB%A4%E5%99%A8"><span class="toc-number">5.</span> <span class="toc-text">è¿‡æ»¤å™¨</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Zuul%E7%9A%84%E6%A0%B8%E5%BF%83"><span class="toc-number">5.1.</span> <span class="toc-text">Zuulçš„æ ¸å¿ƒ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Zuul%E4%B8%AD%E9%BB%98%E8%AE%A4%E5%AE%9E%E7%8E%B0%E7%9A%84Filter"><span class="toc-number">5.2.</span> <span class="toc-text">Zuulä¸­é»˜è®¤å®ç°çš„Filter</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A6%81%E7%94%A8%E6%8C%87%E5%AE%9A%E7%9A%84Filter"><span class="toc-number">5.3.</span> <span class="toc-text">ç¦ç”¨æŒ‡å®šçš„Filter</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89Filter"><span class="toc-number">5.4.</span> <span class="toc-text">è‡ªå®šä¹‰Filter</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B7%AF%E7%94%B1%E7%86%94%E6%96%AD"><span class="toc-number">6.</span> <span class="toc-text">è·¯ç”±ç†”æ–­</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B7%AF%E7%94%B1%E9%87%8D%E8%AF%95"><span class="toc-number">7.</span> <span class="toc-text">è·¯ç”±é‡è¯•</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Zuul%E9%AB%98%E5%8F%AF%E7%94%A8"><span class="toc-number">8.</span> <span class="toc-text">Zuulé«˜å¯ç”¨</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E8%80%83"><span class="toc-number">9.</span> <span class="toc-text">å‚è€ƒ</span></a></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index py4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        SpringCloudï¼ˆæœåŠ¡ç½‘å…³zuulï¼‰
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">ğŸ³Antä¸¶</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2019-01-03T02:00:46.000Z" itemprop="datePublished">2019-01-03</time>
        
      
    </div>


      
    <div class="article-category">
        <i class="fas fa-archive"></i>
        <a class="category-link" href="/blog/categories/Spring/">Spring</a> â€º <a class="category-link" href="/blog/categories/Spring/SpringCloud/">SpringCloud</a>
    </div>


      
    <div class="article-tag">
        <i class="fas fa-tag"></i>
        <a class="tag-link-link" href="/blog/tags/Spring/" rel="tag">Spring</a>, <a class="tag-link-link" href="/blog/tags/SpringCloud/" rel="tag">SpringCloud</a>, <a class="tag-link-link" href="/blog/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/" rel="tag">å¾®æœåŠ¡</a>
    </div>


    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <h2 id="API-Gateway"><a href="#API-Gateway" class="headerlink" title="API Gateway"></a>API Gateway</h2><p>API Gatewayæ˜¯å¾®æœåŠ¡æ¶æ„ä¸­ä¸å¯æˆ–ç¼ºçš„éƒ¨åˆ†ï¼š<a target="_blank" rel="external nofollow noopener noreferrer" href="http://dockone.io/article/482">http://dockone.io/article/482</a>ã€‚</p>
<p>API Gatewayæ˜¯ä¸€ä¸ªæœåŠ¡å™¨ï¼Œä¹Ÿå¯ä»¥è¯´æ˜¯è¿›å…¥ç³»ç»Ÿçš„å”¯ä¸€èŠ‚ç‚¹ã€‚è¿™è·Ÿé¢å‘å¯¹è±¡è®¾è®¡æ¨¡å¼ä¸­çš„Facadeæ¨¡å¼å¾ˆåƒã€‚API Gatewayå°è£…å†…éƒ¨ç³»ç»Ÿçš„æ¶æ„ï¼Œå¹¶ä¸”æä¾›APIç»™å„ä¸ªå®¢æˆ·ç«¯ã€‚å®ƒè¿˜å¯èƒ½æœ‰å…¶ä»–åŠŸèƒ½ï¼Œå¦‚æˆæƒã€ç›‘æ§ã€è´Ÿè½½å‡è¡¡ã€ç¼“å­˜ã€è¯·æ±‚åˆ†ç‰‡å’Œç®¡ç†ã€é™æ€å“åº”å¤„ç†ç­‰ã€‚</p>
<p>API Gatewayè´Ÿè´£è¯·æ±‚è½¬å‘ã€åˆæˆå’Œåè®®è½¬æ¢ã€‚æ‰€æœ‰æ¥è‡ªå®¢æˆ·ç«¯çš„è¯·æ±‚éƒ½è¦å…ˆç»è¿‡API Gatewayï¼Œç„¶åè·¯ç”±è¿™äº›è¯·æ±‚åˆ°å¯¹åº”çš„å¾®æœåŠ¡ã€‚API Gatewayå°†ç»å¸¸é€šè¿‡è°ƒç”¨å¤šä¸ªå¾®æœåŠ¡æ¥å¤„ç†ä¸€ä¸ªè¯·æ±‚ä»¥åŠèšåˆå¤šä¸ªæœåŠ¡çš„ç»“æœã€‚å®ƒå¯ä»¥åœ¨webåè®®ä¸å†…éƒ¨ä½¿ç”¨çš„éWebå‹å¥½å‹åè®®é—´è¿›è¡Œè½¬æ¢ï¼Œå¦‚HTTPåè®®ã€WebSocketåè®®ã€‚</p>
<p>API Gatewayå¯ä»¥æä¾›ç»™å®¢æˆ·ç«¯ä¸€ä¸ªå®šåˆ¶åŒ–çš„APIã€‚å®ƒæš´éœ²ä¸€ä¸ªç²—ç²’åº¦APIç»™ç§»åŠ¨å®¢æˆ·ç«¯ã€‚ä»¥äº§å“æœ€ç»ˆé¡µè¿™ä¸ªä½¿ç”¨åœºæ™¯ä¸ºä¾‹ã€‚API Gatewayæä¾›ä¸€ä¸ªæœåŠ¡æä¾›ç‚¹ï¼ˆ/productdetails?productid=xxxï¼‰ä½¿å¾—ç§»åŠ¨å®¢æˆ·ç«¯å¯ä»¥åœ¨ä¸€ä¸ªè¯·æ±‚ä¸­æ£€ç´¢åˆ°äº§å“æœ€ç»ˆé¡µçš„å…¨éƒ¨æ•°æ®ã€‚API Gatewayé€šè¿‡è°ƒç”¨å¤šä¸ªæœåŠ¡æ¥å¤„ç†è¿™ä¸€ä¸ªè¯·æ±‚å¹¶è¿”å›ç»“æœï¼Œæ¶‰åŠäº§å“ä¿¡æ¯ã€æ¨èã€è¯„è®ºç­‰ã€‚</p>
<p>ä¸€ä¸ªå¾ˆå¥½çš„API Gatewayä¾‹å­æ˜¯<a target="_blank" rel="external nofollow noopener noreferrer" href="http://techblog.netflix.com/2013/02/rxjava-netflix-api.html">Netfix API Gateway</a>ã€‚NetflixæµæœåŠ¡æä¾›æ•°ç™¾ä¸ªä¸åŒçš„å¾®æœåŠ¡ï¼ŒåŒ…æ‹¬ç”µè§†ã€æœºé¡¶ç›’ã€æ™ºèƒ½æ‰‹æœºã€æ¸¸æˆç³»ç»Ÿã€å¹³æ¿ç”µè„‘ç­‰ã€‚èµ·åˆï¼ŒNetflixè§†å›¾æä¾›ä¸€ä¸ª<a target="_blank" rel="external nofollow noopener noreferrer" href="http://www.programmableweb.com/news/why-rest-keeps-me-night/2012/05/15">é€‚ç”¨å…¨åœºæ™¯</a>çš„APIã€‚ä½†æ˜¯ï¼Œä»–ä»¬å‘ç°è¿™ç§å½¢å¼ä¸å¥½ç”¨ï¼Œå› ä¸ºæ¶‰åŠåˆ°å„å¼å„æ ·çš„è®¾å¤‡ä»¥åŠå®ƒä»¬ç‹¬ç‰¹çš„éœ€æ±‚ã€‚ç°åœ¨ï¼Œä»–ä»¬é‡‡ç”¨ä¸€ä¸ªAPI Gatewayæ¥æä¾›å®¹é”™æ€§é«˜çš„APIï¼Œé’ˆå¯¹ä¸åŒç±»å‹è®¾å¤‡æœ‰ç›¸åº”ä»£ç ã€‚äº‹å®ä¸Šï¼Œä¸€ä¸ªé€‚é…å™¨å¤„ç†ä¸€ä¸ªè¯·æ±‚å¹³å‡è¦è°ƒç”¨6åˆ°8ä¸ªåç«¯æœåŠ¡ã€‚Netflix API Gatewayæ¯å¤©å¤„ç†æ•°åäº¿çš„è¯·æ±‚ã€‚</p>
<h3 id="API-Gatewayçš„ä¼˜ç‚¹å’Œç¼ºç‚¹"><a href="#API-Gatewayçš„ä¼˜ç‚¹å’Œç¼ºç‚¹" class="headerlink" title="API Gatewayçš„ä¼˜ç‚¹å’Œç¼ºç‚¹"></a>API Gatewayçš„ä¼˜ç‚¹å’Œç¼ºç‚¹</h3><p>å¦‚ä½ æ‰€æ–™ï¼Œé‡‡ç”¨API Gatewayä¹Ÿæ˜¯ä¼˜ç¼ºç‚¹å¹¶å­˜çš„ã€‚API Gatewayçš„ä¸€ä¸ªæœ€å¤§å¥½å¤„æ˜¯å°è£…åº”ç”¨å†…éƒ¨ç»“æ„ã€‚ç›¸æ¯”èµ·æ¥è°ƒç”¨æŒ‡å®šçš„æœåŠ¡ï¼Œå®¢æˆ·ç«¯ç›´æ¥è·Ÿgatwayäº¤äº’æ›´ç®€å•ç‚¹ã€‚API Gatewayæä¾›ç»™æ¯ä¸€ä¸ªå®¢æˆ·ç«¯ä¸€ä¸ªç‰¹å®šAPIï¼Œè¿™æ ·å‡å°‘äº†å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨ç«¯çš„é€šä¿¡æ¬¡æ•°ï¼Œä¹Ÿç®€åŒ–äº†å®¢æˆ·ç«¯ä»£ç ã€‚</p>
<p>API Gatewayä¹Ÿæœ‰ä¸€äº›ç¼ºç‚¹ã€‚å®ƒæ˜¯ä¸€ä¸ªé«˜å¯ç”¨çš„ç»„ä»¶ï¼Œå¿…é¡»è¦å¼€å‘ã€éƒ¨ç½²å’Œç®¡ç†ã€‚è¿˜æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå®ƒå¯èƒ½æˆä¸ºå¼€å‘çš„ä¸€ä¸ªç“¶é¢ˆã€‚å¼€å‘è€…å¿…é¡»æ›´æ–°API Gatewayæ¥æä¾›æ–°æœåŠ¡æä¾›ç‚¹æ¥æ”¯æŒæ–°æš´éœ²çš„å¾®æœåŠ¡ã€‚æ›´æ–°API Gatewayæ—¶å¿…é¡»è¶Šè½»é‡çº§è¶Šå¥½ã€‚å¦åˆ™ï¼Œå¼€å‘è€…å°†å› ä¸ºæ›´æ–°Gatewayè€Œæ’é˜Ÿåˆ—ã€‚ä½†æ˜¯ï¼Œé™¤äº†è¿™äº›ç¼ºç‚¹ï¼Œå¯¹äºå¤§éƒ¨åˆ†çš„åº”ç”¨ï¼Œé‡‡ç”¨API Gatewayçš„æ–¹å¼éƒ½æ˜¯æœ‰æ•ˆçš„ã€‚</p>
<p>ä½¿ç”¨API Gatewayåï¼Œå®¢æˆ·ç«¯å’Œå¾®æœåŠ¡ä¹‹é—´çš„ç½‘ç»œå›¾å˜æˆä¸‹å›¾ï¼š</p>
<p><img src="https://gitee.com/cayzlh/img-repo/raw/master/2020/04/17/lzchLT.png" alt="API Gateway"></p>
<p>é€šè¿‡API Gatewayï¼Œå¯ä»¥ç»Ÿä¸€å‘å¤–éƒ¨ç³»ç»Ÿæä¾›REST APIã€‚Spring Cloudä¸­ä½¿ç”¨Zuulä½œä¸ºAPI Gatewayã€‚Zuulæä¾›äº†åŠ¨æ€è·¯ç”±ã€ç›‘æ§ã€å›é€€ã€å®‰å…¨ç­‰åŠŸèƒ½ã€‚</p>
<h2 id="Zuul"><a href="#Zuul" class="headerlink" title="Zuul"></a>Zuul</h2><p>Netflixå¼€æºçš„å¾®æœåŠ¡ç½‘å…³ï¼Œæ ¸å¿ƒæ˜¯ä¸€ç³»åˆ—è¿‡æ»¤å™¨ï¼š</p>
<ul>
<li>èº«ä»½è®¤è¯å®‰å…¨</li>
<li>å®¡æŸ¥ä¸ç›‘æ§</li>
<li>åŠ¨æ€è·¯ç”±</li>
<li>å‹åŠ›æµ‹è¯•</li>
<li>é™„å†åˆ†é…</li>
<li>é™æ€å“åº”å¤„ç†</li>
<li>å¤šåŒºåŸŸå¼¹æ€§</li>
</ul>
<h2 id="Zuulè¿‡æ»¤å™¨"><a href="#Zuulè¿‡æ»¤å™¨" class="headerlink" title="Zuulè¿‡æ»¤å™¨"></a>Zuulè¿‡æ»¤å™¨</h2><p>Spring Cloudä¸­ä½¿ç”¨Zuulä½œä¸ºAPI Gatewayã€‚Zuulæä¾›äº†åŠ¨æ€è·¯ç”±ã€ç›‘æ§ã€å›é€€ã€å®‰å…¨ç­‰åŠŸèƒ½ã€‚ä¸»è¦ä¸º4ç§æ ‡å‡†ç±»å‹ï¼š</p>
<ul>
<li>PREï¼šåœ¨è¯·æ±‚è¢«è·¯ç”±ä¹‹å‰è°ƒç”¨</li>
<li>ROUTINGï¼šè¿™ç§è¿‡æ»¤å™¨å°†è¯·æ±‚è·¯ç”±åˆ°å¾®æœåŠ¡</li>
<li>POSTï¼šåœ¨è·¯ç”±åˆ°å¾®æœåŠ¡ä»¥åæ‰§è¡Œ</li>
<li>ERRORï¼šåœ¨å…¶ä»–é˜¶æ®µå‘ç”Ÿé”™è¯¯æ—¶è‡ªä¿¡è¯¥è¿‡æ»¤å™¨</li>
</ul>
<h2 id="Spring-Cloud-Zuul"><a href="#Spring-Cloud-Zuul" class="headerlink" title="Spring Cloud Zuul"></a>Spring Cloud Zuul</h2><p><code>Spring Cloud Zuul</code>è·¯ç”±æ˜¯å¾®æœåŠ¡æ¶æ„çš„ä¸å¯æˆ–ç¼ºçš„ä¸€éƒ¨åˆ†ï¼Œæä¾›åŠ¨æ€è·¯ç”±ï¼Œç›‘æ§ï¼Œå¼¹æ€§ï¼Œå®‰å…¨ç­‰çš„è¾¹ç¼˜æœåŠ¡ã€‚<code>Zuul</code>æ˜¯<code>Netflix</code>å‡ºå“çš„ä¸€ä¸ªåŸºäº<code>JVM</code>è·¯ç”±å’ŒæœåŠ¡ç«¯çš„è´Ÿè½½å‡è¡¡å™¨ã€‚</p>
<h3 id="å‡†å¤‡å·¥ä½œ"><a href="#å‡†å¤‡å·¥ä½œ" class="headerlink" title="å‡†å¤‡å·¥ä½œ"></a>å‡†å¤‡å·¥ä½œ</h3><p>æ–°å»ºä¸€ä¸ª<code>Spring Boot</code>é¡¹ç›®ï¼Œå‘½åä¸ºï¼š<code>api-gateway</code>ï¼Œ</p>
<h3 id="POMé…ç½®"><a href="#POMé…ç½®" class="headerlink" title="POMé…ç½®"></a>POMé…ç½®</h3><p>åœ¨<code>pom.xml</code>ä¸­å¼•å…¥ä»¥ä¸‹ä¾èµ–ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.cayzlh<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-demos-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">relativePath</span>/&gt;</span> <span class="comment">&lt;!-- lookup parent from repository --&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>api-gateway<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>api-gateway<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">description</span>&gt;</span>Demo project for Spring Boot<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">java.version</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">java.version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-zuul<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="é…ç½®æ–‡ä»¶"><a href="#é…ç½®æ–‡ä»¶" class="headerlink" title="é…ç½®æ–‡ä»¶"></a>é…ç½®æ–‡ä»¶</h3><p>åœ¨é…ç½®æ–‡ä»¶ <code>application.yml</code> ä¸­åŠ å…¥æœåŠ¡åã€ç«¯å£å·ã€<code>Eureka</code> æ³¨å†Œä¸­å¿ƒçš„åœ°å€ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">api-gateway</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">28091</span></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">service-url:</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://localhost:28081/eureka/</span></span><br></pre></td></tr></table></figure>
<h3 id="å¯åŠ¨ç±»"><a href="#å¯åŠ¨ç±»" class="headerlink" title="å¯åŠ¨ç±»"></a>å¯åŠ¨ç±»</h3><p>ä½¿ç”¨<code>@EnableZuulProxy</code>æ³¨è§£å¼€å¯<code>Zuul</code>åŠŸèƒ½ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableZuulProxy</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ApiGatewayApplication</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(ApiGatewayApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è‡³æ­¤ï¼Œä¸€ä¸ªåŸºäº<code>Spring Cloud Zuul</code>çš„æœåŠ¡ç½‘å…³å°±å·²ç»æ„å»ºå®Œæˆã€‚åˆ†åˆ«å¯åŠ¨æ³¨å†Œä¸­å¿ƒã€æœåŠ¡ç”Ÿäº§è€…ã€æœåŠ¡æ¶ˆè´¹è€…ã€<code>API-GATEWAY</code>ï¼š</p>
<p><img src="https://gitee.com/cayzlh/img-repo/raw/master/2020/04/17/zmVnNy.png" alt="api-gateway"></p>
<p>å¯åŠ¨å®Œæˆåï¼Œè®¿é—®<a target="_blank" rel="external nofollow noopener noreferrer" href="http://localhost:28081/">http://localhost:208081</a>ï¼Œå¯ä»¥çœ‹åˆ°ä¸Šé¢çš„ç»“æœã€‚</p>
<h3 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h3><p>ç”±äº <code>Spring Cloud Zuul</code> åœ¨æ•´åˆäº† <code>Eureka</code> ä¹‹åï¼Œå…·å¤‡é»˜è®¤çš„æœåŠ¡è·¯ç”±åŠŸèƒ½ï¼Œå³ï¼š<strong>å½“æˆ‘ä»¬è¿™é‡Œæ„å»ºçš„<code>api-gateway</code>åº”ç”¨å¯åŠ¨å¹¶æ³¨å†Œåˆ° <code>Eureka</code> ä¹‹åï¼ŒæœåŠ¡ç½‘å…³ä¼šå‘ç°ä¸Šé¢æˆ‘ä»¬å¯åŠ¨çš„ä¸¤ä¸ªæœåŠ¡<code>producer</code>å’Œ<code>consumer</code>ï¼Œè¿™æ—¶å€™ <code>Zuul</code> å°±ä¼šåˆ›å»ºä¸¤ä¸ªè·¯ç”±è§„åˆ™ã€‚æ¯ä¸ªè·¯ç”±è§„åˆ™éƒ½åŒ…å«ä¸¤éƒ¨åˆ†ï¼Œä¸€éƒ¨åˆ†æ˜¯å¤–éƒ¨è¯·æ±‚çš„åŒ¹é…è§„åˆ™ï¼Œå¦ä¸€éƒ¨åˆ†æ˜¯è·¯ç”±çš„æœåŠ¡ <code>ID</code>ã€‚</strong>é’ˆå¯¹å½“å‰ç¤ºä¾‹çš„æƒ…å†µï¼Œ<code>Zuul</code> ä¼šåˆ›å»ºä¸‹é¢çš„ä¸¤ä¸ªè·¯ç”±è§„åˆ™ï¼š</p>
<ul>
<li>è½¬å‘åˆ°<code>eureka-producer</code>æœåŠ¡çš„è¯·æ±‚è§„åˆ™ä¸ºï¼š<code>/eureka-producer/**</code></li>
<li>è½¬å‘åˆ°<code>eureka-consumer</code>æœåŠ¡çš„è¯·æ±‚è§„åˆ™ä¸ºï¼š<code>/eureka-consumer/**</code></li>
</ul>
<p>æœ€åï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è®¿é—®<code>28091</code>ç«¯å£çš„æœåŠ¡ç½‘å…³æ¥éªŒè¯ä¸Šè¿°è·¯ç”±çš„æ­£ç¡®æ€§ï¼š</p>
<ul>
<li><p>æ¯”å¦‚è®¿é—®ï¼š<a target="_blank" rel="external nofollow noopener noreferrer" href="http://localhost:28091/eureka-consumer/hello/zhangsan">http://localhost:28091/eureka-consumer/hello/zhangsan</a>ï¼Œè¯¥è¯·æ±‚å°†æœ€ç»ˆè¢«è·¯ç”±åˆ°<code>consumer</code>çš„<code>/hello</code>æ¥å£ä¸Šï¼š</p>
<p><img src="https://gitee.com/cayzlh/img-repo/raw/master/2020/04/17/06aKRo.png" alt="api-gateway"></p>
</li>
</ul>
<p>ä»¥ä¸Šç»“æœè¯´æ˜zuulå·²ç»å¼€å§‹ç”Ÿæ•ˆäº†ã€‚</p>
<h2 id="è¿‡æ»¤å™¨"><a href="#è¿‡æ»¤å™¨" class="headerlink" title="è¿‡æ»¤å™¨"></a>è¿‡æ»¤å™¨</h2><p><code>Zuul</code>è¿˜æœ‰æ›´å¤šçš„åº”ç”¨åœºæ™¯ï¼Œæ¯”å¦‚ï¼šé‰´æƒã€æµé‡è½¬å‘ã€è¯·æ±‚ç»Ÿè®¡ç­‰ç­‰ï¼Œè¿™äº›åŠŸèƒ½éƒ½å¯ä»¥ä½¿ç”¨<code>Zuul</code>æ¥å®ç°ã€‚</p>
<h3 id="Zuulçš„æ ¸å¿ƒ"><a href="#Zuulçš„æ ¸å¿ƒ" class="headerlink" title="Zuulçš„æ ¸å¿ƒ"></a>Zuulçš„æ ¸å¿ƒ</h3><p><code>Filter</code>æ˜¯<code>Zuul</code>çš„æ ¸å¿ƒï¼Œç”¨æ¥å®ç°å¯¹å¤–æœåŠ¡çš„æ§åˆ¶ã€‚Filterçš„ç”Ÿå‘½å‘¨æœŸæœ‰4ä¸ªï¼Œåˆ†åˆ«æ˜¯<code>PRE</code>ã€<code>ROUTING</code>ã€<code>POST</code>ã€<code>ERROR</code>ï¼Œæ•´ä¸ªç”Ÿå‘½å‘¨æœŸå¯ä»¥ç”¨ä¸‹å›¾æ¥è¡¨ç¤ºï¼š</p>
<p><img src="https://gitee.com/cayzlh/img-repo/raw/master/2020/04/17/8upBZN.png" alt="Filterç”Ÿå‘½å‘¨æœŸ"></p>
<p><code>Zuul</code>å¤§éƒ¨åˆ†åŠŸèƒ½éƒ½æ˜¯é€šè¿‡è¿‡æ»¤å™¨æ¥å®ç°çš„ï¼Œè¿™äº›è¿‡æ»¤å™¨ç±»å‹å¯¹åº”äºè¯·æ±‚çš„å…¸å‹ç”Ÿå‘½å‘¨æœŸã€‚</p>
<ul>
<li><strong>PREï¼š</strong> è¿™ç§è¿‡æ»¤å™¨åœ¨è¯·æ±‚è¢«è·¯ç”±ä¹‹å‰è°ƒç”¨ã€‚æˆ‘ä»¬å¯åˆ©ç”¨è¿™ç§è¿‡æ»¤å™¨å®ç°èº«ä»½éªŒè¯ã€åœ¨é›†ç¾¤ä¸­é€‰æ‹©è¯·æ±‚çš„å¾®æœåŠ¡ã€è®°å½•è°ƒè¯•ä¿¡æ¯ç­‰ã€‚</li>
<li><strong>ROUTINGï¼š</strong>è¿™ç§è¿‡æ»¤å™¨å°†è¯·æ±‚è·¯ç”±åˆ°å¾®æœåŠ¡ã€‚è¿™ç§è¿‡æ»¤å™¨ç”¨äºæ„å»ºå‘é€ç»™å¾®æœåŠ¡çš„è¯·æ±‚ï¼Œå¹¶ä½¿ç”¨<code>Apache HttpClient</code>æˆ–<code>Netfilx Ribbon</code>è¯·æ±‚å¾®æœåŠ¡ã€‚</li>
<li><strong>POSTï¼š</strong>è¿™ç§è¿‡æ»¤å™¨åœ¨è·¯ç”±åˆ°å¾®æœåŠ¡ä»¥åæ‰§è¡Œã€‚è¿™ç§è¿‡æ»¤å™¨å¯ç”¨æ¥ä¸ºå“åº”æ·»åŠ æ ‡å‡†çš„<code>HTTP Header</code>ã€æ”¶é›†ç»Ÿè®¡ä¿¡æ¯å’ŒæŒ‡æ ‡ã€å°†å“åº”ä»å¾®æœåŠ¡å‘é€ç»™å®¢æˆ·ç«¯ç­‰ã€‚</li>
<li><strong>ERRORï¼š</strong>åœ¨å…¶ä»–é˜¶æ®µå‘ç”Ÿé”™è¯¯æ—¶æ‰§è¡Œè¯¥è¿‡æ»¤å™¨ã€‚ é™¤äº†é»˜è®¤çš„è¿‡æ»¤å™¨ç±»å‹ï¼Œ<code>Zuul</code>è¿˜å…è®¸æˆ‘ä»¬åˆ›å»ºè‡ªå®šä¹‰çš„è¿‡æ»¤å™¨ç±»å‹ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥å®šåˆ¶ä¸€ç§<code>STATIC</code>ç±»å‹çš„è¿‡æ»¤å™¨ï¼Œç›´æ¥åœ¨<code>Zuul</code>ä¸­ç”Ÿæˆå“åº”ï¼Œè€Œä¸å°†è¯·æ±‚è½¬å‘åˆ°åç«¯çš„å¾®æœåŠ¡ã€‚</li>
</ul>
<h3 id="Zuulä¸­é»˜è®¤å®ç°çš„Filter"><a href="#Zuulä¸­é»˜è®¤å®ç°çš„Filter" class="headerlink" title="Zuulä¸­é»˜è®¤å®ç°çš„Filter"></a>Zuulä¸­é»˜è®¤å®ç°çš„Filter</h3><table>
<thead>
<tr>
<th>ç±»å‹</th>
<th>é¡ºåº</th>
<th>è¿‡æ»¤å™¨</th>
<th>åŠŸèƒ½</th>
</tr>
</thead>
<tbody><tr>
<td>pre</td>
<td>-3</td>
<td>ServletDetectionFilter</td>
<td>æ ‡è®°å¤„ç†Servletçš„ç±»å‹</td>
</tr>
<tr>
<td>pre</td>
<td>-2</td>
<td>Servlet30WrapperFilter</td>
<td>åŒ…è£…HttpServletRequestè¯·æ±‚</td>
</tr>
<tr>
<td>pre</td>
<td>-1</td>
<td>FormBodyWrapperFilter</td>
<td>åŒ…è£…è¯·æ±‚ä½“</td>
</tr>
<tr>
<td>route</td>
<td>1</td>
<td>DebugFilter</td>
<td>æ ‡è®°è°ƒè¯•æ ‡å¿—</td>
</tr>
<tr>
<td>route</td>
<td>5</td>
<td>PreDecorationFilter</td>
<td>å¤„ç†è¯·æ±‚ä¸Šä¸‹æ–‡ä¾›åç»­ä½¿ç”¨</td>
</tr>
<tr>
<td>route</td>
<td>10</td>
<td>RibbonRoutingFilter</td>
<td>serviceIdè¯·æ±‚è½¬å‘</td>
</tr>
<tr>
<td>route</td>
<td>100</td>
<td>SimpleHostRoutingFilter</td>
<td>urlè¯·æ±‚è½¬å‘</td>
</tr>
<tr>
<td>route</td>
<td>500</td>
<td>SendForwardFilter</td>
<td>forwardè¯·æ±‚è½¬å‘</td>
</tr>
<tr>
<td>post</td>
<td>0</td>
<td>SendErrorFilter</td>
<td>å¤„ç†æœ‰é”™è¯¯çš„è¯·æ±‚å“åº”</td>
</tr>
<tr>
<td>post</td>
<td>1000</td>
<td>SendResponseFilter</td>
<td>å¤„ç†æ­£å¸¸çš„è¯·æ±‚å“åº”</td>
</tr>
</tbody></table>
<p>-</p>
<h3 id="ç¦ç”¨æŒ‡å®šçš„Filter"><a href="#ç¦ç”¨æŒ‡å®šçš„Filter" class="headerlink" title="ç¦ç”¨æŒ‡å®šçš„Filter"></a>ç¦ç”¨æŒ‡å®šçš„Filter</h3><p>å¯ä»¥åœ¨<code>application.xml</code>ä¸­é…ç½®éœ€è¦ç¦ç”¨çš„<code>filter</code>ï¼Œä»¥<code>zuul.&lt;SimpleClassName&gt;.&lt;filterType&gt;.disable=true</code>è¿™æ ·çš„æ ¼å¼é…ç½®ï¼Œæ¯”å¦‚è¦ç¦ç”¨<code>org.springframework.cloud.netflix.zuul.filters.post.SendResponseFilter</code>å°±è®¾ç½®ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">zuul:</span></span><br><span class="line">  <span class="attr">SendResponseFilter:</span></span><br><span class="line">    <span class="attr">post:</span></span><br><span class="line">      <span class="attr">disable:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>
<h3 id="è‡ªå®šä¹‰Filter"><a href="#è‡ªå®šä¹‰Filter" class="headerlink" title="è‡ªå®šä¹‰Filter"></a>è‡ªå®šä¹‰Filter</h3><p>æˆ‘ä»¬å‡è®¾æœ‰è¿™æ ·ä¸€ä¸ªåœºæ™¯ï¼Œå› ä¸ºæœåŠ¡ç½‘å…³åº”å¯¹çš„æ˜¯å¤–éƒ¨çš„æ‰€æœ‰è¯·æ±‚ï¼Œä¸ºäº†é¿å…äº§ç”Ÿå®‰å…¨éšæ‚£ï¼Œæˆ‘ä»¬éœ€è¦å¯¹è¯·æ±‚åšä¸€å®šçš„é™åˆ¶ï¼Œæ¯”å¦‚è¯·æ±‚ä¸­å«æœ‰ <code>Token</code> ä¾¿è®©è¯·æ±‚ç»§ç»­å¾€ä¸‹èµ°ï¼Œå¦‚æœè¯·æ±‚ä¸å¸¦ <code>Token</code> å°±ç›´æ¥è¿”å›å¹¶ç»™å‡ºæç¤ºã€‚</p>
<p>é¦–å…ˆè‡ªå®šä¹‰ä¸€ä¸ª <code>Filter</code>ï¼Œç»§æ‰¿ <code>ZuulFilter</code> æŠ½è±¡ç±»ï¼Œåœ¨ <code>run()</code> æ–¹æ³•ä¸­éªŒè¯å‚æ•°æ˜¯å¦å«æœ‰ <code>Token</code>ï¼Œå…·ä½“å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TokenFilter</span> <span class="keyword">extends</span> <span class="title">ZuulFilter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è¿‡æ»¤å™¨çš„ç±»å‹ï¼Œå®ƒå†³å®šè¿‡æ»¤å™¨åœ¨è¯·æ±‚çš„å“ªä¸ªç”Ÿå‘½å‘¨æœŸä¸­æ‰§è¡Œã€‚</span></span><br><span class="line"><span class="comment">     * è¿™é‡Œå®šä¹‰ä¸ºpreï¼Œä»£è¡¨ä¼šåœ¨è¯·æ±‚è¢«è·¯ç”±ä¹‹å‰æ‰§è¡Œã€‚</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">filterType</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;pre&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * filteræ‰§è¡Œé¡ºåºï¼Œé€šè¿‡æ•°å­—æŒ‡å®šã€‚</span></span><br><span class="line"><span class="comment">     * æ•°å­—è¶Šå¤§ï¼Œä¼˜å…ˆçº§è¶Šä½ã€‚</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">filterOrder</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ¤æ–­è¯¥è¿‡æ»¤å™¨æ˜¯å¦éœ€è¦è¢«æ‰§è¡Œã€‚è¿™é‡Œæˆ‘ä»¬ç›´æ¥è¿”å›äº†trueï¼Œå› æ­¤è¯¥è¿‡æ»¤å™¨å¯¹æ‰€æœ‰è¯·æ±‚éƒ½ä¼šç”Ÿæ•ˆã€‚</span></span><br><span class="line"><span class="comment">     * å®é™…è¿ç”¨ä¸­æˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¯¥å‡½æ•°æ¥æŒ‡å®šè¿‡æ»¤å™¨çš„æœ‰æ•ˆèŒƒå›´ã€‚</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">shouldFilter</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è¿‡æ»¤å™¨çš„å…·ä½“é€»è¾‘</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        RequestContext ctx = RequestContext.getCurrentContext();</span><br><span class="line">        HttpServletRequest request = ctx.getRequest();</span><br><span class="line"></span><br><span class="line">        String token = request.getParameter(<span class="string">&quot;token&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (token == <span class="keyword">null</span> || token.isEmpty()) &#123;</span><br><span class="line">            ctx.setSendZuulResponse(<span class="keyword">false</span>);</span><br><span class="line">            ctx.setResponseStatusCode(<span class="number">401</span>);</span><br><span class="line">            ctx.setResponseBody(<span class="string">&quot;token is empty&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨ä¸Šé¢å®ç°çš„è¿‡æ»¤å™¨ä»£ç ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡ç»§æ‰¿<code>ZuulFilter</code>æŠ½è±¡ç±»å¹¶é‡å†™äº†ä¸‹é¢çš„å››ä¸ªæ–¹æ³•æ¥å®ç°è‡ªå®šä¹‰çš„è¿‡æ»¤å™¨ã€‚è¿™å››ä¸ªæ–¹æ³•åˆ†åˆ«å®šä¹‰äº†ï¼š</p>
<ul>
<li><code>filterType()</code>ï¼šè¿‡æ»¤å™¨çš„ç±»å‹ï¼Œå®ƒå†³å®šè¿‡æ»¤å™¨åœ¨è¯·æ±‚çš„å“ªä¸ªç”Ÿå‘½å‘¨æœŸä¸­æ‰§è¡Œã€‚è¿™é‡Œå®šä¹‰ä¸º<code>pre</code>ï¼Œä»£è¡¨ä¼šåœ¨è¯·æ±‚è¢«è·¯ç”±ä¹‹å‰æ‰§è¡Œã€‚</li>
<li><code>filterOrder()</code>ï¼šè¿‡æ»¤å™¨çš„æ‰§è¡Œé¡ºåºã€‚å½“è¯·æ±‚åœ¨ä¸€ä¸ªé˜¶æ®µä¸­å­˜åœ¨å¤šä¸ªè¿‡æ»¤å™¨æ—¶ï¼Œéœ€è¦æ ¹æ®è¯¥æ–¹æ³•è¿”å›çš„å€¼æ¥ä¾æ¬¡æ‰§è¡Œã€‚é€šè¿‡æ•°å­—æŒ‡å®šï¼Œæ•°å­—è¶Šå¤§ï¼Œä¼˜å…ˆçº§è¶Šä½ã€‚</li>
<li><code>shouldFilter()</code>ï¼šåˆ¤æ–­è¯¥è¿‡æ»¤å™¨æ˜¯å¦éœ€è¦è¢«æ‰§è¡Œã€‚è¿™é‡Œæˆ‘ä»¬ç›´æ¥è¿”å›äº†<code>true</code>ï¼Œå› æ­¤è¯¥è¿‡æ»¤å™¨å¯¹æ‰€æœ‰è¯·æ±‚éƒ½ä¼šç”Ÿæ•ˆã€‚å®é™…è¿ç”¨ä¸­æˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¯¥å‡½æ•°æ¥æŒ‡å®šè¿‡æ»¤å™¨çš„æœ‰æ•ˆèŒƒå›´ã€‚</li>
<li><code>run()</code>ï¼šè¿‡æ»¤å™¨çš„å…·ä½“é€»è¾‘ã€‚è¿™é‡Œæˆ‘ä»¬é€šè¿‡<code>ctx.setSendZuulResponse(false)</code>ä»¤ Zuul è¿‡æ»¤è¯¥è¯·æ±‚ï¼Œä¸å¯¹å…¶è¿›è¡Œè·¯ç”±ï¼Œç„¶åé€šè¿‡<code>ctx.setResponseStatusCode(401)</code>è®¾ç½®äº†å…¶è¿”å›çš„é”™è¯¯ç ï¼Œå½“ç„¶æˆ‘ä»¬ä¹Ÿå¯ä»¥è¿›ä¸€æ­¥ä¼˜åŒ–æˆ‘ä»¬çš„è¿”å›ï¼Œæ¯”å¦‚ï¼Œé€šè¿‡<code>ctx.setResponseBody(body)</code>å¯¹è¿”å› body å†…å®¹è¿›è¡Œç¼–è¾‘ç­‰ã€‚</li>
</ul>
<p>åœ¨å®ç°äº†è‡ªå®šä¹‰è¿‡æ»¤å™¨ä¹‹åï¼Œå®ƒå¹¶ä¸ä¼šç›´æ¥ç”Ÿæ•ˆï¼Œæˆ‘ä»¬è¿˜éœ€è¦ä¸ºå…¶åˆ›å»ºå…·ä½“çš„ <code>Bean</code> æ‰èƒ½å¯åŠ¨è¯¥è¿‡æ»¤å™¨ï¼Œæ¯”å¦‚ï¼Œåœ¨åº”ç”¨ä¸»ç±»ä¸­å¢åŠ å¦‚ä¸‹å†…å®¹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableZuulProxy</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ApiGatewayApplication</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(ApiGatewayApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> TokenFilter <span class="title">tokenFilter</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> TokenFilter();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨å¯¹<code>api-gateway</code>æœåŠ¡å®Œæˆäº†ä¸Šé¢çš„æ”¹é€ ä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥é‡æ–°å¯åŠ¨å®ƒï¼Œå¹¶å‘èµ·ä¸‹é¢çš„è¯·æ±‚ï¼Œå¯¹ä¸Šé¢å®šä¹‰çš„è¿‡æ»¤å™¨åšä¸€ä¸ªéªŒè¯ï¼š</p>
<ul>
<li><p>è®¿é—® <a target="_blank" rel="external nofollow noopener noreferrer" href="http://localhost:14000/eureka-consumer/hello/zhangsan">http://localhost:14000/eureka-consumer/hello/zhangsan</a> è¿”å› 401 é”™è¯¯å’Œ<code>token is empty</code></p>
<p><img src="https://gitee.com/cayzlh/img-repo/raw/master/2020/04/17/McjnNy.png" alt="zuul-filter"></p>
</li>
<li><p>è®¿é—®  <a target="_blank" rel="external nofollow noopener noreferrer" href="http://localhost:14000/eureka-consumer/hello/zhangsan?token=token">http://localhost:14000/eureka-consumer/hello/zhangsan?token=token</a> æ­£ç¡®è·¯ç”±åˆ°<code>eureka-consumer</code>çš„<code>/hello</code>æ¥å£ï¼Œå¹¶è¿”å›<code>Hello, zhangsan!, ç°åœ¨æ—¶é—´ï¼š1546506130007</code></p>
<p><img src="https://gitee.com/cayzlh/img-repo/raw/master/2020/04/17/K9vzNb.png" alt="zuul-filter"></p>
</li>
</ul>
<h2 id="è·¯ç”±ç†”æ–­"><a href="#è·¯ç”±ç†”æ–­" class="headerlink" title="è·¯ç”±ç†”æ–­"></a>è·¯ç”±ç†”æ–­</h2><p>å½“æˆ‘ä»¬çš„åç«¯æœåŠ¡å‡ºç°å¼‚å¸¸çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¸å¸Œæœ›å°†å¼‚å¸¸æŠ›å‡ºç»™æœ€å¤–å±‚ï¼ŒæœŸæœ›æœåŠ¡å¯ä»¥è‡ªåŠ¨è¿›è¡Œä¸€é™çº§ã€‚<code>Zuul</code>ç»™æˆ‘ä»¬æä¾›äº†è¿™æ ·çš„æ”¯æŒã€‚å½“æŸä¸ªæœåŠ¡å‡ºç°å¼‚å¸¸æ—¶ï¼Œç›´æ¥è¿”å›æˆ‘ä»¬é¢„è®¾çš„ä¿¡æ¯ã€‚</p>
<p>æˆ‘ä»¬é€šè¿‡è‡ªå®šä¹‰çš„<code>fallback</code>æ–¹æ³•ï¼Œå¹¶ä¸”å°†å…¶æŒ‡å®šç»™æŸä¸ª<code>route</code>æ¥å®ç°è¯¥<code>route</code>è®¿é—®å‡ºé—®é¢˜çš„ç†”æ–­å¤„ç†ã€‚ä¸»è¦ç»§æ‰¿<code>ZuulFallbackProvider</code>æ¥å£æ¥å®ç°ï¼Œ<code>ZuulFallbackProvider</code>é»˜è®¤æœ‰ä¸¤ä¸ªæ–¹æ³•ï¼Œä¸€ä¸ªç”¨æ¥æŒ‡æ˜ç†”æ–­æ‹¦æˆªå“ªä¸ªæœåŠ¡ï¼Œä¸€ä¸ªå®šåˆ¶è¿”å›å†…å®¹ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ZuulFallbackProvider</span> </span>&#123;</span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * The route this fallback will be used for.</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span> The route the fallback will be used for.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getRoute</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Provides a fallback response.</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span> The fallback response.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> ClientHttpResponse <span class="title">fallbackResponse</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å®ç°ç±»é€šè¿‡å®ç°<code>getRoute</code>æ–¹æ³•ï¼Œå‘Šè¯‰<code>Zuul</code>å®ƒæ˜¯è´Ÿè´£å“ªä¸ª<code>route</code>å®šä¹‰çš„ç†”æ–­ã€‚è€Œ<code>fallbackResponse</code>æ–¹æ³•åˆ™æ˜¯å‘Šè¯‰ <code>Zuul</code> æ–­è·¯å‡ºç°æ—¶ï¼Œå®ƒä¼šæä¾›ä¸€ä¸ªä»€ä¹ˆè¿”å›å€¼æ¥å¤„ç†è¯·æ±‚ã€‚</p>
<p>åæ¥<code>Spring</code>åˆæ‰©å±•äº†æ­¤ç±»ï¼Œä¸°å¯Œäº†è¿”å›æ–¹å¼ï¼Œåœ¨è¿”å›çš„å†…å®¹ä¸­æ·»åŠ äº†å¼‚å¸¸ä¿¡æ¯ï¼Œå› æ­¤æœ€æ–°ç‰ˆæœ¬å»ºè®®ç›´æ¥ç»§æ‰¿ç±»<code>FallbackProvider</code> ã€‚</p>
<h2 id="è·¯ç”±é‡è¯•"><a href="#è·¯ç”±é‡è¯•" class="headerlink" title="è·¯ç”±é‡è¯•"></a>è·¯ç”±é‡è¯•</h2><p>æœ‰æ—¶å€™å› ä¸ºç½‘ç»œæˆ–è€…å…¶å®ƒåŸå› ï¼ŒæœåŠ¡å¯èƒ½ä¼šæš‚æ—¶çš„ä¸å¯ç”¨ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å¸Œæœ›å¯ä»¥å†æ¬¡å¯¹æœåŠ¡è¿›è¡Œé‡è¯•ï¼Œ<code>Zuul</code>ä¹Ÿå¸®æˆ‘ä»¬å®ç°äº†æ­¤åŠŸèƒ½ï¼Œéœ€è¦ç»“åˆ<code>Spring Retry</code> ä¸€èµ·æ¥å®ç°ã€‚éœ€è¦æ·»åŠ ä¾èµ–ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.retry<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-retry<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>å¼€å¯é‡è¯•åœ¨æŸäº›æƒ…å†µä¸‹æ˜¯æœ‰é—®é¢˜çš„ï¼Œæ¯”å¦‚å½“å‹åŠ›è¿‡å¤§ï¼Œä¸€ä¸ªå®ä¾‹åœæ­¢å“åº”æ—¶ï¼Œè·¯ç”±å°†æµé‡è½¬åˆ°å¦ä¸€ä¸ªå®ä¾‹ï¼Œå¾ˆæœ‰å¯èƒ½å¯¼è‡´æœ€ç»ˆæ‰€æœ‰çš„å®ä¾‹å…¨è¢«å‹å®ã€‚è¯´åˆ°åº•ï¼Œæ–­è·¯å™¨çš„å…¶ä¸­ä¸€ä¸ªä½œç”¨å°±æ˜¯é˜²æ­¢æ•…éšœæˆ–è€…å‹åŠ›æ‰©æ•£ã€‚ç”¨äº†<code>retry</code>ï¼Œæ–­è·¯å™¨å°±åªæœ‰åœ¨è¯¥æœåŠ¡çš„æ‰€æœ‰å®ä¾‹éƒ½æ— æ³•è¿ä½œçš„æƒ…å†µä¸‹æ‰èƒ½èµ·ä½œç”¨ã€‚è¿™ç§æ—¶å€™ï¼Œæ–­è·¯å™¨çš„å½¢å¼æ›´åƒæ˜¯æä¾›ä¸€ç§å‹å¥½çš„é”™è¯¯ä¿¡æ¯ï¼Œæˆ–è€…å‡è£…æœåŠ¡æ­£å¸¸è¿è¡Œçš„å‡è±¡ç»™ä½¿ç”¨è€…ã€‚</p>
<p>ä¸ç”¨<code>retry</code>ï¼Œä»…ä½¿ç”¨è´Ÿè½½å‡è¡¡å’Œç†”æ–­ï¼Œå°±å¿…é¡»è€ƒè™‘åˆ°æ˜¯å¦èƒ½å¤Ÿæ¥å—å•ä¸ªæœåŠ¡å®ä¾‹å…³é—­å’Œ<code>eureka</code>åˆ·æ–°æœåŠ¡åˆ—è¡¨ä¹‹é—´å¸¦æ¥çš„çŸ­æ—¶é—´çš„ç†”æ–­ã€‚å¦‚æœå¯ä»¥æ¥å—ï¼Œå°±æ— éœ€ä½¿ç”¨<code>retry</code>ã€‚</p>
</blockquote>
<p>-</p>
<h2 id="Zuulé«˜å¯ç”¨"><a href="#Zuulé«˜å¯ç”¨" class="headerlink" title="Zuulé«˜å¯ç”¨"></a>Zuulé«˜å¯ç”¨</h2><p>ä¸åŒçš„å®¢æˆ·ç«¯ä½¿ç”¨ä¸åŒçš„è´Ÿè½½å°†è¯·æ±‚åˆ†å‘åˆ°åç«¯çš„<code>Zuul</code>ï¼Œ<code>Zuul</code>åœ¨é€šè¿‡<code>Eureka</code>è°ƒç”¨åç«¯æœåŠ¡ï¼Œæœ€åå¯¹å¤–è¾“å‡ºã€‚å› æ­¤ä¸ºäº†ä¿è¯<code>Zuul</code>çš„é«˜å¯ç”¨æ€§ï¼Œå‰ç«¯å¯ä»¥åŒæ—¶å¯åŠ¨å¤šä¸ª<code>Zuul</code>å®ä¾‹è¿›è¡Œè´Ÿè½½ï¼Œåœ¨<code>Zuul</code>çš„å‰ç«¯ä½¿ç”¨<code>Nginx</code>æˆ–è€…<code>F5</code>è¿›è¡Œè´Ÿè½½è½¬å‘ä»¥è¾¾åˆ°é«˜å¯ç”¨æ€§ã€‚</p>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="https://windmt.com/2018/04/23/spring-cloud-10-zuul-router/">æœåŠ¡ç½‘å…³ Zuulï¼ˆè·¯ç”±ï¼‰ã€Finchley ç‰ˆã€‘</a></li>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="http://www.ityouknow.com/springcloud/2017/06/01/gateway-service-zuul.html">æœåŠ¡ç½‘å…³zuulåˆçº§ç¯‡</a></li>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="http://www.ityouknow.com/springcloud/2018/01/20/spring-cloud-zuul.html">æœåŠ¡ç½‘å…³Zuulé«˜çº§ç¯‡</a></li>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="https://windmt.com/2018/04/23/spring-cloud-11-zuul-filter/">æœåŠ¡ç½‘å…³ Zuulï¼ˆè¿‡æ»¤å™¨ï¼‰ã€Finchley ç‰ˆã€‘</a></li>
</ul>

  </div>

  
    <div style="text-align:center;width:100%">
      <img src="https://cdn.jsdelivr.net/gh/cayzlh/git-img-repository@master/uPic/640-2.gif">
    </div>
  

  
    <div>
      <h4>ç‰ˆæƒå£°æ˜</h4>
      <pre>
        
        <strong>æœ¬æ–‡æ¥æºï¼š </strong><a href="https://www.cayzlh.com/blog" title="ğŸ³Antä¸¶" rel="noopener external nofollow noreferrer" target="_blank">https://www.cayzlh.com/blog</a>

        <strong>æœ¬æ–‡é“¾æ¥ï¼š</strong><a href="https://www.cayzlh.com/2019/01/03/d3f1148e.html" title="/blog/SpringCloud%EF%BC%88%E6%9C%8D%E5%8A%A1%E7%BD%91%E5%85%B3zuul%EF%BC%89">https://www.cayzlh.com/2019/01/03/d3f1148e.html</a>

        <strong>ç‰ˆæƒå£°æ˜ï¼š </strong>
        
          æ–‡ç« å†…å®¹ä»…ç”¨ä½œå­¦ä¹ å’Œåˆ†äº«ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„
        
      </pre>
    </div>
  

</article>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
        
          <li><a href="/blog/">Home</a></li>
        
          <li><a href="/blog/archives/">Articles</a></li>
        
          <li><a href="/blog/about/">About</a></li>
        
          <li><a href="/blog/search/">Search</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#API-Gateway"><span class="toc-number">1.</span> <span class="toc-text">API Gateway</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#API-Gateway%E7%9A%84%E4%BC%98%E7%82%B9%E5%92%8C%E7%BC%BA%E7%82%B9"><span class="toc-number">1.1.</span> <span class="toc-text">API Gatewayçš„ä¼˜ç‚¹å’Œç¼ºç‚¹</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Zuul"><span class="toc-number">2.</span> <span class="toc-text">Zuul</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Zuul%E8%BF%87%E6%BB%A4%E5%99%A8"><span class="toc-number">3.</span> <span class="toc-text">Zuulè¿‡æ»¤å™¨</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Spring-Cloud-Zuul"><span class="toc-number">4.</span> <span class="toc-text">Spring Cloud Zuul</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C"><span class="toc-number">4.1.</span> <span class="toc-text">å‡†å¤‡å·¥ä½œ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#POM%E9%85%8D%E7%BD%AE"><span class="toc-number">4.2.</span> <span class="toc-text">POMé…ç½®</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">4.3.</span> <span class="toc-text">é…ç½®æ–‡ä»¶</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%AF%E5%8A%A8%E7%B1%BB"><span class="toc-number">4.4.</span> <span class="toc-text">å¯åŠ¨ç±»</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95"><span class="toc-number">4.5.</span> <span class="toc-text">æµ‹è¯•</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%87%E6%BB%A4%E5%99%A8"><span class="toc-number">5.</span> <span class="toc-text">è¿‡æ»¤å™¨</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Zuul%E7%9A%84%E6%A0%B8%E5%BF%83"><span class="toc-number">5.1.</span> <span class="toc-text">Zuulçš„æ ¸å¿ƒ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Zuul%E4%B8%AD%E9%BB%98%E8%AE%A4%E5%AE%9E%E7%8E%B0%E7%9A%84Filter"><span class="toc-number">5.2.</span> <span class="toc-text">Zuulä¸­é»˜è®¤å®ç°çš„Filter</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A6%81%E7%94%A8%E6%8C%87%E5%AE%9A%E7%9A%84Filter"><span class="toc-number">5.3.</span> <span class="toc-text">ç¦ç”¨æŒ‡å®šçš„Filter</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89Filter"><span class="toc-number">5.4.</span> <span class="toc-text">è‡ªå®šä¹‰Filter</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B7%AF%E7%94%B1%E7%86%94%E6%96%AD"><span class="toc-number">6.</span> <span class="toc-text">è·¯ç”±ç†”æ–­</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B7%AF%E7%94%B1%E9%87%8D%E8%AF%95"><span class="toc-number">7.</span> <span class="toc-text">è·¯ç”±é‡è¯•</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Zuul%E9%AB%98%E5%8F%AF%E7%94%A8"><span class="toc-number">8.</span> <span class="toc-text">Zuulé«˜å¯ç”¨</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E8%80%83"><span class="toc-number">9.</span> <span class="toc-text">å‚è€ƒ</span></a></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="external nofollow noopener noreferrer" href="http://www.facebook.com/sharer.php?u=https://www.cayzlh.com/2019/01/03/d3f1148e.html"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="external nofollow noopener noreferrer" href="https://twitter.com/share?url=https://www.cayzlh.com/2019/01/03/d3f1148e.html&text=SpringCloudï¼ˆæœåŠ¡ç½‘å…³zuulï¼‰"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="external nofollow noopener noreferrer" href="http://www.linkedin.com/shareArticle?url=https://www.cayzlh.com/2019/01/03/d3f1148e.html&title=SpringCloudï¼ˆæœåŠ¡ç½‘å…³zuulï¼‰"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="external nofollow noopener noreferrer" href="https://pinterest.com/pin/create/bookmarklet/?url=https://www.cayzlh.com/2019/01/03/d3f1148e.html&is_video=false&description=SpringCloudï¼ˆæœåŠ¡ç½‘å…³zuulï¼‰"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=SpringCloudï¼ˆæœåŠ¡ç½‘å…³zuulï¼‰&body=Check out this article: https://www.cayzlh.com/2019/01/03/d3f1148e.html"><i class="fas fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="external nofollow noopener noreferrer" href="https://getpocket.com/save?url=https://www.cayzlh.com/2019/01/03/d3f1148e.html&title=SpringCloudï¼ˆæœåŠ¡ç½‘å…³zuulï¼‰"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="external nofollow noopener noreferrer" href="http://reddit.com/submit?url=https://www.cayzlh.com/2019/01/03/d3f1148e.html&title=SpringCloudï¼ˆæœåŠ¡ç½‘å…³zuulï¼‰"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="external nofollow noopener noreferrer" href="http://www.stumbleupon.com/submit?url=https://www.cayzlh.com/2019/01/03/d3f1148e.html&title=SpringCloudï¼ˆæœåŠ¡ç½‘å…³zuulï¼‰"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="external nofollow noopener noreferrer" href="http://digg.com/submit?url=https://www.cayzlh.com/2019/01/03/d3f1148e.html&title=SpringCloudï¼ˆæœåŠ¡ç½‘å…³zuulï¼‰"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="external nofollow noopener noreferrer" href="http://www.tumblr.com/share/link?url=https://www.cayzlh.com/2019/01/03/d3f1148e.html&name=SpringCloudï¼ˆæœåŠ¡ç½‘å…³zuulï¼‰&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="external nofollow noopener noreferrer" href="https://news.ycombinator.com/submitlink?u=https://www.cayzlh.com/2019/01/03/d3f1148e.html&t=SpringCloudï¼ˆæœåŠ¡ç½‘å…³zuulï¼‰"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden="true"></i> TOC</a>
<!--        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>-->
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    CAYZLH &copy;
    
    
    2019-2021
    ç²¤ICPå¤‡20058712å·-1
  </div>
  <div class="footer-right">
    <nav>
      <ul>
        
          <li><a href="/blog/tools/">tools</a></li>
        
          <li><a href="/blog/links/">links</a></li>
        
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->

<link rel="stylesheet" href="/blog/lib/font-awesome/css/all.min.css">


<link rel="stylesheet" href="/blog/lib/justified-gallery/css/justifiedGallery.min.css">


    <!-- jquery -->

<script src="/blog/lib/jquery/jquery.min.js"></script>


<script src="/blog/lib/justified-gallery/js/jquery.justifiedGallery.min.js"></script>

<!-- clipboard -->

  
<script src="/blog/lib/clipboard/clipboard.min.js"></script>

  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
    btn += '<i class="far fa-clone"></i>';
    btn += '</span>'; 
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "Copied!");
      e.clearSelection();
    })
  })
  </script>


<script src="/blog/js/main.js"></script>

<!-- search -->

<!-- Google Analytics -->

    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-129095667-1"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'UA-129095667-1');
    </script>

<!-- Baidu Analytics -->

<!-- Cloudflare Analytics -->

<!-- Umami Analytics -->

<!-- Disqus Comments -->


</body>
</html>
