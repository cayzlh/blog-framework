<!DOCTYPE html>
<html lang="zh-Hans">

<head>
  <meta name="generator" content="Hexo 5.4.0">
  <meta charset="utf-8">
  

  <meta http-equiv="x-dns-prefetch-control" content="on">
  <link rel="dns-prefetch" href="https://cdn.jsdelivr.net">
  <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>

  <meta name="renderer" content="webkit">
  <meta name="force-rendering" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
  <meta name="HandheldFriendly" content="True">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <title>Springçš„ç¯å¢ƒ&å±æ€§ï¼šPropertySourceã€Environmentã€Profile - BLOG | CAYZLH</title>

  
    <meta name="description" content="åˆ†æä¸€ä¸‹Springçš„ç¯å¢ƒå±æ€§ï¼šPropertySourceã€Environmentã€Profile">
<meta property="og:type" content="article">
<meta property="og:title" content="Springçš„ç¯å¢ƒ&amp;å±æ€§ï¼šPropertySourceã€Environmentã€Profile">
<meta property="og:url" content="https://www.cayzlh.com/2020/01/25/8ce6797f.html">
<meta property="og:site_name" content="BLOG | CAYZLH">
<meta property="og:description" content="åˆ†æä¸€ä¸‹Springçš„ç¯å¢ƒå±æ€§ï¼šPropertySourceã€Environmentã€Profile">
<meta property="og:locale">
<meta property="og:image" content="https://gitee.com/cayzlh/img-repo/raw/master/2020/05/27/15398567835599_IpITEl_QAdnEu.jpg">
<meta property="og:image" content="https://gitee.com/cayzlh/img-repo/raw/master/2020/05/27/201810241001_UC9RsT_5WoqUp.png">
<meta property="og:image" content="https://gitee.com/cayzlh/img-repo/raw/master/2020/05/27/15403714670613_02ZL9z_ul8OAy.jpg">
<meta property="article:published_time" content="2020-01-25T14:09:19.000Z">
<meta property="article:modified_time" content="2021-02-20T15:30:20.494Z">
<meta property="article:author" content="ğŸ³Antä¸¶">
<meta property="article:tag" content="Spring">
<meta property="article:tag" content="æ­»ç£•Spring">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://gitee.com/cayzlh/img-repo/raw/master/2020/05/27/15398567835599_IpITEl_QAdnEu.jpg">
  
  

  <!-- feed -->
  
    <link rel="alternate" href="/blog/atom.xml" title="BLOG | CAYZLH" type="application/atom+xml">
  

  
    
<link rel="stylesheet" href="/blog/css/main.css">

  

  
</head>

<body>
  


  <div class="l_body" id="start">
    <aside class="l_left">
    

<header class="header">
  <div class="logo-wrap">
  
  
    <a class="title" href="/blog/">
      BLOG | CAYZLH
    </a>
  
</div>

  <nav class="menu dis-select"><a class="nav-item active" href="/blog/">Blog</a></nav>
</header>

<div class="widgets">
  
    
      
      
<div class="widget-wrap" id="toc"><div class="widget-header h4 dis-select"><span class="name">TOC</span></div><div class="widget-body fs14 post"><div class="doc-tree active"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A6%82%E6%8B%AC"><span class="toc-text">æ¦‚æ‹¬</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Properties"><span class="toc-text">Properties</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#PropertyResolver"><span class="toc-text">PropertyResolver</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ConfigurablePropertyResolver"><span class="toc-text">ConfigurablePropertyResolver</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#AbstractPropertyResolver"><span class="toc-text">AbstractPropertyResolver</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#PropertySourcesPropertyResolver"><span class="toc-text">PropertySourcesPropertyResolver</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Environment"><span class="toc-text">Environment</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#ConfigurableEnvironment"><span class="toc-text">ConfigurableEnvironment</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#AbstractEnvironment"><span class="toc-text">AbstractEnvironment</span></a></li></ol></li></ol></div></div></div>

    
  
</div>


    </aside>
    <div class="l_main">
      

      


  <div class="bread-nav fs12">
  
    
    <div id="breadcrumb">
      <a class="cap breadcrumb" href="/">Home</a>
      <span class="sep"></span>
      <a class="cap breadcrumb" href="/">Blog</a>
      
        <span class="sep"></span>
        <a class="cap breadcrumb-link" href="/blog/categories/Spring/">Spring</a> <span class="sep"></span> <a class="cap breadcrumb-link" href="/blog/categories/Spring/%E3%80%8ASpring%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90%E3%80%8B/">ã€ŠSpringæºç åˆ†æã€‹</a>
      
    </div>
    <div id="post-meta">
      Posted on&nbsp;<time datetime="2020-01-25T14:09:19.000Z">2020-01-25</time>
    </div>
  
  </div>


<article class="content md post">
<h1 class="article-title"><span>Springçš„ç¯å¢ƒ&å±æ€§ï¼šPropertySourceã€Environmentã€Profile</span></h1>
<blockquote>
<p>æœ¬æ–‡ä½œè€…ï¼šchenssy</p>
<p>å‡ºå¤„ï¼š<a target="_blank" rel="external nofollow noopener noreferrer" href="http://cmsblogs.com/?p=4032">http://cmsblogs.com/?p=4032</a></p>
<p>åœ¨å­¦ä¹ <code>Springæºç </code>çš„è¿‡ç¨‹ä¸­å‘ç°çš„å¥½ç«™+å¥½è´´ï¼ŒåŸåˆ›ä¸æ˜“æ„Ÿè°¢ä½œè€…ã€‚</p>
<p>Springç‰ˆæœ¬ï¼š<strong>Spring 5.0.6.RELEASE</strong></p>
</blockquote>
<p><code>spring.profiles.active</code> å’Œ <code>@Profile</code> è¿™ä¸¤ä¸ªæˆ‘ç›¸ä¿¡å„ä½éƒ½ç†Ÿæ‚‰å§ï¼Œä¸»è¦åŠŸèƒ½æ˜¯å¯ä»¥å®ç°ä¸åŒç¯å¢ƒä¸‹ï¼ˆå¼€å‘ã€æµ‹è¯•ã€ç”Ÿäº§ï¼‰å‚æ•°é…ç½®çš„åˆ‡æ¢ã€‚</p>
<p>å…¶å®å…³äºç¯å¢ƒçš„åˆ‡æ¢ï¼Œåœ¨åšå®¢ <a href="/2020/01/23/cd2eaad8.html"> IOC ä¹‹ PropertyPlaceholderConfigurer çš„åº”ç”¨</a> å·²ç»ä»‹ç»äº†åˆ©ç”¨ PropertyPlaceholderConfigurer æ¥å®ç°åŠ¨æ€åˆ‡æ¢é…ç½®ç¯å¢ƒï¼Œå½“ç„¶è¿™ç§æ–¹æ³•éœ€è¦æˆ‘ä»¬è‡ªå·±å®ç°ï¼Œæœ‰ç‚¹å„¿éº»çƒ¦ã€‚ä½†æ˜¯å¯¹äºè¿™ç§éå¸¸å®é™…çš„éœ€æ±‚ï¼ŒSpring æ€ä¹ˆå¯èƒ½æ²¡æœ‰æä¾›å‘¢ï¼Ÿä¸‹é¢å°±è¿™ä¸ªé—®é¢˜æ¥å¯¹ Spring çš„<strong>ç¯å¢ƒ &amp; å±æ€§</strong>æ¥åšä¸€ä¸ªåˆ†æè¯´æ˜ã€‚</p>
<h2 id="æ¦‚æ‹¬"><a href="#æ¦‚æ‹¬" class="headerlink" title="æ¦‚æ‹¬"></a>æ¦‚æ‹¬</h2><p>Spring ç¯å¢ƒ &amp; å±æ€§ç”±å››ä¸ªéƒ¨åˆ†ç»„æˆï¼š<code>PropertySource</code>ã€<code>PropertyResolver</code>ã€<code>Profile</code> å’Œ <code>Environment</code>ã€‚</p>
<ul>
<li><strong>PropertySource</strong>ï¼šå±æ€§æºï¼Œkey-value å±æ€§å¯¹æŠ½è±¡ï¼Œç”¨äºé…ç½®æ•°æ®ã€‚</li>
<li><strong>PropertyResolver</strong>ï¼šå±æ€§è§£æå™¨ï¼Œç”¨äºè§£æå±æ€§é…ç½®</li>
<li><strong>Profile</strong>ï¼šå‰–é¢ï¼Œåªæœ‰æ¿€æ´»çš„å‰–é¢çš„ç»„ä»¶/é…ç½®æ‰ä¼šæ³¨å†Œåˆ° Spring å®¹å™¨ï¼Œç±»ä¼¼äº Spring Boot ä¸­çš„ profile</li>
<li><strong>Environment</strong>ï¼šç¯å¢ƒï¼ŒProfile å’Œ PropertyResolver çš„ç»„åˆã€‚</li>
</ul>
<p>ä¸‹é¢æ˜¯æ•´ä¸ªä½“ç³»çš„ç»“æ„å›¾ï¼š</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/cayzlh/img-repo/raw/master/2020/05/27/15398567835599_IpITEl_QAdnEu.jpg" alt="img"></p>
<p>ä¸‹é¢å°±é’ˆå¯¹ä¸Šé¢ç»“æ„å›¾å¯¹ Spring çš„ Properties &amp; Environment åšä¸€ä¸ªè¯¦ç»†çš„åˆ†æã€‚</p>
<h2 id="Properties"><a href="#Properties" class="headerlink" title="Properties"></a>Properties</h2><h3 id="PropertyResolver"><a href="#PropertyResolver" class="headerlink" title="PropertyResolver"></a>PropertyResolver</h3><blockquote>
<p>å±æ€§è§£æå™¨ï¼Œç”¨äºè§£æä»»ä½•åŸºç¡€æºçš„å±æ€§çš„æ¥å£</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">PropertyResolver</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ˜¯å¦åŒ…å«æŸä¸ªå±æ€§</span></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">containsProperty</span><span class="params">(String key)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è·å–å±æ€§å€¼ å¦‚æœæ‰¾ä¸åˆ°è¿”å›null</span></span><br><span class="line">    <span class="meta">@Nullable</span></span><br><span class="line">    <span class="function">String <span class="title">getProperty</span><span class="params">(String key)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è·å–å±æ€§å€¼ï¼Œå¦‚æœæ‰¾ä¸åˆ°è¿”å›é»˜è®¤å€¼  </span></span><br><span class="line">    <span class="function">String <span class="title">getProperty</span><span class="params">(String key, String defaultValue)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è·å–æŒ‡å®šç±»å‹çš„å±æ€§å€¼ï¼Œæ‰¾ä¸åˆ°è¿”å›null</span></span><br><span class="line">    <span class="meta">@Nullable</span></span><br><span class="line">    &lt;T&gt; <span class="function">T <span class="title">getProperty</span><span class="params">(String key, Class&lt;T&gt; targetType)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è·å–æŒ‡å®šç±»å‹çš„å±æ€§å€¼ï¼Œæ‰¾ä¸åˆ°è¿”å›é»˜è®¤å€¼</span></span><br><span class="line">    &lt;T&gt; <span class="function">T <span class="title">getProperty</span><span class="params">(String key, Class&lt;T&gt; targetType, T defaultValue)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è·å–å±æ€§å€¼ï¼Œæ‰¾ä¸åˆ°æŠ›å‡ºå¼‚å¸¸IllegalStateException</span></span><br><span class="line">    <span class="function">String <span class="title">getRequiredProperty</span><span class="params">(String key)</span> <span class="keyword">throws</span> IllegalStateException</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è·å–æŒ‡å®šç±»å‹çš„å±æ€§å€¼ï¼Œæ‰¾ä¸åˆ°æŠ›å‡ºå¼‚å¸¸IllegalStateException</span></span><br><span class="line">    &lt;T&gt; <span class="function">T <span class="title">getRequiredProperty</span><span class="params">(String key, Class&lt;T&gt; targetType)</span> <span class="keyword">throws</span> IllegalStateException</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ›¿æ¢æ–‡æœ¬ä¸­çš„å ä½ç¬¦ï¼ˆ$&#123;key&#125;ï¼‰åˆ°å±æ€§å€¼ï¼Œæ‰¾ä¸åˆ°ä¸è§£æ</span></span><br><span class="line">    <span class="function">String <span class="title">resolvePlaceholders</span><span class="params">(String text)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ›¿æ¢æ–‡æœ¬ä¸­çš„å ä½ç¬¦ï¼ˆ$&#123;key&#125;ï¼‰åˆ°å±æ€§å€¼ï¼Œæ‰¾ä¸åˆ°æŠ›å‡ºå¼‚å¸¸IllegalArgumentException</span></span><br><span class="line">    <span class="function">String <span class="title">resolveRequiredPlaceholders</span><span class="params">(String text)</span> <span class="keyword">throws</span> IllegalArgumentException</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä» API ä¸Šé¢æˆ‘ä»¬å°±çŸ¥é“å±æ€§è§£æå™¨ PropertyResolver çš„ä½œç”¨äº†ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„è¿ç”¨ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">PropertyResolver propertyResolver = <span class="keyword">new</span> PropertySourcesPropertyResolver(propertySources);</span><br><span class="line"></span><br><span class="line">System.out.println(propertyResolver.getProperty(<span class="string">&quot;name&quot;</span>));</span><br><span class="line">System.out.println(propertyResolver.getProperty(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;chenssy&quot;</span>));</span><br><span class="line">System.out.println(propertyResolver.resolvePlaceholders(<span class="string">&quot;my name is  $&#123;name&#125;&quot;</span>));</span><br></pre></td></tr></table></figure>

<p>ä¸‹å›¾æ˜¯ PropertyResolver ä½“ç³»ç»“æ„å›¾ï¼š</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/cayzlh/img-repo/raw/master/2020/05/27/201810241001_UC9RsT_5WoqUp.png" alt="201810241001"></p>
<ul>
<li><strong>ConfigurablePropertyResolver</strong>ï¼šä¾›å±æ€§ç±»å‹è½¬æ¢çš„åŠŸèƒ½</li>
<li><strong>AbstractPropertyResolver</strong>ï¼šè§£æå±æ€§æ–‡ä»¶çš„æŠ½è±¡åŸºç±»</li>
<li><strong>PropertySourcesPropertyResolver</strong>ï¼šPropertyResolver çš„å®ç°è€…ï¼Œä»–å¯¹ä¸€ç»„ PropertySources æä¾›å±æ€§è§£ææœåŠ¡</li>
</ul>
<h3 id="ConfigurablePropertyResolver"><a href="#ConfigurablePropertyResolver" class="headerlink" title="ConfigurablePropertyResolver"></a>ConfigurablePropertyResolver</h3><blockquote>
<p>æä¾›å±æ€§ç±»å‹è½¬æ¢çš„åŠŸèƒ½</p>
</blockquote>
<p>é€šä¿—ç‚¹è¯´å°±æ˜¯ ConfigurablePropertyResolver æä¾›å±æ€§å€¼ç±»å‹è½¬æ¢æ‰€éœ€è¦çš„ ConversionServiceã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ConfigurablePropertyResolver</span> <span class="keyword">extends</span> <span class="title">PropertyResolver</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¿”å›æ‰§è¡Œç±»å‹è½¬æ¢æ—¶ä½¿ç”¨çš„ ConfigurableConversionService</span></span><br><span class="line">    <span class="function">ConfigurableConversionService <span class="title">getConversionService</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è®¾ç½® ConfigurableConversionService</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">setConversionService</span><span class="params">(ConfigurableConversionService conversionService)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è®¾ç½®å ä½ç¬¦å‰ç¼€</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">setPlaceholderPrefix</span><span class="params">(String placeholderPrefix)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è®¾ç½®å ä½ç¬¦åç¼€</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">setPlaceholderSuffix</span><span class="params">(String placeholderSuffix)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è®¾ç½®å ä½ç¬¦ä¸é»˜è®¤å€¼ä¹‹é—´çš„åˆ†éš”ç¬¦</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">setValueSeparator</span><span class="params">(<span class="meta">@Nullable</span> String valueSeparator)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è®¾ç½®å½“é‡åˆ°åµŒå¥—åœ¨ç»™å®šå±æ€§å€¼å†…çš„ä¸å¯è§£æçš„å ä½ç¬¦æ—¶æ˜¯å¦æŠ›å‡ºå¼‚å¸¸</span></span><br><span class="line">    <span class="comment">// å½“å±æ€§å€¼åŒ…å«ä¸å¯è§£æçš„å ä½ç¬¦æ—¶ï¼ŒgetProperty(String)åŠå…¶å˜ä½“çš„å®ç°å¿…é¡»æ£€æŸ¥æ­¤å¤„è®¾ç½®çš„å€¼ä»¥ç¡®å®šæ­£ç¡®çš„è¡Œä¸ºã€‚</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">setIgnoreUnresolvableNestedPlaceholders</span><span class="params">(<span class="keyword">boolean</span> ignoreUnresolvableNestedPlaceholders)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æŒ‡å®šå¿…é¡»å­˜åœ¨å“ªäº›å±æ€§ï¼Œä»¥ä¾¿ç”±validateRequiredPropertiesï¼ˆï¼‰éªŒè¯</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">setRequiredProperties</span><span class="params">(String... requiredProperties)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// éªŒè¯setRequiredPropertiesæŒ‡å®šçš„æ¯ä¸ªå±æ€§æ˜¯å¦å­˜åœ¨å¹¶è§£æä¸ºénullå€¼</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">validateRequiredProperties</span><span class="params">()</span> <span class="keyword">throws</span> MissingRequiredPropertiesException</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä» ConfigurablePropertyResolver æ‰€æä¾›çš„æ–¹æ³•æ¥çœ‹ï¼Œé™¤äº†è®¿é—®å’Œè®¾ç½® ConversionService å¤–ï¼Œä¸»è¦è¿˜æä¾›äº†ä¸€äº›è§£æè§„åˆ™ä¹‹ç±»çš„æ–¹æ³•ã€‚</p>
<p>å°± Properties ä½“ç³»è€Œè¨€ï¼ŒPropertyResolver å®šä¹‰äº†è®¿é—® Properties å±æ€§å€¼çš„æ–¹æ³•ï¼Œè€Œ ConfigurablePropertyResolver åˆ™å®šä¹‰äº†è§£æ Properties ä¸€äº›ç›¸å…³çš„è§„åˆ™å’Œå€¼è¿›è¡Œç±»å‹è½¬æ¢æ‰€éœ€è¦çš„ Serviceã€‚</p>
<p>è¯¥ä½“ç³»æœ‰ä¸¤ä¸ªå®ç°è€…ï¼š<code>AbstractPropertyResolver</code> å’Œ <code>PropertySourcesPropertyResolver</code>ï¼Œå…¶ä¸­ <code>AbstractPropertyResolver</code> ä¸ºå®ç°çš„æŠ½è±¡åŸºç±»ï¼Œ<code>PropertySourcesPropertyResolver</code> ä¸ºçœŸæ­£çš„å®ç°è€…ã€‚</p>
<h3 id="AbstractPropertyResolver"><a href="#AbstractPropertyResolver" class="headerlink" title="AbstractPropertyResolver"></a>AbstractPropertyResolver</h3><blockquote>
<p>è§£æå±æ€§æ–‡ä»¶çš„æŠ½è±¡åŸºç±»</p>
</blockquote>
<p>AbstractPropertyResolver ä½œä¸ºåŸºç±»å®ƒä»…ä»…åªæ˜¯è®¾ç½®äº†ä¸€äº›è§£æå±æ€§æ–‡ä»¶æ‰€éœ€è¦é…ç½®æˆ–è€…è½¬æ¢å™¨ï¼Œå¦‚ <code>setConversionService()</code>ã€<code>setPlaceholderPrefix()</code>ã€<code>setValueSeparator()</code>ï¼Œå…¶å®è¿™äº›æ–¹æ³•çš„å®ç°éƒ½æ¯”è¾ƒç®€å•éƒ½æ˜¯è®¾ç½®æˆ–è€…è·å– AbstractPropertyResolver æ‰€æä¾›çš„å±æ€§ï¼Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ç±»å‹è½¬æ¢å»</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">volatile</span> ConfigurableConversionService conversionService;</span><br><span class="line"><span class="comment">// å ä½ç¬¦</span></span><br><span class="line"><span class="keyword">private</span> PropertyPlaceholderHelper nonStrictHelper;</span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="keyword">private</span> PropertyPlaceholderHelper strictHelper;</span><br><span class="line"><span class="comment">// è®¾ç½®æ˜¯å¦æŠ›å‡ºå¼‚å¸¸</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">boolean</span> ignoreUnresolvableNestedPlaceholders = <span class="keyword">false</span>;</span><br><span class="line"><span class="comment">// å ä½ç¬¦å‰ç¼€</span></span><br><span class="line"><span class="keyword">private</span> String placeholderPrefix = SystemPropertyUtils.PLACEHOLDER_PREFIX;</span><br><span class="line"><span class="comment">// å ä½ç¬¦åç¼€</span></span><br><span class="line"><span class="keyword">private</span> String placeholderSuffix = SystemPropertyUtils.PLACEHOLDER_SUFFIX;</span><br><span class="line"><span class="comment">// ä¸é»˜è®¤å€¼çš„åˆ†å‰²</span></span><br><span class="line"><span class="keyword">private</span> String valueSeparator = SystemPropertyUtils.VALUE_SEPARATOR;</span><br><span class="line"><span class="comment">// å¿…é¡»è¦æœ‰çš„å­—æ®µå€¼</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> Set&lt;String&gt; requiredProperties = <span class="keyword">new</span> LinkedHashSet&lt;&gt;();</span><br></pre></td></tr></table></figure>

<p>è¿™äº›å±æ€§éƒ½æ˜¯ ConfigurablePropertyResolver æ¥å£æ‰€æä¾›æ–¹æ³•éœ€è¦çš„å±æ€§ï¼Œä»–æ‰€æä¾›çš„æ–¹æ³•éƒ½æ˜¯è®¾ç½®å’Œè¯»å–è¿™äº›å€¼ï¼Œå¦‚ä¸‹å‡ ä¸ªæ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> ConfigurableConversionService <span class="title">getConversionService</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="comment">// éœ€è¦æä¾›ç‹¬ç«‹çš„DefaultConversionServiceï¼Œè€Œä¸æ˜¯PropertySourcesPropertyResolver ä½¿ç”¨çš„å…±äº«DefaultConversionServiceã€‚</span></span><br><span class="line">  ConfigurableConversionService cs = <span class="keyword">this</span>.conversionService;</span><br><span class="line">  <span class="keyword">if</span> (cs == <span class="keyword">null</span>) &#123;</span><br><span class="line">    <span class="keyword">synchronized</span> (<span class="keyword">this</span>) &#123;</span><br><span class="line">      cs = <span class="keyword">this</span>.conversionService;</span><br><span class="line">      <span class="keyword">if</span> (cs == <span class="keyword">null</span>) &#123;</span><br><span class="line">        cs = <span class="keyword">new</span> DefaultConversionService();</span><br><span class="line">        <span class="keyword">this</span>.conversionService = cs;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> cs;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setConversionService</span><span class="params">(ConfigurableConversionService conversionService)</span> </span>&#123;</span><br><span class="line">  Assert.notNull(conversionService, <span class="string">&quot;ConversionService must not be null&quot;</span>);</span><br><span class="line">  <span class="keyword">this</span>.conversionService = conversionService;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPlaceholderPrefix</span><span class="params">(String placeholderPrefix)</span> </span>&#123;</span><br><span class="line">  Assert.notNull(placeholderPrefix, <span class="string">&quot;&#x27;placeholderPrefix&#x27; must not be null&quot;</span>);</span><br><span class="line">  <span class="keyword">this</span>.placeholderPrefix = placeholderPrefix;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPlaceholderSuffix</span><span class="params">(String placeholderSuffix)</span> </span>&#123;</span><br><span class="line">  Assert.notNull(placeholderSuffix, <span class="string">&quot;&#x27;placeholderSuffix&#x27; must not be null&quot;</span>);</span><br><span class="line">  <span class="keyword">this</span>.placeholderSuffix = placeholderSuffix;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è€Œå¯¹å±æ€§çš„è®¿é—®åˆ™å§”æ‰˜ç»™å­ç±» PropertySourcesPropertyResolver å®ç°ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getProperty</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> getProperty(key, String.class);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getProperty</span><span class="params">(String key, String defaultValue)</span> </span>&#123;</span><br><span class="line">  String value = getProperty(key);</span><br><span class="line">  <span class="keyword">return</span> (value != <span class="keyword">null</span> ? value : defaultValue);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> &lt;T&gt; <span class="function">T <span class="title">getProperty</span><span class="params">(String key, Class&lt;T&gt; targetType, T defaultValue)</span> </span>&#123;</span><br><span class="line">  T value = getProperty(key, targetType);</span><br><span class="line">  <span class="keyword">return</span> (value != <span class="keyword">null</span> ? value : defaultValue);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getRequiredProperty</span><span class="params">(String key)</span> <span class="keyword">throws</span> IllegalStateException </span>&#123;</span><br><span class="line">  String value = getProperty(key);</span><br><span class="line">  <span class="keyword">if</span> (value == <span class="keyword">null</span>) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(<span class="string">&quot;Required key &#x27;&quot;</span> + key + <span class="string">&quot;&#x27; not found&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> value;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> &lt;T&gt; <span class="function">T <span class="title">getRequiredProperty</span><span class="params">(String key, Class&lt;T&gt; valueType)</span> <span class="keyword">throws</span> IllegalStateException </span>&#123;</span><br><span class="line">  T value = getProperty(key, valueType);</span><br><span class="line">  <span class="keyword">if</span> (value == <span class="keyword">null</span>) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(<span class="string">&quot;Required key &#x27;&quot;</span> + key + <span class="string">&quot;&#x27; not found&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> value;</span><br></pre></td></tr></table></figure>

<h3 id="PropertySourcesPropertyResolver"><a href="#PropertySourcesPropertyResolver" class="headerlink" title="PropertySourcesPropertyResolver"></a>PropertySourcesPropertyResolver</h3><blockquote>
<p>PropertyResolver çš„å®ç°è€…ï¼Œä»–å¯¹ä¸€ç»„ PropertySources æä¾›å±æ€§è§£ææœåŠ¡</p>
</blockquote>
<p>å®ƒä»…æœ‰ä¸€ä¸ªæˆå‘˜å˜é‡ï¼šPropertySourcesã€‚è¯¥æˆå‘˜å˜é‡å†…éƒ¨å­˜å‚¨ç€ä¸€ç»„ PropertySourceï¼Œè¡¨ç¤º key-value é”®å€¼å¯¹çš„æºçš„æŠ½è±¡åŸºç±»ï¼Œå³ä¸€ä¸ª PropertySource å¯¹è±¡åˆ™æ˜¯ä¸€ä¸ª key-value é”®å€¼å¯¹ã€‚å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">PropertySource</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">final</span> Log logger = LogFactory.getLog(getClass());</span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">final</span> String name;</span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">final</span> T source;</span><br><span class="line"></span><br><span class="line">   <span class="comment">//......</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯¹å¤–å…¬å¼€çš„ <code>getProperty()</code> éƒ½æ˜¯å§”æ‰˜ç»™ <code>getProperty(String key, Class&lt;T&gt; targetValueType, boolean resolveNestedPlaceholders)</code> å®ç°ï¼Œä»–æœ‰ä¸‰ä¸ªå‚æ•°ï¼Œåˆ†åˆ«è¡¨ç¤ºä¸ºï¼š</p>
<ul>
<li>keyï¼šè·å–çš„ key</li>
<li>targetValueTypeï¼š ç›®æ ‡ value çš„ç±»å‹</li>
<li>resolveNestedPlaceholdersï¼šæ˜¯å¦è§£å†³åµŒå¥—å ä½ç¬¦</li>
</ul>
<p>æºç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">protected</span> &lt;T&gt; <span class="function">T <span class="title">getProperty</span><span class="params">(String key, Class&lt;T&gt; targetValueType, <span class="keyword">boolean</span> resolveNestedPlaceholders)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">this</span>.propertySources != <span class="keyword">null</span>) &#123;</span><br><span class="line">    <span class="keyword">for</span> (PropertySource&lt;?&gt; propertySource : <span class="keyword">this</span>.propertySources) &#123;</span><br><span class="line">      <span class="keyword">if</span> (logger.isTraceEnabled()) &#123;</span><br><span class="line">        logger.trace(<span class="string">&quot;Searching for key &#x27;&quot;</span> + key + <span class="string">&quot;&#x27; in PropertySource &#x27;&quot;</span> +</span><br><span class="line">                     propertySource.getName() + <span class="string">&quot;&#x27;&quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      Object value = propertySource.getProperty(key);</span><br><span class="line">      <span class="keyword">if</span> (value != <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (resolveNestedPlaceholders &amp;&amp; value <span class="keyword">instanceof</span> String) &#123;</span><br><span class="line">          value = resolveNestedPlaceholders((String) value);</span><br><span class="line">        &#125;</span><br><span class="line">        logKeyFound(key, propertySource, value);</span><br><span class="line">        <span class="keyword">return</span> convertValueIfNecessary(value, targetValueType);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (logger.isDebugEnabled()) &#123;</span><br><span class="line">    logger.debug(<span class="string">&quot;Could not find key &#x27;&quot;</span> + key + <span class="string">&quot;&#x27; in any property source&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é¦–å…ˆä» propertySource ä¸­è·å–æŒ‡å®š key çš„ value å€¼ï¼Œç„¶ååˆ¤æ–­æ˜¯å¦éœ€è¦è¿›è¡ŒåµŒå¥—å ä½ç¬¦è§£æï¼Œå¦‚æœéœ€è¦åˆ™è°ƒç”¨ <code>resolveNestedPlaceholders()</code> è¿›è¡ŒåµŒå¥—å ä½ç¬¦è§£æï¼Œç„¶åè°ƒç”¨ <code>convertValueIfNecessary()</code> è¿›è¡Œç±»å‹è½¬æ¢ã€‚</p>
<p><strong>resolveNestedPlaceholders()</strong></p>
<p>è¯¥æ–¹æ³•ç”¨äºè§£æç»™å®šå­—ç¬¦ä¸²ä¸­çš„å ä½ç¬¦ï¼ŒåŒæ—¶æ ¹æ® ignoreUnresolvableNestedPlaceholders çš„å€¼ï¼Œæ¥ç¡®å®šæ˜¯å¦å¯¹ä¸å¯è§£æçš„å ä½ç¬¦çš„å¤„ç†æ–¹æ³•ï¼šæ˜¯å¿½ç•¥è¿˜æ˜¯æŠ›å‡ºå¼‚å¸¸ï¼ˆè¯¥å€¼ç”± <code>setIgnoreUnresolvableNestedPlaceholders()</code> è®¾ç½®ï¼‰ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> String <span class="title">resolveNestedPlaceholders</span><span class="params">(String value)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (<span class="keyword">this</span>.ignoreUnresolvableNestedPlaceholders ?</span><br><span class="line">          resolvePlaceholders(value) : resolveRequiredPlaceholders(value));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¦‚æœ this.ignoreUnresolvableNestedPlaceholders ä¸º trueï¼Œåˆ™è°ƒç”¨ <code>resolvePlaceholders()</code> ï¼Œå¦åˆ™è°ƒç”¨ <code>resolveRequiredPlaceholders()</code>ä½†æ˜¯æ— è®ºæ˜¯å“ªä¸ªæ–¹æ³•ï¼Œæœ€ç»ˆéƒ½ä¼šåˆ° <code>doResolvePlaceholders()</code>ï¼Œè¯¥æ–¹æ³•æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼š</p>
<ul>
<li>String ç±»å‹çš„ textï¼šå¾…è§£æçš„å­—ç¬¦ä¸²</li>
<li>PropertyPlaceholderHelper ç±»å‹çš„ helperï¼šç”¨äºè§£æå ä½ç¬¦çš„å·¥å…·ç±»ã€‚</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> String <span class="title">doResolvePlaceholders</span><span class="params">(String text, PropertyPlaceholderHelper helper)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> helper.replacePlaceholders(text, <span class="keyword">this</span>::getPropertyAsRawString);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>PropertyPlaceholderHelper æ˜¯ç”¨äºå¤„ç†åŒ…å«å ä½ç¬¦å€¼çš„å­—ç¬¦ä¸²ï¼Œæ„é€ è¯¥å®ä¾‹éœ€è¦å››ä¸ªå‚æ•°ï¼š</p>
<ul>
<li>placeholderPrefixï¼šå ä½ç¬¦å‰ç¼€</li>
<li>placeholderSuffixï¼šå ä½ç¬¦åç¼€</li>
<li>valueSeparatorï¼šå ä½ç¬¦å˜é‡ä¸å…³è”çš„é»˜è®¤å€¼ä¹‹é—´çš„åˆ†éš”ç¬¦</li>
<li>ignoreUnresolvablePlaceholdersï¼šæŒ‡ç¤ºæ˜¯å¦å¿½ç•¥ä¸å¯è§£æçš„å ä½ç¬¦ï¼ˆtrueï¼‰æˆ–æŠ›å‡ºå¼‚å¸¸ï¼ˆfalseï¼‰</li>
</ul>
<p>æ„é€ å‡½æ•°å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">PropertyPlaceholderHelper</span><span class="params">(String placeholderPrefix, String placeholderSuffix,</span></span></span><br><span class="line"><span class="function"><span class="params">                                 <span class="meta">@Nullable</span> String valueSeparator, <span class="keyword">boolean</span> ignoreUnresolvablePlaceholders)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  Assert.notNull(placeholderPrefix, <span class="string">&quot;&#x27;placeholderPrefix&#x27; must not be null&quot;</span>);</span><br><span class="line">  Assert.notNull(placeholderSuffix, <span class="string">&quot;&#x27;placeholderSuffix&#x27; must not be null&quot;</span>);</span><br><span class="line">  <span class="keyword">this</span>.placeholderPrefix = placeholderPrefix;</span><br><span class="line">  <span class="keyword">this</span>.placeholderSuffix = placeholderSuffix;</span><br><span class="line">  String simplePrefixForSuffix = wellKnownSimplePrefixes.get(<span class="keyword">this</span>.placeholderSuffix);</span><br><span class="line">  <span class="keyword">if</span> (simplePrefixForSuffix != <span class="keyword">null</span> &amp;&amp; <span class="keyword">this</span>.placeholderPrefix.endsWith(simplePrefixForSuffix)) &#123;</span><br><span class="line">    <span class="keyword">this</span>.simplePrefix = simplePrefixForSuffix;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">this</span>.simplePrefix = <span class="keyword">this</span>.placeholderPrefix;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">this</span>.valueSeparator = valueSeparator;</span><br><span class="line">  <span class="keyword">this</span>.ignoreUnresolvablePlaceholders = ignoreUnresolvablePlaceholders;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å°± PropertySourcesPropertyResolver è€Œè¨€ï¼Œå…¶çˆ¶ç±» AbstractPropertyResolver å·²ç»å¯¹ä¸Šè¿°å››ä¸ªå€¼åšäº†å®šä¹‰ï¼šplaceholderPrefix ä¸º <code>$&#123;</code>ï¼ŒplaceholderSuffix ä¸º <code>&#125;</code>ï¼ŒvalueSeparator ä¸º <code>:</code>ï¼ŒignoreUnresolvablePlaceholders é»˜è®¤ä¸º falseï¼Œå½“ç„¶æˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨ç›¸åº”çš„ setter æ–¹æ³•è‡ªå®šä¹‰ã€‚</p>
<p>è°ƒç”¨ PropertyPlaceholderHelper çš„ <code>replacePlaceholders()</code> å¯¹å ä½ç¬¦è¿›è¡Œå¤„ç†ï¼Œè¯¥æ–¹æ³•æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼Œä¸€ä¸ªæ˜¯å¾…è§£æçš„å­—ç¬¦ä¸² value ï¼Œä¸€ä¸ªæ˜¯ PlaceholderResolver ç±»å‹çš„ placeholderResolverï¼Œä»–æ˜¯å®šä¹‰å ä½ç¬¦è§£æçš„ç­–ç•¥ç±»ã€‚å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">replacePlaceholders</span><span class="params">(String value, PlaceholderResolver placeholderResolver)</span> </span>&#123;</span><br><span class="line">  Assert.notNull(value, <span class="string">&quot;&#x27;value&#x27; must not be null&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> parseStringValue(value, placeholderResolver, <span class="keyword">new</span> HashSet&lt;&gt;());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å†…éƒ¨å§”æ‰˜ç»™ <code>parseStringValue()</code> å®ç°ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> String <span class="title">parseStringValue</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">  String value, PlaceholderResolver placeholderResolver, Set&lt;String&gt; visitedPlaceholders)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  StringBuilder result = <span class="keyword">new</span> StringBuilder(value);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æ£€ç´¢å‰ç¼€ï¼Œ$&#123;</span></span><br><span class="line">  <span class="keyword">int</span> startIndex = value.indexOf(<span class="keyword">this</span>.placeholderPrefix);</span><br><span class="line">  <span class="keyword">while</span> (startIndex != -<span class="number">1</span>) &#123;</span><br><span class="line">    <span class="comment">// æ£€ç´¢åç¼€ ,&#125;</span></span><br><span class="line">    <span class="keyword">int</span> endIndex = findPlaceholderEndIndex(result, startIndex);</span><br><span class="line">    <span class="keyword">if</span> (endIndex != -<span class="number">1</span>) &#123;</span><br><span class="line">      <span class="comment">// å‰ç¼€å’Œåç¼€ä¹‹é—´çš„å­—ç¬¦ä¸²</span></span><br><span class="line">      String placeholder = result.substring(startIndex + <span class="keyword">this</span>.placeholderPrefix.length(), endIndex);</span><br><span class="line">      String originalPlaceholder = placeholder;</span><br><span class="line">      <span class="comment">// å¾ªç¯å ä½ç¬¦</span></span><br><span class="line">      <span class="comment">// åˆ¤æ–­è¯¥å ä½ç¬¦æ˜¯å¦å·²ç»å¤„ç†äº†</span></span><br><span class="line">      <span class="keyword">if</span> (!visitedPlaceholders.add(originalPlaceholder)) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(</span><br><span class="line">          <span class="string">&quot;Circular placeholder reference &#x27;&quot;</span> + originalPlaceholder + <span class="string">&quot;&#x27; in property definitions&quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// é€’å½’è°ƒç”¨ï¼Œè§£æå ä½ç¬¦</span></span><br><span class="line">      placeholder = parseStringValue(placeholder, placeholderResolver, visitedPlaceholders);</span><br><span class="line">      <span class="comment">// è·å–å€¼</span></span><br><span class="line">      String propVal = placeholderResolver.resolvePlaceholder(placeholder);</span><br><span class="line">      <span class="comment">// propval ä¸ºç©ºï¼Œåˆ™æå–é»˜è®¤å€¼</span></span><br><span class="line">      <span class="keyword">if</span> (propVal == <span class="keyword">null</span> &amp;&amp; <span class="keyword">this</span>.valueSeparator != <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">int</span> separatorIndex = placeholder.indexOf(<span class="keyword">this</span>.valueSeparator);</span><br><span class="line">        <span class="keyword">if</span> (separatorIndex != -<span class="number">1</span>) &#123;</span><br><span class="line">          String actualPlaceholder = placeholder.substring(<span class="number">0</span>, separatorIndex);</span><br><span class="line">          String defaultValue = placeholder.substring(separatorIndex + <span class="keyword">this</span>.valueSeparator.length());</span><br><span class="line">          propVal = placeholderResolver.resolvePlaceholder(actualPlaceholder);</span><br><span class="line">          <span class="keyword">if</span> (propVal == <span class="keyword">null</span>) &#123;</span><br><span class="line">            propVal = defaultValue;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (propVal != <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="comment">// é€’å½’è°ƒç”¨ï¼Œè§£æå…ˆå‰è§£æçš„å ä½ç¬¦å€¼ä¸­åŒ…å«çš„å ä½ç¬¦</span></span><br><span class="line">        propVal = parseStringValue(propVal, placeholderResolver, visitedPlaceholders);</span><br><span class="line">        result.replace(startIndex, endIndex + <span class="keyword">this</span>.placeholderSuffix.length(), propVal);</span><br><span class="line">        <span class="keyword">if</span> (logger.isTraceEnabled()) &#123;</span><br><span class="line">          logger.trace(<span class="string">&quot;Resolved placeholder &#x27;&quot;</span> + placeholder + <span class="string">&quot;&#x27;&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        startIndex = result.indexOf(<span class="keyword">this</span>.placeholderPrefix, startIndex + propVal.length());</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">this</span>.ignoreUnresolvablePlaceholders) &#123;</span><br><span class="line">        <span class="comment">// Proceed with unprocessed value.</span></span><br><span class="line">        startIndex = result.indexOf(<span class="keyword">this</span>.placeholderPrefix, endIndex + <span class="keyword">this</span>.placeholderSuffix.length());</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">&quot;Could not resolve placeholder &#x27;&quot;</span> +</span><br><span class="line">                                           placeholder + <span class="string">&quot;&#x27;&quot;</span> + <span class="string">&quot; in value \&quot;&quot;</span> + value + <span class="string">&quot;\&quot;&quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">//</span></span><br><span class="line">      visitedPlaceholders.remove(originalPlaceholder);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">      startIndex = -<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> result.toString();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å…¶å®å°±æ˜¯è·å–å ä½ç¬¦ <code>$&#123;&#125;</code> ä¸­é—´çš„å€¼ï¼Œè¿™é‡Œé¢ä¼šæ¶‰åŠåˆ°ä¸€ä¸ªé€’å½’çš„è¿‡ç¨‹ï¼Œå› ä¸ºå¯èƒ½ä¼šå­˜åœ¨è¿™ç§æƒ…å†µ <code>$&#123;$&#123;name&#125;&#125;</code>ã€‚</p>
<p><strong>convertValueIfNecessary()</strong></p>
<p>è¯¥æ–¹æ³•æ˜¯ä¸æ˜¯æ„Ÿè§‰åˆ°éå¸¸çš„ç†Ÿæ‚‰ï¼Œè¯¥æ–¹æ³•å°±æ˜¯å®Œæˆç±»å‹è½¬æ¢çš„ã€‚å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">protected</span> &lt;T&gt; <span class="function">T <span class="title">convertValueIfNecessary</span><span class="params">(Object value, <span class="meta">@Nullable</span> Class&lt;T&gt; targetType)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (targetType == <span class="keyword">null</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> (T) value;</span><br><span class="line">  &#125;</span><br><span class="line">  ConversionService conversionServiceToUse = <span class="keyword">this</span>.conversionService;</span><br><span class="line">  <span class="keyword">if</span> (conversionServiceToUse == <span class="keyword">null</span>) &#123;</span><br><span class="line">    <span class="comment">// Avoid initialization of shared DefaultConversionService if</span></span><br><span class="line">    <span class="comment">// no standard type conversion is needed in the first place...</span></span><br><span class="line">    <span class="keyword">if</span> (ClassUtils.isAssignableValue(targetType, value)) &#123;</span><br><span class="line">      <span class="keyword">return</span> (T) value;</span><br><span class="line">    &#125;</span><br><span class="line">    conversionServiceToUse = DefaultConversionService.getSharedInstance();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> conversionServiceToUse.convert(value, targetType);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é¦–å…ˆè·å–ç±»å‹è½¬æ¢æœåŠ¡ conversionService ï¼Œè‹¥ä¸ºç©ºï¼Œåˆ™åˆ¤æ–­æ˜¯å¦å¯ä»¥é€šè¿‡åå°„æ¥è®¾ç½®ï¼Œå¦‚æœå¯ä»¥åˆ™ç›´æ¥å¼ºè½¬è¿”å›ï¼Œå¦åˆ™æ„é€ ä¸€ä¸ª DefaultConversionService å®ä¾‹ï¼Œæœ€åè°ƒç”¨å…¶ <code>convert()</code> å®Œæˆç±»å‹è½¬æ¢ï¼Œåç»­å°±æ˜¯ Spring ç±»å‹è½¬æ¢ä½“ç³»çš„äº‹æƒ…äº†ï¼Œå¦‚æœå¯¹å…¶ä¸äº†è§£ï¼Œå¯ä»¥å‚è€ƒå°ç¼–è¿™ç¯‡åšå®¢ï¼š<a href="/2020/01/24/683bb448.html">IOC ä¹‹æ·±å…¥åˆ†æ Bean çš„ç±»å‹è½¬æ¢ä½“ç³»</a></p>
<h2 id="Environment"><a href="#Environment" class="headerlink" title="Environment"></a>Environment</h2><blockquote>
<p>è¡¨ç¤ºå½“å‰åº”ç”¨ç¨‹åºæ­£åœ¨è¿è¡Œçš„ç¯å¢ƒ</p>
</blockquote>
<p>åº”ç”¨ç¨‹åºçš„ç¯å¢ƒæœ‰ä¸¤ä¸ªå…³é”®æ–¹é¢ï¼šprofile å’Œ propertiesã€‚</p>
<ul>
<li>properties çš„æ–¹æ³•ç”± PropertyResolver å®šä¹‰ã€‚</li>
<li>profile åˆ™è¡¨ç¤ºå½“å‰çš„è¿è¡Œç¯å¢ƒï¼Œå¯¹äºåº”ç”¨ç¨‹åºä¸­çš„ properties è€Œè¨€ï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰çš„éƒ½ä¼šåŠ è½½åˆ°ç³»ç»Ÿä¸­ï¼Œåªæœ‰å…¶å±æ€§ä¸ profile ä¸€ç›´æ‰ä¼šè¢«æ¿€æ´»åŠ è½½ï¼Œ</li>
</ul>
<p>æ‰€ä»¥ Environment å¯¹è±¡çš„ä½œç”¨æ˜¯ç¡®å®šå“ªäº›é…ç½®æ–‡ä»¶ï¼ˆå¦‚æœæœ‰ï¼‰å½“å‰å¤„äºæ´»åŠ¨çŠ¶æ€ï¼Œä»¥åŠé»˜è®¤æƒ…å†µä¸‹å“ªäº›é…ç½®æ–‡ä»¶ï¼ˆå¦‚æœæœ‰ï¼‰åº”å¤„äºæ´»åŠ¨çŠ¶æ€ã€‚properties åœ¨å‡ ä¹æ‰€æœ‰åº”ç”¨ç¨‹åºä¸­éƒ½å‘æŒ¥ç€é‡è¦ä½œç”¨ï¼Œå¹¶ä¸”æœ‰å¤šç§æ¥æºï¼šå±æ€§æ–‡ä»¶ï¼ŒJVM ç³»ç»Ÿå±æ€§ï¼Œç³»ç»Ÿç¯å¢ƒå˜é‡ï¼ŒJNDIï¼Œservlet ä¸Šä¸‹æ–‡å‚æ•°ï¼Œad-hoc å±æ€§å¯¹è±¡ï¼Œæ˜ å°„ç­‰ã€‚åŒæ—¶å®ƒç»§æ‰¿ PropertyResolver æ¥å£ï¼Œæ‰€ä»¥ä¸å±æ€§ç›¸å…³çš„ Environment å¯¹è±¡å…¶ä¸»è¦æ˜¯ä¸ºç”¨æˆ·æä¾›æ–¹ä¾¿çš„æœåŠ¡æ¥å£ï¼Œç”¨äºé…ç½®å±æ€§æºå’Œä»ä¸­å±æ€§æºä¸­è§£æå±æ€§ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Environment</span> <span class="keyword">extends</span> <span class="title">PropertyResolver</span> </span>&#123;</span><br><span class="line">    <span class="comment">// è¿”å›æ­¤ç¯å¢ƒä¸‹æ¿€æ´»çš„é…ç½®æ–‡ä»¶é›†</span></span><br><span class="line">    String[] getActiveProfiles();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¦‚æœæœªè®¾ç½®æ¿€æ´»é…ç½®æ–‡ä»¶ï¼Œåˆ™è¿”å›é»˜è®¤çš„æ¿€æ´»çš„é…ç½®æ–‡ä»¶é›†</span></span><br><span class="line">    String[] getDefaultProfiles();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">acceptsProfiles</span><span class="params">(String... profiles)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Environment ä½“ç³»ç»“æ„å›¾å¦‚ä¸‹ï¼š</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://gitee.com/cayzlh/img-repo/raw/master/2020/05/27/15403714670613_02ZL9z_ul8OAy.jpg" alt="img"></p>
<ul>
<li>PropertyResolverï¼šæä¾›å±æ€§è®¿é—®åŠŸèƒ½</li>
<li>Environmentï¼šæä¾›è®¿é—®å’Œåˆ¤æ–­ profiles çš„åŠŸèƒ½</li>
<li>ConfigurableEnvironmentï¼šæä¾›è®¾ç½®æ¿€æ´»çš„ profile å’Œé»˜è®¤çš„ profile çš„åŠŸèƒ½ä»¥åŠæ“ä½œ Properties çš„å·¥å…·</li>
<li>ConfigurableWebEnvironmentï¼šæä¾›é…ç½® Servlet ä¸Šä¸‹æ–‡å’Œ Servlet å‚æ•°çš„åŠŸèƒ½</li>
<li>AbstractEnvironmentï¼šå®ç°äº† ConfigurableEnvironment æ¥å£ï¼Œé»˜è®¤å±æ€§å’Œå­˜å‚¨å®¹å™¨çš„å®šä¹‰ï¼Œå¹¶ä¸”å®ç°äº† ConfigurableEnvironment çš„æ–¹æ³•ï¼Œå¹¶ä¸”ä¸ºå­ç±»é¢„ç•™å¯è¦†ç›–äº†æ‰©å±•æ–¹æ³•</li>
<li>StandardEnvironmentï¼šç»§æ‰¿è‡ª AbstractEnvironment ï¼Œé Servlet(Web) ç¯å¢ƒä¸‹çš„æ ‡å‡† Environment å®ç°</li>
<li>StandardServletEnvironmentï¼šç»§æ‰¿è‡ª StandardEnvironment ï¼ŒServlet(Web) ç¯å¢ƒä¸‹çš„æ ‡å‡† Environment å®ç°</li>
</ul>
<h3 id="ConfigurableEnvironment"><a href="#ConfigurableEnvironment" class="headerlink" title="ConfigurableEnvironment"></a>ConfigurableEnvironment</h3><blockquote>
<p>æä¾›è®¾ç½®æ¿€æ´»çš„ profile å’Œé»˜è®¤çš„ profile çš„åŠŸèƒ½ä»¥åŠæ“ä½œ Properties çš„å·¥å…·</p>
</blockquote>
<p>è¯¥ç±»é™¤äº†ç»§æ‰¿ Environment æ¥å£å¤–è¿˜ç»§æ‰¿äº† ConfigurablePropertyResolver æ¥å£ï¼Œæ‰€ä»¥å®ƒå³å…·å¤‡äº†è®¾ç½® profile çš„åŠŸèƒ½ä¹Ÿå…·å¤‡äº†æ“ä½œ Properties çš„åŠŸèƒ½ã€‚åŒæ—¶è¿˜å…è®¸å®¢æˆ·ç«¯é€šè¿‡å®ƒè®¾ç½®å’ŒéªŒè¯æ‰€éœ€è¦çš„å±æ€§ï¼Œè‡ªå®šä¹‰è½¬æ¢æœåŠ¡ç­‰åŠŸèƒ½ã€‚å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ConfigurableEnvironment</span> <span class="keyword">extends</span> <span class="title">Environment</span>, <span class="title">ConfigurablePropertyResolver</span> </span>&#123;</span><br><span class="line">    <span class="comment">// æŒ‡å®šè¯¥ç¯å¢ƒä¸‹çš„ profile é›†</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">setActiveProfiles</span><span class="params">(String... profiles)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¢åŠ æ­¤ç¯å¢ƒçš„ profile</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">addActiveProfile</span><span class="params">(String profile)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è®¾ç½®é»˜è®¤çš„ profile</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">setDefaultProfiles</span><span class="params">(String... profiles)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¿”å›æ­¤ç¯å¢ƒçš„ PropertySources</span></span><br><span class="line">    <span class="function">MutablePropertySources <span class="title">getPropertySources</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">   <span class="comment">// å°è¯•è¿”å› System.getenv() çš„å€¼ï¼Œè‹¥å¤±è´¥åˆ™è¿”å›é€šè¿‡ System.getenv(string) çš„æ¥è®¿é—®å„ä¸ªé”®çš„æ˜ å°„</span></span><br><span class="line">    <span class="function">Map&lt;String, Object&gt; <span class="title">getSystemEnvironment</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å°è¯•è¿”å› System.getProperties() çš„å€¼ï¼Œè‹¥å¤±è´¥åˆ™è¿”å›é€šè¿‡ System.getProperties(string) çš„æ¥è®¿é—®å„ä¸ªé”®çš„æ˜ å°„</span></span><br><span class="line">    <span class="function">Map&lt;String, Object&gt; <span class="title">getSystemProperties</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">merge</span><span class="params">(ConfigurableEnvironment parent)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="AbstractEnvironment"><a href="#AbstractEnvironment" class="headerlink" title="AbstractEnvironment"></a>AbstractEnvironment</h3><blockquote>
<p>Environment çš„åŸºç¡€å®ç°</p>
</blockquote>
<p>å…è®¸é€šè¿‡è®¾ç½® ACTIVE_PROFILES_PROPERTY_NAME å’ŒDEFAULT_PROFILES_PROPERTY_NAME å±æ€§æŒ‡å®šæ´»åŠ¨å’Œé»˜è®¤é…ç½®æ–‡ä»¶ã€‚å­ç±»çš„ä¸»è¦åŒºåˆ«åœ¨äºå®ƒä»¬é»˜è®¤æ·»åŠ çš„ PropertySource å¯¹è±¡ã€‚è€Œ AbstractEnvironment åˆ™æ²¡æœ‰æ·»åŠ ä»»ä½•å†…å®¹ã€‚å­ç±»åº”è¯¥é€šè¿‡å—ä¿æŠ¤çš„ <code>customizePropertySources(MutablePropertySources)</code> é’©å­æä¾›å±æ€§æºï¼Œè€Œå®¢æˆ·ç«¯åº”è¯¥ä½¿ç”¨<code>ConfigurableEnvironment.getPropertySources()</code>è¿›è¡Œè‡ªå®šä¹‰å¹¶å¯¹MutablePropertySources APIè¿›è¡Œæ“ä½œã€‚</p>
<p>åœ¨ AbstractEnvironment æœ‰ä¸¤å¯¹å˜é‡ï¼Œè¿™ä¸¤å¯¹å˜é‡ç»´æŠ¤ç€æ¿€æ´»å’Œé»˜è®¤é…ç½® profileã€‚å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String ACTIVE_PROFILES_PROPERTY_NAME = <span class="string">&quot;spring.profiles.active&quot;</span>;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> Set&lt;String&gt; activeProfiles = <span class="keyword">new</span> LinkedHashSet&lt;&gt;();</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String DEFAULT_PROFILES_PROPERTY_NAME = <span class="string">&quot;spring.profiles.default&quot;</span>;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> Set&lt;String&gt; defaultProfiles = <span class="keyword">new</span> LinkedHashSet&lt;&gt;(getReservedDefaultProfiles());</span><br></pre></td></tr></table></figure>

<p>ç”±äºå®ç°æ–¹æ³•è¾ƒå¤šï¼Œè¿™é‡Œåªå…³æ³¨ä¸¤ä¸ªæ–¹æ³•ï¼š<code>setActiveProfiles()</code> å’Œ <code>getActiveProfiles()</code>ã€‚</p>
<p><strong>setActiveProfiles()</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setActiveProfiles</span><span class="params">(String... profiles)</span> </span>&#123;</span><br><span class="line">  Assert.notNull(profiles, <span class="string">&quot;Profile array must not be null&quot;</span>);</span><br><span class="line">  <span class="keyword">if</span> (logger.isDebugEnabled()) &#123;</span><br><span class="line">    logger.debug(<span class="string">&quot;Activating profiles &quot;</span> + Arrays.asList(profiles));</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">synchronized</span> (<span class="keyword">this</span>.activeProfiles) &#123;</span><br><span class="line">    <span class="keyword">this</span>.activeProfiles.clear();</span><br><span class="line">    <span class="keyword">for</span> (String profile : profiles) &#123;</span><br><span class="line">      validateProfile(profile);</span><br><span class="line">      <span class="keyword">this</span>.activeProfiles.add(profile);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¯¥æ–¹æ³•å…¶å®å°±æ˜¯æ“ä½œ activeProfiles é›†åˆï¼Œåœ¨æ¯æ¬¡è®¾ç½®ä¹‹å‰éƒ½ä¼šå°†è¯¥é›†åˆæ¸…ç©ºé‡æ–°æ·»åŠ ï¼Œæ·»åŠ ä¹‹å‰è°ƒç”¨ <code>validateProfile()</code> å¯¹æ·»åŠ çš„ profile è¿›è¡Œæ ¡éªŒï¼Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">validateProfile</span><span class="params">(String profile)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (!StringUtils.hasText(profile)) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">&quot;Invalid profile [&quot;</span> + profile + <span class="string">&quot;]: must contain text&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (profile.charAt(<span class="number">0</span>) == <span class="string">&#x27;!&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">&quot;Invalid profile [&quot;</span> + profile + <span class="string">&quot;]: must not begin with ! operator&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªæ ¡éªŒè¿‡ç¨‹æ¯”è¾ƒå¼±ï¼Œå­ç±»å¯ä»¥æä¾›æ›´åŠ ä¸¥æ ¼çš„æ ¡éªŒè§„åˆ™ã€‚</p>
<p><strong>getActiveProfiles()</strong></p>
<p>ä» <code>getActiveProfiles()</code> ä¸­æˆ‘ä»¬å¯ä»¥çŒœå‡ºè¿™ä¸ªæ–¹æ³•å®ç°çš„é€»è¾‘ï¼šè·å– activeProfiles é›†åˆå³å¯ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> String[] getActiveProfiles() &#123;</span><br><span class="line">  <span class="keyword">return</span> StringUtils.toStringArray(doGetActiveProfiles());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å§”æ‰˜ç»™ <code>doGetActiveProfiles()</code> å®ç°ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> Set&lt;String&gt; <span class="title">doGetActiveProfiles</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">synchronized</span> (<span class="keyword">this</span>.activeProfiles) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.activeProfiles.isEmpty()) &#123;</span><br><span class="line">      String profiles = getProperty(ACTIVE_PROFILES_PROPERTY_NAME);</span><br><span class="line">      <span class="keyword">if</span> (StringUtils.hasText(profiles)) &#123;</span><br><span class="line">        setActiveProfiles(StringUtils.commaDelimitedListToStringArray(</span><br><span class="line">          StringUtils.trimAllWhitespace(profiles)));</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.activeProfiles;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¦‚æœ activeProfiles ä¸ºç©ºï¼Œåˆ™ä» Properties ä¸­è·å– spring.profiles.active é…ç½®ï¼Œå¦‚æœä¸ä¸ºç©ºï¼Œåˆ™è°ƒç”¨ <code>setActiveProfiles()</code> è®¾ç½® profileï¼Œæœ€åè¿”å›ã€‚</p>


<div class="article-footer fs14"><section id="license"><div class="header"><span>License</span></div><div class="body"><p>æœ¬æ–‡é‡‡ç”¨ <a target="_blank" rel="external nofollow noopener noreferrer" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">ç½²å-éå•†ä¸šæ€§ä½¿ç”¨-ç›¸åŒæ–¹å¼å…±äº« 4.0 å›½é™…</a> è®¸å¯åè®®ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚</p>
</div></section></div>

</article>

<div class="related-wrap" id="read-next"><section class="header cap theme"><span>READ NEXT</span></section><section class="body"><div class="post-title h2"><a href="/blog/2020/01/25/86c712d3.html">IOCä¹‹BeanDefinitionæ³¨å†Œæœºï¼šBeanDefinitionRegistry</a></div><div class="post-title fs14"><a href="/blog/2020/01/26/90c034e1.html">or prev: IOCä¹‹åˆ†æbeançš„ç”Ÿå‘½å‘¨æœŸ</a></div></section></div>


<div class="related-wrap" id="related-posts">
    <section class="header">
      <div class="title cap theme">Related Posts</div>
    </section>
    <section class="body">
    <div class="related-posts"><a class="item" href="/blog/2020/01/26/101fc769.html" title="4å¼ å›¾å¸¦ä½ è¯»æ‡‚Spring IOCçš„ä¸–ç•Œ"><div class="img"><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/cayzlh/git-img-repository@master/2020/05/28/spring-201901311001_BJamFt.jpg"></div><span class="title">4å¼ å›¾å¸¦ä½ è¯»æ‡‚Spring IOCçš„ä¸–ç•Œ</span><span class="excerpt">4å¼ å›¾å¸¦ä½ è¯»æ‡‚Spring IOCçš„ä¸–ç•Œ.</span></a><a class="item" href="/blog/2020/01/26/ea3a33da.html" title="æ·±å…¥åˆ†æApplicationContextçš„refresh()"><div class="img"><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/cdn-x/placeholder@1.0.1/cover/76b86c0226ffd.svg"></div><span class="title">æ·±å…¥åˆ†æApplicationContextçš„refresh()</span><span class="excerpt">åˆ†æSpringï¼ŒApplicationContextçš„refresh()æ–¹æ³•</span></a><a class="item" href="/blog/2020/01/26/1a84ff95.html" title="ApplicationContextç›¸å…³æ¥å£æ¶æ„åˆ†æ"><div class="img"><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/cayzlh/git-img-repository@master/2020/05/28/15409479819725_t0jF0z_flFIsn.jpg"></div><span class="title">ApplicationContextç›¸å…³æ¥å£æ¶æ„åˆ†æ</span><span class="excerpt">Springçš„ApplicationContextç›¸å…³æ¥å£çš„æ¶æ„åˆ†æ</span></a><a class="item" href="/blog/2020/01/26/90c034e1.html" title="IOCä¹‹åˆ†æbeançš„ç”Ÿå‘½å‘¨æœŸ"><div class="img"><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/cayzlh/git-img-repository@master/2020/05/28/15359386381747_wNxvJ5_Lyaby1.jpg"></div><span class="title">IOCä¹‹åˆ†æbeançš„ç”Ÿå‘½å‘¨æœŸ</span><span class="excerpt">åˆ†æSpring Beançš„ç”Ÿå‘½å‘¨æœŸ</span></a><a class="item" href="/blog/2020/01/27/9cf21717.html" title="Spring AOPå’ŒSpring Transactionæºç èµ„æ–™æ•´ç†"><div class="img"><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/cdn-x/placeholder@1.0.1/cover/76b86c0226ffd.svg"></div><span class="title">Spring AOPå’ŒSpring Transactionæºç èµ„æ–™æ•´ç†</span><span class="excerpt">æ•´ç†å­¦ä¹ AOPæºç çš„ç›¸å…³èµ„æ–™</span></a></div></section></div>





      
<footer class="page-footer fs12"><hr><div><p>All articles in this blog are licensed under <a target="_blank" rel="external nofollow noopener noreferrer" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</p>
<p>This site was deployed by <a href="https://www.cayzlh.com/blog/">@ğŸ³Antä¸¶</a> using <a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/xaoxuu/hexo-theme-stellar/tree/1.1.0">Stellar</a>.</p>
</div></footer>

      <div class="float-panel mobile-only" style="display:none">
  <button type="button" class="sidebar-toggle mobile" onclick="sidebar.toggle()">
    <svg class="icon" viewbox="0 0 1228 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2849"><path d="M0 0m97.390199 0l973.901995 0q97.390199 0 97.390199 97.390199l0 0q0 97.390199-97.390199 97.3902l-973.901995 0q-97.390199 0-97.390199-97.3902l0 0q0-97.390199 97.390199-97.390199Z" p-id="2850"/><path d="M0 389.560798m97.390199 0l973.901995 0q97.390199 0 97.390199 97.390199l0 0q0 97.390199-97.390199 97.3902l-973.901995 0q-97.390199 0-97.390199-97.3902l0 0q0-97.390199 97.390199-97.390199Z" p-id="2851"/><path d="M0 779.121596m97.390199 0l973.901995 0q97.390199 0 97.390199 97.390199l0 0q0 97.390199-97.390199 97.390199l-973.901995 0q-97.390199 0-97.390199-97.390199l0 0q0-97.390199 97.390199-97.390199Z" p-id="2852"/></svg>
  </button>
</div>

    </div>
  </div>
  <div class="scripts">
    <script type="text/javascript">
  stellar = {
    // æ‡’åŠ è½½ css https://github.com/filamentgroup/loadCSS
    loadCSS: (href, before, media, attributes) => {
      var doc = window.document;
      var ss = doc.createElement("link");
      var ref;
      if (before) {
        ref = before;
      } else {
        var refs = (doc.body || doc.getElementsByTagName("head")[0]).childNodes;
        ref = refs[refs.length - 1];
      }
      var sheets = doc.styleSheets;
      if (attributes) {
        for (var attributeName in attributes) {
          if (attributes.hasOwnProperty(attributeName)) {
            ss.setAttribute(attributeName, attributes[attributeName]);
          }
        }
      }
      ss.rel = "stylesheet";
      ss.href = href;
      ss.media = "only x";
      function ready(cb) {
        if (doc.body) {
          return cb();
        }
        setTimeout(function () {
          ready(cb);
        });
      }
      ready(function () {
        ref.parentNode.insertBefore(ss, before ? ref : ref.nextSibling);
      });
      var onloadcssdefined = function (cb) {
        var resolvedHref = ss.href;
        var i = sheets.length;
        while (i--) {
          if (sheets[i].href === resolvedHref) {
            return cb();
          }
        }
        setTimeout(function () {
          onloadcssdefined(cb);
        });
      };
      function loadCB() {
        if (ss.addEventListener) {
          ss.removeEventListener("load", loadCB);
        }
        ss.media = media || "all";
      }
      if (ss.addEventListener) {
        ss.addEventListener("load", loadCB);
      }
      ss.onloadcssdefined = onloadcssdefined;
      onloadcssdefined(loadCB);
      return ss;
    },

    // ä» butterfly å’Œ volantis è·å¾—çµæ„Ÿ
    loadScript: (src, opt) => new Promise((resolve, reject) => {
      var script = document.createElement('script')
      script.src = src
      if (opt) {
        for (let key of Object.keys(opt)) {
          script[key] = opt[key]
        }
      } else {
        // é»˜è®¤å¼‚æ­¥ï¼Œå¦‚æœéœ€è¦åŒæ­¥ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¼ å…¥ {} å³å¯
        script.async = true
      }
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    }),

    // https://github.com/jerryc127/hexo-theme-butterfly
    jQuery: (fn) => {
      if (typeof jQuery === 'undefined') {
        stellar.loadScript(stellar.plugins.jQuery).then(fn)
      } else {
        fn()
      }
    }
  };
  stellar.github = 'https://github.com/xaoxuu/hexo-theme-stellar/tree/1.1.0';
  stellar.config = {
    date_suffix: {
      just: 'Just',
      min: 'minutes ago',
      hour: 'hours ago',
      day: 'days ago',
      month: 'months ago',
    },
  };

  // required plugins (only load if needs)
  stellar.plugins = {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js',
    sitesjs: '/blog/js/plugins/sites.js',
    friendsjs: '/blog/js/plugins/friends.js',
  };

  // optional plugins
  if ('true' == 'true') {
    stellar.plugins.lazyload = Object.assign({"enable":true,"js":"https://cdn.jsdelivr.net/npm/vanilla-lazyload@17.3.1/dist/lazyload.min.js","transition":"blur"});
  }
  if ('true' == 'true') {
    stellar.plugins.swiper = Object.assign({"enable":true,"css":"https://unpkg.com/swiper/swiper-bundle.min.css","js":"https://unpkg.com/swiper/swiper-bundle.min.js"});
  }
  if ('' == 'true') {
    stellar.plugins.scrollreveal = Object.assign({"enable":null,"js":"https://cdn.jsdelivr.net/npm/scrollreveal@4.0.9/dist/scrollreveal.min.js","distance":"8px","duration":500,"interval":100,"scale":1});
  }
  if ('true' == 'true') {
    stellar.plugins.preload = Object.assign({"enable":true,"service":"flying_pages","instant_page":"https://cdn.jsdelivr.net/gh/volantis-x/cdn-volantis@4.1.2/js/instant_page.js","flying_pages":"https://cdn.jsdelivr.net/gh/gijo-varghese/flying-pages@2.1.2/flying-pages.min.js"});
  }
</script>

<!-- required -->

  
<script src="/blog/js/main.js" async></script>



<!-- optional -->



<!-- inject -->


  </div>
</body>
</html>
