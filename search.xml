<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>HomeBrewæ¢æº</title>
      <link href="post/20210402/"/>
      <url>post/20210402/</url>
      
        <content type="html"><![CDATA[<h3 id="èµ·å› "><a href="#èµ·å› " class="headerlink" title="èµ·å› "></a>èµ·å› </h3><p>æƒ³å®‰è£…<code>yarn</code>ï¼Œäºæ˜¯æ‰§è¡Œï¼š</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">brew install yarn</span><br></pre></td></tr></table></figure><p>ç»“æœï¼š</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">Error: </span><br><span class="line">  homebrew-core is a shallow <span class="built_in">clone</span>.</span><br><span class="line">  homebrew-cask is a shallow <span class="built_in">clone</span>.</span><br><span class="line">To `brew update`, first run:</span><br><span class="line">  git -C /usr/<span class="built_in">local</span>/Homebrew/Library/Taps/homebrew/homebrew-core fetch --unshallow</span><br><span class="line">  git -C /usr/<span class="built_in">local</span>/Homebrew/Library/Taps/homebrew/homebrew-cask fetch --unshallow</span><br><span class="line">This restriction has been made on GitHub<span class="string">&#x27;s request because updating shallow</span></span><br><span class="line"><span class="string">clones is an extremely expensive operation due to the tree layout and traffic of</span></span><br><span class="line"><span class="string">Homebrew/homebrew-core and Homebrew/homebrew-cask. We don&#x27;</span>t <span class="keyword">do</span> this <span class="keyword">for</span> you</span><br><span class="line">automatically to avoid repeatedly performing an expensive unshallow operation <span class="keyword">in</span></span><br><span class="line">CI systems (<span class="built_in">which</span> should instead be fixed to not use shallow clones). Sorry <span class="keyword">for</span></span><br><span class="line">the inconvenience!</span><br></pre></td></tr></table></figure><p>æŒ‰ç…§æç¤ºæ‰§è¡Œï¼š</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git -C /usr/<span class="built_in">local</span>/Homebrew/Library/Taps/homebrew/homebrew-core fetch --unshallow</span><br></pre></td></tr></table></figure><p>æ¥ç€æç¤ºï¼š</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">fatal: æ— æ³•è®¿é—® <span class="string">&#x27;https://github.com/Homebrew/homebrew-core/&#x27;</span>ï¼š</span><br><span class="line">Failed to connect to github.com port 443: Operation timed out</span><br></pre></td></tr></table></figure><p><code>github</code>çš„è®¿é—®è¢«ç¥ç§˜åŠ›é‡æ‹’ç»äº†ï¼Œæ“ä½œè¶…æ—¶ã€‚</p><h3 id="æ¢æº"><a href="#æ¢æº" class="headerlink" title="æ¢æº"></a>æ¢æº</h3><blockquote><p>ä¸ºè§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå†³å®šæ¢æºã€‚<a href="https://mirrors.ustc.edu.cn/help/">USTC Mirror å¸®åŠ©æ–‡æ¡£</a></p></blockquote><h4 id="æ›¿æ¢Homebrew-Core-æº"><a href="#æ›¿æ¢Homebrew-Core-æº" class="headerlink" title="æ›¿æ¢Homebrew Core æº"></a>æ›¿æ¢Homebrew Core æº</h4><p>æ›¿æ¢ USTC é•œåƒï¼š</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> <span class="string">&quot;<span class="subst">$(brew --repo)</span>/Library/Taps/homebrew/homebrew-core&quot;</span></span><br><span class="line">git remote set-url origin https://mirrors.ustc.edu.cn/homebrew-core.git</span><br></pre></td></tr></table></figure><p>é‡ç½®ä¸ºå®˜æ–¹åœ°å€ï¼š</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> <span class="string">&quot;<span class="subst">$(brew --repo)</span>/Library/Taps/homebrew/homebrew-core&quot;</span></span><br><span class="line">git remote set-url origin https://github.com/Homebrew/homebrew-core</span><br></pre></td></tr></table></figure><h4 id="æ›¿æ¢Homebrew-Cask-æº"><a href="#æ›¿æ¢Homebrew-Cask-æº" class="headerlink" title="æ›¿æ¢Homebrew Cask æº"></a>æ›¿æ¢Homebrew Cask æº</h4><p>æ›¿æ¢USTCé•œåƒï¼š</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> <span class="string">&quot;<span class="subst">$(brew --repo)</span>&quot;</span>/Library/Taps/homebrew/homebrew-cask</span><br><span class="line">git remote set-url origin https://mirrors.ustc.edu.cn/homebrew-cask.git</span><br></pre></td></tr></table></figure><p>é‡ç½®ä¸ºå®˜æ–¹æºï¼š</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> <span class="string">&quot;<span class="subst">$(brew --repo)</span>&quot;</span>/Library/Taps/homebrew/homebrew-cask</span><br><span class="line">git remote set-url origin https://github.com/Homebrew/homebrew-cask</span><br></pre></td></tr></table></figure><h4 id="æ›¿æ¢Homebrew-Cask-Versions-æº"><a href="#æ›¿æ¢Homebrew-Cask-Versions-æº" class="headerlink" title="æ›¿æ¢Homebrew Cask Versions æº"></a>æ›¿æ¢Homebrew Cask Versions æº</h4><p>æ›¿æ¢ä¸º USTC é•œåƒï¼š</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> <span class="string">&quot;<span class="subst">$(brew --repo)</span>&quot;</span>/Library/Taps/homebrew/homebrew-cask-versions</span><br><span class="line">git remote set-url origin https://mirrors.ustc.edu.cn/homebrew-cask-versions.git</span><br></pre></td></tr></table></figure><p>é‡ç½®ä¸ºå®˜æ–¹åœ°å€ï¼š</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> <span class="string">&quot;<span class="subst">$(brew --repo)</span>&quot;</span>/Library/Taps/homebrew/homebrew-cask-versions</span><br><span class="line">git remote set-url origin https://github.com/Homebrew/homebrew-cask-versions.git</span><br></pre></td></tr></table></figure><h4 id="æ›¿æ¢Homebrew-Bottles-æº"><a href="#æ›¿æ¢Homebrew-Bottles-æº" class="headerlink" title="æ›¿æ¢Homebrew Bottles æº"></a>æ›¿æ¢Homebrew Bottles æº</h4><p>è¯´æ˜ï¼š<code>Homebrew</code> é¢„ç¼–è¯‘äºŒè¿›åˆ¶è½¯ä»¶åŒ…</p><p>åœ¨è¿è¡Œ brew å‰è®¾ç½®ç¯å¢ƒå˜é‡ <code>HOMEBREW_BOTTLE_DOMAIN</code> ï¼Œå€¼ä¸º <code>https://mirrors.ustc.edu.cn/homebrew-bottles</code> ã€‚</p><p><strong>å¯¹äºbashç”¨æˆ·</strong></p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;export HOMEBREW_BOTTLE_DOMAIN=https://mirrors.ustc.edu.cn/homebrew-bottles&#x27;</span> &gt;&gt; ~/.bash_profile</span><br><span class="line"><span class="built_in">source</span> ~/.bash_profile</span><br></pre></td></tr></table></figure><p><strong>å¯¹äºzshç”¨æˆ·</strong></p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;export HOMEBREW_BOTTLE_DOMAIN=https://mirrors.ustc.edu.cn/homebrew-bottles&#x27;</span> &gt;&gt; ~/.zshrc</span><br><span class="line"><span class="built_in">source</span> ~/.zshrc</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®°æœ¬ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> macOS </tag>
            
            <tag> HomeBrew </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>mavenå®‰è£…æœ¬åœ°jaråŒ…</title>
      <link href="post/2021031501/"/>
      <url>post/2021031501/</url>
      
        <content type="html"><![CDATA[<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">mvn install:install-file -Dfile=[jar file path] -DgroupId=[groupId] -DartifactId=[artifactId] -Dversion=[version] -Dpackaging=jar</span><br></pre></td></tr></table></figure><p><strong>è¯´æ˜ï¼š</strong></p><ul><li><code>[jar file path]</code>ï¼šjaråŒ…çš„ä½ç½®</li><li><code>[groupId]</code>ï¼šgroupid</li><li><code>[artifactId] </code>ï¼šartifactId</li><li><code>[version]</code>ï¼šç‰ˆæœ¬å·</li></ul>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®°æœ¬ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Maven </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>äºŒæœˆäºŒï¼Œé¾™æŠ¬å¤´</title>
      <link href="post/20210314/"/>
      <url>post/20210314/</url>
      
        <content type="html"><![CDATA[<blockquote><p>2021å¹´3æœˆ14æ—¥ï¼Œå‘¨æ—¥ï¼Œ<strong>19â„ƒ~28â„ƒ</strong> å¤šäº‘</p></blockquote><h2 id="è¸é’"><a href="#è¸é’" class="headerlink" title="è¸é’"></a>è¸é’</h2><p>ä»Šå¤©å¤©æ°”ä¸é”™ï¼Œé€‚åˆè¸é’ã€‚</p><p>å¤§æ—©ä¸Šå¸¦ç€å°ç²½å»å…¬å›­ç©è€ã€‚</p><p><img src="https://7.dusays.com/2021/03/14/c57b7d84eaf49.png" alt="image-20210314173616329"></p><p>ç©æ³¡æ³¡ï¼Œéå¸¸å¼€å¿ƒã€‚</p><h3 id="è¥¿è´ç­±é¢æ‘"><a href="#è¥¿è´ç­±é¢æ‘" class="headerlink" title="è¥¿è´ç­±é¢æ‘"></a>è¥¿è´ç­±é¢æ‘</h3><p>ä¸­åˆï¼Œåœ¨è¥¿è´è§£å†³äº†ä¸€é¡¿ï¼Œç¬¬ä¸€æ¬¡ä¸éœ€è¦æ’é˜Ÿå°±åƒä¸Šè¿™å®¶åº—ã€‚</p><p><img src="https://7.dusays.com/2021/03/14/5797d5a915feb.png" alt="image-20210314173201748"></p><p>ä¸€å®¶è€å°éƒ½åƒçš„å¾ˆæ»¡è¶³ã€‚</p><h2 id="ç†å‘"><a href="#ç†å‘" class="headerlink" title="ç†å‘"></a>ç†å‘</h2><blockquote><p>äºŒæœˆäºŒé¾™æŠ¬å¤´ï¼Œâ€œåš6äº‹3ä¸åšâ€ï¼Œæ²¾é¾™æ°”ï¼Œå†œæ‘è€ä¼ ç»Ÿ</p></blockquote><p>å…¶ä¸­ä¹‹ä¸€çš„å‰ªå¤´å‘ï¼Œå½“ç„¶ä¹Ÿè¦æ’‘ç€è¿™ä¸ªæœºä¼šæŠŠå°ç²½çš„å¤´å‘ç»™ç†äº†ã€‚</p><p>äºŒæœˆäºŒå¯è°“â€œä¸­å›½ä¼ ç»Ÿç†å‘æ—¥â€ï¼Œ æ°‘è°šäº‘â€œäºŒæœˆäºŒå‰ƒé¾™å¤´ï¼Œä¸€å¹´éƒ½æœ‰ç²¾ç¥å¤´â€ã€‚</p><p>æ¸…ä»£ã€Šå¸äº¬å²æ—¶çºªèƒœã€‹ä¸­å†™ï¼Œæ¸…ä»£ç”·å­è–™å‘ï¼ˆè–™åŒâ€œå‰ƒâ€ï¼‰ï¼Œä½†æ­£æœˆæœ‰ä¸åŠ¨åˆ€çš„â€œç¦å¿Œâ€ï¼Œå› æ­¤ï¼Œä¸€åˆ°â€œäºŒæœˆäºŒâ€ï¼Œçš†â€œäºæ˜¯æ—¥æ ‰è–™ï¼Œç›–å–â€˜é¾™æŠ¬å¤´â€™ä¹‹æ„â€ã€‚</p><p>å€Ÿé¾™æŠ¬å¤´ä¹‹å‰æ—¶ï¼Œå­©å­â€œå‰ƒå–œå¤´â€ï¼Œå¥åº·é•¿å¤§ï¼Œå‡ºäººå¤´åœ°ï¼Œå¤§äººâ€œå‰ƒé¾™å¤´â€ï¼Œè¾æ—§è¿æ–°ï¼Œé¸¿è¿å½“å¤´ã€‚</p><p><img src="https://7.dusays.com/2021/03/14/99877695b38e9.png" alt="image-20210314174838807"></p><h3 id="é™„"><a href="#é™„" class="headerlink" title="é™„"></a>é™„</h3><p>åœ¨å…ƒå®µèŠ‚è¿‡åï¼Œæ°‘é—´æœ‰ä¸€ä¸ªé‡è¦èŠ‚æ—¥ï¼Œä¹Ÿå°±æ˜¯â€œäºŒæœˆäºŒé¾™æŠ¬å¤´â€ï¼Œå—æ–¹äººå°†å…¶ç§°ä¸ºè¸é’èŠ‚ï¼ŒåŒ—æ–¹äººç§°ä¸ºé’é¾™èŠ‚ã€‚å¤äººè®¤ä¸ºï¼Œè¿™ä¸€å¤©è¿‡åä¸‡ç‰©å¼€å§‹å¤è‹ï¼Œå¼€å§‹äº†æ˜¥è€•çš„æ—¶å€™ï¼Œé¾™ç‹ä¹Ÿä¼šè‹é†’ï¼Œæ¥åˆ°äººé—´é™é›¨ï¼Œä»è€Œè®©ä¸‡ç‰©å¾—åˆ°æ»‹æ¶¦ï¼Œå¼€å§‹äº†æ˜¥æš–èŠ±å¼€çš„å­£èŠ‚ã€‚</p><p><strong>ä¼ è¯´äºŒæœˆäºŒè¿™å¤©æ˜¯å°§ç‹çš„è¯è¾°ï¼Œç™¾å§“ä»¬éƒ½ä¼šåº†ç¥è¿™ä¸€å¤©ï¼Œä»è€Œç¥ˆç¥·é™é›¨ï¼Œå¸Œæœ›åº„ç¨¼èƒ½å¤Ÿä¸°æ”¶ã€‚è€Œåœ¨å®¢å®¶äººçœ¼é‡Œï¼ŒäºŒæœˆäºŒæ˜¯åœŸåœ°å…¬çš„è¯è¾°ï¼Œè¿™ä¸€å¤©è¦ä¸ºå…¶â€œæš–å¯¿â€ï¼Œæ‘æ°‘ä»¬è¿˜è¦ç­¹é’±è´­ä¹°ç¥­å“ï¼Œä¸ºåœŸåœ°å…¬ç¥­ç¥€ã€‚</strong></p><p>â€œé¾™æŠ¬å¤´â€èµ·æºäºä¼ç¾²æ—¶æœŸï¼Œæ¯å¹´äºŒæœˆäºŒè¿™å¤©éƒ½ä¼šäº²è‡ªè€•ç”°ï¼Œç™¾å§“ä»¬ä¹Ÿä¼šè¿›è¡Œæ•ˆä»¿ï¼Œåˆ°äº†å‘¨æ­¦ç‹æ—¶ï¼Œæ›´æ˜¯å°†å…¶åˆ¶å®šä¸ºå›½ç­–ï¼Œè®©æ–‡æ­¦ç™¾å®˜ä»¬éƒ½è¦åœ¨è¿™ä¸€å¤©äº²è€•ï¼Œåšå¥½æ¦œæ ·åŠ›é‡ã€‚</p><p>å”ä»£æ—¶å¯¹å…¶æ›´ä¸ºé‡è§†ï¼Œçš‡å®«å†…ä¼šä¸¾åŠæŒ‘åˆºæ´»åŠ¨ï¼Œåœ¨å®¹å™¨é‡Œæ ½ç§è”¬èœï¼Œå¹¶å°†åå­—å†™ä¸‹æ¥å‹åœ¨èƒŒåï¼Œè®©å®˜å‘˜çŒœæµ‹ï¼Œä¸­äº†çš‡å¸ä¼šæœ‰å¥–åŠ±ã€‚è€Œåœ¨å…ƒä»£æ—¶ï¼ŒäºŒæœˆäºŒè¢«ç§°ä½œâ€œå°¹é’é¾™â€ï¼Œè¿™ä¸€å¤©ç™¾å§“ä»¬éƒ½ä¼šå‡ºé—¨æŒ‘æ°´ï¼Œåæ¥æ‰æ­£å¼å’Œâ€œé¾™æŠ¬å¤´â€å…³è”èµ·æ¥ã€‚</p><p><strong>æœ‰äººé—®ï¼Œä¸ºä½•è¦å°†â€œäºŒæœˆäºŒâ€è®¤å®šä¸ºé¾™æŠ¬å¤´ä¹‹æ—¥ï¼Ÿå¤äººç”¨28æ˜Ÿå®¿æ¦‚æ‹¬æ˜Ÿè¾°å…·ä½“ä½ç½®ï¼Œä»è€Œé¢„æµ‹æœªæ¥çš„å¤©è±¡å¦‚ä½•ã€‚è€Œåœ¨äºŒæœˆäºŒè¿™å¤©ï¼Œæ˜Ÿå®¿æ„æˆçš„ä¸œæ–¹é’é¾™ä¸­ï¼Œ2ä¸ªè§’ä»ä¸œæ–¹å‡èµ·ï¼Œçœ‹ä¸Šå»å¦‚åŒâ€œé¾™æŠ¬å¤´â€ä¸€æ ·ï¼Œå› æ­¤å¤äººæ‰å°†è¿™å¤©å®šä¹‰ä¸ºé¾™æŠ¬å¤´ï¼Œä¸ºçš„æ˜¯æœ‰å¥½æ”¶æˆã€‚</strong></p>]]></content>
      
      
      <categories>
          
          <category> ç¢ç¢å¿µ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç”Ÿæ´» </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SpringBootå•å…ƒæµ‹è¯•</title>
      <link href="post/1832342668/"/>
      <url>post/1832342668/</url>
      
        <content type="html"><![CDATA[<h2 id="ä¸€ã€-å•å…ƒæµ‹è¯•çš„æ¦‚å¿µ"><a href="#ä¸€ã€-å•å…ƒæµ‹è¯•çš„æ¦‚å¿µ" class="headerlink" title="ä¸€ã€ å•å…ƒæµ‹è¯•çš„æ¦‚å¿µ"></a>ä¸€ã€ å•å…ƒæµ‹è¯•çš„æ¦‚å¿µ</h2><h3 id="æ¦‚å¿µï¼š"><a href="#æ¦‚å¿µï¼š" class="headerlink" title="æ¦‚å¿µï¼š"></a><strong>æ¦‚å¿µï¼š</strong></h3><ol><li>å•å…ƒæµ‹è¯•ï¼ˆunit testingï¼‰ï¼Œæ˜¯æŒ‡å¯¹è½¯ä»¶ä¸­çš„æœ€å°å¯æµ‹è¯•å•å…ƒè¿›è¡Œæ£€æŸ¥å’ŒéªŒè¯ã€‚åœ¨Javaä¸­å•å…ƒæµ‹è¯•çš„æœ€å°å•å…ƒæ˜¯ç±»ã€‚</li><li>å•å…ƒæµ‹è¯•æ˜¯å¼€å‘è€…ç¼–å†™çš„ä¸€å°æ®µä»£ç ï¼Œç”¨äºæ£€éªŒè¢«æµ‹ä»£ç çš„ä¸€ä¸ªå¾ˆå°çš„ã€å¾ˆæ˜ç¡®çš„åŠŸèƒ½æ˜¯å¦æ­£ç¡®ã€‚æ‰§è¡Œå•å…ƒæµ‹è¯•ï¼Œå°±æ˜¯ä¸ºäº†è¯æ˜è¿™ æ®µä»£ç çš„è¡Œä¸ºå’Œæˆ‘ä»¬æœŸæœ›æ˜¯å¦ä¸€è‡´ã€‚</li></ol><h3 id="å•å…ƒæµ‹è¯•å¼•ç”¨ï¼š"><a href="#å•å…ƒæµ‹è¯•å¼•ç”¨ï¼š" class="headerlink" title="å•å…ƒæµ‹è¯•å¼•ç”¨ï¼š"></a><strong>å•å…ƒæµ‹è¯•å¼•ç”¨ï¼š</strong></h3><ol><li>ä¼—æ‰€å‘¨çŸ¥ï¼Œé€šè¿‡spring initializeåˆ›å»ºçš„Spring Booté¡¹ç›®ä¼šåœ¨Mavenä¸­è‡ªåŠ¨æºå¸¦å¾ˆå¤šstarterä¾èµ–ï¼š</li></ol><p><img src="https://cdn.jsdelivr.net/gh/cayzlh/git-img-repository@master/2021/03/14044716155290871615529087504.jpg" alt="å›¾ç‰‡"></p><p>å…¶ä¸­åŒ…å«äº†ä¸€ä¸ªåä¸º<code>spring-boot-starter-test</code>çš„ä¾èµ–ï¼Œæœ¬æ–‡æ˜¯å›´ç»•è¿™ä¸ªä¾èµ–å±•å¼€ã€‚</p><ol><li>Spring Bootä¸­å¼•å…¥å•å…ƒæµ‹è¯•å¾ˆç®€å•ï¼Œæ·»åŠ å¦‚ä¸‹ä¾èµ–ï¼ˆå³<code>spring-boot-starter-test</code>ä¾èµ–ï¼‰ï¼š</li></ol><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">  &lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">  &lt;artifactId&gt;spring-boot-starter-test&lt;&#x2F;artifactId&gt;</span><br><span class="line">  &lt;scope&gt;test&lt;&#x2F;scope&gt;</span><br><span class="line">&lt;&#x2F;dependency&gt;</span><br></pre></td></tr></table></figure><ol><li>spring-boot-starter-testæœ‰å¦‚ä¸‹å‡ ä¸ªåº“ï¼š</li></ol><p><code>spring-boot-starter-test</code>UMLå›¾ï¼š</p><p><img src="https://7.dusays.com/2021/03/12/208e02005c0b7.png" alt="image-20210312142854430"></p><p><img src="https://7.dusays.com/2021/03/12/23696982579aa.png" alt="image-20210312142907488"></p><h2 id="äºŒã€å•å…ƒæµ‹è¯•çš„ä½œç”¨"><a href="#äºŒã€å•å…ƒæµ‹è¯•çš„ä½œç”¨" class="headerlink" title="äºŒã€å•å…ƒæµ‹è¯•çš„ä½œç”¨"></a>äºŒã€å•å…ƒæµ‹è¯•çš„ä½œç”¨</h2><p>åœ¨æ²¡æœ‰æ¥è§¦å•å…ƒæµ‹è¯•ä¹‹å‰æˆ‘ä»¬æ˜¯æ€ä¹ˆåšæµ‹è¯•çš„ï¼Ÿä¸€èˆ¬æœ‰ä¸¤ä¸ªæ–¹æ³•ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/cayzlh/git-img-repository@master/2021/03/14044716155290871615529087678.jpg" alt="å›¾ç‰‡"></p><p>åœ¨æ—¶é—´å…è®¸çš„æƒ…å†µä¸‹ï¼Œç¼–å†™å•å…ƒæµ‹è¯•æ˜¯ç¨‹åºå‘˜å¯¹ä»£ç çš„è‡ªæµ‹ï¼Œè¿™æ˜¯å¯¹è‡ªå·±ä»£ç çš„è´Ÿè´£ã€‚</p><h3 id="å†™å•å…ƒæµ‹è¯•çš„ä¸¤ä¸ªåŠ¨æœºï¼š"><a href="#å†™å•å…ƒæµ‹è¯•çš„ä¸¤ä¸ªåŠ¨æœºï¼š" class="headerlink" title="å†™å•å…ƒæµ‹è¯•çš„ä¸¤ä¸ªåŠ¨æœºï¼š"></a><strong>å†™å•å…ƒæµ‹è¯•çš„ä¸¤ä¸ªåŠ¨æœºï¼š</strong></h3><ol><li>ä¿è¯æˆ–éªŒè¯å®ç°åŠŸèƒ½ã€‚</li><li>ä¿æŠ¤å·²ç»å®ç°çš„åŠŸèƒ½ä¸è¢«ç ´åã€‚</li></ol><h2 id="ä¸‰ã€Spring-Bootå¼•å…¥çš„MockMvcçš„æ¦‚å¿µ"><a href="#ä¸‰ã€Spring-Bootå¼•å…¥çš„MockMvcçš„æ¦‚å¿µ" class="headerlink" title="ä¸‰ã€Spring Bootå¼•å…¥çš„MockMvcçš„æ¦‚å¿µ"></a>ä¸‰ã€Spring Bootå¼•å…¥çš„MockMvcçš„æ¦‚å¿µ</h2><ol><li>ä»€ä¹ˆæ˜¯Mock?</li></ol><p>åœ¨é¢å‘å¯¹è±¡çš„ç¨‹åºè®¾è®¡ä¸­ï¼Œæ¨¡æ‹Ÿå¯¹è±¡ï¼ˆè‹±è¯­ï¼šmock objectï¼‰æ˜¯ä»¥å¯æ§çš„æ–¹å¼æ¨¡æ‹ŸçœŸå®å¯¹è±¡è¡Œä¸ºçš„å‡å¯¹è±¡ã€‚åœ¨ç¼–ç¨‹è¿‡ç¨‹ä¸­ï¼Œé€šå¸¸é€šè¿‡æ¨¡æ‹Ÿä¸€äº›è¾“å…¥æ•°æ®ï¼Œæ¥éªŒè¯ç¨‹åºæ˜¯å¦è¾¾åˆ°é¢„æœŸç»“æœã€‚</p><ol><li>ä¸ºä»€ä¹ˆä½¿ç”¨Mockå¯¹è±¡ï¼Ÿ</li></ol><p>ä½¿ç”¨æ¨¡æ‹Ÿå¯¹è±¡ï¼Œå¯ä»¥æ¨¡æ‹Ÿå¤æ‚çš„ã€çœŸå®çš„å¯¹è±¡è¡Œä¸ºã€‚å¦‚æœåœ¨å•å…ƒæµ‹è¯•ä¸­æ— æ³•ä½¿ç”¨çœŸå®å¯¹è±¡ï¼Œå¯é‡‡ç”¨æ¨¡æ‹Ÿå¯¹è±¡è¿›è¡Œæ›¿ä»£ã€‚</p><ol><li>MockMvcçš„æ¦‚å¿µ</li></ol><p>MockMvcæ˜¯ç”±spring-teståŒ…æä¾›ï¼Œå®ç°äº†å¯¹Httpè¯·æ±‚çš„æ¨¡æ‹Ÿï¼Œèƒ½å¤Ÿç›´æ¥ä½¿ç”¨ç½‘ç»œçš„å½¢å¼ï¼Œè½¬æ¢åˆ°Controllerçš„è°ƒç”¨ï¼Œä½¿å¾—æµ‹è¯•é€Ÿåº¦å¿«ã€ä¸ä¾èµ–ç½‘ç»œç¯å¢ƒã€‚åŒæ—¶æä¾›äº†ä¸€å¥—éªŒè¯çš„å·¥å…·ï¼Œç»“æœçš„éªŒè¯ååˆ†æ–¹ä¾¿ã€‚</p><p>æ¥å£MockMvcBuilderï¼Œæä¾›ä¸€ä¸ªå”¯ä¸€çš„buildæ–¹æ³•ï¼Œç”¨æ¥æ„é€ MockMvcã€‚ä¸»è¦æœ‰ä¸¤ä¸ªå®ç°ï¼šStandaloneMockMvcBuilderå’ŒDefaultMockMvcBuilderã€‚</p><p><img src="https://7.dusays.com/2021/03/12/8ca41b998aaab.png" alt="image-20210312142923082"></p><ol><li>MockMVCçš„åŸºæœ¬æ­¥éª¤</li></ol><p>(1) mockMvc.performæ‰§è¡Œä¸€ä¸ªè¯·æ±‚ã€‚(2) MockMvcRequestBuilders.get(â€œXXXâ€)æ„é€ ä¸€ä¸ªè¯·æ±‚ã€‚(3) ResultActions.paramæ·»åŠ è¯·æ±‚ä¼ å€¼ (4) ResultActions.accept()è®¾ç½®è¿”å›ç±»å‹ (5) ResultActions.andExpectæ·»åŠ æ‰§è¡Œå®Œæˆåçš„æ–­è¨€ã€‚(6) ResultActions.andDoæ·»åŠ ä¸€ä¸ªç»“æœå¤„ç†å™¨ï¼Œè¡¨ç¤ºè¦å¯¹ç»“æœåšç‚¹ä»€ä¹ˆäº‹æƒ…ï¼Œæ¯”å¦‚å¤„ä½¿ç”¨print()è¾“å‡ºæ•´ä¸ªå“åº”ç»“æœä¿¡æ¯ã€‚(7) ResultActions.andReturnè¡¨ç¤ºæ‰§è¡Œå®Œæˆåè¿”å›ç›¸åº”çš„ç»“æœã€‚</p><h2 id="å››ã€Serviceå±‚çš„å•å…ƒæµ‹è¯•"><a href="#å››ã€Serviceå±‚çš„å•å…ƒæµ‹è¯•" class="headerlink" title="å››ã€Serviceå±‚çš„å•å…ƒæµ‹è¯•"></a>å››ã€Serviceå±‚çš„å•å…ƒæµ‹è¯•</h2><p><strong>ç¬¬ä¸€æ­¥ï¼š</strong> Spring Bootä¸­å•å…ƒæµ‹è¯•ç±»å†™åœ¨src/test/javaç›®å½•ä¸‹ï¼Œä½ å¯ä»¥æ‰‹åŠ¨åˆ›å»ºå…·ä½“æµ‹è¯•ç±»ï¼Œä¹Ÿå¯ä»¥é€šè¿‡IDEAè‡ªåŠ¨åˆ›å»ºæµ‹è¯•ç±»ï¼Œå¦‚ä¸‹å›¾ï¼šï¼ˆæ³¨ï¼šç‚¹é€‰å¹¶æ‰“å¼€ç›¸åº”ä»£ç ç•Œé¢ï¼Œå†ç‚¹å‡»èœå•æ çš„Navigateï¼‰</p><p><img src="https://7.dusays.com/2021/03/12/b9128a7d66811.png" alt="image-20210312140744322"></p><p><strong>ç¬¬äºŒæ­¥ï¼š</strong> æŒ‰ç…§ç¬¬ä¸€æ­¥çš„æ–¹æ³•ï¼Œç‚¹å‡»æµ‹è¯•åï¼Œå‡ºç°<strong>å›¾ä¸€</strong> çš„å¯¹è¯æ¡†ï¼ˆå¦‚æœæƒ³è¦æµ‹è¯•çš„ç±»å·²ç»å­˜åœ¨æµ‹è¯•ç±»äº†ä¼šè¢«åˆ—å‡ºæ¥ï¼Œä¹Ÿå¯ä»¥é‡æ–°åˆ›å»ºä¸€ä¸ªæ–°çš„æµ‹è¯•ç±»ï¼‰ï¼Œç‚¹å‡»â€Create New Testâ€¦â€ä¼šå¼¹å‡º<strong>å›¾äºŒ</strong> çš„å¯¹è¯æ¡†ï¼Œå¯ä»¥é€‰æ‹©æ˜¯å¦ç”ŸæˆsetUpä»¥åŠè¦æµ‹è¯•çš„æˆå‘˜æ–¹æ³•ç­‰ï¼š</p><p>å›¾ä¸€</p><p><img src="https://cdn.jsdelivr.net/gh/cayzlh/git-img-repository@master/2021/03/14044716155290871615529087979.jpg" alt="å›¾ç‰‡"></p><p>å›¾äºŒ</p><p><img src="https://cdn.jsdelivr.net/gh/cayzlh/git-img-repository@master/2021/03/14044816155290881615529088115.jpg" alt="å›¾ç‰‡"></p><p><strong>ç¬¬ä¸‰æ­¥ï¼š</strong> è‡³æ­¤Serviceå±‚çš„æµ‹è¯•ç±»å°±åˆ›å»ºå¥½äº†ï¼Œæµ‹è¯•ç±»è‡ªåŠ¨ç”Ÿæˆåˆ°äº†src/test/javaç›®å½•ä¸‹<strong>é¡¹ç›®çš„åŒçº§ç›®å½•ä¸­</strong> ï¼Œå¦‚ä¸‹å›¾ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/cayzlh/git-img-repository@master/2021/03/14044816155290881615529088185.jpg" alt="å›¾ç‰‡"></p><p>Serviceå±‚æµ‹è¯•ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">@SpringBootTest</span><br><span class="line">@RunWith(SpringRunner.class)</span><br><span class="line">public class XXXServiceTest &#123;</span><br><span class="line">@Resource</span><br><span class="line">private XXXService XXXService;</span><br><span class="line">@Test</span><br><span class="line">public void conflictTime() &#123;</span><br><span class="line">        DateTimeFormatter dtf &#x3D; DateTimeFormatter.ofPattern(&quot;yyyy-MM-dd&quot;);</span><br><span class="line">        LocalDate start &#x3D; LocalDate.parse(&quot;2020-10-26&quot;, dtf);</span><br><span class="line">        LocalDate end &#x3D; LocalDate.parse(&quot;2020-10-31&quot;, dtf);</span><br><span class="line">        Integer integer &#x3D; XXXService.ConflictTime(&quot;10000001&quot;, start, end);</span><br><span class="line">        Assert.assertThat(integer, Matchers.notNullValue());&#x2F;&#x2F;assertThatæ–­è¨€åé¢ä»‹ç»</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ³¨è§£è§£é‡Šï¼š</strong></p><p><code>@SpringBootTest</code>ï¼šè·å–å¯åŠ¨ç±»ï¼ŒåŠ è½½é…ç½®ï¼Œå¯»æ‰¾ä¸»é…ç½®å¯åŠ¨ç±»ï¼ˆè¢« @SpringBootApplication æ³¨è§£çš„ï¼‰ <code>@RunWith(SpringRunner.class)</code>ï¼šè®©JUnitè¿è¡ŒSpringçš„æµ‹è¯•ç¯å¢ƒ,è·å¾—Springç¯å¢ƒçš„ä¸Šä¸‹æ–‡çš„æ”¯æŒ</p><h2 id="äº”ã€Controllerå±‚çš„å•å…ƒæµ‹è¯•"><a href="#äº”ã€Controllerå±‚çš„å•å…ƒæµ‹è¯•" class="headerlink" title="äº”ã€Controllerå±‚çš„å•å…ƒæµ‹è¯•"></a>äº”ã€Controllerå±‚çš„å•å…ƒæµ‹è¯•</h2><p>åˆ›å»ºæµ‹è¯•ç±»æ­¥éª¤è§ç¬¬å››éƒ¨åˆ†ï¼Œæ­¤å¤„ç•¥ã€‚</p><p>ç¬¬å››éƒ¨åˆ†åªæ˜¯é’ˆå¯¹Serviceå±‚åšäº†æµ‹è¯•ï¼Œä½†æ˜¯å’±ä¹ˆä¹Ÿéœ€è¦å¯¹Controllerå±‚ï¼ˆAPIï¼‰åšæµ‹è¯•ï¼Œè¿™æ—¶å€™å°±ç”¨åˆ°MockMvcäº†ï¼Œå®ƒä½¿å¾—ä½ æ— éœ€å¯åŠ¨é¡¹ç›®å·¥ç¨‹å°±èƒ½æµ‹è¯•è¿™äº›æ¥å£</p><p>MockMvcå®ç°äº†å¯¹Httpè¯·æ±‚çš„æ¨¡æ‹Ÿï¼Œèƒ½å¤Ÿç›´æ¥ä½¿ç”¨ç½‘ç»œçš„å½¢å¼ï¼Œè½¬æ¢åˆ°Controllerçš„è°ƒç”¨ï¼Œè¿™æ ·å¯ä»¥ä½¿å¾—æµ‹è¯•é€Ÿåº¦å¿«ã€ä¸ä¾èµ–ç½‘ç»œç¯å¢ƒï¼Œè€Œä¸”æä¾›äº†ä¸€å¥—éªŒè¯çš„å·¥å…·ï¼Œè¿™æ ·å¯ä»¥ä½¿å¾—è¯·æ±‚çš„éªŒè¯ç»Ÿä¸€è€Œä¸”å¾ˆæ–¹ä¾¿ã€‚</p><p>Controllerå±‚éƒ¨åˆ†çš„ä»£ç å°†åˆ†ä¸ºä¸‰ä¸ªä»£ç å—è®²è§£ï¼Œé‡Œé¢æœ‰çœ‹ä¸æ‡‚çš„ä»£ç å…ˆä¸è¦ç€æ€¥å“¦ğŸ˜„ï¼Œä¼šåœ¨ç¬¬äº”éƒ¨åˆ†ç»“å°¾å¤„ç»™å¤§å®¶æ±‡æ€»è§£ç­”çš„ï¼Œå¤§å®¶è¦åšæŒçœ‹åˆ°æœ€åå“Ÿï¼ğŸ˜</p><p><strong>ä»£ç å—ä¸€ï¼š</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">@SpringBootTest</span><br><span class="line">@RunWith(SpringRunner.class)</span><br><span class="line">@AutoConfigureMockMvc</span><br><span class="line">public class DfTaskRecordControllerTest &#123;</span><br><span class="line">@Autowired</span><br><span class="line">private MockMvc mockMvc;</span><br><span class="line">@Before</span><br><span class="line">public void setUp() throws Exception &#123;</span><br><span class="line">       System.out.println(&quot;---------------start---------------&quot;);</span><br><span class="line">       save();</span><br><span class="line">get();</span><br><span class="line">       System.out.println(&quot;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;end&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&quot;);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p><strong>æ³¨è§£è§£é‡Šï¼š</strong></p><p><code>@SpringBootTest</code>&gt;ï¼šè·å–å¯åŠ¨ç±»ï¼ŒåŠ è½½é…ç½®ï¼Œå¯»æ‰¾ä¸»é…ç½®å¯åŠ¨ç±»ï¼ˆè¢« @SpringBootApplication æ³¨è§£çš„ï¼‰</p><p><code>@RunWith(SpringRunner.class)</code>&gt;ï¼šè®©JUnitè¿è¡ŒSpringçš„æµ‹è¯•ç¯å¢ƒ,è·å¾—Springç¯å¢ƒçš„ä¸Šä¸‹æ–‡çš„æ”¯æŒ <code>@AutoConfigureMockMvc</code>ï¼šç”¨äºè‡ªåŠ¨é…ç½®MockMvc,é…ç½®åMockMvcç±»å¯ä»¥ç›´æ¥æ³¨å…¥,ç›¸å½“äºnew MockMvc <code>@Before</code>:åˆå§‹åŒ–æ–¹æ³• ,å¯¹äºæ¯ä¸€ä¸ªæµ‹è¯•æ–¹æ³•éƒ½è¦æ‰§è¡Œä¸€æ¬¡</p><p><strong>ä»£ç å—äºŒï¼š</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">@Test</span><br><span class="line">@Transactional</span><br><span class="line">@Rollback()</span><br><span class="line">public void save() throws Exception &#123;</span><br><span class="line">        String json&quot;&#123;â€¦â€¦&#125;&quot;;</span><br><span class="line">&#x2F;&#x2F;æ‰§è¡Œä¸€ä¸ªRequestBuilderè¯·æ±‚ï¼Œä¼šè‡ªåŠ¨æ‰§è¡ŒSpringMVCçš„æµç¨‹å¹¶æ˜ å°„åˆ°ç›¸åº”çš„æ§åˆ¶å™¨æ‰§è¡Œå¤„ç†ï¼›</span><br><span class="line">        mockMvc.perform(MockMvcRequestBuilders</span><br><span class="line">                .post(&quot;&#x2F;XXX&#x2F;save&quot;)</span><br><span class="line">                .content(json.getBytes()) &#x2F;&#x2F;ä¼ jsonå‚æ•°</span><br><span class="line">                .accept(MediaType.APPLICATION_JSON)</span><br><span class="line">                .contentType(MediaType.APPLICATION_JSON_VALUE)</span><br><span class="line">                .header(&quot;Authorization&quot;,&quot;Bearer ********-****-****-****-************&quot;)</span><br><span class="line">        )</span><br><span class="line">                .andExpect(MockMvcResultMatchers.status().isOk())</span><br><span class="line">                .andDo(print());</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p><strong>æ³¨è§£è§£é‡Šï¼š</strong></p><p><code>@Transactional</code>:å¼€å¯äº‹åŠ¡åŠŸèƒ½</p><p><code>@Rollback()</code>: äº‹åŠ¡å›æ»š,é»˜è®¤æ˜¯true</p><p><strong>ä»£ç å—ä¸‰ï¼š</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">@Test</span><br><span class="line">public void get() throws Exception&#123;</span><br><span class="line">        ResultActions resultActions &#x3D; mockMvc.perform(MockMvcRequestBuilders</span><br><span class="line">                .get(&quot;&#x2F;XXX&#x2F;get&quot;)</span><br><span class="line">                .param(&quot;id&quot;, &quot;**********&quot;)</span><br><span class="line">                .header(&quot;Authorization&quot;, &quot;Bearer ********-****-****-****-************&quot;)</span><br><span class="line">        );</span><br><span class="line">        resultActions.andReturn().getResponse().setCharacterEncoding(&quot;UTF-8&quot;);</span><br><span class="line">        resultActions.andExpect(MockMvcResultMatchers.status().isOk()).andDo(print());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>/get</code>è¿è¡Œç»“æœå¦‚ä¸‹ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/cayzlh/git-img-repository@master/2021/03/14044816155290881615529088275.jpg" alt="å›¾ç‰‡"></p><p><strong>ç°åœ¨å°†ä¸Šé¢çš„ä¸€äº›çç¢çš„çŸ¥è¯†ç‚¹æ±‡æ€»ä¸€ä¸‹ï¼š</strong></p><p><code>1. mockMvc.perform</code>ï¼šæ‰§è¡Œä¸€ä¸ªè¯·æ±‚</p><p><code>2. MockMvcRequestBuilders.get(â€œ/XXX/getâ€)</code>ï¼šæ„é€ ä¸€ä¸ªè¯·æ±‚ï¼ŒPostè¯·æ±‚ä½¿ç”¨.postæ–¹æ³•</p><p><code>3. contentType(MediaType.APPLICATION_JSON_VALUE)</code>ï¼šä»£è¡¨å‘é€ç«¯å‘é€çš„æ•°æ®æ ¼å¼æ˜¯application/json;charset=UTF-8</p><p><code>4. accept(MediaType.APPLICATION_JSON)</code>ï¼šä»£è¡¨å®¢æˆ·ç«¯å¸Œæœ›æ¥å—çš„æ•°æ®ç±»å‹ä¸ºapplication/json;charset=UTF-8</p><p><code>5. header(â€œAuthorizationâ€,â€œBearer XXXXâ€)</code>ï¼šä»£è¡¨åœ¨æŠ¥æ–‡å¤´æ·»åŠ ä¸€äº›å¿…é¡»çš„ä¿¡æ¯ï¼Œè¿™é‡Œæ·»åŠ çš„æ˜¯token</p><p><code>6. ResultActions.andExpect</code>ï¼šæ·»åŠ æ‰§è¡Œå®Œæˆåçš„æ–­è¨€</p><p><code>7. ResultActions.andExpect(MockMvcResultMatchers.status().isOk())</code>ï¼šæ–¹æ³•çœ‹è¯·æ±‚çš„çŠ¶æ€å“åº”ç æ˜¯å¦ä¸º200å¦‚æœä¸æ˜¯åˆ™æŠ›å¼‚å¸¸ï¼Œæµ‹è¯•ä¸é€šè¿‡</p><p><code>8. ResultActions.andDo</code>ï¼šæ·»åŠ ä¸€ä¸ªç»“æœå¤„ç†å™¨ï¼Œè¡¨ç¤ºè¦å¯¹ç»“æœåšç‚¹ä»€ä¹ˆäº‹æƒ…ï¼Œæ¯”å¦‚æ­¤å¤„ä½¿ç”¨print()ï¼šè¾“å‡ºæ•´ä¸ªå“åº”ç»“æœä¿¡æ¯</p><h2 id="å…­ã€æ–­è¨€çš„æ¦‚å¿µ"><a href="#å…­ã€æ–­è¨€çš„æ¦‚å¿µ" class="headerlink" title="å…­ã€æ–­è¨€çš„æ¦‚å¿µ"></a>å…­ã€æ–­è¨€çš„æ¦‚å¿µ</h2><ol><li>æ–­è¨€ï¼ˆassertï¼‰ï¼Œæ˜¯ç¼–ç¨‹æœ¯è¯­ï¼Œè¡¨ç¤ºä¸ºä¸€äº›å¸ƒå°”è¡¨è¾¾å¼ï¼Œç¨‹åºå‘˜ç›¸ä¿¡åœ¨ç¨‹åºä¸­çš„æŸä¸ªç‰¹å®šç‚¹è¯¥è¡¨è¾¾å¼å€¼ä¸ºçœŸã€‚å¯ä»¥åœ¨ä»»ä½•æ—¶å€™å¯ç”¨å’Œç¦ç”¨æ–­è¨€éªŒè¯ï¼Œå› æ­¤å¯ä»¥åœ¨æµ‹è¯•æ—¶å¯ç”¨æ–­è¨€è€Œåœ¨éƒ¨ç½²æ—¶ç¦ç”¨æ–­è¨€ã€‚</li><li>ä½¿ç”¨æ–­è¨€æ˜¯åˆ¤æ–­ä¸€ä¸ªå‡½æ•°æˆ–å¯¹è±¡çš„ä¸€ä¸ªæ–¹æ³•æ‰€äº§ç”Ÿçš„ç»“æœæ˜¯å¦ç¬¦åˆä½ æœŸæœ›é‚£ä¸ªç»“æœã€‚</li></ol><h2 id="ä¸ƒã€æ–°æ–­è¨€assertThatä½¿ç”¨"><a href="#ä¸ƒã€æ–°æ–­è¨€assertThatä½¿ç”¨" class="headerlink" title="ä¸ƒã€æ–°æ–­è¨€assertThatä½¿ç”¨"></a>ä¸ƒã€æ–°æ–­è¨€assertThatä½¿ç”¨</h2><p>JUnit 4.4 ç»“åˆ Hamcrest æä¾›äº†ä¸€ä¸ªå…¨æ–°çš„æ–­è¨€è¯­æ³•â€”â€”assertThatã€‚ç¨‹åºå‘˜å¯ä»¥åªä½¿ç”¨ assertThat ä¸€ä¸ªæ–­è¨€è¯­å¥ï¼Œç»“åˆ Hamcrest æä¾›çš„åŒ¹é…ç¬¦ï¼Œå°±å¯ä»¥è¡¨è¾¾å…¨éƒ¨çš„æµ‹è¯•æ€æƒ³ã€‚</p><p><strong>assertThat çš„ä¼˜ç‚¹ï¼š</strong></p><p><strong>ä¼˜ç‚¹ 1ï¼š</strong> ä»¥å‰ JUnit æä¾›äº†å¾ˆå¤šçš„ assertion è¯­å¥ï¼Œå¦‚ï¼šassertEqualsï¼ŒassertNotSameï¼ŒassertFalseï¼ŒassertTrueï¼ŒassertNotNullï¼ŒassertNull ç­‰ï¼Œç°åœ¨æœ‰äº† JUnit 4.4ï¼Œä¸€æ¡ assertThat å³å¯ä»¥æ›¿ä»£æ‰€æœ‰çš„ assertion è¯­å¥ï¼Œè¿™æ ·å¯ä»¥åœ¨æ‰€æœ‰çš„å•å…ƒæµ‹è¯•ä¸­åªä½¿ç”¨ä¸€ä¸ªæ–­è¨€æ–¹æ³•ï¼Œä½¿å¾—ç¼–å†™æµ‹è¯•ç”¨ä¾‹å˜å¾—ç®€å•ï¼Œä»£ç é£æ ¼å˜å¾—ç»Ÿä¸€ï¼Œæµ‹è¯•ä»£ç ä¹Ÿæ›´å®¹æ˜“ç»´æŠ¤ã€‚</p><p><strong>ä¼˜ç‚¹ 2ï¼š</strong> assertThat ä½¿ç”¨äº† Hamcrest çš„ Matcher åŒ¹é…ç¬¦ï¼Œç”¨æˆ·å¯ä»¥ä½¿ç”¨åŒ¹é…ç¬¦è§„å®šçš„åŒ¹é…å‡†åˆ™ç²¾ç¡®çš„æŒ‡å®šä¸€äº›æƒ³è®¾å®šæ»¡è¶³çš„æ¡ä»¶ï¼Œå…·æœ‰å¾ˆå¼ºçš„æ˜“è¯»æ€§ï¼Œè€Œä¸”ä½¿ç”¨èµ·æ¥æ›´åŠ çµæ´»ã€‚</p><p><strong>ä¼˜ç‚¹ 3ï¼š</strong> assertThat ä¸å†åƒ assertEquals é‚£æ ·ï¼Œä½¿ç”¨æ¯”è¾ƒéš¾æ‡‚çš„â€œè°“å®¾ä¸»â€è¯­æ³•æ¨¡å¼ï¼ˆå¦‚ï¼šassertEquals(3, x);ï¼‰ï¼Œç›¸åï¼ŒassertThat ä½¿ç”¨äº†ç±»ä¼¼äºâ€œä¸»è°“å®¾â€çš„æ˜“è¯»è¯­æ³•æ¨¡å¼ï¼ˆå¦‚ï¼šassertThat(x,is(3));ï¼‰ï¼Œä½¿å¾—ä»£ç æ›´åŠ ç›´è§‚ã€æ˜“è¯»ã€‚</p><p><strong>assertThat çš„åŸºæœ¬è¯­æ³•å¦‚ä¸‹ï¼š</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">assertThat( [value], [matcher statement] );</span><br></pre></td></tr></table></figure><p><strong>value</strong> ï¼šæ¥ä¸‹æ¥æƒ³è¦æµ‹è¯•çš„å˜é‡å€¼ï¼›<strong>matcher statement</strong> ï¼šä½¿ç”¨ Hamcrest åŒ¹é…ç¬¦æ¥è¡¨è¾¾çš„å¯¹å‰é¢å˜é‡æ‰€æœŸæœ›çš„å€¼çš„å£°æ˜ï¼Œå¦‚æœ value å€¼ä¸ matcher statement æ‰€è¡¨è¾¾çš„æœŸæœ›å€¼ç›¸ç¬¦ï¼Œåˆ™æµ‹è¯•æˆåŠŸï¼Œå¦åˆ™æµ‹è¯•å¤±è´¥ã€‚</p><h2 id="å…«ã€Postmanä¸Spring-Boot-å•å…ƒæµ‹è¯•çš„åŒºåˆ«"><a href="#å…«ã€Postmanä¸Spring-Boot-å•å…ƒæµ‹è¯•çš„åŒºåˆ«" class="headerlink" title="å…«ã€Postmanä¸Spring Boot å•å…ƒæµ‹è¯•çš„åŒºåˆ«"></a>å…«ã€Postmanä¸Spring Boot å•å…ƒæµ‹è¯•çš„åŒºåˆ«</h2><ol><li>Spring Bootçš„å•å…ƒæµ‹è¯•ä¸»è¦é’ˆå¯¹æ–¹æ³•å±‚é¢ï¼Œå¯ä»¥æµ‹è¯•Serviceå±‚è¿™ç±»éå¯¹å¤–æš´éœ²çš„æ¥å£çš„ç±»ä¸­æ–¹æ³•ï¼Œå¹¶ä¸”å¯ä¸€æ¬¡æ€§æ‰¹é‡æµ‹è¯•å¤šä¸ªæ–¹æ³•ã€æ”¯æŒäº‹åŠ¡å›æ»šã€‚</li><li>Postmané’ˆå¯¹æ¥å£è¿›è¡Œhttpæµ‹è¯•ï¼Œæˆ‘å¹³æ—¶è¿™ä¸ªæ¯”è¾ƒå¤šï¼Œåˆ›å»ºçš„æµ‹è¯•æ¥å£å¯ä¿å­˜ã€åˆ†ç±»ã€‚</li></ol><h2 id="ä¹ã€PostmanåŸºæœ¬ç”¨æ³•"><a href="#ä¹ã€PostmanåŸºæœ¬ç”¨æ³•" class="headerlink" title="ä¹ã€PostmanåŸºæœ¬ç”¨æ³•"></a>ä¹ã€PostmanåŸºæœ¬ç”¨æ³•</h2><p>Postmanæ˜¯ä¸€æ¬¾åŠŸèƒ½å¼ºå¤§çš„ç½‘é¡µè°ƒè¯•ä¸å‘é€ç½‘é¡µHTTPè¯·æ±‚çš„å·¥å…·ã€‚Postmanèƒ½å¤Ÿå‘é€ä»»ä½•ç±»å‹çš„HTTPè¯·æ±‚(GET, HEAD, POST,PUT..)ï¼Œé™„å¸¦ä»»ä½•æ•°é‡çš„å‚æ•°å’ŒHTTP headersã€‚æ”¯æŒä¸åŒçš„è®¤è¯æœºåˆ¶ï¼ˆbasic, digest,OAuthï¼‰ï¼Œæ¥æ”¶åˆ°çš„å“åº”è¯­æ³•é«˜äº®ï¼ˆHTMLï¼ŒJSONæˆ–XMLï¼‰ã€‚</p><p><strong>å®‰è£…Postman</strong></p><p>å®˜æ–¹ç½‘ç«™ï¼š</p><p><a href="https://www.getpostman.com/apps">https://www.getpostman.com/apps</a></p><p><img src="https://7.dusays.com/2021/03/12/fb189913d88c3.png" alt="image-20210312140706367"></p><p>å®‰è£…åï¼ŒPostmanæ˜¯ä»‹æ ·å©¶å„¿æ»´~~ğŸ˜Š</p><p><img src="https://cdn.jsdelivr.net/gh/cayzlh/git-img-repository@master/2021/03/14044816155290881615529088535.jpg" alt="å›¾ç‰‡"></p>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹æŠ€æœ¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> è½¬è½½ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SpringBootè‡ªåŠ¨éƒ¨ç½²è„šæœ¬</title>
      <link href="post/3136136825/"/>
      <url>post/3136136825/</url>
      
        <content type="html"><![CDATA[<blockquote><p>SpringBootè‡ªåŠ¨éƒ¨ç½²è„šæœ¬ï¼Œå¯ç”¨äºjenkins</p></blockquote><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> description:springboot è‡ªåŠ¨éƒ¨ç½² 1.0ç‰ˆæœ¬</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> version 1.0</span></span><br><span class="line">show_usage=&quot;args: [-t]\[--deploy-type=]&quot;</span><br><span class="line"><span class="meta">#</span><span class="bash">ç‰ˆæœ¬éƒ¨ç½²è·¯å¾„</span>  </span><br><span class="line">mainpath=/data/service/youAppDir</span><br><span class="line"> </span><br><span class="line"><span class="meta">#</span><span class="bash"> åº”ç”¨åç§°</span></span><br><span class="line">appName=yourAppName</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">ä¸»å‡½æ•°</span></span><br><span class="line">function deploy()</span><br><span class="line">&#123;</span><br><span class="line">  cd $&#123;mainpath&#125;</span><br><span class="line">  echo &quot;[info]start deploy...[$(date +&#x27;%F %H:%M:%S&#x27;)]&quot;</span><br><span class="line">  stop</span><br><span class="line">  backup</span><br><span class="line">  upload</span><br><span class="line">  start</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">å¯åŠ¨app</span></span><br><span class="line">function stop()&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">echo `ps -ef | grep $&#123;appName&#125; | grep -v &#x27;grep&#x27; | grep -v &#x27;deploy&#x27;|awk  &#x27;&#123;print $2&#125;&#x27; `; </span><br><span class="line"></span><br><span class="line">PIDCOUNT=`ps -ef | grep $&#123;appName&#125; | grep -v &#x27;grep&#x27; | grep -v &#x27;deploy&#x27; | awk  &#x27;&#123;print $2&#125;&#x27; | wc -l`;</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line">    echo &quot;stopping pid count:$PIDCOUNT&quot;</span><br><span class="line">    if [ $&#123;PIDCOUNT&#125; -gt 0 ];then</span><br><span class="line"> &#123;</span><br><span class="line">    # è·å–è¿›ç¨‹ID</span><br><span class="line">appID=$(ps -ef | grep $&#123;appName&#125; | grep -v &#x27;grep&#x27; | grep -v &#x27;deploy&#x27; | awk  &#x27;&#123;print $2&#125;&#x27;)</span><br><span class="line">    echo &quot;[info]å½“å‰è¿›ç¨‹IDä¸º:$appID&quot;</span><br><span class="line">kill -9 $appID</span><br><span class="line">&#125; || &#123; </span><br><span class="line">echo &quot;[info]è¿›ç¨‹IDä¸º:$appIDåœæ­¢å¼‚å¸¸&quot;</span><br><span class="line">&#125;</span><br><span class="line">  fi</span><br><span class="line">  echo &quot;stoped pid:$appID&quot;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">å¯åŠ¨app</span></span><br><span class="line">function start()&#123;</span><br><span class="line"></span><br><span class="line">echo &quot;starting $appName.jar&quot;</span><br><span class="line">    nohup java -jar -Dspring.profiles.active=test -Xms128m -Xmx512m $mainpath/$appName.jar &gt; /dev/null 2&gt;&amp;1 &amp;</span><br><span class="line"></span><br><span class="line">    echo &quot;success started $appName.jar&quot;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#</span><span class="bash">ä¸Šä¼ æ–‡ä»¶</span></span><br><span class="line">function upload()&#123;</span><br><span class="line">echo &quot;uploading $mainpath/$&#123;appName&#125;.jar&quot;</span><br><span class="line">cp $mainpath/respo/$&#123;appName&#125;.jar $mainpath/$&#123;appName&#125;.jar</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">ç‰ˆæœ¬å›æ»š</span>  </span><br><span class="line">deploy_Rollback()  </span><br><span class="line">&#123;  </span><br><span class="line"><span class="meta">#</span><span class="bash">è¿›å…¥å¤‡ä»½æ–‡ä»¶å¤¹</span>  </span><br><span class="line">    cd $&#123;mainpath&#125;/backup/  </span><br><span class="line">    #è·å–æœ€æ–°å¤‡ä»½æ–‡ä»¶  </span><br><span class="line">    file_name_new=&#x27;&#x27;  </span><br><span class="line">    for i in `ls -tr`;  </span><br><span class="line">    do  </span><br><span class="line">        echo $i;  </span><br><span class="line">        file_name_new=$i;  </span><br><span class="line">    done;  </span><br><span class="line">    #å°†å¤‡ä»½æ–‡ä»¶å¤åˆ¶åˆ°webapps  </span><br><span class="line">    cp  $&#123;mainpath&#125;/backup/$&#123;file_name_new&#125; $&#123;mainpath&#125;/$&#123;appName&#125;.jar </span><br><span class="line">    if [ $? -eq 0 ]  </span><br><span class="line">    then  </span><br><span class="line">        echo å¤åˆ¶$&#123;file_name_new&#125;æˆåŠŸ  </span><br><span class="line">    else  </span><br><span class="line">        echo å¤åˆ¶å¤±è´¥ï¼Œé€€å‡ºï¼  </span><br><span class="line">    exit 1  </span><br><span class="line">    fi  </span><br><span class="line">    #è¿›å…¥webapps/ç›®å½•  </span><br><span class="line">    cd  $&#123;mainpath&#125;</span><br><span class="line">    #é‡å¯App </span><br><span class="line">    stop</span><br><span class="line">    start  </span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">å¤‡ä»½åŸæ¥çš„é¡¹ç›®</span></span><br><span class="line">function backup()</span><br><span class="line">&#123;</span><br><span class="line">echo &quot;å¼€å§‹å¤‡ä»½to$&#123;mainpath&#125;....&quot;</span><br><span class="line">fileDate=$(date &quot;+%Y%m%d%H%M%S&quot;)</span><br><span class="line">fileName=$&#123;appName&#125;$&#123;fileDate&#125;</span><br><span class="line">mv $mainpath/$&#123;appName&#125;.jar $mainpath/backup/$&#123;fileName&#125;.jar</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">echo --------æ¬¢è¿ä½¿ç”¨shellè‡ªåŠ¨éƒ¨ç½²è„šæœ¬--------    </span><br><span class="line"><span class="meta">#</span><span class="bash">è·å–ç”¨æˆ·æ“ä½œ</span>  </span><br><span class="line">case $wm2 in  </span><br><span class="line">rollback)  </span><br><span class="line">    deploy_Rollback  </span><br><span class="line">    ;;  </span><br><span class="line">*)  </span><br><span class="line">    deploy  </span><br><span class="line">    ;;  </span><br><span class="line">esac</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®°æœ¬ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> Linux </tag>
            
            <tag> Spring </tag>
            
            <tag> SpringBoot </tag>
            
            <tag> shell </tag>
            
            <tag> Jenkins </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SpringBootå¯åŠ¨è„šæœ¬</title>
      <link href="post/2348855541/"/>
      <url>post/2348855541/</url>
      
        <content type="html"><![CDATA[<blockquote><p>SpringBootå¯åŠ¨è„šæœ¬</p></blockquote><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/sh</span></span><br><span class="line"></span><br><span class="line">appName=yourAppName</span><br><span class="line">pidFile=&quot;$appName.pid&quot;</span><br><span class="line"></span><br><span class="line">start()&#123;</span><br><span class="line">    if [ -f &quot;$pidFile&quot; ]; then</span><br><span class="line">        pid=$(cat &quot;$pidFile&quot;)</span><br><span class="line">        echo &quot;STOP pid:$pid&quot;</span><br><span class="line">        kill -9 $pid</span><br><span class="line">        rm &quot;$pidFile&quot;</span><br><span class="line">    fi</span><br><span class="line">    nohup java -jar -Dspring.profiles.active=test -Xms128m -Xmx512m $appName.jar &gt; /dev/null 2&gt;&amp;1 &amp;</span><br><span class="line">    echo $! &gt; &quot;$pidFile&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">stop()&#123;</span><br><span class="line">   if [ -f &quot;$pidFile&quot; ]; then</span><br><span class="line">        pid=$(cat &quot;$pidFile&quot;)</span><br><span class="line">        echo &quot;STOP pid:$pid&quot;</span><br><span class="line">        kill -9 $pid</span><br><span class="line">        rm &quot;$pidFile&quot;</span><br><span class="line">    fi</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">case &quot;$1&quot; in</span><br><span class="line">  start)</span><br><span class="line">    start</span><br><span class="line">  ;;</span><br><span class="line">  stop)</span><br><span class="line">    stop</span><br><span class="line">  ;;</span><br><span class="line">  *)</span><br><span class="line">    printf &#x27;Usage: %s &#123;start|stop&#125;\n&#x27; &quot;$prog&quot;  </span><br><span class="line">    exit 1  </span><br><span class="line">  ;;</span><br><span class="line">esac</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®°æœ¬ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> Linux </tag>
            
            <tag> Spring </tag>
            
            <tag> SpringBoot </tag>
            
            <tag> shell </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>nginxç®€å•é…ç½®ç¤ºä¾‹</title>
      <link href="post/2487533199/"/>
      <url>post/2487533199/</url>
      
        <content type="html"><![CDATA[<blockquote><p>nginxç®€å•é…ç½®ç¤ºä¾‹</p></blockquote><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># rewrite to Https</span></span><br><span class="line">server &#123;</span><br><span class="line">    listen  80;</span><br><span class="line">    server_name xxx.xxx.com;</span><br><span class="line"></span><br><span class="line">    rewrite ^(.*)$  https://$host<span class="variable">$1</span> permanent;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">    listen       443 ssl;</span><br><span class="line">    server_name  xxx.xxx.com;</span><br><span class="line"></span><br><span class="line">    ssl_certificate      /opt/nginx/ssl/xxxxx.pem;</span><br><span class="line">    ssl_certificate_key  /opt/nginx/ssl/xxxxx.key;</span><br><span class="line"></span><br><span class="line">    ssl_session_cache    shared:SSL:1m;</span><br><span class="line">    ssl_session_timeout  5m;</span><br><span class="line"></span><br><span class="line">    ssl_ciphers  HIGH:!aNULL:!MD5;</span><br><span class="line">    ssl_prefer_server_ciphers  on;</span><br><span class="line">    </span><br><span class="line">    underscores_in_headers on; </span><br><span class="line"></span><br><span class="line">   location ~ /demo &#123;</span><br><span class="line"></span><br><span class="line">        proxy_set_header   Host             xxx.xxx.com;</span><br><span class="line"></span><br><span class="line">        proxy_set_header   X-Real-IP        <span class="variable">$http_x_forwarded_for</span>;</span><br><span class="line"></span><br><span class="line">        proxy_set_header   X-Forwarded-For  <span class="variable">$http_x_forwarded_for</span>;</span><br><span class="line"></span><br><span class="line">        proxy_pass                          http://xxx.service;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®°æœ¬ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> nginx </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Gitå¸¸ç”¨å‘½ä»¤æ•´ç†</title>
      <link href="post/3502630734/"/>
      <url>post/3502630734/</url>
      
        <content type="html"><![CDATA[<p><code>Git</code>çš„å››ä¸ªç»„æˆéƒ¨åˆ†ï¼š</p><p><img src="https://github.com/cayzlh/git-img-repository/raw/master/blog/2018/11/10/1.jpg" alt="Gitçš„å››ä¸ªç»„æˆéƒ¨åˆ†"></p><h1 id="è¿œç¨‹æ“ä½œè¯¦è§£"><a href="#è¿œç¨‹æ“ä½œè¯¦è§£" class="headerlink" title="è¿œç¨‹æ“ä½œè¯¦è§£"></a>è¿œç¨‹æ“ä½œè¯¦è§£</h1><h2 id="git-clone"><a href="#git-clone" class="headerlink" title="git clone"></a>git clone</h2><p>è¿œç¨‹æ“ä½œçš„ç¬¬ä¸€æ­¥ï¼Œé€šå¸¸æ˜¯ä»è¿œç¨‹ä¸»æœºå…‹éš†ä¸€ä¸ªç‰ˆæœ¬åº“ï¼Œè¿™æ—¶å°±è¦ç”¨åˆ°<code>git clone</code>å‘½ä»¤ã€‚</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git clone &lt;ç‰ˆæœ¬åº“çš„ç½‘å€&gt;</span><br></pre></td></tr></table></figure><p>æ¯”å¦‚ï¼š</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git clone https://github.com/cayzlh/Scaffold.git</span><br></pre></td></tr></table></figure><p>è¯¥å‘½ä»¤ä¼šåœ¨æœ¬åœ°ä¸»æœºç”Ÿæˆä¸€ä¸ªç›®å½•ï¼Œä¸è¿œç¨‹ä¸»æœºçš„ç‰ˆæœ¬åº“åŒåã€‚å¦‚æœè¦æŒ‡å®šä¸åŒçš„ç›®å½•åï¼Œå¯ä»¥å°†ç›®å½•åä½œä¸º<code>git clone</code>å‘½ä»¤çš„ç¬¬äºŒä¸ªå‚æ•°ã€‚</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git clone &lt;ç‰ˆæœ¬åº“çš„ç½‘å€&gt; &lt;æœ¬åœ°ç›®å½•å&gt;</span><br></pre></td></tr></table></figure><p><code>git clone</code>æ”¯æŒå¤šç§åè®®ï¼Œé™¤äº†HTTP(s)ä»¥å¤–ï¼Œè¿˜æ”¯æŒSSHã€Gitã€æœ¬åœ°æ–‡ä»¶åè®®ç­‰ï¼š</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git clone http[s]://example.com/path/to/repo.git/</span><br><span class="line">git clone ssh://example.com/path/to/repo.git/</span><br><span class="line">git clone git://example.com/path/to/repo.git/</span><br><span class="line">git clone /opt/git/project.git </span><br><span class="line">git clone file:///opt/git/project.git</span><br><span class="line">git clone ftp[s]://example.com/path/to/repo.git/</span><br><span class="line">git clone rsync://example.com/path/to/repo.git/</span><br></pre></td></tr></table></figure><p>SSHåè®®è¿˜æœ‰å¦ä¸€ç§å†™æ³•ï¼š</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">$</span><span class="bash"> git <span class="built_in">clone</span> [user@]example.com:path/to/repo.git/</span></span><br></pre></td></tr></table></figure><h2 id="git-remote"><a href="#git-remote" class="headerlink" title="git remote"></a>git remote</h2><p>ä¸ºäº†ä¾¿äºç®¡ç†ï¼Œ<code>Git</code>è¦æ±‚æ¯ä¸ªè¿œç¨‹ä¸»æœºéƒ½å¿…é¡»æŒ‡å®šä¸€ä¸ªä¸»æœºåã€‚<code>git remote</code>å‘½ä»¤å°±ç”¨äºç®¡ç†ä¸»æœºåã€‚</p><p>ä¸å¸¦é€‰é¡¹çš„æ—¶å€™ï¼Œ<code>git remote</code>å‘½ä»¤åˆ—å‡ºæ‰€æœ‰è¿œç¨‹ä¸»æœºã€‚</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git remote</span><br><span class="line">origin</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨<code>-v</code>é€‰é¡¹ï¼Œå¯ä»¥å‚çœ‹è¿œç¨‹ä¸»æœºçš„ç½‘å€ã€‚</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git remote -v</span><br><span class="line">originhttps://github.com/cayzlh/Scaffold.git (fetch)</span><br><span class="line">originhttps://github.com/cayzlh/Scaffold.git (push)</span><br></pre></td></tr></table></figure><p>å½“å‰åªæœ‰ä¸€å°è¿œç¨‹ä¸»æœºï¼Œå«åšoriginï¼Œä»¥åŠå®ƒçš„ç½‘å€ã€‚</p><p>å…‹éš†ç‰ˆæœ¬åº“çš„æ—¶å€™ï¼Œæ‰€ä½¿ç”¨çš„è¿œç¨‹ä¸»æœºè‡ªåŠ¨è¢«Gitå‘½åä¸º<code>origin</code>ã€‚å¦‚æœæƒ³ç”¨å…¶ä»–çš„ä¸»æœºåï¼Œéœ€è¦ç”¨<code>git clone</code>å‘½ä»¤çš„<code>-o</code>é€‰é¡¹æŒ‡å®šã€‚</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git clone -o Scaffold https://github.com/cayzlh/Scaffold.git</span><br><span class="line">git remote</span><br><span class="line">Scaffold</span><br></pre></td></tr></table></figure><p><code>git remote show</code>å‘½ä»¤åŠ ä¸Šä¸»æœºåï¼Œå¯ä»¥æŸ¥çœ‹è¯¥ä¸»æœºçš„è¯¦ç»†ä¿¡æ¯ã€‚</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git remote show &lt;ä¸»æœºå&gt;</span><br></pre></td></tr></table></figure><p><code>git remote add</code>å‘½ä»¤ç”¨äºæ·»åŠ è¿œç¨‹ä¸»æœºã€‚</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git remote add &lt;ä¸»æœºå&gt; &lt;ç½‘å€&gt;</span><br></pre></td></tr></table></figure><p><code>git remote rm</code>å‘½ä»¤ç”¨äºåˆ é™¤è¿œç¨‹ä¸»æœºã€‚</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git remote rm &lt;ä¸»æœºå&gt;</span><br></pre></td></tr></table></figure><p><code>git remote rename</code>å‘½ä»¤ç”¨äºè¿œç¨‹ä¸»æœºçš„æ”¹åã€‚</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git remote rename &lt;åŸä¸»æœºå&gt; &lt;æ–°ä¸»æœºå&gt;</span><br></pre></td></tr></table></figure><h2 id="git-fetch"><a href="#git-fetch" class="headerlink" title="git fetch"></a>git fetch</h2><p>ä¸€æ—¦è¿œç¨‹ä¸»æœºçš„ç‰ˆæœ¬åº“æœ‰äº†æ›´æ–°ï¼ˆGitæœ¯è¯­å«åšcommitï¼‰ï¼Œéœ€è¦å°†è¿™äº›æ›´æ–°å–å›æœ¬åœ°ï¼Œè¿™æ—¶å°±è¦ç”¨åˆ°<code>git fetch</code>å‘½ä»¤ã€‚</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git fetch &lt;è¿œç¨‹ä¸»æœºå&gt;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªå‘½ä»¤è¡¨è¿°å°†æŸä¸ªè¿œç¨‹ä¸»æœºçš„æ›´æ–°ï¼Œå…¨éƒ¨å–å›æœ¬åœ°ã€‚</p><p>å–å›<code>origin</code>ä¸»æœºçš„<code>master</code>åˆ†æ”¯ã€‚</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git fetch origin master</span><br></pre></td></tr></table></figure><p><code>git branch</code>å‘½ä»¤çš„<code>-r</code>é€‰é¡¹ï¼Œå¯ä»¥ç”¨æ¥æŸ¥çœ‹è¿œç¨‹åˆ†æ”¯ï¼Œ<code>-a</code>é€‰é¡¹æŸ¥çœ‹æ‰€æœ‰åˆ†æ”¯ã€‚</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git branch -r</span><br><span class="line"></span><br><span class="line">origin/HEAD -&gt; origin/master</span><br><span class="line">origin/master</span><br></pre></td></tr></table></figure><p>ä¸Šé¢å‘½ä»¤è¡¨ç¤ºï¼Œæœ¬åœ°ä¸»æœºçš„å½“å‰åˆ†æ”¯æ˜¯<code>master</code>ï¼Œè¿œç¨‹åˆ†æ”¯æ˜¯<code>origin/master</code>ã€‚</p><p>å–å›è¿œç¨‹ä¸»æœºçš„æ›´æ–°ä»¥åï¼Œå¯ä»¥åœ¨å®ƒçš„åŸºç¡€ä¸Šï¼Œä½¿ç”¨<code>git checkout</code>å‘½ä»¤åˆ›å»ºä¸€ä¸ªæ–°çš„åˆ†æ”¯ã€‚</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git checkout -b newBrach origin/master</span><br></pre></td></tr></table></figure><p>ä¸Šé¢å‘½ä»¤è¡¨ç¤ºï¼Œåœ¨<code>origin/master</code>çš„åŸºç¡€ä¸Šï¼Œåˆ›å»ºä¸€ä¸ªæ–°åˆ†æ”¯ã€‚</p><p>æ­¤å¤–ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨<code>git merge</code>å‘½ä»¤æˆ–è€…<code>git rebase</code>å‘½ä»¤ï¼Œåœ¨æœ¬åœ°åˆ†æ”¯ä¸Šåˆå¹¶è¿œç¨‹åˆ†æ”¯ã€‚</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git merge origin/master</span><br><span class="line"><span class="meta">#</span><span class="bash"> æˆ–è€…</span></span><br><span class="line">git rebase origin/master</span><br></pre></td></tr></table></figure><p>ä¸Šé¢å‘½ä»¤è¡¨ç¤ºåœ¨å½“å‰åˆ†æ”¯ä¸Šï¼Œåˆå¹¶<code>origin/master</code>ã€‚</p><h2 id="git-pull"><a href="#git-pull" class="headerlink" title="git pull"></a>git pull</h2><p><code>git pull</code>å‘½ä»¤çš„ä½œç”¨æ˜¯ï¼Œå–å›è¿œç¨‹ä¸»æœºæŸä¸ªåˆ†æ”¯çš„æ›´æ–°ï¼Œå†ä¸æœ¬åœ°çš„æŒ‡å®šåˆ†æ”¯åˆå¹¶ã€‚å®ƒçš„å®Œæ•´æ ¼å¼ç¨ç¨æœ‰ç‚¹å¤æ‚ã€‚</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git pull &lt;è¿œç¨‹ä¸»æœºå&gt; &lt;è¿œç¨‹åˆ†æ”¯å&gt;:&lt;æœ¬åœ°åˆ†æ”¯å&gt;</span><br></pre></td></tr></table></figure><p>æ¯”å¦‚ï¼Œå–å›<code>origin</code>ä¸»æœºçš„<code>next</code>åˆ†æ”¯ï¼Œä¸æœ¬åœ°çš„<code>master</code>åˆ†æ”¯åˆå¹¶ï¼Œéœ€è¦å†™æˆä¸‹é¢è¿™æ ·ã€‚</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git pull origin next:master</span><br></pre></td></tr></table></figure><p>å¦‚æœè¿œç¨‹åˆ†æ”¯æ˜¯ä¸å½“å‰åˆ†æ”¯åˆå¹¶ï¼Œåˆ™å†’å·åé¢çš„éƒ¨åˆ†å¯ä»¥çœç•¥ã€‚</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git pull origin next</span><br></pre></td></tr></table></figure><p>ä¸Šé¢å‘½ä»¤è¡¨ç¤ºï¼Œå–å›<code>origin/next</code>åˆ†æ”¯ï¼Œå†ä¸å½“å‰åˆ†æ”¯åˆå¹¶ã€‚å®è´¨ä¸Šï¼Œè¿™ç­‰åŒäºå…ˆåš<code>git fetch</code>ï¼Œå†åš<code>git merge</code>ã€‚</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git fetch origin</span><br><span class="line">git merge origin/next</span><br></pre></td></tr></table></figure><p>åœ¨æŸäº›åœºåˆï¼ŒGitä¼šè‡ªåŠ¨åœ¨æœ¬åœ°åˆ†æ”¯ä¸è¿œç¨‹åˆ†æ”¯ä¹‹é—´ï¼Œå»ºç«‹ä¸€ç§è¿½è¸ªå…³ç³»ï¼ˆtrackingï¼‰ã€‚æ¯”å¦‚ï¼Œåœ¨<code>git clone</code>çš„æ—¶å€™ï¼Œæ‰€æœ‰æœ¬åœ°åˆ†æ”¯é»˜è®¤ä¸è¿œç¨‹ä¸»æœºçš„åŒååˆ†æ”¯ï¼Œå»ºç«‹è¿½è¸ªå…³ç³»ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæœ¬åœ°çš„<code>master</code>åˆ†æ”¯è‡ªåŠ¨â€è¿½è¸ªâ€<code>origin/master</code>åˆ†æ”¯ã€‚</p><p>Gitä¹Ÿå…è®¸æ‰‹åŠ¨å»ºç«‹è¿½è¸ªå…³ç³»ã€‚</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git branch --set-upstream master origin/next</span><br></pre></td></tr></table></figure><p>ä¸Šé¢å‘½ä»¤æŒ‡å®š<code>master</code>åˆ†æ”¯è¿½è¸ª<code>origin/next</code>åˆ†æ”¯ã€‚</p><p>å¦‚æœå½“å‰åˆ†æ”¯ä¸è¿œç¨‹åˆ†æ”¯å­˜åœ¨è¿½è¸ªå…³ç³»ï¼Œ<code>git pull</code>å°±å¯ä»¥çœç•¥è¿œç¨‹åˆ†æ”¯åã€‚</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git pull origin</span><br></pre></td></tr></table></figure><p>ä¸Šé¢å‘½ä»¤è¡¨ç¤ºï¼Œæœ¬åœ°çš„å½“å‰åˆ†æ”¯è‡ªåŠ¨ä¸å¯¹åº”çš„<code>origin</code>ä¸»æœºâ€è¿½è¸ªåˆ†æ”¯â€ï¼ˆremote-tracking branchï¼‰è¿›è¡Œåˆå¹¶ã€‚</p><p>å¦‚æœå½“å‰åˆ†æ”¯åªæœ‰ä¸€ä¸ªè¿½è¸ªåˆ†æ”¯ï¼Œè¿è¿œç¨‹ä¸»æœºåéƒ½å¯ä»¥çœç•¥ã€‚</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git pull</span><br></pre></td></tr></table></figure><p>ä¸Šé¢å‘½ä»¤è¡¨ç¤ºï¼Œå½“å‰åˆ†æ”¯è‡ªåŠ¨ä¸å”¯ä¸€ä¸€ä¸ªè¿½è¸ªåˆ†æ”¯è¿›è¡Œåˆå¹¶ã€‚</p><p>å¦‚æœåˆå¹¶éœ€è¦é‡‡ç”¨rebaseæ¨¡å¼ï¼Œå¯ä»¥ä½¿ç”¨<code>--rebase</code>é€‰é¡¹ã€‚</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git pull --rebase &lt;è¿œç¨‹ä¸»æœºå&gt; &lt;è¿œç¨‹åˆ†æ”¯å&gt;:&lt;æœ¬åœ°åˆ†æ”¯å&gt;</span><br></pre></td></tr></table></figure><p>å¦‚æœè¿œç¨‹ä¸»æœºåˆ é™¤äº†æŸä¸ªåˆ†æ”¯ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œ<code>git pull</code> ä¸ä¼šåœ¨æ‹‰å–è¿œç¨‹åˆ†æ”¯çš„æ—¶å€™ï¼Œåˆ é™¤å¯¹åº”çš„æœ¬åœ°åˆ†æ”¯ã€‚è¿™æ˜¯ä¸ºäº†é˜²æ­¢ï¼Œç”±äºå…¶ä»–äººæ“ä½œäº†è¿œç¨‹ä¸»æœºï¼Œå¯¼è‡´<code>git pull</code>ä¸çŸ¥ä¸è§‰åˆ é™¤äº†æœ¬åœ°åˆ†æ”¯ã€‚</p><p>ä½†æ˜¯ï¼Œä½ å¯ä»¥æ”¹å˜è¿™ä¸ªè¡Œä¸ºï¼ŒåŠ ä¸Šå‚æ•° <code>-p</code> å°±ä¼šåœ¨æœ¬åœ°åˆ é™¤è¿œç¨‹å·²ç»åˆ é™¤çš„åˆ†æ”¯ã€‚</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git pull -p</span><br><span class="line"><span class="meta">#</span><span class="bash"> ç­‰åŒäºä¸‹é¢çš„å‘½ä»¤</span></span><br><span class="line">git fetch --prune origin </span><br><span class="line">git fetch -p</span><br></pre></td></tr></table></figure><h2 id="git-push"><a href="#git-push" class="headerlink" title="git push"></a>git push</h2><p><code>git push</code>å‘½ä»¤ç”¨äºå°†æœ¬åœ°åˆ†æ”¯çš„æ›´æ–°ï¼Œæ¨é€åˆ°è¿œç¨‹ä¸»æœºã€‚å®ƒçš„æ ¼å¼ä¸<code>git pull</code>å‘½ä»¤ç›¸ä»¿ã€‚</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git push &lt;è¿œç¨‹ä¸»æœºå&gt; &lt;æœ¬åœ°åˆ†æ”¯å&gt;:&lt;è¿œç¨‹åˆ†æ”¯å&gt;</span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼Œåˆ†æ”¯æ¨é€é¡ºåºçš„å†™æ³•æ˜¯&lt;æ¥æºåœ°&gt;:&lt;ç›®çš„åœ°&gt;ï¼Œæ‰€ä»¥<code>git pull</code>æ˜¯&lt;è¿œç¨‹åˆ†æ”¯&gt;:&lt;æœ¬åœ°åˆ†æ”¯&gt;ï¼Œè€Œ<code>git push</code>æ˜¯&lt;æœ¬åœ°åˆ†æ”¯&gt;:&lt;è¿œç¨‹åˆ†æ”¯&gt;ã€‚</p><p>å¦‚æœçœç•¥è¿œç¨‹åˆ†æ”¯åï¼Œåˆ™è¡¨ç¤ºå°†æœ¬åœ°åˆ†æ”¯æ¨é€ä¸ä¹‹å­˜åœ¨â€è¿½è¸ªå…³ç³»â€çš„è¿œç¨‹åˆ†æ”¯ï¼ˆé€šå¸¸ä¸¤è€…åŒåï¼‰ï¼Œå¦‚æœè¯¥è¿œç¨‹åˆ†æ”¯ä¸å­˜åœ¨ï¼Œåˆ™ä¼šè¢«æ–°å»ºã€‚</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git push origin master</span><br></pre></td></tr></table></figure><p>ä¸Šé¢å‘½ä»¤è¡¨ç¤ºï¼Œå°†æœ¬åœ°çš„<code>master</code>åˆ†æ”¯æ¨é€åˆ°<code>origin</code>ä¸»æœºçš„<code>master</code>åˆ†æ”¯ã€‚å¦‚æœåè€…ä¸å­˜åœ¨ï¼Œåˆ™ä¼šè¢«æ–°å»ºã€‚</p><p>å¦‚æœçœç•¥æœ¬åœ°åˆ†æ”¯åï¼Œåˆ™è¡¨ç¤ºåˆ é™¤æŒ‡å®šçš„è¿œç¨‹åˆ†æ”¯ï¼Œå› ä¸ºè¿™ç­‰åŒäºæ¨é€ä¸€ä¸ªç©ºçš„æœ¬åœ°åˆ†æ”¯åˆ°è¿œç¨‹åˆ†æ”¯ã€‚</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git push origin :master</span><br><span class="line"><span class="meta">#</span><span class="bash"> ç­‰åŒäº</span></span><br><span class="line">git push origin --delete master</span><br></pre></td></tr></table></figure><p>ä¸Šé¢å‘½ä»¤è¡¨ç¤ºåˆ é™¤<code>origin</code>ä¸»æœºçš„<code>master</code>åˆ†æ”¯ã€‚</p><p>å¦‚æœå½“å‰åˆ†æ”¯ä¸è¿œç¨‹åˆ†æ”¯ä¹‹é—´å­˜åœ¨è¿½è¸ªå…³ç³»ï¼Œåˆ™æœ¬åœ°åˆ†æ”¯å’Œè¿œç¨‹åˆ†æ”¯éƒ½å¯ä»¥çœç•¥ã€‚</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git push origin</span><br></pre></td></tr></table></figure><p>ä¸Šé¢å‘½ä»¤è¡¨ç¤ºï¼Œå°†å½“å‰åˆ†æ”¯æ¨é€åˆ°<code>origin</code>ä¸»æœºçš„å¯¹åº”åˆ†æ”¯ã€‚</p><p>å¦‚æœå½“å‰åˆ†æ”¯åªæœ‰ä¸€ä¸ªè¿½è¸ªåˆ†æ”¯ï¼Œé‚£ä¹ˆä¸»æœºåéƒ½å¯ä»¥çœç•¥ã€‚</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git push</span><br></pre></td></tr></table></figure><p>å¦‚æœå½“å‰åˆ†æ”¯ä¸å¤šä¸ªä¸»æœºå­˜åœ¨è¿½è¸ªå…³ç³»ï¼Œåˆ™å¯ä»¥ä½¿ç”¨<code>-u</code>é€‰é¡¹æŒ‡å®šä¸€ä¸ªé»˜è®¤ä¸»æœºï¼Œè¿™æ ·åé¢å°±å¯ä»¥ä¸åŠ ä»»ä½•å‚æ•°ä½¿ç”¨<code>git push</code>ã€‚</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git push -u origin master</span><br></pre></td></tr></table></figure><p>ä¸Šé¢å‘½ä»¤å°†æœ¬åœ°çš„<code>master</code>åˆ†æ”¯æ¨é€åˆ°<code>origin</code>ä¸»æœºï¼ŒåŒæ—¶æŒ‡å®š<code>origin</code>ä¸ºé»˜è®¤ä¸»æœºï¼Œåé¢å°±å¯ä»¥ä¸åŠ ä»»ä½•å‚æ•°ä½¿ç”¨<code>git push</code>äº†ã€‚</p><p>ä¸å¸¦ä»»ä½•å‚æ•°çš„<code>git push</code>ï¼Œé»˜è®¤åªæ¨é€å½“å‰åˆ†æ”¯ï¼Œè¿™å«åšsimpleæ–¹å¼ã€‚æ­¤å¤–ï¼Œè¿˜æœ‰ä¸€ç§matchingæ–¹å¼ï¼Œä¼šæ¨é€æ‰€æœ‰æœ‰å¯¹åº”çš„è¿œç¨‹åˆ†æ”¯çš„æœ¬åœ°åˆ†æ”¯ã€‚Git 2.0ç‰ˆæœ¬ä¹‹å‰ï¼Œé»˜è®¤é‡‡ç”¨matchingæ–¹æ³•ï¼Œç°åœ¨æ”¹ä¸ºé»˜è®¤é‡‡ç”¨simpleæ–¹å¼ã€‚å¦‚æœè¦ä¿®æ”¹è¿™ä¸ªè®¾ç½®ï¼Œå¯ä»¥é‡‡ç”¨<code>git config</code>å‘½ä»¤ã€‚</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git config --global push.default matching</span><br><span class="line"><span class="meta">#</span><span class="bash"> æˆ–è€…</span></span><br><span class="line">git config --global push.default simple</span><br></pre></td></tr></table></figure><p>è¿˜æœ‰ä¸€ç§æƒ…å†µï¼Œå°±æ˜¯ä¸ç®¡æ˜¯å¦å­˜åœ¨å¯¹åº”çš„è¿œç¨‹åˆ†æ”¯ï¼Œå°†æœ¬åœ°çš„æ‰€æœ‰åˆ†æ”¯éƒ½æ¨é€åˆ°è¿œç¨‹ä¸»æœºï¼Œè¿™æ—¶éœ€è¦ä½¿ç”¨<code>--all</code>é€‰é¡¹ã€‚</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git push --all origin</span><br></pre></td></tr></table></figure><p>ä¸Šé¢å‘½ä»¤è¡¨ç¤ºï¼Œå°†æ‰€æœ‰æœ¬åœ°åˆ†æ”¯éƒ½æ¨é€åˆ°<code>origin</code>ä¸»æœºã€‚</p><p>å¦‚æœè¿œç¨‹ä¸»æœºçš„ç‰ˆæœ¬æ¯”æœ¬åœ°ç‰ˆæœ¬æ›´æ–°ï¼Œæ¨é€æ—¶Gitä¼šæŠ¥é”™ï¼Œè¦æ±‚å…ˆåœ¨æœ¬åœ°åš<code>git pull</code>åˆå¹¶å·®å¼‚ï¼Œç„¶åå†æ¨é€åˆ°è¿œç¨‹ä¸»æœºã€‚è¿™æ—¶ï¼Œå¦‚æœä½ ä¸€å®šè¦æ¨é€ï¼Œå¯ä»¥ä½¿ç”¨<code>--force</code>é€‰é¡¹ã€‚</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git push --force origin </span><br></pre></td></tr></table></figure><p>ä¸Šé¢å‘½ä»¤ä½¿ç”¨<code>--force</code>é€‰é¡¹ï¼Œç»“æœå¯¼è‡´è¿œç¨‹ä¸»æœºä¸Šæ›´æ–°çš„ç‰ˆæœ¬è¢«è¦†ç›–ã€‚é™¤éä½ å¾ˆç¡®å®šè¦è¿™æ ·åšï¼Œå¦åˆ™åº”è¯¥å°½é‡é¿å…ä½¿ç”¨<code>--force</code>é€‰é¡¹ã€‚</p><p>æœ€åï¼Œ<code>git push</code>ä¸ä¼šæ¨é€æ ‡ç­¾ï¼ˆtagï¼‰ï¼Œé™¤éä½¿ç”¨<code>--tags</code>é€‰é¡¹ã€‚</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git push origin --tags</span><br></pre></td></tr></table></figure><h1 id="é€ŸæŸ¥æ‰‹å†Œ"><a href="#é€ŸæŸ¥æ‰‹å†Œ" class="headerlink" title="é€ŸæŸ¥æ‰‹å†Œ"></a>é€ŸæŸ¥æ‰‹å†Œ</h1><h2 id="åˆå§‹åŒ–ä»“åº“"><a href="#åˆå§‹åŒ–ä»“åº“" class="headerlink" title="åˆå§‹åŒ–ä»“åº“"></a>åˆå§‹åŒ–ä»“åº“</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git init</span><br></pre></td></tr></table></figure><h2 id="å°†æ–‡ä»¶æ·»åŠ åˆ°ä»“åº“"><a href="#å°†æ–‡ä»¶æ·»åŠ åˆ°ä»“åº“" class="headerlink" title="å°†æ–‡ä»¶æ·»åŠ åˆ°ä»“åº“"></a>å°†æ–‡ä»¶æ·»åŠ åˆ°ä»“åº“</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git add æ–‡ä»¶å # å°†å·¥ä½œåŒºçš„æŸä¸ªæ–‡ä»¶æ·»åŠ åˆ°æš‚å­˜åŒº   </span><br><span class="line">git add -u # æ·»åŠ æ‰€æœ‰è¢«trackedæ–‡ä»¶ä¸­è¢«ä¿®æ”¹æˆ–åˆ é™¤çš„æ–‡ä»¶ä¿¡æ¯åˆ°æš‚å­˜åŒºï¼Œä¸å¤„ç†untrackedçš„æ–‡ä»¶</span><br><span class="line">git add -A # æ·»åŠ æ‰€æœ‰è¢«trackedæ–‡ä»¶ä¸­è¢«ä¿®æ”¹æˆ–åˆ é™¤çš„æ–‡ä»¶ä¿¡æ¯åˆ°æš‚å­˜åŒºï¼ŒåŒ…æ‹¬untrackedçš„æ–‡ä»¶</span><br><span class="line">git add . # å°†å½“å‰å·¥ä½œåŒºçš„æ‰€æœ‰æ–‡ä»¶éƒ½åŠ å…¥æš‚å­˜åŒº</span><br><span class="line">git add -i # è¿›å…¥äº¤äº’ç•Œé¢æ¨¡å¼ï¼ŒæŒ‰éœ€æ·»åŠ æ–‡ä»¶åˆ°ç¼“å­˜åŒº</span><br></pre></td></tr></table></figure><h2 id="å°†æš‚å­˜åŒºæ–‡ä»¶æäº¤åˆ°æœ¬åœ°ä»“åº“"><a href="#å°†æš‚å­˜åŒºæ–‡ä»¶æäº¤åˆ°æœ¬åœ°ä»“åº“" class="headerlink" title="å°†æš‚å­˜åŒºæ–‡ä»¶æäº¤åˆ°æœ¬åœ°ä»“åº“"></a>å°†æš‚å­˜åŒºæ–‡ä»¶æäº¤åˆ°æœ¬åœ°ä»“åº“</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git commit -m &quot;æäº¤è¯´æ˜&quot; # å°†æš‚å­˜åŒºå†…å®¹æäº¤åˆ°æœ¬åœ°ä»“åº“</span><br><span class="line">git commit -a -m &quot;æäº¤è¯´æ˜&quot; # è·³è¿‡ç¼“å­˜åŒºæ“ä½œï¼Œç›´æ¥æŠŠå·¥ä½œåŒºå†…å®¹æäº¤åˆ°æœ¬åœ°ä»“åº“</span><br></pre></td></tr></table></figure><h2 id="æŸ¥çœ‹ä»“åº“å½“å‰çŠ¶æ€"><a href="#æŸ¥çœ‹ä»“åº“å½“å‰çŠ¶æ€" class="headerlink" title="æŸ¥çœ‹ä»“åº“å½“å‰çŠ¶æ€"></a>æŸ¥çœ‹ä»“åº“å½“å‰çŠ¶æ€</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git status</span><br></pre></td></tr></table></figure><h2 id="æ¯”è¾ƒæ–‡ä»¶å¼‚åŒ"><a href="#æ¯”è¾ƒæ–‡ä»¶å¼‚åŒ" class="headerlink" title="æ¯”è¾ƒæ–‡ä»¶å¼‚åŒ"></a>æ¯”è¾ƒæ–‡ä»¶å¼‚åŒ</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git diff # å·¥ä½œåŒºä¸æš‚å­˜åŒºçš„å·®å¼‚</span><br><span class="line">git diff åˆ†æ”¯å #å·¥ä½œåŒºä¸æŸåˆ†æ”¯çš„å·®å¼‚ï¼Œè¿œç¨‹åˆ†æ”¯è¿™æ ·å†™ï¼šremotes/origin/åˆ†æ”¯å</span><br><span class="line">git diff HEAD  # å·¥ä½œåŒºä¸HEADæŒ‡é’ˆæŒ‡å‘çš„å†…å®¹å·®å¼‚</span><br><span class="line">git diff æäº¤id æ–‡ä»¶è·¯å¾„ # å·¥ä½œåŒºæŸæ–‡ä»¶å½“å‰ç‰ˆæœ¬ä¸å†å²ç‰ˆæœ¬çš„å·®å¼‚</span><br><span class="line">git diff --stage # å·¥ä½œåŒºæ–‡ä»¶ä¸ä¸Šæ¬¡æäº¤çš„å·®å¼‚(1.6 ç‰ˆæœ¬å‰ç”¨ --cached)</span><br><span class="line">git diff ç‰ˆæœ¬TAG # æŸ¥çœ‹ä»æŸä¸ªç‰ˆæœ¬åéƒ½æ”¹åŠ¨å†…å®¹</span><br><span class="line">git diff åˆ†æ”¯A åˆ†æ”¯B # æ¯”è¾ƒä»åˆ†æ”¯Aå’Œåˆ†æ”¯Bçš„å·®å¼‚(ä¹Ÿæ”¯æŒæ¯”è¾ƒä¸¤ä¸ªTAG)</span><br><span class="line">git diff åˆ†æ”¯A...åˆ†æ”¯B # æ¯”è¾ƒä¸¤åˆ†æ”¯åœ¨åˆ†å¼€åå„è‡ªçš„æ”¹åŠ¨</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> å¦å¤–ï¼šå¦‚æœåªæƒ³ç»Ÿè®¡å“ªäº›æ–‡ä»¶è¢«æ”¹åŠ¨ï¼Œå¤šå°‘è¡Œè¢«æ”¹åŠ¨ï¼Œå¯ä»¥æ·»åŠ  --<span class="built_in">stat</span> å‚æ•°</span></span><br></pre></td></tr></table></figure><h2 id="æŸ¥çœ‹å†å²è®°å½•"><a href="#æŸ¥çœ‹å†å²è®°å½•" class="headerlink" title="æŸ¥çœ‹å†å²è®°å½•"></a>æŸ¥çœ‹å†å²è®°å½•</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git log # æŸ¥çœ‹æ‰€æœ‰commitè®°å½•(SHA-Aæ ¡éªŒå’Œï¼Œä½œè€…åç§°ï¼Œé‚®ç®±ï¼Œæäº¤æ—¶é—´ï¼Œæäº¤è¯´æ˜)</span><br><span class="line">git log -p -æ¬¡æ•° # æŸ¥çœ‹æœ€è¿‘å¤šå°‘æ¬¡çš„æäº¤è®°å½•</span><br><span class="line">git log --stat # ç®€ç•¥æ˜¾ç¤ºæ¯æ¬¡æäº¤çš„å†…å®¹æ›´æ”¹</span><br><span class="line">git log --name-only # ä»…æ˜¾ç¤ºå·²ä¿®æ”¹çš„æ–‡ä»¶æ¸…å•</span><br><span class="line">git log --name-status # æ˜¾ç¤ºæ–°å¢ï¼Œä¿®æ”¹ï¼Œåˆ é™¤çš„æ–‡ä»¶æ¸…å•</span><br><span class="line">git log --oneline # è®©æäº¤è®°å½•ä»¥ç²¾ç®€çš„ä¸€è¡Œè¾“å‡º</span><br><span class="line">git log â€“graph â€“all --online # å›¾å½¢å±•ç¤ºåˆ†æ”¯çš„åˆå¹¶å†å²</span><br><span class="line">git log --author=ä½œè€…  # æŸ¥è¯¢ä½œè€…çš„æäº¤è®°å½•(å’ŒgrepåŒæ—¶ä½¿ç”¨è¦åŠ ä¸€ä¸ª--all--matchå‚æ•°)</span><br><span class="line">git log --grep=è¿‡æ»¤ä¿¡æ¯ # åˆ—å‡ºæäº¤ä¿¡æ¯ä¸­åŒ…å«è¿‡æ»¤ä¿¡æ¯çš„æäº¤è®°å½•</span><br><span class="line">git log -SæŸ¥è¯¢å†…å®¹ # å’Œ--grepç±»ä¼¼ï¼ŒSå’ŒæŸ¥è¯¢å†…å®¹é—´æ²¡æœ‰ç©ºæ ¼</span><br><span class="line">git log fileName # æŸ¥çœ‹æŸæ–‡ä»¶çš„ä¿®æ”¹è®°å½•ï¼Œæ‰¾èƒŒé”…ä¸“ç”¨</span><br></pre></td></tr></table></figure><h2 id="ä»£ç å›æ»š"><a href="#ä»£ç å›æ»š" class="headerlink" title="ä»£ç å›æ»š"></a>ä»£ç å›æ»š</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git reset HEAD^ # æ¢å¤æˆä¸Šæ¬¡æäº¤çš„ç‰ˆæœ¬</span><br><span class="line">git reset HEAD^^ # æ¢å¤æˆä¸Šä¸Šæ¬¡æäº¤çš„ç‰ˆæœ¬ï¼Œå°±æ˜¯å¤šä¸ª^ï¼Œä»¥æ­¤ç±»æ¨æˆ–ç”¨~æ¬¡æ•°</span><br><span class="line"></span><br><span class="line">git reflog</span><br><span class="line"></span><br><span class="line">git reset --hard ç‰ˆæœ¬å·</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> --softï¼šåªæ˜¯æ”¹å˜HEADæŒ‡é’ˆæŒ‡å‘ï¼Œç¼“å­˜åŒºå’Œå·¥ä½œåŒºä¸å˜ï¼›</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> --mixedï¼šä¿®æ”¹HEADæŒ‡é’ˆæŒ‡å‘ï¼Œæš‚å­˜åŒºå†…å®¹ä¸¢å¤±ï¼Œå·¥ä½œåŒºä¸å˜ï¼›</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> --hardï¼šä¿®æ”¹HEADæŒ‡é’ˆæŒ‡å‘ï¼Œæš‚å­˜åŒºå†…å®¹ä¸¢å¤±ï¼Œå·¥ä½œåŒºæ¢å¤ä»¥å‰çŠ¶æ€ï¼›</span></span><br></pre></td></tr></table></figure><h2 id="åŒæ­¥è¿œç¨‹ä»“åº“"><a href="#åŒæ­¥è¿œç¨‹ä»“åº“" class="headerlink" title="åŒæ­¥è¿œç¨‹ä»“åº“"></a>åŒæ­¥è¿œç¨‹ä»“åº“</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git push -u origin master</span><br></pre></td></tr></table></figure><h2 id="åˆ é™¤ç‰ˆæœ¬åº“æ–‡ä»¶"><a href="#åˆ é™¤ç‰ˆæœ¬åº“æ–‡ä»¶" class="headerlink" title="åˆ é™¤ç‰ˆæœ¬åº“æ–‡ä»¶"></a>åˆ é™¤ç‰ˆæœ¬åº“æ–‡ä»¶</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git rm æ–‡ä»¶å</span><br></pre></td></tr></table></figure><h2 id="ç‰ˆæœ¬åº“é‡Œçš„ç‰ˆæœ¬æ›¿æ¢å·¥ä½œåŒºçš„ç‰ˆæœ¬"><a href="#ç‰ˆæœ¬åº“é‡Œçš„ç‰ˆæœ¬æ›¿æ¢å·¥ä½œåŒºçš„ç‰ˆæœ¬" class="headerlink" title="ç‰ˆæœ¬åº“é‡Œçš„ç‰ˆæœ¬æ›¿æ¢å·¥ä½œåŒºçš„ç‰ˆæœ¬"></a>ç‰ˆæœ¬åº“é‡Œçš„ç‰ˆæœ¬æ›¿æ¢å·¥ä½œåŒºçš„ç‰ˆæœ¬</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git checkout -- test.txt</span><br></pre></td></tr></table></figure><h2 id="æœ¬åœ°ä»“åº“å†…å®¹æ¨é€åˆ°è¿œç¨‹ä»“åº“"><a href="#æœ¬åœ°ä»“åº“å†…å®¹æ¨é€åˆ°è¿œç¨‹ä»“åº“" class="headerlink" title="æœ¬åœ°ä»“åº“å†…å®¹æ¨é€åˆ°è¿œç¨‹ä»“åº“"></a>æœ¬åœ°ä»“åº“å†…å®¹æ¨é€åˆ°è¿œç¨‹ä»“åº“</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git remote add origin git@github.com:å¸å·å/ä»“åº“å.git</span><br></pre></td></tr></table></figure><h2 id="ä»è¿œç¨‹ä»“åº“å…‹éš†é¡¹ç›®åˆ°æœ¬åœ°"><a href="#ä»è¿œç¨‹ä»“åº“å…‹éš†é¡¹ç›®åˆ°æœ¬åœ°" class="headerlink" title="ä»è¿œç¨‹ä»“åº“å…‹éš†é¡¹ç›®åˆ°æœ¬åœ°"></a>ä»è¿œç¨‹ä»“åº“å…‹éš†é¡¹ç›®åˆ°æœ¬åœ°</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git clone git@github.com:gitå¸å·å/ä»“åº“å.git</span><br></pre></td></tr></table></figure><h2 id="åˆ›å»ºåˆ†æ”¯"><a href="#åˆ›å»ºåˆ†æ”¯" class="headerlink" title="åˆ›å»ºåˆ†æ”¯"></a>åˆ›å»ºåˆ†æ”¯</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git checkout -b dev</span><br><span class="line"><span class="meta">#</span><span class="bash"> -bè¡¨ç¤ºåˆ›å»ºå¹¶åˆ‡æ¢åˆ†æ”¯</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> ä¸Šé¢ä¸€æ¡å‘½ä»¤ç›¸å½“äºä¸€é¢çš„äºŒæ¡ï¼š</span></span><br><span class="line">git branch dev # åˆ›å»ºåˆ†æ”¯</span><br><span class="line">git checkout dev # åˆ‡æ¢åˆ†æ”¯</span><br></pre></td></tr></table></figure><h2 id="æŸ¥çœ‹åˆ†æ”¯"><a href="#æŸ¥çœ‹åˆ†æ”¯" class="headerlink" title="æŸ¥çœ‹åˆ†æ”¯"></a>æŸ¥çœ‹åˆ†æ”¯</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git branch</span><br></pre></td></tr></table></figure><h2 id="åˆå¹¶åˆ†æ”¯"><a href="#åˆå¹¶åˆ†æ”¯" class="headerlink" title="åˆå¹¶åˆ†æ”¯"></a>åˆå¹¶åˆ†æ”¯</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git merge dev</span><br><span class="line"><span class="meta">#</span><span class="bash"> ç”¨äºåˆå¹¶æŒ‡å®šåˆ†æ”¯åˆ°å½“å‰åˆ†æ”¯</span></span><br><span class="line"></span><br><span class="line">git merge --no-ff -m &quot;merge with no-ff&quot; dev</span><br><span class="line"><span class="meta">#</span><span class="bash"> åŠ ä¸Š--no-ffå‚æ•°å°±å¯ä»¥ç”¨æ™®é€šæ¨¡å¼åˆå¹¶ï¼Œåˆå¹¶åçš„å†å²æœ‰åˆ†æ”¯ï¼Œèƒ½çœ‹å‡ºæ¥æ›¾ç»åšè¿‡åˆå¹¶</span></span><br></pre></td></tr></table></figure><h2 id="åˆ é™¤åˆ†æ”¯"><a href="#åˆ é™¤åˆ†æ”¯" class="headerlink" title="åˆ é™¤åˆ†æ”¯"></a>åˆ é™¤åˆ†æ”¯</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git branch -d dev</span><br></pre></td></tr></table></figure><h2 id="æŸ¥çœ‹åˆ†æ”¯åˆå¹¶å›¾"><a href="#æŸ¥çœ‹åˆ†æ”¯åˆå¹¶å›¾" class="headerlink" title="æŸ¥çœ‹åˆ†æ”¯åˆå¹¶å›¾"></a>æŸ¥çœ‹åˆ†æ”¯åˆå¹¶å›¾</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git log --graph --pretty=oneline --abbrev-commit</span><br></pre></td></tr></table></figure><h2 id="æŸ¥çœ‹è¿œç¨‹åº“ä¿¡æ¯"><a href="#æŸ¥çœ‹è¿œç¨‹åº“ä¿¡æ¯" class="headerlink" title="æŸ¥çœ‹è¿œç¨‹åº“ä¿¡æ¯"></a>æŸ¥çœ‹è¿œç¨‹åº“ä¿¡æ¯</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git remote</span><br><span class="line"><span class="meta">#</span><span class="bash"> -v æ˜¾ç¤ºæ›´è¯¦ç»†çš„ä¿¡æ¯</span></span><br></pre></td></tr></table></figure><h2 id="gitç›¸å…³é…ç½®"><a href="#gitç›¸å…³é…ç½®" class="headerlink" title="gitç›¸å…³é…ç½®"></a>gitç›¸å…³é…ç½®</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> å®‰è£…å®ŒGitåç¬¬ä¸€ä»¶è¦åšçš„äº‹ï¼Œè®¾ç½®ç”¨æˆ·ä¿¡æ¯(globalå¯æ¢æˆ<span class="built_in">local</span>åœ¨å•ç‹¬é¡¹ç›®ç”Ÿæ•ˆ)ï¼š</span></span><br><span class="line">git config --global user.name &quot;ç”¨æˆ·å&quot; # è®¾ç½®ç”¨æˆ·å</span><br><span class="line">git config --global user.email &quot;ç”¨æˆ·é‚®ç®±&quot;   #è®¾ç½®é‚®ç®±</span><br><span class="line">git config --global user.name   # æŸ¥çœ‹ç”¨æˆ·åæ˜¯å¦é…ç½®æˆåŠŸ</span><br><span class="line">git config --global user.email   # æŸ¥çœ‹é‚®ç®±æ˜¯å¦é…ç½®</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> å…¶ä»–æŸ¥çœ‹é…ç½®ç›¸å…³</span></span><br><span class="line">git config --global --list  # æŸ¥çœ‹å…¨å±€è®¾ç½®ç›¸å…³å‚æ•°åˆ—è¡¨</span><br><span class="line">git config --local --list # æŸ¥çœ‹æœ¬åœ°è®¾ç½®ç›¸å…³å‚æ•°åˆ—è¡¨</span><br><span class="line">git config --system --list # æŸ¥çœ‹ç³»ç»Ÿé…ç½®å‚æ•°åˆ—è¡¨</span><br><span class="line">git config --list  # æŸ¥çœ‹æ‰€æœ‰Gitçš„é…ç½®(å…¨å±€+æœ¬åœ°+ç³»ç»Ÿ)</span><br><span class="line">git config --global color.ui true //æ˜¾ç¤ºgitç›¸å…³é¢œè‰²</span><br></pre></td></tr></table></figure><h2 id="æ’¤æ¶ˆæŸæ¬¡æäº¤"><a href="#æ’¤æ¶ˆæŸæ¬¡æäº¤" class="headerlink" title="æ’¤æ¶ˆæŸæ¬¡æäº¤"></a>æ’¤æ¶ˆæŸæ¬¡æäº¤</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git revert HEAD # æ’¤é”€æœ€è¿‘çš„ä¸€ä¸ªæäº¤</span><br><span class="line">git revert ç‰ˆæœ¬å· # æ’¤é”€æŸæ¬¡commit</span><br></pre></td></tr></table></figure><h2 id="æ‹‰å–è¿œç¨‹åˆ†æ”¯åˆ°æœ¬åœ°ä»“åº“"><a href="#æ‹‰å–è¿œç¨‹åˆ†æ”¯åˆ°æœ¬åœ°ä»“åº“" class="headerlink" title="æ‹‰å–è¿œç¨‹åˆ†æ”¯åˆ°æœ¬åœ°ä»“åº“"></a>æ‹‰å–è¿œç¨‹åˆ†æ”¯åˆ°æœ¬åœ°ä»“åº“</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git checkout -b æœ¬åœ°åˆ†æ”¯ è¿œç¨‹åˆ†æ”¯ # ä¼šåœ¨æœ¬åœ°æ–°å»ºåˆ†æ”¯ï¼Œå¹¶è‡ªåŠ¨åˆ‡æ¢åˆ°è¯¥åˆ†æ”¯</span><br><span class="line">git fetch origin è¿œç¨‹åˆ†æ”¯:æœ¬åœ°åˆ†æ”¯ # ä¼šåœ¨æœ¬åœ°æ–°å»ºåˆ†æ”¯ï¼Œä½†ä¸ä¼šè‡ªåŠ¨åˆ‡æ¢ï¼Œè¿˜éœ€checkout</span><br><span class="line">git branch --set-upstream æœ¬åœ°åˆ†æ”¯ è¿œç¨‹åˆ†æ”¯ # å»ºç«‹æœ¬åœ°åˆ†æ”¯ä¸è¿œç¨‹åˆ†æ”¯çš„é“¾æ¥</span><br></pre></td></tr></table></figure><h2 id="æ ‡ç­¾å‘½ä»¤"><a href="#æ ‡ç­¾å‘½ä»¤" class="headerlink" title="æ ‡ç­¾å‘½ä»¤"></a>æ ‡ç­¾å‘½ä»¤</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">git tag &lt;æ ‡ç­¾&gt; # æ‰“æ ‡ç­¾å‘½ä»¤ï¼Œé»˜è®¤ä¸ºHEAD</span><br><span class="line">git tag # æ˜¾ç¤ºæ‰€æœ‰æ ‡ç­¾</span><br><span class="line">git tag &lt;æ ‡ç­¾ ?ç‰ˆæœ¬å·&gt; # ç»™æŸä¸ªcommitç‰ˆæœ¬æ·»åŠ æ ‡ç­¾</span><br><span class="line">git show &lt;æ ‡ç­¾&gt; # æ˜¾ç¤ºæŸä¸ªæ ‡ç­¾çš„è¯¦ç»†ä¿¡æ¯</span><br></pre></td></tr></table></figure><h2 id="åŒæ­¥è¿œç¨‹ä»“åº“æ›´æ–°"><a href="#åŒæ­¥è¿œç¨‹ä»“åº“æ›´æ–°" class="headerlink" title="åŒæ­¥è¿œç¨‹ä»“åº“æ›´æ–°"></a>åŒæ­¥è¿œç¨‹ä»“åº“æ›´æ–°</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git fetch  origin master</span><br><span class="line"><span class="meta">#</span><span class="bash"> ä»è¿œç¨‹è·å–æœ€æ–°çš„åˆ°æœ¬åœ°ï¼Œé¦–å…ˆä»è¿œç¨‹çš„originçš„masterä¸»åˆ†æ”¯ä¸‹è½½æœ€æ–°çš„ç‰ˆæœ¬åˆ°origin/masteråˆ†æ”¯ä¸Šï¼Œç„¶åæ¯”è¾ƒæœ¬åœ°çš„masteråˆ†æ”¯å’Œorigin/masteråˆ†æ”¯çš„å·®åˆ«ï¼Œæœ€åè¿›è¡Œåˆå¹¶ã€‚</span></span><br><span class="line"></span><br><span class="line">git fetchæ¯”git pullæ›´åŠ å®‰å…¨</span><br></pre></td></tr></table></figure><h1 id="ä¸å¸¸è§ä½†å®ç”¨çš„å‘½ä»¤"><a href="#ä¸å¸¸è§ä½†å®ç”¨çš„å‘½ä»¤" class="headerlink" title="ä¸å¸¸è§ä½†å®ç”¨çš„å‘½ä»¤"></a>ä¸å¸¸è§ä½†å®ç”¨çš„å‘½ä»¤</h1><h2 id="æ‹‰å–è¿œç¨‹ä»£ç å¹¶ä¸”è¦†ç›–æœ¬åœ°æ›´æ”¹"><a href="#æ‹‰å–è¿œç¨‹ä»£ç å¹¶ä¸”è¦†ç›–æœ¬åœ°æ›´æ”¹" class="headerlink" title="æ‹‰å–è¿œç¨‹ä»£ç å¹¶ä¸”è¦†ç›–æœ¬åœ°æ›´æ”¹"></a>æ‹‰å–è¿œç¨‹ä»£ç å¹¶ä¸”è¦†ç›–æœ¬åœ°æ›´æ”¹</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git fetch origin &amp;&amp; git reset â€“hard origin/master</span><br></pre></td></tr></table></figure><h2 id="åˆ—å‡ºè¿œç¨‹å’Œæœ¬åœ°æ‰€æœ‰åˆ†æ”¯"><a href="#åˆ—å‡ºè¿œç¨‹å’Œæœ¬åœ°æ‰€æœ‰åˆ†æ”¯" class="headerlink" title="åˆ—å‡ºè¿œç¨‹å’Œæœ¬åœ°æ‰€æœ‰åˆ†æ”¯"></a>åˆ—å‡ºè¿œç¨‹å’Œæœ¬åœ°æ‰€æœ‰åˆ†æ”¯</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git branch -a</span><br><span class="line">git branch -r</span><br></pre></td></tr></table></figure><h2 id="å¼ºåˆ¶æ›´æ–°è¿œç¨‹åˆ†æ”¯"><a href="#å¼ºåˆ¶æ›´æ–°è¿œç¨‹åˆ†æ”¯" class="headerlink" title="å¼ºåˆ¶æ›´æ–°è¿œç¨‹åˆ†æ”¯"></a>å¼ºåˆ¶æ›´æ–°è¿œç¨‹åˆ†æ”¯</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git push origin master -f</span><br></pre></td></tr></table></figure><h2 id="å›æ»šä¸€ä¸ª-merge"><a href="#å›æ»šä¸€ä¸ª-merge" class="headerlink" title="å›æ»šä¸€ä¸ª merge"></a>å›æ»šä¸€ä¸ª merge</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git revert -m 1 xxxx</span><br></pre></td></tr></table></figure><h2 id="ä¿®æ”¹ä¹‹å‰çš„æäº¤è®°å½•æˆ–è€…å¾ˆä¹…å‰æäº¤çš„è®°å½•"><a href="#ä¿®æ”¹ä¹‹å‰çš„æäº¤è®°å½•æˆ–è€…å¾ˆä¹…å‰æäº¤çš„è®°å½•" class="headerlink" title="ä¿®æ”¹ä¹‹å‰çš„æäº¤è®°å½•æˆ–è€…å¾ˆä¹…å‰æäº¤çš„è®°å½•"></a>ä¿®æ”¹ä¹‹å‰çš„æäº¤è®°å½•æˆ–è€…å¾ˆä¹…å‰æäº¤çš„è®°å½•</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git rebase â€“interactive ID^</span><br></pre></td></tr></table></figure><p>å°†éœ€è¦ä¿®æ”¹çš„è®°å½•çš„ <code>pick</code> æ”¹æˆ <code>edit</code>ï¼Œæ‰§è¡Œæ›´æ”¹ï¼š</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git commit â€“all â€“amend</span><br><span class="line">git rebase â€“continue</span><br></pre></td></tr></table></figure><h2 id="ä½¿ç”¨å¤šä¸ªè¿œç¨‹ä»£ç åº“ï¼Œå¹¶ä¸”ä½¿ç”¨å¤šä¸ªä¸åŒçš„-SSH-Key"><a href="#ä½¿ç”¨å¤šä¸ªè¿œç¨‹ä»£ç åº“ï¼Œå¹¶ä¸”ä½¿ç”¨å¤šä¸ªä¸åŒçš„-SSH-Key" class="headerlink" title="ä½¿ç”¨å¤šä¸ªè¿œç¨‹ä»£ç åº“ï¼Œå¹¶ä¸”ä½¿ç”¨å¤šä¸ªä¸åŒçš„ SSH Key"></a>ä½¿ç”¨å¤šä¸ªè¿œç¨‹ä»£ç åº“ï¼Œå¹¶ä¸”ä½¿ç”¨å¤šä¸ªä¸åŒçš„ SSH Key</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">Host bitbucket.org</span><br><span class="line">HostName bitbucket.org</span><br><span class="line">PreferredAuthentications publickey</span><br><span class="line">IdentityFile ~/.ssh/id_rsa</span><br><span class="line">User git</span><br><span class="line"></span><br><span class="line">Host bitbucket.org-key2</span><br><span class="line">HostName bitbucket.org</span><br><span class="line">IdentityFile ~/.ssh/key2_id_rsa</span><br><span class="line">User git</span><br></pre></td></tr></table></figure><p>ä¿®æ”¹ <code>.git/config</code>ï¼š</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[remote â€œoriginâ€]</span><br><span class="line">url = git@bitbucket.org-key2:XXXX/yyyy.git</span><br><span class="line">fetch = +refs/heads/*:refs/remotes/origin/*</span><br></pre></td></tr></table></figure><h2 id="å’Œå¤–éƒ¨å›¢é˜Ÿåä½œéœ€è¦çš„ç»´æŠ¤å¤šä¸ªè¿œç¨‹åº“ï¼Œåˆå¹¶å…¶ä»–åº“çš„æ›´æ–°çš„è¿‡ç¨‹"><a href="#å’Œå¤–éƒ¨å›¢é˜Ÿåä½œéœ€è¦çš„ç»´æŠ¤å¤šä¸ªè¿œç¨‹åº“ï¼Œåˆå¹¶å…¶ä»–åº“çš„æ›´æ–°çš„è¿‡ç¨‹" class="headerlink" title="å’Œå¤–éƒ¨å›¢é˜Ÿåä½œéœ€è¦çš„ç»´æŠ¤å¤šä¸ªè¿œç¨‹åº“ï¼Œåˆå¹¶å…¶ä»–åº“çš„æ›´æ–°çš„è¿‡ç¨‹"></a>å’Œå¤–éƒ¨å›¢é˜Ÿåä½œéœ€è¦çš„ç»´æŠ¤å¤šä¸ªè¿œç¨‹åº“ï¼Œåˆå¹¶å…¶ä»–åº“çš„æ›´æ–°çš„è¿‡ç¨‹</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git remote rename origin upstream</span><br><span class="line">git remote add origin URL_TO_GITHUB_REPO</span><br><span class="line">git push origin master</span><br><span class="line">git pull upstream master &amp;&amp; git push origin master</span><br></pre></td></tr></table></figure><h2 id="æ’¤é”€-Git-çš„æœ€åä¸€æ¬¡æäº¤"><a href="#æ’¤é”€-Git-çš„æœ€åä¸€æ¬¡æäº¤" class="headerlink" title="æ’¤é”€ Git çš„æœ€åä¸€æ¬¡æäº¤"></a>æ’¤é”€ Git çš„æœ€åä¸€æ¬¡æäº¤</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git reset â€“soft HEAD~1</span><br></pre></td></tr></table></figure><h1 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h1><ul><li><a href="http://www.ruanyifeng.com/">é˜®ä¸€å³°çš„ç½‘ç»œæ—¥å¿—</a></li><li><strong>èŠ‹é“æºç </strong> å¾®ä¿¡å…¬ä¼—å·</li></ul>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®°æœ¬ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Git </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä½¿ç”¨ä¸ªäººå…¬ä¼—å·æˆ–IOSå¿«æ·æŒ‡ä»¤å‘ã€ŒåŠ¨æ€ã€åˆ°hexoåšå®¢</title>
      <link href="post/3385be1c/"/>
      <url>post/3385be1c/</url>
      
        <content type="html"><![CDATA[<h2 id="åˆè¡·"><a href="#åˆè¡·" class="headerlink" title="åˆè¡·"></a>åˆè¡·</h2><ul><li>ä¸å–œæ¬¢åœ¨æœ‹å‹åœˆå‘åŠ¨æ€ï¼ˆæ¯•ç«Ÿå¾®å•†çš„åœ°ç›˜ï¼‰</li><li>ä¸å–œæ¬¢åœ¨å¾®åšå‘åŠ¨æ€ï¼ˆéƒ½æ˜¯åƒåœ¾ä¿¡æ¯ï¼Œè´¦å·éƒ½æ³¨é”€äº†ï¼‰</li></ul><blockquote><p> äºæ˜¯ â€“</p><p>å¯»æ‰¾ä¸€å¤„å¯ä»¥å®Œå…¨ç”±è‡ªå·±å®šåˆ¶çš„ï¼Œæ–¹ä¾¿ä¿å­˜è‡ªå·±çš„ä¸€äº›ç¢ç‰‡åŒ–æ€è€ƒå’ŒåŠ¨æ€çš„åœ°æ–¹å°±æˆäº†è¿™æ¬¡æŠ˜è…¾çš„ç›®æ ‡</p></blockquote><h2 id="å¯»æ‰¾è§£å†³æ–¹æ¡ˆ"><a href="#å¯»æ‰¾è§£å†³æ–¹æ¡ˆ" class="headerlink" title="å¯»æ‰¾è§£å†³æ–¹æ¡ˆ"></a>å¯»æ‰¾è§£å†³æ–¹æ¡ˆ</h2><p>ç»è¿‡ä¸€ç•ª<strong>Googleå¤§æ³•</strong>ä¹Ÿæ˜¯æ‰¾åˆ°äº†å‡ ä¸ªå¯ä»¥å®ç°è¿™ä¸ªéœ€æ±‚çš„æ–¹æ¡ˆã€‚</p><h3 id="Artitalk-js"><a href="#Artitalk-js" class="headerlink" title="Artitalk.js"></a><a href="https://artitalk.js.org/">Artitalk.js</a></h3><blockquote><p>åŸºäº LeanCloud å®ç°çš„å¯å®æ—¶å‘å¸ƒè¯´è¯´/å¾®è¯­çš„ jsã€‚</p></blockquote><ul><li><p>ğŸ¤ä½¿ç”¨æ–¹ä¾¿</p><p>ç®€ç•¥çš„ html ç‰‡æ®µå³å¯å®ç°ï¼Œä¸”ç†è®ºä¸Šæ”¯æŒä»»ä½•æ¡†æ¶æˆ–å•ç‹¬é¡µé¢ã€‚</p></li><li><p>ğŸ”å®‰å…¨æ€§é«˜</p><p>ç›´æ¥é€šè¿‡ LeanCloud çš„ç”¨æˆ·ç³»ç»Ÿï¼Œä¿è¯åªæœ‰ç«™é•¿å¯æ§å‘å¸ƒæƒé™ã€‚</p></li><li><p>ğŸå¤šåŠŸèƒ½è¾“å…¥</p><p>å¤šåŠŸèƒ½è¾“å…¥æ¡†ï¼Œæ»¡è¶³ä½ çš„ä¸€åˆ‡éœ€æ±‚</p></li></ul><p>ä½¿ç”¨äº†ä¸€æ®µæ—¶é—´ï¼Œäº¤äº’ä½“éªŒæ–¹é¢åšçš„è¿˜ä¸é”™ï¼Œæ ·å¼ä¹Ÿæ¯”è¾ƒå®Œå–„ï¼š</p><p><img src="https://gitee.com/cayzlh/img-repo/raw/master/2021/02/21253516143459351614345935610.png" alt="image-20210226212534781"></p><p><em>ç¼ºç‚¹æ˜¯ä½†æ˜¯æ¯æ¬¡å‘è¡¨åŠ¨æ€å¿…é¡»æ‰“å¼€é¡µé¢ç™»å½•åè¿›è¡Œã€‚</em></p><h3 id="BBTalk"><a href="#BBTalk" class="headerlink" title="BBTalk"></a><a href="https://bb.js.org/">BBTalk</a></h3><blockquote><p>åˆ©ç”¨æ‰‹æœºå¾®ä¿¡éšæ—¶éšåœ°å‘å¸ƒç¢ç‰‡åŒ–æ€æƒ³ï¼ŒåŸºäº <strong>Leancloud</strong>ã€‚</p></blockquote><ul><li><p>ğŸ“²éšæ—¶å‘é€</p><p>æ‹¿å‡ºæ‰‹æœºå³å¯å‘é€ç¢ç‰‡åŒ–æ€æƒ³ï¼Œå¹¶åŒæ­¥åšå®¢æ˜¾ç¤ºã€‚</p></li><li><p>ğŸ¤ä½¿ç”¨æ–¹ä¾¿</p><p>ç®€ç•¥çš„ html ç‰‡æ®µå³å¯å®ç°ï¼Œä¸”ç†è®ºä¸Šæ”¯æŒä»»ä½•æ¡†æ¶æˆ–å•ç‹¬é¡µé¢ã€‚</p></li><li><p>ğŸæ“ä½œç®€å•</p><p>å¾®ä¿¡ç«¯ç›´æ¥å‘é€æ–‡å­—ã€è¡¨æƒ…ä»¥åŠå›¾ç‰‡ï¼Œå¹¶æ”¯æŒå¤–é“¾å›¾ç‰‡ã€‚</p></li></ul><p>æ¥è‡ª<code>Hexo</code>å»ºç«™ç¾¤ç¾¤ä¸»å¤§ä½¬çš„å·¨ä½œï¼Œå¯ä»¥æ»¡è¶³éšæ—¶éšåœ°å…ç™»å½•é€šè¿‡å¾®ä¿¡å…¬ä¼—å·æ¥å‘è¡¨åŠ¨æ€ã€‚</p><h3 id="ã€Œå“”å“”ç‚¹å•¥ã€å¾®ä¿¡å…¬ä¼—å·-2-0"><a href="#ã€Œå“”å“”ç‚¹å•¥ã€å¾®ä¿¡å…¬ä¼—å·-2-0" class="headerlink" title="ã€Œå“”å“”ç‚¹å•¥ã€å¾®ä¿¡å…¬ä¼—å· 2.0"></a><a href="https://immmmm.com/bb-by-wechat-pro/">ã€Œå“”å“”ç‚¹å•¥ã€å¾®ä¿¡å…¬ä¼—å· 2.0</a></h3><p>ä¸<strong>BBTalk</strong>ç±»ä¼¼ï¼Œä¹Ÿå¯ä»¥éšæ„éšåœ°é€šè¿‡ç‰¹å®šçš„å…¬ä¼—å·å‘é€ã€‚</p><p>å…·ä½“æ­å»ºæ­¥éª¤åœ¨è¿™ä¸ªå¸–å­é‡Œéƒ½æœ‰ã€‚</p><blockquote><p><strong>ã€Œå“”å“”ç‚¹å•¥ã€</strong>çš„ä¼˜ç‚¹åœ¨äºå®ƒæ˜¯åŸºäº<strong>ã€Œè…¾è®¯ CloudBaseã€</strong>æ¥å®ç°çš„ã€‚</p><blockquote><p>åŒæ—¶è¯¥åšä¸»ä¹Ÿæä¾›äº†ã€Œbber-weixinã€çš„ä»£ç ï¼Œè¿™æ ·å°±å¯ä»¥åˆ©ç”¨è‡ªå·±ç”³è¯·çš„å…¬ä¼—å·æ¥å®ç°è¿™ä¸ªå‘è¡¨åŠ¨æ€çš„éœ€æ±‚ï¼Œä¸€åˆ‡éƒ½ç”±è‡ªå·±æŒæ§ã€‚</p></blockquote></blockquote><h2 id="æŠ˜è…¾ing"><a href="#æŠ˜è…¾ing" class="headerlink" title="æŠ˜è…¾ing"></a>æŠ˜è…¾ing</h2><p>å› ä¸ºè‡ªå·±å¯¹äº‘å‡½æ•°ä¹Ÿæœ‰ä¸€å®šçš„äº†è§£ï¼Œäºæ˜¯å°±æ‹¿äº†ã€Œå“”å“”ç‚¹å•¥ã€æ¥å®ç°è‡ªå·±çš„åŠ¨æ€é¡µã€‚</p><p>æ­å»ºæ­¥éª¤å‚è€ƒ<a href="https://immmmm.com/bb-by-wechat-pro/">ã€Œå“”å“”ç‚¹å•¥ã€å¾®ä¿¡å…¬ä¼—å· 2.0</a>ï¼Œé‡ç‚¹è®°å½•ä¸€ä¸‹è¸©å‘ä¸è‡ªå®šä¹‰éƒ¨åˆ†ã€‚</p><h3 id="è¸©å‘"><a href="#è¸©å‘" class="headerlink" title="è¸©å‘"></a>è¸©å‘</h3><h4 id="å¹¿å·åœ°åŒºäº‘å¼€å‘ç¯å¢ƒæ— æ³•è¯»å–æ•°æ®"><a href="#å¹¿å·åœ°åŒºäº‘å¼€å‘ç¯å¢ƒæ— æ³•è¯»å–æ•°æ®" class="headerlink" title="å¹¿å·åœ°åŒºäº‘å¼€å‘ç¯å¢ƒæ— æ³•è¯»å–æ•°æ®"></a>å¹¿å·åœ°åŒºäº‘å¼€å‘ç¯å¢ƒæ— æ³•è¯»å–æ•°æ®</h4><p>ç”±äºæˆ‘ç”³è¯·çš„äº‘å¼€å‘ç¯å¢ƒæ˜¯å¹¿å·åœ°åŒºçš„ï¼Œç…§ç€è¯¥æ–‡ç« çš„æ­¥éª¤ä¸€é¡¿æ“ä½œä¹‹åï¼Œå‘ç°æ— æ³•åŠ è½½æ•°æ®ï¼ŒæŠ¥ä»¥ä¸‹é”™ï¼š</p><p><img src="https://gitee.com/cayzlh/img-repo/raw/master/2021/02/22021616143481361614348136416.png" alt="image-20210226220215864"></p><p>ğŸ˜± è¿™å°±å¾ˆéš¾å—äº†ï¼Œäºæ˜¯è”ç³»ä½œè€…ï¼ŒæŸ¥é˜…èµ„æ–™ï¼Œå‘ç°æ˜¯éƒ¨ç½²å‰ç«¯çš„æ—¶å€™å¼•å…¥çš„äº‘å¼€å‘sdkç‰ˆæœ¬å¤ªä½äº†ã€‚</p><p><strong>è§£å†³ï¼š</strong></p><p>å°†ä»¥ä¸‹ä»£ç ï¼š</p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.jsdelivr.net/gh/TencentCloudBase/tcb-js-sdk@master/tcbjs/1.10.10/tcb.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>æ›¿æ¢æˆï¼š</p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">src</span>=<span class="string">&quot;https://imgcache.qq.com/qcloud/cloudbase-js-sdk/1.4.0/cloudbase.full.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>ä½¿ç”¨æœ€æ–°ç‰ˆçš„äº‘å¼€å‘SDKä¹‹åï¼Œé—®é¢˜è§£å†³ã€‚</p><p><em>å¦‚æœè¿˜æ˜¯ä¸èƒ½åŠ è½½æ•°æ®ï¼Œé‚£ä¹ˆæ¸…é™¤ä¸€ä¸‹æµè§ˆå™¨ç¼“å­˜ä¸€èˆ¬å°±å¯ä»¥äº†ï¼ˆç±»ä¼¼å›¾ä¸­è¿™äº›ï¼‰ï¼š</em></p><p><img src="https://gitee.com/cayzlh/img-repo/raw/master/2021/02/22071616143484361614348436495.png" alt="image-20210226220715714"></p><h4 id="å¾®ä¿¡å…¬ä¼—å·æœåŠ¡å™¨é…ç½®å¤±è´¥"><a href="#å¾®ä¿¡å…¬ä¼—å·æœåŠ¡å™¨é…ç½®å¤±è´¥" class="headerlink" title="å¾®ä¿¡å…¬ä¼—å·æœåŠ¡å™¨é…ç½®å¤±è´¥"></a>å¾®ä¿¡å…¬ä¼—å·æœåŠ¡å™¨é…ç½®å¤±è´¥</h4><p>è·Ÿç€æ­¥éª¤èµ°ï¼Œéƒ¨ç½²<code>bber-weixin</code>ï¼Œåœ¨é…ç½®å…¬ä¼—å·æœåŠ¡å™¨çš„æ—¶å€™ï¼Œæç¤ºâ€œå‚æ•°é”™è¯¯ï¼Œè¯·é‡æ–°å¡«å†™â€ï¼š</p><p><img src="https://gitee.com/cayzlh/img-repo/raw/master/2021/02/22100016143486001614348600180.png" alt="image-20210226220959747"></p><p>å¦‚æœå…¶ä»–é…ç½®éƒ½æ²¡æœ‰é—®é¢˜ï¼Œæ€ä¹ˆæ£€æŸ¥éƒ½æç¤ºâ€œå‚æ•°é”™è¯¯ï¼Œè¯·é‡æ–°å¡«å†™â€ï¼Œé‚£ä¹ˆæœ‰å¯èƒ½æ˜¯å› ä¸ºäº‘å‡½æ•°é»˜è®¤è®¿é—®åŸŸåè¢«å¾®ä¿¡å±è”½äº†ï¼Œè¯·æ±‚æ— æ³•åˆ°è¾¾å¯¼è‡´ã€‚</p><p><img src="https://gitee.com/cayzlh/img-repo/raw/master/2021/02/22113816143486981614348698954.png" alt="image-20210226221138586"></p><p>è§£å†³æ–¹æ³•ä¹Ÿæ˜¯å¾ˆç®€å•ï¼Œåœ¨äº‘å¼€å‘çš„<strong>HTTPè®¿é—®æœåŠ¡</strong>ç»™äº‘å‡½æ•°åˆ†é…ä¸€ä¸ªè‡ªå®šä¹‰åŸŸåå¹¶ä½¿ç”¨å³å¯ã€‚</p><p><img src="https://gitee.com/cayzlh/img-repo/raw/master/2021/02/22141116143488511614348851595.png" alt="image-20210226221411096"></p><h3 id="è‡ªå®šä¹‰"><a href="#è‡ªå®šä¹‰" class="headerlink" title="è‡ªå®šä¹‰"></a>è‡ªå®šä¹‰</h3><h4 id="å®šåˆ¶bber-js"><a href="#å®šåˆ¶bber-js" class="headerlink" title="å®šåˆ¶bber.js"></a>å®šåˆ¶bber.js</h4><p>å…¶å®ä¹Ÿå¾ˆç®€å•ï¼Œå°†<code>bber.js</code>ä¸‹è½½ä¸‹æ¥ç ”ç©¶å®ƒã€‚</p><p>å¼„æ¸…æ¥šå®ƒé€»è¾‘ä¹‹åï¼Œåšè‡ªå·±æƒ³åšçš„äº‹ï¼Œå®ç°è‡ªå·±çš„é€»è¾‘ã€‚</p><h4 id="ä½¿ç”¨IOSå¿«æ·æŒ‡ä»¤å‘åŠ¨æ€"><a href="#ä½¿ç”¨IOSå¿«æ·æŒ‡ä»¤å‘åŠ¨æ€" class="headerlink" title="ä½¿ç”¨IOSå¿«æ·æŒ‡ä»¤å‘åŠ¨æ€"></a>ä½¿ç”¨IOSå¿«æ·æŒ‡ä»¤å‘åŠ¨æ€</h4><p>åœ¨æ‘¸é€äº†æ•´ä¸ªæµç¨‹çš„é€»è¾‘ä¹‹åï¼Œå…¶å®ä¸éš¾å‘ç°ï¼Œæƒ³è¦å‘åŠ¨æ€ï¼Œåªéœ€è¦å‘ä¸‹é¢çš„é“¾æ¥å‘é€<code>POST</code>æˆ–<code>GET</code>è¯·æ±‚å°±è¡Œï¼Œäºæ˜¯æƒ³åˆ°ä½¿ç”¨IOSæä¾›çš„å¿«æ·æŒ‡ä»¤æ¥å‘é€åŠ¨æ€ï¼Œè¿™ç§äº¤äº’æ¨¡å¼æ¯”ä½¿ç”¨å…¬ä¼—å·æ›´å¥½ã€‚</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">https://ä½ åå°æ˜¾ç¤ºçš„.ap-guangzhou.app.tcloudbase.com/bb?key=äº‘å‡½æ•°é‡Œè®¾ç½®çš„&amp;from=è‡ªå·±å‘æŒ¥ä¸€ä¸ª&amp;text=å“”å“”çš„å†…å®¹</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥åˆ†äº«ä¸€ä¸‹å¿«æ·æŒ‡ä»¤çš„å…·ä½“æµç¨‹ï¼š</p><p><img src="https://gitee.com/cayzlh/img-repo/raw/master/2021/02/22280416143496841614349684711.jpg" alt="img"></p><p>ä½¿ç”¨æ•ˆæœï¼š</p><p><img src="https://i.loli.net/2021/02/26/KI7N5EdxAciyL41.gif" alt="å¿«æ·æŒ‡ä»¤æ•ˆæœå›¾"></p><h4 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h4><p>å½“ç„¶Macç«¯è¿˜å¯ä»¥é€šè¿‡  Alfred Workflow æ¥ä½¿ç”¨ï¼Œæ€ä¹ˆæ–¹ä¾¿æ€ä¹ˆæ¥ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> æŠ˜è…¾ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> hexo </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SpringBootæ–‡ä»¶ä¸Šä¼ å¼‚å¸¸å¤„ç†</title>
      <link href="post/2878379624/"/>
      <url>post/2878379624/</url>
      
        <content type="html"><![CDATA[<p>SpringBootæ­å»ºçš„åº”ç”¨ï¼Œä¸€ç›´å·¥ä½œå¾—å¥½å¥½çš„ï¼Œçªç„¶å‘ç°ä¸Šä¼ æ–‡ä»¶å¤±è´¥ï¼Œæç¤º<code>org.springframework.web.multipart.MultipartException: Failed to parse multipart servlet request; nested exception is java.io.IOException: The temporary upload location [/tmp/tomcat.6239989728636105816.19530/work/Tomcat/localhost/ROOT] is not valid</code>ç›®å½•éæ³•ï¼Œå®é™…æŸ¥çœ‹ç›®å½•ï¼Œç»“æœè¿˜çœŸæ²¡æœ‰ï¼Œä¸‹é¢å°±è¿™ä¸ªé—®é¢˜çš„è¡¨ç°ï¼Œåˆ†æä¸‹SpringBooté’ˆå¯¹æ–‡ä»¶ä¸Šä¼ çš„å¤„ç†è¿‡ç¨‹</p><h2 id="é—®é¢˜åˆ†æ"><a href="#é—®é¢˜åˆ†æ" class="headerlink" title="é—®é¢˜åˆ†æ"></a>é—®é¢˜åˆ†æ</h2><h3 id="å †æ ˆåˆ†æ"><a href="#å †æ ˆåˆ†æ" class="headerlink" title="å †æ ˆåˆ†æ"></a>å †æ ˆåˆ†æ</h3><p>é—®é¢˜å®šä½ï¼Œæœ€ä½³çš„è¾…åŠ©æ‰‹æ®µå°±æ˜¯å †æ ˆåˆ†æï¼Œé¦–å…ˆæå‡ºæ ¸å¿ƒçš„å †æ ˆä¿¡æ¯</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">org.springframework.web.multipart.MultipartException: Failed to parse multipart servlet request; nested exception is java.io.IOException: The temporary upload location [/tmp/tomcat.6239989728636105816.19530/work/Tomcat/localhost/ROOT] is not valid</span><br><span class="line">        at org.springframework.web.multipart.support.StandardMultipartHttpServletRequest.handleParseFailure(StandardMultipartHttpServletRequest.java:122)</span><br><span class="line">        at org.springframework.web.multipart.support.StandardMultipartHttpServletRequest.parseRequest(StandardMultipartHttpServletRequest.java:113)</span><br><span class="line">        at org.springframework.web.multipart.support.StandardMultipartHttpServletRequest.&lt;init&gt;(StandardMultipartHttpServletRequest.java:86)</span><br><span class="line">        at org.springframework.web.multipart.support.StandardServletMultipartResolver.resolveMultipart(StandardServletMultipartResolver.java:93)</span><br><span class="line">        at org.springframework.web.servlet.DispatcherServlet.checkMultipart(DispatcherServlet.java:1128)</span><br><span class="line">        at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:960)</span><br><span class="line">        at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:925)</span><br><span class="line">        at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:974)</span><br><span class="line">        at org.springframework.web.servlet.FrameworkServlet.doPost(FrameworkServlet.java:877)</span><br><span class="line">        at javax.servlet.http.HttpServlet.service(HttpServlet.java:661)</span><br><span class="line">        at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:851)</span><br><span class="line">        at javax.servlet.http.HttpServlet.service(HttpServlet.java:742)</span><br><span class="line">        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:231)</span><br><span class="line">        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)</span><br><span class="line">        at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:52)</span><br><span class="line">        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)</span><br></pre></td></tr></table></figure><p>ä»å †æ ˆå†…å®¹æ¥çœ‹ï¼Œé—®é¢˜æ¯”è¾ƒæ¸…æ™°ï¼Œç›®å½•éæ³•ï¼Œæ ¹æ®<code>path</code>è·¯å¾„ï¼Œè¿›å…¥ç›®å½•ï¼Œç»“æœå‘ç°ï¼Œæ²¡æœ‰è¿™ä¸ªç›®å½•ï¼Œé‚£ä¹ˆé—®é¢˜çš„å…³é”®å°±æ˜¯æ²¡æœ‰ç›®å½•ä¸ºä»€ä¹ˆä¼šå¯¼è‡´å¼‚å¸¸äº†ï¼Œè¿™ä¸ªç›®å½•åˆ°åº•æœ‰å•¥ç”¨</p><p>å…ˆç®€å•æè¿°ä¸‹ä¸Šé¢çš„åŸå› ï¼Œä¸Šä¼ çš„æ–‡ä»¶ä¼šç¼“å­˜åˆ°æœ¬åœ°ç£ç›˜ï¼Œè€Œç¼“å­˜çš„è·¯å¾„å°±æ˜¯ä¸Šé¢çš„<code>/tmp/tomcat.6239989728636105816.19530/work/Tomcat/localhost/ROOT</code>ï¼Œæ¥ç€å¼•å…¥çš„ç–‘é—®å°±æ˜¯ï¼š</p><ul><li>ä¸ºä»€ä¹ˆä¸Šä¼ çš„æ–‡ä»¶è¦ç¼“å­˜åˆ°æœ¬åœ°</li><li>ä¸ºä»€ä¹ˆä¸´æ—¶ç›®å½•ä¼šä¸å­˜åœ¨</li><li>ä»€ä¹ˆåœ°æ–¹å®ç°æ–‡ä»¶ç¼“å­˜</li></ul><h3 id="åœºæ™¯æ¨¡æ‹Ÿ"><a href="#åœºæ™¯æ¨¡æ‹Ÿ" class="headerlink" title="åœºæ™¯æ¨¡æ‹Ÿ"></a>åœºæ™¯æ¨¡æ‹Ÿ</h3><p>è¦ç¡®è®¤ä¸Šé¢çš„é—®é¢˜ï¼Œæœ€ç›´è§‚çš„æ–¹æ³•å°±æ˜¯æ’¸æºç ï¼Œç›´æ¥çœ‹ä»£ç å°±æœ‰ç‚¹è›‹ç–¼äº†ï¼Œæ¥ä¸‹æ¥é‡‡ç”¨debugæ–¹å¼æ¥å±‚å±‚å‰¥ç¦»ï¼Œçœ‹ä¸‹æ ¹æºå†å“ªé‡Œã€‚</p><p>é¦–å…ˆæ˜¯æ­å»ºä¸€ä¸ªç®€å•çš„æµ‹è¯•é¡¹ç›®ï¼Œè¿›è¡Œåœºæ™¯å¤ç°, é¦–å…ˆåˆ›å»ºä¸€ä¸ªæ¥æ”¶æ–‡ä»¶ä¸Šä¼ çš„Controllerï¼Œå¦‚ä¸‹</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(path = &quot;/file&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FileUploadRest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä¿å­˜ä¸Šä¼ çš„æ–‡ä»¶</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> file</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> String <span class="title">saveFileToLocal</span><span class="params">(MultipartFile file)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            String name = <span class="string">&quot;/tmp/out_&quot;</span> + System.currentTimeMillis() + file.getName();</span><br><span class="line">            FileOutputStream writer = <span class="keyword">new</span> FileOutputStream(<span class="keyword">new</span> File(name));</span><br><span class="line">            writer.write(file.getBytes());</span><br><span class="line">            writer.flush();</span><br><span class="line">            writer.close();</span><br><span class="line">            <span class="keyword">return</span> name;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> e.getMessage();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping(path = &quot;upload&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">upload</span><span class="params">(<span class="meta">@RequestParam(&quot;file&quot;)</span> MultipartFile file)</span> </span>&#123;</span><br><span class="line">        String ans = saveFileToLocal(file);</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…¶æ¬¡å°±æ˜¯ä½¿ç”¨curlæ¥ä¸Šä¼ æ–‡ä»¶</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">curl http://127.0.0.1:8080/file/upload -F <span class="string">&quot;file=@/Users/user/Desktop/demo.jpg&quot;</span> -v</span><br></pre></td></tr></table></figure><p>ç„¶ååœ¨æ¥æ”¶æ–‡ä»¶ä¸Šä¼ çš„æ–¹æ³•ä¸­å¼€å¯æ–­ç‚¹ï¼Œæ³¨æ„ä¸‹é¢çº¢æ¡†ä¸­çš„ <code>location</code>, å°±æ˜¯æ–‡ä»¶ä¸Šä¼ çš„ä¸´æ—¶ç›®å½•</p><p><img src="https://gitee.com/cayzlh/img-repo/raw/master/2021/02/10511616140486761614048676335.jpg" alt="IMAGE"></p><h3 id="æºç å®šä½"><a href="#æºç å®šä½" class="headerlink" title="æºç å®šä½"></a>æºç å®šä½</h3><p>ä¸Šé¢çš„æˆªå›¾å¯ä»¥ç¡®è®¤ç¡®å®å°†ä¸Šä¼ çš„æ–‡ä»¶ä¿å­˜åˆ°äº†ä¸´æ—¶ç›®å½•ï¼ŒéªŒè¯æ–¹å¼å°±æ˜¯è¿›å…¥é‚£ä¸ªç›®å½•è¿›è¡ŒæŸ¥çœ‹ï¼Œä¼šçœ‹åˆ°ä¸€ä¸ª<code>tmp</code>æ–‡ä»¶ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬éœ€è¦ç¡®å®šçš„æ˜¯åœ¨ä»€ä¹ˆåœ°æ–¹ï¼Œå®ç°å°†æ•°æ®ç¼“å­˜åˆ°æœ¬åœ°çš„ã€‚</p><p>æ³¨æ„ä¸‹å›¾ï¼Œå·¦è¾¹çº¢æ¡†æ˜¯è¿™æ¬¡è¯·æ±‚çš„å®Œæ•´é“¾è·¯ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡é€†æ¨é“¾è·¯ï¼Œå»å®šä½å¯èƒ½å®ç°æ–‡ä»¶ç¼“å­˜çš„åœ°æ–¹</p><p><img src="https://gitee.com/cayzlh/img-repo/raw/master/2021/02/10511916140486791614048679920.jpg" alt="IMAGE"></p><p>å¦‚æœå¯¹<code>spring</code>å’Œ<code>tomcat</code>çš„æºç ä¸ç†Ÿçš„è¯ï¼Œä¹Ÿæ²¡ä»€ä¹ˆç‰¹åˆ«çš„å¥½åŠæ³•ï¼Œä»ä¸Šé¢çš„é“¾è·¯ä¸­ï¼Œå¤šæ‰“ä¸€äº›æ–­ç‚¹ï¼Œé‡‡ç”¨ä¼ è¯´ä¸­çš„äºŒåˆ†å®šä½æ–¹æ³•æ¥ç¼©å°èŒƒå›´ã€‚</p><p>é€šè¿‡æœ€å¼€å§‹çš„requestå¯¹è±¡å’Œåé¢çš„requestå¯¹è±¡åˆ†æï¼Œå‘ç°ä¸€ä¸ªå¯ä»¥ä½œä¸ºå‚è€ƒæ ‡å‡†çš„å°±æ˜¯ä¸Šå›¾ä¸­å³è¾¹çº¢æ¡†çš„<code>request#parts</code>å±æ€§ï¼›å¼€å§‹æ˜¯nullï¼Œæ–‡ä»¶ä¿å­˜ä¹‹ååˆ™ä¼šæœ‰æ•°æ®ï¼Œä¸‹é¢ç»™ä¸€ä¸ªæœ€ç»ˆå®šä½çš„åŠ¨å›¾</p><p><img src="https://i.loli.net/2021/02/23/9dYwLfNEOZ6IvMB.gif" alt="2.gif"></p><p>æ‰€ä»¥å…³é”®å°±æ˜¯<code>org.springframework.web.filter.HiddenHttpMethodFilter#doFilterInternal</code> ä¸­çš„ <code>String paramValue = request.getParameter(this.methodParam);</code> è¿™ä¸€è¡Œä»£ç </p><p><img src="https://gitee.com/cayzlh/img-repo/raw/master/2021/02/10513516140486951614048695101.jpg" alt="IMAGE"></p><p>åˆ°è¿™é‡Œåœ¨å•æ­¥è¿›å»ï¼Œä¸»è¦çš„ç„¦ç‚¹å°†é›†ä¸­åœ¨ <code>org.apache.catalina.connector.Request#parseParts</code></p><p><img src="https://gitee.com/cayzlh/img-repo/raw/master/2021/02/10513616140486961614048696886.jpg" alt="IMAGE"></p><p>è¿›å…¥ä¸Šé¢æ–¹æ³•çš„é€»è¾‘ï¼Œå¾ˆå®¹æ˜“æ‰¾åˆ°å…·ä½“çš„å®ç°ä½ç½® <code>org.apache.tomcat.util.http.fileupload.FileUploadBase#parseRequest</code>ï¼Œè¿™ä¸ªæ–¹æ³•çš„å®ç°æ¯”è¾ƒæœ‰æ„æ€ï¼Œæœ‰å¿…è¦è´´å‡ºæ¥çœ‹ä¸€ä¸‹</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> List&lt;FileItem&gt; <span class="title">parseRequest</span><span class="params">(RequestContext ctx)</span></span></span><br><span class="line"><span class="function">        <span class="keyword">throws</span> FileUploadException </span>&#123;</span><br><span class="line">    List&lt;FileItem&gt; items = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    <span class="keyword">boolean</span> successful = <span class="keyword">false</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        FileItemIterator iter = getItemIterator(ctx);</span><br><span class="line">        <span class="comment">// æ³¨æ„è¿™é‡Œï¼Œæ–‡ä»¶å·¥å‚ç±»ï¼Œé‡Œé¢ä¿å­˜äº†ä¸´æ—¶ç›®å½•çš„åœ°å€</span></span><br><span class="line">        <span class="comment">// è¿™ä¸ªå¯¹è±¡é¦–æ¬¡æ˜¯åœ¨ org.apache.catalina.connector.Request#parseParts æ–¹æ³•çš„</span></span><br><span class="line">        FileItemFactory fac = getFileItemFactory();</span><br><span class="line">        <span class="keyword">if</span> (fac == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException(<span class="string">&quot;No FileItemFactory has been set.&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">while</span> (iter.hasNext()) &#123;</span><br><span class="line">            <span class="keyword">final</span> FileItemStream item = iter.next();</span><br><span class="line">            <span class="comment">// Don&#x27;t use getName() here to prevent an InvalidFileNameException.</span></span><br><span class="line">            <span class="keyword">final</span> String fileName = ((FileItemIteratorImpl.FileItemStreamImpl) item).name;</span><br><span class="line">            <span class="comment">// åˆ›å»ºä¸€ä¸ªä¸´æ—¶æ–‡ä»¶å¯¹è±¡</span></span><br><span class="line">            FileItem fileItem = fac.createItem(item.getFieldName(), item.getContentType(),</span><br><span class="line">                                               item.isFormField(), fileName);</span><br><span class="line">            items.add(fileItem);</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="comment">// æµçš„æ‹·è´ï¼Œè¿™å—ä»£ç ä¹ŸæŒºæœ‰æ„æ€ï¼Œå°†è¾“å…¥æµæ•°æ®å†™å…¥è¾“å‡ºæµ</span></span><br><span class="line">                <span class="comment">// åé¢ä¼šè´´å‡ºæºç ï¼Œçœ‹ä¸‹å¼€æºå¤§ä½¬ä»¬çš„ç©æ³•ï¼Œå’Œæˆ‘ä»¬è‡ªå·±å†™çš„æœ‰å•¥åŒºåˆ«</span></span><br><span class="line">                Streams.copy(item.openStream(), fileItem.getOutputStream(), <span class="keyword">true</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (FileUploadIOException e) &#123;</span><br><span class="line">                <span class="keyword">throw</span> (FileUploadException) e.getCause();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> IOFileUploadException(String.format(<span class="string">&quot;Processing of %s request failed. %s&quot;</span>,</span><br><span class="line">                                                       MULTIPART_FORM_DATA, e.getMessage()), e);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">final</span> FileItemHeaders fih = item.getHeaders();</span><br><span class="line">            fileItem.setHeaders(fih);</span><br><span class="line">        &#125;</span><br><span class="line">        successful = <span class="keyword">true</span>;</span><br><span class="line">        <span class="keyword">return</span> items;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (FileUploadIOException e) &#123;</span><br><span class="line">        <span class="keyword">throw</span> (FileUploadException) e.getCause();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> FileUploadException(e.getMessage(), e);</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (!successful) &#123;</span><br><span class="line">            <span class="keyword">for</span> (FileItem fileItem : items) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    fileItem.delete();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (Exception ignored) &#123;</span><br><span class="line">                    <span class="comment">// ignored TODO perhaps add to tracker delete failure list somehow?</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ ¸å¿ƒä»£ç å°±ä¸¤ç‚¹ï¼Œä¸€ä¸ªæ˜¯æ–‡ä»¶å·¥å‚ç±»ï¼Œä¸€ä¸ªæ˜¯æµçš„æ‹·è´ï¼›å‰è€…å®šä¹‰äº†æˆ‘ä»¬çš„ä¸´æ—¶æ–‡ä»¶ç›®å½•ï¼Œä¹Ÿæ˜¯æˆ‘ä»¬è§£å†³å‰é¢é—®é¢˜çš„å…³é”®ï¼Œæ¢ä¸€ä¸ªæˆ‘è‡ªå®šä¹‰çš„ç›®å½•æ°¸ä¸åˆ é™¤ï¼Œä¸å°±å¯ä»¥é¿å…ä¸Šé¢çš„é—®é¢˜äº†ä¹ˆï¼›åé¢ä¸€ä¸ªåˆ™æ˜¯æ•°æ®å¤ç”¨æ–¹é¢çš„</p><p>é¦–å…ˆçœ‹ä¸‹FileItemFactoryçš„å®ä¾‹åŒ–ä½ç½®ï¼Œåœ¨<code>org.apache.catalina.connector.Request#parseParts</code>ä¸­ï¼Œä»£ç å¦‚ä¸‹</p><p><img src="https://gitee.com/cayzlh/img-repo/raw/master/2021/02/10513716140486971614048697322.jpg" alt="IMAGE"></p><p>å…·ä½“çš„<code>location</code>å®ä¾‹åŒ–ä»£ç ä¸º</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// TEMPDIR = &quot;javax.servlet.context.tempdir&quot;;</span></span><br><span class="line">location = ((File) context.getServletContext().getAttribute(ServletContext.TEMPDIR));</span><br></pre></td></tr></table></figure><p>##é—®é¢˜review</p><p>###è§£å†³é—®é¢˜</p><p>åˆ°ä¸Šé¢ï¼ŒåŸºæœ¬ä¸Šå°±æåˆ°äº†æœ€ç»ˆçš„é—®é¢˜ï¼Œå…ˆçœ‹å¦‚ä½•è§£å†³è¿™ä¸ªé—®é¢˜</p><h4 id="æ–¹æ³•1"><a href="#æ–¹æ³•1" class="headerlink" title="æ–¹æ³•1"></a><strong>æ–¹æ³•1</strong></h4><ul><li><strong>åº”ç”¨é‡å¯</strong></li></ul><h4 id="æ–¹æ³•2"><a href="#æ–¹æ³•2" class="headerlink" title="æ–¹æ³•2"></a><strong>æ–¹æ³•2</strong></h4><ul><li>å¢åŠ æœåŠ¡é…ç½®ï¼Œè‡ªå®šä¹‰<code>baseDir</code></li></ul><figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="meta">server.tomcat.basedir</span>=<span class="string">/tmp/tomcat</span></span><br></pre></td></tr></table></figure><h4 id="æ–¹æ³•3"><a href="#æ–¹æ³•3" class="headerlink" title="æ–¹æ³•3"></a><strong>æ–¹æ³•3</strong></h4><ul><li>æ³¨å…¥beanï¼Œæ‰‹åŠ¨é…ç½®ä¸´æ—¶ç›®å½•</li></ul><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function">MultipartConfigElement <span class="title">multipartConfigElement</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    MultipartConfigFactory factory = <span class="keyword">new</span> MultipartConfigFactory();</span><br><span class="line">    factory.setLocation(<span class="string">&quot;/tmp/tomcat&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> factory.createMultipartConfig();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æ–¹æ³•4"><a href="#æ–¹æ³•4" class="headerlink" title="æ–¹æ³•4"></a><strong>æ–¹æ³•4</strong></h4><ul><li>é…ç½®ä¸åˆ é™¤<code>tmp</code>ç›®å½•ä¸‹çš„<code>tomcat</code></li></ul><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">vim /usr/lib/tmpfiles.d/tmp.conf</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ·»åŠ ä¸€è¡Œ</span></span><br><span class="line">x /tmp/tomcat.*</span><br></pre></td></tr></table></figure><h4 id="æµæ‹·è´"><a href="#æµæ‹·è´" class="headerlink" title="æµæ‹·è´"></a>æµæ‹·è´</h4><p><code>tomcat</code>ä¸­å®ç°æµçš„æ‹·è´ä»£ç å¦‚ä¸‹ï¼Œ<code>org.apache.tomcat.util.http.fileupload.util.Streams#copy(java.io.InputStream, java.io.OutputStream, boolean, byte[])</code> , çœ‹ä¸‹é¢çš„å®ç°ï¼Œç›´è§‚å½±å“å°±æ˜¯å†™å¾—çœŸç‰¹ä¹ˆä¸¥è°¨</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">long</span> <span class="title">copy</span><span class="params">(InputStream inputStream,</span></span></span><br><span class="line"><span class="function"><span class="params">            OutputStream outputStream, <span class="keyword">boolean</span> closeOutputStream,</span></span></span><br><span class="line"><span class="function"><span class="params">            <span class="keyword">byte</span>[] buffer)</span></span></span><br><span class="line"><span class="function">    <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    OutputStream out = outputStream;</span><br><span class="line">    InputStream in = inputStream;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">long</span> total = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (;;) &#123;</span><br><span class="line">            <span class="keyword">int</span> res = in.read(buffer);</span><br><span class="line">            <span class="keyword">if</span> (res == -<span class="number">1</span>) &#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (res &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                total += res;</span><br><span class="line">                <span class="keyword">if</span> (out != <span class="keyword">null</span>) &#123;</span><br><span class="line">                    out.write(buffer, <span class="number">0</span>, res);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (out != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (closeOutputStream) &#123;</span><br><span class="line">                out.close();</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                out.flush();</span><br><span class="line">            &#125;</span><br><span class="line">            out = <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        in.close();</span><br><span class="line">        in = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">return</span> total;</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        IOUtils.closeQuietly(in);</span><br><span class="line">        <span class="keyword">if</span> (closeOutputStream) &#123;</span><br><span class="line">            IOUtils.closeQuietly(out);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>###è‡ªé—®è‡ªç­”</p><p>ä»€ä¹ˆåœ°æ–¹ç¼“å­˜æ–‡ä»¶</p><p>ä¸Šé¢çš„å®šä½è¿‡ç¨‹ç»™å‡ºç­”æ¡ˆï¼Œå…·ä½“å®ç°é€»è¾‘åœ¨ <code>org.apache.tomcat.util.http.fileupload.FileUploadBase#parseRequest</code></p><p>####ä¸ºä»€ä¹ˆç›®å½•ä¼šä¸å­˜åœ¨</p><p><code>springboot</code>å¯åŠ¨æ—¶ä¼šåˆ›å»ºä¸€ä¸ª<code>/tmp/tomcat.*/work/Tomcat/localhost/ROOT</code>çš„ä¸´æ—¶ç›®å½•ä½œä¸ºæ–‡ä»¶ä¸Šä¼ çš„ä¸´æ—¶ç›®å½•ï¼Œä½†æ˜¯è¯¥ç›®å½•ä¼šåœ¨<code>n</code>å¤©ä¹‹åè¢«ç³»ç»Ÿè‡ªåŠ¨æ¸…ç†æ‰ï¼Œè¿™ä¸ªæ¸…ç†æ˜¯ç”±<code>linux</code>æ“ä½œç³»ç»Ÿå®Œæˆçš„ï¼Œå…·ä½“çš„é…ç½®å¦‚ä¸‹ <code>vim /usr/lib/tmpfiles.d/tmp.conf</code></p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#  This file is part of systemd.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#  systemd is free software; you can redistribute it and/or modify it</span></span><br><span class="line"><span class="comment">#  under the terms of the GNU Lesser General Public License as published by</span></span><br><span class="line"><span class="comment">#  the Free Software Foundation; either version 2.1 of the License, or</span></span><br><span class="line"><span class="comment">#  (at your option) any later version.</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># See tmpfiles.d(5) for details</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Clear tmp directories separately, to make them easier to override</span></span><br><span class="line">v /tmp 1777 root root 10d</span><br><span class="line">v /var/tmp 1777 root root 30d</span><br><span class="line"></span><br><span class="line"><span class="comment"># Exclude namespace mountpoints created with PrivateTmp=yes</span></span><br><span class="line">x /tmp/systemd-private-%b-*</span><br><span class="line">X /tmp/systemd-private-%b-*/tmp</span><br><span class="line">x /var/tmp/systemd-private-%b-*</span><br><span class="line">X /var/tmp/systemd-private-%b-*/tmp</span><br></pre></td></tr></table></figure><p>####ä¸ºä»€ä¹ˆè¦ç¼“å­˜æ–‡ä»¶</p><p>å› ä¸ºæµå–ä¸€æ¬¡æ¶ˆè´¹ä¹‹åï¼Œåé¢æ— æ³•å†ä»æµä¸­è·å–æ•°æ®ï¼Œæ‰€ä»¥ç¼“å­˜æ–¹ä¾¿åç»­å¤ç”¨ï¼›</p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul><li><a href="https://spring.hhui.top/spring-blog/2019/02/13/190213-SpringBoot%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E5%BC%82%E5%B8%B8%E4%B9%8B%E6%8F%90%E7%A4%BAThe-temporary-upload-location-xxx-is-not-valid/">ä¸€ç°ç°Blog - SpringBootæ–‡ä»¶ä¸Šä¼ å¼‚å¸¸ä¹‹æç¤ºThe temporary upload location xxx is not valid</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®°æœ¬ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> Spring </tag>
            
            <tag> SpringBoot </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä½ å¥½ï¼Œæç„•è‹±</title>
      <link href="post/5ad4076c/"/>
      <url>post/5ad4076c/</url>
      
        <content type="html"><![CDATA[<p><img src="https://gitee.com/cayzlh/img-repo/raw/master/2021/02/21391616139147561613914756550.png" alt="image-20210221213915135"></p><p><a href="https://movie.douban.com/subject/34841067/">ã€Šä½ å¥½ï¼Œæç„•è‹±ã€‹</a>ï¼Œä¸€éƒ¨ å›½äº§+å–œå‰§+å‚¬æ³ª çš„ç”µå½±ï¼›</p><p>åœ¨ä»¥å¾€çš„ç»éªŒä¸­ï¼Œæ‰“ä¸Šè¿™å‡ ä¸ªæ ‡ç­¾çš„ç”µå½±å¾€å¾€éƒ½æ˜¯çƒ‚ç‰‡äº†ï¼Œä½†åœ¨è±†ç“£å´æœ‰<code>8</code>åˆ†ä»¥ä¸Šçš„æˆç»©ï¼›</p><p>äºæ˜¯æ€€ç€å¥½å¥‡çš„å¿ƒæƒ…ï¼Œå†³å®šè¸å…¥è®¸ä¹…æ²¡å»è¿‡çš„ç”µå½±é™¢çœ‹çœ‹ï¼›</p><p><img src="https://gitee.com/cayzlh/img-repo/raw/master/2021/02/21431716139149971613914997594.png" alt="image-20210221214303484"></p><blockquote><p>æˆ‘ä»¥ä¸ºæ˜¯æˆ‘åœ¨ä¸ºä½ åœ†æ¢¦ï¼Œå…¶å®è¿˜æ˜¯ä½ é™ªç€æˆ‘åšäº†ä¸€åœºå¥½æ¢¦ã€‚</p></blockquote><p>æ•´éƒ¨ç”µå½±çš„ç¬‘ç‚¹æ³ªç‚¹æ°åˆ°å¥½å¤„ï¼Œæ²¡æœ‰ç¡¬æç¬‘ä¹Ÿæ²¡æœ‰åˆ»æ„ç…½æƒ…ï¼›</p><p>ä½œä¸ºè´¾ç²çš„å¯¼æ¼”å¤„å¥³ä½œï¼Œè¿™éƒ¨ä½œå“æ˜¯å€¼å¾—è‚¯å®šçš„ï¼Œå­æ¬²å…»è€Œäº²ä¸å¾…ï¼Œå¥¹åœ¨è®²ä¸€ä¸ªçæƒœäº²æƒ…çš„æ•…äº‹ï¼›</p><p>ä¹Ÿè®¸æç„•è‹±å°±æ˜¯ç°å®ä¸­æ‰€æœ‰æ¯äº²çš„çœŸå®å†™ç…§ï¼Œä¹Ÿæ›¾ç»å¹´è½»è¿‡ï¼Œä¹Ÿæ›¾ç»æ˜¯ä¸ªèŠ±å­£å°‘å¥³ï¼Œä¹Ÿæ›¾ç»æœ‰è¿‡è‡ªå·±è¿½é€çš„æ¢¦æƒ³ï¼›</p><p>åœ¨å­©å­å‡ºç”Ÿä¹‹åï¼Œå¦‚åŒç‹—çš®è†è¯ä¸€æ ·ï¼Œé»åœ¨èº«ä¸Šï¼Œå°±æ˜¯ä¸€è¾ˆå­ï¼›</p><p>ä»–ä»¬ä¸èˆå¾—ç»™è‡ªå·±ä¹°å¥½çš„ï¼Œä¸€ä»¶è¡£æœç©¿å¥½å‡ å¹´ï¼Œä¸€åŒé‹å­ç©¿å¥½å‡ å¹´ï¼›</p><p>å¯¹å­©å­ç¡®æ˜¯æ¨ä¸å¾—æŠŠæœ€å¥½çš„æ‹¿ç»™ä»–ï¼›</p><p><em>ç”šè‡³ï¼Œåœ¨å­©å­å¥½ä¸å®¹æ˜“æˆå¹´ä¹‹åï¼Œåˆæœ‰ä¸€ä¸ªæ–°çš„ç‹—çš®è†è¯ï¼ˆå­™å­ï¼‰ä¹Ÿé»äº†è¿‡æ¥ï¼Œç”Ÿæ´»ä¸­å°±åªå‰©ä¸‹å­©å­ï¼›</em></p><blockquote><p>è¯´å›ç”µå½±ï¼Œæˆ‘è®¤ä¸ºç»“å°¾æ˜¯æ•´ä¸ªå‰§æƒ…æœ€å‡åçš„éƒ¨åˆ†ã€‚</p></blockquote><p>å¦‚æœå‰§æƒ…èƒŒæ™¯ä»…ä»…æ˜¯ç©¿è¶Šæˆ–è€…ä¸€åœºæ¢¦ï¼Œé‚£åªèƒ½ç®—ä¸€éƒ¨æ™®é€šçš„åˆå®¶æ¬¢å–œå‰§ï¼›</p><p>ä½†æ˜¯ç»“å°¾è¯´ï¼Œæç„•è‹±æ˜¯48å²çš„æç„•è‹±ã€‚ æ•´ä¸ªå‰§æƒ…å°±å‡åäº†ï¼›</p><p>æˆ‘ä»¬æœ€å¼€å§‹çš„è§†è§’ï¼Œæ˜¯è´¾æ™“ç²è§†è§’ï¼Œä»¥ä¸ºæ˜¯ç©¿è¶Šï¼Œåˆæˆ–è€…æ¢¦ï¼Œæˆ‘ä»¬è·Ÿéšç€è´¾æ™“ç²ï¼Œè¯•ç€æ”¹å˜æ¯äº²çš„å‘½è¿ï¼Œè®©å¥¹æ›´åŠ å¼€å¿ƒï¼›</p><p>å‰§æƒ…å¾ˆå¥½ç¬‘ï¼Œåˆæœ‰äº›è’è¯ï¼›</p><p>å›å¤´ä¸€æƒ³ï¼Œå¦‚æœä¸»è§’è§†è§’æ˜¯æç„•è‹±ï¼Œé‚£å‡ ä¹æ˜¯ä¸€éƒ¨å…¨æ–°çš„ç”µå½±ï¼›</p><p>å‰é¢å‰§æƒ…é‡Œä¸€äº›ä¸åˆç†çš„åœ°æ–¹ï¼Œå¿½ç„¶åˆå˜å¾—åˆç†äº†èµ·æ¥ï¼›</p><p>â€¦ â€¦</p><p>å•Šï¼Œæ€»ä¹‹ï¼Œç”µå½±ä¸é”™ï¼›</p>]]></content>
      
      
      <categories>
          
          <category> ç¢ç¢å¿µ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç”µå½± </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>2021æ˜¥èŠ‚éšç¬”</title>
      <link href="post/57d8b90a/"/>
      <url>post/57d8b90a/</url>
      
        <content type="html"><![CDATA[<blockquote><p>ææƒšé—´ï¼›åˆåˆ°äº†ä¸€å¹´æ˜¥èŠ‚ï¼›</p><p>æ€»æ„Ÿè§‰ï¼Œ2020æ²¡è¿‡å‡ å¤©ï¼›</p><p>å¼„ä¸¢äº†ï¼Œæ—¶é—´ï¼›</p><p>è¿‡å¹´çš„çƒŸèŠ±å£°è¿˜åœ¨è€³è¾¹ï¼›</p><p>è¿·ç³Šé—´ï¼Œåˆå¤§äº†300å¤šå¤©ï¼›</p><p>å·²æ²¡äººï¼Œç»™å‹å²é’±ï¼›</p></blockquote><h2 id="é­”å¹»çš„2020"><a href="#é­”å¹»çš„2020" class="headerlink" title="é­”å¹»çš„2020"></a>é­”å¹»çš„2020</h2><p>2020çœŸæ˜¯é­”å¹»çš„ä¸€å¹´ï¼›</p><p>ç–«æƒ…ä¸‹å¯¹æœªçŸ¥çš„ææƒ§ï¼Œè¿‡å¹´åœ¨å®¶ç”šè‡³ä¸æ•¢å‡ºé—¨ï¼›</p><p>åœ¨å®¶è¿œç¨‹åŠå…¬åˆ°3æœˆä»½ï¼›</p><p>å›åˆ°å¹¿å·ä¸Šç­ä¹Ÿæ˜¯äººå¿ƒæƒ¶æƒ¶ï¼Œæ¯å¤©å¸¦ç€å£ç½©ï¼ŒåŒ…é‡Œå¸¸å¤‡æ¶ˆæ¯’æ¶²ï¼›</p><p>æ‡µæ‡µæ‡‚æ‡‚è¿‡å®Œäº†ä¸ŠåŠå¹´ï¼Œä¸çŸ¥é“åœ¨å¿™ï¼ˆé—²ï¼‰å•¥ï¼›</p><p><strong>ä¸‹åŠå¹´ï¼Œæ¢äº†ä¸ªæ–°çš„ç¯å¢ƒï¼›</strong></p><p>é‚£ä¸€å¤©ï¼Œç»ˆäºå›æƒ³èµ·äº†äº’è”ç½‘å…¬å¸çš„æ”¯é…ï¼Œå›½åº†ä¹‹åå°±æ²¡æœ‰é—²ä¸‹æ¥è¿‡ï¼Œå¿™æˆç‹—ï¼›</p><p><img src="https://gitee.com/cayzlh/img-repo/raw/master/2021/02/11101216137042121613704212946.png" alt="image-20210219111012445"></p><h2 id="æˆé•¿"><a href="#æˆé•¿" class="headerlink" title="æˆé•¿"></a>æˆé•¿</h2><p>è¿˜æ˜¯ç”±äºç–«æƒ…çš„å½±å“ï¼ŒæŠŠå…­ä¸ªæœˆå¤§çš„å°ç²½å­é€å›è€å®¶ç”Ÿæ´»ï¼Œåªèƒ½ä»é€šè¿‡è§†é¢‘çš„æ–¹å¼æ¥è§è¯ä»–çš„æˆé•¿ï¼›</p><p>ä»åªä¼šå’¿å‘€å­¦è¯­åˆ°èƒ½å‡†ç¡®çš„å–Šâ€œçˆ¸çˆ¸â€ â€œå¦ˆå¦ˆâ€ç­‰å è¯ï¼›</p><p>ä»åªä¼šçˆ¬è¡Œåˆ°è¹’è·šå­¦æ­¥ï¼Œå†åˆ°è¹¦è¹¦è·³è·³ï¼›</p><p>â€¦ â€¦</p><p>æˆé•¿çš„è¿‡ç¨‹ï¼Œå……æ»¡äº†æƒŠå–œä¸æ„ŸåŠ¨ï¼›</p><p><img src="https://gitee.com/cayzlh/img-repo/raw/master/2021/02/22271016136584301613658430840.png" alt="image-20210218222709998"></p><h2 id="2021"><a href="#2021" class="headerlink" title="2021"></a>2021</h2><p>å‡æœŸå‡æœŸæ‚„æ‚„è¿‡å»ï¼Œç•™ä¸‹å°è‚‰è‚‰ï¼›</p><p>åœ¨å®¶é‡Œæ··åƒæ··å–10å¤šå¤©ï¼Œä½“é‡åˆä¸Šå»äº†äº¿ç‚¹ç‚¹ï¼›</p><p>æœ‰äººè¯´æ€ä¹ˆå˜æ²¹è…»äº†ï¼›</p><p>çœ‹æ¥è¦ç«‹ä¸ª<code>FLAG</code>æ‰è¡Œï¼š**<u>2021å¹´èª“å¿…å°†å°†å°è‚šå­å‡ä¸‹å»ï¼Œä½“é‡å‡åˆ°120æ–¤å·¦å³ï¼›</u>**</p><p><em>å¶å°”æ¥ä¸ªè€å¹´äººçš„å…»ç”Ÿç¯®çƒä¹Ÿæ˜¯ä¸é”™æ»´ï¼›</em></p><p><img src="https://gitee.com/cayzlh/img-repo/raw/master/2021/02/22411416136592741613659274195.png" alt="image-20210218224113187"></p><h3 id="è®¡åˆ’-amp-ä¹¦å•"><a href="#è®¡åˆ’-amp-ä¹¦å•" class="headerlink" title="è®¡åˆ’&amp;ä¹¦å•"></a>è®¡åˆ’&amp;ä¹¦å•</h3><ul><li>ã€Šå¦‚ä½•é˜…è¯»ä¸€æœ¬ä¹¦ã€‹â€” <strong>40%</strong></li><li>ã€Šé˜¿é‡Œå·´å·´ç®¡ç†ä¸‰æ¿æ–§ã€‹â€” <strong>100%</strong></li><li>ã€ŠElasticsearchæƒå¨æŒ‡å—ã€‹â€” <strong>30%</strong></li><li>ã€Šä»£ç æ•´æ´ä¹‹é“ clean codeã€‹â€” <strong>æœªå¼€å§‹</strong></li><li>ã€Šé«˜æ€§èƒ½MySQLã€‹â€” <strong>æœªå¼€å§‹</strong></li><li>ã€Šé‡æ„æ”¹å–„æ—¢æœ‰ä»£ç è®¾è®¡ã€‹â€” <strong>æœªå¼€å§‹</strong></li><li>ã€Šå¤§è¯è®¾è®¡æ¨¡å¼ã€‹â€” 20%</li><li>ã€Šäº‘æ”»ç•¥ã€‹â€” <strong>æœªå¼€å§‹</strong></li></ul><hr><p><em>æƒ³åˆ°å•¥ï¼Œå°±å†™äº†å•¥ï¼Œæœ‰ç‚¹ä¹±ï¼Œæ²¡æœ‰é€»è¾‘</em>ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> ç¢ç¢å¿µ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç”Ÿæ´» </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Dockeréƒ¨ç½²elasticsearch</title>
      <link href="post/2481829941/"/>
      <url>post/2481829941/</url>
      
        <content type="html"><![CDATA[<h3 id="dockerhubæ‰¾åˆ°elasticsearché•œåƒæ–‡æ¡£"><a href="#dockerhubæ‰¾åˆ°elasticsearché•œåƒæ–‡æ¡£" class="headerlink" title="dockerhubæ‰¾åˆ°elasticsearché•œåƒæ–‡æ¡£"></a>dockerhubæ‰¾åˆ°elasticsearché•œåƒæ–‡æ¡£</h3><p>æ­£å¸¸æ¥è¯´ï¼ŒæŒ‰ç…§<a href="https://hub.docker.com/_/elasticsearch">elasticsearch</a>ä¸Šçš„æ–‡æ¡£æç¤ºï¼Œä¸€æ­¥æ­¥æ“ä½œå³å¯ã€‚</p><p><strong>1ã€æ‹‰å–é•œåƒ</strong></p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker pull elasticsearch</span><br></pre></td></tr></table></figure><p><strong>2ã€åˆ›å»ºç”¨æˆ·å®šä¹‰çš„ç½‘ç»œï¼ˆå¯ç”¨äºè¿æ¥åˆ°è¿æ¥åˆ°åŒä¸€ç½‘ç»œçš„å…¶ä»–æœåŠ¡ï¼ˆä¾‹å¦‚Kibanaï¼‰ï¼‰</strong></p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker network create somenetwork</span><br></pre></td></tr></table></figure><p><strong>3ã€è¿è¡Œelasticsearchå®¹å™¨</strong></p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker run -d --name elasticsearch --net somenetwork -p 9200:9200 -p 9300:9300 -e <span class="string">&quot;discovery.type=single-node&quot;</span> elasticsearch:tag</span><br></pre></td></tr></table></figure><blockquote><p>æœ¬åœ°æœºå™¨ç¯å¢ƒä¸º <code>macOS</code> ï¼Œåœ¨è¿è¡Œä¹‹åå‘ç°å®¹å™¨ç›´æ¥æŒ‚äº†ï¼Œé€šè¿‡æŸ¥çœ‹æ—¥å¿—å‘ç°ï¼š</p><p><img src="https://gitee.com/cayzlh/img-repo/raw/master/2021/01/11334316098176231609817623882.png" alt="image-20210105113343431"></p></blockquote><p><strong>ç”±äº<code>elasticsearch</code>é»˜è®¤åˆ†é…<code>jvm</code>ç©ºé—´å¤§å°ä¸º<code>2g</code>ï¼Œå†…å­˜ä¸è¶³ä»¥åˆ†é…å¯¼è‡´ã€‚</strong></p><h3 id="è§£å†³æŠ¥é”™é—®é¢˜"><a href="#è§£å†³æŠ¥é”™é—®é¢˜" class="headerlink" title="è§£å†³æŠ¥é”™é—®é¢˜"></a>è§£å†³æŠ¥é”™é—®é¢˜</h3><p>åœ¨å¯åŠ¨å‘½ä»¤ä¸­æŒ‡å®š<code>jvm</code>å¤§å°æ¥å¯åŠ¨å®¹å™¨ï¼Œæ·»åŠ <code>-e ES_JAVA_OPTS=&quot;-Xms256m -Xmx256m&quot;</code>å‚æ•°ã€‚å®Œæ•´å‘½ä»¤å¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker run -d --name std-es --net esnetwork -p 9200:9200 -p 9300:9300 -e <span class="string">&quot;discovery.type=single-node&quot;</span> -e ES_JAVA_OPTS=<span class="string">&quot;-Xms256m -Xmx256m&quot;</span> elasticsearch</span><br></pre></td></tr></table></figure><p>â€¦</p><p>åç»­å…³äº<code>elasticsearch</code>ä½¿ç”¨çš„é—®é¢˜ä¹Ÿä¼šç»´æŠ¤åœ¨è¿™ç¯‡æ–‡ç« ä¹‹ä¸­</p>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®°æœ¬ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Docker </tag>
            
            <tag> elasticsearch </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è®°å…³äºConsulçš„ä¸€ç‚¹ä½¿ç”¨ç¬”è®°</title>
      <link href="post/1320718638/"/>
      <url>post/1320718638/</url>
      
        <content type="html"><![CDATA[<blockquote><p>ç”±äºå¼€å‘éœ€è¦ï¼Œéœ€è¦åœ¨æœ¬åœ°è¿è¡Œä¸€ä¸ªConsulç¯å¢ƒï¼Œç”±äºç”µè„‘ä¸Šå·²ç»æœ‰Dockerç¯å¢ƒäº†ï¼Œäºæ˜¯å°±ç›´æ¥åœ¨Dockeré‡Œé¢æ­ä¸€å¥—Consulé›†ç¾¤ã€‚</p></blockquote><h2 id="Dockeræ­å»ºConsulé›†ç¾¤"><a href="#Dockeræ­å»ºConsulé›†ç¾¤" class="headerlink" title="Dockeræ­å»ºConsulé›†ç¾¤"></a>Dockeræ­å»ºConsulé›†ç¾¤</h2><blockquote><p>é›†ç¾¤è¦æ±‚è¦æœ‰<code>3</code>ä¸ª<code>Server</code>ï¼Œå°†å®¹å™¨<code>8500</code>ç«¯å£æ˜ å°„åˆ°ä¸»æœº<code>8900</code>ç«¯å£ï¼ŒåŒæ—¶å¼€å¯ç®¡ç†ç•Œé¢</p></blockquote><h3 id="æ­å»ºé›†ç¾¤"><a href="#æ­å»ºé›†ç¾¤" class="headerlink" title="æ­å»ºé›†ç¾¤"></a>æ­å»ºé›†ç¾¤</h3><p><strong>1. å¯åŠ¨ç¬¬1ä¸ªServerèŠ‚ç‚¹</strong></p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker run -d --name=consul1 -p 8500:8500 -e CONSUL_BIND_INTERFACE=eth0 consul:1.6.2 agent --server=<span class="literal">true</span> --bootstrap-expect=3 --client=0.0.0.0 -ui</span><br></pre></td></tr></table></figure><p><strong>2. è·å–consul1çš„ipåœ°å€</strong></p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">JOIN_IP=<span class="string">&quot;<span class="subst">$(docker inspect -f &#x27;&#123;&#123;.NetworkSettings.IPAddress&#125;&#125;&#x27; do1_consul1)</span>&quot;</span>;</span><br></pre></td></tr></table></figure><p><strong>3. å¯åŠ¨ç¬¬2ä¸ªServerèŠ‚ç‚¹ï¼Œå¹¶åŠ å…¥é›†ç¾¤</strong></p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker run -d --name=consul2 -e CONSUL_BIND_INTERFACE=eth0 consul:1.6.2 agent --server=<span class="literal">true</span> --client=0.0.0.0 --join <span class="variable">$JOIN_IP</span></span><br></pre></td></tr></table></figure><p><strong>4. å¯åŠ¨ç¬¬3ä¸ªServerèŠ‚ç‚¹ï¼Œå¹¶åŠ å…¥é›†ç¾¤</strong></p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker run -d --name=consul3 -e CONSUL_BIND_INTERFACE=eth0 consul:1.6.2 agent --server=<span class="literal">true</span> --client=0.0.0.0 --join <span class="variable">$JOIN_IP</span></span><br></pre></td></tr></table></figure><p><strong>5. å¯åŠ¨ç¬¬4ä¸ªClientèŠ‚ç‚¹ï¼Œå¹¶åŠ å…¥é›†ç¾¤</strong></p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker run -d --name=consul4 -e CONSUL_BIND_INTERFACE=eth0 consul:1.6.2 agent --server=<span class="literal">false</span> --client=0.0.0.0 --join <span class="variable">$JOIN_IP</span></span><br></pre></td></tr></table></figure><p>æµè§ˆå™¨è®¿é—® <a href="http://localhost:8500/">http://localhost:8500</a>éªŒè¯æ˜¯å¦éƒ¨ç½²æˆåŠŸã€‚</p><h3 id="å¯¼å…¥kv"><a href="#å¯¼å…¥kv" class="headerlink" title="å¯¼å…¥kv"></a>å¯¼å…¥kv</h3><p><strong>1. å°†kv.jsonå¤åˆ¶åˆ°å®¹å™¨å†…</strong></p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker cp ~/Desktop/consul_kv.json consul1:/tmp</span><br></pre></td></tr></table></figure><p><strong>2. å¯¼å…¥kv.json</strong></p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker <span class="built_in">exec</span> consul1 consul kv import @/tmp/consul_kv.json</span><br></pre></td></tr></table></figure><h2 id="IDEAè·‘æœåŠ¡æ³¨å†Œåˆ°Consul"><a href="#IDEAè·‘æœåŠ¡æ³¨å†Œåˆ°Consul" class="headerlink" title="IDEAè·‘æœåŠ¡æ³¨å†Œåˆ°Consul"></a>IDEAè·‘æœåŠ¡æ³¨å†Œåˆ°Consul</h2><h3 id="é‡åˆ°çš„å‘"><a href="#é‡åˆ°çš„å‘" class="headerlink" title="é‡åˆ°çš„å‘"></a>é‡åˆ°çš„å‘</h3><p><code>consul</code>é›†ç¾¤è·‘èµ·æ¥ä¹‹åï¼Œäºæ˜¯åœ¨<code>IDEA</code>è·‘<code>SpringCloud</code>é¡¹ç›®æ³¨å†Œåˆ°éƒ¨ç½²å¥½çš„<code>Consul</code>æœåŠ¡ï¼Œå½“æœåŠ¡æ³¨å†Œå¥½ä¹‹åï¼Œæ£€æŸ¥å…¶å¥åº·çŠ¶æ€ï¼Œå‘ç°æœåŠ¡ä¸€ç›´æç¤º<code>All node checks passing</code>æŠ¥äº†ä¸ªå°çº¢å‰âŒã€‚</p><h3 id="è§£å†³"><a href="#è§£å†³" class="headerlink" title="è§£å†³"></a>è§£å†³</h3><p>é€šè¿‡å„ç§å°è¯•éƒ½å‘è§£å†³ä¹‹åï¼Œå‘ç°æ˜¯å› ä¸ºåœ¨å®¹å™¨å†…éƒ¨è°ƒç”¨å®¹å™¨å¤–ï¼ˆå®¿ä¸»æœºï¼‰çš„ç›¸åº”æœåŠ¡çš„æ—¶å€™ç½‘ç»œä¸é€šï¼Œå¯¼è‡´å¥åº·æ£€æŸ¥ä¸€ç›´å¤„äºå¤±è´¥çš„çŠ¶æ€ï¼Œäºæ˜¯ï¼Œä¿®æ”¹<code>SpringCloud</code>å·¥ç¨‹çš„é…ç½®æ–‡ä»¶ï¼Œæ–°å¢é…ç½®ï¼š</p><figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="meta">spring.cloud.consul.discovery.preferIpAddress</span>=<span class="string">true</span></span><br><span class="line"><span class="meta">spring.cloud.consul.discovery.ipAddress</span>=<span class="string">docker.for.mac.host.internal</span></span><br></pre></td></tr></table></figure><p>é‡æ–°å¯åŠ¨æœåŠ¡ï¼Œå„é¡¹æ£€æŸ¥éƒ½æ­£å¸¸äº†ã€‚</p><ul><li>ä»¥ä¸Šæ“ä½œç¯å¢ƒæ˜¯<code>macOS</code>ï¼Œæœªåœ¨åˆ«çš„ç¯å¢ƒé‡ç°å’Œè§£å†³è¿™ä¸ªé—®é¢˜ã€‚</li><li>å®¹å™¨å†…å¯ä»¥é€šè¿‡<code>docker.for.mac.host.internal</code>è®¿é—®å®¿ä¸»æœºç½‘ç»œå’Œç«¯å£ã€‚</li></ul>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®°æœ¬ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> å¾®æœåŠ¡ </tag>
            
            <tag> Consul </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>APIç­¾åéªŒè¯æ–¹æ¡ˆ</title>
      <link href="post/138fc827/"/>
      <url>post/138fc827/</url>
      
        <content type="html"><![CDATA[<h2 id="æ¥å£å®‰å…¨é—®é¢˜"><a href="#æ¥å£å®‰å…¨é—®é¢˜" class="headerlink" title="æ¥å£å®‰å…¨é—®é¢˜"></a>æ¥å£å®‰å…¨é—®é¢˜</h2><ul><li>è¯·æ±‚èº«ä»½æ˜¯å¦åˆæ³•ï¼Ÿ</li><li>è¯·æ±‚å‚æ•°æ˜¯å¦è¢«ç¯¡æ”¹ï¼Ÿ</li><li>è¯·æ±‚æ˜¯å¦å”¯ä¸€ï¼Ÿ</li></ul><h2 id="AccessKey-amp-SecretKey-ï¼ˆå¼€æ”¾å¹³å°ï¼‰"><a href="#AccessKey-amp-SecretKey-ï¼ˆå¼€æ”¾å¹³å°ï¼‰" class="headerlink" title="AccessKey&amp;SecretKey ï¼ˆå¼€æ”¾å¹³å°ï¼‰"></a>AccessKey&amp;SecretKey ï¼ˆå¼€æ”¾å¹³å°ï¼‰</h2><h3 id="è¯·æ±‚èº«ä»½"><a href="#è¯·æ±‚èº«ä»½" class="headerlink" title="è¯·æ±‚èº«ä»½"></a>è¯·æ±‚èº«ä»½</h3><p>ä¸ºå¼€å‘è€…åˆ†é…**<code>AccessKey</code><strong>ï¼ˆå¼€å‘è€…æ ‡è¯†ï¼Œç¡®ä¿å”¯ä¸€ï¼‰å’Œ</strong><code>SecretKey</code>**ï¼ˆç”¨äºæ¥å£åŠ å¯†ï¼Œç¡®ä¿ä¸æ˜“è¢«ç©·ä¸¾ï¼Œç”Ÿæˆç®—æ³•ä¸æ˜“è¢«çŒœæµ‹ï¼‰ã€‚</p><h3 id="é˜²æ­¢ç¯¡æ”¹"><a href="#é˜²æ­¢ç¯¡æ”¹" class="headerlink" title="é˜²æ­¢ç¯¡æ”¹"></a>é˜²æ­¢ç¯¡æ”¹</h3><p><strong>å‚æ•°ç­¾å</strong></p><ol><li>æŒ‰ç…§è¯·æ±‚å‚æ•°åçš„å­—æ¯å‡åºæ’åˆ—éç©ºè¯·æ±‚å‚æ•°ï¼ˆåŒ…å«<code>AccessKey</code>ï¼‰ï¼Œä½¿ç”¨<code>URL</code>é”®å€¼å¯¹çš„æ ¼å¼ï¼ˆå³<code>key1=value1&amp;key2=value2â€¦</code>ï¼‰æ‹¼æ¥æˆå­—ç¬¦ä¸²stringAï¼›</li><li>åœ¨<code>stringA</code>æœ€åæ‹¼æ¥ä¸Š<code>Secretkey</code>å¾—åˆ°å­—ç¬¦ä¸²<code>stringSignTemp</code>ï¼›</li><li>å¯¹<code>stringSignTemp</code>è¿›è¡Œ<code>MD5</code>è¿ç®—ï¼Œå¹¶å°†å¾—åˆ°çš„å­—ç¬¦ä¸²æ‰€æœ‰å­—ç¬¦è½¬æ¢ä¸ºå¤§å†™ï¼Œå¾—åˆ°<code>sign</code>å€¼ã€‚</li></ol><p>è¯·æ±‚æºå¸¦å‚æ•°**<code>AccessKey</code><strong>å’Œ</strong><code>Sign</code><strong>ï¼Œåªæœ‰æ‹¥æœ‰åˆæ³•çš„èº«ä»½<code>AccessKey</code>å’Œæ­£ç¡®çš„ç­¾å<code>Sign</code>æ‰èƒ½æ”¾è¡Œã€‚è¿™æ ·å°±è§£å†³äº†èº«ä»½éªŒè¯å’Œå‚æ•°ç¯¡æ”¹é—®é¢˜ï¼Œå³ä½¿è¯·æ±‚å‚æ•°è¢«åŠ«æŒï¼Œç”±äºè·å–ä¸åˆ°<code>SecretKey</code>ï¼ˆ</strong>ä»…ä½œæœ¬åœ°åŠ å¯†ä½¿ç”¨ï¼Œä¸å‚ä¸ç½‘ç»œä¼ è¾“**ï¼‰ï¼Œæ— æ³•ä¼ªé€ åˆæ³•çš„è¯·æ±‚ã€‚</p><h3 id="é‡æ”¾æ”»å‡»"><a href="#é‡æ”¾æ”»å‡»" class="headerlink" title="é‡æ”¾æ”»å‡»"></a>é‡æ”¾æ”»å‡»</h3><p>è™½ç„¶è§£å†³äº†è¯·æ±‚å‚æ•°è¢«ç¯¡æ”¹çš„éšæ‚£ï¼Œä½†æ˜¯è¿˜å­˜åœ¨ç€é‡å¤ä½¿ç”¨è¯·æ±‚å‚æ•°ä¼ªé€ äºŒæ¬¡è¯·æ±‚çš„éšæ‚£ã€‚</p><p><strong>timestamp+nonceæ–¹æ¡ˆ</strong></p><p><code>nonce</code>æŒ‡<strong>å”¯ä¸€çš„éšæœºå­—ç¬¦ä¸²</strong>ï¼Œç”¨æ¥æ ‡è¯†æ¯ä¸ªè¢«ç­¾åçš„è¯·æ±‚ã€‚é€šè¿‡ä¸ºæ¯ä¸ªè¯·æ±‚æä¾›ä¸€ä¸ªå”¯ä¸€çš„æ ‡è¯†ç¬¦ï¼ŒæœåŠ¡å™¨èƒ½å¤Ÿé˜²æ­¢è¯·æ±‚è¢«å¤šæ¬¡ä½¿ç”¨ï¼ˆè®°å½•æ‰€æœ‰ç”¨è¿‡çš„<code>nonce</code>ä»¥é˜»æ­¢å®ƒä»¬è¢«äºŒæ¬¡ä½¿ç”¨ï¼‰ã€‚</p><p>ç„¶è€Œï¼Œå¯¹æœåŠ¡å™¨æ¥è¯´æ°¸ä¹…å­˜å‚¨æ‰€æœ‰æ¥æ”¶åˆ°çš„<code>nonce</code>çš„ä»£ä»·æ˜¯éå¸¸å¤§çš„ã€‚å¯ä»¥ä½¿ç”¨**<code>timestamp</code>æ¥ä¼˜åŒ–<code>nonce</code>çš„å­˜å‚¨**ã€‚</p><p>å‡è®¾å…è®¸å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯æœ€å¤šèƒ½å­˜åœ¨15åˆ†é’Ÿçš„æ—¶é—´å·®ï¼ŒåŒæ—¶è¿½è¸ªè®°å½•åœ¨æœåŠ¡ç«¯çš„<code>nonce</code>é›†åˆã€‚å½“æœ‰æ–°çš„è¯·æ±‚è¿›å…¥æ—¶ï¼Œé¦–å…ˆæ£€æŸ¥æºå¸¦çš„<code>timestamp</code>æ˜¯å¦åœ¨15åˆ†é’Ÿå†…ï¼Œå¦‚è¶…å‡ºæ—¶é—´èŒƒå›´ï¼Œåˆ™æ‹’ç»ï¼Œç„¶åæŸ¥è¯¢æºå¸¦çš„<code>nonce</code>ï¼Œå¦‚å­˜åœ¨å·²æœ‰é›†åˆï¼Œåˆ™æ‹’ç»ã€‚å¦åˆ™ï¼Œè®°å½•è¯¥<code>nonce</code>ï¼Œå¹¶åˆ é™¤é›†åˆå†…æ—¶é—´æˆ³å¤§äº15åˆ†é’Ÿçš„<code>nonce</code>ï¼ˆå¯ä»¥ä½¿ç”¨<code>redis</code>çš„<code>expire</code>ï¼Œæ–°å¢<code>nonce</code>çš„åŒæ—¶è®¾ç½®å®ƒçš„è¶…æ—¶å¤±æ•ˆæ—¶é—´ä¸º15åˆ†é’Ÿï¼‰ã€‚</p><h3 id="å®ç°"><a href="#å®ç°" class="headerlink" title="å®ç°"></a>å®ç°</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">è¯·æ±‚æ¥å£ï¼šhttp://api.test.com/test?name=hello&amp;home=world&amp;work=java</span><br></pre></td></tr></table></figure><ul><li><p><u><strong>å®¢æˆ·ç«¯</strong></u></p></li><li><ol><li><p>ç”Ÿæˆå½“å‰æ—¶é—´æˆ³<code>timestamp=now</code>å’Œå”¯ä¸€éšæœºå­—ç¬¦ä¸²<code>nonce=random</code></p></li><li><p>æŒ‰ç…§è¯·æ±‚å‚æ•°åçš„å­—æ¯å‡åºæ’åˆ—éç©ºè¯·æ±‚å‚æ•°ï¼ˆåŒ…å«<code>AccessKey</code>)ï¼š</p><p><code>stringA=&quot;AccessKey=access&amp;home=world&amp;name=hello&amp;work=java&amp;timestamp=now&amp;nonce=random&quot;;</code></p></li><li><p>æ‹¼æ¥å¯†é’¥<code>SecretKey</code>ï¼š</p><p><code>stringSignTemp=&quot;AccessKey=access&amp;home=world&amp;name=hello&amp;work=java&amp;timestamp=now&amp;nonce=random&amp;SecretKey=secret&quot;;</code></p></li><li><p><code>MD5</code>å¹¶è½¬æ¢ä¸ºå¤§å†™ï¼š</p><p><code>sign=MD5(stringSignTemp).toUpperCase();</code></p></li><li><p>æœ€ç»ˆè¯·æ±‚ï¼š</p><p><code>http://api.test.com/test?name=hello&amp;home=world&amp;work=java&amp;timestamp=now&amp;nonce=nonce&amp;sign=sign;</code></p></li></ol></li><li><p><strong><u>æœåŠ¡ç«¯</u></strong></p><p><img src="https://gitee.com/cayzlh/img-repo/raw/master/2020/09/17024116013701611601370161045.png" alt="image-20200929170240504"></p></li></ul><h2 id="Token-amp-AppKeyï¼ˆAPPï¼‰"><a href="#Token-amp-AppKeyï¼ˆAPPï¼‰" class="headerlink" title="Token&amp;AppKeyï¼ˆAPPï¼‰"></a>Token&amp;AppKeyï¼ˆAPPï¼‰</h2><p>åœ¨<code>APP</code>å¼€æ”¾<code>API</code>æ¥å£çš„è®¾è®¡ä¸­ï¼Œç”±äºå¤§å¤šæ•°æ¥å£æ¶‰åŠåˆ°ç”¨æˆ·çš„ä¸ªäººä¿¡æ¯ä»¥åŠäº§å“çš„æ•æ„Ÿæ•°æ®ï¼Œæ‰€ä»¥è¦å¯¹è¿™äº›æ¥å£è¿›è¡Œèº«ä»½éªŒè¯ï¼Œä¸ºäº†å®‰å…¨èµ·è§è®©ç”¨æˆ·æš´éœ²çš„æ˜æ–‡å¯†ç æ¬¡æ•°è¶Šå°‘è¶Šå¥½ï¼Œç„¶è€Œå®¢æˆ·ç«¯ä¸æœåŠ¡å™¨çš„äº¤äº’åœ¨è¯·æ±‚ä¹‹é—´æ˜¯æ— çŠ¶æ€çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå½“æ¶‰åŠåˆ°ç”¨æˆ·çŠ¶æ€æ—¶ï¼Œæ¯æ¬¡è¯·æ±‚éƒ½è¦å¸¦ä¸Šèº«ä»½éªŒè¯ä¿¡æ¯ã€‚</p><h3 id="Tokenèº«ä»½éªŒè¯"><a href="#Tokenèº«ä»½éªŒè¯" class="headerlink" title="Tokenèº«ä»½éªŒè¯"></a>Tokenèº«ä»½éªŒè¯</h3><ol><li>ç”¨æˆ·ç™»å½•å‘æœåŠ¡å™¨æä¾›è®¤è¯ä¿¡æ¯ï¼ˆå¦‚è´¦å·å’Œå¯†ç ï¼‰ï¼ŒæœåŠ¡å™¨éªŒè¯æˆåŠŸå**è¿”å›<code>Token</code>**ç»™å®¢æˆ·ç«¯ï¼›</li><li>å®¢æˆ·ç«¯å°†<code>Token</code>ä¿å­˜åœ¨æœ¬åœ°ï¼Œåç»­å‘èµ·è¯·æ±‚æ—¶ï¼Œ<strong>æºå¸¦æ­¤Token</strong>ï¼›</li><li>æœåŠ¡å™¨æ£€æŸ¥<code>Token</code>çš„æœ‰æ•ˆæ€§ï¼Œæœ‰æ•ˆåˆ™æ”¾è¡Œï¼Œæ— æ•ˆï¼ˆ<code>Token</code>é”™è¯¯æˆ–è¿‡æœŸï¼‰åˆ™æ‹’ç»ã€‚</li></ol><p><strong>å®‰å…¨éšæ‚£</strong>ï¼š<code>Token</code>è¢«åŠ«æŒï¼Œä¼ªé€ è¯·æ±‚å’Œç¯¡æ”¹å‚æ•°ã€‚</p><h3 id="Token-AppKeyç­¾åéªŒè¯"><a href="#Token-AppKeyç­¾åéªŒè¯" class="headerlink" title="Token+AppKeyç­¾åéªŒè¯"></a>Token+AppKeyç­¾åéªŒè¯</h3><p>ä¸ä¸Šé¢å¼€å‘å¹³å°çš„éªŒè¯æ–¹å¼ç±»ä¼¼ï¼Œä¸ºå®¢æˆ·ç«¯åˆ†é…**<code>AppKey</code><strong>ï¼ˆå¯†é’¥ï¼Œç”¨äºæ¥å£åŠ å¯†ï¼Œä¸å‚ä¸ä¼ è¾“ï¼‰ï¼Œå°†<code>AppKey</code>å’Œæ‰€æœ‰è¯·æ±‚å‚æ•°ç»„åˆæˆæºä¸²ï¼Œæ ¹æ®</strong>ç­¾åç®—æ³•<strong>ç”Ÿæˆç­¾åå€¼ï¼Œå‘é€è¯·æ±‚æ—¶å°†ç­¾åå€¼ä¸€èµ·å‘é€ç»™æœåŠ¡å™¨éªŒè¯ã€‚è¿™æ ·ï¼Œå³ä½¿<code>Token</code>è¢«åŠ«æŒï¼Œå¯¹æ–¹ä¸çŸ¥é“<code>AppKey</code>å’Œç­¾åç®—æ³•ï¼Œå°±æ— æ³•ä¼ªé€ è¯·æ±‚å’Œç¯¡æ”¹å‚æ•°ã€‚å†ç»“åˆä¸Šè¿°çš„</strong>é‡å‘æ”»å‡»**è§£å†³æ–¹æ¡ˆï¼Œå³ä½¿è¯·æ±‚å‚æ•°è¢«åŠ«æŒä¹Ÿæ— æ³•ä¼ªé€ äºŒæ¬¡é‡å¤è¯·æ±‚ã€‚</p><h3 id="å®ç°-1"><a href="#å®ç°-1" class="headerlink" title="å®ç°"></a>å®ç°</h3><p><strong><u>ç™»å½•å’Œé€€å‡ºè¯·æ±‚</u></strong></p><p><img src="https://gitee.com/cayzlh/img-repo/raw/master/2020/09/17105416013706541601370654137.png" alt="image-20200929171053770"></p><p><strong><u>åç»­è¯·æ±‚</u></strong></p><ul><li><p>å®¢æˆ·ç«¯ å’Œä¸Šè¿°å¼€æ”¾å¹³å°çš„å®¢æˆ·ç«¯è¡Œä¸ºç±»ä¼¼ï¼ŒæŠŠ<code>AccessKey</code>æ”¹ä¸º<code>token</code>å³å¯ã€‚</p></li><li><p>æœåŠ¡ç«¯</p><p><img src="https://gitee.com/cayzlh/img-repo/raw/master/2020/09/17140816013708481601370848386.png" alt="image-20200929171408101"></p></li></ul><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul><li>  <a href="https://mp.weixin.qq.com/s/QUaLa8oU4B1rCb-8FCs79g">èŠ‹é“æºç </a></li></ul>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®°æœ¬ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> æ¥å£å®‰å…¨ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Javaä¸­çš„å¼•ç”¨ç±»å‹</title>
      <link href="post/2928904442/"/>
      <url>post/2928904442/</url>
      
        <content type="html"><![CDATA[<p><code>Java</code>æä¾›çš„4ç§å¼•ç”¨ç±»å‹ï¼Œå®ƒä»¬åˆ†åˆ«æ˜¯**å¼ºå¼•ç”¨(StrongReference)<strong>ã€</strong>è½¯å¼•ç”¨(SoftReference)<strong>ã€</strong>å¼±å¼•ç”¨(WeakReference)<strong>å’Œ</strong>å¹½çµå¼•ç”¨(PhantomReference)**ã€‚</p><h3 id="å¼ºå¼•ç”¨-StrongReference"><a href="#å¼ºå¼•ç”¨-StrongReference" class="headerlink" title="å¼ºå¼•ç”¨(StrongReference)"></a>å¼ºå¼•ç”¨(StrongReference)</h3><p>å¼ºå¼•ç”¨æ˜¯<code>Java</code>ç¼–ç¨‹ä¸­æœ€æ™®éçš„å¼•ç”¨ï¼Œä¾‹å¦‚<code>Objectobj=newObject()</code>ä¸­ï¼Œæ–°å»ºçš„Objectå¯¹è±¡å°±æ˜¯è¢«å¼ºå¼•ç”¨çš„ã€‚</p><p>å¦‚æœä¸€ä¸ªå¯¹è±¡è¢«å¼ºå¼•ç”¨ï¼Œå³ä½¿æ˜¯<code>Java</code>è™šæ‹Ÿæœºå†…å­˜ç©ºé—´ä¸è¶³æ—¶ï¼Œ<code>GC</code>(åƒåœ¾æ”¶é›†å™¨)ä¹Ÿç»ä¸ä¼šå›æ”¶è¯¥å¯¹è±¡ã€‚</p><p>å½“<code>Java</code>è™šæ‹Ÿæœºå†…å­˜ä¸è¶³æ—¶ï¼Œå°±å¯èƒ½ä¼šå¯¼è‡´å†…å­˜æº¢å‡ºï¼Œæˆ‘ä»¬å¸¸è§çš„å°±æ˜¯<code>OutOfMemoryError</code>å¼‚å¸¸ã€‚</p><h3 id="è½¯å¼•ç”¨-SoftReference"><a href="#è½¯å¼•ç”¨-SoftReference" class="headerlink" title="è½¯å¼•ç”¨(SoftReference)"></a>è½¯å¼•ç”¨(SoftReference)</h3><p>è½¯å¼•ç”¨æ˜¯å¼•ç”¨å¼ºåº¦ä»…å¼±äºå¼ºå¼•ç”¨çš„ä¸€ç§å¼•ç”¨ï¼Œå®ƒä½¿ç”¨ç±»<code>SoftReference</code>æ¥è¡¨ç¤ºã€‚</p><p>å½“<code>Java</code>è™šæ‹Ÿæœºå†…å­˜ä¸è¶³æ—¶ï¼Œ<code>GC</code>ä¼šå›æ”¶é‚£äº›åªè¢«è½¯å¼•ç”¨æŒ‡å‘çš„å¯¹è±¡ï¼Œä»è€Œé¿å…å†…å­˜æº¢å‡ºã€‚</p><p>åœ¨<code>GC</code>é‡Šæ”¾äº†é‚£äº›åªè¢«è½¯å¼•ç”¨æŒ‡å‘çš„å¯¹è±¡ä¹‹åï¼Œè™šæ‹Ÿæœºå†…å­˜ä¾ç„¶ä¸è¶³ï¼Œæ‰ä¼šæŠ›å‡º<code>OutOfMemoryError</code>å¼‚å¸¸ã€‚</p><p>è½¯å¼•ç”¨é€‚åˆå¼•ç”¨é‚£äº›å¯ä»¥é€šè¿‡å…¶ä»–æ–¹å¼æ¢å¤çš„å¯¹è±¡ï¼Œä¾‹å¦‚ï¼Œæ•°æ®åº“ç¼“å­˜ä¸­çš„å¯¹è±¡å°±å¯ä»¥ä»æ•°æ®åº“ä¸­æ¢å¤ï¼Œæ‰€ä»¥è½¯å¼•ç”¨å¯ä»¥ç”¨æ¥å®ç°ç¼“å­˜ã€‚<br>å¦å¤–ï¼Œç”±äºåœ¨ç¨‹åºä½¿ç”¨è½¯å¼•ç”¨ä¹‹å‰çš„æŸä¸ªæ—¶åˆ»ï¼Œå…¶æ‰€æŒ‡å‘çš„å¯¹è±¡å¯èƒ½å·²ç»è¢«GÂ·Cå›æ”¶æ‰äº†ï¼Œæ‰€ä»¥é€šè¿‡<code>Reference.get()</code>æ–¹æ³•æ¥è·å–è½¯å¼•ç”¨æ‰€æŒ‡å‘çš„å¯¹è±¡æ—¶ï¼Œæ€»æ˜¯è¦é€šè¿‡æ£€æŸ¥è¯¥æ–¹æ³•è¿”å›å€¼æ˜¯å¦ä¸º<code>null</code>,æ¥åˆ¤æ–­è¢«è½¯å¼•ç”¨çš„å¯¹è±¡æ˜¯å¦è¿˜å­˜æ´»ã€‚</p><h3 id="å¼•ç”¨é˜Ÿåˆ—-ReferenceQueue"><a href="#å¼•ç”¨é˜Ÿåˆ—-ReferenceQueue" class="headerlink" title="å¼•ç”¨é˜Ÿåˆ— (ReferenceQueue )"></a>å¼•ç”¨é˜Ÿåˆ— (ReferenceQueue )</h3><p>åœ¨å¾ˆå¤šåœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬çš„ç¨‹åºéœ€è¦åœ¨ä¸€ä¸ªå¯¹è±¡çš„å¯è¾¾æ€§(æ˜¯å¦å·±ç»è¢«<code>GC</code>å›æ”¶)å‘ç”Ÿå˜åŒ–æ—¶å¾—åˆ°é€šçŸ¥ï¼Œå¼•ç”¨é˜Ÿåˆ—å°±æ˜¯ç”¨äºæ”¶é›†è¿™äº›ä¿¡æ¯çš„é˜Ÿåˆ—ã€‚</p><p>åœ¨åˆ›å»º<code>SoftReference</code>å¯¹è±¡æ—¶ï¼Œå¯ä»¥ä¸ºå…¶å…³è”ä¸€ä¸ªå¼•ç”¨é˜Ÿåˆ—ï¼Œå½“<code>SoftReference</code>æ‰€å¼•ç”¨çš„å¯¹è±¡è¢«GCå›æ”¶æ—¶ï¼Œ<code>Java</code>è™šæ‹Ÿæœºå°±ä¼šå°†è¯¥<code>SoftReference</code>å¯¹è±¡æ·»åŠ åˆ°ä¸ä¹‹å…³è”çš„å¼•ç”¨é˜Ÿåˆ—ä¸­ã€‚</p><p>å½“éœ€è¦æ£€æµ‹è¿™äº›é€šçŸ¥ä¿¡æ¯æ—¶ï¼Œå°±å¯ä»¥ä»å¼•ç”¨é˜Ÿåˆ—ä¸­è·å–è¿™äº›<code>SoftReference</code>å¯¹è±¡ã€‚ä¸ä»…æ˜¯<code>SoftReference</code>ï¼Œä¸‹é¢ä»‹ç»çš„å¼±å¼•ç”¨å’Œå¹½çµå¼•ç”¨éƒ½å¯ä»¥å…³è”ç›¸åº”çš„é˜Ÿåˆ—ã€‚</p><h3 id="å¼±å¼•ç”¨-WeakReference"><a href="#å¼±å¼•ç”¨-WeakReference" class="headerlink" title="å¼±å¼•ç”¨(WeakReference)"></a>å¼±å¼•ç”¨(WeakReference)</h3><p><strong>å¼±å¼•ç”¨çš„å¼ºåº¦æ¯”è½¯å¼•ç”¨çš„å¼ºåº¦è¿˜è¦å¼±ã€‚</strong>å¼±å¼•ç”¨ä½¿ç”¨<code>WeakReference</code>æ¥è¡¨ç¤ºï¼Œå®ƒå¯ä»¥å¼•ç”¨ä¸€ä¸ªå¯¹è±¡ï¼Œä½†å¹¶ä¸é˜»æ­¢è¢«å¼•ç”¨çš„å¯¹è±¡è¢«<code>GC</code>å›æ”¶ã€‚åœ¨<code>JVM</code>è™šæ‹Ÿæœºè¿›è¡Œåƒåœ¾å›æ”¶æ—¶ï¼Œå¦‚æœæŒ‡å‘ä¸€ä¸ªå¯¹è±¡çš„æ‰€æœ‰å¼•ç”¨éƒ½æ˜¯å¼±å¼•ç”¨ï¼Œé‚£ä¹ˆè¯¥å¯¹è±¡ä¼šè¢«å›æ”¶ã€‚</p><p>ç”±æ­¤å¯è§ï¼Œåªè¢«å¼±å¼•ç”¨æ‰€æŒ‡å‘çš„å¯¹è±¡çš„ç”Ÿå­˜å‘¨æœŸæ˜¯ä¸¤æ¬¡<code>GC</code>ä¹‹é—´çš„è¿™æ®µæ—¶é—´ï¼Œè€Œåªè¢«è½¯å¼•ç”¨æ‰€æŒ‡å‘çš„å¯¹è±¡å¯ä»¥ç»å†å¤šæ¬¡<code>GC</code>ï¼Œç›´åˆ°å‡ºç°å†…å­˜ç´§å¼ çš„æƒ…å†µæ‰è¢«å›æ”¶ã€‚<br>å¼±å¼•ç”¨å…¸å‹çš„åº”ç”¨æƒ…æ™¯æ˜¯å°±æ˜¯<code>JDK</code>æä¾›çš„<code>java.util.WeakHashMap</code>ã€‚<code>WeakHashMap.Entry</code>å®ç°ç»§æ‰¿äº†<code>WeakReference</code>ï¼Œ<code>Entry</code>å¼±å¼•ç”¨<code>key</code>ï¼Œå¼ºå¼•ç”¨<code>value</code>ã€‚</p><p><img src="https://gitee.com/cayzlh/img-repo/raw/master/2020/06/18/image-20200618214631511_eBFg3j.png" alt="image-20200618214631511"></p><p>å½“ä¸å†ç”±å¼ºå¼•ç”¨æŒ‡å‘<code>key</code>æ—¶ï¼Œåˆ™<code>key</code>å¯ä»¥è¢«åƒåœ¾å›æ”¶ï¼Œå½“<code>key</code>è¢«åƒåœ¾å›æ”¶ä¹‹åï¼Œå¯¹åº”çš„<code>Entry</code>å¯¹è±¡ä¼šè¢«<code>Java</code>è™šæ‹ŸæœºåŠ å…¥åˆ°å…¶å…³è”çš„é˜Ÿåˆ—ä¸­ã€‚</p><p>å½“åº”ç”¨ç¨‹åºä¸‹æ¬¡æ“ä½œ<code>WeakHashMap</code>æ—¶ï¼Œä¾‹å¦‚å¯¹<code>WeakHashMap</code>çš„æ‰©å®¹æ“ä½œï¼Œå°±ä¼šéå†å…³è”çš„å¼•ç”¨é˜Ÿåˆ—ï¼Œå°†å…¶ä¸­çš„<code>Entry</code>å¯¹è±¡ä»<code>WeakHashMap</code>ä¸­åˆ é™¤ã€‚</p><h3 id="å¹½çµå¼•ç”¨-PhantomReference"><a href="#å¹½çµå¼•ç”¨-PhantomReference" class="headerlink" title="å¹½çµå¼•ç”¨(PhantomReference)"></a>å¹½çµå¼•ç”¨(PhantomReference)</h3><p>åœ¨ä»‹ç»å¹½çµå¼•ç”¨ä¹‹å‰ï¼Œè¦å…ˆäº†è§£ä¸€ä¸‹<code>Java</code>æä¾›çš„å¯¹è±¡ç»ˆæ­¢åŒ–æœºåˆ¶ã€‚</p><p>åœ¨<code>Object</code>ç±»é‡Œé¢æœ‰ä¸ª<code>finalize()</code>æ–¹æ³•ï¼Œè®¾è®¡è¯¥æ–¹æ³•çš„åˆè¡·æ˜¯åœ¨ä¸€ä¸ªå¯¹è±¡è¢«çœŸæ­£å›æ”¶ä¹‹å‰ï¼Œæ‰§è¡Œä¸€äº›æ¸…ç†å·¥ä½œï¼Œä½†ç”±äº<code>GC</code>çš„è¿è¡Œæ—¶é—´æ˜¯ä¸å›ºå®šçš„ï¼Œæ‰€ä»¥è¿™äº›æ¸…ç†å·¥ä½œçš„å®é™…è¿è¡Œæ—¶é—´ä¹Ÿæ˜¯æ— æ³•é¢„çŸ¥çš„ï¼Œè€Œä¸”<code>JVM</code>è™šæ‹Ÿæœºä¸èƒ½ä¿è¯<code>finalize()</code>æ–¹æ³•ä¸€å®šä¼šè¢«è°ƒç”¨ã€‚</p><p>æ¯ä¸ªå¯¹è±¡çš„<code>finalize()</code>æ–¹æ³•è‡³å¤šç”±<code>GC</code>æ‰§è¡Œä¸€æ¬¡ï¼Œå¯¹äºå†ç”Ÿå¯¹è±¡<code>GC</code>ä¸ä¼šå†æ¬¡è°ƒç”¨å…¶<code>finalize()</code>æ–¹æ³•ã€‚å¦å¤–ï¼Œä½¿ç”¨<code>finalize()</code>æ–¹æ³•è¿˜ä¼šå¯¼è‡´ä¸¥é‡çš„å†…å­˜æ¶ˆè€—å’Œæ€§èƒ½æŸå¤±ã€‚</p><p>ç”±äº<code>finalize()</code>æ–¹æ³•å­˜åœ¨çš„ç§ç§é—®é¢˜ï¼Œè¯¥æ–¹æ³•ç°åœ¨å·²ç»è¢«åºŸå¼ƒï¼Œè€Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¹½çµå¼•ç”¨å®ç°å…¶æ›¿ä»£æ–¹æ¡ˆã€‚</p><p>å¹½çµå¼•ç”¨ï¼Œåˆå«â€œ<strong>è™šå¼•ç”¨</strong>â€ï¼Œå®ƒæ˜¯æœ€å¼±çš„ä¸€ç§å¼•ç”¨ç±»å‹ï¼Œç”±ç±»<code>PhantomReference</code>è¡¨ç¤ºã€‚åœ¨å¼•ç”¨çš„å¯¹è±¡æœªè¢«<code>GC</code>å›æ”¶æ—¶ï¼Œè°ƒç”¨å‰é¢ä»‹ç»çš„<code>SoftReference</code>ä»¥åŠ<code>WeakReference</code>çš„<code>get()</code>æ–¹æ³•ï¼Œå¾—åˆ°çš„æ˜¯å…¶å¼•ç”¨çš„å¯¹è±¡ï¼›å½“å¼•ç”¨çš„å¯¹è±¡å·²ç»è¢«<code>GC</code>å›æ”¶æ—¶ï¼Œåˆ™å¾—åˆ°<code>null</code>ã€‚ä½†æ˜¯<code>PhantomReference.get()</code>æ–¹æ³•å§‹ç»ˆè¿”å›<code>null</code>ã€‚</p><p>åœ¨åˆ›å»ºå¹½çµå¼•ç”¨çš„æ—¶å€™å¿…é¡»è¦æŒ‡å®šä¸€ä¸ªå¼•ç”¨é˜Ÿåˆ—ã€‚å½“<code>GC</code>å‡†å¤‡å›æ”¶ä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œå¦‚æœå‘ç°å®ƒè¿˜æœ‰å¹½çµå¼•ç”¨ï¼Œå°±ä¼šåœ¨å›æ”¶å¯¹è±¡çš„å†…å­˜ä¹‹å‰ï¼ŒæŠŠè¯¥è™šå¼•ç”¨åŠ å…¥åˆ°ä¸ä¹‹å…³è”çš„å¼•ç”¨é˜Ÿåˆ—ä¸­ã€‚</p><p>ç¨‹åºå¯ä»¥é€šè¿‡æ£€æŸ¥è¯¥å¼•ç”¨é˜Ÿåˆ—é‡Œé¢çš„å†…å®¹ï¼Œè·Ÿè¸ªå¯¹è±¡æ˜¯å¦å·±ç»è¢«å›æ”¶å¹¶è¿›è¡Œä¸€äº›æ¸…ç†å·¥ä½œã€‚å¹½çµå¼•ç”¨è¿˜å¯ä»¥ç”¨æ¥å®ç°æ¯”è¾ƒç²¾ç»†çš„å†…å­˜ä½¿ç”¨æ§åˆ¶ï¼Œä¾‹å¦‚åº”ç”¨ç¨‹åºå¯ä»¥åœ¨ç¡®å®šä¸€ä¸ªå¯¹è±¡è¦è¢«å›æ”¶ä¹‹åï¼Œå†ç”³è¯·å†…å­˜åˆ›å»ºæ–°å¯¹è±¡ï¼Œä½†è¿™ç§éœ€æ±‚å¹¶ä¸å¤šè§ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®°æœ¬ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> å¼•ç”¨ç±»å‹ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ‰¹é‡ä¿®æ”¹mavenå¤šæ¨¡å—ç‰ˆæœ¬å·</title>
      <link href="post/2281897980/"/>
      <url>post/2281897980/</url>
      
        <content type="html"><![CDATA[<h2 id="å‰ç½®"><a href="#å‰ç½®" class="headerlink" title="å‰ç½®"></a>å‰ç½®</h2><p>æœ€è¿‘åœ¨å¼€å‘<code>starter</code>çš„æ—¶å€™å‘ç°ï¼Œå½“è¿›è¡Œç‰ˆæœ¬å‡çº§çš„æ—¶å€™éœ€è¦å¯¹æ¯ä¸ªå­æ¨¡å—é¡¹ç›®æ‰‹åŠ¨ä¿®æ”¹ç‰ˆæœ¬å·ï¼Œç”±äºå­æ¨¡å—è¾ƒå¤šï¼Œä¸€ä¸ªä¸ªä¿®æ”¹çš„ä½“éªŒæ˜¯æå·®çš„ï¼Œè€Œä¸”è¿˜å¾ˆå®¹æ˜“å‡ºé”™ã€‚ä½œä¸ºä¸€ä¸ªç¨‹åºçŒ¿ï¼Œå½“ç„¶è¦å»å¯»æ‰¾ä¸€ä¸ªæ›´å¥½çš„å§¿åŠ¿æ¥å®Œæˆè¿™ä»¶äº‹ã€‚</p><p><img src="https://gitee.com/cayzlh/img-repo/raw/master/2020/04/25/s6nLXV.jpeg" alt="è€å¿ƒæ¸æ¸æ¶ˆå¤±"></p><blockquote><p>ä»£ç ç»è¿‡é•¿æœŸä¿®æ”¹åï¼Œç‰ˆæœ¬å·å´ä»æ²¡æœ‰æ¨è¿›ï¼Œå¯¼è‡´ä¸ªåˆ«releaseç¨³å®šç‰ˆçš„æ¨¡å—æ›´æ–°ä»£ç ä¹‹åï¼Œå…¶ä»–å¼€å‘æœºå™¨å¹¶ä¸ä¼šè‡ªåŠ¨æ›´æ–°æœ¬åœ°ä¾èµ–åŒ…ã€‚å¹¶ä½¿ä¸»å¹²é’ˆå¯¹æŸåˆ†æ”¯çš„ä¿®æ”¹ä¹ŸåŒæ­¥åˆ°å…¶ä»–åˆ†æ”¯ã€‚<br>æ‰€ä»¥ï¼Œæ­¤æ–‡æ¡£æè¿°å¦‚ä½•ä½¿ç”¨versions maven pluginæ’ä»¶ï¼Œæ‰¹é‡ä¿®æ”¹é¡¹ç›®å„æ¨¡å—çš„ç‰ˆæœ¬å·ï¼Œçµæ´»æ¨è¿›æˆ–å›é€€ç‰ˆæœ¬ï¼Œé¿å…ä¸»å¹²æ¯æ¬¡æ›´æ–°ä»£ç ï¼Œç«‹å³å¯¹æ‰€æœ‰åˆ†æ”¯äº§ç”Ÿå½±å“ã€‚</p></blockquote><h2 id="versions-maven-plugin"><a href="#versions-maven-plugin" class="headerlink" title="versions-maven-plugin"></a>versions-maven-plugin</h2><p>åœ¨é—®è¿‡æœç´¢å¼•æ“ä¹‹åï¼Œä¸€æ¬¾<code>maven</code>æ’ä»¶è¿›å…¥äº†æˆ‘çš„è§†çº¿ã€‚ã€‚ã€‚</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.codehaus.mojo<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>versions-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>è¿™æ˜¯ä¸€ä¸ªèƒ½å¤Ÿæ‰¹é‡ä¿®æ”¹ç‰ˆæœ¬å·çš„æ’ä»¶ï¼Œè¯ä¸å¤šè¯´ï¼Œåœ¨é¡¹ç›®ä¸­å¼•å…¥ã€‚ã€‚</p><p>ä¿®æ”¹<code>pom.xml</code>ï¼Œåœ¨pluginsèŠ‚ç‚¹ä¸‹æ·»åŠ å¦‚ä¸‹ä»£ç ï¼š</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.codehaus.mojo<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>versions-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">generateBackupPoms</span>&gt;</span>false<span class="tag">&lt;/<span class="name">generateBackupPoms</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br></pre></td></tr></table></figure><p>åŒæ­¥å¥½æ’ä»¶ä¹‹åï¼Œåœ¨<code>IDEA</code>å³ä¾§<code>maven</code>çª—å£å¯ä»¥çœ‹åˆ°è¯¥æ’ä»¶å·²ç»å¯ç”¨äº†ã€‚</p><p><img src="https://gitee.com/cayzlh/img-repo/raw/master/2020/04/25/WSOxFp.png" alt="image-20200425152743052"></p><p>å±•å¼€æ’ä»¶ï¼Œå¯ä»¥çœ‹åˆ°å®ƒæœ‰Nä¸ªåŠŸèƒ½ï¼Œæˆ‘ç›®å‰åªç”¨åˆ°äº†<code>version:set</code>è¿™ä¸ªåŠŸèƒ½ï¼š</p><p><img src="https://gitee.com/cayzlh/img-repo/raw/master/2020/04/25/4RcHEf.png" alt="image-20200425152923088"></p><h2 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h2><p>åŒå‡»<code>version:set</code>è¿è¡Œæ’ä»¶ï¼Œä¹‹ååœ¨æ§åˆ¶å°è¾“å…¥ä½ æƒ³ä¿®æ”¹çš„ç‰ˆæœ¬å·å›è½¦ï¼Œç­‰è¿è¡Œå®Œæ¯•ä¹‹åå°±å®Œæˆäº†æ‰€æœ‰æ¨¡å—çš„ç‰ˆæœ¬å·ä¿®æ”¹ã€‚</p><p><img src="https://gitee.com/cayzlh/img-repo/raw/master/2020/04/25/whomAe.png" alt="image-20200425153124721"></p><p>æŸ¥çœ‹<code>git</code>ä¿®æ”¹è®°å½•ï¼Œæ‰€æœ‰æ¨¡å—çš„pomæ–‡ä»¶éƒ½è¢«ä¿®æ”¹è¿‡æ¥äº†ã€‚ ã€‚</p><p><img src="https://gitee.com/cayzlh/img-repo/raw/master/2020/04/25/mgHIsR.png" alt="image-20200425153302509"></p><p>æ¯”ä¹‹å‰çš„æ‰‹åŠ¨ä¿®æ”¹å‡äº†ä¸çŸ¥é“å¤šå°‘æ—¶é—´ã€‚ã€‚ã€‚</p><p>æ¯•ç«Ÿè¿™å¹´å¤´ï¼Œæ—¶é—´ç®¡ç†è¿˜æ˜¯å¾ˆé‡è¦çš„ã€‚ ã€‚ ã€‚ </p><p><img src="https://gitee.com/cayzlh/img-repo/raw/master/2020/04/25/PbF88R.jpg" alt="æ—¶é—´ç®¡ç†"></p>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®°æœ¬ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> Maven </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Springé¢å‘åˆ‡é¢ç¼–ç¨‹ï¼ˆçŸ¥è¯†æ¢³ç†ï¼‰</title>
      <link href="post/741621cd/"/>
      <url>post/741621cd/</url>
      
        <content type="html"><![CDATA[<blockquote><p>Aspect Oriented Programming with Spring</p><p>é¢å‘åˆ‡é¢çš„ç¼–ç¨‹ï¼ˆAOPï¼‰é€šè¿‡æä¾›å¦ä¸€ç§æ€è€ƒç¨‹åºç»“æ„çš„æ–¹å¼æ¥è¡¥å……é¢å‘å¯¹è±¡çš„ç¼–ç¨‹ï¼ˆOOPï¼‰ã€‚</p></blockquote><p> OOPä¸­æ¨¡å—åŒ–çš„å…³é”®å•å…ƒæ˜¯ç±»ï¼Œè€Œåœ¨AOPä¸­æ¨¡å—åŒ–æ˜¯æ–¹é¢ã€‚åˆ‡é¢ä½¿å…³æ³¨ç‚¹ï¼ˆä¾‹å¦‚äº‹åŠ¡ç®¡ç†ï¼‰çš„æ¨¡å—åŒ–è·¨è¶Šäº†å¤šä¸ªç±»å‹å’Œå¯¹è±¡ã€‚ ï¼ˆè¿™ç§å…³æ³¨åœ¨AOPæ–‡çŒ®ä¸­é€šå¸¸è¢«ç§°ä¸ºâ€œè·¨é¢†åŸŸâ€å…³æ³¨ã€‚ï¼‰</p><p>Springçš„å…³é”®ç»„ä»¶ä¹‹ä¸€æ˜¯AOPæ¡†æ¶ã€‚å°½ç®¡Spring IoCå®¹å™¨ä¸ä¾èµ–äºAOPï¼Œä½†<strong>AOPæ˜¯å¯¹Spring IoCçš„è¡¥å……ï¼Œå¯ä»¥æä¾›åŠŸèƒ½å¼ºå¤§çš„ä¸­é—´ä»¶è§£å†³æ–¹æ¡ˆã€‚</strong></p><blockquote><p>Spring AOP with AspectJ pointcuts</p><p>Spring provides simple and powerful ways of writing custom aspects by using either a <a href="https://docs.spring.io/spring-framework/docs/current/spring-framework-reference/core.html#aop-schema">schema-based approach</a> or the <a href="https://docs.spring.io/spring-framework/docs/current/spring-framework-reference/core.html#aop-ataspectj">@AspectJ annotation style</a>. Both of these styles offer fully typed advice and use of the AspectJ pointcut language while still using Spring AOP for weaving.</p><p>å…·æœ‰AspectJåˆ‡å…¥ç‚¹çš„Spring AOP<br>é€šè¿‡ä½¿ç”¨<strong>åŸºäºæ¨¡å¼çš„æ–¹æ³•</strong>æˆ–**@AspectJæ³¨è§£æ ·å¼**ï¼ŒSpringæä¾›äº†ç¼–å†™è‡ªå®šä¹‰åˆ‡é¢çš„ç®€å•è€Œå¼ºå¤§çš„æ–¹æ³•ã€‚è¿™ä¸¤ç§æ ·å¼éƒ½æä¾›äº†å®Œå…¨ç±»å‹åŒ–çš„å»ºè®®ï¼Œå¹¶ä½¿ç”¨äº†AspectJåˆ‡å…¥ç‚¹è¯­è¨€ï¼ŒåŒæ—¶ä»ç„¶ä½¿ç”¨Spring AOPè¿›è¡Œç¼–ç¨‹ã€‚</p></blockquote><h2 id="Spring-AOPæ¦‚å¿µ"><a href="#Spring-AOPæ¦‚å¿µ" class="headerlink" title="Spring AOPæ¦‚å¿µ"></a>Spring AOPæ¦‚å¿µ</h2><p>ä¸€äº›é‡è¦çš„AOPæ¦‚å¿µå’Œæœ¯è¯­ã€‚<em>è¿™äº›æœ¯è¯­ä¸æ˜¯ç‰¹å®šäºSpringçš„ã€‚</em></p><ul><li><p><strong>åˆ‡é¢ï¼ˆAspectï¼‰</strong></p><p>ç±»æ˜¯å¯¹ç‰©ä½“ç‰¹å¾çš„æŠ½è±¡ï¼Œ<em>åˆ‡é¢å°±æ˜¯å¯¹æ¨ªåˆ‡å…³æ³¨ç‚¹çš„æŠ½è±¡</em>ã€‚</p><blockquote><p>åœ¨Spring AOPä¸­ï¼Œåˆ‡é¢æ˜¯é€šè¿‡ä½¿ç”¨å¸¸è§„ç±»ï¼ˆåŸºäºæ¶æ„çš„æ–¹æ³•ï¼‰æˆ–ä½¿ç”¨@Aspectæ³¨é‡Šï¼ˆ@AspectJæ ·å¼ï¼‰æ³¨é‡Šçš„å¸¸è§„ç±»æ¥å®ç°çš„ã€‚</p></blockquote><p><code>aspect</code> ç”± <code>pointcount</code> å’Œ <code>advice</code> ç»„æˆ, å®ƒæ—¢åŒ…å«äº†æ¨ªåˆ‡é€»è¾‘çš„å®šä¹‰, ä¹ŸåŒ…æ‹¬äº†è¿æ¥ç‚¹çš„å®šä¹‰. Spring AOPå°±æ˜¯è´Ÿè´£å®æ–½åˆ‡é¢çš„æ¡†æ¶, å®ƒå°†åˆ‡é¢æ‰€å®šä¹‰çš„æ¨ªåˆ‡é€»è¾‘ç»‡å…¥åˆ°åˆ‡é¢æ‰€æŒ‡å®šçš„è¿æ¥ç‚¹ä¸­.<br>AOPçš„å·¥ä½œé‡å¿ƒåœ¨äºå¦‚ä½•å°†å¢å¼ºç»‡å…¥ç›®æ ‡å¯¹è±¡çš„è¿æ¥ç‚¹ä¸Š, è¿™é‡ŒåŒ…å«ä¸¤ä¸ªå·¥ä½œ:</p><ol><li>å¦‚ä½•é€šè¿‡ pointcut å’Œ advice å®šä½åˆ°ç‰¹å®šçš„ joinpoint ä¸Š</li><li>å¦‚ä½•åœ¨ advice ä¸­ç¼–å†™åˆ‡é¢ä»£ç .</li></ol></li><li><p><strong>è¿æ¥ç‚¹ï¼ˆJoin pointï¼‰</strong></p><blockquote><p>A point during the execution of a program, such as the execution of a method or the handling of an exception. In Spring AOP, a join point always represents a method execution.</p></blockquote><p>ç¨‹åºè¿è¡Œä¸­çš„ä¸€äº›æ—¶é—´ç‚¹ï¼Œä¾‹å¦‚ä¸€ä¸ªæ–¹æ³•çš„æ‰§è¡Œï¼Œæˆ–è€…æ˜¯ä¸€ä¸ªå¼‚å¸¸çš„å¤„ç†ã€‚<br><code>åœ¨ Spring AOP ä¸­, join point æ€»æ˜¯æ–¹æ³•çš„æ‰§è¡Œç‚¹, å³åªæœ‰æ–¹æ³•è¿æ¥ç‚¹.</code></p></li><li><p><strong>å¢å¼ºï¼ˆAdviceï¼‰</strong></p><blockquote><p>Action taken by an aspect at a particular join point. Different types of advice include â€œaroundâ€, â€œbeforeâ€ and â€œafterâ€ advice. (Advice types are discussed later.) Many AOP frameworks, including Spring, model an advice as an interceptor and maintain a chain of interceptors around the join point.</p></blockquote><p>åˆ‡é¢åœ¨ç‰¹å®šçš„è¿æ¥ç‚¹å¤„é‡‡å–çš„æ“ä½œã€‚ä¸åŒç±»å‹çš„å»ºè®®åŒ…æ‹¬<code>around</code>ï¼Œ<code>before</code>å’Œ<code>after</code>é€šçŸ¥ã€‚ åŒ…æ‹¬Springåœ¨å†…çš„è®¸å¤šAOPæ¡†æ¶éƒ½å°†é€šçŸ¥å»ºæ¨¡ä¸ºæ‹¦æˆªå™¨ï¼Œå¹¶åœ¨è¿æ¥ç‚¹å‘¨å›´ç»´æŠ¤ä¸€ç³»åˆ—æ‹¦æˆªå™¨ã€‚</p><p>ç”± <code>aspect</code> æ·»åŠ åˆ°ç‰¹å®šçš„ join point(å³æ»¡è¶³ <code>point cut</code> è§„åˆ™çš„ join point) çš„ä¸€æ®µä»£ç .<br>è®¸å¤š <code>AOP</code>æ¡†æ¶, åŒ…æ‹¬ <code>Spring AOP</code>, ä¼šå°† <code>advice</code> æ¨¡æ‹Ÿä¸ºä¸€ä¸ªæ‹¦æˆªå™¨(<code>interceptor</code>), å¹¶ä¸”åœ¨ join point ä¸Šç»´æŠ¤å¤šä¸ª <code>advice</code>, è¿›è¡Œå±‚å±‚æ‹¦æˆª.<br><em>ä¾‹å¦‚ <code>HTTP</code> é‰´æƒçš„å®ç°, æˆ‘ä»¬å¯ä»¥ä¸ºæ¯ä¸ªä½¿ç”¨ <code>RequestMapping</code> æ ‡æ³¨çš„æ–¹æ³•ç»‡å…¥ <code>advice</code>, å½“ <code>HTTP</code> è¯·æ±‚åˆ°æ¥æ—¶, é¦–å…ˆè¿›å…¥åˆ° <code>advice</code> ä»£ç ä¸­, åœ¨è¿™é‡Œæˆ‘ä»¬å¯ä»¥åˆ†æè¿™ä¸ª <code>HTTP</code> è¯·æ±‚æ˜¯å¦æœ‰ç›¸åº”çš„æƒé™, å¦‚æœæœ‰, åˆ™æ‰§è¡Œ <code>Controller</code>, å¦‚æœæ²¡æœ‰, åˆ™æŠ›å‡ºå¼‚å¸¸. è¿™é‡Œçš„ <code>advice</code> å°±æ‰®æ¼”ç€é‰´æƒæ‹¦æˆªå™¨çš„è§’è‰²äº†.</em></p></li><li><p><strong>åˆ‡å…¥ç‚¹ï¼ˆPointcutï¼‰</strong></p><blockquote><p>A predicate that matches join points. Advice is associated with a pointcut expression and runs at any join point matched by the pointcut (for example, the execution of a method with a certain name). The concept of join points as matched by pointcut expressions is central to AOP, and Spring uses the AspectJ pointcut expression language by default.</p></blockquote><p>åŒ¹é…è¿æ¥ç‚¹çš„è°“è¯ã€‚é€šçŸ¥ä¸åˆ‡å…¥ç‚¹è¡¨è¾¾å¼å…³è”ï¼Œå¹¶åœ¨ä¸è¯¥åˆ‡å…¥ç‚¹åŒ¹é…çš„ä»»ä½•è¿æ¥ç‚¹å¤„è¿è¡Œï¼ˆä¾‹å¦‚ï¼Œæ‰§è¡Œå…·æœ‰ç‰¹å®šåç§°çš„æ–¹æ³•ï¼‰ã€‚ä½¿ç”¨åˆ‡å…¥ç‚¹è¡¨è¾¾å¼æ¥åŒ¹é…è¿æ¥ç‚¹æ˜¯AOPçš„æ ¸å¿ƒï¼Œå¹¶ä¸”Springé»˜è®¤ä½¿ç”¨AspectJåˆ‡å…¥ç‚¹è¡¨è¾¾è¯­è¨€ã€‚</p><p>åœ¨ <code>Spring</code> ä¸­, æ‰€æœ‰çš„æ–¹æ³•éƒ½å¯ä»¥è®¤ä¸ºæ˜¯ <code>joinpoint</code>, ä½†æ˜¯æˆ‘ä»¬å¹¶ä¸å¸Œæœ›åœ¨æ‰€æœ‰çš„æ–¹æ³•ä¸Šéƒ½æ·»åŠ  <code>Advice</code>, è€Œ pointcut çš„ä½œç”¨å°±æ˜¯æä¾›ä¸€ç»„è§„åˆ™(ä½¿ç”¨ <em>AspectJ pointcut expression language</em> æ¥æè¿°) æ¥åŒ¹é…<code>joinpoint</code>, ç»™æ»¡è¶³è§„åˆ™çš„ <code>joinpoint</code> æ·»åŠ  <code>Advice</code>.</p></li><li><p><strong>å¼•å…¥ï¼ˆIntroductionï¼‰</strong></p><blockquote><p>Declaring additional methods or fields on behalf of a type. Spring AOP lets you introduce new interfaces (and a corresponding implementation) to any advised object. For example, you could use an introduction to make a bean implement an <code>IsModified</code> interface, to simplify caching. (An introduction is known as an inter-type declaration in the AspectJ community.)</p></blockquote><p>ä»£è¡¨ç±»å‹å£°æ˜å…¶ä»–æ–¹æ³•æˆ–å­—æ®µã€‚ Spring AOPå…è®¸æ‚¨å‘ä»»ä½•å»ºè®®çš„å¯¹è±¡å¼•å…¥æ–°çš„æ¥å£ï¼ˆå’Œç›¸åº”çš„å®ç°ï¼‰ã€‚ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨<em>å¼•å…¥</em>ä½¿<code>Bean</code>å®ç°<code>IsModified</code>æ¥å£ï¼Œä»¥ç®€åŒ–ç¼“å­˜ã€‚ ï¼ˆåœ¨AspectJç¤¾åŒºä¸­ï¼Œ<strong>å¼•å…¥</strong>è¢«ç§°ä¸ºç±»å‹é—´å£°æ˜ã€‚ï¼‰</p></li></ul><blockquote><p>ä¸ºä¸€ä¸ªç±»å‹æ·»åŠ é¢å¤–çš„æ–¹æ³•æˆ–å­—æ®µ. <code>Spring AOP</code> å…è®¸æˆ‘ä»¬ä¸º <code>ç›®æ ‡å¯¹è±¡</code> å¼•å…¥æ–°çš„æ¥å£(å’Œå¯¹åº”çš„å®ç°). ä¾‹å¦‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>introduction</code> æ¥ä¸ºä¸€ä¸ª <code>bean</code> å®ç° <code>IsModified</code> æ¥å£, å¹¶ä»¥æ­¤æ¥ç®€åŒ– <code>caching</code> çš„å®ç°.</p></blockquote><ul><li><p><strong>ç›®æ ‡å¯¹è±¡ï¼ˆTarget objectï¼‰</strong></p><blockquote><p>An object being advised by one or more aspects. Also referred to as the â€œadvised objectâ€. Since Spring AOP is implemented by using runtime proxies, this object is always a proxied object.</p></blockquote><p>ä¸€ä¸ªæˆ–å¤šä¸ªåˆ‡é¢é€šçŸ¥çš„å¯¹è±¡ã€‚ä¹Ÿç§°ä¸ºâ€œç›®æ ‡å¯¹è±¡â€ã€‚ç”±äº<code>Spring AOP</code>æ˜¯ä½¿ç”¨è¿è¡Œæ—¶<strong>ä»£ç†</strong>å®ç°çš„ï¼Œå› æ­¤<strong>è¯¥å¯¹è±¡å§‹ç»ˆæ˜¯ä»£ç†å¯¹è±¡</strong>ã€‚</p><p>å› ä¸º Spring AOP ä½¿ç”¨è¿è¡Œæ—¶ä»£ç†çš„æ–¹å¼æ¥å®ç° aspect, å› æ­¤ adviced object æ€»æ˜¯ä¸€ä¸ªä»£ç†å¯¹è±¡(proxied object)ã€‚</p><p><em>æ³¨æ„, adviced object æŒ‡çš„ä¸æ˜¯åŸæ¥çš„ç±», è€Œæ˜¯ç»‡å…¥ advice åæ‰€äº§ç”Ÿçš„ä»£ç†ç±»</em></p></li><li><p><strong>ä»£ç†ï¼ˆAOP proxyï¼‰</strong></p><blockquote><p> An object created by the AOP framework in order to implement the aspect contracts (advise method executions and so on). In the Spring Framework, an AOP proxy is a JDK dynamic proxy or a CGLIB proxy.</p></blockquote><p>ä¸€ä¸ªç±»è¢« AOP ç»‡å…¥ <code>advice</code>ï¼Œ å°±ä¼šäº§ç”Ÿä¸€ä¸ªç»“æœç±», å®ƒæ˜¯èåˆäº†åŸç±»å’Œå¢å¼ºé€»è¾‘çš„ä»£ç†ç±»ã€‚åœ¨ Spring AOP ä¸­, ä¸€ä¸ª AOP ä»£ç†æ˜¯ä¸€ä¸ª JDK åŠ¨æ€ä»£ç†å¯¹è±¡æˆ– CGLIB ä»£ç†å¯¹è±¡ã€‚</p></li><li><p><strong>ç»‡å…¥ï¼ˆWeavingï¼‰</strong></p><blockquote><p> linking aspects with other application types or objects to create an advised object. This can be done at compile time (using the AspectJ compiler, for example), load time, or at runtime. Spring AOP, like other pure Java AOP frameworks, performs weaving at runtime.</p></blockquote><p>å°†åˆ‡é¢ä¸å…¶ä»–åº”ç”¨ç¨‹åºç±»å‹æˆ–å¯¹è±¡é“¾æ¥ä»¥åˆ›å»ºå»ºè®®çš„å¯¹è±¡ï¼ˆå°† aspect å’Œå…¶ä»–å¯¹è±¡è¿æ¥èµ·æ¥, å¹¶åˆ›å»º adviced object çš„è¿‡ç¨‹ï¼‰ã€‚è¿™å¯ä»¥åœ¨ç¼–è¯‘æ—¶ï¼ˆä¾‹å¦‚ï¼Œä½¿ç”¨<code>AspectJ</code>ç¼–è¯‘å™¨ï¼‰ï¼ŒåŠ è½½æ—¶æˆ–åœ¨è¿è¡Œæ—¶å®Œæˆã€‚åƒå…¶ä»–çº¯Java AOPæ¡†æ¶ä¸€æ ·ï¼Œ<code>Spring AOP</code>åœ¨è¿è¡Œæ—¶æ‰§è¡Œç¼–ç»‡ã€‚æ ¹æ®ä¸åŒçš„å®ç°æŠ€æœ¯, AOPç»‡å…¥æœ‰ä¸‰ç§æ–¹å¼:</p><ul><li>ç¼–è¯‘å™¨ç»‡å…¥, è¿™è¦æ±‚æœ‰ç‰¹æ®Šçš„Javaç¼–è¯‘å™¨.</li><li>ç±»è£…è½½æœŸç»‡å…¥, è¿™éœ€è¦æœ‰ç‰¹æ®Šçš„ç±»è£…è½½å™¨.</li><li>åŠ¨æ€ä»£ç†ç»‡å…¥, åœ¨è¿è¡ŒæœŸä¸ºç›®æ ‡ç±»æ·»åŠ å¢å¼º(Advice)ç”Ÿæˆå­ç±»çš„æ–¹å¼.<br>Spring é‡‡ç”¨åŠ¨æ€ä»£ç†ç»‡å…¥, è€ŒAspectJé‡‡ç”¨ç¼–è¯‘å™¨ç»‡å…¥å’Œç±»è£…è½½æœŸç»‡å…¥.</li></ul></li></ul><h3 id="adviceçš„å‡ ç§ç±»å‹"><a href="#adviceçš„å‡ ç§ç±»å‹" class="headerlink" title="adviceçš„å‡ ç§ç±»å‹"></a>adviceçš„å‡ ç§ç±»å‹</h3><ul><li><p><strong>å‰ç½®é€šçŸ¥ï¼ˆBefore adviceï¼‰</strong></p><p>åœ¨è¿æ¥ç‚¹ä¹‹å‰è¿è¡Œä½†æ— æ³•é˜»æ­¢æ‰§è¡Œæµå‰è¿›åˆ°è¿æ¥ç‚¹çš„é€šçŸ¥ï¼ˆé™¤éå®ƒå¼•å‘å¼‚å¸¸ï¼‰ã€‚</p></li><li><p><strong>åç½®é€šçŸ¥ï¼ˆAfter returning adviceï¼‰</strong></p><p>è¿æ¥ç‚¹æ­£å¸¸å®Œæˆåè¦è¿è¡Œçš„é€šçŸ¥ï¼ˆä¾‹å¦‚ï¼Œå¦‚æœæ–¹æ³•è¿”å›è€Œæ²¡æœ‰å¼•å‘å¼‚å¸¸ï¼‰ã€‚</p></li><li><p><strong>æŠ›å‡ºå¼‚å¸¸åé€šçŸ¥ï¼ˆAfter throwing adviceï¼‰</strong></p><p>å¦‚æœå­˜åœ¨æ–¹æ³•åˆ™é€šè¿‡æŠ›å‡ºå¼‚å¸¸æ¥æ‰§è¡Œçš„é€šçŸ¥ã€‚</p></li><li><p><strong>åœ¨finallyæ‰§è¡Œåé€šçŸ¥ï¼ˆAfter (finally) adviceï¼‰</strong></p><p>æ— è®ºè¿æ¥ç‚¹é€€å‡ºçš„æ–¹å¼å¦‚ä½•ï¼ˆæ­£å¸¸æˆ–å¼‚å¸¸è¿”å›ï¼‰ï¼Œéƒ½å°†æ‰§è¡Œé€šçŸ¥ã€‚</p></li><li><p><strong>ç¯ç»•é€šçŸ¥ï¼ˆAround advice</strong>ï¼‰</p><p>å›´ç»•è”æ¥ç‚¹çš„é€šçŸ¥ï¼Œä¾‹å¦‚æ–¹æ³•è°ƒç”¨ã€‚è¿™æ˜¯æœ€æœ‰åŠ›çš„é€šçŸ¥ã€‚<strong>ç¯ç»•é€šçŸ¥å¯ä»¥åœ¨æ–¹æ³•è°ƒç”¨ä¹‹å‰å’Œä¹‹åæ‰§è¡Œè‡ªå®šä¹‰è¡Œä¸º</strong>ã€‚å®ƒè¿˜è´Ÿè´£é€‰æ‹©æ˜¯è¿”å›è¿æ¥ç‚¹è¿˜æ˜¯é€šè¿‡è¿”å›å…¶è‡ªèº«çš„è¿”å›å€¼æˆ–å¼•å‘å¼‚å¸¸æ¥è¿›è¡Œé€šçŸ¥çš„æ–¹æ³•æ‰§è¡Œã€‚</p></li></ul><h2 id="AOPä»£ç†"><a href="#AOPä»£ç†" class="headerlink" title="AOPä»£ç†"></a>AOPä»£ç†</h2><p><code>Spring AOP</code>é»˜è®¤å°†æ ‡å‡†<code>JDK</code>åŠ¨æ€ä»£ç†ç”¨äº<code>AOP</code>ä»£ç†ã€‚è¿™ä½¿å¾—å¯ä»¥ä»£ç†ä»»ä½•æ¥å£ï¼ˆæˆ–ä¸€ç»„æ¥å£ï¼‰ã€‚</p><p><code>Spring AOP</code>ä¹Ÿå¯ä»¥ä½¿ç”¨<code>CGLIB</code>ä»£ç†ã€‚è¿™å¯¹äºä»£ç†ç±»è€Œä¸æ˜¯æ¥å£æ˜¯å¿…éœ€çš„ã€‚<strong>é»˜è®¤æƒ…å†µä¸‹ï¼Œå¦‚æœä¸šåŠ¡å¯¹è±¡æœªå®ç°æ¥å£ï¼Œåˆ™ä½¿ç”¨CGLIBã€‚</strong>ç”±äºå¯¹æ¥å£è€Œä¸æ˜¯å¯¹ç±»è¿›è¡Œç¼–ç¨‹æ˜¯ä¸€ç§å¥½ä¹ æƒ¯ï¼Œå› æ­¤ä¸šåŠ¡ç±»é€šå¸¸å®ç°ä¸€ä¸ªæˆ–å¤šä¸ªä¸šåŠ¡æ¥å£ã€‚åœ¨é‚£äº›éœ€è¦å»ºè®®åœ¨æ¥å£ä¸Šæœªå£°æ˜çš„æ–¹æ³•æˆ–éœ€è¦å°†ä»£ç†å¯¹è±¡ä½œä¸ºå…·ä½“ç±»å‹ä¼ é€’ç»™æ–¹æ³•çš„æƒ…å†µä¸‹ï¼ˆåœ¨æå°‘æ•°æƒ…å†µä¸‹ï¼‰ï¼Œå¯ä»¥å¼ºåˆ¶ä½¿ç”¨<code>CGLIB</code>ã€‚</p><h3 id="Spring-Beançš„ç”Ÿå‘½å‘¨æœŸ"><a href="#Spring-Beançš„ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="Spring Beançš„ç”Ÿå‘½å‘¨æœŸ"></a>Spring Beançš„ç”Ÿå‘½å‘¨æœŸ</h3><blockquote><p>æ’æ’­ä¸€ä¸‹Spring Beançš„ç”Ÿå‘½å‘¨æœŸ</p></blockquote><p>ä¸¤ä¸ªæ¦‚å¿µï¼š<code>Spring Bean</code> å’Œ <code>å¯¹è±¡</code>ï¼š</p><ol><li><strong>spring bean</strong>â€”â€”å—springå®¹å™¨ç®¡ç†çš„å¯¹è±¡ï¼Œå¯èƒ½ç»è¿‡äº†å®Œæ•´çš„spring beanç”Ÿå‘½å‘¨æœŸï¼ˆä¸ºä»€ä¹ˆæ˜¯å¯èƒ½ï¼Ÿéš¾é“è¿˜æœ‰beanæ˜¯æ²¡æœ‰ç»è¿‡beanç”Ÿå‘½å‘¨æœŸçš„ï¼Ÿç­”æ¡ˆæ˜¯æœ‰çš„ï¼Œå…·ä½“æˆ‘ä»¬åé¢æ–‡ç« åˆ†æï¼‰ï¼Œæœ€ç»ˆå­˜åœ¨springå®¹å™¨å½“ä¸­ï¼›ä¸€ä¸ªbeanä¸€å®šæ˜¯ä¸ªå¯¹è±¡</li><li><strong>å¯¹è±¡</strong>â€”â€”ä»»ä½•ç¬¦åˆjavaè¯­æ³•è§„åˆ™å®ä¾‹åŒ–å‡ºæ¥çš„å¯¹è±¡ï¼Œä½†æ˜¯ä¸€ä¸ªå¯¹è±¡å¹¶ä¸ä¸€å®šæ˜¯spring beanï¼›</li></ol><p>æ‰€è°“çš„beançš„ç”Ÿå‘½å‘¨æœŸå°±æ˜¯ç£ç›˜ä¸Šçš„ç±»é€šè¿‡Springæ‰«æï¼Œç„¶åå®ä¾‹åŒ–ï¼Œè·Ÿç€åˆå§‹åŒ–ï¼Œç»§è€Œæ”¾åˆ°å®¹å™¨å½“ä¸­çš„è¿‡ç¨‹ã€‚ä¸‹å›¾å±•ç¤ºSpring Beançš„ç”Ÿå‘½å‘¨æœŸå¤§æ¦‚æœ‰å“ªäº›æ­¥éª¤ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/cayzlh/git-img-repository@master/uPic/20191118210559319.png" alt="Spring Beançš„ç”Ÿå‘½å‘¨æœŸ"></p><p><strong>å…¶ä¸­AOPçš„ä»£ç†ä¹Ÿæ˜¯åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­å®Œæˆçš„ã€‚</strong></p><h2 id="AOPçš„ä½¿ç”¨"><a href="#AOPçš„ä½¿ç”¨" class="headerlink" title="AOPçš„ä½¿ç”¨"></a>AOPçš„ä½¿ç”¨</h2><h3 id="AspectJä¸-AspectJ"><a href="#AspectJä¸-AspectJ" class="headerlink" title="AspectJä¸@AspectJ"></a>AspectJä¸@AspectJ</h3><p><code>@AspectJ</code>æ˜¯ä¸€ç§å°†åˆ‡é¢å£°æ˜ä¸ºå¸¦æœ‰æ³¨è§£çš„å¸¸è§„<code>Java</code>ç±»çš„æ ·å¼ã€‚ <code>@AspectJ</code>æ ·å¼æ˜¯<code>AspectJ</code>é¡¹ç›®åœ¨<code>AspectJ 5</code>ç‰ˆæœ¬ä¸­å¼•å…¥çš„ã€‚ <code>Spring</code>ä½¿ç”¨<code>AspectJ</code>æä¾›çš„ç”¨äºåˆ‡å…¥ç‚¹è§£æå’ŒåŒ¹é…çš„åº“æ¥è§£é‡Šä¸<code>AspectJ 5</code>ç›¸åŒçš„æ³¨è§£ã€‚ä½†æ˜¯ï¼Œ<code>AOP</code>è¿è¡Œæ—¶ä»ç„¶æ˜¯çº¯<code>Spring AOP</code>ï¼Œå¹¶ä¸”ä¸ä¾èµ–äº<code>AspectJ</code>ç¼–è¯‘å™¨æˆ–ç¼–ç»‡å™¨ã€‚</p><blockquote><p>ä¸ºäº†æ–¹ä¾¿ä½¿ç”¨ï¼Œ<code>Spring</code>å€Ÿé‰´äº†<code>AspectJ</code>çš„è¯­æ³•ã€‚</p><p>ä½¿ç”¨<code>AspectJ</code>ç¼–è¯‘å™¨å’Œ<code>weaver</code>å¯ä»¥ä½¿ç”¨å®Œæ•´çš„<code>AspectJ</code>è¯­æ³•ã€‚</p></blockquote><blockquote><p>AspectJ æ˜¯æœ€æ—©ã€åŠŸèƒ½æ¯”è¾ƒå¼ºå¤§çš„ AOP å®ç°ä¹‹ä¸€ï¼Œå¯¹æ•´å¥— AOP æœºåˆ¶éƒ½æœ‰è¾ƒå¥½çš„å®ç°ï¼Œå¾ˆå¤šå…¶ä»–è¯­è¨€çš„ AOP å®ç°ï¼Œä¹Ÿå€Ÿé‰´æˆ–é‡‡çº³äº† AspectJ ä¸­å¾ˆå¤šè®¾è®¡ã€‚</p></blockquote><h3 id="å¯ç”¨-AspectJæ”¯æŒ"><a href="#å¯ç”¨-AspectJæ”¯æŒ" class="headerlink" title="å¯ç”¨@AspectJæ”¯æŒ"></a>å¯ç”¨@AspectJæ”¯æŒ</h3><ol><li><p>é€šè¿‡<code>Java</code>é…ç½®å¯ç”¨<code>@AspectJ</code>æ”¯æŒ</p><p>åœ¨é…ç½®ç±»åŠ ä¸Š<code>@EnableAspectJAutoProxy</code>æ³¨è§£ä»¥å¯ç”¨<code>@AspectJ</code>æ”¯æŒ</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableAspectJAutoProxy</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AppConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>é€šè¿‡<code>XML</code>é…ç½®å¯ç”¨<code>@Aspect</code>Jæ”¯æŒ</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">aop:aspectj-autoproxy</span>/&gt;</span></span><br></pre></td></tr></table></figure></li></ol><h3 id="å£°æ˜ä¸€ä¸ªåˆ‡é¢"><a href="#å£°æ˜ä¸€ä¸ªåˆ‡é¢" class="headerlink" title="å£°æ˜ä¸€ä¸ªåˆ‡é¢"></a>å£°æ˜ä¸€ä¸ªåˆ‡é¢</h3><p>å¯ç”¨<code>@AspectJ</code>æ”¯æŒåï¼Œ<code>Spring</code>ä¼šè‡ªåŠ¨æ£€æµ‹åœ¨åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡ä¸­ä½¿ç”¨<code>@AspectJ</code>åˆ‡é¢ï¼ˆå…·æœ‰<code>@Aspect</code>æ‰¹æ³¨ï¼‰çš„ç±»å®šä¹‰çš„beanï¼Œå¹¶ç”¨äºé…ç½®<code>Spring AOP</code>ã€‚</p><ol><li><p>ä½¿ç”¨xmlé…ç½®å£°æ˜åˆ‡é¢</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;myAspect&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.xyz.NotVeryUsefulAspect&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- configure properties of the aspect here --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>ä½¿ç”¨æ³¨è§£å£°æ˜åˆ‡é¢</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> org.xyz;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Aspect;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NotVeryUsefulAspect</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h3 id="å£°æ˜åˆ‡å…¥ç‚¹"><a href="#å£°æ˜åˆ‡å…¥ç‚¹" class="headerlink" title="å£°æ˜åˆ‡å…¥ç‚¹"></a>å£°æ˜åˆ‡å…¥ç‚¹</h3><p>åˆ‡å…¥ç‚¹ç¡®å®šäº†å…³æ³¨çš„çš„è¿æ¥ç‚¹ï¼Œä»è€Œä½¿æˆ‘ä»¬èƒ½å¤Ÿæ§åˆ¶æ‰§è¡Œé€šçŸ¥çš„æ—¶æœºã€‚ <code>Spring AOP</code>ä»…æ”¯æŒ<code>Spring Bean</code>çš„æ–¹æ³•æ‰§è¡Œè¿æ¥ç‚¹ï¼Œå¯ä»¥å°†åˆ‡å…¥ç‚¹è§†ä¸ºä¸<code>Spring Bean</code>ä¸Šçš„æ–¹æ³•æ‰§è¡ŒåŒ¹é…ã€‚</p><p>åˆ‡å…¥ç‚¹å£°æ˜ç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼šä¸€ä¸ªåŒ…å«åç§°å’Œä»»ä½•å‚æ•°çš„ç­¾åï¼Œä»¥åŠä¸€ä¸ªåˆ‡å…¥ç‚¹è¡¨è¾¾å¼ï¼Œè¯¥åˆ‡å…¥ç‚¹è¡¨è¾¾å¼ç²¾ç¡®åœ°ç¡®å®šæˆ‘ä»¬å…³æ³¨çš„æ–¹æ³•æ‰§è¡Œã€‚åœ¨<code>AOP</code>çš„<code>@AspectJ</code>æ‰¹æ³¨æ ·å¼ä¸­ï¼Œå¸¸è§„æ–¹æ³•å®šä¹‰æä¾›äº†åˆ‡å…¥ç‚¹ç­¾åã€‚ å¹¶é€šè¿‡ä½¿ç”¨<code>@Pointcut</code>æ³¨è§£å£°æ˜åˆ‡å…¥ç‚¹è¡¨è¾¾å¼ï¼ˆ<strong>ç”¨ä½œåˆ‡å…¥ç‚¹ç­¾åçš„æ–¹æ³•å¿…é¡»å…·æœ‰voidè¿”å›ç±»å‹</strong>ï¼‰ã€‚</p><p>ä¸€ä¸ªä¾‹å­ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Pointcut(&quot;execution(* transfer(..))&quot;)</span> <span class="comment">// åˆ‡å…¥ç‚¹è¡¨è¾¾å¼</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">anyOldTransfer</span><span class="params">()</span> </span>&#123;&#125; <span class="comment">// åˆ‡å…¥ç‚¹æ–¹æ³•ç­¾å</span></span><br></pre></td></tr></table></figure><h4 id="æ”¯æŒçš„åˆ‡å…¥ç‚¹æŒ‡ç¤ºç¬¦"><a href="#æ”¯æŒçš„åˆ‡å…¥ç‚¹æŒ‡ç¤ºç¬¦" class="headerlink" title="æ”¯æŒçš„åˆ‡å…¥ç‚¹æŒ‡ç¤ºç¬¦"></a>æ”¯æŒçš„åˆ‡å…¥ç‚¹æŒ‡ç¤ºç¬¦</h4><p><code>Spring AOP</code>æ”¯æŒä»¥ä¸‹åœ¨åˆ‡å…¥ç‚¹è¡¨è¾¾å¼ä¸­ä½¿ç”¨çš„<code>AspectJ</code>åˆ‡å…¥ç‚¹æŒ‡ç¤ºç¬¦ï¼ˆPCDï¼‰ï¼š</p><ul><li><p><code>execution</code>ï¼šåŒ¹é…æ–¹æ³•æ‰§è¡Œçš„è¿æ¥ç‚¹ï¼Œè¿™æ˜¯ä½ å°†ä¼šç”¨åˆ°çš„Springçš„æœ€ä¸»è¦çš„åˆ‡å…¥ç‚¹æŒ‡å®šè€…ã€‚</p><blockquote><p>æè¿°çš„æœ€å°ç²’åº¦ç²¾ç¡®åˆ°æ–¹æ³•ï¼ˆç”šè‡³æ–¹æ³•çš„å‚æ•°ï¼‰</p></blockquote></li><li><p><code>within</code>ï¼šé™å®šåŒ¹é…ç‰¹å®šç±»å‹çš„è¿æ¥ç‚¹ï¼ˆåœ¨ä½¿ç”¨SpringAOPçš„æ—¶å€™ï¼Œåœ¨åŒ¹é…çš„ç±»å‹ä¸­å®šä¹‰çš„æ–¹æ³•çš„æ‰§è¡Œï¼‰ã€‚</p><blockquote><p>æè¿°çš„æœ€å°ç²’åº¦ä»…ä»…åˆ°ä¸€ä¸ªç±»</p></blockquote></li><li><p><code>this</code>ï¼šé™å®šåŒ¹é…ç‰¹å®šçš„è¿æ¥ç‚¹ï¼ˆä½¿ç”¨Spring AOPçš„æ—¶å€™æ–¹æ³•çš„æ‰§è¡Œï¼‰ï¼Œå…¶ä¸­bean referenceï¼ˆSpring AOP ä»£ç†ï¼‰æ˜¯<strong>æŒ‡å®šç±»å‹çš„å®ä¾‹ã€‚</strong>ï¼ˆä»£ç†çš„å¯¹è±¡æœ¬èº«ï¼‰</p></li><li><p><code>target</code>ï¼šé™å®šåŒ¹é…ç‰¹å®šçš„è¿æ¥ç‚¹ï¼ˆä½¿ç”¨SpringAOPçš„æ—¶å€™æ–¹æ³•çš„æ‰§è¡Œï¼‰ï¼Œå…¶ä¸­ç›®æ ‡å¯¹è±¡ï¼ˆè¢«ä»£ç†çš„appolication objectï¼‰æ˜¯<strong>æŒ‡å®šç±»å‹çš„å®ä¾‹ã€‚</strong>ï¼ˆè¢«ä»£ç†çš„å¯¹è±¡ï¼‰</p></li><li><p><code>args</code>ï¼šé™å®šåŒ¹é…ç‰¹å®šçš„è¿æ¥ç‚¹ï¼ˆä½¿ç”¨Spring AOPçš„æ—¶å€™æ–¹æ³•çš„æ‰§è¡Œï¼‰ï¼Œå…¶ä¸­å‚æ•°æ˜¯æŒ‡å®šç±»å‹çš„å®ä¾‹ã€‚</p></li><li><p><code>@target</code>ï¼šé™å®šåŒ¹é…ç‰¹å®šçš„è¿æ¥ç‚¹ï¼ˆä½¿ç”¨SpringAOPçš„æ—¶å€™æ–¹æ³•çš„æ‰§è¡Œï¼‰ï¼Œå…¶ä¸­æ‰§è¡Œçš„å¯¹è±¡çš„ç±»å·²ç»æœ‰æŒ‡å®šç±»å‹çš„æ³¨è§£ã€‚</p></li><li><p>@argsï¼šé™å®šåŒ¹é…ç‰¹å®šçš„è¿æ¥ç‚¹ï¼ˆä½¿ç”¨SpringAOPçš„æ—¶å€™æ–¹æ³•çš„æ‰§è¡Œï¼‰ï¼Œå…¶ä¸­å®é™…ä¼ å…¥å‚æ•°çš„è¿è¡Œæ—¶ç±»å‹æœ‰æŒ‡å®šç±»å‹çš„æ³¨è§£ã€‚</p></li><li><p><code>@within</code>ï¼šé™å®šåŒ¹é…ç‰¹å®šçš„è¿æ¥ç‚¹ï¼Œå…¶ä¸­è¿æ¥ç‚¹æ‰€åœ¨ç±»å‹å·²æŒ‡å®šæ³¨è§£ï¼ˆåœ¨ä½¿ç”¨Spring AOPçš„æ—¶å€™ï¼Œæ‰€æ‰§è¡Œçš„æ–¹æ³•æ‰€åœ¨ç±»å‹å·²æŒ‡å®šæ³¨è§£ï¼‰ã€‚</p></li><li><p> <code>@annotation</code>ï¼šé™å®šåŒ¹é…ç‰¹å®šçš„è¿æ¥ç‚¹ï¼ˆä½¿ç”¨SpringAOPçš„æ—¶å€™æ–¹æ³•çš„æ‰§è¡Œï¼‰ï¼Œå…¶ä¸­è¿æ¥ç‚¹çš„ä¸»é¢˜æœ‰æŸç§ç»™å®šçš„æ³¨è§£åˆå¹¶åˆ‡å…¥ç‚¹è¡¨è¾¾å¼</p></li></ul><h4 id="ç»„åˆåˆ‡å…¥ç‚¹"><a href="#ç»„åˆåˆ‡å…¥ç‚¹" class="headerlink" title="ç»„åˆåˆ‡å…¥ç‚¹"></a>ç»„åˆåˆ‡å…¥ç‚¹</h4><p>æ‚¨å¯ä»¥ä½¿ç”¨<code>&amp;&amp;</code>ï¼Œ<code>||</code>ç»„åˆåˆ‡å…¥ç‚¹è¡¨è¾¾å¼å’Œ<code>ï¼</code>æ‚¨ä¹Ÿå¯ä»¥æŒ‰åç§°å¼•ç”¨åˆ‡å…¥ç‚¹è¡¨è¾¾å¼ã€‚ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºäº†ä¸‰ä¸ªåˆ‡å…¥ç‚¹è¡¨è¾¾å¼ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Pointcut(&quot;execution(public * *(..))&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">anyPublicOperation</span><span class="params">()</span> </span>&#123;&#125;  <span class="comment">// 1âƒ£ï¸ åŒ¹é…æ‰€æœ‰å…¬å…±æ–¹æ³•</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Pointcut(&quot;within(com.xyz.someapp.trading..*)&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">inTrading</span><span class="params">()</span> </span>&#123;&#125;  <span class="comment">// 2âƒ£ï¸ åŒ¹é…æŒ‡å®šåŒ…é‡Œé¢çš„æ‰€æœ‰æ–¹æ³•</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Pointcut(&quot;anyPublicOperation() &amp;&amp; inTrading()&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">tradingOperation</span><span class="params">()</span> </span>&#123;&#125;  <span class="comment">// 3âƒ£ï¸ åŒ¹é…æŒ‡å®šåŒ…é‡Œé¢çš„æ‰€æœ‰å…¬å…±æ–¹æ³•</span></span><br></pre></td></tr></table></figure><h4 id="å…±äº«é€šç”¨åˆ‡å…¥ç‚¹å®šä¹‰"><a href="#å…±äº«é€šç”¨åˆ‡å…¥ç‚¹å®šä¹‰" class="headerlink" title="å…±äº«é€šç”¨åˆ‡å…¥ç‚¹å®šä¹‰"></a>å…±äº«é€šç”¨åˆ‡å…¥ç‚¹å®šä¹‰</h4><p>åœ¨å¼€å‘åº”ç”¨ç¨‹åºæ—¶ï¼Œå¼€å‘äººå‘˜é€šå¸¸å¸Œæœ›ä»å¤šä¸ªæ–¹é¢å¼•ç”¨åº”ç”¨ç¨‹åºçš„æ¨¡å—å’Œç‰¹å®šçš„æ“ä½œé›†ã€‚æˆ‘ä»¬å»ºè®®ä¸ºæ­¤å®šä¹‰ä¸€ä¸ª <code>SystemArchitecture</code>åˆ‡é¢ï¼Œä»¥æ•è·å¸¸è§çš„åˆ‡å…¥ç‚¹è¡¨è¾¾å¼ã€‚è¿™æ ·çš„æ–¹é¢é€šå¸¸ç±»ä¼¼äºä»¥ä¸‹ç¤ºä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xyz.someapp;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Aspect;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Pointcut;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SystemArchitecture</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * A join point is in the web layer if the method is defined</span></span><br><span class="line"><span class="comment">     * in a type in the com.xyz.someapp.web package or any sub-package</span></span><br><span class="line"><span class="comment">     * under that.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Pointcut(&quot;within(com.xyz.someapp.web..*)&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">inWebLayer</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * A join point is in the service layer if the method is defined</span></span><br><span class="line"><span class="comment">     * in a type in the com.xyz.someapp.service package or any sub-package</span></span><br><span class="line"><span class="comment">     * under that.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Pointcut(&quot;within(com.xyz.someapp.service..*)&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">inServiceLayer</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * A join point is in the data access layer if the method is defined</span></span><br><span class="line"><span class="comment">     * in a type in the com.xyz.someapp.dao package or any sub-package</span></span><br><span class="line"><span class="comment">     * under that.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Pointcut(&quot;within(com.xyz.someapp.dao..*)&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">inDataAccessLayer</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * A business service is the execution of any method defined on a service</span></span><br><span class="line"><span class="comment">     * interface. This definition assumes that interfaces are placed in the</span></span><br><span class="line"><span class="comment">     * &quot;service&quot; package, and that implementation types are in sub-packages.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * If you group service interfaces by functional area (for example,</span></span><br><span class="line"><span class="comment">     * in packages com.xyz.someapp.abc.service and com.xyz.someapp.def.service) then</span></span><br><span class="line"><span class="comment">     * the pointcut expression &quot;execution(* com.xyz.someapp..service.*.*(..))&quot;</span></span><br><span class="line"><span class="comment">     * could be used instead.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * Alternatively, you can write the expression using the &#x27;bean&#x27;</span></span><br><span class="line"><span class="comment">     * PCD, like so &quot;bean(*Service)&quot;. (This assumes that you have</span></span><br><span class="line"><span class="comment">     * named your Spring service beans in a consistent fashion.)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Pointcut(&quot;execution(* com.xyz.someapp..service.*.*(..))&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">businessService</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * A data access operation is the execution of any method defined on a</span></span><br><span class="line"><span class="comment">     * dao interface. This definition assumes that interfaces are placed in the</span></span><br><span class="line"><span class="comment">     * &quot;dao&quot; package, and that implementation types are in sub-packages.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Pointcut(&quot;execution(* com.xyz.someapp.dao.*.*(..))&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">dataAccessOperation</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥åœ¨éœ€è¦åˆ‡å…¥ç‚¹è¡¨è¾¾å¼çš„ä»»ä½•åœ°æ–¹å¼•ç”¨åˆ‡é¢ä¸­å®šä¹‰çš„åˆ‡å…¥ç‚¹ã€‚ä¾‹å¦‚ï¼Œè¦ä½¿æœåŠ¡å±‚å…·æœ‰äº‹åŠ¡æ€§ï¼š</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line">    &lt;aop:advisor</span><br><span class="line">        pointcut=&quot;com.xyz.someapp.SystemArchitecture.businessService()&quot;</span><br><span class="line">        advice-ref=&quot;tx-advice&quot;/&gt;</span><br><span class="line"><span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">tx:advice</span> <span class="attr">id</span>=<span class="string">&quot;tx-advice&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tx:attributes</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">&quot;*&quot;</span> <span class="attr">propagation</span>=<span class="string">&quot;REQUIRED&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tx:attributes</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tx:advice</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="Examples"><a href="#Examples" class="headerlink" title="Examples"></a>Examples</h4><blockquote><p>è¯­æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">execution(modifiers-pattern? ret-type-pattern declaring-type-pattern?name-pattern(param-pattern) <span class="keyword">throws</span>-pattern?)</span><br></pre></td></tr></table></figure><ul><li>é—®å·è¡¨ç¤ºå½“å‰é¡¹æœ‰ä¹Ÿå¯ä»¥æ²¡æœ‰</li><li>å…¶ä¸­å„é¡¹è¯­ä¹‰å¦‚ä¸‹ï¼š<ul><li><strong>modifiers- pattern</strong>ï¼šæ–¹æ³•çš„å¯è§æ€§ï¼Œå¦‚ public, protected</li><li><strong>ret-type- pattern</strong>ï¼šæ–¹æ³•çš„è¿”å›å€¼ç±»å‹ï¼Œå¦‚ int, void ç­‰</li><li><strong>declaring-type- pattern</strong>ï¼šæ–¹æ³•æ‰€åœ¨ç±»çš„å…¨è·¯å¾„åï¼Œå¦‚ com, spring, Aspect</li><li><strong>name- pattern</strong>ï¼šæ–¹æ³•åï¼Œå¦‚ bui sinessservice () </li><li><strong>param- pattern</strong>ï¼šæ–¹æ³•çš„å‚æ•°ç±»å‹ï¼Œå¦‚ java. Lang String</li><li><strong>throws- pattern</strong>: æ–¹æ³•æŠ›å‡ºçš„å¼‚å¸¸ç±»å‹ï¼Œå¦‚ java.Lang. Exception</li></ul></li></ul></blockquote><p>ä¸€äº›å¸¸è§çš„è¡¨è¾¾å¼ï¼š</p><ul><li><p>åŒ¹é…ä»»æ„<code>public</code>æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">execution(<span class="keyword">public</span> * *(..))</span><br></pre></td></tr></table></figure></li><li><p>åŒ¹é…æ‰€æœ‰ä»¥<code>set</code>å¼€å¤´çš„æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">execution(* set*(..))</span><br></pre></td></tr></table></figure></li><li><p>åŒ¹é…<code>AccountService</code>æ¥å£å®šä¹‰çš„ä»»ä½•æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">execution(* com.xyz.service.AccountService.*(..))</span><br></pre></td></tr></table></figure></li><li><p>åŒ¹é…æŒ‡å®šåŒ…ä¸‹çš„æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">execution(* com.xyz.service.*.*(..))</span><br></pre></td></tr></table></figure></li><li><p>åŒ¹é…æŒ‡å®šåŒ…ä¸‹é¢çš„ä¸€ä¸ªæˆ–å¤šä¸ªå­åŒ…ä¸‹çš„ç±»æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">execution(* com.xyz.service..*.*(..))</span><br></pre></td></tr></table></figure></li><li><p>åŒ¹é…<code>service</code>åŒ…ä¸­çš„æ‰€æœ‰è¿æ¥ç‚¹</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">within(com.xyz.service.*)</span><br></pre></td></tr></table></figure></li><li><p>åŒ¹é…<code>service</code>ä¸€ä¸ªæˆ–å¤šä¸ªå­åŒ…ä¸­çš„æ‰€æœ‰è¿æ¥ç‚¹</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">within(com.xyz.service..*)</span><br></pre></td></tr></table></figure></li><li><p>ä»£ç†å®ç°<code>AccountService</code>æ¥å£çš„ä»»ä½•è¿æ¥ç‚¹</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">this</span>(com.xyz.service.AccountService)</span><br></pre></td></tr></table></figure></li><li><p>ç›®æ ‡å¯¹è±¡å®ç°AccountServiceæ¥å£çš„ä»»ä½•è¿æ¥ç‚¹</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">target(com.xyz.service.AccountService)</span><br></pre></td></tr></table></figure></li><li><p>ä»»ä½•é‡‡ç”¨å•ä¸ªå‚æ•°å¹¶ä¸”åœ¨è¿è¡Œæ—¶ä¼ é€’çš„å‚æ•°ä¸ºSerializableçš„è¿æ¥ç‚¹</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">args(java.io.Serializable)</span><br></pre></td></tr></table></figure></li><li><p>ç›®æ ‡å¯¹è±¡å…·æœ‰<code>@Transactional</code>æ³¨è§£çš„ä»»ä½•è¿æ¥ç‚¹</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@target(org.springframework.transaction.annotation.Transactional)</span></span><br></pre></td></tr></table></figure></li><li><p>ç›®æ ‡å¯¹è±¡çš„å£°æ˜ç±»å‹å…·æœ‰<code>@Transactional</code>æ³¨è§£çš„ä»»ä½•è¿æ¥ç‚¹</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@within(org.springframework.transaction.annotation.Transactional)</span></span><br></pre></td></tr></table></figure></li><li><p>ä»»ä½•æ‰§è¡Œæ–¹æ³•å¸¦æœ‰@Transactionalæ‰¹æ³¨çš„è¿æ¥ç‚¹</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@annotation(org.springframework.transaction.annotation.Transactional)</span></span><br></pre></td></tr></table></figure></li><li><p>ä»»ä½•é‡‡ç”¨å•ä¸ªå‚æ•°çš„è”æ¥ç‚¹ï¼Œå¹¶ä¸”ä¼ é€’çš„å‚æ•°çš„è¿è¡Œæ—¶ç±»å‹å…·æœ‰<code>Classified</code>æ³¨è§£</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@args(com.xyz.security.Classified)</span></span><br></pre></td></tr></table></figure></li><li><p>åä¸º<code>tradeService</code>çš„<code>Spring bean</code>ä¸Šçš„ä»»ä½•è¿æ¥ç‚¹</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">bean(tradeService)</span><br></pre></td></tr></table></figure></li><li><p><code>Spring Bean</code>ä¸Šå…·æœ‰ä¸é€šé…ç¬¦è¡¨è¾¾å¼<code>* Service</code>åŒ¹é…çš„åç§°çš„ä»»ä½•è¿æ¥ç‚¹</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">bean(*Service)</span><br></pre></td></tr></table></figure></li></ul><h3 id="å£°æ˜é€šçŸ¥"><a href="#å£°æ˜é€šçŸ¥" class="headerlink" title="å£°æ˜é€šçŸ¥"></a>å£°æ˜é€šçŸ¥</h3><p>é€šçŸ¥ç”¨æ¥å£°æ˜æ–¹æ³•åœ¨åˆ‡å…¥ç‚¹è¡¨è¾¾å¼åŒ¹é…çš„æ–¹æ³•æ‰§è¡Œä¹‹å‰ï¼Œä¹‹åæˆ–å‘¨å›´è¿è¡Œã€‚åˆ‡å…¥ç‚¹è¡¨è¾¾å¼å¯ä»¥æ˜¯å¯¹å‘½ååˆ‡å…¥ç‚¹çš„ç®€å•å¼•ç”¨ï¼Œä¹Ÿå¯ä»¥æ˜¯å°±åœ°å£°æ˜çš„åˆ‡å…¥ç‚¹è¡¨è¾¾å¼ã€‚</p><h4 id="Before-Advice"><a href="#Before-Advice" class="headerlink" title="Before Advice"></a>Before Advice</h4><p>ä½¿ç”¨<code>@Before</code>æ³¨è§£åœ¨åˆ‡é¢ä¸­å£°æ˜é€šçŸ¥ã€‚</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Aspect;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Before;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BeforeExample</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Before(&quot;com.xyz.myapp.SystemArchitecture.dataAccessOperation()&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doAccessCheck</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å£°æ˜é€šçŸ¥çš„åŒæ—¶å£°æ˜åˆ‡å…¥ç‚¹ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Aspect;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Before;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BeforeExample</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Before(&quot;execution(* com.xyz.myapp.dao.*.*(..))&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doAccessCheck</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="After-Returning-Advice"><a href="#After-Returning-Advice" class="headerlink" title="After Returning Advice"></a>After Returning Advice</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Aspect;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.AfterReturning;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AfterReturningExample</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@AfterReturning(&quot;com.xyz.myapp.SystemArchitecture.dataAccessOperation()&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doAccessCheck</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ‰æ—¶ï¼Œæ‚¨éœ€è¦åœ¨é€šçŸ¥æ­£æ–‡ä¸­è®¿é—®è¿”å›çš„å®é™…å€¼ã€‚æ‚¨å¯ä»¥ä½¿ç”¨<code>@AfterReturning</code>çš„å½¢å¼ç»‘å®šè¿”å›å€¼ä»¥è·å–è¯¥è®¿é—®æƒé™ï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Aspect;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.AfterReturning;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AfterReturningExample</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@AfterReturning(</span></span><br><span class="line"><span class="meta">        pointcut=&quot;com.xyz.myapp.SystemArchitecture.dataAccessOperation()&quot;,</span></span><br><span class="line"><span class="meta">        returning=&quot;retVal&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doAccessCheck</span><span class="params">(Object retVal)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="After-Throwing-Advice"><a href="#After-Throwing-Advice" class="headerlink" title="After Throwing Advice"></a>After Throwing Advice</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Aspect;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.AfterThrowing;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AfterThrowingExample</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@AfterThrowing(&quot;com.xyz.myapp.SystemArchitecture.dataAccessOperation()&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doRecoveryActions</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æŒ‡å®šå¼‚å¸¸ç±»å‹ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Aspect;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.AfterThrowing;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AfterThrowingExample</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@AfterThrowing(</span></span><br><span class="line"><span class="meta">        pointcut=&quot;com.xyz.myapp.SystemArchitecture.dataAccessOperation()&quot;,</span></span><br><span class="line"><span class="meta">        throwing=&quot;ex&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doRecoveryActions</span><span class="params">(DataAccessException ex)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="After-Finally-Advice"><a href="#After-Finally-Advice" class="headerlink" title="After (Finally) Advice"></a>After (Finally) Advice</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Aspect;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.After;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AfterFinallyExample</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@After(&quot;com.xyz.myapp.SystemArchitecture.dataAccessOperation()&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doReleaseLock</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Around-Advice"><a href="#Around-Advice" class="headerlink" title="Around Advice"></a>Around Advice</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Aspect;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Around;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.ProceedingJoinPoint;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AroundExample</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Around(&quot;com.xyz.myapp.SystemArchitecture.businessService()&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">doBasicProfiling</span><span class="params">(ProceedingJoinPoint pjp)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">        <span class="comment">// start stopwatch</span></span><br><span class="line">        Object retVal = pjp.proceed();</span><br><span class="line">        <span class="comment">// stop stopwatch</span></span><br><span class="line">        <span class="keyword">return</span> retVal;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å¼•å…¥"><a href="#å¼•å…¥" class="headerlink" title="å¼•å…¥"></a>å¼•å…¥</h3><p>å¼•å…¥ï¼ˆ<strong>Introductions</strong>ï¼‰ï¼ˆåœ¨AspectJä¸­ç§°ä¸ºç±»å‹é—´å£°æ˜ï¼‰ä½¿åˆ‡é¢å¯ä»¥å£°æ˜é€šçŸ¥å¯¹è±¡å®ç°ç»™å®šçš„æ¥å£ï¼Œå¹¶ä»£è¡¨é‚£äº›å¯¹è±¡æä¾›è¯¥æ¥å£çš„å®ç°ã€‚</p><p>æ‚¨å¯ä»¥ä½¿ç”¨<code>@DeclareParents</code>æ‰¹æ³¨è¿›è¡Œä»‹ç»ã€‚æ­¤æ‰¹æ³¨ç”¨äºå£°æ˜åŒ¹é…ç±»å‹å…·æœ‰æ–°çš„çˆ¶ä»£ï¼ˆå› æ­¤è€Œå¾—åï¼‰ã€‚ä¾‹å¦‚ï¼Œç»™å®šä¸€ä¸ªåä¸º<code>UsageTracked</code>çš„æ¥å£å’Œè¯¥æ¥å£åä¸º<code>DefaultUsageTracked</code>çš„å®ç°ï¼Œä»¥ä¸‹æ–¹é¢å£°æ˜æœåŠ¡æ¥å£çš„æ‰€æœ‰å®ç°è€…ä¹Ÿéƒ½å®ç°äº†<code>UsageTracked</code>æ¥å£ï¼ˆä¾‹å¦‚ï¼Œé€šè¿‡JMXå…¬å¼€ç»Ÿè®¡ä¿¡æ¯ï¼‰ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UsageTracking</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@DeclareParents(value=&quot;com.xzy.myapp.service.*+&quot;, defaultImpl=DefaultUsageTracked.class)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> UsageTracked mixin;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Before(&quot;com.xyz.myapp.SystemArchitecture.businessService() &amp;&amp; this(usageTracked)&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">recordUsage</span><span class="params">(UsageTracked usageTracked)</span> </span>&#123;</span><br><span class="line">        usageTracked.incrementUseCount();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Spring-AOPå®ä¾‹"><a href="#Spring-AOPå®ä¾‹" class="headerlink" title="Spring AOPå®ä¾‹"></a>Spring AOPå®ä¾‹</h2><p><strong>ä»£ç åœ°å€ï¼š</strong><a href="https://github.com/cayzlh/cayzlh-demos">https://github.com/cayzlh/cayzlh-demos</a></p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><ul><li><code>Spring</code>å€Ÿé‰´äº†<code>AspectJ</code>çš„è¯­æ³•</li><li><code>Spring</code>é€šè¿‡åŠ¨æ€ä»£ç†æ¥å®ç°<code>aop</code></li><li>å¯¹æ¥å£åˆ›å»ºä»£ç†ä¼˜äºå¯¹ç±»åˆ›å»ºä»£ç†ï¼Œå› ä¸ºä¼šäº§ç”Ÿæ›´åŠ æ¾è€¦åˆçš„ç³»ç»Ÿï¼Œæ‰€ä»¥springé»˜è®¤æ˜¯ä½¿ç”¨JDKä»£ç†ã€‚å¯¹ç±»ä»£ç†æ˜¯è®©é—ç•™ç³»ç»Ÿæˆ–æ— æ³•å®ç°æ¥å£çš„ç¬¬ä¸‰æ–¹ç±»åº“åŒæ ·å¯ä»¥å¾—åˆ°é€šçŸ¥ï¼Œè¿™ç§æ–¹å¼åº”è¯¥æ˜¯å¤‡ç”¨æ–¹æ¡ˆ</li><li>æ ‡è®°ä¸º<code>final</code>çš„æ–¹æ³•ä¸èƒ½å¤Ÿè¢«é€šçŸ¥ã€‚springæ˜¯ä¸ºç›®æ ‡ç±»äº§ç”Ÿå­ç±»ã€‚ä»»ä½•éœ€è¦è¢«é€šçŸ¥çš„æ–¹æ³•éƒ½è¢«å¤å†™ï¼Œå°†é€šçŸ¥ç»‡å…¥ã€‚<code>final</code>æ–¹æ³•æ˜¯ä¸å…è®¸é‡å†™çš„</li><li>springåªæ”¯æŒæ–¹æ³•è¿æ¥ç‚¹ï¼šä¸æä¾›å±æ€§æ¥å…¥ç‚¹ï¼Œspringçš„è§‚ç‚¹æ˜¯å±æ€§æ‹¦æˆªç ´åäº†å°è£…ã€‚é¢å‘å¯¹è±¡çš„æ¦‚å¿µæ˜¯å¯¹è±¡è‡ªå·±å¤„ç†å·¥ä½œï¼Œå…¶ä»–å¯¹è±¡åªèƒ½é€šè¿‡æ–¹æ³•è°ƒç”¨çš„å¾—åˆ°çš„ç»“æœ</li></ul><blockquote><p>springåœ¨è¿è¡ŒæœŸï¼Œç”ŸæˆåŠ¨æ€ä»£ç†å¯¹è±¡ï¼Œä¸éœ€è¦ç‰¹æ®Šçš„ç¼–è¯‘å™¨</p><p>Spring AOP ä¼˜å…ˆå¯¹æ¥å£è¿›è¡Œä»£ç† ï¼ˆä½¿ç”¨JdkåŠ¨æ€ä»£ç†ï¼‰å¦‚æœç›®æ ‡å¯¹è±¡æ²¡æœ‰å®ç°ä»»ä½•æ¥å£ï¼Œæ‰ä¼šå¯¹ç±»è¿›è¡Œä»£ç† ï¼ˆä½¿ç”¨cglibåŠ¨æ€ä»£ç†ï¼‰</p></blockquote><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul><li><a href="https://docs.spring.io/spring-framework/docs/current/spring-framework-reference/core.html#aop">Springå®˜ç½‘(aop)</a></li><li><a href="https://zhuanlan.zhihu.com/p/97223347">Spring AOPç®€ä»‹ä¸åº•å±‚å®ç°æœºåˆ¶â€”â€”åŠ¨æ€ä»£ç†</a></li><li><a href="https://blog.csdn.net/java_lyvee/article/details/101793774">springæºç ç³»åˆ—ï¼ˆä¸€ï¼‰â€”â€”springå¾ªç¯å¼•ç”¨</a></li><li><a href="https://segmentfault.com/a/1190000007469968">å½»åº•å¾æœ Spring AOP ä¹‹ ç†è®ºç¯‡</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹æŠ€æœ¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Spring </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SpringBootå¼‚æ­¥è¯·æ±‚å’Œå¼‚æ­¥è°ƒç”¨</title>
      <link href="post/1086706207/"/>
      <url>post/1086706207/</url>
      
        <content type="html"><![CDATA[<blockquote><p>æœ¬æ–‡è½¬è½½è‡ªï¼š<a href="https://cnblogs.com/baixianlong/p/10661591.html">https://cnblogs.com/baixianlong/p/10661591.html</a></p></blockquote><h2 id="å¼‚æ­¥è¯·æ±‚ä¸åŒæ­¥è¯·æ±‚"><a href="#å¼‚æ­¥è¯·æ±‚ä¸åŒæ­¥è¯·æ±‚" class="headerlink" title="å¼‚æ­¥è¯·æ±‚ä¸åŒæ­¥è¯·æ±‚"></a>å¼‚æ­¥è¯·æ±‚ä¸åŒæ­¥è¯·æ±‚</h2><h3 id="åŒæ­¥è¯·æ±‚"><a href="#åŒæ­¥è¯·æ±‚" class="headerlink" title="åŒæ­¥è¯·æ±‚"></a>åŒæ­¥è¯·æ±‚</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">%% æ—¶åºå›¾ä¾‹å­,-&gt; ç›´çº¿ï¼Œ--&gt;è™šçº¿ï¼Œ-&gt;&gt;å®çº¿ç®­å¤´</span><br><span class="line"></span><br><span class="line">sequenceDiagram</span><br><span class="line"></span><br><span class="line">participant æµè§ˆå™¨&#x2F;APP</span><br><span class="line"></span><br><span class="line">participant è¯·æ±‚å¤„ç†çº¿ç¨‹</span><br><span class="line"></span><br><span class="line">participant å¤„ç†çº¿ç¨‹</span><br><span class="line"></span><br><span class="line">æµè§ˆå™¨&#x2F;APP-&gt;&gt;è¯·æ±‚å¤„ç†çº¿ç¨‹: request</span><br><span class="line"></span><br><span class="line">loop ç­‰å¾…</span><br><span class="line">æµè§ˆå™¨&#x2F;APP--&gt;æµè§ˆå™¨&#x2F;APP: ç­‰å¾…Response</span><br><span class="line">end</span><br><span class="line"></span><br><span class="line">è¯·æ±‚å¤„ç†çº¿ç¨‹-&gt;&gt;å¤„ç†çº¿ç¨‹: call</span><br><span class="line"></span><br><span class="line">loop é˜»å¡</span><br><span class="line">è¯·æ±‚å¤„ç†çº¿ç¨‹-&gt;è¯·æ±‚å¤„ç†çº¿ç¨‹: è¯·æ±‚å¤„ç†çº¿ç¨‹é˜»å¡</span><br><span class="line">end</span><br><span class="line"></span><br><span class="line">loop å¤„ç†ä¸­</span><br><span class="line">å¤„ç†çº¿ç¨‹-&gt;å¤„ç†çº¿ç¨‹: å¤„ç†çº¿ç¨‹å¤„ç†ä¸­</span><br><span class="line">end</span><br><span class="line"></span><br><span class="line">å¤„ç†çº¿ç¨‹-&gt;&gt;è¯·æ±‚å¤„ç†çº¿ç¨‹: return</span><br><span class="line"></span><br><span class="line">è¯·æ±‚å¤„ç†çº¿ç¨‹ -&gt;&gt; æµè§ˆå™¨&#x2F;APP: Response</span><br></pre></td></tr></table></figure><h3 id="å¼‚æ­¥è¯·æ±‚"><a href="#å¼‚æ­¥è¯·æ±‚" class="headerlink" title="å¼‚æ­¥è¯·æ±‚"></a>å¼‚æ­¥è¯·æ±‚</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sequenceDiagram</span><br><span class="line"></span><br><span class="line">participant æµè§ˆå™¨&#x2F;APP</span><br><span class="line"></span><br><span class="line">participant è¯·æ±‚å¤„ç†çº¿ç¨‹</span><br><span class="line"></span><br><span class="line">participant å›è°ƒå¤„ç†çº¿ç¨‹</span><br><span class="line"></span><br><span class="line">participant å¤„ç†çº¿ç¨‹</span><br><span class="line"></span><br><span class="line">æµè§ˆå™¨&#x2F;APP-&gt;&gt;è¯·æ±‚å¤„ç†çº¿ç¨‹: request</span><br><span class="line"></span><br><span class="line">loop ç­‰å¾…</span><br><span class="line">æµè§ˆå™¨&#x2F;APP-&gt;æµè§ˆå™¨&#x2F;APP: ç­‰å¾…Response</span><br><span class="line">end</span><br><span class="line"></span><br><span class="line">è¯·æ±‚å¤„ç†çº¿ç¨‹-&gt;&gt;å¤„ç†çº¿ç¨‹: invoke</span><br><span class="line"></span><br><span class="line">loop ç»“æŸ</span><br><span class="line">è¯·æ±‚å¤„ç†çº¿ç¨‹--&gt;&gt;è¯·æ±‚å¤„ç†çº¿ç¨‹: å¤„ç†åˆ«çš„è¯·æ±‚å»äº†</span><br><span class="line">end</span><br><span class="line"></span><br><span class="line">loop å¤„ç†ä¸­</span><br><span class="line">å¤„ç†çº¿ç¨‹-&gt;å¤„ç†çº¿ç¨‹: å¤„ç†çº¿ç¨‹å¤„ç†ä¸­</span><br><span class="line">end</span><br><span class="line"></span><br><span class="line">å¤„ç†çº¿ç¨‹-&gt;&gt;å›è°ƒå¤„ç†çº¿ç¨‹: callback</span><br><span class="line"></span><br><span class="line">å›è°ƒå¤„ç†çº¿ç¨‹ -&gt;&gt; æµè§ˆå™¨&#x2F;APP: Response</span><br></pre></td></tr></table></figure><h3 id="ç‰¹ç‚¹"><a href="#ç‰¹ç‚¹" class="headerlink" title="ç‰¹ç‚¹"></a>ç‰¹ç‚¹</h3><p>å¯ä»¥å…ˆé‡Šæ”¾å®¹å™¨åˆ†é…ç»™è¯·æ±‚çš„çº¿ç¨‹ä¸ç›¸å…³èµ„æºï¼Œå‡è½»ç³»ç»Ÿè´Ÿæ‹…ï¼Œé‡Šæ”¾äº†å®¹å™¨æ‰€åˆ†é…çº¿ç¨‹çš„è¯·æ±‚ï¼Œå…¶å“åº”å°†è¢«å»¶åï¼Œå¯ä»¥åœ¨è€—æ—¶å¤„ç†å®Œæˆï¼ˆä¾‹å¦‚é•¿æ—¶é—´çš„è¿ç®—ï¼‰æ—¶å†å¯¹å®¢æˆ·ç«¯è¿›è¡Œå“åº”ã€‚</p><p><strong>ä¸€å¥è¯ï¼šå¢åŠ äº†æœåŠ¡å™¨å¯¹å®¢æˆ·ç«¯è¯·æ±‚çš„ååé‡</strong>ï¼ˆå®é™…ç”Ÿäº§ä¸Šæˆ‘ä»¬ç”¨çš„æ¯”è¾ƒå°‘ï¼Œå¦‚æœå¹¶å‘è¯·æ±‚é‡å¾ˆå¤§çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¼šé€šè¿‡nginxæŠŠè¯·æ±‚è´Ÿè½½åˆ°é›†ç¾¤æœåŠ¡çš„å„ä¸ªèŠ‚ç‚¹ä¸Šæ¥åˆ†æ‘Šè¯·æ±‚å‹åŠ›ï¼Œå½“ç„¶è¿˜å¯ä»¥é€šè¿‡æ¶ˆæ¯é˜Ÿåˆ—æ¥åšè¯·æ±‚çš„ç¼“å†²ï¼‰<strong>ã€‚</strong></p><h2 id="å¼‚æ­¥è¯·æ±‚çš„å®ç°"><a href="#å¼‚æ­¥è¯·æ±‚çš„å®ç°" class="headerlink" title="å¼‚æ­¥è¯·æ±‚çš„å®ç°"></a>å¼‚æ­¥è¯·æ±‚çš„å®ç°</h2><h3 id="æ–¹å¼ä¸€"><a href="#æ–¹å¼ä¸€" class="headerlink" title="æ–¹å¼ä¸€"></a>æ–¹å¼ä¸€</h3><p>Servletæ–¹å¼å®ç°å¼‚æ­¥è¯·æ±‚ ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(value = &quot;/email/servletReq&quot;, method = GET)</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">servletReq</span> <span class="params">(HttpServletRequest request, HttpServletResponse response)</span> </span>&#123;</span><br><span class="line">      AsyncContext asyncContext = request.startAsync();</span><br><span class="line">      <span class="comment">//è®¾ç½®ç›‘å¬å™¨:å¯è®¾ç½®å…¶å¼€å§‹ã€å®Œæˆã€å¼‚å¸¸ã€è¶…æ—¶ç­‰äº‹ä»¶çš„å›è°ƒå¤„ç†</span></span><br><span class="line">      asyncContext.addListener(<span class="keyword">new</span> AsyncListener() &#123;</span><br><span class="line">          <span class="meta">@Override</span></span><br><span class="line">          <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onTimeout</span><span class="params">(AsyncEvent event)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">              System.out.println(<span class="string">&quot;è¶…æ—¶äº†...&quot;</span>);</span><br><span class="line">              <span class="comment">//åšä¸€äº›è¶…æ—¶åçš„ç›¸å…³æ“ä½œ...</span></span><br><span class="line">          &#125;</span><br><span class="line">          <span class="meta">@Override</span></span><br><span class="line">          <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onStartAsync</span><span class="params">(AsyncEvent event)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">              System.out.println(<span class="string">&quot;çº¿ç¨‹å¼€å§‹&quot;</span>);</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="meta">@Override</span></span><br><span class="line">          <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onError</span><span class="params">(AsyncEvent event)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">              System.out.println(<span class="string">&quot;å‘ç”Ÿé”™è¯¯ï¼š&quot;</span>+event.getThrowable());</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="meta">@Override</span></span><br><span class="line">          <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onComplete</span><span class="params">(AsyncEvent event)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">              System.out.println(<span class="string">&quot;æ‰§è¡Œå®Œæˆ&quot;</span>);</span><br><span class="line">              <span class="comment">//è¿™é‡Œå¯ä»¥åšä¸€äº›æ¸…ç†èµ„æºçš„æ“ä½œ...</span></span><br><span class="line">          &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">      <span class="comment">//è®¾ç½®è¶…æ—¶æ—¶é—´</span></span><br><span class="line">      asyncContext.setTimeout(<span class="number">20000</span>);</span><br><span class="line">      asyncContext.start(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">          <span class="meta">@Override</span></span><br><span class="line">          <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">              <span class="keyword">try</span> &#123;</span><br><span class="line">                  Thread.sleep(<span class="number">10000</span>);</span><br><span class="line">                  System.out.println(<span class="string">&quot;å†…éƒ¨çº¿ç¨‹ï¼š&quot;</span> + Thread.currentThread().getName());</span><br><span class="line">                  asyncContext.getResponse().setCharacterEncoding(<span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line">                  asyncContext.getResponse().setContentType(<span class="string">&quot;text/html;charset=UTF-8&quot;</span>);</span><br><span class="line">                  asyncContext.getResponse().getWriter().println(<span class="string">&quot;è¿™æ˜¯å¼‚æ­¥çš„è¯·æ±‚è¿”å›&quot;</span>);</span><br><span class="line">              &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                  System.out.println(<span class="string">&quot;å¼‚å¸¸ï¼š&quot;</span>+e);</span><br><span class="line">              &#125;</span><br><span class="line">              <span class="comment">//å¼‚æ­¥è¯·æ±‚å®Œæˆé€šçŸ¥</span></span><br><span class="line">              <span class="comment">//æ­¤æ—¶æ•´ä¸ªè¯·æ±‚æ‰å®Œæˆ</span></span><br><span class="line">              asyncContext.complete();</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">      <span class="comment">//æ­¤æ—¶ä¹‹ç±» requestçš„çº¿ç¨‹è¿æ¥å·²ç»é‡Šæ”¾äº†</span></span><br><span class="line">      System.out.println(<span class="string">&quot;ä¸»çº¿ç¨‹ï¼š&quot;</span> + Thread.currentThread().getName());</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><h3 id="æ–¹å¼äºŒ"><a href="#æ–¹å¼äºŒ" class="headerlink" title="æ–¹å¼äºŒ"></a>æ–¹å¼äºŒ</h3><p>ä½¿ç”¨å¾ˆç®€å•ï¼Œç›´æ¥è¿”å›çš„å‚æ•°åŒ…è£¹ä¸€å±‚callableå³å¯ï¼Œå¯ä»¥ç»§æ‰¿WebMvcConfigurerAdapterç±»æ¥è®¾ç½®é»˜è®¤çº¿ç¨‹æ± å’Œè¶…æ—¶å¤„ç†ã€‚</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(value = &quot;/email/callableReq&quot;, method = GET)</span></span><br><span class="line">  <span class="meta">@ResponseBody</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> Callable&lt;String&gt; <span class="title">callableReq</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">      System.out.println(<span class="string">&quot;å¤–éƒ¨çº¿ç¨‹ï¼š&quot;</span> + Thread.currentThread().getName());</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> Callable&lt;String&gt;() &#123;</span><br><span class="line"></span><br><span class="line">          <span class="meta">@Override</span></span><br><span class="line">          <span class="function"><span class="keyword">public</span> String <span class="title">call</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">              Thread.sleep(<span class="number">10000</span>);</span><br><span class="line">              System.out.println(<span class="string">&quot;å†…éƒ¨çº¿ç¨‹ï¼š&quot;</span> + Thread.currentThread().getName());</span><br><span class="line">              <span class="keyword">return</span> <span class="string">&quot;callable!&quot;</span>;</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Configuration</span></span><br><span class="line">  <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RequestAsyncPoolConfig</span> <span class="keyword">extends</span> <span class="title">WebMvcConfigurerAdapter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Resource</span></span><br><span class="line">  <span class="keyword">private</span> ThreadPoolTaskExecutor myThreadPoolTaskExecutor;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">configureAsyncSupport</span><span class="params">(<span class="keyword">final</span> AsyncSupportConfigurer configurer)</span> </span>&#123;</span><br><span class="line">      <span class="comment">//å¤„ç† callableè¶…æ—¶</span></span><br><span class="line">      configurer.setDefaultTimeout(<span class="number">60</span>*<span class="number">1000</span>);</span><br><span class="line">      configurer.setTaskExecutor(myThreadPoolTaskExecutor);</span><br><span class="line">      configurer.registerCallableInterceptors(timeoutCallableProcessingInterceptor());</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Bean</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> TimeoutCallableProcessingInterceptor <span class="title">timeoutCallableProcessingInterceptor</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> TimeoutCallableProcessingInterceptor();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ–¹å¼ä¸‰"><a href="#æ–¹å¼ä¸‰" class="headerlink" title="æ–¹å¼ä¸‰"></a>æ–¹å¼ä¸‰</h3><p>å’Œæ–¹å¼äºŒå·®ä¸å¤šï¼Œåœ¨Callableå¤–åŒ…ä¸€å±‚ï¼Œç»™WebAsyncTaskè®¾ç½®ä¸€ä¸ªè¶…æ—¶å›è°ƒï¼Œå³å¯å®ç°è¶…æ—¶å¤„ç†ã€‚</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(value = &quot;/email/webAsyncReq&quot;, method = GET)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> WebAsyncTask&lt;String&gt; <span class="title">webAsyncReq</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;å¤–éƒ¨çº¿ç¨‹ï¼š&quot;</span> + Thread.currentThread().getName());</span><br><span class="line">        Callable&lt;String&gt; result = () -&gt; &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;å†…éƒ¨çº¿ç¨‹å¼€å§‹ï¼š&quot;</span> + Thread.currentThread().getName());</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                TimeUnit.SECONDS.sleep(<span class="number">4</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                <span class="comment">// <span class="doctag">TODO:</span> handle exception</span></span><br><span class="line">            &#125;</span><br><span class="line">            logger.info(<span class="string">&quot;å‰¯çº¿ç¨‹è¿”å›&quot;</span>);</span><br><span class="line">            System.out.println(<span class="string">&quot;å†…éƒ¨çº¿ç¨‹è¿”å›ï¼š&quot;</span> + Thread.currentThread().getName());</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">        &#125;;</span><br><span class="line">        WebAsyncTask&lt;String&gt; wat = <span class="keyword">new</span> WebAsyncTask&lt;String&gt;(<span class="number">3000L</span>, result);</span><br><span class="line">        wat.onTimeout(<span class="keyword">new</span> Callable&lt;String&gt;() &#123;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> String <span class="title">call</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                <span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;è¶…æ—¶&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">return</span> wat;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h3 id="æ–¹å¼å››"><a href="#æ–¹å¼å››" class="headerlink" title="æ–¹å¼å››"></a>æ–¹å¼å››</h3><p>DeferredResultå¯ä»¥å¤„ç†ä¸€äº›ç›¸å¯¹å¤æ‚ä¸€äº›çš„ä¸šåŠ¡é€»è¾‘ï¼Œæœ€ä¸»è¦è¿˜æ˜¯å¯ä»¥åœ¨å¦ä¸€ä¸ªçº¿ç¨‹é‡Œé¢è¿›è¡Œä¸šåŠ¡å¤„ç†åŠè¿”å›ï¼Œå³å¯åœ¨ä¸¤ä¸ªå®Œå…¨ä¸ç›¸å¹²çš„çº¿ç¨‹é—´çš„é€šä¿¡ã€‚</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(value = &quot;/email/deferredResultReq&quot;, method = GET)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> DeferredResult&lt;String&gt; <span class="title">deferredResultReq</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;å¤–éƒ¨çº¿ç¨‹ï¼š&quot;</span> + Thread.currentThread().getName());</span><br><span class="line">        <span class="comment">//è®¾ç½®è¶…æ—¶æ—¶é—´</span></span><br><span class="line">        DeferredResult&lt;String&gt; result = <span class="keyword">new</span> DeferredResult&lt;String&gt;(<span class="number">60</span>*<span class="number">1000L</span>);</span><br><span class="line">        <span class="comment">//å¤„ç†è¶…æ—¶äº‹ä»¶ é‡‡ç”¨å§”æ‰˜æœºåˆ¶</span></span><br><span class="line">        result.onTimeout(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;DeferredResultè¶…æ—¶&quot;</span>);</span><br><span class="line">                result.setResult(<span class="string">&quot;è¶…æ—¶äº†!&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        result.onCompletion(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                <span class="comment">//å®Œæˆå</span></span><br><span class="line">                System.out.println(<span class="string">&quot;è°ƒç”¨å®Œæˆ&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        myThreadPoolTaskExecutor.execute(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                <span class="comment">//å¤„ç†ä¸šåŠ¡é€»è¾‘</span></span><br><span class="line">                System.out.println(<span class="string">&quot;å†…éƒ¨çº¿ç¨‹ï¼š&quot;</span> + Thread.currentThread().getName());</span><br><span class="line">                <span class="comment">//è¿”å›ç»“æœ</span></span><br><span class="line">                result.setResult(<span class="string">&quot;DeferredResult!!&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">       <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h2 id="SpringBootä¸­å¼‚æ­¥è°ƒç”¨çš„ä½¿ç”¨"><a href="#SpringBootä¸­å¼‚æ­¥è°ƒç”¨çš„ä½¿ç”¨" class="headerlink" title="SpringBootä¸­å¼‚æ­¥è°ƒç”¨çš„ä½¿ç”¨"></a>SpringBootä¸­å¼‚æ­¥è°ƒç”¨çš„ä½¿ç”¨</h2><h3 id="ä»‹ç»"><a href="#ä»‹ç»" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h3><p>å¼‚æ­¥è¯·æ±‚çš„å¤„ç†ã€‚é™¤äº†å¼‚æ­¥è¯·æ±‚ï¼Œä¸€èˆ¬ä¸Šæˆ‘ä»¬ç”¨çš„æ¯”è¾ƒå¤šçš„åº”è¯¥æ˜¯å¼‚æ­¥è°ƒç”¨ã€‚é€šå¸¸åœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œä¼šé‡åˆ°ä¸€ä¸ªæ–¹æ³•æ˜¯å’Œå®é™…ä¸šåŠ¡æ— å…³çš„ï¼Œæ²¡æœ‰ç´§å¯†æ€§çš„ã€‚æ¯”å¦‚è®°å½•æ—¥å¿—ä¿¡æ¯ç­‰ä¸šåŠ¡ã€‚è¿™ä¸ªæ—¶å€™æ­£å¸¸å°±æ˜¯å¯ä¸€ä¸ªæ–°çº¿ç¨‹å»åšä¸€äº›ä¸šåŠ¡å¤„ç†ï¼Œè®©ä¸»çº¿ç¨‹å¼‚æ­¥çš„æ‰§è¡Œå…¶ä»–ä¸šåŠ¡ã€‚</p><h3 id="ä½¿ç”¨æ–¹å¼ï¼ˆåŸºäºspringä¸‹ï¼‰"><a href="#ä½¿ç”¨æ–¹å¼ï¼ˆåŸºäºspringä¸‹ï¼‰" class="headerlink" title="ä½¿ç”¨æ–¹å¼ï¼ˆåŸºäºspringä¸‹ï¼‰"></a>ä½¿ç”¨æ–¹å¼ï¼ˆåŸºäºspringä¸‹ï¼‰</h3><p>éœ€è¦åœ¨å¯åŠ¨ç±»åŠ å…¥<code>@EnableAsync</code>ä½¿å¼‚æ­¥è°ƒç”¨<code>@Async</code>æ³¨è§£ç”Ÿæ•ˆ</p><p>åœ¨éœ€è¦å¼‚æ­¥æ‰§è¡Œçš„æ–¹æ³•ä¸ŠåŠ å…¥æ­¤æ³¨è§£å³å¯<code>@Async(&quot;threadPool&quot;)</code>,threadPoolä¸ºè‡ªå®šä¹‰çº¿ç¨‹æ± ã€‚</p><p>ä»£ç ç•¥ã€‚</p><h3 id="æ³¨æ„äº‹é¡¹"><a href="#æ³¨æ„äº‹é¡¹" class="headerlink" title="æ³¨æ„äº‹é¡¹"></a>æ³¨æ„äº‹é¡¹</h3><p>åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œæœªè®¾ç½®TaskExecutoræ—¶ï¼Œé»˜è®¤æ˜¯ä½¿ç”¨SimpleAsyncTaskExecutorè¿™ä¸ªçº¿ç¨‹æ± ï¼Œä½†æ­¤çº¿ç¨‹ä¸æ˜¯çœŸæ­£æ„ä¹‰ä¸Šçš„çº¿ç¨‹æ± ï¼Œå› ä¸ºçº¿ç¨‹ä¸é‡ç”¨ï¼Œæ¯æ¬¡è°ƒç”¨éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„çº¿ç¨‹ã€‚å¯é€šè¿‡æ§åˆ¶å°æ—¥å¿—è¾“å‡ºå¯ä»¥çœ‹å‡ºï¼Œæ¯æ¬¡è¾“å‡ºçº¿ç¨‹åéƒ½æ˜¯é€’å¢çš„ã€‚æ‰€ä»¥æœ€å¥½æˆ‘ä»¬æ¥è‡ªå®šä¹‰ä¸€ä¸ªçº¿ç¨‹æ± ã€‚</p><p>è°ƒç”¨çš„å¼‚æ­¥æ–¹æ³•ï¼Œä¸èƒ½ä¸ºåŒä¸€ä¸ªç±»çš„æ–¹æ³•ï¼ˆåŒ…æ‹¬åŒä¸€ä¸ªç±»çš„å†…éƒ¨ç±»ï¼‰ï¼Œç®€å•æ¥è¯´ï¼Œå› ä¸ºSpringåœ¨å¯åŠ¨æ‰«ææ—¶ä¼šä¸ºå…¶åˆ›å»ºä¸€ä¸ªä»£ç†ç±»ï¼Œè€ŒåŒç±»è°ƒç”¨æ—¶ï¼Œè¿˜æ˜¯è°ƒç”¨æœ¬èº«çš„ä»£ç†ç±»çš„ï¼Œæ‰€ä»¥å’Œå¹³å¸¸è°ƒç”¨æ˜¯ä¸€æ ·çš„ã€‚</p><p>å…¶ä»–çš„æ³¨è§£å¦‚@Cacheç­‰ä¹Ÿæ˜¯ä¸€æ ·çš„é“ç†ï¼Œè¯´ç™½äº†ï¼Œå°±æ˜¯Springçš„ä»£ç†æœºåˆ¶é€ æˆçš„ã€‚æ‰€ä»¥åœ¨å¼€å‘ä¸­ï¼Œæœ€å¥½æŠŠå¼‚æ­¥æœåŠ¡å•ç‹¬æŠ½å‡ºä¸€ä¸ªç±»æ¥ç®¡ç†ã€‚ä¸‹é¢ä¼šé‡ç‚¹è®²è¿°ã€‚ã€‚</p><h3 id="ä»€ä¹ˆæƒ…å†µä¸‹ä¼šå¯¼è‡´-Asyncå¼‚æ­¥æ–¹æ³•ä¼šå¤±æ•ˆï¼Ÿ"><a href="#ä»€ä¹ˆæƒ…å†µä¸‹ä¼šå¯¼è‡´-Asyncå¼‚æ­¥æ–¹æ³•ä¼šå¤±æ•ˆï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæƒ…å†µä¸‹ä¼šå¯¼è‡´@Asyncå¼‚æ­¥æ–¹æ³•ä¼šå¤±æ•ˆï¼Ÿ"></a>ä»€ä¹ˆæƒ…å†µä¸‹ä¼šå¯¼è‡´@Asyncå¼‚æ­¥æ–¹æ³•ä¼šå¤±æ•ˆï¼Ÿ</h3><ul><li><p><strong>è°ƒç”¨åŒä¸€ä¸ªç±»ä¸‹æ³¨æœ‰@Asyncå¼‚æ­¥æ–¹æ³•ï¼š</strong></p><p>åœ¨springä¸­åƒ@Asyncå’Œ@Transactionalã€cacheç­‰æ³¨è§£æœ¬è´¨ä½¿ç”¨çš„æ˜¯åŠ¨æ€ä»£ç†ï¼Œå…¶å®Springå®¹å™¨åœ¨åˆå§‹åŒ–çš„æ—¶å€™Springå®¹å™¨ä¼šå°†å«æœ‰AOPæ³¨è§£çš„ç±»å¯¹è±¡â€œæ›¿æ¢â€ä¸ºä»£ç†å¯¹è±¡ï¼ˆç®€å•è¿™ä¹ˆç†è§£ï¼‰ï¼Œé‚£ä¹ˆæ³¨è§£å¤±æ•ˆçš„åŸå› å°±å¾ˆæ˜æ˜¾äº†ï¼Œå°±æ˜¯å› ä¸ºè°ƒç”¨æ–¹æ³•çš„æ˜¯å¯¹è±¡æœ¬èº«è€Œä¸æ˜¯ä»£ç†å¯¹è±¡ï¼Œå› ä¸ºæ²¡æœ‰ç»è¿‡Springå®¹å™¨ï¼Œé‚£ä¹ˆè§£å†³æ–¹æ³•ä¹Ÿä¼šæ²¿ç€è¿™ä¸ªæ€è·¯æ¥è§£å†³ã€‚</p></li><li><p><strong>è°ƒç”¨çš„æ˜¯é™æ€(static )æ–¹æ³•</strong></p></li><li><p><strong>è°ƒç”¨(private)ç§æœ‰åŒ–æ–¹æ³•</strong></p></li></ul><h3 id="è§£å†³4ä¸­é—®é¢˜1çš„æ–¹å¼"><a href="#è§£å†³4ä¸­é—®é¢˜1çš„æ–¹å¼" class="headerlink" title="è§£å†³4ä¸­é—®é¢˜1çš„æ–¹å¼"></a>è§£å†³4ä¸­é—®é¢˜1çš„æ–¹å¼</h3><p><strong>å°†è¦å¼‚æ­¥æ‰§è¡Œçš„æ–¹æ³•å•ç‹¬æŠ½å–æˆä¸€ä¸ªç±»ï¼Œ</strong>åŸç†å°±æ˜¯å½“ä½ æŠŠæ‰§è¡Œå¼‚æ­¥çš„æ–¹æ³•å•ç‹¬æŠ½å–æˆä¸€ä¸ªç±»çš„æ—¶å€™ï¼Œè¿™ä¸ªç±»è‚¯å®šæ˜¯è¢«Springç®¡ç†çš„ï¼Œå…¶ä»–Springç»„ä»¶éœ€è¦è°ƒç”¨çš„æ—¶å€™è‚¯å®šä¼šæ³¨å…¥è¿›å»ï¼Œè¿™æ—¶å€™å®é™…ä¸Šæ³¨å…¥è¿›å»çš„å°±æ˜¯ä»£ç†ç±»äº†ã€‚</p><p>å…¶å®æˆ‘ä»¬çš„æ³¨å…¥å¯¹è±¡éƒ½æ˜¯ä»Springå®¹å™¨ä¸­ç»™å½“å‰Springç»„ä»¶è¿›è¡Œæˆå‘˜å˜é‡çš„èµ‹å€¼ï¼Œç”±äºæŸäº›ç±»ä½¿ç”¨äº†AOPæ³¨è§£ï¼Œé‚£ä¹ˆå®é™…ä¸Šåœ¨Springå®¹å™¨ä¸­å®é™…å­˜åœ¨çš„æ˜¯å®ƒçš„ä»£ç†å¯¹è±¡ã€‚é‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥<strong>é€šè¿‡ä¸Šä¸‹æ–‡è·å–è‡ªå·±çš„ä»£ç†å¯¹è±¡è°ƒç”¨å¼‚æ­¥æ–¹æ³•ã€‚</strong></p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/app&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EmailController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//è·å–ApplicationContextå¯¹è±¡æ–¹å¼æœ‰å¤šç§,è¿™ç§æœ€ç®€å•,å…¶å®ƒçš„å¤§å®¶è‡ªè¡Œäº†è§£ä¸€ä¸‹</span></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ApplicationContext applicationContext;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/email/asyncCall&quot;, method = GET)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Map&lt;String, Object&gt; <span class="title">asyncCall</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">        Map&lt;String, Object&gt; resMap = <span class="keyword">new</span> HashMap&lt;String, Object&gt;();</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            <span class="comment">//è¿™æ ·è°ƒç”¨åŒç±»ä¸‹çš„å¼‚æ­¥æ–¹æ³•æ˜¯ä¸èµ·ä½œç”¨çš„</span></span><br><span class="line">            <span class="comment">//this.testAsyncTask();</span></span><br><span class="line">            <span class="comment">//é€šè¿‡ä¸Šä¸‹æ–‡è·å–è‡ªå·±çš„ä»£ç†å¯¹è±¡è°ƒç”¨å¼‚æ­¥æ–¹æ³•</span></span><br><span class="line">            EmailController emailController = (EmailController)applicationContext.getBean(EmailController.class);</span><br><span class="line">            emailController.testAsyncTask();</span><br><span class="line">            resMap.put(<span class="string">&quot;code&quot;</span>,<span class="number">200</span>);</span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            resMap.put(<span class="string">&quot;code&quot;</span>,<span class="number">400</span>);</span><br><span class="line">            logger.error(<span class="string">&quot;error!&quot;</span>,e);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> resMap;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ³¨æ„ä¸€å®šæ˜¯public,ä¸”æ˜¯éstaticæ–¹æ³•</span></span><br><span class="line">    <span class="meta">@Async</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testAsyncTask</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        Thread.sleep(<span class="number">10000</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;å¼‚æ­¥ä»»åŠ¡æ‰§è¡Œå®Œæˆï¼&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¼€å¯cglibä»£ç†ï¼Œæ‰‹åŠ¨è·å–Springä»£ç†ç±»,ä»è€Œè°ƒç”¨åŒç±»ä¸‹çš„å¼‚æ­¥æ–¹æ³•ã€‚é¦–å…ˆï¼Œåœ¨å¯åŠ¨ç±»ä¸ŠåŠ ä¸Š<code>@EnableAspectJAutoProxy(exposeProxy = true)</code>æ³¨è§£ã€‚ä»£ç å®ç°ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@Transactional(value = &quot;transactionManager&quot;, readOnly = false, propagation = Propagation.REQUIRED, rollbackFor = Throwable.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EmailService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ApplicationContext applicationContext;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Async</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testSyncTask</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        Thread.sleep(<span class="number">10000</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;å¼‚æ­¥ä»»åŠ¡æ‰§è¡Œå®Œæˆï¼&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">asyncCallTwo</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        <span class="comment">//this.testSyncTask();</span></span><br><span class="line"><span class="comment">// EmailService emailService = (EmailService)applicationContext.getBean(EmailService.class);</span></span><br><span class="line"><span class="comment">// emailService.testSyncTask();</span></span><br><span class="line">        <span class="keyword">boolean</span> isAop = AopUtils.isAopProxy(EmailController.class);<span class="comment">//æ˜¯å¦æ˜¯ä»£ç†å¯¹è±¡ï¼›</span></span><br><span class="line">        <span class="keyword">boolean</span> isCglib = </span><br><span class="line">          AopUtils.isCglibProxy(EmailController.class); <span class="comment">//æ˜¯å¦æ˜¯CGLIBæ–¹å¼çš„ä»£ç†å¯¹è±¡ï¼›</span></span><br><span class="line">        <span class="keyword">boolean</span> isJdk = </span><br><span class="line">          AopUtils.isJdkDynamicProxy(EmailController.class); <span class="comment">//æ˜¯å¦æ˜¯JDKåŠ¨æ€ä»£ç†æ–¹å¼çš„ä»£ç†å¯¹è±¡ï¼›</span></span><br><span class="line">        <span class="comment">//ä»¥ä¸‹æ‰æ˜¯é‡ç‚¹!!!</span></span><br><span class="line">        EmailService emailService = (EmailService)applicationContext.getBean(EmailService.class);</span><br><span class="line">        EmailService proxy = (EmailService) AopContext.currentProxy();</span><br><span class="line">        System.out.println(emailService == proxy ? <span class="keyword">true</span> : <span class="keyword">false</span>);</span><br><span class="line">        proxy.testSyncTask();</span><br><span class="line">        System.out.println(<span class="string">&quot;end!!!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å¼‚æ­¥è¯·æ±‚ä¸å¼‚æ­¥è°ƒç”¨çš„åŒºåˆ«"><a href="#å¼‚æ­¥è¯·æ±‚ä¸å¼‚æ­¥è°ƒç”¨çš„åŒºåˆ«" class="headerlink" title="å¼‚æ­¥è¯·æ±‚ä¸å¼‚æ­¥è°ƒç”¨çš„åŒºåˆ«"></a><strong>å¼‚æ­¥è¯·æ±‚ä¸å¼‚æ­¥è°ƒç”¨çš„åŒºåˆ«</strong></h2><p>ä¸¤è€…çš„ä½¿ç”¨åœºæ™¯ä¸åŒï¼Œå¼‚æ­¥è¯·æ±‚ç”¨æ¥è§£å†³å¹¶å‘è¯·æ±‚å¯¹æœåŠ¡å™¨é€ æˆçš„å‹åŠ›ï¼Œä»è€Œæé«˜å¯¹è¯·æ±‚çš„ååé‡ï¼›è€Œå¼‚æ­¥è°ƒç”¨æ˜¯ç”¨æ¥åšä¸€äº›éä¸»çº¿æµç¨‹ä¸”ä¸éœ€è¦å®æ—¶è®¡ç®—å’Œå“åº”çš„ä»»åŠ¡ï¼Œæ¯”å¦‚åŒæ­¥æ—¥å¿—åˆ°kafkaä¸­åšæ—¥å¿—åˆ†æç­‰ã€‚</p><p>å¼‚æ­¥è¯·æ±‚æ˜¯ä¼šä¸€ç›´ç­‰å¾…responseç›¸åº”çš„ï¼Œéœ€è¦è¿”å›ç»“æœç»™å®¢æˆ·ç«¯çš„ï¼›è€Œå¼‚æ­¥è°ƒç”¨æˆ‘ä»¬å¾€å¾€ä¼šé©¬ä¸Šè¿”å›ç»™å®¢æˆ·ç«¯å“åº”ï¼Œå®Œæˆè¿™æ¬¡æ•´ä¸ªçš„è¯·æ±‚ï¼Œè‡³äºå¼‚æ­¥è°ƒç”¨çš„ä»»åŠ¡åå°è‡ªå·±æ…¢æ…¢è·‘å°±è¡Œï¼Œå®¢æˆ·ç«¯ä¸ä¼šå…³å¿ƒã€‚</p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul><li><a href="https://cnblogs.com/baixianlong/p/10661591.html">ä¼šç‚¼é’¢çš„å°ç™½é¾™-SpringBootä¸­å¼‚æ­¥è¯·æ±‚å’Œå¼‚æ­¥è°ƒç”¨ï¼ˆçœ‹è¿™ä¸€ç¯‡å°±å¤Ÿäº†ï¼‰</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹æŠ€æœ¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> Spring </tag>
            
            <tag> SpringBoot </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Mybatisä¸­ç”¨åˆ°çš„å‡ ç§è®¾è®¡æ¨¡å¼</title>
      <link href="post/26b455b4/"/>
      <url>post/26b455b4/</url>
      
        <content type="html"><![CDATA[<blockquote><p>æœ¬æ–‡è½¬è½½è‡ªï¼š<a href="http://www.crazyant.net/2022.html">http://www.crazyant.net/2022.html</a></p></blockquote><p>Mybatisè‡³å°‘é‡åˆ°äº†ä»¥ä¸‹çš„è®¾è®¡æ¨¡å¼çš„ä½¿ç”¨ï¼š</p><ol><li><strong>Builderæ¨¡å¼</strong>ï¼Œä¾‹å¦‚<code>SqlSessionFactoryBuilder</code>ã€<code>XMLConfigBuilder</code>ã€<code>XMLMapperBuilder</code>ã€<code>XMLStatementBuilder</code>ã€<code>CacheBuilder</code>ï¼›</li><li><strong>å·¥å‚æ¨¡å¼</strong>ï¼Œä¾‹å¦‚<code>SqlSessionFactory</code>ã€<code>ObjectFactory</code>ã€<code>MapperProxyFactory</code>ï¼›</li><li><strong>å•ä¾‹æ¨¡å¼</strong>ï¼Œä¾‹å¦‚ErrorContextå’Œ<code>LogFactory</code>ï¼›</li><li><strong>ä»£ç†æ¨¡å¼</strong>ï¼ŒMybatiså®ç°çš„æ ¸å¿ƒï¼Œæ¯”å¦‚<code>MapperProxy</code>ã€<code>ConnectionLogger</code>ï¼Œç”¨çš„jdkçš„åŠ¨æ€ä»£ç†ï¼›è¿˜æœ‰executor.loaderåŒ…ä½¿ç”¨äº†cglibæˆ–è€…javassistè¾¾åˆ°å»¶è¿ŸåŠ è½½çš„æ•ˆæœï¼›</li><li>ç»„åˆæ¨¡å¼ï¼Œä¾‹å¦‚<code>SqlNode</code>å’Œå„ä¸ªå­ç±»<code>ChooseSqlNode</code>ç­‰ï¼›</li><li><strong>æ¨¡æ¿æ–¹æ³•æ¨¡å¼</strong>ï¼Œä¾‹å¦‚<code>BaseExecutor</code>å’Œ<code>SimpleExecutor</code>ï¼Œè¿˜æœ‰<code>BaseTypeHandler</code>å’Œæ‰€æœ‰çš„å­ç±»ä¾‹å¦‚<code>IntegerTypeHandler</code>ï¼›</li><li><strong>é€‚é…å™¨æ¨¡å¼</strong>ï¼Œä¾‹å¦‚Logçš„Mybatisæ¥å£å’Œå®ƒå¯¹jdbcã€log4jç­‰å„ç§æ—¥å¿—æ¡†æ¶çš„é€‚é…å®ç°ï¼›</li><li><strong>è£…é¥°è€…æ¨¡å¼</strong>ï¼Œä¾‹å¦‚CacheåŒ…ä¸­çš„cache.decoratorså­åŒ…ä¸­ç­‰å„ä¸ªè£…é¥°è€…çš„å®ç°ï¼›</li><li><strong>è¿­ä»£å™¨æ¨¡å¼</strong>ï¼Œä¾‹å¦‚è¿­ä»£å™¨æ¨¡å¼<code>PropertyTokenizer</code>ï¼›</li></ol><p>æ¥ä¸‹æ¥æŒ¨ä¸ªæ¨¡å¼è¿›è¡Œè§£è¯»ï¼Œå…ˆä»‹ç»æ¨¡å¼è‡ªèº«çš„çŸ¥è¯†ï¼Œç„¶åè§£è¯»åœ¨Mybatisä¸­æ€æ ·åº”ç”¨äº†è¯¥æ¨¡å¼ã€‚</p><h2 id="Builderæ¨¡å¼"><a href="#Builderæ¨¡å¼" class="headerlink" title="Builderæ¨¡å¼"></a>Builderæ¨¡å¼</h2><p>Builderæ¨¡å¼çš„å®šä¹‰æ˜¯â€œå°†ä¸€ä¸ªå¤æ‚å¯¹è±¡çš„æ„å»ºä¸å®ƒçš„è¡¨ç¤ºåˆ†ç¦»ï¼Œä½¿å¾—åŒæ ·çš„æ„å»ºè¿‡ç¨‹å¯ä»¥åˆ›å»ºä¸åŒçš„è¡¨ç¤ºâ€ï¼Œå®ƒå±äºåˆ›å»ºç±»æ¨¡å¼ï¼Œä¸€èˆ¬æ¥è¯´ï¼Œå¦‚æœä¸€ä¸ªå¯¹è±¡çš„æ„å»ºæ¯”è¾ƒå¤æ‚ï¼Œè¶…å‡ºäº†æ„é€ å‡½æ•°æ‰€èƒ½åŒ…å«çš„èŒƒå›´ï¼Œå°±å¯ä»¥ä½¿ç”¨å·¥å‚æ¨¡å¼å’ŒBuilderæ¨¡å¼ï¼Œç›¸å¯¹äºå·¥å‚æ¨¡å¼ä¼šäº§å‡ºä¸€ä¸ªå®Œæ•´çš„äº§å“ï¼ŒBuilderåº”ç”¨äºæ›´åŠ å¤æ‚çš„å¯¹è±¡çš„æ„å»ºï¼Œç”šè‡³åªä¼šæ„å»ºäº§å“çš„ä¸€ä¸ªéƒ¨åˆ†ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/cayzlh/git-img-repository@master/uPic/c32qrf.jpg" alt="Builderæ¨¡å¼"></p><p>åœ¨Mybatisç¯å¢ƒçš„åˆå§‹åŒ–è¿‡ç¨‹ä¸­ï¼Œ<code>SqlSessionFactoryBuilder</code>ä¼šè°ƒç”¨<code>XMLConfigBuilder</code>è¯»å–æ‰€æœ‰çš„<code>MybatisMapConfig.xml</code>å’Œæ‰€æœ‰çš„*Mapper.xmlæ–‡ä»¶ï¼Œæ„å»ºMybatisè¿è¡Œçš„æ ¸å¿ƒå¯¹è±¡Configurationå¯¹è±¡ï¼Œç„¶åå°†è¯¥Configurationå¯¹è±¡ä½œä¸ºå‚æ•°æ„å»ºä¸€ä¸ªSqlSessionFactoryå¯¹è±¡ã€‚</p><p>å…¶ä¸­<code>XMLConfigBuilder</code>åœ¨æ„å»º<code>Configuration</code>å¯¹è±¡æ—¶ï¼Œä¹Ÿä¼šè°ƒç”¨<code>XMLMapperBuilder</code>ç”¨äºè¯»å–*Mapperæ–‡ä»¶ï¼Œè€Œ<code>XMLMapperBuilder</code>ä¼šä½¿ç”¨<code>XMLStatementBuilder</code>æ¥è¯»å–å’Œbuildæ‰€æœ‰çš„SQLè¯­å¥ã€‚</p><p>åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œæœ‰ä¸€ä¸ªç›¸ä¼¼çš„ç‰¹ç‚¹ï¼Œå°±æ˜¯è¿™äº›Builderä¼šè¯»å–æ–‡ä»¶æˆ–è€…é…ç½®ï¼Œç„¶ååšå¤§é‡çš„XpathParserè§£æã€é…ç½®æˆ–è¯­æ³•çš„è§£æã€åå°„ç”Ÿæˆå¯¹è±¡ã€å­˜å…¥ç»“æœç¼“å­˜ç­‰æ­¥éª¤ï¼Œè¿™ä¹ˆå¤šçš„å·¥ä½œéƒ½ä¸æ˜¯ä¸€ä¸ªæ„é€ å‡½æ•°æ‰€èƒ½åŒ…æ‹¬çš„ï¼Œå› æ­¤å¤§é‡é‡‡ç”¨äº†Builderæ¨¡å¼æ¥è§£å†³ã€‚</p><p>å¯¹äºbuilderçš„å…·ä½“ç±»ï¼Œæ–¹æ³•éƒ½å¤§éƒ½ç”¨build*å¼€å¤´ï¼Œæ¯”å¦‚<code>SqlSessionFactoryBuilder</code>ä¸ºä¾‹ï¼Œå®ƒåŒ…å«ä»¥ä¸‹æ–¹æ³•ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/cayzlh/git-img-repository@master/uPic/KAGdgM.jpg" alt="SqlSessionFactoryBuilder"></p><p>å³æ ¹æ®ä¸åŒçš„è¾“å…¥å‚æ•°æ¥æ„å»º<code>SqlSessionFactory</code>è¿™ä¸ªå·¥å‚å¯¹è±¡ã€‚</p><h2 id="å·¥å‚æ¨¡å¼"><a href="#å·¥å‚æ¨¡å¼" class="headerlink" title="å·¥å‚æ¨¡å¼"></a>å·¥å‚æ¨¡å¼</h2><p>åœ¨Mybatisä¸­æ¯”å¦‚<code>SqlSessionFactory</code>ä½¿ç”¨çš„æ˜¯å·¥å‚æ¨¡å¼ï¼Œè¯¥å·¥å‚æ²¡æœ‰é‚£ä¹ˆå¤æ‚çš„é€»è¾‘ï¼Œæ˜¯ä¸€ä¸ªç®€å•å·¥å‚æ¨¡å¼ã€‚</p><p>ç®€å•å·¥å‚æ¨¡å¼(Simple Factory Pattern)ï¼šåˆç§°ä¸ºé™æ€å·¥å‚æ–¹æ³•(Static Factory Method)æ¨¡å¼ï¼Œå®ƒå±äºç±»åˆ›å»ºå‹æ¨¡å¼ã€‚åœ¨ç®€å•å·¥å‚æ¨¡å¼ä¸­ï¼Œå¯ä»¥æ ¹æ®å‚æ•°çš„ä¸åŒè¿”å›ä¸åŒç±»çš„å®ä¾‹ã€‚ç®€å•å·¥å‚æ¨¡å¼ä¸“é—¨å®šä¹‰ä¸€ä¸ªç±»æ¥è´Ÿè´£åˆ›å»ºå…¶ä»–ç±»çš„å®ä¾‹ï¼Œè¢«åˆ›å»ºçš„å®ä¾‹é€šå¸¸éƒ½å…·æœ‰å…±åŒçš„çˆ¶ç±»ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/cayzlh/git-img-repository@master/uPic/Z3PDMk.jpg" alt="ç®€å•å·¥å‚æ¨¡å¼"></p><p>SqlSessionå¯ä»¥è®¤ä¸ºæ˜¯ä¸€ä¸ªMybatiså·¥ä½œçš„æ ¸å¿ƒçš„æ¥å£ï¼Œé€šè¿‡è¿™ä¸ªæ¥å£å¯ä»¥æ‰§è¡Œæ‰§è¡ŒSQLè¯­å¥ã€è·å–Mappersã€ç®¡ç†äº‹åŠ¡ã€‚ç±»ä¼¼äºè¿æ¥MySQLçš„Connectionå¯¹è±¡ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/cayzlh/git-img-repository@master/uPic/70L93B.jpg" alt="70L93B"></p><p>å¯ä»¥çœ‹åˆ°ï¼Œè¯¥Factoryçš„openSessionæ–¹æ³•é‡è½½äº†å¾ˆå¤šä¸ªï¼Œåˆ†åˆ«æ”¯æŒautoCommitã€Executorã€Transactionç­‰å‚æ•°çš„è¾“å…¥ï¼Œæ¥æ„å»ºæ ¸å¿ƒçš„SqlSessionå¯¹è±¡ã€‚</p><p>åœ¨DefaultSqlSessionFactoryçš„é»˜è®¤å·¥å‚å®ç°é‡Œï¼Œæœ‰ä¸€ä¸ªæ–¹æ³•å¯ä»¥çœ‹å‡ºå·¥å‚æ€ä¹ˆäº§å‡ºä¸€ä¸ªäº§å“ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> SqlSession <span class="title">openSessionFromDataSource</span><span class="params">(ExecutorType execType,</span></span></span><br><span class="line"><span class="function"><span class="params">                                             TransactionIsolationLevel level,</span></span></span><br><span class="line"><span class="function"><span class="params">                                             <span class="keyword">boolean</span> autoCommit)</span> </span>&#123;</span><br><span class="line">Transaction tx = <span class="keyword">null</span>;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line"><span class="keyword">final</span> Environment environment = configuration.getEnvironment();</span><br><span class="line"><span class="keyword">final</span> TransactionFactory transactionFactory = </span><br><span class="line">        getTransactionFactoryFromEnvironment(environment);</span><br><span class="line">tx = </span><br><span class="line">        transactionFactory.newTransaction(environment.getDataSource(), </span><br><span class="line">                                          level, autoCommit);</span><br><span class="line"><span class="keyword">final</span> Executor executor = configuration.newExecutor(tx, execType);</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> DefaultSqlSession(configuration, executor, autoCommit);</span><br><span class="line">&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">closeTransaction(tx); <span class="comment">// may have fetched a connection so lets call</span></span><br><span class="line"><span class="comment">// close()</span></span><br><span class="line"><span class="keyword">throw</span> ExceptionFactory.wrapException(<span class="string">&quot;Error opening session.  Cause: &quot;</span> + e, e);</span><br><span class="line">&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">ErrorContext.instance().reset();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ˜¯ä¸€ä¸ªopenSessionè°ƒç”¨çš„åº•å±‚æ–¹æ³•ï¼Œè¯¥æ–¹æ³•å…ˆä»configurationè¯»å–å¯¹åº”çš„ç¯å¢ƒé…ç½®ï¼Œç„¶ååˆå§‹åŒ–<code>TransactionFactory</code>è·å¾—ä¸€ä¸ª<code>Transaction</code>å¯¹è±¡ï¼Œç„¶åé€šè¿‡<code>Transaction</code>è·å–ä¸€ä¸ª<code>Executor</code>å¯¹è±¡ï¼Œæœ€åé€šè¿‡configurationã€Executorã€æ˜¯å¦autoCommitä¸‰ä¸ªå‚æ•°æ„å»ºäº†<code>SqlSession</code>ã€‚</p><p>åœ¨è¿™é‡Œå…¶å®ä¹Ÿå¯ä»¥çœ‹åˆ°ç«¯å€ªï¼Œ<code>SqlSession</code>çš„æ‰§è¡Œï¼Œå…¶å®æ˜¯å§”æ‰˜ç»™å¯¹åº”çš„<code>Executor</code>æ¥è¿›è¡Œçš„ã€‚</p><p>è€Œå¯¹äº<code>LogFactory</code>ï¼Œå®ƒçš„å®ç°ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">LogFactory</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Constructor&lt;? extends Log&gt; logConstructor;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">LogFactory</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// disable construction</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Log <span class="title">getLog</span><span class="params">(Class&lt;?&gt; aClass)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> getLog(aClass.getName());</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæœ‰ä¸ªç‰¹åˆ«çš„åœ°æ–¹ï¼Œæ˜¯Logå˜é‡çš„çš„ç±»å‹æ˜¯<code>Constructor</code>ï¼Œä¹Ÿå°±æ˜¯è¯´è¯¥å·¥å‚ç”Ÿäº§çš„ä¸åªæ˜¯ä¸€ä¸ªäº§å“ï¼Œè€Œæ˜¯å…·æœ‰Logå…¬å…±æ¥å£çš„ä¸€ç³»åˆ—äº§å“ï¼Œæ¯”å¦‚<code>Log4jImpl</code>ã€<code>Slf4jImpl</code>ç­‰å¾ˆå¤šå…·ä½“çš„Logã€‚</p><h2 id="å•ä¾‹æ¨¡å¼"><a href="#å•ä¾‹æ¨¡å¼" class="headerlink" title="å•ä¾‹æ¨¡å¼"></a>å•ä¾‹æ¨¡å¼</h2><p>å•ä¾‹æ¨¡å¼(Singleton Pattern)ï¼šå•ä¾‹æ¨¡å¼ç¡®ä¿æŸä¸€ä¸ªç±»åªæœ‰ä¸€ä¸ªå®ä¾‹ï¼Œè€Œä¸”è‡ªè¡Œå®ä¾‹åŒ–å¹¶å‘æ•´ä¸ªç³»ç»Ÿæä¾›è¿™ä¸ªå®ä¾‹ï¼Œè¿™ä¸ªç±»ç§°ä¸ºå•ä¾‹ç±»ï¼Œå®ƒæä¾›å…¨å±€è®¿é—®çš„æ–¹æ³•ã€‚</p><p>å•ä¾‹æ¨¡å¼çš„è¦ç‚¹æœ‰ä¸‰ä¸ªï¼šä¸€æ˜¯æŸä¸ªç±»åªèƒ½æœ‰ä¸€ä¸ªå®ä¾‹ï¼›äºŒæ˜¯å®ƒå¿…é¡»è‡ªè¡Œåˆ›å»ºè¿™ä¸ªå®ä¾‹ï¼›ä¸‰æ˜¯å®ƒå¿…é¡»è‡ªè¡Œå‘æ•´ä¸ªç³»ç»Ÿæä¾›è¿™ä¸ªå®ä¾‹ã€‚å•ä¾‹æ¨¡å¼æ˜¯ä¸€ç§å¯¹è±¡åˆ›å»ºå‹æ¨¡å¼ã€‚å•ä¾‹æ¨¡å¼åˆåå•ä»¶æ¨¡å¼æˆ–å•æ€æ¨¡å¼ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/cayzlh/git-img-repository@master/uPic/tHOgLF.jpg" alt="tHOgLF"></p><p>åœ¨Mybatisä¸­æœ‰ä¸¤ä¸ªåœ°æ–¹ç”¨åˆ°å•ä¾‹æ¨¡å¼ï¼Œ<code>ErrorContext</code>å’Œ<code>LogFactory</code>ï¼Œå…¶ä¸­<code>ErrorContext</code>æ˜¯ç”¨åœ¨æ¯ä¸ªçº¿ç¨‹èŒƒå›´å†…çš„å•ä¾‹ï¼Œç”¨äºè®°å½•è¯¥çº¿ç¨‹çš„æ‰§è¡Œç¯å¢ƒé”™è¯¯ä¿¡æ¯ï¼Œè€Œ<code>LogFactory</code>åˆ™æ˜¯æä¾›ç»™æ•´ä¸ªMybatisä½¿ç”¨çš„æ—¥å¿—å·¥å‚ï¼Œç”¨äºè·å¾—é’ˆå¯¹é¡¹ç›®é…ç½®å¥½çš„æ—¥å¿—å¯¹è±¡ã€‚</p><p><code>ErrorContext</code>çš„å•ä¾‹å®ç°ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ErrorContext</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> ThreadLocal&lt;ErrorContext&gt; LOCAL = <span class="keyword">new</span> ThreadLocal&lt;ErrorContext&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">ErrorContext</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ErrorContext <span class="title">instance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        ErrorContext context = LOCAL.get();</span><br><span class="line">        <span class="keyword">if</span> (context == <span class="keyword">null</span>) &#123;</span><br><span class="line">            context = <span class="keyword">new</span> ErrorContext();</span><br><span class="line">            LOCAL.set(context);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> context;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>æ„é€ å‡½æ•°æ˜¯privateä¿®é¥°ï¼Œå…·æœ‰ä¸€ä¸ªstaticçš„å±€éƒ¨instanceå˜é‡å’Œä¸€ä¸ªè·å–instanceå˜é‡çš„æ–¹æ³•ï¼Œåœ¨è·å–å®ä¾‹çš„æ–¹æ³•ä¸­ï¼Œå…ˆåˆ¤æ–­æ˜¯å¦ä¸ºç©ºå¦‚æœæ˜¯çš„è¯å°±å…ˆåˆ›å»ºï¼Œç„¶åè¿”å›æ„é€ å¥½çš„å¯¹è±¡ã€‚</p><p>åªæ˜¯è¿™é‡Œæœ‰ä¸ªæœ‰è¶£çš„åœ°æ–¹æ˜¯ï¼ŒLOCALçš„é™æ€å®ä¾‹å˜é‡ä½¿ç”¨äº†<code>ThreadLocal</code>ä¿®é¥°ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒå±äºæ¯ä¸ªçº¿ç¨‹å„è‡ªçš„æ•°æ®ï¼Œè€Œåœ¨<code>instance()</code>æ–¹æ³•ä¸­ï¼Œå…ˆè·å–æœ¬çº¿ç¨‹çš„è¯¥å®ä¾‹ï¼Œå¦‚æœæ²¡æœ‰å°±åˆ›å»ºè¯¥çº¿ç¨‹ç‹¬æœ‰çš„<code>ErrorContext</code>ã€‚</p><h2 id="ä»£ç†æ¨¡å¼"><a href="#ä»£ç†æ¨¡å¼" class="headerlink" title="ä»£ç†æ¨¡å¼"></a>ä»£ç†æ¨¡å¼</h2><p>ä»£ç†æ¨¡å¼å¯ä»¥è®¤ä¸ºæ˜¯Mybatisçš„æ ¸å¿ƒä½¿ç”¨çš„æ¨¡å¼ï¼Œæ­£æ˜¯ç”±äºè¿™ä¸ªæ¨¡å¼ï¼Œæˆ‘ä»¬åªéœ€è¦ç¼–å†™<code>Mapper.java</code>æ¥å£ï¼Œä¸éœ€è¦å®ç°ï¼Œç”±Mybatisåå°å¸®æˆ‘ä»¬å®Œæˆå…·ä½“SQLçš„æ‰§è¡Œã€‚</p><p>ä»£ç†æ¨¡å¼(Proxy Pattern) ï¼šç»™æŸä¸€ä¸ªå¯¹è±¡æä¾›ä¸€ä¸ªä»£ ç†ï¼Œå¹¶ç”±ä»£ç†å¯¹è±¡æ§åˆ¶å¯¹åŸå¯¹è±¡çš„å¼•ç”¨ã€‚ä»£ç†æ¨¡å¼çš„è‹± æ–‡å«åšProxyæˆ–Surrogateï¼Œå®ƒæ˜¯ä¸€ç§å¯¹è±¡ç»“æ„å‹æ¨¡å¼ã€‚</p><p>ä»£ç†æ¨¡å¼åŒ…å«å¦‚ä¸‹è§’è‰²ï¼š</p><ul><li>Subject: æŠ½è±¡ä¸»é¢˜è§’è‰²</li><li>Proxy: ä»£ç†ä¸»é¢˜è§’è‰²</li><li>RealSubject: çœŸå®ä¸»é¢˜è§’è‰²</li></ul><p><img src="https://cdn.jsdelivr.net/gh/cayzlh/git-img-repository@master/uPic/57qXzr.jpg" alt="57qXzr"></p><p>è¿™é‡Œæœ‰ä¸¤ä¸ªæ­¥éª¤ï¼Œç¬¬ä¸€ä¸ªæ˜¯æå‰åˆ›å»ºä¸€ä¸ªProxyï¼Œç¬¬äºŒä¸ªæ˜¯ä½¿ç”¨çš„æ—¶å€™ä¼šè‡ªåŠ¨è¯·æ±‚Proxyï¼Œç„¶åç”±Proxyæ¥æ‰§è¡Œå…·ä½“äº‹åŠ¡ï¼›</p><p>å½“æˆ‘ä»¬ä½¿ç”¨<code>Configuration</code>çš„<code>getMapper</code>æ–¹æ³•æ—¶ï¼Œä¼šè°ƒç”¨<code>mapperRegistry.getMapper</code>æ–¹æ³•ï¼Œè€Œè¯¥æ–¹æ³•åˆä¼šè°ƒç”¨<code>mapperProxyFactory.newInstance(sqlSession)</code>æ¥ç”Ÿæˆä¸€ä¸ªå…·ä½“çš„ä»£ç†ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">return</span> mapperInterface;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Map&lt;Method, MapperMethod&gt; <span class="title">getMethodCache</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> methodCache;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SuppressWarnings(&quot;unchecked&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> T <span class="title">newInstance</span><span class="params">(MapperProxy&lt;T&gt; mapperProxy)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (T) Proxy.newProxyInstance(mapperInterface.getClassLoader(), </span><br><span class="line">                                          <span class="keyword">new</span> Class[] &#123; mapperInterface &#125;,</span><br><span class="line">                mapperProxy);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> T <span class="title">newInstance</span><span class="params">(SqlSession sqlSession)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">final</span> MapperProxy&lt;T&gt; mapperProxy = <span class="keyword">new</span> MapperProxy&lt;T&gt;(sqlSession, </span><br><span class="line">                                                              mapperInterface, methodCache);</span><br><span class="line">        <span class="keyword">return</span> newInstance(mapperProxy);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨è¿™é‡Œï¼Œå…ˆé€šè¿‡<code>T newInstance(SqlSession sqlSession)</code>æ–¹æ³•ä¼šå¾—åˆ°ä¸€ä¸ª<code>MapperProxy</code>å¯¹è±¡ï¼Œç„¶åè°ƒç”¨<code>T newInstance(MapperProxy mapperProxy)</code>ç”Ÿæˆä»£ç†å¯¹è±¡ç„¶åè¿”å›ã€‚</p><p>è€ŒæŸ¥çœ‹<code>MapperProxy</code>çš„ä»£ç ï¼Œå¯ä»¥çœ‹åˆ°å¦‚ä¸‹å†…å®¹ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MapperProxy</span>&lt;<span class="title">T</span>&gt; <span class="keyword">implements</span> <span class="title">InvocationHandler</span>, <span class="title">Serializable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (Object.class.equals(method.getDeclaringClass())) &#123;</span><br><span class="line">                <span class="keyword">return</span> method.invoke(<span class="keyword">this</span>, args);</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (isDefaultMethod(method)) &#123;</span><br><span class="line">                <span class="keyword">return</span> invokeDefaultMethod(proxy, method, args);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable t) &#123;</span><br><span class="line">            <span class="keyword">throw</span> ExceptionUtil.unwrapThrowable(t);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">final</span> MapperMethod mapperMethod = cachedMapperMethod(method);</span><br><span class="line">        <span class="keyword">return</span> mapperMethod.execute(sqlSession, args);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>éå¸¸å…¸å‹çš„ï¼Œè¯¥<code>MapperProxy</code>ç±»å®ç°äº†<code>InvocationHandler</code>æ¥å£ï¼Œå¹¶ä¸”å®ç°äº†è¯¥æ¥å£çš„<code>invoke</code>æ–¹æ³•ã€‚</p><p>é€šè¿‡è¿™ç§æ–¹å¼ï¼Œæˆ‘ä»¬åªéœ€è¦ç¼–å†™<code>Mapper.java</code>æ¥å£ç±»ï¼Œå½“çœŸæ­£æ‰§è¡Œä¸€ä¸ª<code>Mapper</code>æ¥å£çš„æ—¶å€™ï¼Œå°±ä¼šè½¬å‘ç»™<code>MapperProxy.invoke</code>æ–¹æ³•ï¼Œè€Œè¯¥æ–¹æ³•åˆ™ä¼šè°ƒç”¨åç»­çš„<code>sqlSession.cud&gt;executor.execute&gt;prepareStatement</code>ç­‰ä¸€ç³»åˆ—æ–¹æ³•ï¼Œå®ŒæˆSQLçš„æ‰§è¡Œå’Œè¿”å›ã€‚</p><h2 id="ç»„åˆæ¨¡å¼"><a href="#ç»„åˆæ¨¡å¼" class="headerlink" title="ç»„åˆæ¨¡å¼"></a>ç»„åˆæ¨¡å¼</h2><p>ç»„åˆæ¨¡å¼ç»„åˆå¤šä¸ªå¯¹è±¡å½¢æˆæ ‘å½¢ç»“æ„ä»¥è¡¨ç¤ºâ€œæ•´ä½“-éƒ¨åˆ†â€çš„ç»“æ„å±‚æ¬¡ã€‚</p><p>ç»„åˆæ¨¡å¼å¯¹å•ä¸ªå¯¹è±¡(å¶å­å¯¹è±¡)å’Œç»„åˆå¯¹è±¡(ç»„åˆå¯¹è±¡)å…·æœ‰ä¸€è‡´æ€§ï¼Œå®ƒå°†å¯¹è±¡ç»„ç»‡åˆ°æ ‘ç»“æ„ä¸­ï¼Œå¯ä»¥ç”¨æ¥æè¿°æ•´ä½“ä¸éƒ¨åˆ†çš„å…³ç³»ã€‚åŒæ—¶å®ƒä¹Ÿæ¨¡ç³Šäº†ç®€å•å…ƒç´ (å¶å­å¯¹è±¡)å’Œå¤æ‚å…ƒç´ (å®¹å™¨å¯¹è±¡)çš„æ¦‚å¿µï¼Œä½¿å¾—å®¢æˆ·èƒ½å¤Ÿåƒå¤„ç†ç®€å•å…ƒç´ ä¸€æ ·æ¥å¤„ç†å¤æ‚å…ƒç´ ï¼Œä»è€Œä½¿å®¢æˆ·ç¨‹åºèƒ½å¤Ÿä¸å¤æ‚å…ƒç´ çš„å†…éƒ¨ç»“æ„è§£è€¦ã€‚</p><p>åœ¨ä½¿ç”¨ç»„åˆæ¨¡å¼ä¸­éœ€è¦æ³¨æ„ä¸€ç‚¹ä¹Ÿæ˜¯ç»„åˆæ¨¡å¼æœ€å…³é”®çš„åœ°æ–¹ï¼šå¶å­å¯¹è±¡å’Œç»„åˆå¯¹è±¡å®ç°ç›¸åŒçš„æ¥å£ã€‚è¿™å°±æ˜¯ç»„åˆæ¨¡å¼èƒ½å¤Ÿå°†å¶å­èŠ‚ç‚¹å’Œå¯¹è±¡èŠ‚ç‚¹è¿›è¡Œä¸€è‡´å¤„ç†çš„åŸå› ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/cayzlh/git-img-repository@master/uPic/kEL5d7.jpg" alt="kEL5d7"></p><p>Mybatisæ”¯æŒåŠ¨æ€SQLçš„å¼ºå¤§åŠŸèƒ½ï¼Œæ¯”å¦‚ä¸‹é¢çš„è¿™ä¸ªSQLï¼š</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;update&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;org.format.dynamicproxy.mybatis.bean.User&quot;</span>&gt;</span></span><br><span class="line">    UPDATE users</span><br><span class="line">    <span class="tag">&lt;<span class="name">trim</span> <span class="attr">prefix</span>=<span class="string">&quot;SET&quot;</span> <span class="attr">prefixOverrides</span>=<span class="string">&quot;,&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;name != null and name != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">            name = #&#123;name&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;age != null and age != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">            , age = #&#123;age&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;birthday != null and birthday != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">            , birthday = #&#123;birthday&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">trim</span>&gt;</span></span><br><span class="line">    where id = $&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br></pre></td></tr></table></figure><p>åœ¨è¿™é‡Œé¢ä½¿ç”¨åˆ°äº†trimã€ifç­‰åŠ¨æ€å…ƒç´ ï¼Œå¯ä»¥æ ¹æ®æ¡ä»¶æ¥ç”Ÿæˆä¸åŒæƒ…å†µä¸‹çš„SQLï¼›</p><p>åœ¨<code>DynamicSqlSource.getBoundSql</code>æ–¹æ³•é‡Œï¼Œè°ƒç”¨äº†<code>rootSqlNode.apply(context)</code>æ–¹æ³•ï¼Œ<code>apply</code>æ–¹æ³•æ˜¯æ‰€æœ‰çš„åŠ¨æ€èŠ‚ç‚¹éƒ½å®ç°çš„æ¥å£ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">SqlNode</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">apply</span><span class="params">(DynamicContext context)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯¹äºå®ç°è¯¥<code>SqlSource</code>æ¥å£çš„æ‰€æœ‰èŠ‚ç‚¹ï¼Œå°±æ˜¯æ•´ä¸ªç»„åˆæ¨¡å¼æ ‘çš„å„ä¸ªèŠ‚ç‚¹ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/cayzlh/git-img-repository@master/uPic/4eSz9o.jpg" alt="4eSz9o"></p><p>ç»„åˆæ¨¡å¼çš„ç®€å•ä¹‹å¤„åœ¨äºï¼Œæ‰€æœ‰çš„å­èŠ‚ç‚¹éƒ½æ˜¯åŒä¸€ç±»èŠ‚ç‚¹ï¼Œå¯ä»¥é€’å½’çš„å‘ä¸‹æ‰§è¡Œï¼Œæ¯”å¦‚å¯¹äºTextSqlNodeï¼Œå› ä¸ºå®ƒæ˜¯æœ€åº•å±‚çš„å¶å­èŠ‚ç‚¹ï¼Œæ‰€ä»¥ç›´æ¥å°†å¯¹åº”çš„å†…å®¹appendåˆ°SQLè¯­å¥ä¸­ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">apply</span><span class="params">(DynamicContext context)</span> </span>&#123;</span><br><span class="line">  GenericTokenParser parser = createParser(<span class="keyword">new</span> BindingTokenParser(context,</span><br><span class="line">                                                                  injectionFilter));</span><br><span class="line">  context.appendSql(parser.parse(text));</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯å¯¹äºIfSqlNodeï¼Œå°±éœ€è¦å…ˆåšåˆ¤æ–­ï¼Œå¦‚æœåˆ¤æ–­é€šè¿‡ï¼Œä»ç„¶ä¼šè°ƒç”¨å­å…ƒç´ çš„SqlNodeï¼Œå³<code>contents.apply</code>æ–¹æ³•ï¼Œå®ç°é€’å½’çš„è§£æã€‚</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">apply</span><span class="params">(DynamicContext context)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (evaluator.evaluateBoolean(test, context.getBindings())) &#123;</span><br><span class="line">        contents.apply(context);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ¨¡æ¿æ–¹æ³•æ¨¡å¼"><a href="#æ¨¡æ¿æ–¹æ³•æ¨¡å¼" class="headerlink" title="æ¨¡æ¿æ–¹æ³•æ¨¡å¼"></a>æ¨¡æ¿æ–¹æ³•æ¨¡å¼</h2><p>æ¨¡æ¿æ–¹æ³•æ¨¡å¼æ˜¯æ‰€æœ‰æ¨¡å¼ä¸­æœ€ä¸ºå¸¸è§çš„å‡ ä¸ªæ¨¡å¼ä¹‹ä¸€ï¼Œæ˜¯åŸºäºç»§æ‰¿çš„ä»£ç å¤ç”¨çš„åŸºæœ¬æŠ€æœ¯ã€‚</p><p>æ¨¡æ¿æ–¹æ³•æ¨¡å¼éœ€è¦å¼€å‘æŠ½è±¡ç±»å’Œå…·ä½“å­ç±»çš„è®¾è®¡å¸ˆä¹‹é—´çš„åä½œã€‚ä¸€ä¸ªè®¾è®¡å¸ˆè´Ÿè´£ç»™å‡ºä¸€ä¸ªç®—æ³•çš„è½®å»“å’Œéª¨æ¶ï¼Œå¦ä¸€äº›è®¾è®¡å¸ˆåˆ™è´Ÿè´£ç»™å‡ºè¿™ä¸ªç®—æ³•çš„å„ä¸ªé€»è¾‘æ­¥éª¤ã€‚ä»£è¡¨è¿™äº›å…·ä½“é€»è¾‘æ­¥éª¤çš„æ–¹æ³•ç§°åšåŸºæœ¬æ–¹æ³•(primitive method)ï¼›è€Œå°†è¿™äº›åŸºæœ¬æ–¹æ³•æ±‡æ€»èµ·æ¥çš„æ–¹æ³•å«åšæ¨¡æ¿æ–¹æ³•(template method)ï¼Œè¿™ä¸ªè®¾è®¡æ¨¡å¼çš„åå­—å°±æ˜¯ä»æ­¤è€Œæ¥ã€‚</p><p>æ¨¡æ¿ç±»å®šä¹‰ä¸€ä¸ªæ“ä½œä¸­çš„ç®—æ³•çš„éª¨æ¶ï¼Œè€Œå°†ä¸€äº›æ­¥éª¤å»¶è¿Ÿåˆ°å­ç±»ä¸­ã€‚ä½¿å¾—å­ç±»å¯ä»¥ä¸æ”¹å˜ä¸€ä¸ªç®—æ³•çš„ç»“æ„å³å¯é‡å®šä¹‰è¯¥ç®—æ³•çš„æŸäº›ç‰¹å®šæ­¥éª¤ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/cayzlh/git-img-repository@master/uPic/mPNlOa.jpg" alt="mPNlOa"></p><p>åœ¨Mybatisä¸­ï¼ŒsqlSessionçš„SQLæ‰§è¡Œï¼Œéƒ½æ˜¯å§”æ‰˜ç»™Executorå®ç°çš„ï¼ŒExecutoråŒ…å«ä»¥ä¸‹ç»“æ„ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/cayzlh/git-img-repository@master/uPic/dq9xXH.jpg" alt="dq9xXH"></p><p>å…¶ä¸­çš„BaseExecutorå°±é‡‡ç”¨äº†æ¨¡æ¿æ–¹æ³•æ¨¡å¼ï¼Œå®ƒå®ç°äº†å¤§éƒ¨åˆ†çš„SQLæ‰§è¡Œé€»è¾‘ï¼Œç„¶åæŠŠä»¥ä¸‹å‡ ä¸ªæ–¹æ³•äº¤ç»™å­ç±»å®šåˆ¶åŒ–å®Œæˆï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">apply</span><span class="params">(DynamicContext context)</span> </span>&#123;</span><br><span class="line">   <span class="keyword">if</span> (evaluator.evaluateBoolean(test, context.getBindings())) &#123;</span><br><span class="line">     contents.apply(context);</span><br><span class="line">     <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><p>è¯¥æ¨¡æ¿æ–¹æ³•ç±»æœ‰å‡ ä¸ªå­ç±»çš„å…·ä½“å®ç°ï¼Œä½¿ç”¨äº†ä¸åŒçš„ç­–ç•¥ï¼š</p><ul><li>ç®€å•<code>SimpleExecutor</code>ï¼šæ¯æ‰§è¡Œä¸€æ¬¡<code>update</code>æˆ–<code>select</code>ï¼Œå°±å¼€å¯ä¸€ä¸ª<code>Statement</code>å¯¹è±¡ï¼Œç”¨å®Œç«‹åˆ»å…³é—­<code>Statement</code>å¯¹è±¡ã€‚ï¼ˆå¯ä»¥æ˜¯<code>Statement</code>æˆ–<code>PrepareStatement</code>å¯¹è±¡ï¼‰</li><li>é‡ç”¨<code>ReuseExecutor</code>ï¼šæ‰§è¡Œ<code>update</code>æˆ–<code>select</code>ï¼Œä»¥sqlä½œä¸ºkeyæŸ¥æ‰¾<code>Statement</code>å¯¹è±¡ï¼Œå­˜åœ¨å°±ä½¿ç”¨ï¼Œä¸å­˜åœ¨å°±åˆ›å»ºï¼Œç”¨å®Œåï¼Œä¸å…³é—­<code>Statement</code>å¯¹è±¡ï¼Œè€Œæ˜¯æ”¾ç½®äº<code>Map</code>å†…ï¼Œä¾›ä¸‹ä¸€æ¬¡ä½¿ç”¨ã€‚ï¼ˆå¯ä»¥æ˜¯<code>Statement</code>æˆ–<code>PrepareStatement</code>å¯¹è±¡ï¼‰</li><li>æ‰¹é‡<code>BatchExecutor</code>ï¼šæ‰§è¡Œupdateï¼ˆæ²¡æœ‰selectï¼ŒJDBCæ‰¹å¤„ç†ä¸æ”¯æŒselectï¼‰ï¼Œå°†æ‰€æœ‰sqléƒ½æ·»åŠ åˆ°æ‰¹å¤„ç†ä¸­ï¼ˆ<code>addBatch()</code>ï¼‰ï¼Œç­‰å¾…ç»Ÿä¸€æ‰§è¡Œï¼ˆ<code>executeBatch()</code>ï¼‰ï¼Œå®ƒç¼“å­˜äº†å¤šä¸ªStatementå¯¹è±¡ï¼Œæ¯ä¸ªStatementå¯¹è±¡éƒ½æ˜¯<code>addBatch()</code>å®Œæ¯•åï¼Œç­‰å¾…é€ä¸€æ‰§è¡Œ<code>executeBatch()</code>æ‰¹å¤„ç†çš„ï¼›<code>BatchExecutor</code>ç›¸å½“äºç»´æŠ¤äº†å¤šä¸ªæ¡¶ï¼Œæ¯ä¸ªæ¡¶é‡Œéƒ½è£…äº†å¾ˆå¤šå±äºè‡ªå·±çš„SQLï¼Œå°±åƒè‹¹æœè“é‡Œè£…äº†å¾ˆå¤šè‹¹æœï¼Œç•ªèŒ„è“é‡Œè£…äº†å¾ˆå¤šç•ªèŒ„ï¼Œæœ€åï¼Œå†ç»Ÿä¸€å€’è¿›ä»“åº“ã€‚ï¼ˆå¯ä»¥æ˜¯Statementæˆ–PrepareStatementå¯¹è±¡ï¼‰</li></ul><p>æ¯”å¦‚åœ¨SimpleExecutorä¸­è¿™æ ·å®ç°updateæ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">doUpdate</span><span class="params">(MappedStatement ms, Object parameter)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">    Statement stmt = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        Configuration configuration = ms.getConfiguration();</span><br><span class="line">        StatementHandler handler = configuration.newStatementHandler(<span class="keyword">this</span>, ms, parameter, RowBounds.DEFAULT, <span class="keyword">null</span>,</span><br><span class="line">                <span class="keyword">null</span>);</span><br><span class="line">        stmt = prepareStatement(handler, ms.getStatementLog());</span><br><span class="line">        <span class="keyword">return</span> handler.update(stmt);</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        closeStatement(stmt);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="é€‚é…å™¨æ¨¡å¼"><a href="#é€‚é…å™¨æ¨¡å¼" class="headerlink" title="é€‚é…å™¨æ¨¡å¼"></a>é€‚é…å™¨æ¨¡å¼</h2><p>é€‚é…å™¨æ¨¡å¼(Adapter Pattern) ï¼šå°†ä¸€ä¸ªæ¥å£è½¬æ¢æˆå®¢æˆ·å¸Œæœ›çš„å¦ä¸€ä¸ªæ¥å£ï¼Œé€‚é…å™¨æ¨¡å¼ä½¿æ¥å£ä¸å…¼å®¹çš„é‚£äº›ç±»å¯ä»¥ä¸€èµ·å·¥ä½œï¼Œå…¶åˆ«åä¸ºåŒ…è£…å™¨(Wrapper)ã€‚é€‚é…å™¨æ¨¡å¼æ—¢å¯ä»¥ä½œä¸ºç±»ç»“æ„å‹æ¨¡å¼ï¼Œä¹Ÿå¯ä»¥ä½œä¸ºå¯¹è±¡ç»“æ„å‹æ¨¡å¼ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/cayzlh/git-img-repository@master/uPic/rkEM6Y.jpg" alt="rkEM6Y"></p><p>åœ¨Mybatsiçš„loggingåŒ…ä¸­ï¼Œæœ‰ä¸€ä¸ªLogæ¥å£ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Log</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">isDebugEnabled</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">isTraceEnabled</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">error</span><span class="params">(String s, Throwable e)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">error</span><span class="params">(String s)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">debug</span><span class="params">(String s)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">trace</span><span class="params">(String s)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">warn</span><span class="params">(String s)</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¯¥æ¥å£å®šä¹‰äº†Mybatisç›´æ¥ä½¿ç”¨çš„æ—¥å¿—æ–¹æ³•ï¼Œè€ŒLogæ¥å£å…·ä½“ç”±è°æ¥å®ç°å‘¢ï¼ŸMybatisæä¾›äº†å¤šç§æ—¥å¿—æ¡†æ¶çš„å®ç°ï¼Œè¿™äº›å®ç°éƒ½åŒ¹é…è¿™ä¸ªLogæ¥å£æ‰€å®šä¹‰çš„æ¥å£æ–¹æ³•ï¼Œæœ€ç»ˆå®ç°äº†æ‰€æœ‰å¤–éƒ¨æ—¥å¿—æ¡†æ¶åˆ°Mybatisæ—¥å¿—åŒ…çš„é€‚é…ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/cayzlh/git-img-repository@master/uPic/uVGQZ0.jpg" alt="uVGQZ0"></p><p>æ¯”å¦‚å¯¹äº<code>Log4jImpl</code>çš„å®ç°æ¥è¯´ï¼Œè¯¥å®ç°æŒæœ‰äº†<code>org.apache.log4j.Logger</code>çš„å®ä¾‹ï¼Œç„¶åæ‰€æœ‰çš„æ—¥å¿—æ–¹æ³•ï¼Œå‡å§”æ‰˜è¯¥å®ä¾‹æ¥å®ç°ã€‚</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Log4jImpl</span> <span class="keyword">implements</span> <span class="title">Log</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String FQCN = Log4jImpl.class.getName();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Logger log;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Log4jImpl</span><span class="params">(String clazz)</span> </span>&#123;</span><br><span class="line">        log = Logger.getLogger(clazz);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isDebugEnabled</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> log.isDebugEnabled();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isTraceEnabled</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> log.isTraceEnabled();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">error</span><span class="params">(String s, Throwable e)</span> </span>&#123;</span><br><span class="line">        log.log(FQCN, Level.ERROR, s, e);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">error</span><span class="params">(String s)</span> </span>&#123;</span><br><span class="line">        log.log(FQCN, Level.ERROR, s, <span class="keyword">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">debug</span><span class="params">(String s)</span> </span>&#123;</span><br><span class="line">        log.log(FQCN, Level.DEBUG, s, <span class="keyword">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">trace</span><span class="params">(String s)</span> </span>&#123;</span><br><span class="line">        log.log(FQCN, Level.TRACE, s, <span class="keyword">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">warn</span><span class="params">(String s)</span> </span>&#123;</span><br><span class="line">        log.log(FQCN, Level.WARN, s, <span class="keyword">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="è£…é¥°è€…æ¨¡å¼"><a href="#è£…é¥°è€…æ¨¡å¼" class="headerlink" title="è£…é¥°è€…æ¨¡å¼"></a>è£…é¥°è€…æ¨¡å¼</h2><p>è£…é¥°æ¨¡å¼(Decorator Pattern) ï¼šåŠ¨æ€åœ°ç»™ä¸€ä¸ªå¯¹è±¡å¢åŠ ä¸€äº›é¢å¤–çš„èŒè´£(Responsibility)ï¼Œå°±å¢åŠ å¯¹è±¡åŠŸèƒ½æ¥è¯´ï¼Œè£…é¥°æ¨¡å¼æ¯”ç”Ÿæˆå­ç±»å®ç°æ›´ä¸ºçµæ´»ã€‚å…¶åˆ«åä¹Ÿå¯ä»¥ç§°ä¸ºåŒ…è£…å™¨(Wrapper)ï¼Œä¸é€‚é…å™¨æ¨¡å¼çš„åˆ«åç›¸åŒï¼Œä½†å®ƒä»¬é€‚ç”¨äºä¸åŒçš„åœºåˆã€‚æ ¹æ®ç¿»è¯‘çš„ä¸åŒï¼Œè£…é¥°æ¨¡å¼ä¹Ÿæœ‰äººç§°ä¹‹ä¸ºâ€œæ²¹æ¼†å·¥æ¨¡å¼â€ï¼Œå®ƒæ˜¯ä¸€ç§å¯¹è±¡ç»“æ„å‹æ¨¡å¼ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/cayzlh/git-img-repository@master/uPic/BdaHcM.jpg" alt="BdaHcM"></p><p>åœ¨mybatisä¸­ï¼Œç¼“å­˜çš„åŠŸèƒ½ç”±æ ¹æ¥å£<code>Cacheï¼ˆorg.apache.ibatis.cache.Cacheï¼‰</code>å®šä¹‰ã€‚æ•´ä¸ªä½“ç³»é‡‡ç”¨è£…é¥°å™¨è®¾è®¡æ¨¡å¼ï¼Œæ•°æ®å­˜å‚¨å’Œç¼“å­˜çš„åŸºæœ¬åŠŸèƒ½ç”±<code>PerpetualCacheï¼ˆorg.apache.ibatis.cache.impl.PerpetualCacheï¼‰</code>æ°¸ä¹…ç¼“å­˜å®ç°ï¼Œç„¶åé€šè¿‡ä¸€ç³»åˆ—çš„è£…é¥°å™¨æ¥å¯¹<code>PerpetualCache</code>æ°¸ä¹…ç¼“å­˜è¿›è¡Œç¼“å­˜ç­–ç•¥ç­‰æ–¹ä¾¿çš„æ§åˆ¶ã€‚å¦‚ä¸‹å›¾ï¼š</p><p>ç”¨äºè£…é¥°PerpetualCacheçš„æ ‡å‡†è£…é¥°å™¨å…±æœ‰8ä¸ªï¼ˆå…¨éƒ¨åœ¨org.apache.ibatis.cache.decoratorsåŒ…ä¸­ï¼‰ï¼š</p><ol><li><code>FifoCache</code>ï¼šå…ˆè¿›å…ˆå‡ºç®—æ³•ï¼Œç¼“å­˜å›æ”¶ç­–ç•¥</li><li><code>LoggingCache</code>ï¼šè¾“å‡ºç¼“å­˜å‘½ä¸­çš„æ—¥å¿—ä¿¡æ¯</li><li><code>LruCache</code>ï¼šæœ€è¿‘æœ€å°‘ä½¿ç”¨ç®—æ³•ï¼Œç¼“å­˜å›æ”¶ç­–ç•¥</li><li><code>ScheduledCache</code>ï¼šè°ƒåº¦ç¼“å­˜ï¼Œè´Ÿè´£å®šæ—¶æ¸…ç©ºç¼“å­˜</li><li><code>SerializedCache</code>ï¼šç¼“å­˜åºåˆ—åŒ–å’Œååºåˆ—åŒ–å­˜å‚¨</li><li><code>SoftCache</code>ï¼šåŸºäºè½¯å¼•ç”¨å®ç°çš„ç¼“å­˜ç®¡ç†ç­–ç•¥</li><li><code>SynchronizedCache</code>ï¼šåŒæ­¥çš„ç¼“å­˜è£…é¥°å™¨ï¼Œç”¨äºé˜²æ­¢å¤šçº¿ç¨‹å¹¶å‘è®¿é—®</li><li><code>WeakCache</code>ï¼šåŸºäºå¼±å¼•ç”¨å®ç°çš„ç¼“å­˜ç®¡ç†ç­–ç•¥</li></ol><p>å¦å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªç‰¹æ®Šçš„è£…é¥°å™¨<code>TransactionalCache</code>ï¼šäº‹åŠ¡æ€§çš„ç¼“å­˜æ­£å¦‚å¤§å¤šæ•°æŒä¹…å±‚æ¡†æ¶ä¸€æ ·ï¼Œmybatisç¼“å­˜åŒæ ·åˆ†ä¸ºä¸€çº§ç¼“å­˜å’ŒäºŒçº§ç¼“å­˜</p><ul><li>ä¸€çº§ç¼“å­˜ï¼Œåˆå«æœ¬åœ°ç¼“å­˜ï¼Œæ˜¯<code>PerpetualCache</code>ç±»å‹çš„æ°¸ä¹…ç¼“å­˜ï¼Œä¿å­˜åœ¨æ‰§è¡Œå™¨ä¸­ï¼ˆ<code>BaseExecutor</code>ï¼‰ï¼Œè€Œæ‰§è¡Œå™¨åˆåœ¨<code>SqlSession</code>ï¼ˆ<code>DefaultSqlSession</code>ï¼‰ä¸­ï¼Œæ‰€ä»¥ä¸€çº§ç¼“å­˜çš„ç”Ÿå‘½å‘¨æœŸä¸<code>SqlSession</code>æ˜¯ç›¸åŒçš„ã€‚</li><li>äºŒçº§ç¼“å­˜ï¼Œåˆå«è‡ªå®šä¹‰ç¼“å­˜ï¼Œå®ç°äº†<code>Cache</code>æ¥å£çš„ç±»éƒ½å¯ä»¥ä½œä¸ºäºŒçº§ç¼“å­˜ï¼Œæ‰€ä»¥å¯é…ç½®å¦‚encacheç­‰çš„ç¬¬ä¸‰æ–¹ç¼“å­˜ã€‚äºŒçº§ç¼“å­˜ä»¥namespaceåç§°ç©ºé—´ä¸ºå…¶å”¯ä¸€æ ‡è¯†ï¼Œè¢«ä¿å­˜åœ¨<code>Configuration</code>æ ¸å¿ƒé…ç½®å¯¹è±¡ä¸­ã€‚</li></ul><p>äºŒçº§ç¼“å­˜å¯¹è±¡çš„é»˜è®¤ç±»å‹ä¸ºPerpetualCacheï¼Œå¦‚æœé…ç½®çš„ç¼“å­˜æ˜¯é»˜è®¤ç±»å‹ï¼Œåˆ™mybatisä¼šæ ¹æ®é…ç½®è‡ªåŠ¨è¿½åŠ ä¸€ç³»åˆ—è£…é¥°å™¨ã€‚</p><p>Cacheå¯¹è±¡ä¹‹é—´çš„å¼•ç”¨é¡ºåºä¸ºï¼š</p><p><code>SynchronizedCache</code>â€“&gt;<code>LoggingCache</code>â€“&gt;<code>SerializedCache</code>â€“&gt;<code>ScheduledCache</code>â€“&gt;<code>LruCache</code>â€“&gt;<code>PerpetualCache</code></p><h2 id="è¿­ä»£å™¨æ¨¡å¼"><a href="#è¿­ä»£å™¨æ¨¡å¼" class="headerlink" title="è¿­ä»£å™¨æ¨¡å¼"></a>è¿­ä»£å™¨æ¨¡å¼</h2><p>è¿­ä»£å™¨ï¼ˆIteratorï¼‰æ¨¡å¼ï¼Œåˆå«åšæ¸¸æ ‡ï¼ˆCursorï¼‰æ¨¡å¼ã€‚GOFç»™å‡ºçš„å®šä¹‰ä¸ºï¼šæä¾›ä¸€ç§æ–¹æ³•è®¿é—®ä¸€ä¸ªå®¹å™¨ï¼ˆcontainerï¼‰å¯¹è±¡ä¸­å„ä¸ªå…ƒç´ ï¼Œè€Œåˆä¸éœ€æš´éœ²è¯¥å¯¹è±¡çš„å†…éƒ¨ç»†èŠ‚ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/cayzlh/git-img-repository@master/uPic/49UcwT.jpg" alt="49UcwT"></p><p>Javaçš„<code>Iterator</code>å°±æ˜¯è¿­ä»£å™¨æ¨¡å¼çš„æ¥å£ï¼Œåªè¦å®ç°äº†è¯¥æ¥å£ï¼Œå°±ç›¸å½“äºåº”ç”¨äº†è¿­ä»£å™¨æ¨¡å¼ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/cayzlh/git-img-repository@master/uPic/dsNpxb.jpg" alt="dsNpxb"></p><p>æ¯”å¦‚Mybatisçš„<code>PropertyTokenizer</code>æ˜¯propertyåŒ…ä¸­çš„é‡é‡çº§ç±»ï¼Œè¯¥ç±»ä¼šè¢«reflectionåŒ…ä¸­å…¶ä»–çš„ç±»é¢‘ç¹çš„å¼•ç”¨åˆ°ã€‚è¿™ä¸ªç±»å®ç°äº†<code>Iterator</code>æ¥å£ï¼Œåœ¨ä½¿ç”¨æ—¶ç»å¸¸è¢«ç”¨åˆ°çš„æ˜¯<code>Iterator</code>æ¥å£ä¸­çš„<code>hasNext</code>è¿™ä¸ªå‡½æ•°ã€‚</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PropertyTokenizer</span> <span class="keyword">implements</span> <span class="title">Iterator</span>&lt;<span class="title">PropertyTokenizer</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String indexedName;</span><br><span class="line">    <span class="keyword">private</span> String index;</span><br><span class="line">    <span class="keyword">private</span> String children;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">PropertyTokenizer</span><span class="params">(String fullname)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> delim = fullname.indexOf(<span class="string">&#x27;.&#x27;</span>);</span><br><span class="line">        <span class="keyword">if</span> (delim &gt; -<span class="number">1</span>) &#123;</span><br><span class="line">            name = fullname.substring(<span class="number">0</span>, delim);</span><br><span class="line">            children = fullname.substring(delim + <span class="number">1</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            name = fullname;</span><br><span class="line">            children = <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        indexedName = name;</span><br><span class="line">        delim = name.indexOf(<span class="string">&#x27;[&#x27;</span>);</span><br><span class="line">        <span class="keyword">if</span> (delim &gt; -<span class="number">1</span>) &#123;</span><br><span class="line">            index = name.substring(delim + <span class="number">1</span>, name.length() - <span class="number">1</span>);</span><br><span class="line">            name = name.substring(<span class="number">0</span>, delim);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getIndex</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> index;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getIndexedName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> indexedName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getChildren</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> children;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hasNext</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> children != <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> PropertyTokenizer <span class="title">next</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> PropertyTokenizer(children);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">remove</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> UnsupportedOperationException(</span><br><span class="line">                <span class="string">&quot;Remove is not supported, as it has no meaning in the context of properties.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œè¿™ä¸ªç±»ä¼ å…¥ä¸€ä¸ªå­—ç¬¦ä¸²åˆ°æ„é€ å‡½æ•°ï¼Œç„¶åæä¾›äº†iteratoræ–¹æ³•å¯¹è§£æåçš„å­ä¸²è¿›è¡Œéå†ï¼Œæ˜¯ä¸€ä¸ªå¾ˆå¸¸ç”¨çš„æ–¹æ³•ç±»ã€‚</p><p><strong>å‚è€ƒèµ„æ–™</strong></p><ul><li><a href="http://design-patterns.readthedocs.io/zh_CN/latest/index.html">å›¾è¯´è®¾è®¡æ¨¡å¼</a></li><li><a href="http://www.cnblogs.com/dongying/p/4142476.html">æ·±å…¥æµ…å‡ºMybatisç³»åˆ—ï¼ˆåï¼‰â€”SQLæ‰§è¡Œæµç¨‹åˆ†æï¼ˆæºç ç¯‡ï¼‰</a></li><li><a href="http://www.cnblogs.com/chenssy/p/3299719.html">è®¾è®¡æ¨¡å¼è¯»ä¹¦ç¬”è®°â€”â€“ç»„åˆæ¨¡å¼</a></li><li><a href="http://blog.csdn.net/wagcy/article/details/32963235">Mybatis3.3.xæŠ€æœ¯å†…å¹•ï¼ˆå››ï¼‰ï¼šäº”é¼ é—¹ä¸œäº¬ä¹‹æ‰§è¡Œå™¨Executorè®¾è®¡åŸæœ¬</a></li><li><a href="https://my.oschina.net/lixin91/blog/620068">mybatisç¼“å­˜æœºåˆ¶è¯¦è§£ï¼ˆä¸€ï¼‰â€”â€”Cache</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹æŠ€æœ¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> è½¬è½½ </tag>
            
            <tag> MyBatis </tag>
            
            <tag> è®¾è®¡æ¨¡å¼ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Java8 çš„æ—¥æœŸå¤„ç†å®è·µ</title>
      <link href="post/3629577035/"/>
      <url>post/3629577035/</url>
      
        <content type="html"><![CDATA[<blockquote><p>å‡ºå¤„ï¼š<a href="https://juejin.im/post/5a795bad6fb9a0634f407ae5">JavaSEåŸºç¡€:æ‰©å±•Java 8 æ—¥æœŸæ“ä½œ</a></p></blockquote><h2 id="ç¤ºä¾‹1ï¼š-è·å–å½“å¤©æ—¥æœŸ"><a href="#ç¤ºä¾‹1ï¼š-è·å–å½“å¤©æ—¥æœŸ" class="headerlink" title="ç¤ºä¾‹1ï¼š è·å–å½“å¤©æ—¥æœŸ"></a>ç¤ºä¾‹1ï¼š è·å–å½“å¤©æ—¥æœŸ</h2><p>Java 8ä¸­è·å–ä»Šå¤©çš„æ—¥æœŸ Java 8ä¸­çš„ LocalDate ç”¨äºè¡¨ç¤ºå½“å¤©æ—¥æœŸã€‚å’Œjava.util.Dateä¸åŒï¼Œå®ƒåªæœ‰æ—¥æœŸï¼Œä¸åŒ…å«æ—¶é—´ã€‚å½“ä½ ä»…éœ€è¦è¡¨ç¤ºæ—¥æœŸæ—¶å°±ç”¨è¿™ä¸ªç±»ã€‚</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo01</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    LocalDate today = LocalDate.now();</span><br><span class="line">    System.out.println(<span class="string">&quot;ä»Šå¤©çš„æ—¥æœŸ:&quot;</span> + today);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;<span class="comment">/*è¿è¡Œç»“æœ:ä»Šå¤©çš„æ—¥æœŸ:2018-02-05*/</span></span><br></pre></td></tr></table></figure><h2 id="ç¤ºä¾‹2ï¼šè·å–å¹´ã€æœˆã€æ—¥"><a href="#ç¤ºä¾‹2ï¼šè·å–å¹´ã€æœˆã€æ—¥" class="headerlink" title="ç¤ºä¾‹2ï¼šè·å–å¹´ã€æœˆã€æ—¥"></a>ç¤ºä¾‹2ï¼šè·å–å¹´ã€æœˆã€æ—¥</h2><p>Java 8ä¸­è·å–å¹´ã€æœˆã€æ—¥ä¿¡æ¯</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo02</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    LocalDate today = LocalDate.now();</span><br><span class="line">    <span class="keyword">int</span> year = today.getYear();</span><br><span class="line">    <span class="keyword">int</span> month = today.getMonthValue();</span><br><span class="line">    <span class="keyword">int</span> day = today.getDayOfMonth();</span><br><span class="line">    System.out.println(<span class="string">&quot;year:&quot;</span> + year);</span><br><span class="line">    System.out.println(<span class="string">&quot;month:&quot;</span> + month);</span><br><span class="line">    System.out.println(<span class="string">&quot;day:&quot;</span> + day);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ç¤ºä¾‹3ï¼šåˆ›å»ºä»»æ„æ—¥æœŸ"><a href="#ç¤ºä¾‹3ï¼šåˆ›å»ºä»»æ„æ—¥æœŸ" class="headerlink" title="ç¤ºä¾‹3ï¼šåˆ›å»ºä»»æ„æ—¥æœŸ"></a>ç¤ºä¾‹3ï¼šåˆ›å»ºä»»æ„æ—¥æœŸ</h2><p>Java 8ä¸­å¤„ç†ç‰¹å®šæ—¥æœŸ æˆ‘ä»¬é€šè¿‡é™æ€å·¥å‚æ–¹æ³•now()éå¸¸å®¹æ˜“åœ°åˆ›å»ºäº†å½“å¤©æ—¥æœŸï¼Œä½ è¿˜å¯ä»¥è°ƒç”¨å¦ä¸€ä¸ªæœ‰ç”¨çš„å·¥å‚æ–¹æ³•LocalDate.of()åˆ›å»ºä»»æ„æ—¥æœŸï¼Œ è¯¥æ–¹æ³•éœ€è¦ä¼ å…¥å¹´ã€æœˆã€æ—¥åšå‚æ•°ï¼Œè¿”å›å¯¹åº”çš„LocalDateå®ä¾‹ã€‚è¿™ä¸ªæ–¹æ³•çš„å¥½å¤„æ˜¯æ²¡å†çŠ¯è€APIçš„è®¾è®¡é”™è¯¯ï¼Œæ¯”å¦‚å¹´åº¦èµ·å§‹äº1900ï¼Œæœˆä»½æ˜¯ä»0å¼€ å§‹ç­‰ç­‰ã€‚</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo03</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    LocalDate date = LocalDate.of(<span class="number">2018</span>, <span class="number">2</span>, <span class="number">6</span>);</span><br><span class="line">    System.out.println(<span class="string">&quot;è‡ªå®šä¹‰æ—¥æœŸ:&quot;</span> + date);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ç¤ºä¾‹4ï¼šåˆ¤æ–­æ—¥æœŸæ˜¯å¦ç›¸ç­‰"><a href="#ç¤ºä¾‹4ï¼šåˆ¤æ–­æ—¥æœŸæ˜¯å¦ç›¸ç­‰" class="headerlink" title="ç¤ºä¾‹4ï¼šåˆ¤æ–­æ—¥æœŸæ˜¯å¦ç›¸ç­‰"></a>ç¤ºä¾‹4ï¼šåˆ¤æ–­æ—¥æœŸæ˜¯å¦ç›¸ç­‰</h2><p>Java 8ä¸­åˆ¤æ–­ä¸¤ä¸ªæ—¥æœŸæ˜¯å¦ç›¸ç­‰</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo04</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    LocalDate date1 = LocalDate.now();</span><br><span class="line">    LocalDate date2 = LocalDate.of(<span class="number">2018</span>, <span class="number">2</span>, <span class="number">5</span>);</span><br><span class="line">    <span class="keyword">if</span> (date1.equals(date2)) &#123;</span><br><span class="line">      System.out.println(<span class="string">&quot;æ—¶é—´ç›¸ç­‰&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      System.out.println(<span class="string">&quot;æ—¶é—´ä¸ç­‰&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ç¤ºä¾‹5ï¼šå‘¨æœŸæ€§äº‹ä»¶ï¼ˆç”Ÿæ—¥ï¼‰"><a href="#ç¤ºä¾‹5ï¼šå‘¨æœŸæ€§äº‹ä»¶ï¼ˆç”Ÿæ—¥ï¼‰" class="headerlink" title="ç¤ºä¾‹5ï¼šå‘¨æœŸæ€§äº‹ä»¶ï¼ˆç”Ÿæ—¥ï¼‰"></a>ç¤ºä¾‹5ï¼šå‘¨æœŸæ€§äº‹ä»¶ï¼ˆç”Ÿæ—¥ï¼‰</h2><p>Java 8ä¸­æ£€æŸ¥åƒç”Ÿæ—¥è¿™ç§å‘¨æœŸæ€§äº‹ä»¶</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo05</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    LocalDate date1 = LocalDate.now();</span><br><span class="line">    LocalDate date2 = LocalDate.of(<span class="number">2018</span>, <span class="number">2</span>, <span class="number">6</span>);</span><br><span class="line">    MonthDay birthday = MonthDay.of(date2.getMonth(), date2.getDayOfMonth());</span><br><span class="line">    MonthDay currentMonthDay = MonthDay.from(date1);</span><br><span class="line">    <span class="keyword">if</span> (currentMonthDay.equals(birthday)) &#123;</span><br><span class="line">      System.out.println(<span class="string">&quot;æ˜¯ä½ çš„ç”Ÿæ—¥&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      System.out.println(<span class="string">&quot;ä½ çš„ç”Ÿæ—¥è¿˜æ²¡æœ‰åˆ°&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åªè¦å½“å¤©çš„æ—¥æœŸå’Œç”Ÿæ—¥åŒ¹é…ï¼Œæ— è®ºæ˜¯å“ªä¸€å¹´éƒ½ä¼šæ‰“å°å‡ºç¥è´ºä¿¡æ¯ã€‚ä½ å¯ä»¥æŠŠç¨‹åºæ•´åˆè¿›ç³»ç»Ÿæ—¶é’Ÿï¼Œçœ‹çœ‹ç”Ÿæ—¥æ—¶æ˜¯å¦ä¼šå—åˆ°æé†’ï¼Œæˆ–è€…å†™ä¸€ä¸ªå•å…ƒæµ‹è¯•æ¥æ£€æµ‹ä»£ç æ˜¯å¦è¿è¡Œæ­£ç¡®ã€‚</p><h2 id="ç¤ºä¾‹6ï¼šè·å–å½“å‰æ—¶é—´"><a href="#ç¤ºä¾‹6ï¼šè·å–å½“å‰æ—¶é—´" class="headerlink" title="ç¤ºä¾‹6ï¼šè·å–å½“å‰æ—¶é—´"></a>ç¤ºä¾‹6ï¼šè·å–å½“å‰æ—¶é—´</h2><p>Java 8ä¸­è·å–å½“å‰æ—¶é—´</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo06</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    LocalTime time = LocalTime.now();</span><br><span class="line">    System.out.println(<span class="string">&quot;è·å–å½“å‰çš„æ—¶é—´,ä¸å«æœ‰æ—¥æœŸ:&quot;</span> + time);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°å½“å‰æ—¶é—´å°±åªåŒ…å«æ—¶é—´ä¿¡æ¯ï¼Œæ²¡æœ‰æ—¥æœŸ</p><h2 id="ç¤ºä¾‹7ï¼šè®¡ç®—3å°æ—¶ä»¥åçš„æ—¶é—´"><a href="#ç¤ºä¾‹7ï¼šè®¡ç®—3å°æ—¶ä»¥åçš„æ—¶é—´" class="headerlink" title="ç¤ºä¾‹7ï¼šè®¡ç®—3å°æ—¶ä»¥åçš„æ—¶é—´"></a>ç¤ºä¾‹7ï¼šè®¡ç®—3å°æ—¶ä»¥åçš„æ—¶é—´</h2><p>Java 8ä¸­è·å–å½“å‰æ—¶é—´ é€šè¿‡å¢åŠ å°æ—¶ã€åˆ†ã€ç§’æ¥è®¡ç®—å°†æ¥çš„æ—¶é—´å¾ˆå¸¸è§ã€‚Java 8é™¤äº†ä¸å˜ç±»å‹å’Œçº¿ç¨‹å®‰å…¨çš„å¥½å¤„ä¹‹å¤–ï¼Œè¿˜æä¾›äº†æ›´å¥½çš„plusHours()æ–¹æ³•æ›¿æ¢add()ï¼Œå¹¶ä¸”æ˜¯å…¼å®¹çš„ã€‚æ³¨æ„ï¼Œè¿™äº›æ–¹æ³•è¿”å›ä¸€ä¸ªå…¨æ–°çš„LocalTimeå®ä¾‹ï¼Œç”±äºå…¶ä¸å¯å˜æ€§ï¼Œè¿”å›åä¸€å®šè¦ç”¨å˜é‡èµ‹å€¼ã€‚</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo07</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    LocalTime time = LocalTime.now();</span><br><span class="line">    LocalTime newTime = time.plusHours(<span class="number">3</span>);</span><br><span class="line">    System.out.println(<span class="string">&quot;ä¸‰ä¸ªå°æ—¶åçš„æ—¶é—´ä¸º:&quot;</span> + newTime);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ç¤ºä¾‹8ï¼šè®¡ç®—ä¸€å‘¨åçš„æ—¥æœŸ"><a href="#ç¤ºä¾‹8ï¼šè®¡ç®—ä¸€å‘¨åçš„æ—¥æœŸ" class="headerlink" title="ç¤ºä¾‹8ï¼šè®¡ç®—ä¸€å‘¨åçš„æ—¥æœŸ"></a>ç¤ºä¾‹8ï¼šè®¡ç®—ä¸€å‘¨åçš„æ—¥æœŸ</h2><p>Java 8å¦‚ä½•è®¡ç®—ä¸€å‘¨åçš„æ—¥æœŸ å’Œä¸Šä¸ªä¾‹å­è®¡ç®—3å°æ—¶ä»¥åçš„æ—¶é—´ç±»ä¼¼ï¼Œè¿™ä¸ªä¾‹å­ä¼šè®¡ç®—ä¸€å‘¨åçš„æ—¥æœŸã€‚LocalDateæ—¥æœŸä¸åŒ…å«æ—¶é—´ä¿¡æ¯ï¼Œå®ƒçš„plus()æ–¹æ³•ç”¨æ¥å¢åŠ å¤©ã€å‘¨ã€æœˆï¼ŒChronoUnitç±»å£°æ˜äº†è¿™äº›æ—¶é—´å•ä½ã€‚ç”±äºLocalDateä¹Ÿæ˜¯ä¸å˜ç±»å‹ï¼Œè¿”å›åä¸€å®šè¦ç”¨å˜é‡èµ‹å€¼ã€‚</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo08</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    LocalDate today = LocalDate.now();</span><br><span class="line">    System.out.println(<span class="string">&quot;ä»Šå¤©çš„æ—¥æœŸä¸º:&quot;</span> + today);</span><br><span class="line">    LocalDate nextWeek = today.plus(<span class="number">1</span>, ChronoUnit.WEEKS);</span><br><span class="line">    System.out.println(<span class="string">&quot;ä¸€å‘¨åçš„æ—¥æœŸä¸º:&quot;</span> + nextWeek);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°æ–°æ—¥æœŸç¦»å½“å¤©æ—¥æœŸæ˜¯7å¤©ï¼Œä¹Ÿå°±æ˜¯ä¸€å‘¨ã€‚ä½ å¯ä»¥ç”¨åŒæ ·çš„æ–¹æ³•å¢åŠ 1ä¸ªæœˆã€1å¹´ã€1å°æ—¶ã€1åˆ†é’Ÿç”šè‡³ä¸€ä¸ªä¸–çºªï¼Œæ›´å¤šé€‰é¡¹å¯ä»¥æŸ¥çœ‹Java 8 APIä¸­çš„ChronoUnitç±»</p><h2 id="ç¤ºä¾‹9ï¼šè®¡ç®—ä¸€å¹´å‰çš„æ—¥æœŸ"><a href="#ç¤ºä¾‹9ï¼šè®¡ç®—ä¸€å¹´å‰çš„æ—¥æœŸ" class="headerlink" title="ç¤ºä¾‹9ï¼šè®¡ç®—ä¸€å¹´å‰çš„æ—¥æœŸ"></a>ç¤ºä¾‹9ï¼šè®¡ç®—ä¸€å¹´å‰çš„æ—¥æœŸ</h2><p>Java 8è®¡ç®—ä¸€å¹´å‰æˆ–ä¸€å¹´åçš„æ—¥æœŸ åˆ©ç”¨minus()æ–¹æ³•è®¡ç®—ä¸€å¹´å‰çš„æ—¥æœŸ</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo09</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    LocalDate today = LocalDate.now();</span><br><span class="line">    LocalDate previousYear = today.minus(<span class="number">1</span>, ChronoUnit.YEARS);</span><br><span class="line">    System.out.println(<span class="string">&quot;ä¸€å¹´å‰çš„æ—¥æœŸ : &quot;</span> + previousYear);</span><br><span class="line">    LocalDate nextYear = today.plus(<span class="number">1</span>, ChronoUnit.YEARS);</span><br><span class="line">    System.out.println(<span class="string">&quot;ä¸€å¹´åçš„æ—¥æœŸ:&quot;</span> + nextYear);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ç¤ºä¾‹10ï¼šæ—¶é—´æˆ³"><a href="#ç¤ºä¾‹10ï¼šæ—¶é—´æˆ³" class="headerlink" title="ç¤ºä¾‹10ï¼šæ—¶é—´æˆ³"></a>ç¤ºä¾‹10ï¼šæ—¶é—´æˆ³</h2><p>Java 8çš„Clockæ—¶é’Ÿç±» Java 8å¢åŠ äº†ä¸€ä¸ªClockæ—¶é’Ÿç±»ç”¨äºè·å–å½“æ—¶çš„æ—¶é—´æˆ³ï¼Œæˆ–å½“å‰æ—¶åŒºä¸‹çš„æ—¥æœŸæ—¶é—´ä¿¡æ¯ã€‚ä»¥å‰ç”¨åˆ°System.currentTimeInMillis()å’ŒTimeZone.getDefault()çš„åœ°æ–¹éƒ½å¯ç”¨Clockæ›¿æ¢ã€‚</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo10</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">    String[] args)</span> </span>&#123;        </span><br><span class="line">    <span class="comment">// Returns the current time based on your system clock and set to UTC.        </span></span><br><span class="line">    Clock clock = Clock.systemUTC();        </span><br><span class="line">    System.out.println(<span class="string">&quot;Clock : &quot;</span> + clock.millis());</span><br><span class="line">    <span class="comment">// Returns time based on system clock zone        </span></span><br><span class="line">    Clock defaultClock = Clock.systemDefaultZone();        </span><br><span class="line">    System.out.println(<span class="string">&quot;Clock : &quot;</span> + defaultClock.millis());</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ç¤ºä¾‹11ï¼šåˆ¤æ–­æ—¥æœŸçš„å‰å"><a href="#ç¤ºä¾‹11ï¼šåˆ¤æ–­æ—¥æœŸçš„å‰å" class="headerlink" title="ç¤ºä¾‹11ï¼šåˆ¤æ–­æ—¥æœŸçš„å‰å"></a>ç¤ºä¾‹11ï¼šåˆ¤æ–­æ—¥æœŸçš„å‰å</h2><p>å¦‚ä½•ç”¨Javaåˆ¤æ–­æ—¥æœŸæ˜¯æ—©äºè¿˜æ˜¯æ™šäºå¦ä¸€ä¸ªæ—¥æœŸ å¦ä¸€ä¸ªå·¥ä½œä¸­å¸¸è§çš„æ“ä½œå°±æ˜¯å¦‚ä½•åˆ¤æ–­ç»™å®šçš„ä¸€ä¸ªæ—¥æœŸæ˜¯å¤§äºæŸå¤©è¿˜æ˜¯å°äºæŸå¤©ï¼Ÿåœ¨Java 8ä¸­ï¼ŒLocalDateç±»æœ‰ä¸¤ç±»æ–¹æ³•isBefore()å’ŒisAfter()ç”¨äºæ¯”è¾ƒæ—¥æœŸã€‚è°ƒç”¨isBefore()æ–¹æ³•æ—¶ï¼Œå¦‚æœç»™å®šæ—¥æœŸå°äºå½“å‰æ—¥æœŸåˆ™è¿”å›trueã€‚</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo11</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    LocalDate today = LocalDate.now();</span><br><span class="line">    LocalDate tomorrow = LocalDate.of(<span class="number">2018</span>, <span class="number">2</span>, <span class="number">6</span>);</span><br><span class="line">    <span class="keyword">if</span> (tomorrow.isAfter(today)) &#123;</span><br><span class="line">      System.out.println(<span class="string">&quot;ä¹‹åçš„æ—¥æœŸ:&quot;</span> + tomorrow);</span><br><span class="line">    &#125;</span><br><span class="line">    LocalDate yesterday = today.minus(<span class="number">1</span>, ChronoUnit.DAYS);</span><br><span class="line">    <span class="keyword">if</span> (yesterday.isBefore(today)) &#123;</span><br><span class="line">      System.out.println(<span class="string">&quot;ä¹‹å‰çš„æ—¥æœŸ:&quot;</span> + yesterday);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ç¤ºä¾‹12ï¼šæ—¶åŒºåˆ†ç¦»"><a href="#ç¤ºä¾‹12ï¼šæ—¶åŒºåˆ†ç¦»" class="headerlink" title="ç¤ºä¾‹12ï¼šæ—¶åŒºåˆ†ç¦»"></a>ç¤ºä¾‹12ï¼šæ—¶åŒºåˆ†ç¦»</h2><p>Java 8ä¸­å¤„ç†æ—¶åŒº Java 8ä¸ä»…åˆ†ç¦»äº†æ—¥æœŸå’Œæ—¶é—´ï¼Œä¹ŸæŠŠæ—¶åŒºåˆ†ç¦»å‡ºæ¥äº†ã€‚ç°åœ¨æœ‰ä¸€ç³»åˆ—å•ç‹¬çš„ç±»å¦‚ZoneIdæ¥å¤„ç†ç‰¹å®šæ—¶åŒºï¼ŒZoneDateTimeç±»æ¥è¡¨ç¤ºæŸæ—¶åŒºä¸‹çš„æ—¶é—´ã€‚è¿™åœ¨Java 8ä»¥å‰éƒ½æ˜¯ GregorianCalendarç±»æ¥åšçš„ã€‚ä¸‹é¢è¿™ä¸ªä¾‹å­å±•ç¤ºäº†å¦‚ä½•æŠŠæœ¬æ—¶åŒºçš„æ—¶é—´è½¬æ¢æˆå¦ä¸€ä¸ªæ—¶åŒºçš„æ—¶é—´ã€‚</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo12</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;        </span><br><span class="line">    <span class="comment">// Date and time with timezone in Java 8        </span></span><br><span class="line">    ZoneId america = ZoneId.of(<span class="string">&quot;America/New_York&quot;</span>);        </span><br><span class="line">    LocalDateTime localtDateAndTime = LocalDateTime.now();        </span><br><span class="line">    ZonedDateTime dateAndTimeInNewYork  = </span><br><span class="line">      ZonedDateTime.of(localtDateAndTime, america );        </span><br><span class="line">    System.out.println(<span class="string">&quot;Current date and time in a particular timezone : &quot;</span> </span><br><span class="line">                       + dateAndTimeInNewYork);    </span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ç¤ºä¾‹13ï¼šå›ºå®šæ—¥æœŸ"><a href="#ç¤ºä¾‹13ï¼šå›ºå®šæ—¥æœŸ" class="headerlink" title="ç¤ºä¾‹13ï¼šå›ºå®šæ—¥æœŸ"></a>ç¤ºä¾‹13ï¼šå›ºå®šæ—¥æœŸ</h2><p>å¦‚ä½•è¡¨ç¤ºä¿¡ç”¨å¡åˆ°æœŸè¿™ç±»å›ºå®šæ—¥æœŸï¼Œç­”æ¡ˆå°±åœ¨YearMonth ä¸ MonthDayæ£€æŸ¥é‡å¤äº‹ä»¶çš„ä¾‹å­ç›¸ä¼¼ï¼ŒYearMonthæ˜¯å¦ä¸€ä¸ªç»„åˆç±»ï¼Œç”¨äºè¡¨ç¤ºä¿¡ç”¨å¡åˆ°æœŸæ—¥ã€FDåˆ°æœŸæ—¥ã€æœŸè´§æœŸæƒåˆ°æœŸæ—¥ç­‰ã€‚è¿˜å¯ä»¥ç”¨è¿™ä¸ªç±»å¾—åˆ° å½“æœˆå…±æœ‰å¤šå°‘å¤©ï¼ŒYearMonthå®ä¾‹çš„lengthOfMonth()æ–¹æ³•å¯ä»¥è¿”å›å½“æœˆçš„å¤©æ•°ï¼Œåœ¨åˆ¤æ–­2æœˆæœ‰28å¤©è¿˜æ˜¯29å¤©æ—¶éå¸¸æœ‰ç”¨ã€‚</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo13</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    YearMonth currentYearMonth = YearMonth.now();</span><br><span class="line">    System.out.printf(<span class="string">&quot;Days in month year %s: %d%n&quot;</span>, currentYearMonth,</span><br><span class="line">                      currentYearMonth.lengthOfMonth());</span><br><span class="line">    YearMonth creditCardExpiry = YearMonth.of(<span class="number">2019</span>, Month.FEBRUARY);</span><br><span class="line">    System.out.printf(<span class="string">&quot;Your credit card expires on %s %n&quot;</span>, creditCardExpiry);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ç¤ºä¾‹14ï¼šæ£€æŸ¥é—°å¹´"><a href="#ç¤ºä¾‹14ï¼šæ£€æŸ¥é—°å¹´" class="headerlink" title="ç¤ºä¾‹14ï¼šæ£€æŸ¥é—°å¹´"></a>ç¤ºä¾‹14ï¼šæ£€æŸ¥é—°å¹´</h2><p>å¦‚ä½•åœ¨Java 8ä¸­æ£€æŸ¥é—°å¹´</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo14</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    LocalDate today = LocalDate.now();</span><br><span class="line">    <span class="keyword">if</span> (today.isLeapYear()) &#123;</span><br><span class="line">      System.out.println(<span class="string">&quot;This year is Leap year&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      System.out.println(<span class="string">&quot;2018 is not a Leap year&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ç¤ºä¾‹15ï¼šè®¡ç®—æ—¥æœŸä¹‹é—´çš„å¤©æ•°"><a href="#ç¤ºä¾‹15ï¼šè®¡ç®—æ—¥æœŸä¹‹é—´çš„å¤©æ•°" class="headerlink" title="ç¤ºä¾‹15ï¼šè®¡ç®—æ—¥æœŸä¹‹é—´çš„å¤©æ•°"></a>ç¤ºä¾‹15ï¼šè®¡ç®—æ—¥æœŸä¹‹é—´çš„å¤©æ•°</h2><p>è®¡ç®—ä¸¤ä¸ªæ—¥æœŸä¹‹é—´çš„å¤©æ•°å’Œæœˆæ•° æœ‰ä¸€ä¸ªå¸¸è§æ—¥æœŸæ“ä½œæ˜¯è®¡ç®—ä¸¤ä¸ªæ—¥æœŸä¹‹é—´çš„å¤©æ•°ã€å‘¨æ•°æˆ–æœˆæ•°ã€‚åœ¨Java 8ä¸­å¯ä»¥ç”¨java.time.Periodç±»æ¥åšè®¡ç®—ã€‚ä¸‹é¢è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬è®¡ç®—äº†å½“å¤©å’Œå°†æ¥æŸä¸€å¤©ä¹‹é—´çš„æœˆæ•°ã€‚</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo15</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    LocalDate today = LocalDate.now();</span><br><span class="line">    LocalDate java8Release = LocalDate.of(<span class="number">2018</span>, <span class="number">12</span>, <span class="number">14</span>);</span><br><span class="line">    Period periodToNextJavaRelease = Period.between(today, java8Release);</span><br><span class="line">    System.out.println(</span><br><span class="line">      <span class="string">&quot;Months left between today and Java 8 release : &quot;</span> + </span><br><span class="line">      periodToNextJavaRelease.getMonths());</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ç¤ºä¾‹16ï¼šè·å–æ—¶é—´æˆ³"><a href="#ç¤ºä¾‹16ï¼šè·å–æ—¶é—´æˆ³" class="headerlink" title="ç¤ºä¾‹16ï¼šè·å–æ—¶é—´æˆ³"></a>ç¤ºä¾‹16ï¼šè·å–æ—¶é—´æˆ³</h2><p>åœ¨Java 8ä¸­è·å–å½“å‰çš„æ—¶é—´æˆ³ Instantç±»æœ‰ä¸€ä¸ªé™æ€å·¥å‚æ–¹æ³•now()ä¼šè¿”å›å½“å‰çš„æ—¶é—´æˆ³ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo16</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    Instant timestamp = Instant.now();</span><br><span class="line">    System.out.println(<span class="string">&quot;What is value of this instant &quot;</span> + timestamp.toEpochMilli());</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ—¶é—´æˆ³ä¿¡æ¯é‡ŒåŒæ—¶åŒ…å«äº†æ—¥æœŸå’Œæ—¶é—´ï¼Œè¿™å’Œjava.util.Dateå¾ˆåƒã€‚å®é™…ä¸ŠInstantç±»ç¡®å®ç­‰åŒäº Java 8ä¹‹å‰çš„Dateç±»ï¼Œä½ å¯ä»¥ä½¿ç”¨Dateç±»å’ŒInstantç±»å„è‡ªçš„è½¬æ¢æ–¹æ³•äº’ç›¸è½¬æ¢ï¼Œä¾‹å¦‚ï¼šDate.from(Instant) å°†Instantè½¬æ¢æˆjava.util.Dateï¼ŒDate.toInstant()åˆ™æ˜¯å°†Dateç±»è½¬æ¢æˆInstantç±»ã€‚</p><h2 id="ç¤ºä¾‹17ï¼šæ ¼å¼åŒ–å·¥å…·"><a href="#ç¤ºä¾‹17ï¼šæ ¼å¼åŒ–å·¥å…·" class="headerlink" title="ç¤ºä¾‹17ï¼šæ ¼å¼åŒ–å·¥å…·"></a>ç¤ºä¾‹17ï¼šæ ¼å¼åŒ–å·¥å…·</h2><p>:Java 8ä¸­å¦‚ä½•ä½¿ç”¨é¢„å®šä¹‰çš„æ ¼å¼åŒ–å·¥å…·å»è§£ææˆ–æ ¼å¼åŒ–æ—¥æœŸ</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo17</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    String dayAfterTommorrow = <span class="string">&quot;20180205&quot;</span>;</span><br><span class="line">    LocalDate formatted = LocalDate</span><br><span class="line">      .parse(dayAfterTommorrow, DateTimeFormatter.BASIC_ISO_DATE);</span><br><span class="line">    System.out.println(dayAfterTommorrow + <span class="string">&quot;  æ ¼å¼åŒ–åçš„æ—¥æœŸä¸º:  &quot;</span> + formatted);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ç¤ºä¾‹18ï¼šå­—ç¬¦ä¸²äº’è½¬"><a href="#ç¤ºä¾‹18ï¼šå­—ç¬¦ä¸²äº’è½¬" class="headerlink" title="ç¤ºä¾‹18ï¼šå­—ç¬¦ä¸²äº’è½¬"></a>ç¤ºä¾‹18ï¼šå­—ç¬¦ä¸²äº’è½¬</h2><p>å­—ç¬¦ä¸²äº’è½¬æ—¥æœŸç±»å‹</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo18</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    LocalDateTime date = LocalDateTime.now();</span><br><span class="line">    DateTimeFormatter format1 = DateTimeFormatter.ofPattern(</span><br><span class="line">      <span class="string">&quot;yyyy/MM/dd HH:mm:ss&quot;</span>);        <span class="comment">//æ—¥æœŸè½¬å­—ç¬¦ä¸²        </span></span><br><span class="line">    String str = date.format(format1);</span><br><span class="line">    System.out.println(<span class="string">&quot;æ—¥æœŸè½¬æ¢ä¸ºå­—ç¬¦ä¸²:&quot;</span> + str);</span><br><span class="line">    DateTimeFormatter format2 = DateTimeFormatter.ofPattern(</span><br><span class="line">      <span class="string">&quot;yyyy/MM/dd HH:mm:ss&quot;</span>);        <span class="comment">//å­—ç¬¦ä¸²è½¬æ—¥æœŸ        </span></span><br><span class="line">    LocalDate date2 = LocalDate.parse(str,format2);        </span><br><span class="line">    System.out.println(<span class="string">&quot;æ—¥æœŸç±»å‹:&quot;</span>+date2);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹æŠ€æœ¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> æ—¥æœŸå¤„ç† </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å…³äºRedisä¸­çš„è¿‡æœŸæ—¶é—´</title>
      <link href="post/3697040241/"/>
      <url>post/3697040241/</url>
      
        <content type="html"><![CDATA[<p>å½“ä½¿ç”¨Redisçš„æ—¶å€™ï¼Œå¯ä»¥å¯¹Redisä¸­çš„æ¯ä¸ªkeyè®¾ç½®ä¸€ä¸ªè¿‡æœŸæ—¶é—´ï¼Œå½“åˆ°è¾¾è¿‡æœŸæ—¶é—´çš„æ—¶å€™ï¼Œè¿™ä¸ªkeyå°±ä¼šè¢«è‡ªåŠ¨åˆ é™¤ã€‚å…³äºè¿‡æœŸæ—¶é—´ï¼Œè¿˜æœ‰ä¸€äº›å¯ä»¥å…³æ³¨çš„ç‚¹ã€‚</p><h2 id="DEL-SET-GETSETç­‰å‘½ä»¤ä¼šæ¸…é™¤è¿‡æœŸæ—¶é—´"><a href="#DEL-SET-GETSETç­‰å‘½ä»¤ä¼šæ¸…é™¤è¿‡æœŸæ—¶é—´" class="headerlink" title="DEL/SET/GETSETç­‰å‘½ä»¤ä¼šæ¸…é™¤è¿‡æœŸæ—¶é—´"></a>DEL/SET/GETSETç­‰å‘½ä»¤ä¼šæ¸…é™¤è¿‡æœŸæ—¶é—´</h2><p>åœ¨ä½¿ç”¨DELã€SETã€GETSETç­‰ä¼šè¦†ç›–keyå¯¹åº”valueçš„å‘½ä»¤æ“ä½œä¸€ä¸ªè®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„keyçš„æ—¶å€™ï¼Œä¼šå¯¼è‡´å¯¹åº”çš„keyçš„è¿‡æœŸæ—¶é—´è¢«æ¸…é™¤ã€‚</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">//è®¾ç½®mykeyçš„è¿‡æœŸæ—¶é—´ä¸º300s</span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">set</span> mykey hello ex 300</span><br><span class="line">OK</span><br><span class="line">//æŸ¥çœ‹è¿‡æœŸæ—¶é—´</span><br><span class="line">127.0.0.1:6379&gt; ttl mykey</span><br><span class="line">(<span class="built_in">integer</span>) 294</span><br><span class="line">//ä½¿ç”¨<span class="built_in">set</span>å‘½ä»¤è¦†ç›–mykeyçš„å†…å®¹</span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">set</span> mykey olleh</span><br><span class="line">OK</span><br><span class="line">//è¿‡æœŸæ—¶é—´è¢«æ¸…é™¤</span><br><span class="line">127.0.0.1:6379&gt; ttl mykey</span><br><span class="line">(<span class="built_in">integer</span>) -1</span><br></pre></td></tr></table></figure><h2 id="INCR-LPUSH-HSETç­‰å‘½ä»¤ä¸ä¼šæ¸…é™¤è¿‡æœŸæ—¶é—´"><a href="#INCR-LPUSH-HSETç­‰å‘½ä»¤ä¸ä¼šæ¸…é™¤è¿‡æœŸæ—¶é—´" class="headerlink" title="INCR/LPUSH/HSETç­‰å‘½ä»¤ä¸ä¼šæ¸…é™¤è¿‡æœŸæ—¶é—´"></a>INCR/LPUSH/HSETç­‰å‘½ä»¤ä¸ä¼šæ¸…é™¤è¿‡æœŸæ—¶é—´</h2><p>è€Œåœ¨ä½¿ç”¨INCR/LPUSH/HSETè¿™ç§åªæ˜¯ä¿®æ”¹ä¸€ä¸ªkeyçš„valueï¼Œè€Œä¸æ˜¯è¦†ç›–æ•´ä¸ªvalueçš„å‘½ä»¤ï¼Œåˆ™ä¸ä¼šæ¸…é™¤keyçš„è¿‡æœŸæ—¶é—´ã€‚INCRï¼š</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">//è®¾ç½®incr_keyçš„è¿‡æœŸæ—¶é—´ä¸º300s</span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">set</span> incr_key 1 ex 300</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; ttl incr_key</span><br><span class="line">(<span class="built_in">integer</span>) 291</span><br><span class="line">//è¿›è¡Œè‡ªå¢æ“ä½œ</span><br><span class="line">127.0.0.1:6379&gt; incr incr_key</span><br><span class="line">(<span class="built_in">integer</span>) 2</span><br><span class="line">127.0.0.1:6379&gt; get incr_key</span><br><span class="line"><span class="string">&quot;2&quot;</span></span><br><span class="line">//æŸ¥è¯¢è¿‡æœŸæ—¶é—´ï¼Œå‘ç°è¿‡æœŸæ—¶é—´æ²¡æœ‰è¢«æ¸…é™¤</span><br><span class="line">127.0.0.1:6379&gt; ttl incr_key</span><br><span class="line">(<span class="built_in">integer</span>) 277</span><br></pre></td></tr></table></figure><p>LPUSHï¼š</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">//æ–°å¢ä¸€ä¸ªlistç±»å‹çš„keyï¼Œå¹¶æ·»åŠ ä¸€ä¸ªä¸º1çš„å€¼</span><br><span class="line">127.0.0.1:6379&gt; LPUSH list 1</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">//ä¸ºlistè®¾ç½®300sçš„è¿‡æœŸæ—¶é—´</span><br><span class="line">127.0.0.1:6379&gt; expire list 300</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">//æŸ¥çœ‹è¿‡æœŸæ—¶é—´</span><br><span class="line">127.0.0.1:6379&gt; ttl list</span><br><span class="line">(<span class="built_in">integer</span>) 292</span><br><span class="line">//å¾€listé‡Œé¢æ·»åŠ å€¼2</span><br><span class="line">127.0.0.1:6379&gt; lpush list 2</span><br><span class="line">(<span class="built_in">integer</span>) 2</span><br><span class="line">//æŸ¥çœ‹listçš„æ‰€æœ‰å€¼</span><br><span class="line">127.0.0.1:6379&gt; lrange list 0 1</span><br><span class="line">1) <span class="string">&quot;2&quot;</span></span><br><span class="line">2) <span class="string">&quot;1&quot;</span></span><br><span class="line">//èƒ½çœ‹åˆ°å¾€listé‡Œé¢æ·»åŠ å€¼å¹¶æ²¡æœ‰ä½¿è¿‡æœŸæ—¶é—´æ¸…é™¤</span><br><span class="line">127.0.0.1:6379&gt; ttl list</span><br><span class="line">(<span class="built_in">integer</span>) 252</span><br></pre></td></tr></table></figure><h2 id="PERSISTå‘½ä»¤ä¼šæ¸…é™¤è¿‡æœŸæ—¶é—´"><a href="#PERSISTå‘½ä»¤ä¼šæ¸…é™¤è¿‡æœŸæ—¶é—´" class="headerlink" title="PERSISTå‘½ä»¤ä¼šæ¸…é™¤è¿‡æœŸæ—¶é—´"></a>PERSISTå‘½ä»¤ä¼šæ¸…é™¤è¿‡æœŸæ—¶é—´</h2><p>å½“ä½¿ç”¨PERSISTå‘½ä»¤å°†ä¸€ä¸ªè®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„keyè½¬å˜æˆä¸€ä¸ªæŒä¹…åŒ–çš„keyçš„æ—¶å€™ï¼Œä¹Ÿä¼šæ¸…é™¤è¿‡æœŸæ—¶é—´ã€‚</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; <span class="built_in">set</span> persist_key haha ex 300</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; ttl persist_key</span><br><span class="line">(<span class="built_in">integer</span>) 296</span><br><span class="line">//å°†keyå˜ä¸ºæŒä¹…åŒ–çš„</span><br><span class="line">127.0.0.1:6379&gt; persist persist_key</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">//è¿‡æœŸæ—¶é—´è¢«æ¸…é™¤</span><br><span class="line">127.0.0.1:6379&gt; ttl persist_key</span><br><span class="line">(<span class="built_in">integer</span>) -1</span><br></pre></td></tr></table></figure><h2 id="ä½¿ç”¨RENAMEå‘½ä»¤ï¼Œè€keyçš„è¿‡æœŸæ—¶é—´å°†ä¼šè½¬åˆ°æ–°keyä¸Š"><a href="#ä½¿ç”¨RENAMEå‘½ä»¤ï¼Œè€keyçš„è¿‡æœŸæ—¶é—´å°†ä¼šè½¬åˆ°æ–°keyä¸Š" class="headerlink" title="ä½¿ç”¨RENAMEå‘½ä»¤ï¼Œè€keyçš„è¿‡æœŸæ—¶é—´å°†ä¼šè½¬åˆ°æ–°keyä¸Š"></a>ä½¿ç”¨RENAMEå‘½ä»¤ï¼Œè€keyçš„è¿‡æœŸæ—¶é—´å°†ä¼šè½¬åˆ°æ–°keyä¸Š</h2><p>åœ¨ä½¿ç”¨ä¾‹å¦‚ï¼šRENAME KEY_A KEY_Bå‘½ä»¤å°†KEY_Aé‡å‘½åä¸ºKEY_Bï¼Œä¸ç®¡KEY_Bæœ‰æ²¡æœ‰è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œæ–°çš„key KEY_Bå°†ä¼šç»§æ‰¿KEY_Açš„æ‰€æœ‰ç‰¹æ€§ã€‚</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">//è®¾ç½®key_açš„è¿‡æœŸæ—¶é—´ä¸º300s</span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">set</span> key_a value_a ex 300</span><br><span class="line">OK</span><br><span class="line">//è®¾ç½®key_bçš„è¿‡æœŸæ—¶é—´ä¸º600s</span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">set</span> key_b value_b ex 600</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; ttl key_a</span><br><span class="line">(<span class="built_in">integer</span>) 279</span><br><span class="line">127.0.0.1:6379&gt; ttl key_b</span><br><span class="line">(<span class="built_in">integer</span>) 591</span><br><span class="line">//å°†key_aé‡å‘½åä¸ºkey_b</span><br><span class="line">127.0.0.1:6379&gt; rename key_a key_b</span><br><span class="line">OK</span><br><span class="line">//æ–°çš„key_bç»§æ‰¿äº†key_açš„è¿‡æœŸæ—¶é—´</span><br><span class="line">127.0.0.1:6379&gt; ttl key_b</span><br><span class="line">(<span class="built_in">integer</span>) 248</span><br></pre></td></tr></table></figure><h2 id="ä½¿ç”¨EXPIRE-PEXPIREè®¾ç½®çš„è¿‡æœŸæ—¶é—´ä¸ºè´Ÿæ•°æˆ–è€…ä½¿ç”¨EXPIREAT-PEXPIREATè®¾ç½®è¿‡æœŸæ—¶é—´æˆ³ä¸ºè¿‡å»çš„æ—¶é—´ä¼šå¯¼è‡´keyè¢«åˆ é™¤"><a href="#ä½¿ç”¨EXPIRE-PEXPIREè®¾ç½®çš„è¿‡æœŸæ—¶é—´ä¸ºè´Ÿæ•°æˆ–è€…ä½¿ç”¨EXPIREAT-PEXPIREATè®¾ç½®è¿‡æœŸæ—¶é—´æˆ³ä¸ºè¿‡å»çš„æ—¶é—´ä¼šå¯¼è‡´keyè¢«åˆ é™¤" class="headerlink" title="ä½¿ç”¨EXPIRE/PEXPIREè®¾ç½®çš„è¿‡æœŸæ—¶é—´ä¸ºè´Ÿæ•°æˆ–è€…ä½¿ç”¨EXPIREAT/PEXPIREATè®¾ç½®è¿‡æœŸæ—¶é—´æˆ³ä¸ºè¿‡å»çš„æ—¶é—´ä¼šå¯¼è‡´keyè¢«åˆ é™¤"></a>ä½¿ç”¨EXPIRE/PEXPIREè®¾ç½®çš„è¿‡æœŸæ—¶é—´ä¸ºè´Ÿæ•°æˆ–è€…ä½¿ç”¨EXPIREAT/PEXPIREATè®¾ç½®è¿‡æœŸæ—¶é—´æˆ³ä¸ºè¿‡å»çš„æ—¶é—´ä¼šå¯¼è‡´keyè¢«åˆ é™¤</h2><p>EXPIREï¼š</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; <span class="built_in">set</span> key_1 value_1</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; get key_1</span><br><span class="line"><span class="string">&quot;value_1&quot;</span></span><br><span class="line">//è®¾ç½®è¿‡æœŸæ—¶é—´ä¸º-1</span><br><span class="line">127.0.0.1:6379&gt; expire key_1 -1</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">//å‘ç°keyè¢«åˆ é™¤</span><br><span class="line">127.0.0.1:6379&gt; get key_1</span><br><span class="line">(nil)</span><br></pre></td></tr></table></figure><p>EXPIREATï¼š</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; <span class="built_in">set</span> key_2 value_2</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; get key_2</span><br><span class="line"><span class="string">&quot;value_2&quot;</span></span><br><span class="line">//è®¾ç½®çš„æ—¶é—´æˆ³ä¸ºè¿‡å»çš„æ—¶é—´</span><br><span class="line">127.0.0.1:6379&gt; expireat key_2 10000</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">//keyè¢«åˆ é™¤</span><br><span class="line">127.0.0.1:6379&gt; get key_2</span><br><span class="line">(nil)</span><br></pre></td></tr></table></figure><h2 id="EXPIREå‘½ä»¤å¯ä»¥æ›´æ–°è¿‡æœŸæ—¶é—´"><a href="#EXPIREå‘½ä»¤å¯ä»¥æ›´æ–°è¿‡æœŸæ—¶é—´" class="headerlink" title="EXPIREå‘½ä»¤å¯ä»¥æ›´æ–°è¿‡æœŸæ—¶é—´"></a>EXPIREå‘½ä»¤å¯ä»¥æ›´æ–°è¿‡æœŸæ—¶é—´</h2><p>å¯¹ä¸€ä¸ªå·²ç»è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„keyä½¿ç”¨expireå‘½ä»¤ï¼Œå¯ä»¥æ›´æ–°å…¶è¿‡æœŸæ—¶é—´ã€‚</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">//è®¾ç½®key_1çš„è¿‡æœŸæ—¶é—´ä¸º100s</span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">set</span> key_1 value_1 ex 100</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; ttl key_1</span><br><span class="line">(<span class="built_in">integer</span>) 95</span><br><span class="line">//æ›´æ–°key_1çš„è¿‡æœŸæ—¶é—´ä¸º300s</span><br><span class="line">127.0.0.1:6379&gt; expire key_1 300</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379&gt; ttl key_1</span><br><span class="line">(<span class="built_in">integer</span>) 295</span><br></pre></td></tr></table></figure><h2 id="Redisçš„è¿‡æœŸç­–ç•¥"><a href="#Redisçš„è¿‡æœŸç­–ç•¥" class="headerlink" title="Redisçš„è¿‡æœŸç­–ç•¥"></a>Redisçš„è¿‡æœŸç­–ç•¥</h2><p>é‚£ä½ æœ‰æ²¡æœ‰æƒ³è¿‡ä¸€ä¸ªé—®é¢˜ï¼ŒRedisé‡Œé¢å¦‚æœæœ‰å¤§é‡çš„keyï¼Œæ€æ ·æ‰èƒ½é«˜æ•ˆçš„æ‰¾å‡ºè¿‡æœŸçš„keyå¹¶å°†å…¶åˆ é™¤å‘¢ï¼Œéš¾é“æ˜¯éå†æ¯ä¸€ä¸ªkeyå—ï¼Ÿå‡å¦‚åŒä¸€æ—¶æœŸè¿‡æœŸçš„keyéå¸¸å¤šï¼ŒRedisä¼šä¸ä¼šå› ä¸ºä¸€ç›´å¤„ç†è¿‡æœŸäº‹ä»¶ï¼Œè€Œå¯¼è‡´è¯»å†™æŒ‡ä»¤çš„å¡é¡¿ã€‚</p><blockquote><p>è¿™é‡Œè¯´æ˜ä¸€ä¸‹ï¼ŒRedisæ˜¯å•çº¿ç¨‹çš„ï¼Œæ‰€ä»¥ä¸€äº›è€—æ—¶çš„æ“ä½œä¼šå¯¼è‡´Rediså¡é¡¿ï¼Œæ¯”å¦‚å½“Redisæ•°æ®é‡ç‰¹åˆ«å¤§çš„æ—¶å€™ï¼Œä½¿ç”¨keys * å‘½ä»¤åˆ—å‡ºæ‰€æœ‰çš„keyã€‚</p></blockquote><p>å®é™…ä¸ŠRedisä½¿ç”¨æ‡’æƒ°åˆ é™¤+å®šæœŸåˆ é™¤ç›¸ç»“åˆçš„æ–¹å¼å¤„ç†è¿‡æœŸçš„keyã€‚</p><h3 id="æ‡’æƒ°åˆ é™¤"><a href="#æ‡’æƒ°åˆ é™¤" class="headerlink" title="æ‡’æƒ°åˆ é™¤"></a>æ‡’æƒ°åˆ é™¤</h3><p>æ‰€è°“æ‡’æƒ°åˆ é™¤å°±æ˜¯åœ¨å®¢æˆ·ç«¯è®¿é—®è¯¥keyçš„æ—¶å€™ï¼Œredisä¼šå¯¹keyçš„è¿‡æœŸæ—¶é—´è¿›è¡Œæ£€æŸ¥ï¼Œå¦‚æœè¿‡æœŸäº†å°±ç«‹å³åˆ é™¤ã€‚<br>è¿™ç§æ–¹å¼çœ‹ä¼¼å¾ˆå®Œç¾ï¼Œåœ¨è®¿é—®çš„æ—¶å€™æ£€æŸ¥keyçš„è¿‡æœŸæ—¶é—´ï¼Œä¸ä¼šå ç”¨å¤ªå¤šçš„é¢å¤–CPUèµ„æºã€‚ä½†æ˜¯å¦‚æœä¸€ä¸ªkeyå·²ç»è¿‡æœŸäº†ï¼Œå¦‚æœé•¿æ—¶é—´æ²¡æœ‰è¢«è®¿é—®ï¼Œé‚£ä¹ˆè¿™ä¸ªkeyå°±ä¼šä¸€ç›´å­˜ç•™åœ¨å†…å­˜ä¹‹ä¸­ï¼Œä¸¥é‡æ¶ˆè€—äº†å†…å­˜èµ„æºã€‚</p><h3 id="å®šæœŸåˆ é™¤"><a href="#å®šæœŸåˆ é™¤" class="headerlink" title="å®šæœŸåˆ é™¤"></a>å®šæœŸåˆ é™¤</h3><p>å®šæœŸåˆ é™¤çš„åŸç†æ˜¯ï¼ŒRedisä¼šå°†æ‰€æœ‰è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„keyæ”¾å…¥ä¸€ä¸ªå­—å…¸ä¸­ï¼Œç„¶åæ¯éš”ä¸€æ®µæ—¶é—´ä»å­—å…¸ä¸­éšæœºä¸€äº›keyæ£€æŸ¥è¿‡æœŸæ—¶é—´å¹¶åˆ é™¤å·²è¿‡æœŸçš„keyã€‚</p><p>Redisé»˜è®¤æ¯ç§’è¿›è¡Œ10æ¬¡è¿‡æœŸæ‰«æï¼š</p><ol><li>ä»è¿‡æœŸå­—å…¸ä¸­éšæœº20ä¸ªkey</li><li>åˆ é™¤è¿™20ä¸ªkeyä¸­å·²è¿‡æœŸçš„</li><li>å¦‚æœè¶…è¿‡25%çš„keyè¿‡æœŸï¼Œåˆ™é‡å¤ç¬¬ä¸€æ­¥</li></ol><p>åŒæ—¶ï¼Œä¸ºäº†ä¿è¯ä¸å‡ºç°å¾ªç¯è¿‡åº¦çš„æƒ…å†µï¼ŒRedisè¿˜è®¾ç½®äº†æ‰«æçš„æ—¶é—´ä¸Šé™ï¼Œé»˜è®¤ä¸ä¼šè¶…è¿‡25msã€‚</p>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®°æœ¬ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Redis </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ­£ç¡®è®¿é—®redisä¸­çš„æµ·é‡æ•°æ®ï¼Œé¿å…äº‹æ•…äº§ç”Ÿ</title>
      <link href="post/506775304/"/>
      <url>post/506775304/</url>
      
        <content type="html"><![CDATA[<h2 id="äº‹æ•…äº§ç”Ÿ"><a href="#äº‹æ•…äº§ç”Ÿ" class="headerlink" title="äº‹æ•…äº§ç”Ÿ"></a>äº‹æ•…äº§ç”Ÿ</h2><p>å½“æˆ‘ä»¬ä½¿ç”¨<code>usertoken:userid</code>è¿™æ ·çš„æ ¼å¼çš„keyæ¥ä¿å­˜ç”¨æˆ·tokenå€¼ï¼Œè¿™ä¸ªæ—¶å€™æƒ³ç»Ÿè®¡ä¸€ä¸‹åœ¨çº¿ç”¨æˆ·æ•°é‡ã€‚</p><p>ç›´æ¥ä½¿ç”¨<code>keys usertoken*</code>æ–¹å¼è¿›è¡ŒæŸ¥è¯¢ï¼Œå½“ç”¨æˆ·æ•°é‡å·¨å¤§çš„æ—¶å€™ï¼Œäº‹æ•…å°±äº§ç”Ÿäº†ã€‚å¯¼è‡´redisä¸å¯ç”¨ï¼Œ å‡æ­»ã€‚</p><h2 id="åŸå› "><a href="#åŸå› " class="headerlink" title="åŸå› "></a>åŸå› </h2><p>æˆ‘ä»¬çº¿ä¸Šçš„ç™»å½•ç”¨æˆ·æœ‰å‡ ç™¾ä¸‡ï¼Œæ•°æ®é‡æ¯”è¾ƒå¤šï¼›keysç®—æ³•æ˜¯éå†ç®—æ³•ï¼Œå¤æ‚åº¦æ˜¯O(n)ï¼Œä¹Ÿå°±æ˜¯æ•°æ®è¶Šå¤šï¼Œæ—¶é—´å¤æ‚åº¦è¶Šé«˜ã€‚</p><p>æ•°æ®é‡è¾¾åˆ°å‡ ç™¾ä¸‡ï¼Œkeysè¿™ä¸ªæŒ‡ä»¤å°±ä¼šå¯¼è‡´ Redis æœåŠ¡å¡é¡¿ï¼Œå› ä¸º Redis æ˜¯å•çº¿ç¨‹ç¨‹åºï¼Œé¡ºåºæ‰§è¡Œæ‰€æœ‰æŒ‡ä»¤ï¼Œå…¶å®ƒæŒ‡ä»¤å¿…é¡»ç­‰åˆ°å½“å‰çš„ keys æŒ‡ä»¤æ‰§è¡Œå®Œäº†æ‰å¯ä»¥ç»§ç»­ã€‚</p><h2 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h2><p>ä»¬å¯ä»¥é‡‡ç”¨redisçš„å¦ä¸€ä¸ªå‘½ä»¤scanã€‚æˆ‘ä»¬çœ‹ä¸€ä¸‹scançš„ç‰¹ç‚¹</p><ul><li>å¤æ‚åº¦è™½ç„¶ä¹Ÿæ˜¯ O(n)ï¼Œä½†æ˜¯å®ƒæ˜¯é€šè¿‡æ¸¸æ ‡åˆ†æ­¥è¿›è¡Œçš„ï¼Œä¸ä¼šé˜»å¡çº¿ç¨‹</li><li>æä¾› count å‚æ•°ï¼Œä¸æ˜¯ç»“æœæ•°é‡ï¼Œæ˜¯rediså•æ¬¡éå†å­—å…¸æ§½ä½æ•°é‡(çº¦ç­‰äº)</li><li>åŒ keys ä¸€æ ·ï¼Œå®ƒä¹Ÿæä¾›æ¨¡å¼åŒ¹é…åŠŸèƒ½;</li><li>æœåŠ¡å™¨ä¸éœ€è¦ä¸ºæ¸¸æ ‡ä¿å­˜çŠ¶æ€ï¼Œæ¸¸æ ‡çš„å”¯ä¸€çŠ¶æ€å°±æ˜¯ scan è¿”å›ç»™å®¢æˆ·ç«¯çš„æ¸¸æ ‡æ•´æ•°;</li><li>è¿”å›çš„ç»“æœå¯èƒ½ä¼šæœ‰é‡å¤ï¼Œéœ€è¦å®¢æˆ·ç«¯å»é‡å¤ï¼Œè¿™ç‚¹éå¸¸é‡è¦;</li><li>å•æ¬¡è¿”å›çš„ç»“æœæ˜¯ç©ºçš„å¹¶ä¸æ„å‘³ç€éå†ç»“æŸï¼Œè€Œè¦çœ‹è¿”å›çš„æ¸¸æ ‡å€¼æ˜¯å¦ä¸ºé›¶</li></ul><h3 id="scanå‘½ä»¤çš„æ ¼å¼"><a href="#scanå‘½ä»¤çš„æ ¼å¼" class="headerlink" title="scanå‘½ä»¤çš„æ ¼å¼"></a>scanå‘½ä»¤çš„æ ¼å¼</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">SCAN cursor [MATCH pattern] [COUNT count]</span><br></pre></td></tr></table></figure><h3 id="å‘½ä»¤è§£é‡Š"><a href="#å‘½ä»¤è§£é‡Š" class="headerlink" title="å‘½ä»¤è§£é‡Š"></a>å‘½ä»¤è§£é‡Š</h3><p><strong>scan æ¸¸æ ‡ MATCH &lt;è¿”å›å’Œç»™å®šæ¨¡å¼ç›¸åŒ¹é…çš„å…ƒç´ &gt; count æ¯æ¬¡è¿­ä»£æ‰€è¿”å›çš„å…ƒç´ æ•°é‡</strong></p><ol><li><code>SCANå‘½ä»¤æ˜¯å¢é‡çš„å¾ªç¯ï¼Œæ¯æ¬¡è°ƒç”¨åªä¼šè¿”å›ä¸€å°éƒ¨åˆ†çš„å…ƒç´ ã€‚æ‰€ä»¥ä¸ä¼šè®©rediså‡æ­»</code></li><li><code>SCANå‘½ä»¤è¿”å›çš„æ˜¯ä¸€ä¸ªæ¸¸æ ‡ï¼Œä»0å¼€å§‹éå†ï¼Œåˆ°0ç»“æŸéå†</code></li></ol><h3 id="ä¾‹å­"><a href="#ä¾‹å­" class="headerlink" title="ä¾‹å­"></a>ä¾‹å­</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">redis &gt; scan 0 match usertoken* count 5</span><br><span class="line">1) <span class="string">&quot;6&quot;</span></span><br><span class="line">2) 1) <span class="string">&quot;usertoken:100&quot;</span></span><br><span class="line">2) <span class="string">&quot;usertoken:101&quot;</span></span><br><span class="line">3) <span class="string">&quot;usertoken:102&quot;</span></span><br><span class="line">4) <span class="string">&quot;usertoken:103&quot;</span></span><br><span class="line">5) <span class="string">&quot;usertoken:104&quot;</span></span><br></pre></td></tr></table></figure><p>ä»0å¼€å§‹éå†ï¼Œè¿”å›äº†æ¸¸æ ‡6ï¼Œåˆè¿”å›äº†æ•°æ®ï¼Œç»§ç»­scanéå†ï¼Œå°±è¦ä»6å¼€å§‹</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">redis &gt; scan 6 match usertoken* count 5</span><br><span class="line">1) <span class="string">&quot;10&quot;</span></span><br><span class="line">2) 1) <span class="string">&quot;usertoken:200&quot;</span></span><br><span class="line">2) <span class="string">&quot;usertoken:201&quot;</span></span><br><span class="line">3) <span class="string">&quot;usertoken:202&quot;</span></span><br><span class="line">4) <span class="string">&quot;usertoken:203&quot;</span></span><br><span class="line">5) <span class="string">&quot;usertoken:204&quot;</span></span><br></pre></td></tr></table></figure><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>^_^.</p>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®°æœ¬ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Redis </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Docker Swarm</title>
      <link href="post/656e6847/"/>
      <url>post/656e6847/</url>
      
        <content type="html"><![CDATA[<p> å®è·µä¸­ä¼šå‘ç°ï¼Œç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨å•ä¸ª Docker èŠ‚ç‚¹æ˜¯è¿œè¿œä¸å¤Ÿçš„ï¼Œæ­å»º Docker é›†ç¾¤åŠ¿åœ¨å¿…è¡Œã€‚ç„¶è€Œï¼Œé¢å¯¹ Kubernetes, Mesos ä»¥åŠ Swarm ç­‰ä¼—å¤šå®¹å™¨é›†ç¾¤ç³»ç»Ÿï¼Œæˆ‘ä»¬è¯¥å¦‚ä½•é€‰æ‹©å‘¢ï¼Ÿå®ƒä»¬ä¹‹ä¸­ï¼ŒSwarm æ˜¯ Docker åŸç”Ÿçš„ï¼ŒåŒæ—¶ä¹Ÿæ˜¯æœ€ç®€å•ï¼Œæœ€æ˜“å­¦ï¼Œæœ€èŠ‚çœèµ„æºçš„ï¼Œæ¯”è¾ƒé€‚åˆä¸­å°å‹å…¬å¸ä½¿ç”¨ã€‚</p><h2 id="Docker-Swarm-ä»‹ç»"><a href="#Docker-Swarm-ä»‹ç»" class="headerlink" title="Docker Swarm ä»‹ç»"></a>Docker Swarm ä»‹ç»</h2><p>Swarm åœ¨ Docker 1.12 ç‰ˆæœ¬ä¹‹å‰å±äºä¸€ä¸ªç‹¬ç«‹çš„é¡¹ç›®ï¼Œåœ¨ Docker 1.12 ç‰ˆæœ¬å‘å¸ƒä¹‹åï¼Œè¯¥é¡¹ç›®åˆå¹¶åˆ°äº† Docker ä¸­ï¼Œæˆä¸º Docker çš„ä¸€ä¸ªå­å‘½ä»¤ã€‚ç›®å‰ï¼ŒSwarm æ˜¯ Docker ç¤¾åŒºæä¾›çš„å”¯ä¸€ä¸€ä¸ªåŸç”Ÿæ”¯æŒ Docker é›†ç¾¤ç®¡ç†çš„å·¥å…·ã€‚å®ƒå¯ä»¥æŠŠå¤šä¸ª Docker ä¸»æœºç»„æˆçš„ç³»ç»Ÿè½¬æ¢ä¸ºå•ä¸€çš„è™šæ‹Ÿ Docker ä¸»æœºï¼Œä½¿å¾—å®¹å™¨å¯ä»¥ç»„æˆè·¨ä¸»æœºçš„å­ç½‘ç½‘ç»œã€‚</p><p>Docker Swarm æ˜¯ä¸€ä¸ªä¸º IT è¿ç»´å›¢é˜Ÿæä¾›é›†ç¾¤å’Œè°ƒåº¦èƒ½åŠ›çš„ç¼–æ’å·¥å…·ã€‚ç”¨æˆ·å¯ä»¥æŠŠé›†ç¾¤ä¸­æ‰€æœ‰ Docker Engine æ•´åˆè¿›ä¸€ä¸ªã€Œè™šæ‹Ÿ Engineã€çš„èµ„æºæ± ï¼Œé€šè¿‡æ‰§è¡Œå‘½ä»¤ä¸å•ä¸€çš„ä¸» Swarm è¿›è¡Œæ²Ÿé€šï¼Œè€Œä¸å¿…åˆ†åˆ«å’Œæ¯ä¸ª Docker Engine æ²Ÿé€šã€‚åœ¨çµæ´»çš„è°ƒåº¦ç­–ç•¥ä¸‹ï¼ŒIT å›¢é˜Ÿå¯ä»¥æ›´å¥½åœ°ç®¡ç†å¯ç”¨çš„ä¸»æœºèµ„æºï¼Œä¿è¯åº”ç”¨å®¹å™¨çš„é«˜æ•ˆè¿è¡Œã€‚</p><p><img src="https://github.com/cayzlh/git-img-repository/raw/master/blog/2019/09/22.png" alt="Docker Swarm"></p><h2 id="Docker-Swarm-ä¼˜ç‚¹"><a href="#Docker-Swarm-ä¼˜ç‚¹" class="headerlink" title="Docker Swarm ä¼˜ç‚¹"></a>Docker Swarm ä¼˜ç‚¹</h2><h3 id="ä»»ä½•è§„æ¨¡éƒ½æœ‰é«˜æ€§èƒ½è¡¨ç°"><a href="#ä»»ä½•è§„æ¨¡éƒ½æœ‰é«˜æ€§èƒ½è¡¨ç°" class="headerlink" title="ä»»ä½•è§„æ¨¡éƒ½æœ‰é«˜æ€§èƒ½è¡¨ç°"></a>ä»»ä½•è§„æ¨¡éƒ½æœ‰é«˜æ€§èƒ½è¡¨ç°</h3><p>å¯¹äºä¼ä¸šçº§çš„ Docker Engine é›†ç¾¤å’Œå®¹å™¨è°ƒåº¦è€Œè¨€ï¼Œå¯æ‹“å±•æ€§æ˜¯å…³é”®ã€‚ä»»ä½•è§„æ¨¡çš„å…¬å¸â€”â€”ä¸è®ºæ˜¯æ‹¥æœ‰äº”ä¸ªè¿˜æ˜¯ä¸Šåƒä¸ªæœåŠ¡å™¨â€”â€”éƒ½èƒ½åœ¨å…¶ç¯å¢ƒä¸‹æœ‰æ•ˆä½¿ç”¨ Swarmã€‚ ç»è¿‡æµ‹è¯•ï¼ŒSwarm å¯æ‹“å±•æ€§çš„æé™æ˜¯åœ¨ 1000 ä¸ªèŠ‚ç‚¹ä¸Šè¿è¡Œ 50000 ä¸ªéƒ¨ç½²å®¹å™¨ï¼Œæ¯ä¸ªå®¹å™¨çš„å¯åŠ¨æ—¶é—´ä¸ºäºšç§’çº§ï¼ŒåŒæ—¶æ€§èƒ½æ— å‡æŸã€‚</p><h3 id="çµæ´»çš„å®¹å™¨è°ƒåº¦"><a href="#çµæ´»çš„å®¹å™¨è°ƒåº¦" class="headerlink" title="çµæ´»çš„å®¹å™¨è°ƒåº¦"></a>çµæ´»çš„å®¹å™¨è°ƒåº¦</h3><p>Swarm å¸®åŠ© IT è¿ç»´å›¢é˜Ÿåœ¨æœ‰é™æ¡ä»¶ä¸‹å°†æ€§èƒ½è¡¨ç°å’Œèµ„æºåˆ©ç”¨æœ€ä¼˜åŒ–ã€‚Swarm çš„å†…ç½®è°ƒåº¦å™¨ï¼ˆschedulerï¼‰æ”¯æŒå¤šç§è¿‡æ»¤å™¨ï¼ŒåŒ…æ‹¬ï¼šèŠ‚ç‚¹æ ‡ç­¾ï¼Œäº²å’Œæ€§å’Œå¤šç§å®¹å™¨éƒ¨ç­–ç•¥å¦‚ binpackã€spreadã€random ç­‰ç­‰ã€‚</p><h3 id="æœåŠ¡çš„æŒç»­å¯ç”¨æ€§"><a href="#æœåŠ¡çš„æŒç»­å¯ç”¨æ€§" class="headerlink" title="æœåŠ¡çš„æŒç»­å¯ç”¨æ€§"></a>æœåŠ¡çš„æŒç»­å¯ç”¨æ€§</h3><p>Docker Swarm ç”± Swarm Manager æä¾›é«˜å¯ç”¨æ€§ï¼Œé€šè¿‡åˆ›å»ºå¤šä¸ª Swarm master èŠ‚ç‚¹å’Œåˆ¶å®šä¸» master èŠ‚ç‚¹å®•æœºæ—¶çš„å¤‡é€‰ç­–ç•¥ã€‚å¦‚æœä¸€ä¸ª master èŠ‚ç‚¹å®•æœºï¼Œé‚£ä¹ˆä¸€ä¸ª slave èŠ‚ç‚¹å°±ä¼šè¢«å‡æ ¼ä¸º master èŠ‚ç‚¹ï¼Œç›´åˆ°åŸæ¥çš„ master èŠ‚ç‚¹æ¢å¤æ­£å¸¸ã€‚ æ­¤å¤–ï¼Œå¦‚æœæŸä¸ªèŠ‚ç‚¹æ— æ³•åŠ å…¥é›†ç¾¤ï¼ŒSwarm ä¼šç»§ç»­å°è¯•åŠ å…¥ï¼Œå¹¶æä¾›é”™è¯¯è­¦æŠ¥å’Œæ—¥å¿—ã€‚åœ¨èŠ‚ç‚¹å‡ºé”™æ—¶ï¼ŒSwarm ç°åœ¨å¯ä»¥å°è¯•æŠŠå®¹å™¨é‡æ–°è°ƒåº¦åˆ°æ­£å¸¸çš„èŠ‚ç‚¹ä¸Šå»ã€‚</p><p><strong>å’Œ Docker API åŠæ•´åˆæ”¯æŒçš„å…¼å®¹æ€§</strong> Swarm å¯¹ Docker API å®Œå…¨æ”¯æŒï¼Œè¿™æ„å‘³ç€å®ƒèƒ½ä¸ºä½¿ç”¨ä¸åŒ Docker å·¥å…·ï¼ˆå¦‚ Docker CLIï¼ŒComposeï¼ŒTrusted Registryï¼ŒHub å’Œ UCPï¼‰çš„ç”¨æˆ·æä¾›æ— ç¼è¡”æ¥çš„ä½¿ç”¨ä½“éªŒã€‚</p><p><strong>Docker Swarm ä¸º Docker åŒ–åº”ç”¨çš„æ ¸å¿ƒåŠŸèƒ½ï¼ˆè¯¸å¦‚å¤šä¸»æœºç½‘ç»œå’Œå­˜å‚¨å·ç®¡ç†ï¼‰æä¾›åŸç”Ÿæ”¯æŒã€‚</strong>å¼€å‘çš„ Compose æ–‡ä»¶èƒ½ï¼ˆé€šè¿‡ docker-compose up ï¼‰è½»æ˜“åœ°éƒ¨ç½²åˆ°æµ‹è¯•æœåŠ¡å™¨æˆ– Swarm é›†ç¾¤ä¸Šã€‚Docker Swarm è¿˜å¯ä»¥ä» Docker Trusted Registry æˆ– Hub é‡Œ pull å¹¶ run é•œåƒã€‚</p><p><strong>ç»¼ä¸Šæ‰€è¿°ï¼ŒDocker Swarm æä¾›äº†ä¸€å¥—é«˜å¯ç”¨ Docker é›†ç¾¤ç®¡ç†çš„è§£å†³æ–¹æ¡ˆï¼Œå®Œå…¨æ”¯æŒæ ‡å‡†çš„ Docker APIï¼Œæ–¹ä¾¿ç®¡ç†è°ƒåº¦é›†ç¾¤ Docker å®¹å™¨ï¼Œåˆç†å……åˆ†åˆ©ç”¨é›†ç¾¤ä¸»æœºèµ„æº</strong>ã€‚</p><blockquote><p><strong>å¹¶éæ‰€æœ‰æœåŠ¡éƒ½åº”è¯¥éƒ¨ç½²åœ¨Swarmé›†ç¾¤å†…ã€‚æ•°æ®åº“ä»¥åŠå…¶å®ƒæœ‰çŠ¶æ€æœåŠ¡å°±ä¸é€‚åˆéƒ¨ç½²åœ¨Swarmé›†ç¾¤å†…ã€‚</strong></p></blockquote><h2 id="ç›¸å…³æ¦‚å¿µ"><a href="#ç›¸å…³æ¦‚å¿µ" class="headerlink" title="ç›¸å…³æ¦‚å¿µ"></a>ç›¸å…³æ¦‚å¿µ</h2><h3 id="èŠ‚ç‚¹"><a href="#èŠ‚ç‚¹" class="headerlink" title="èŠ‚ç‚¹"></a>èŠ‚ç‚¹</h3><p>è¿è¡Œ Docker çš„ä¸»æœºå¯ä»¥ä¸»åŠ¨åˆå§‹åŒ–ä¸€ä¸ª Swarm é›†ç¾¤æˆ–è€…åŠ å…¥ä¸€ä¸ªå·²å­˜åœ¨çš„ Swarm é›†ç¾¤ï¼Œè¿™æ ·è¿™ä¸ªè¿è¡Œ Docker çš„ä¸»æœºå°±æˆä¸ºä¸€ä¸ª Swarm é›†ç¾¤çš„èŠ‚ç‚¹ (node) ã€‚èŠ‚ç‚¹åˆ†ä¸ºç®¡ç† (manager) èŠ‚ç‚¹å’Œå·¥ä½œ (worker) èŠ‚ç‚¹ã€‚</p><p>ç®¡ç†èŠ‚ç‚¹ç”¨äº Swarm é›†ç¾¤çš„ç®¡ç†ï¼Œdocker swarm å‘½ä»¤åŸºæœ¬åªèƒ½åœ¨ç®¡ç†èŠ‚ç‚¹æ‰§è¡Œï¼ˆèŠ‚ç‚¹é€€å‡ºé›†ç¾¤å‘½ä»¤ docker swarm leave å¯ä»¥åœ¨å·¥ä½œèŠ‚ç‚¹æ‰§è¡Œï¼‰ã€‚ä¸€ä¸ª Swarm é›†ç¾¤å¯ä»¥æœ‰å¤šä¸ªç®¡ç†èŠ‚ç‚¹ï¼Œä½†åªæœ‰ä¸€ä¸ªç®¡ç†èŠ‚ç‚¹å¯ä»¥æˆä¸º leaderï¼Œleader é€šè¿‡ raft åè®®å®ç°ã€‚</p><p>å·¥ä½œèŠ‚ç‚¹æ˜¯ä»»åŠ¡æ‰§è¡ŒèŠ‚ç‚¹ï¼Œç®¡ç†èŠ‚ç‚¹å°†æœåŠ¡ (service) ä¸‹å‘è‡³å·¥ä½œèŠ‚ç‚¹æ‰§è¡Œã€‚ç®¡ç†èŠ‚ç‚¹é»˜è®¤ä¹Ÿä½œä¸ºå·¥ä½œèŠ‚ç‚¹ã€‚ä½ ä¹Ÿå¯ä»¥é€šè¿‡é…ç½®è®©æœåŠ¡åªè¿è¡Œåœ¨ç®¡ç†èŠ‚ç‚¹ã€‚ä¸‹å›¾å±•ç¤ºäº†é›†ç¾¤ä¸­ç®¡ç†èŠ‚ç‚¹ä¸å·¥ä½œèŠ‚ç‚¹çš„å…³ç³»ã€‚</p><p><img src="https://github.com/cayzlh/git-img-repository/raw/master/blog/2019/09/23.png" alt="èŠ‚ç‚¹"></p><h3 id="æœåŠ¡å’Œä»»åŠ¡"><a href="#æœåŠ¡å’Œä»»åŠ¡" class="headerlink" title="æœåŠ¡å’Œä»»åŠ¡"></a>æœåŠ¡å’Œä»»åŠ¡</h3><p>ä»»åŠ¡ ï¼ˆTaskï¼‰æ˜¯ Swarm ä¸­çš„æœ€å°çš„è°ƒåº¦å•ä½ï¼Œç›®å‰æ¥è¯´å°±æ˜¯ä¸€ä¸ªå•ä¸€çš„å®¹å™¨ã€‚ æœåŠ¡ ï¼ˆServicesï¼‰ æ˜¯æŒ‡ä¸€ç»„ä»»åŠ¡çš„é›†åˆï¼ŒæœåŠ¡å®šä¹‰äº†ä»»åŠ¡çš„å±æ€§ã€‚æœåŠ¡æœ‰ä¸¤ç§æ¨¡å¼ï¼š</p><ul><li>replicated services æŒ‰ç…§ä¸€å®šè§„åˆ™åœ¨å„ä¸ªå·¥ä½œèŠ‚ç‚¹ä¸Šè¿è¡ŒæŒ‡å®šä¸ªæ•°çš„ä»»åŠ¡ã€‚</li><li>global services æ¯ä¸ªå·¥ä½œèŠ‚ç‚¹ä¸Šè¿è¡Œä¸€ä¸ªä»»åŠ¡</li></ul><p>ä¸¤ç§æ¨¡å¼é€šè¿‡ docker service create çš„ â€“mode å‚æ•°æŒ‡å®šã€‚ä¸‹å›¾å±•ç¤ºäº†å®¹å™¨ã€ä»»åŠ¡ã€æœåŠ¡çš„å…³ç³»ã€‚</p><p><img src="https://github.com/cayzlh/git-img-repository/raw/master/blog/2019/09/24.png" alt="æœåŠ¡å’Œä»»åŠ¡"></p><h2 id="æœ€å"><a href="#æœ€å" class="headerlink" title="æœ€å"></a>æœ€å</h2><ul><li><p>è½¬è‡ªï¼š<a href="http://www.ityouknow.com/docker/2018/04/19/docker-swarm.html">Docker(å…­)ï¼šDocker ä¸‰å‰‘å®¢ä¹‹ Docker Swarm</a></p></li><li><p>å¯¹è¿™ä¸ªDocker Swarmè¿™éƒ¨åˆ†ä¸æ˜¯å¾ˆç†Ÿæ‚‰ï¼Œä¸»è¦æ˜¯æƒ³äº†è§£å…¶æ¦‚å¿µã€‚è½¬å‘è¿™ç¯‡æ–‡ç« å†…å®¹ä»¥å…ä»¥åæ‰¾ä¸åˆ°ã€‚</p></li><li><p>å®è·µä¹‹åå†åšè¡¥å……</p></li></ul>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹æŠ€æœ¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Docker </tag>
            
            <tag> è½¬è½½ </tag>
            
            <tag> å¾®æœåŠ¡ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä½¿ç”¨Docker Compose</title>
      <link href="post/2311352951/"/>
      <url>post/2311352951/</url>
      
        <content type="html"><![CDATA[<blockquote><p>Docker-Compose æ˜¯ Docker çš„ä¸€ç§ç¼–æ’æœåŠ¡ï¼Œæ˜¯ä¸€ä¸ªç”¨äºåœ¨ Docker ä¸Šå®šä¹‰å¹¶è¿è¡Œå¤æ‚åº”ç”¨çš„å·¥å…·ï¼Œå¯ä»¥è®©ç”¨æˆ·åœ¨é›†ç¾¤ä¸­éƒ¨ç½²åˆ†å¸ƒå¼åº”ç”¨ã€‚</p><p>ä½¿ç”¨ä¸€ä¸ª Dockerfile æ¨¡æ¿æ–‡ä»¶å¯ä»¥å®šä¹‰ä¸€ä¸ªå•ç‹¬çš„åº”ç”¨å®¹å™¨ï¼Œå¦‚æœéœ€è¦å®šä¹‰å¤šä¸ªå®¹å™¨å°±éœ€è¦æœåŠ¡ç¼–æ’ã€‚Docker Composeæ˜¯å…¶ä¸­çš„ä¸€ç§æœåŠ¡ç¼–æ’æŠ€æœ¯æ–¹æ¡ˆï¼Œæ˜¯Dockerçš„å®˜æ–¹äº§å“ã€‚</p><p>Dockerfile å¯ä»¥è®©ç”¨æˆ·ç®¡ç†ä¸€ä¸ªå•ç‹¬çš„åº”ç”¨å®¹å™¨ï¼›è€Œ Compose åˆ™å…è®¸ç”¨æˆ·åœ¨ä¸€ä¸ªæ¨¡æ¿ï¼ˆYAML æ ¼å¼ï¼‰ä¸­å®šä¹‰ä¸€ç»„ç›¸å…³è”çš„åº”ç”¨å®¹å™¨ï¼ˆè¢«ç§°ä¸ºä¸€ä¸ª projectï¼Œå³é¡¹ç›®ï¼‰ï¼Œä¾‹å¦‚ä¸€ä¸ª Web æœåŠ¡å®¹å™¨å†åŠ ä¸Šåç«¯çš„æ•°æ®åº“æœåŠ¡å®¹å™¨ç­‰ã€‚</p><p>å‚è€ƒï¼š<a href="http://www.ityouknow.com/docker/2018/03/22/docker-compose.html">Docker ä¸‰å‰‘å®¢ä¹‹ Docker Compose</a></p></blockquote><h2 id="Docker-Compose-ä»‹ç»"><a href="#Docker-Compose-ä»‹ç»" class="headerlink" title="Docker Compose ä»‹ç»"></a>Docker Compose ä»‹ç»</h2><p>é€šè¿‡ Docker-Compose ç”¨æˆ·å¯ä»¥å¾ˆå®¹æ˜“åœ°ç”¨ä¸€ä¸ªé…ç½®æ–‡ä»¶å®šä¹‰ä¸€ä¸ªå¤šå®¹å™¨çš„åº”ç”¨ï¼Œç„¶åä½¿ç”¨ä¸€æ¡æŒ‡ä»¤å®‰è£…è¿™ä¸ªåº”ç”¨çš„æ‰€æœ‰ä¾èµ–ï¼Œå®Œæˆæ„å»ºã€‚Docker-Compose è§£å†³äº†å®¹å™¨ä¸å®¹å™¨ä¹‹é—´å¦‚ä½•ç®¡ç†ç¼–æ’çš„é—®é¢˜ã€‚</p><p><img src="https://github.com/cayzlh/git-img-repository/raw/master/blog/2019/09/19.png" alt="Docker Compose å·¥ä½œåŸç†å›¾"></p><p>Compose ä¸­æœ‰ä¸¤ä¸ªé‡è¦çš„æ¦‚å¿µï¼š</p><ul><li>æœåŠ¡ (service) ï¼šä¸€ä¸ªåº”ç”¨çš„å®¹å™¨ï¼Œå®é™…ä¸Šå¯ä»¥åŒ…æ‹¬è‹¥å¹²è¿è¡Œç›¸åŒé•œåƒçš„å®¹å™¨å®ä¾‹ã€‚</li><li>é¡¹ç›® (project) ï¼šç”±ä¸€ç»„å…³è”çš„åº”ç”¨å®¹å™¨ç»„æˆçš„ä¸€ä¸ªå®Œæ•´ä¸šåŠ¡å•å…ƒï¼Œåœ¨ docker-compose.yml æ–‡ä»¶ä¸­å®šä¹‰ã€‚</li></ul><p>ä¸€ä¸ªé¡¹ç›®å¯ä»¥ç”±å¤šä¸ªæœåŠ¡ï¼ˆå®¹å™¨ï¼‰å…³è”è€Œæˆï¼ŒCompose é¢å‘é¡¹ç›®è¿›è¡Œç®¡ç†ï¼Œé€šè¿‡å­å‘½ä»¤å¯¹é¡¹ç›®ä¸­çš„ä¸€ç»„å®¹å™¨è¿›è¡Œä¾¿æ·åœ°ç”Ÿå‘½å‘¨æœŸç®¡ç†ã€‚</p><p>Compose é¡¹ç›®ç”± Python ç¼–å†™ï¼Œå®ç°ä¸Šè°ƒç”¨äº† Docker æœåŠ¡æä¾›çš„ API æ¥å¯¹å®¹å™¨è¿›è¡Œç®¡ç†ã€‚å› æ­¤ï¼Œåªè¦æ‰€æ“ä½œçš„å¹³å°æ”¯æŒ Docker APIï¼Œå°±å¯ä»¥åœ¨å…¶ä¸Šåˆ©ç”¨ Compose æ¥è¿›è¡Œç¼–æ’ç®¡ç†ã€‚</p><h2 id="Docker-Compose-å®‰è£…"><a href="#Docker-Compose-å®‰è£…" class="headerlink" title="Docker Compose å®‰è£…"></a>Docker Compose å®‰è£…</h2><p>Docker Compose æ˜¯ Docker çš„ç‹¬ç«‹äº§å“ï¼Œå› æ­¤éœ€è¦å®‰è£… Docker ä¹‹ååœ¨å•ç‹¬å®‰è£… Docker Compose .</p><h3 id="macOS"><a href="#macOS" class="headerlink" title="macOS"></a>macOS</h3><p>macOSä¸‹ä½¿ç”¨<code>homebrew</code>å®‰è£…ä¹‹åé»˜è®¤å®‰è£…å¥½äº†<code>Docker Compose</code>ã€‚</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">brew cask install docker</span><br></pre></td></tr></table></figure><h3 id="Centos"><a href="#Centos" class="headerlink" title="Centos"></a>Centos</h3><p><strong>æ–¹æ³•ä¸€ï¼š</strong></p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#ä¸‹è½½</span></span><br><span class="line">sudo curl -L https://github.com/docker/compose/releases/download/1.20.0/docker-compose-`uname -s`-`uname -m` -o /usr/<span class="built_in">local</span>/bin/docker-compose</span><br><span class="line"><span class="comment">#å®‰è£…</span></span><br><span class="line">chmod +x /usr/<span class="built_in">local</span>/bin/docker-compose</span><br><span class="line"><span class="comment">#æŸ¥çœ‹ç‰ˆæœ¬</span></span><br><span class="line">docker-compose version</span><br></pre></td></tr></table></figure><p><strong>æ–¹æ³•äºŒï¼š</strong></p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#å®‰è£…pip</span></span><br><span class="line">yum -y install epel-release</span><br><span class="line">yum -y install python-pip</span><br><span class="line"><span class="comment">#ç¡®è®¤ç‰ˆæœ¬</span></span><br><span class="line">pip --version</span><br><span class="line"><span class="comment">#æ›´æ–°pip</span></span><br><span class="line">pip install --upgrade pip</span><br><span class="line"><span class="comment">#å®‰è£…docker-compose</span></span><br><span class="line">pip install docker-compose </span><br><span class="line"><span class="comment">#æŸ¥çœ‹ç‰ˆæœ¬</span></span><br><span class="line">docker-compose version</span><br></pre></td></tr></table></figure><p>å®‰è£…å®Œæˆåæ‰§è¡Œ<code>docker-compose version</code>ï¼Œè¾“å‡ºä»¥ä¸‹ä¿¡æ¯ï¼Œè¯´æ˜å®‰è£…å®Œæˆã€‚</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker-compose version 1.24.1, build 4667896b</span><br><span class="line">docker-py version: 3.7.3</span><br><span class="line">CPython version: 3.6.8</span><br><span class="line">OpenSSL version: OpenSSL 1.1.0j  20 Nov 2018</span><br></pre></td></tr></table></figure><h2 id="ä¸€ä¸ªå°ä¾‹å­"><a href="#ä¸€ä¸ªå°ä¾‹å­" class="headerlink" title="ä¸€ä¸ªå°ä¾‹å­"></a>ä¸€ä¸ªå°ä¾‹å­</h2><blockquote><p>æºç åœ°å€ï¼š<a href="https://github.com/cayzlh/springboot-docker-demo">https://github.com/cayzlh/springboot-docker-demo</a></p></blockquote><h3 id="åˆ›å»ºä¸€ä¸ªSpringBootåº”ç”¨"><a href="#åˆ›å»ºä¸€ä¸ªSpringBootåº”ç”¨" class="headerlink" title="åˆ›å»ºä¸€ä¸ªSpringBootåº”ç”¨"></a>åˆ›å»ºä¸€ä¸ªSpringBootåº”ç”¨</h3><p>åˆ›å»ºäºSpringBootåº”ç”¨ï¼Œé…åˆRedisè®°å½•è®¿é—®æ¬¡æ•°ã€‚</p><h4 id="pom"><a href="#pom" class="headerlink" title="pom"></a>pom</h4><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>redis.clients<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jedis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="DockerController"><a href="#DockerController" class="headerlink" title="DockerController"></a>DockerController</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DockerController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="meta">@Lazy</span></span><br><span class="line">    <span class="keyword">private</span> StringRedisTemplate redisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">index</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        redisTemplate.opsForValue().increment(<span class="string">&quot;request_key&quot;</span>, <span class="number">1</span>);</span><br><span class="line">        String times = redisTemplate.opsForValue().get(<span class="string">&quot;request_key&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Hello Docker! you had request &quot;</span>+times+<span class="string">&quot; times!!!!!!!!!&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Dockerfile"><a href="#Dockerfile" class="headerlink" title="Dockerfile"></a>Dockerfile</h4><p>åœ¨<code>src/main/docker</code>è·¯å¾„ä¸­åˆ›å»º<code>Dockerfile</code>æ–‡ä»¶.</p><figure class="highlight dockerfile"><table><tr><td class="code"><pre><span class="line"><span class="keyword">FROM</span> openjdk:<span class="number">8</span>-jdk-alpine</span><br><span class="line"></span><br><span class="line"><span class="keyword">MAINTAINER</span> chenanyu antchenanyu@<span class="number">163</span>.com</span><br><span class="line"></span><br><span class="line"><span class="keyword">VOLUME</span><span class="bash"> /tmp</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">ADD</span><span class="bash"> target/springboot-docker-demo-0.0.3.jar app.jar</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="bash"> [<span class="string">&quot;java&quot;</span>,<span class="string">&quot;-Djava.security.egd=file:/dev/./urandom&quot;</span>,<span class="string">&quot;-jar&quot;</span>,<span class="string">&quot;/app.jar&quot;</span>]</span></span><br></pre></td></tr></table></figure><h4 id="docker-compose"><a href="#docker-compose" class="headerlink" title="docker-compose"></a>docker-compose</h4><p>åœ¨æ ¹ç›®å½•åˆ›å»º<code>docker-compose.yml</code>æ–‡ä»¶ã€‚</p><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&#x27;3&#x27;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">app:</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">v-app</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">build:</span> <span class="string">.</span></span><br><span class="line">    <span class="attr">working_dir:</span> <span class="string">/app</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./:/app</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">~/.m2:/root/.m2</span></span><br><span class="line">    <span class="attr">expose:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;8080&quot;</span></span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">nginx</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">redisserver</span></span><br><span class="line">    <span class="attr">command:</span> <span class="string">mvn</span> <span class="string">clean</span> <span class="string">spring-boot:run</span> <span class="string">-Dspring-boot.run.profiles=docker</span></span><br><span class="line">  <span class="attr">redisserver:</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">v-redis</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">&quot;redis:alpine&quot;</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">6379</span><span class="string">:6379</span></span><br><span class="line">  <span class="attr">nginx:</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">v-nginx</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">nginx:1.13</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">8081</span><span class="string">:80</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">443</span><span class="string">:443</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./nginx:/etc/nginx/conf.d</span></span><br></pre></td></tr></table></figure><h3 id="ä½¿ç”¨docker-composeå‘½ä»¤è¿è¡Œ"><a href="#ä½¿ç”¨docker-composeå‘½ä»¤è¿è¡Œ" class="headerlink" title="ä½¿ç”¨docker-composeå‘½ä»¤è¿è¡Œ"></a>ä½¿ç”¨docker-composeå‘½ä»¤è¿è¡Œ</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker-compose up</span><br></pre></td></tr></table></figure><p><img src="https://github.com/cayzlh/git-img-repository/raw/master/blog/2019/09/20.png" alt="docker-compose up"></p><p>è¿™ä¸ªæ—¶å€™æµè§ˆå™¨è®¿é—®<code>http://youipaddress:8081</code>ï¼Œå°±èƒ½çœ‹åˆ°æ•ˆæœäº†ï¼Œè®¿é—®æ¬¡æ•°ä¼šä¸æ–­çš„å åŠ ã€‚</p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line">Hello Docker! you had request 5 times!!!!!!!!!</span><br></pre></td></tr></table></figure><p><img src="https://github.com/cayzlh/git-img-repository/raw/master/blog/2019/09/21.gif" alt="nginx"></p><p><em>åœ¨macOSä¸­ï¼Œérootç”¨æˆ·æ˜¯æ— æ³•ä½¿ç”¨å°äº1024çš„å¸¸ç”¨ç«¯å£çš„ã€‚å¦‚æœå¼€å‘ä¸­éœ€è¦ç”¨åˆ°80ç«¯å£, å°±è¦è®¾ç½®ç«¯å£è½¬å‘ã€‚<br>è¿™é‡Œå°±ä¸æƒ³éº»çƒ¦äº†ï¼Œä½¿ç”¨8081æ¥åšæµ‹è¯•ã€‚</em></p><h2 id="Docker-Composeå¸¸ç”¨å‘½ä»¤"><a href="#Docker-Composeå¸¸ç”¨å‘½ä»¤" class="headerlink" title="Docker Composeå¸¸ç”¨å‘½ä»¤"></a>Docker Composeå¸¸ç”¨å‘½ä»¤</h2><ul><li><p>ä½¿ç”¨<code>docker-compose up -d</code>åœ¨åå°å¯åŠ¨æœåŠ¡</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@localhost composetest]<span class="comment"># docker-compose up -d</span></span><br><span class="line">Starting composetest_web_1 ... </span><br><span class="line">Starting composetest_web_1 ... <span class="keyword">done</span></span><br></pre></td></tr></table></figure></li><li><p>ä½¿ç”¨<code>docker-compose ps</code>å‘½ä»¤æŸ¥çœ‹å¯åŠ¨çš„æœåŠ¡</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@localhost composetest]<span class="comment"># docker-compose ps</span></span><br><span class="line">       Name                      Command               State           Ports         </span><br><span class="line">-------------------------------------------------------------------------------------</span><br><span class="line">composetest_redis_1   docker-entrypoint.sh redis ...   Up      6379/tcp              </span><br><span class="line">composetest_web_1     python app.py                    Up      0.0.0.0:5000-&gt;5000/tcp</span><br></pre></td></tr></table></figure></li><li><p>ä½¿ç”¨<code>docker-compose stop</code>åœæ­¢æœåŠ¡ã€‚</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@localhost composetest]<span class="comment"># docker-compose stop</span></span><br><span class="line">Stopping composetest_web_1   ... <span class="keyword">done</span></span><br><span class="line">Stopping composetest_redis_1 ... <span class="keyword">done</span></span><br></pre></td></tr></table></figure></li><li><p>å…¶ä»–</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#æŸ¥çœ‹å¸®åŠ©</span></span><br><span class="line">docker-compose -h</span><br><span class="line"></span><br><span class="line"><span class="comment"># -f  æŒ‡å®šä½¿ç”¨çš„ Compose æ¨¡æ¿æ–‡ä»¶ï¼Œé»˜è®¤ä¸º docker-compose.ymlï¼Œå¯ä»¥å¤šæ¬¡æŒ‡å®šã€‚</span></span><br><span class="line">docker-compose -f docker-compose.yml up -d </span><br><span class="line"></span><br><span class="line"><span class="comment">#å¯åŠ¨æ‰€æœ‰å®¹å™¨ï¼Œ-d å°†ä¼šåœ¨åå°å¯åŠ¨å¹¶è¿è¡Œæ‰€æœ‰çš„å®¹å™¨</span></span><br><span class="line">docker-compose up -d</span><br><span class="line"></span><br><span class="line"><span class="comment">#åœç”¨ç§»é™¤æ‰€æœ‰å®¹å™¨ä»¥åŠç½‘ç»œç›¸å…³</span></span><br><span class="line">docker-compose down</span><br><span class="line"></span><br><span class="line"><span class="comment">#æŸ¥çœ‹æœåŠ¡å®¹å™¨çš„è¾“å‡º</span></span><br><span class="line">docker-compose logs</span><br><span class="line"></span><br><span class="line"><span class="comment">#åˆ—å‡ºé¡¹ç›®ä¸­ç›®å‰çš„æ‰€æœ‰å®¹å™¨</span></span><br><span class="line">docker-compose ps</span><br><span class="line"></span><br><span class="line"><span class="comment">#æ„å»ºï¼ˆé‡æ–°æ„å»ºï¼‰é¡¹ç›®ä¸­çš„æœåŠ¡å®¹å™¨ã€‚æœåŠ¡å®¹å™¨ä¸€æ—¦æ„å»ºåï¼Œå°†ä¼šå¸¦ä¸Šä¸€ä¸ªæ ‡è®°åï¼Œä¾‹å¦‚å¯¹äº web é¡¹ç›®ä¸­çš„ä¸€ä¸ª db å®¹å™¨ï¼Œå¯èƒ½æ˜¯ web_dbã€‚å¯ä»¥éšæ—¶åœ¨é¡¹ç›®ç›®å½•ä¸‹è¿è¡Œ docker-compose build æ¥é‡æ–°æ„å»ºæœåŠ¡</span></span><br><span class="line">docker-compose build</span><br><span class="line"></span><br><span class="line"><span class="comment">#æ‹‰å–æœåŠ¡ä¾èµ–çš„é•œåƒ</span></span><br><span class="line">docker-compose pull</span><br><span class="line"></span><br><span class="line"><span class="comment">#é‡å¯é¡¹ç›®ä¸­çš„æœåŠ¡</span></span><br><span class="line">docker-compose restart</span><br><span class="line"></span><br><span class="line"><span class="comment">#åˆ é™¤æ‰€æœ‰ï¼ˆåœæ­¢çŠ¶æ€çš„ï¼‰æœåŠ¡å®¹å™¨ã€‚æ¨èå…ˆæ‰§è¡Œ docker-compose stop å‘½ä»¤æ¥åœæ­¢å®¹å™¨ã€‚</span></span><br><span class="line">docker-compose rm </span><br><span class="line"></span><br><span class="line"><span class="comment">#åœ¨æŒ‡å®šæœåŠ¡ä¸Šæ‰§è¡Œä¸€ä¸ªå‘½ä»¤ã€‚</span></span><br><span class="line">docker-compose run ubuntu ping docker.com</span><br><span class="line"></span><br><span class="line"><span class="comment">#è®¾ç½®æŒ‡å®šæœåŠ¡è¿è¡Œçš„å®¹å™¨ä¸ªæ•°ã€‚é€šè¿‡ service=num çš„å‚æ•°æ¥è®¾ç½®æ•°é‡</span></span><br><span class="line">docker-compose scale web=3 db=2</span><br><span class="line"></span><br><span class="line"><span class="comment">#å¯åŠ¨å·²ç»å­˜åœ¨çš„æœåŠ¡å®¹å™¨ã€‚</span></span><br><span class="line">docker-compose start</span><br><span class="line"></span><br><span class="line"><span class="comment">#åœæ­¢å·²ç»å¤„äºè¿è¡ŒçŠ¶æ€çš„å®¹å™¨ï¼Œä½†ä¸åˆ é™¤å®ƒã€‚é€šè¿‡ docker-compose start å¯ä»¥å†æ¬¡å¯åŠ¨è¿™äº›å®¹å™¨ã€‚</span></span><br><span class="line">docker-compose stop</span><br><span class="line"></span><br></pre></td></tr></table></figure></li></ul><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul><li><a href="http://www.ityouknow.com/docker/2018/03/22/docker-compose.html">Docker ä¸‰å‰‘å®¢ä¹‹ Docker Compose</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®°æœ¬ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> Docker </tag>
            
            <tag> Compose </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä½¿ç”¨Dockeréƒ¨ç½²SpringBooté¡¹ç›®</title>
      <link href="post/709624188/"/>
      <url>post/709624188/</url>
      
        <content type="html"><![CDATA[<blockquote><p>Docker æŠ€æœ¯å‘å±•ä¸ºå¾®æœåŠ¡è½åœ°æä¾›äº†æ›´åŠ ä¾¿åˆ©çš„ç¯å¢ƒï¼Œä½¿ç”¨ Docker éƒ¨ç½² Spring Boot å…¶å®éå¸¸ç®€å•ã€‚</p></blockquote><h2 id="åˆ›å»ºSpringBooté¡¹ç›®"><a href="#åˆ›å»ºSpringBooté¡¹ç›®" class="headerlink" title="åˆ›å»ºSpringBooté¡¹ç›®"></a>åˆ›å»ºSpringBooté¡¹ç›®</h2><p>ä½¿ç”¨<code>SpringBoot2.0</code>åˆ›å»ºä¸€ä¸ªSpringBooté¡¹ç›®ã€‚</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>2.0.0.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br></pre></td></tr></table></figure><p>æ·»åŠ  web å’Œæµ‹è¯•ä¾èµ–</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><p>åˆ›å»ºä¸€ä¸ª DockerControllerï¼Œåœ¨å…¶ä¸­æœ‰ä¸€ä¸ª<code>index()</code>æ–¹æ³•ï¼Œè®¿é—®æ—¶è¿”å›ï¼š<code>Hello Docker!</code></p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DockerController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">index</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Hello Docker!&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯åŠ¨ç±»</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DockerApplication</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">SpringApplication.run(DockerApplication.class, args);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ·»åŠ å®Œæ¯•åå¯åŠ¨é¡¹ç›®ï¼Œå¯åŠ¨æˆåŠŸåæµè§ˆå™¨æ”¾é—®ï¼š<code>http://localhost:8080/</code>ï¼Œé¡µé¢è¿”å›ï¼š<code>Hello Docker!</code>ï¼Œè¯´æ˜ Spring Boot é¡¹ç›®é…ç½®æ­£å¸¸ã€‚</p><h2 id="ä¸ºSpringBooté¡¹ç›®æ·»åŠ Dockeræ”¯æŒ"><a href="#ä¸ºSpringBooté¡¹ç›®æ·»åŠ Dockeræ”¯æŒ" class="headerlink" title="ä¸ºSpringBooté¡¹ç›®æ·»åŠ Dockeræ”¯æŒ"></a>ä¸ºSpringBooté¡¹ç›®æ·»åŠ Dockeræ”¯æŒ</h2><p>åœ¨ <code>pom.xml</code>çš„<code>properties </code>èŠ‚ç‚¹ä¸­æ·»åŠ  Docker é•œåƒåç§°</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">docker.image.prefix</span>&gt;</span>springboot<span class="tag">&lt;/<span class="name">docker.image.prefix</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br></pre></td></tr></table></figure><p><code>plugins</code> ä¸­æ·»åŠ  <code>Docker</code> æ„å»ºæ’ä»¶ï¼š</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- Docker maven plugin --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.spotify<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>docker-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">imageName</span>&gt;</span>$&#123;docker.image.prefix&#125;/$&#123;project.artifactId&#125;<span class="tag">&lt;/<span class="name">imageName</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dockerDirectory</span>&gt;</span>src/main/docker<span class="tag">&lt;/<span class="name">dockerDirectory</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">resources</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">resource</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">targetPath</span>&gt;</span>/<span class="tag">&lt;/<span class="name">targetPath</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">directory</span>&gt;</span>$&#123;project.build.directory&#125;<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">include</span>&gt;</span>$&#123;project.build.finalName&#125;.jar<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resource</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resources</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- Docker maven plugin --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure><p>åœ¨ç›®å½•<code>src/main/docker</code>ä¸‹åˆ›å»º Dockerfile æ–‡ä»¶ï¼ŒDockerfile æ–‡ä»¶ç”¨æ¥è¯´æ˜å¦‚ä½•æ¥æ„å»ºé•œåƒã€‚</p><figure class="highlight dockerfile"><table><tr><td class="code"><pre><span class="line"><span class="keyword">FROM</span> openjdk:<span class="number">8</span>-jdk-alpine</span><br><span class="line"><span class="keyword">VOLUME</span><span class="bash"> /tmp</span></span><br><span class="line"><span class="keyword">ADD</span><span class="bash"> spring-boot-docker-1.0.jar app.jar</span></span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="bash"> [<span class="string">&quot;java&quot;</span>,<span class="string">&quot;-Djava.security.egd=file:/dev/./urandom&quot;</span>,<span class="string">&quot;-jar&quot;</span>,<span class="string">&quot;/app.jar&quot;</span>]</span></span><br></pre></td></tr></table></figure><p>è¿™ä¸ª Dockerfile æ–‡ä»¶å¾ˆç®€å•ï¼Œæ„å»º Jdk åŸºç¡€ç¯å¢ƒï¼Œæ·»åŠ  Spring Boot Jar åˆ°é•œåƒä¸­ï¼Œç®€å•è§£é‡Šä¸€ä¸‹:</p><ul><li>FROM ï¼Œè¡¨ç¤ºä½¿ç”¨ Jdk8 ç¯å¢ƒ ä¸ºåŸºç¡€é•œåƒï¼Œå¦‚æœé•œåƒä¸æ˜¯æœ¬åœ°çš„ä¼šä» DockerHub è¿›è¡Œä¸‹è½½</li><li>VOLUME ï¼ŒVOLUME æŒ‡å‘äº†ä¸€ä¸ª<code>/tmp</code>çš„ç›®å½•ï¼Œç”±äº Spring Boot ä½¿ç”¨å†…ç½®çš„Tomcatå®¹å™¨ï¼ŒTomcat é»˜è®¤ä½¿ç”¨<code>/tmp</code>ä½œä¸ºå·¥ä½œç›®å½•ã€‚è¿™ä¸ªå‘½ä»¤çš„æ•ˆæœæ˜¯ï¼šåœ¨å®¿ä¸»æœºçš„<code>/var/lib/docker</code>ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªä¸´æ—¶æ–‡ä»¶å¹¶æŠŠå®ƒé“¾æ¥åˆ°å®¹å™¨ä¸­çš„<code>/tmp</code>ç›®å½•</li><li>ADD ï¼Œæ‹·è´æ–‡ä»¶å¹¶ä¸”é‡å‘½å</li><li>ENTRYPOINT ï¼Œä¸ºäº†ç¼©çŸ­ Tomcat çš„å¯åŠ¨æ—¶é—´ï¼Œæ·»åŠ <code>java.security.egd</code>çš„ç³»ç»Ÿå±æ€§æŒ‡å‘<code>/dev/urandom</code>ä½œä¸º ENTRYPOINT</li></ul><blockquote><p>SpringBooté¡¹ç›®çš„Dockerä¾èµ–å°±é…ç½®å®Œæˆäº†</p></blockquote><h2 id="ä½¿ç”¨dockerfileæ‰“åŒ…é•œåƒ"><a href="#ä½¿ç”¨dockerfileæ‰“åŒ…é•œåƒ" class="headerlink" title="ä½¿ç”¨dockerfileæ‰“åŒ…é•œåƒ"></a>ä½¿ç”¨dockerfileæ‰“åŒ…é•œåƒ</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">mvn package docker:build</span><br></pre></td></tr></table></figure><p>å½“çœ‹åˆ°<code>BUILD SUCCESS</code>çš„æ—¶å€™ï¼Œè¯´æ˜æ„å»ºæˆåŠŸäº†ã€‚</p><p>ä½¿ç”¨<code>docker images</code>å‘½ä»¤æŸ¥çœ‹æ„å»ºå¥½çš„é•œåƒï¼š</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker images</span><br><span class="line">REPOSITORY                      TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">springboot/spring-boot-docker   latest              99ce9468da74        6 seconds ago       117.5 MB</span><br></pre></td></tr></table></figure><p><code>springboot/spring-boot-docker</code> å°±æ˜¯æˆ‘ä»¬æ„å»ºå¥½çš„é•œåƒï¼Œä¸‹ä¸€æ­¥å°±æ˜¯è¿è¡Œè¯¥é•œåƒ</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker run -p 8080:8080 -t springboot/spring-boot-docker</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°æˆ‘ä»¬æ„å»ºçš„å®¹å™¨æ­£åœ¨åœ¨è¿è¡Œï¼Œè®¿é—®æµè§ˆå™¨ï¼š<code>http://192.168.0.x:8080/</code>,è¿”å›</p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line">Hello Docker!</span><br></pre></td></tr></table></figure><p>^_^ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®°æœ¬ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> Docker </tag>
            
            <tag> Spring </tag>
            
            <tag> SpringBoot </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>RocketMQç›¸å…³æµç¨‹å›¾/åŸç†å›¾</title>
      <link href="post/3135129110/"/>
      <url>post/3135129110/</url>
      
        <content type="html"><![CDATA[<blockquote><p>è½¬è‡ªï¼š<a href="https://juejin.im/post/5d7b06596fb9a06ae61ae5e3">åç«¯ç¨‹åºå‘˜å¿…å¤‡ï¼šRocketMQç›¸å…³æµç¨‹å›¾/åŸç†å›¾</a>ï¼Œæ€•ä»¥åæ‰¾ä¸åˆ°ã€‚</p></blockquote><h2 id="RocketMQæ˜¯ä»€ä¹ˆ"><a href="#RocketMQæ˜¯ä»€ä¹ˆ" class="headerlink" title="RocketMQæ˜¯ä»€ä¹ˆ"></a>RocketMQæ˜¯ä»€ä¹ˆ</h2><p><img src="https://github.com/cayzlh/git-img-repository/raw/master/blog/2019/09/4.png" alt="RocketMQæ˜¯ä»€ä¹ˆ"></p><ul><li>æ˜¯ä¸€ä¸ªé˜Ÿåˆ—æ¨¡å‹çš„æ¶ˆæ¯ä¸­é—´ä»¶ï¼Œå…·æœ‰é«˜æ€§èƒ½ã€é«˜å¯é ã€é«˜å®æ—¶ã€åˆ†å¸ƒå¼ç‰¹ç‚¹ã€‚</li><li>Producerã€Consumerã€é˜Ÿåˆ—éƒ½å¯ä»¥åˆ†å¸ƒå¼ã€‚</li><li>Producer å‘ä¸€äº›é˜Ÿåˆ—è½®æµå‘é€æ¶ˆæ¯ï¼Œé˜Ÿåˆ—é›†åˆç§°ä¸º Topicï¼ŒConsumer å¦‚æœåšå¹¿æ’­æ¶ˆè´¹ï¼Œåˆ™ä¸€ä¸ª consumer å®ä¾‹æ¶ˆè´¹è¿™ä¸ª Topic å¯¹åº”çš„æ‰€æœ‰é˜Ÿåˆ—ï¼Œå¦‚æœåšé›†ç¾¤æ¶ˆè´¹ï¼Œåˆ™å¤šä¸ª Consumer å®ä¾‹å¹³å‡æ¶ˆè´¹è¿™ä¸ª topic å¯¹åº”çš„é˜Ÿåˆ—é›†åˆã€‚</li><li>èƒ½å¤Ÿä¿è¯ä¸¥æ ¼çš„æ¶ˆæ¯é¡ºåº</li><li>æä¾›ä¸°å¯Œçš„æ¶ˆæ¯æ‹‰å–æ¨¡å¼</li><li>é«˜æ•ˆçš„è®¢é˜…è€…æ°´å¹³æ‰©å±•èƒ½åŠ›</li><li>å®æ—¶çš„æ¶ˆæ¯è®¢é˜…æœºåˆ¶</li><li>äº¿çº§æ¶ˆæ¯å †ç§¯èƒ½åŠ›</li><li>è¾ƒå°‘çš„ä¾èµ–</li></ul><h2 id="RocketMQ-æ ¸å¿ƒç»„ä»¶å›¾"><a href="#RocketMQ-æ ¸å¿ƒç»„ä»¶å›¾" class="headerlink" title="RocketMQ æ ¸å¿ƒç»„ä»¶å›¾"></a>RocketMQ æ ¸å¿ƒç»„ä»¶å›¾</h2><p>RocketMQæ˜¯å¼€æºçš„æ¶ˆæ¯ä¸­é—´ä»¶ï¼Œå®ƒä¸»è¦ç”±<code>NameServer</code>ï¼Œ<code>Producer</code>ï¼Œ<code>Broker</code>ï¼Œ<code>Consumer</code>å››éƒ¨åˆ†æ„æˆã€‚</p><p><img src="https://github.com/cayzlh/git-img-repository/raw/master/blog/2019/09/5.png" alt="RocketMQ æ ¸å¿ƒç»„ä»¶å›¾"></p><h3 id="NameServer"><a href="#NameServer" class="headerlink" title="NameServer"></a>NameServer</h3><p>NameServerä¸»è¦è´Ÿè´£Topicå’Œè·¯ç”±ä¿¡æ¯çš„ç®¡ç†ï¼ŒåŠŸèƒ½ç±»ä¼¼Dubboçš„zookeeperã€‚</p><h3 id="Producer"><a href="#Producer" class="headerlink" title="Producer"></a>Producer</h3><p>æ¶ˆæ¯ç”Ÿäº§è€…ï¼Œè´Ÿè´£äº§ç”Ÿæ¶ˆæ¯ï¼Œä¸€èˆ¬ç”±ä¸šåŠ¡ç³»ç»Ÿè´Ÿè´£äº§ç”Ÿæ¶ˆæ¯ã€‚</p><h3 id="Broker"><a href="#Broker" class="headerlink" title="Broker"></a>Broker</h3><p>æ¶ˆæ¯ä¸­è½¬è§’è‰²ï¼Œè´Ÿè´£å­˜å‚¨æ¶ˆæ¯ï¼Œè½¬å‘æ¶ˆæ¯ã€‚</p><h3 id="Consumer"><a href="#Consumer" class="headerlink" title="Consumer"></a>Consumer</h3><p>æ¶ˆæ¯æ¶ˆè´¹è€…ï¼Œè´Ÿè´£æ¶ˆæ¯æ¶ˆè´¹ï¼Œä¸€èˆ¬æ˜¯åå°ç³»ç»Ÿè´Ÿè´£å¼‚æ­¥æ¶ˆè´¹ã€‚</p><h2 id="RokcetMQ-ç‰©ç†éƒ¨ç½²å›¾"><a href="#RokcetMQ-ç‰©ç†éƒ¨ç½²å›¾" class="headerlink" title="RokcetMQ ç‰©ç†éƒ¨ç½²å›¾"></a>RokcetMQ ç‰©ç†éƒ¨ç½²å›¾</h2><p><img src="https://github.com/cayzlh/git-img-repository/raw/master/blog/2019/09/6.png" alt="RokcetMQ ç‰©ç†éƒ¨ç½²å›¾"></p><h3 id="NameServer-1"><a href="#NameServer-1" class="headerlink" title="NameServer"></a>NameServer</h3><p>NameServeræ˜¯ä¸€ä¸ªå‡ ä¹æ— çŠ¶æ€èŠ‚ç‚¹ï¼Œå¯é›†ç¾¤éƒ¨ç½²ï¼ŒèŠ‚ç‚¹ä¹‹é—´æ— ä»»ä½•ä¿¡æ¯åŒæ­¥ã€‚</p><h3 id="Broker-1"><a href="#Broker-1" class="headerlink" title="Broker"></a>Broker</h3><p>Brokeråˆ†ä¸ºMasterä¸Slaveï¼Œä¸€ä¸ªMasterå¯ä»¥å¯¹åº”å¤šä¸ªSlaveï¼Œä½†æ˜¯ä¸€ä¸ªSlaveåªèƒ½å¯¹åº”ä¸€ä¸ªMasterï¼ŒMasterä¸Slaveçš„å¯¹åº”å…³ç³»é€šè¿‡æŒ‡å®šç›¸åŒçš„BrokerNameï¼Œä¸åŒçš„BrokerIdæ¥å®šä¹‰ï¼ŒBrokerIdä¸º0è¡¨ç¤ºMasterï¼Œé0è¡¨ç¤ºSlaveã€‚Masterä¹Ÿå¯ä»¥éƒ¨ç½²å¤šä¸ªã€‚æ¯ä¸ªBrokerä¸Name Serveré›†ç¾¤ä¸­çš„æ‰€æœ‰èŠ‚ç‚¹å»ºç«‹é•¿è¿æ¥ï¼Œå®šæ—¶æ³¨å†ŒTopicä¿¡æ¯åˆ°æ‰€æœ‰Name Serverã€‚</p><h3 id="Producer-1"><a href="#Producer-1" class="headerlink" title="Producer"></a>Producer</h3><p>Producerä¸Name Serveré›†ç¾¤ä¸­çš„å…¶ä¸­ä¸€ä¸ªèŠ‚ç‚¹ï¼ˆéšæœºé€‰æ‹©ï¼‰å»ºç«‹é•¿è¿æ¥ï¼Œå®šæœŸä»Name Serverå–Topicè·¯ç”±ä¿¡æ¯ï¼Œå¹¶å‘æä¾›TopicæœåŠ¡çš„Masterå»ºç«‹é•¿è¿æ¥ï¼Œä¸”å®šæ—¶å‘Masterå‘é€å¿ƒè·³ã€‚Producerå®Œå…¨æ— çŠ¶æ€ï¼Œå¯é›†ç¾¤éƒ¨ç½²ã€‚</p><h3 id="Consumer-1"><a href="#Consumer-1" class="headerlink" title="Consumer"></a>Consumer</h3><p>Consumerä¸Name Serveré›†ç¾¤ä¸­çš„å…¶ä¸­ä¸€ä¸ªèŠ‚ç‚¹ï¼ˆéšæœºé€‰æ‹©ï¼‰å»ºç«‹é•¿è¿æ¥ï¼Œå®šæœŸä»Name Serverå–Topicè·¯ç”±ä¿¡æ¯ï¼Œå¹¶å‘æä¾›TopicæœåŠ¡çš„Masterã€Slaveå»ºç«‹é•¿è¿æ¥ï¼Œä¸”å®šæ—¶å‘Masterã€Slaveå‘é€å¿ƒè·³ã€‚Consumeræ—¢å¯ä»¥ä»Masterè®¢é˜…æ¶ˆæ¯ï¼Œä¹Ÿå¯ä»¥ä»Slaveè®¢é˜…æ¶ˆæ¯ï¼Œè®¢é˜…è§„åˆ™ç”±Brokeré…ç½®å†³å®šã€‚</p><h2 id="RocketMQ-é€»è¾‘éƒ¨ç½²ç»“æ„"><a href="#RocketMQ-é€»è¾‘éƒ¨ç½²ç»“æ„" class="headerlink" title="RocketMQ é€»è¾‘éƒ¨ç½²ç»“æ„"></a>RocketMQ é€»è¾‘éƒ¨ç½²ç»“æ„</h2><p><img src="https://github.com/cayzlh/git-img-repository/raw/master/blog/2019/09/7.png" alt="RocketMQ é€»è¾‘éƒ¨ç½²ç»“æ„"></p><h3 id="Producer-Group"><a href="#Producer-Group" class="headerlink" title="Producer Group"></a>Producer Group</h3><p>ç”¨æ¥è¡¨ç¤ºä¸€ä¸ªå‘é€æ¶ˆæ¯åº”ç”¨ï¼Œä¸€ä¸ª Producer Group ä¸‹åŒ…å«å¤šä¸ª Producer å®ä¾‹ï¼Œå¯ä»¥æ˜¯å¤šå°æœºå™¨ï¼Œä¹Ÿå¯ä»¥ æ˜¯ä¸€å°æœºå™¨çš„å¤šä¸ªè¿›ç¨‹ï¼Œæˆ–è€…ä¸€ä¸ªè¿›ç¨‹çš„å¤šä¸ª Producer å¯¹è±¡ã€‚ä¸€ä¸ª Producer Group å¯ä»¥å‘é€å¤šä¸ª Topic æ¶ˆæ¯ï¼ŒProducer Group ä½œç”¨å¦‚ä¸‹ï¼š</p><ul><li>æ ‡è¯†ä¸€ç±» Producer</li><li>å¯ä»¥é€šè¿‡è¿ç»´å·¥å…·æŸ¥è¯¢è¿™ä¸ªå‘é€æ¶ˆæ¯åº”ç”¨ä¸‹æœ‰å¤šä¸ª Producer å®ä¾‹</li><li>å‘é€åˆ†å¸ƒå¼äº‹åŠ¡æ¶ˆæ¯æ—¶ï¼Œå¦‚æœ Producer ä¸­é€”æ„å¤–å®•æœºï¼ŒBroker ä¼šä¸»åŠ¨å›è°ƒ Producer Group å†…çš„ä»»æ„ ä¸€å°æœºå™¨æ¥ç¡®è®¤äº‹åŠ¡çŠ¶æ€ã€‚</li></ul><h3 id="Consumer-Group"><a href="#Consumer-Group" class="headerlink" title="Consumer Group"></a>Consumer Group</h3><p>ç”¨æ¥è¡¨ç¤ºä¸€ä¸ªæ¶ˆè´¹æ¶ˆæ¯åº”ç”¨ï¼Œä¸€ä¸ª Consumer Group ä¸‹åŒ…å«å¤šä¸ª Consumer å®ä¾‹ï¼Œå¯ä»¥æ˜¯å¤šå°æœºå™¨ï¼Œä¹Ÿå¯ ä»¥æ˜¯å¤šä¸ªè¿›ç¨‹ï¼Œæˆ–è€…æ˜¯ä¸€ä¸ªè¿›ç¨‹çš„å¤šä¸ª Consumer å¯¹è±¡ã€‚ä¸€ä¸ª Consumer Group ä¸‹çš„å¤šä¸ª Consumer ä»¥å‡æ‘Š æ–¹å¼æ¶ˆè´¹æ¶ˆæ¯ï¼Œå¦‚æœè®¾ç½®ä¸ºå¹¿æ’­æ–¹å¼ï¼Œé‚£ä¹ˆè¿™ä¸ª Consumer Group ä¸‹çš„æ¯ä¸ªå®ä¾‹éƒ½æ¶ˆè´¹å…¨é‡æ•°æ®ã€‚</p><h2 id="NameServer-è·¯ç”±æ³¨å†Œã€åˆ é™¤æœºåˆ¶"><a href="#NameServer-è·¯ç”±æ³¨å†Œã€åˆ é™¤æœºåˆ¶" class="headerlink" title="NameServer è·¯ç”±æ³¨å†Œã€åˆ é™¤æœºåˆ¶"></a>NameServer è·¯ç”±æ³¨å†Œã€åˆ é™¤æœºåˆ¶</h2><p><img src="https://github.com/cayzlh/git-img-repository/raw/master/blog/2019/09/8.png" alt="NameServer è·¯ç”±æ³¨å†Œã€åˆ é™¤æœºåˆ¶"></p><ul><li>Brokeræ¯30ç§’å‘NameServerå‘é€å¿ƒè·³åŒ…ï¼Œå¿ƒè·³åŒ…ä¸­åŒ…å«topicçš„è·¯ç”±ä¿¡æ¯</li><li>NarneServer æ”¶åˆ° Broker å¿ƒè·³åŒ…å æ›´æ–° brokerLiveTable ä¸­çš„ä¿¡æ¯ï¼Œ ç‰¹åˆ«è®°å½•å¿ƒè·³æ—¶é—´ lastUpdateTime</li><li>NarneServer æ¯éš” 10s æ‰«æ brokerLiveTableï¼Œ æ£€ æµ‹è¡¨ä¸­ä¸Šæ¬¡æ”¶åˆ°å¿ƒè·³åŒ…çš„æ—¶é—´ï¼Œæ¯”è¾ƒå½“å‰æ—¶é—´ ä¸ä¸Šä¸€æ¬¡æ—¶é—´ï¼Œå¦‚æœè¶…è¿‡120sï¼Œåˆ™è®¤ä¸º broker ä¸å¯ç”¨ï¼Œç§»é™¤è·¯ç”±è¡¨ä¸­ä¸è¯¥ brokerç›¸å…³çš„æ‰€æœ‰ ä¿¡æ¯</li><li>æ¶ˆæ¯ç”Ÿäº§è€…æ‹‰å–ä¸»é¢˜çš„è·¯ç”±ä¿¡æ¯ï¼Œå³æ¶ˆæ¯ç”Ÿäº§è€…å¹¶ä¸ä¼šç«‹å³æ„ŸçŸ¥ Broker æœåŠ¡å™¨çš„æ–°å¢ä¸åˆ é™¤ã€‚</li></ul><h2 id="RocketMQçš„æ¶ˆæ¯é¢†åŸŸæ¨¡å‹å›¾"><a href="#RocketMQçš„æ¶ˆæ¯é¢†åŸŸæ¨¡å‹å›¾" class="headerlink" title="RocketMQçš„æ¶ˆæ¯é¢†åŸŸæ¨¡å‹å›¾"></a>RocketMQçš„æ¶ˆæ¯é¢†åŸŸæ¨¡å‹å›¾</h2><p><img src="https://github.com/cayzlh/git-img-repository/raw/master/blog/2019/09/9.png" alt="RocketMQçš„æ¶ˆæ¯é¢†åŸŸæ¨¡å‹å›¾"></p><h3 id="Topic"><a href="#Topic" class="headerlink" title="Topic"></a>Topic</h3><ul><li>Topicè¡¨ç¤ºæ¶ˆæ¯çš„ç¬¬ä¸€çº§ç±»å‹ï¼Œæ¯”å¦‚ä¸€ä¸ªç”µå•†ç³»ç»Ÿçš„æ¶ˆæ¯å¯ä»¥åˆ†ä¸ºï¼šäº¤æ˜“æ¶ˆæ¯ã€ç‰©æµæ¶ˆæ¯ç­‰ã€‚ä¸€æ¡æ¶ˆæ¯å¿…é¡»æœ‰ä¸€ä¸ªTopicã€‚</li><li>æœ€ç»†ç²’åº¦çš„è®¢é˜…å•ä½ï¼Œä¸€ä¸ªGroupå¯ä»¥è®¢é˜…å¤šä¸ªTopicçš„æ¶ˆæ¯ã€‚</li></ul><h3 id="Tag"><a href="#Tag" class="headerlink" title="Tag"></a>Tag</h3><p>Tagè¡¨ç¤ºæ¶ˆæ¯çš„ç¬¬äºŒçº§ç±»å‹ï¼Œæ¯”å¦‚äº¤æ˜“æ¶ˆæ¯åˆå¯ä»¥åˆ†ä¸ºï¼šäº¤æ˜“åˆ›å»ºæ¶ˆæ¯ï¼Œäº¤æ˜“å®Œæˆæ¶ˆæ¯ç­‰ã€‚RocketMQæä¾›2çº§æ¶ˆæ¯åˆ†ç±»ï¼Œæ–¹ä¾¿çµæ´»æ§åˆ¶ã€‚</p><h3 id="Group"><a href="#Group" class="headerlink" title="Group"></a>Group</h3><p>ç»„ï¼Œä¸€ä¸ªç»„å¯ä»¥è®¢é˜…å¤šä¸ªTopicã€‚</p><h3 id="Message-Queue"><a href="#Message-Queue" class="headerlink" title="Message Queue"></a>Message Queue</h3><p>æ¶ˆæ¯çš„ç‰©ç†ç®¡ç†å•ä½ã€‚ä¸€ä¸ªTopicä¸‹å¯ä»¥æœ‰å¤šä¸ªQueueï¼ŒQueueçš„å¼•å…¥ä½¿å¾—æ¶ˆæ¯çš„å­˜å‚¨å¯ä»¥åˆ†å¸ƒå¼é›†ç¾¤åŒ–ï¼Œå…·æœ‰äº†æ°´å¹³æ‰©å±•èƒ½åŠ›ã€‚</p><p>åœ¨ RocketMQ ä¸­ï¼Œæ‰€æœ‰æ¶ˆæ¯é˜Ÿåˆ—éƒ½æ˜¯æŒä¹…åŒ–ï¼Œé•¿åº¦æ— é™çš„æ•°æ®ç»“æ„ï¼Œæ‰€è°“é•¿åº¦æ— é™æ˜¯æŒ‡é˜Ÿåˆ—ä¸­çš„æ¯ä¸ªå­˜å‚¨å•å…ƒéƒ½æ˜¯å®šé•¿ï¼Œè®¿é—®å…¶ä¸­çš„å­˜å‚¨å•å…ƒä½¿ç”¨ Offset æ¥è®¿é—®ï¼Œoffset ä¸º java long ç±»å‹ï¼Œ64 ä½ï¼Œç†è®ºä¸Šåœ¨ 100å¹´å†…ä¸ä¼šæº¢å‡ºï¼Œæ‰€ä»¥è®¤ä¸ºæ˜¯é•¿åº¦æ— é™ã€‚</p><p>ä¹Ÿå¯ä»¥è®¤ä¸º Message Queue æ˜¯ä¸€ä¸ªé•¿åº¦æ— é™çš„æ•°ç»„ï¼ŒOffset å°±æ˜¯ä¸‹æ ‡ã€‚</p><h2 id="é¡ºåºæ¶ˆæ¯åŸç†å›¾"><a href="#é¡ºåºæ¶ˆæ¯åŸç†å›¾" class="headerlink" title="é¡ºåºæ¶ˆæ¯åŸç†å›¾"></a>é¡ºåºæ¶ˆæ¯åŸç†å›¾</h2><p><img src="https://github.com/cayzlh/git-img-repository/raw/master/blog/2019/09/10.png" alt="é¡ºåºæ¶ˆæ¯åŸç†å›¾"></p><p>æ¶ˆè´¹æ¶ˆæ¯çš„é¡ºåºè¦åŒå‘é€æ¶ˆæ¯çš„é¡ºåºä¸€è‡´ï¼Œåœ¨ RocketMQ ä¸­ï¼Œä¸»è¦çš„æ˜¯å±€éƒ¨é¡ºåºï¼Œå³ä¸€ç±»æ¶ˆæ¯ä¸ºæ»¡è¶³é¡º åºæ€§ï¼Œå¿…é¡» Producer å•çº¿ç¨‹é¡ºåºå‘é€ï¼Œä¸”å‘é€åˆ°åŒä¸€ä¸ªé˜Ÿåˆ—ï¼Œè¿™æ · Consumer å°±å¯ä»¥æŒ‰ç…§ Producer æ”¶é€ çš„é¡ºåºå»æ¶ˆè´¹æ¶ˆæ¯ã€‚</p><h2 id="RocketMQ-æ¶ˆæ¯å­˜å‚¨è®¾è®¡åŸç†å›¾"><a href="#RocketMQ-æ¶ˆæ¯å­˜å‚¨è®¾è®¡åŸç†å›¾" class="headerlink" title="RocketMQ æ¶ˆæ¯å­˜å‚¨è®¾è®¡åŸç†å›¾"></a>RocketMQ æ¶ˆæ¯å­˜å‚¨è®¾è®¡åŸç†å›¾</h2><p><img src="https://github.com/cayzlh/git-img-repository/raw/master/blog/2019/09/11.png" alt="RocketMQ æ¶ˆæ¯å­˜å‚¨è®¾è®¡åŸç†å›¾"></p><h3 id="CommitLog"><a href="#CommitLog" class="headerlink" title="CommitLog"></a>CommitLog</h3><p>æ¶ˆæ¯å­˜å‚¨æ–‡ä»¶ï¼Œæ‰€æœ‰æ¶ˆæ¯ä¸»é¢˜çš„æ¶ˆæ¯éƒ½å­˜å‚¨åœ¨ CommitLog æ–‡ä»¶ä¸­ã€‚ Commitlog æ–‡ä»¶å­˜å‚¨çš„é€»è¾‘è§†å›¾å¦‚å›¾æ‰€ç¤º</p><p><img src="https://github.com/cayzlh/git-img-repository/raw/master/blog/2019/09/12.png" alt="CommitLog"></p><h3 id="ConsumeQueue"><a href="#ConsumeQueue" class="headerlink" title="ConsumeQueue"></a>ConsumeQueue</h3><p>æ¶ˆæ¯æ¶ˆè´¹é˜Ÿåˆ—ï¼Œæ¶ˆæ¯åˆ°è¾¾ CommitLog æ–‡ä»¶åï¼Œå°†å¼‚æ­¥è½¬å‘åˆ°æ¶ˆæ¯ æ¶ˆè´¹é˜Ÿåˆ—ï¼Œä¾›æ¶ˆæ¯æ¶ˆè´¹è€…æ¶ˆè´¹ã€‚ConsumeQueueå­˜å‚¨æ ¼å¼å¦‚ä¸‹ï¼š</p><p><img src="https://github.com/cayzlh/git-img-repository/raw/master/blog/2019/09/13.png" alt="ConsumeQueue"></p><ul><li>å•ä¸ª ConsumeQueue æ–‡ä»¶ä¸­é»˜è®¤åŒ…å« 30 ä¸‡ä¸ªæ¡ç›®ï¼Œå•ä¸ªæ–‡ä»¶çš„é•¿åº¦ä¸º 30w Ã— 20 å­—èŠ‚ï¼Œ å•ä¸ª ConsumeQueue æ–‡ä»¶å¯ä»¥çœ‹å‡ºæ˜¯ä¸€ä¸ª ConsumeQueue æ¡ç›®çš„æ•°ç»„ï¼Œå…¶ä¸‹æ ‡ä¸º ConsumeQueue çš„é€»è¾‘åç§»é‡ï¼Œæ¶ˆæ¯æ¶ˆè´¹è¿›åº¦å­˜å‚¨çš„åç§»é‡ å³é€»è¾‘åç§»é‡ã€‚</li><li>ConsumeQueue å³ä¸º Commitlog æ–‡ä»¶çš„ç´¢å¼•æ–‡ä»¶ï¼Œ å…¶æ„å»ºæœºåˆ¶æ˜¯å½“æ¶ˆæ¯åˆ°è¾¾ Commitlog æ–‡ä»¶åï¼Œ ç”±ä¸“é—¨çš„çº¿ç¨‹ äº§ç”Ÿæ¶ˆæ¯è½¬å‘ä»»åŠ¡ï¼Œä»è€Œæ„å»ºæ¶ˆæ¯æ¶ˆè´¹é˜Ÿåˆ—æ–‡ä»¶ä¸ä¸‹æ–‡æåˆ°çš„ç´¢å¼•æ–‡ä»¶ã€‚</li></ul><h3 id="IndexFile"><a href="#IndexFile" class="headerlink" title="IndexFile"></a>IndexFile</h3><p>æ¶ˆæ¯ç´¢å¼•æ–‡ä»¶ï¼Œä¸»è¦å­˜å‚¨æ¶ˆæ¯ Key ä¸ Offset çš„å¯¹åº”å…³ç³»ã€‚</p><p>æ¶ˆæ¯æ¶ˆè´¹é˜Ÿåˆ—æ˜¯RocketMQä¸“é—¨ä¸ºæ¶ˆæ¯è®¢é˜…æ„å»ºçš„ç´¢å¼•æ–‡ä»¶ï¼Œæé«˜æ ¹æ®ä¸»é¢˜ä¸æ¶ˆæ¯é˜Ÿ åˆ—æ£€ç´¢æ¶ˆæ¯çš„é€Ÿåº¦ ï¼Œå¦å¤– RocketMQ å¼•å…¥äº† Hash ç´¢å¼•æœºåˆ¶ä¸ºæ¶ˆæ¯å»ºç«‹ç´¢å¼•ï¼Œ HashMap çš„è®¾ è®¡åŒ…å«ä¸¤ä¸ªåŸºæœ¬ç‚¹ ï¼š Hash æ§½ä¸ Hash å†²çªçš„é“¾è¡¨ç»“æ„ã€‚ RocketMQ ç´¢å¼•æ–‡ä»¶å¸ƒå±€å¦‚å›¾æ‰€ç¤º</p><p><img src="https://github.com/cayzlh/git-img-repository/raw/master/blog/2019/09/14.png" alt="IndexFile"></p><p>lndexFile æ€»å…±åŒ…å« lndexHeaderã€ Hash æ§½ã€ Hash æ¡ç›®</p><h3 id="äº‹åŠ¡çŠ¶æ€æœåŠ¡"><a href="#äº‹åŠ¡çŠ¶æ€æœåŠ¡" class="headerlink" title="äº‹åŠ¡çŠ¶æ€æœåŠ¡"></a>äº‹åŠ¡çŠ¶æ€æœåŠ¡</h3><p>å­˜å‚¨æ¯æ¡æ¶ˆæ¯çš„äº‹åŠ¡çŠ¶æ€ã€‚</p><h3 id="å®šæ—¶æ¶ˆæ¯æœåŠ¡"><a href="#å®šæ—¶æ¶ˆæ¯æœåŠ¡" class="headerlink" title="å®šæ—¶æ¶ˆæ¯æœåŠ¡"></a>å®šæ—¶æ¶ˆæ¯æœåŠ¡</h3><p>æ¯ä¸€ä¸ªå»¶è¿Ÿçº§åˆ«å¯¹åº”ä¸€ä¸ªæ¶ˆæ¯æ¶ˆè´¹é˜Ÿåˆ—ï¼Œå­˜å‚¨å»¶è¿Ÿé˜Ÿåˆ—çš„æ¶ˆæ¯æ‹‰å–è¿›åº¦ã€‚</p><h2 id="RMQæ–‡ä»¶å­˜å‚¨æ¨¡å‹å±‚"><a href="#RMQæ–‡ä»¶å­˜å‚¨æ¨¡å‹å±‚" class="headerlink" title="RMQæ–‡ä»¶å­˜å‚¨æ¨¡å‹å±‚"></a>RMQæ–‡ä»¶å­˜å‚¨æ¨¡å‹å±‚</h2><p><img src="https://github.com/cayzlh/git-img-repository/raw/master/blog/2019/09/15.png" alt="RMQæ–‡ä»¶å­˜å‚¨æ¨¡å‹å±‚"></p><h3 id="RocketMQä¸šåŠ¡å¤„ç†å™¨å±‚"><a href="#RocketMQä¸šåŠ¡å¤„ç†å™¨å±‚" class="headerlink" title="RocketMQä¸šåŠ¡å¤„ç†å™¨å±‚"></a>RocketMQä¸šåŠ¡å¤„ç†å™¨å±‚</h3><p>Brokerç«¯å¯¹æ¶ˆæ¯è¿›è¡Œè¯»å–å’Œå†™å…¥çš„ä¸šåŠ¡é€»è¾‘å…¥å£ï¼Œè¿™ä¸€å±‚ä¸»è¦åŒ…å«äº†ä¸šåŠ¡é€»è¾‘ç›¸å…³å¤„ç†æ“ä½œï¼ˆæ ¹æ®è§£æRemotingCommandä¸­çš„RequestCodeæ¥åŒºåˆ†å…·ä½“çš„ä¸šåŠ¡æ“ä½œç±»å‹ï¼Œè¿›è€Œæ‰§è¡Œä¸åŒçš„ä¸šåŠ¡å¤„ç†æµç¨‹ï¼‰ï¼Œæ¯”å¦‚å‰ç½®çš„æ£€æŸ¥å’Œæ ¡éªŒæ­¥éª¤ã€æ„é€ MessageExtBrokerInnerå¯¹è±¡ã€decodeååºåˆ—åŒ–ã€æ„é€ Responseè¿”å›å¯¹è±¡ç­‰ã€‚</p><h3 id="RocketMQæ•°æ®å­˜å‚¨ç»„ä»¶å±‚"><a href="#RocketMQæ•°æ®å­˜å‚¨ç»„ä»¶å±‚" class="headerlink" title="RocketMQæ•°æ®å­˜å‚¨ç»„ä»¶å±‚"></a>RocketMQæ•°æ®å­˜å‚¨ç»„ä»¶å±‚</h3><ul><li>è¯¥å±‚ä¸»è¦æ˜¯RocketMQçš„å­˜å‚¨æ ¸å¿ƒç±»â€”DefaultMessageStoreï¼Œå…¶ä¸ºRocketMQæ¶ˆæ¯æ•°æ®æ–‡ä»¶çš„è®¿é—®å…¥å£ï¼Œé€šè¿‡è¯¥ç±»çš„â€œputMessage()â€å’Œâ€œgetMessage()â€æ–¹æ³•å®Œæˆå¯¹CommitLogæ¶ˆæ¯å­˜å‚¨çš„æ—¥å¿—æ•°æ®æ–‡ä»¶è¿›è¡Œè¯»å†™æ“ä½œï¼ˆå…·ä½“çš„è¯»å†™è®¿é—®æ“ä½œè¿˜æ˜¯ä¾èµ–ä¸‹ä¸€å±‚ä¸­CommitLogå¯¹è±¡æ¨¡å‹æä¾›çš„æ–¹æ³•ï¼‰ï¼›</li><li>å¦å¤–ï¼Œåœ¨è¯¥ç»„ä»¶åˆå§‹åŒ–æ—¶å€™ï¼Œè¿˜ä¼šå¯åŠ¨å¾ˆå¤šå­˜å‚¨ç›¸å…³çš„åå°æœåŠ¡çº¿ç¨‹ï¼ŒåŒ…æ‹¬AllocateMappedFileServiceï¼ˆMappedFileé¢„åˆ†é…æœåŠ¡çº¿ç¨‹ï¼‰ã€ReputMessageServiceï¼ˆå›æ”¾å­˜å‚¨æ¶ˆæ¯æœåŠ¡çº¿ç¨‹ï¼‰ã€HAServiceï¼ˆBrokerä¸»ä»åŒæ­¥é«˜å¯ç”¨æœåŠ¡çº¿ç¨‹ï¼‰ã€StoreStatsServiceï¼ˆæ¶ˆæ¯å­˜å‚¨ç»Ÿè®¡æœåŠ¡çº¿ç¨‹ï¼‰ã€IndexServiceï¼ˆç´¢å¼•æ–‡ä»¶æœåŠ¡çº¿ç¨‹ï¼‰ç­‰ã€‚</li></ul><h3 id="RocketMQå­˜å‚¨é€»è¾‘å¯¹è±¡å±‚"><a href="#RocketMQå­˜å‚¨é€»è¾‘å¯¹è±¡å±‚" class="headerlink" title="RocketMQå­˜å‚¨é€»è¾‘å¯¹è±¡å±‚"></a>RocketMQå­˜å‚¨é€»è¾‘å¯¹è±¡å±‚</h3><ul><li>è¯¥å±‚ä¸»è¦åŒ…å«äº†RocketMQæ•°æ®æ–‡ä»¶å­˜å‚¨ç›´æ¥ç›¸å…³çš„ä¸‰ä¸ªæ¨¡å‹ç±»IndexFileã€ConsumerQueueå’ŒCommitLogã€‚</li><li>IndexFileä¸ºç´¢å¼•æ•°æ®æ–‡ä»¶æä¾›è®¿é—®æœåŠ¡ï¼ŒConsumerQueueä¸ºé€»è¾‘æ¶ˆæ¯é˜Ÿåˆ—æä¾›è®¿é—®æœåŠ¡ï¼ŒCommitLogåˆ™ä¸ºæ¶ˆæ¯å­˜å‚¨çš„æ—¥å¿—æ•°æ®æ–‡ä»¶æä¾›è®¿é—®æœåŠ¡ã€‚</li><li>è¿™ä¸‰ä¸ªæ¨¡å‹ç±»ä¹Ÿæ˜¯æ„æˆäº†RocketMQå­˜å‚¨å±‚çš„æ•´ä½“ç»“æ„ã€‚</li></ul><h3 id="å°è£…çš„æ–‡ä»¶å†…å­˜æ˜ å°„å±‚"><a href="#å°è£…çš„æ–‡ä»¶å†…å­˜æ˜ å°„å±‚" class="headerlink" title="å°è£…çš„æ–‡ä»¶å†…å­˜æ˜ å°„å±‚"></a>å°è£…çš„æ–‡ä»¶å†…å­˜æ˜ å°„å±‚</h3><ul><li>RocketMQä¸»è¦é‡‡ç”¨JDK NIOä¸­çš„MappedByteBufferå’ŒFileChannelä¸¤ç§æ–¹å¼å®Œæˆæ•°æ®æ–‡ä»¶çš„è¯»å†™ã€‚</li><li>å…¶ä¸­ï¼Œé‡‡ç”¨MappedByteBufferè¿™ç§å†…å­˜æ˜ å°„ç£ç›˜æ–‡ä»¶çš„æ–¹å¼å®Œæˆå¯¹å¤§æ–‡ä»¶çš„è¯»å†™ï¼Œåœ¨RocketMQä¸­å°†è¯¥ç±»å°è£…æˆMappedFileç±»ã€‚</li><li>è¿™é‡Œï¼Œæ¯ä¸€ç§ç±»çš„å•ä¸ªæ–‡ä»¶å‡ç”±MappedFileç±»æä¾›è¯»å†™æ“ä½œæœåŠ¡ï¼ˆå…¶ä¸­ï¼ŒMappedFileç±»æä¾›äº†é¡ºåºå†™/éšæœºè¯»ã€å†…å­˜æ•°æ®åˆ·ç›˜ã€å†…å­˜æ¸…ç†ç­‰å’Œæ–‡ä»¶ç›¸å…³çš„æœåŠ¡ï¼‰ã€‚</li></ul><h3 id="ç£ç›˜å­˜å‚¨å±‚"><a href="#ç£ç›˜å­˜å‚¨å±‚" class="headerlink" title="ç£ç›˜å­˜å‚¨å±‚"></a>ç£ç›˜å­˜å‚¨å±‚</h3><p>ä¸»è¦æŒ‡çš„æ˜¯éƒ¨ç½²RocketMQæœåŠ¡å™¨æ‰€ç”¨çš„ç£ç›˜ã€‚è¿™é‡Œï¼Œéœ€è¦è€ƒè™‘ä¸åŒç£ç›˜ç±»å‹ï¼ˆå¦‚SSDæˆ–è€…æ™®é€šçš„HDDï¼‰ç‰¹æ€§ä»¥åŠç£ç›˜çš„æ€§èƒ½å‚æ•°ï¼ˆå¦‚IOPSã€ååé‡å’Œè®¿é—®æ—¶å»¶ç­‰æŒ‡æ ‡ï¼‰å¯¹é¡ºåºå†™/éšæœºè¯»æ“ä½œå¸¦æ¥çš„å½±å“ã€‚</p><h2 id="RocketMQä¸­æ¶ˆæ¯åˆ·ç›˜"><a href="#RocketMQä¸­æ¶ˆæ¯åˆ·ç›˜" class="headerlink" title="RocketMQä¸­æ¶ˆæ¯åˆ·ç›˜"></a>RocketMQä¸­æ¶ˆæ¯åˆ·ç›˜</h2><p>åœ¨RocketMQä¸­æ¶ˆæ¯åˆ·ç›˜ä¸»è¦å¯ä»¥åˆ†ä¸ºåŒæ­¥åˆ·ç›˜å’Œå¼‚æ­¥åˆ·ç›˜ä¸¤ç§ã€‚</p><h3 id="åŒæ­¥åˆ·ç›˜"><a href="#åŒæ­¥åˆ·ç›˜" class="headerlink" title="åŒæ­¥åˆ·ç›˜"></a>åŒæ­¥åˆ·ç›˜</h3><p><img src="https://github.com/cayzlh/git-img-repository/raw/master/blog/2019/09/16.png" alt="åŒæ­¥åˆ·ç›˜"></p><ul><li>åœ¨è¿”å›å†™æˆåŠŸçŠ¶æ€æ—¶ï¼Œæ¶ˆæ¯å·²ç»è¢«å†™å…¥ç£ç›˜ã€‚</li><li>å…·ä½“æµç¨‹æ˜¯ï¼Œæ¶ˆæ¯å†™å…¥å†…å­˜çš„PAGECACHEåï¼Œç«‹åˆ»é€šçŸ¥åˆ·ç›˜çº¿ç¨‹åˆ·ç›˜ï¼Œç„¶åç­‰å¾…åˆ·ç›˜å®Œæˆï¼Œåˆ·ç›˜çº¿ç¨‹æ‰§è¡Œå®Œæˆåå”¤é†’ç­‰å¾…çš„çº¿ç¨‹ï¼Œè¿”å›æ¶ˆæ¯å†™æˆåŠŸçš„çŠ¶æ€ã€‚</li><li>ä¸€èˆ¬åªç”¨äºé‡‘èåœºæ™¯ã€‚</li></ul><h3 id="å¼‚æ­¥åˆ·ç›˜"><a href="#å¼‚æ­¥åˆ·ç›˜" class="headerlink" title="å¼‚æ­¥åˆ·ç›˜"></a>å¼‚æ­¥åˆ·ç›˜</h3><p><img src="https://github.com/cayzlh/git-img-repository/raw/master/blog/2019/09/17.png" alt="å¼‚æ­¥åˆ·ç›˜"></p><p>åœ¨è¿”å›å†™æˆåŠŸçŠ¶æ€æ—¶ï¼Œæ¶ˆæ¯å¯èƒ½åªæ˜¯è¢«å†™å…¥äº†å†…å­˜çš„PAGECACHEï¼Œå†™æ“ä½œçš„è¿”å›å¿«ï¼Œååé‡å¤§ï¼›å½“å†…å­˜é‡Œçš„æ¶ˆæ¯é‡ç§¯ç´¯åˆ°ä¸€å®šç¨‹åº¦æ—¶ï¼Œç»Ÿä¸€è§¦å‘å†™ç£ç›˜æ“ä½œï¼Œå¿«é€Ÿå†™å…¥ã€‚</p><h2 id="æ¶ˆæ¯åœ¨ç³»ç»Ÿä¸­æµè½¬å›¾"><a href="#æ¶ˆæ¯åœ¨ç³»ç»Ÿä¸­æµè½¬å›¾" class="headerlink" title="æ¶ˆæ¯åœ¨ç³»ç»Ÿä¸­æµè½¬å›¾"></a>æ¶ˆæ¯åœ¨ç³»ç»Ÿä¸­æµè½¬å›¾</h2><p><img src="https://github.com/cayzlh/git-img-repository/raw/master/blog/2019/09/18.png" alt="æ¶ˆæ¯åœ¨ç³»ç»Ÿä¸­æµè½¬å›¾"></p><p>1ã€Producer å‘é€æ¶ˆæ¯ï¼Œæ¶ˆæ¯ä» socket è¿›å…¥ java å †ã€‚</p><p>2ã€Producer å‘é€æ¶ˆæ¯ï¼Œæ¶ˆæ¯ä» java å †è½¬å…¥ PAGACACHEï¼Œç‰©ç†å†…å­˜ã€‚</p><p>3ã€Producer å‘é€æ¶ˆæ¯ï¼Œç”±å¼‚æ­¥çº¿ç¨‹åˆ·ç›˜ï¼Œæ¶ˆæ¯ä» PAGECACHE åˆ·å…¥ç£ç›˜ã€‚</p><p>4ã€Consumer æ‹‰æ¶ˆæ¯ï¼ˆæ­£å¸¸æ¶ˆè´¹ï¼‰ï¼Œæ¶ˆæ¯ç›´æ¥ä» PAGECACHEï¼ˆæ•°æ®åœ¨ç‰©ç†å†…å­˜ï¼‰è½¬å…¥ socketï¼Œåˆ°è¾¾ consumerï¼Œ ä¸ç»è¿‡ java å †ã€‚è¿™ç§æ¶ˆè´¹åœºæ™¯æœ€å¤šï¼Œçº¿ä¸Š 96G ç‰©ç†å†…å­˜ï¼ŒæŒ‰ç…§ 1K æ¶ˆæ¯ç®—ï¼Œå¯ä»¥åœ¨ç‰©ç†å†…å­˜ç¼“å­˜ 1 äº¿æ¡æ¶ˆ æ¯ã€‚</p><p>5ã€Consumer æ‹‰æ¶ˆæ¯ï¼ˆå¼‚å¸¸æ¶ˆè´¹ï¼‰ï¼Œæ¶ˆæ¯ç›´æ¥ä» PAGECACHEï¼ˆæ•°æ®åœ¨è™šæ‹Ÿå†…å­˜ï¼‰è½¬å…¥ socketã€‚</p><p>6ã€Consumer æ‹‰æ¶ˆæ¯ï¼ˆå¼‚å¸¸æ¶ˆè´¹ï¼‰ï¼Œç”±äº Socket è®¿é—®äº†è™šæ‹Ÿå†…å­˜ï¼Œäº§ç”Ÿç¼ºé¡µä¸­æ–­ï¼Œæ­¤æ—¶ä¼šäº§ç”Ÿç£ç›˜ IOï¼Œä»ç£ ç›˜ Load æ¶ˆæ¯åˆ° PAGECACHEï¼Œç„¶åç›´æ¥ä» socket å‘å‡ºå»ã€‚</p><p>7ã€åŒ 5 ä¸€è‡´ã€‚</p><p>8ã€åŒ 6 ä¸€è‡´ã€‚</p><hr><p>^_^.</p>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®°æœ¬ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ¶ˆæ¯é˜Ÿåˆ— </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Gsonç®€æ˜“æŒ‡å—</title>
      <link href="post/2680260790/"/>
      <url>post/2680260790/</url>
      
        <content type="html"><![CDATA[<h2 id="Gsonç®€ä»‹"><a href="#Gsonç®€ä»‹" class="headerlink" title="Gsonç®€ä»‹"></a>Gsonç®€ä»‹</h2><p>åœ¨æ­£å¼ä»‹ç» Gson ä¹‹å‰ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆä»<a href="https://link.juejin.im/?target=https://github.com/google/gson/blob/master/UserGuide.md%23TOC-Overview">å®˜æ–¹çš„wiki</a>çœ‹ä¸‹ Gson çš„æè¿°ï¼Œäº†è§£å®ƒæ˜¯ä»€ä¹ˆï¼Ÿ</p><blockquote><p>Gson is a Java library that can be used to convert Java Objects into their JSON representation. It can also be used to convert a JSON string to an equivalent Java objectã€‚</p></blockquote><p>ä»æè¿°å¯ä»¥çœ‹å‡ºï¼ŒGson æ˜¯ç”¨äºå°† Java å¯¹è±¡ä¸ JSONæ ¼å¼å­—ç¬¦ä¸²æ•°æ®ç›¸äº’è½¬æ¢çš„ Java åº“ã€‚å®ƒèµ·åˆåœ¨Google å†…éƒ¨å¹¿æ³›ä½¿ç”¨åœ¨ Android å¹³å° å’Œ Java æœåŠ¡ç«¯ä¸Šã€‚2008 å¹´å¼€æºä¹‹åï¼Œæˆä¸ºäº†è°·æ­Œåˆä¸€ä¸ªè¢«å¹¿æ³›ä½¿ç”¨çš„å¼€æºæ¡†æ¶ï¼Œæˆªæ­¢ç›®å‰*(2019.09.08)* åœ¨GitHub ä¸Šå·²æœ‰1W6 å¤šæ˜Ÿï¼Œç›¸åŒä½œç”¨çš„ç±»åº“è¿˜æœ‰ Spring Framework ä¸­é›†æˆçš„ Jacksonï¼Œä»¥åŠé˜¿é‡Œå¼€æºçš„ fastjsonç­‰ã€‚</p><p>åœ¨ç‰¹æ€§æ–¹é¢ï¼ŒGson æä¾›ç®€æ˜“çš„API <code>fromJson/toJson</code> æ¥å®ç° Java ä¸ JSON ä¹‹é—´çš„è½¬æ¢ï¼Œå¹¶ä¸”èƒ½ç”Ÿæˆç´§å‡‘ï¼Œå¯è¯»çš„ JSON å­—ç¬¦ä¸²è¾“å‡ºï¼Œè¿˜æ”¯æŒå¤æ‚å¯¹è±¡è½¬æ¢å’Œä¸°å¯Œçš„è‡ªå®šä¹‰è¡¨ç¤ºï¼Œè¶³ä»¥æ»¡è¶³åœ¨æ—¥å¸¸å¼€å‘ä¸­æˆ‘ä»¬ç»å¤§éƒ¨åˆ†çš„ JSON æ•°æ®å¤„ç†éœ€æ±‚ã€‚</p><blockquote><p>é€šå¸¸å°†å¯¹è±¡ä¸JSONå­—ç¬¦ä¸²é—´çš„è½¬æ¢ç§°ä¹‹ä¸ºåºåˆ—åŒ–å’Œååºåˆ—åŒ–(Serialization/Deserialization)ã€‚å°† å¯¹è±¡è½¬åŒ–æˆ JSONå­—ç¬¦ä¸²çš„è¿‡ç¨‹ç§°ä¸ºåºåˆ—åŒ–ï¼Œå°†JSON å­—ç¬¦ä¸²è½¬åŒ–æˆå¯¹è±¡çš„è¿‡ç¨‹ç§°ä¸ºååºåˆ—åŒ–ã€‚</p></blockquote><h2 id="GsonåŸºæœ¬ä½¿ç”¨"><a href="#GsonåŸºæœ¬ä½¿ç”¨" class="headerlink" title="GsonåŸºæœ¬ä½¿ç”¨"></a>GsonåŸºæœ¬ä½¿ç”¨</h2><p>ä½¿ç”¨ Gson æ¡†æ¶è¿›è¡Œåºåˆ—åŒ–ä¸ååºåˆ—æ“ä½œï¼Œéƒ½ç¦»ä¸å¼€ <code>com.google.gson.Gson</code> å¯¹è±¡ï¼Œå®ƒä¹Ÿæ˜¯ Gson æ¡†æ¶çš„å…³é”®å¯¹è±¡ï¼Œæä¾›çš„å…¬å…± API å…·å¤‡äº†å¤šç§åºåˆ—åŒ–å’Œååºåˆ—æ–¹å¼ã€‚</p><p>Gson å¯¹è±¡çš„åˆ›å»ºä¸»è¦æœ‰ä¸¤ç§æ–¹å¼ï¼š</p><ul><li>ä½¿ç”¨ <strong>new</strong> å…³é”®å­—ç›´æ¥åˆ›å»ºï¼š<code>Gson gson = new Gson()</code></li><li>ç”± <code>GsonBuilder</code> å¯¹è±¡æ„å»ºï¼š<code>Gson gson = new GsonBuilder().create()</code></li></ul><p>é€šå¸¸æƒ…å†µä¸‹ï¼Œä¸Šé¢ä¸¤ç§æ–¹å¼åˆ›å»ºçš„ Gson å¯¹è±¡åœ¨è¿›è¡Œåºåˆ—åŒ–ä¸ååºåˆ—æ“ä½œæ—¶è¡Œä¸ºéƒ½æ˜¯ä¸€æ ·çš„ï¼Œä½†æ˜¯ç¬¬äºŒç§æ–¹å¼æ„å»º Gson å¯¹è±¡æ—¶ï¼Œå…è®¸è¿›è¡Œé¢å¤–çš„è¡Œä¸ºå®šåˆ¶ï¼Œæ¯”å¦‚æ ¼å¼åŒ– JSON å­—ç¬¦ä¸²çš„è¾“å‡ºå†…å®¹ï¼Œæ˜¯å¦åºåˆ—åŒ– <strong>null</strong> å€¼ç­‰ç­‰ã€‚</p><h3 id="Javaåºåˆ—åŒ–"><a href="#Javaåºåˆ—åŒ–" class="headerlink" title="Javaåºåˆ—åŒ–"></a>Javaåºåˆ—åŒ–</h3><h4 id="ç®€å•å¯¹è±¡çš„åºåˆ—åŒ–"><a href="#ç®€å•å¯¹è±¡çš„åºåˆ—åŒ–" class="headerlink" title="ç®€å•å¯¹è±¡çš„åºåˆ—åŒ–"></a>ç®€å•å¯¹è±¡çš„åºåˆ—åŒ–</h4><p>é€šè¿‡ä¸‹é¢çš„ä¾‹å­æ¥çœ‹ä¸‹é€šè¿‡ä¸Šè¿°ä¸¤ç§æ–¹å¼åºåˆ—åŒ– Java å¯¹è±¡çš„ä¸åŒæ•ˆæœï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ResultTest</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">test_serialization</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Gson gson = <span class="keyword">new</span> Gson();</span><br><span class="line">        Result result = <span class="keyword">new</span> Result(<span class="number">200</span>, <span class="string">&quot;æˆåŠŸ&quot;</span>, <span class="keyword">null</span>);</span><br><span class="line">        String json = gson.toJson(result);</span><br><span class="line">        System.out.println(<span class="string">&quot;json is &quot;</span> + json);</span><br><span class="line">      </span><br><span class="line">        Gson buildedGson = <span class="keyword">new</span> GsonBuilder().setPrettyPrinting().serializeNulls().create();</span><br><span class="line">        String buildedJson = buildedGson.toJson(result);</span><br><span class="line">        System.out.println(<span class="string">&quot;buildedJson is &quot;</span> + buildedJson);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Result</span> </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">int</span> code;</span><br><span class="line">        <span class="keyword">private</span> String message;</span><br><span class="line">        <span class="keyword">private</span> Object data;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">Result</span><span class="params">(<span class="keyword">int</span> code, String message, Object data)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.code = code;</span><br><span class="line">            <span class="keyword">this</span>.message = message;</span><br><span class="line">            <span class="keyword">this</span>.data = data;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»ç»“æœå¯ä»¥çœ‹å‡ºï¼Œé»˜è®¤çš„ Gson å¯¹è±¡è¡Œä¸ºåºåˆ—åŒ–å¯¹è±¡æ—¶ä¼šå°† <code>null</code> å€¼çš„å­—æ®µå¿½ç•¥ï¼Œè€Œ <code>com.google.gson.GsonBuilder#serializeNulls</code> æ–¹æ³•å°†å…è®¸ Gson å¯¹è±¡åºåˆ—åŒ– <code>null</code> å­—æ®µï¼›å¹¶ä¸”æ­£å¸¸åºåˆ—åŒ–åçš„ JSON å­—ç¬¦ä¸²æ˜¯ç´§å‡‘æ ¼å¼ï¼ŒèŠ‚çœå­—ç¬¦ä¸²å†…å­˜ï¼Œä½¿ç”¨ <code>com.google.gson.GsonBuilder#setPrettyPrinting</code> æ–¹æ³•ä¹‹åæœ€ç»ˆè¾“å‡ºçš„ JSON å­—ç¬¦ä¸²æ˜¯æ›´æ˜“è¯»çš„æ ¼å¼ã€‚å½“ç„¶é™¤äº†è¿™ä¸¤ä¸ªæ–¹æ³•ï¼ŒGsonBuilder è¿˜æä¾›äº†è®¸å¤šå®šåˆ¶åºåˆ—åŒ–å’Œååºåˆ—åŒ–è¡Œä¸ºçš„APIã€‚</p><h4 id="JosnObject-ç”Ÿæˆ-JSON"><a href="#JosnObject-ç”Ÿæˆ-JSON" class="headerlink" title="JosnObject ç”Ÿæˆ JSON"></a>JosnObject ç”Ÿæˆ JSON</h4><p>é™¤äº†ä¸Šè¿°å°†è‡ªå®šä¹‰ç±»çš„å¯¹è±¡è½¬æ¢æˆ JSON çš„æ–¹å¼ä¹‹å¤–ï¼Œè¿˜å¯ä»¥ä½¿ç”¨ Gson æ¡†æ¶æä¾›çš„ JsonObject æ„å»ºæ™®é€šå¯¹è±¡ï¼Œç„¶åä½¿ç”¨ <code>toJson</code> æ–¹æ³•ç”Ÿæˆ JSON å­—ç¬¦ä¸²ï¼Œåœ¨åŸæµ‹è¯•ç±»ä¸­è¡¥å……ä¸‹æ–¹æµ‹è¯•ç±»ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">test_jsonObject_serialization</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  Gson gson = <span class="keyword">new</span> Gson();</span><br><span class="line">  JsonObject jsonObject = <span class="keyword">new</span> JsonObject();</span><br><span class="line">  jsonObject.addProperty(<span class="string">&quot;code&quot;</span>, <span class="number">400</span>);</span><br><span class="line">  jsonObject.addProperty(<span class="string">&quot;message&quot;</span>, <span class="string">&quot;å‚æ•°é”™è¯¯&quot;</span>);</span><br><span class="line">  String toJson = gson.toJson(jsonObject);</span><br><span class="line">  String exceptedJson = <span class="string">&quot;&#123;\&quot;code\&quot;:400,\&quot;message\&quot;:\&quot;å‚æ•°é”™è¯¯\&quot;&#125;&quot;</span>;</span><br><span class="line">  Assertions.assertEquals(exceptedJson, toJson); <span class="comment">//true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>JsonObject ä½¿ç”¨ <code>addProperty(property,value)</code> æ–¹æ³•åªèƒ½ç”¨æ¥æ·»åŠ  Stringï¼ŒNumberï¼ŒBooleanï¼ŒCharacterè¿™å››ç±»æ•°æ®ï¼Œ å› ä¸ºå†…éƒ¨æ˜¯è°ƒç”¨ <code>com.google.gson.JsonObject#add</code>, å°† value å°è£…æˆäº† JsonPrimitive å¯¹è±¡ï¼Œç„¶åä¿å­˜åˆ°äº†å†…éƒ¨è‡ªå®šä¹‰çš„ <code>LinkedTreeMap</code> é›†åˆå˜é‡ members ä¸­ï¼›å¦‚æœéœ€è¦åœ¨ JsonObject å¯¹è±¡ä¸Šæ·»åŠ å…¶ä»–å¯¹è±¡æ—¶ï¼Œå°±éœ€è¦ç›´æ¥ä½¿ç”¨ <code>add(String property, JsonElement value)</code> æ–¹æ³•æ·»åŠ ä¸€ä¸ª JsonElement å¯¹è±¡ã€‚è¿™é‡Œçš„ JsonElement æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼ŒJsonObject å’Œ JsonPrimitive éƒ½ç»§æ‰¿äº†JsonElementï¼Œæ‰€ä»¥æˆ‘ä»¬æœ€ç»ˆé€šè¿‡å¦å¤–çš„ JsonObject å¯¹è±¡æ¥ä½œä¸ºåŸ JsonObject ä¸Šçš„å±æ€§å¯¹è±¡ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Gson gson = <span class="keyword">new</span> Gson();</span><br><span class="line">JsonObject jsonObject = <span class="keyword">new</span> JsonObject();</span><br><span class="line"><span class="comment">//...</span></span><br><span class="line">JsonObject nestJsonObject = <span class="keyword">new</span> JsonObject();</span><br><span class="line">nestJsonObject.addProperty(<span class="string">&quot;username&quot;</span>, <span class="string">&quot;one&quot;</span>);</span><br><span class="line">nestJsonObject.addProperty(<span class="string">&quot;score&quot;</span>, <span class="number">99</span>);</span><br><span class="line">jsonObject.add(<span class="string">&quot;data&quot;</span>, nestJsonObject);</span><br><span class="line">String toJson2 = gson.toJson(jsonObject);</span><br><span class="line">System.out.println(toJson2);</span><br><span class="line"><span class="comment">// &#123;&quot;code&quot;:400,&quot;message&quot;:&quot;å‚æ•°é”™è¯¯&quot;,&quot;data&quot;:&#123;&quot;username&quot;:&quot;one&quot;,&quot;score&quot;:99&#125;&#125;</span></span><br></pre></td></tr></table></figure><h3 id="JSON-ååºåˆ—åŒ–"><a href="#JSON-ååºåˆ—åŒ–" class="headerlink" title="JSON ååºåˆ—åŒ–"></a>JSON ååºåˆ—åŒ–</h3><h4 id="ç®€å•å¯¹è±¡çš„ååºåˆ—åŒ–"><a href="#ç®€å•å¯¹è±¡çš„ååºåˆ—åŒ–" class="headerlink" title="ç®€å•å¯¹è±¡çš„ååºåˆ—åŒ–"></a>ç®€å•å¯¹è±¡çš„ååºåˆ—åŒ–</h4><p>ç°åœ¨æˆ‘ä»¬å†æ¥çœ‹ä¸‹ JSON ååºåˆ—åŒ–æˆ Java å¯¹è±¡ç”¨æ³•ï¼Œè¿™é‡Œä¸»è¦ä½¿ç”¨æ–¹æ³•æ˜¯ <code>com.google.gson.Gson#fromJson</code>ï¼Œå®ƒæœ€åŸºç¡€çš„ç”¨æ³•å°±æ˜¯ <code>fromJson(String json, Class&lt;T&gt; classOfT)</code>ï¼Œå°è¯•å°† JSON å­—ç¬¦ä¸²è½¬ä¸ºæŒ‡å®š Class çš„å¯¹è±¡ï¼Œå¦‚æœè½¬æ¢å¤±è´¥ï¼Œå°±ä¼šæŠ›å‡º <code>JsonSyntaxException</code> å¼‚å¸¸ã€‚æˆ‘ä»¬å¯ä»¥åœ¨åŸæ¥ä»£ç ä¸Šæ–°å¢ä¸€ä¸ªæµ‹è¯•ç”¨ä¾‹ï¼Œè¿è¡Œçœ‹ä¸‹æ•ˆæœï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">test_deserialization</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    String json = <span class="string">&quot;&#123;\&quot;code\&quot;:400,\&quot;message\&quot;:\&quot;å‚æ•°é”™è¯¯\&quot;&#125;&quot;</span>;</span><br><span class="line">    Result result = <span class="keyword">new</span> Gson().fromJson(json, Result.class);</span><br><span class="line">    Assertions.assertEquals(<span class="number">400</span>, result.code); <span class="comment">// true</span></span><br><span class="line">    Assertions.assertEquals(<span class="string">&quot;å‚æ•°é”™è¯¯&quot;</span>, result.message); <span class="comment">// true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="ååºåˆ—åŒ–-Map"><a href="#ååºåˆ—åŒ–-Map" class="headerlink" title="ååºåˆ—åŒ– Map"></a>ååºåˆ—åŒ– Map</h4><p>é™¤äº†å°†JSON å­—ç¬¦ä¸²åºåˆ—åŒ–ä¸ºè‡ªå®šä¹‰çš„Java å¯¹è±¡ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥è½¬ä¸º Map é›†åˆï¼ŒGson æä¾›äº†å¯¹ Map é›†åˆçš„è½¬æ¢ï¼Œä½¿ç”¨èµ·æ¥ä¹Ÿååˆ†ç®€å•ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">test_map</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    String jsonString = <span class="string">&quot;&#123;&#x27;employee.name&#x27;:&#x27;one&#x27;,&#x27;employee.salary&#x27;:10&#125;&quot;</span>;</span><br><span class="line">    Gson gson = <span class="keyword">new</span> Gson();</span><br><span class="line">    Map map = gson.fromJson(jsonString, Map.class);</span><br><span class="line">    assertEquals(<span class="number">2</span>, map.size());</span><br><span class="line">assertEquals(<span class="string">&quot;one&quot;</span>, map.get(<span class="string">&quot;employee.name&quot;</span>));</span><br><span class="line">    assertEquals(Double.class, map.get(<span class="string">&quot;employee.name&quot;</span>).getClass());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>éœ€è¦æ³¨æ„çš„æ˜¯è½¬æ¢åçš„ Map å¯¹è±¡çœŸå®ç±»å‹å¹¶ä¸æ˜¯æˆ‘ä»¬ç»å¸¸ç”¨çš„ HashMapï¼Œè€Œæ˜¯ Gson è‡ªå®šä¹‰é›†åˆ<code>LinkedTreeMap</code> ï¼Œå®ƒå®ç°Map æ¥å£æ¥å­˜å‚¨é”®å€¼å¯¹ï¼Œåœ¨æ–°å¢å’Œåˆ é™¤ä¸Šå®ç°ä¸Šè¿›è¡Œäº†ä¼˜åŒ–ï¼Œå¹¶ä¸”å°†å­˜å‚¨é”®å€¼å¯¹çš„é¡ºåºä½œä¸ºéå†é¡ºåºï¼Œä¹Ÿå°±æ˜¯å…ˆå­˜å…¥çš„å…ˆè¢«éå†åˆ°ã€‚é™¤æ­¤ä¹‹å¤–ï¼ŒJSON å­—ç¬¦ä¸²é‡Œçš„æ•°å€¼å‹æ•°æ®éƒ½ä¼šè½¬è½¬æ¢ä¸º Double ç±»å‹ï¼Œè€Œ <code>true/false</code> æ•°æ®è¢«ä¼šè¢«è½¬æ¢æˆ Boolean ç±»å‹ï¼Œå…·ä½“åˆ¤æ–­ä¾æ®å¯ä»¥å‚è€ƒ <code>com.google.gson.internal.bind.ObjectTypeAdapter#read</code> æ–¹æ³•çš„å®ç°ã€‚</p><h3 id="JSON-ä¸-Arrayï¼ŒList-è½¬æ¢"><a href="#JSON-ä¸-Arrayï¼ŒList-è½¬æ¢" class="headerlink" title="JSON ä¸ Arrayï¼ŒList è½¬æ¢"></a>JSON ä¸ Arrayï¼ŒList è½¬æ¢</h3><h4 id="JSON-è½¬æ¢-Array"><a href="#JSON-è½¬æ¢-Array" class="headerlink" title="JSON è½¬æ¢ Array"></a>JSON è½¬æ¢ Array</h4><p>å½“æˆ‘ä»¬æ­£å¯¹ JSON æ•°æ®è¿›è¡Œæ•°ç»„è½¬æ¢æ—¶ï¼Œç±»ä¼¼æ™®é€šå¯¹è±¡è½¬æ¢çš„æ–¹å¼å³å¯ï¼Œ <code>toJson</code> æ–¹æ³•ç›´æ¥ä½¿ç”¨è½¬ä¸º JSON æ•°æ®ï¼Œ<code>fromJson</code> æŒ‡å®šæ•°ç»„ç±»å‹è½¬æ¢ä¸ºå¯¹åº”ç±»å‹çš„æ•°ç»„ã€‚</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">test_array</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  Gson gson = <span class="keyword">new</span> Gson();</span><br><span class="line">  <span class="keyword">int</span>[] ints = &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>&#125;;</span><br><span class="line">  String[] strings = &#123;<span class="string">&quot;abc&quot;</span>, <span class="string">&quot;def&quot;</span>, <span class="string">&quot;ghi&quot;</span>&#125;;</span><br><span class="line">  String s = gson.toJson(ints);<span class="comment">// [1,2,3,4,5]</span></span><br><span class="line">  assertEquals(<span class="string">&quot;[1,2,3,4,5]&quot;</span>, s); <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line">  String s1 = gson.toJson(strings);<span class="comment">// [&quot;abc&quot;, &quot;def&quot;, &quot;ghi&quot;]</span></span><br><span class="line">  assertEquals(<span class="string">&quot;[\&quot;abc\&quot;,\&quot;def\&quot;,\&quot;ghi\&quot;]&quot;</span>, s1);</span><br><span class="line">  String[] strings1 = gson.fromJson(s1, String[].class);</span><br><span class="line">  assertEquals(strings.length, strings1.length); <span class="comment">// true</span></span><br><span class="line">  assertEquals(strings[<span class="number">0</span>], strings1[<span class="number">0</span>]); <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">int</span>[] ints2 = gson.fromJson(<span class="string">&quot;[1,2,3,4,5]&quot;</span>, <span class="keyword">int</span>[].class);</span><br><span class="line">  assertEquals(<span class="number">1</span>, ints2[<span class="number">0</span>]); <span class="comment">// true</span></span><br><span class="line">  assertEquals(<span class="number">5</span>, ints2[<span class="number">4</span>]); <span class="comment">// true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="JSON-è½¬æ¢-List"><a href="#JSON-è½¬æ¢-List" class="headerlink" title="JSON è½¬æ¢ List"></a>JSON è½¬æ¢ List</h4><p>è¦å°† List æ•°æ®è½¬æ¢ä¸º JSONæ•°æ®ï¼Œä½¿ç”¨ Gson çš„æ–¹å¼ä¸å¤„ç† Array æ•°æ®ä¸€æ ·ï¼›è¿™é‡Œä¸»è¦è®²çš„æ˜¯å°†JSON æ•°æ®è½¬ä¸º List å¯¹è±¡çš„æ“ä½œç•¥æœ‰ä¸åŒï¼Œè¦å°†ä¸€ä¸ª JSON æ•°ç»„æ•°æ®è½¬æ¢ä¸ºä¸€ä¸ªè‡ªå®šä¹‰ç±»çš„List æ—¶ï¼Œæˆ‘ä»¬æŒ‰ç…§åŸæ¥çš„å†™æ³•å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">givenJsonString_whenIncorrectDeserializing</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Gson gson = <span class="keyword">new</span> Gson();</span><br><span class="line">    String inputString = <span class="string">&quot;[&#123;\&quot;id\&quot;:1,\&quot;name\&quot;:\&quot;one\&quot;&#125;,&#123;\&quot;id\&quot;:2,\&quot;name\&quot;:\&quot;two\&quot;&#125;]&quot;</span>;</span><br><span class="line">    List&lt;Person&gt; outputList = gson.fromJson(inputString, List.class);</span><br><span class="line">outputList.get(<span class="number">0</span>).getId();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯ä¸å¹¸çš„æ˜¯ï¼Œè¿è¡Œè¿™æ®µä»£ç åä¼šæŠ›å‡º <code>ClassCastException</code> å¼‚å¸¸ï¼Œå…·ä½“æè¿°å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">java.lang.ClassCastException: com.google.gson.internal.LinkedTreeMap cannot be cast to com.one.learn.Person</span><br></pre></td></tr></table></figure><p>ä»ä¸Šè¿°æè¿°ä¸­æˆ‘ä»¬å¯ä»¥çŸ¥é“æ‰§è¡Œ <code>fromJson</code> ä¹‹åï¼Œååºåˆ—åŒ–åå¾—åˆ°çš„ List å…ƒç´ ç±»å‹ä¸º LinkedTreeMapï¼Œè€Œä¸æ˜¯ Personï¼Œæ‰€ä»¥ä»¥ Person å¯¹è±¡æ–¹å¼è®¿é—® id å±æ€§æ—¶å°±ä¼šæŠ›å‡º <code>ClassCastException</code> å¼‚å¸¸ã€‚é‚£åˆè¯¥å¦‚ä½•å¤„ç†å‘¢,   æˆ‘ä»¬éœ€è¦è°ƒç”¨ Gson çš„ å¦å¤–ä¸€ä¸ª <code>fromJson</code> æ–¹æ³•ï¼š<code>fromJson(String json, Type typeOfT)</code> ï¼Œå…ˆçœ‹ä¸‹ä½¿ç”¨æ–¹å¼</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">givenJsonString_whenCorrectDeserializing_</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  Gson gson = <span class="keyword">new</span> Gson();</span><br><span class="line">  String inputString = <span class="string">&quot;[&#123;\&quot;id\&quot;:1,\&quot;name\&quot;:\&quot;one\&quot;&#125;,&#123;\&quot;id\&quot;:2,\&quot;name\&quot;:\&quot;two\&quot;&#125;]&quot;</span>;</span><br><span class="line">  Type type = <span class="keyword">new</span> TypeToken&lt;List&lt;Person&gt;&gt;()&#123;&#125;.getType();</span><br><span class="line">  List&lt;Person&gt; outputList = gson.fromJson(inputString, type);</span><br><span class="line">  <span class="keyword">int</span> id = outputList.get(<span class="number">0</span>).getId();</span><br><span class="line">  assertEquals(<span class="number">1</span>, id); <span class="comment">// true</span></span><br><span class="line">  assertEquals(<span class="string">&quot;one&quot;</span>, outputList.get(<span class="number">0</span>).getName()); <span class="comment">// true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªæ–¹æ³•ä¸­çš„ Type å¯¹è±¡é€šè¿‡ TypeToken å¯¹è±¡çš„ <code>getType</code> æ–¹æ³•è·å–åˆ°ï¼Œå°±æ˜¯ TypeToken å¯¹è±¡æ‰€å…³è”çš„æ³›å‹ç±»å‹ã€‚è€Œè¿™é‡Œ TypeToken æ˜¯ Gson ä¸ºäº†æ”¯æŒæ³›å‹è€Œå¼•å…¥çš„ç±»ï¼Œæ¥è§£å†³ Java æ— æ³•æä¾›æ³›å‹ç±»å‹è¡¨ç¤ºçš„é—®é¢˜ï¼Œç”±äº TypeToken çš„æ„é€ æ–¹æ³•æ˜¯<code>protected</code>ä¿®é¥°çš„ï¼Œæ— æ³•ç›´æ¥æ„é€ ï¼Œä½¿ç”¨å°±éœ€è¦å†™æˆ<code>new TypeToken&lt;List&lt;String&gt;&gt;() &#123;&#125;.getType()</code>  å½¢å¼ã€‚</p><h2 id="Gsonè¿›é˜¶ç”¨æ³•"><a href="#Gsonè¿›é˜¶ç”¨æ³•" class="headerlink" title="Gsonè¿›é˜¶ç”¨æ³•"></a>Gsonè¿›é˜¶ç”¨æ³•</h2><p>æ¥è§¦äº† Gson åŸºæœ¬çš„ä½¿ç”¨ä¹‹åï¼Œæˆ‘ä»¬æ¥ç€è¿›ä¸€æ­¥å­¦ä¹  Gson çš„å…¶ä»–ç”¨æ³•ã€‚</p><h3 id="æ³›å‹å¯¹è±¡ååºåˆ—åŒ–"><a href="#æ³›å‹å¯¹è±¡ååºåˆ—åŒ–" class="headerlink" title="æ³›å‹å¯¹è±¡ååºåˆ—åŒ–"></a>æ³›å‹å¯¹è±¡ååºåˆ—åŒ–</h3><p>ç®€å•æ¥è§¦äº† Gson å¯¹æ³›å‹çš„æ”¯æŒï¼Œæ¥ä¸‹æ¥ç”¨ä»£ç æ¥å±•ç¤ºä¸‹å®ƒçš„å¼ºå¤§ä¹‹å¤„ï¼Œé¦–å…ˆæˆ‘ä»¬å°†ä¸Šæ–‡çš„ Result ç±»è°ƒæ•´ä¸‹æ¥å—æ³›å‹å‚æ•°ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Result</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">int</span> code;</span><br><span class="line">  <span class="keyword">private</span> String message;</span><br><span class="line">  <span class="keyword">private</span> T data;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">Result</span><span class="params">(<span class="keyword">int</span> code, String message, T data)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.code = code;</span><br><span class="line">    <span class="keyword">this</span>.message = message;</span><br><span class="line">    <span class="keyword">this</span>.data = data;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åå¯¹ä¸€ä¸ªæœ‰å†…åµŒå¯¹è±¡çš„ JSONå­—ç¬¦ä¸²è¿›è¡Œè§£ææˆ Result<User> å¯¹è±¡ï¼Œç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">test_genric_object</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  String json = <span class="string">&quot;&#123;\&quot;code\&quot;:200,\&quot;message\&quot;:\&quot;æ“ä½œæˆåŠŸ\&quot;,\&quot;data\&quot;:&#123;\&quot;username\&quot;: \&quot;one\&quot;,\&quot;avater\&quot;: \&quot;image.jpg\&quot;&quot;</span> +</span><br><span class="line">    <span class="string">&quot;&#125;&#125;&quot;</span>;</span><br><span class="line">  Type type = <span class="keyword">new</span> TypeToken&lt;Result&lt;User&gt;&gt;()&#123;&#125;.getType();</span><br><span class="line">  Result&lt;User&gt; result = <span class="keyword">new</span> Gson().fromJson(json, type);</span><br><span class="line">  Assertions.assertEquals(<span class="number">200</span>, result.code);</span><br><span class="line">  Assertions.assertEquals(<span class="string">&quot;one&quot;</span>, result.data.getUsername());</span><br><span class="line">  Assertions.assertEquals(<span class="string">&quot;image.jpg&quot;</span>, result.data.getAvater());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> String username;</span><br><span class="line">  <span class="keyword">private</span> String avater;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> String <span class="title">getUsername</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> username;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> String <span class="title">getAvater</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> avater;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆ©ç”¨ TypeToken å¯¹è±¡è·å–å…·ä½“æ³›å‹ç±»å‹ Result<User> , ç„¶ååœ¨ <code>fromJson</code> æ–¹æ³•ä¸­ä¼ å…¥å°±ä¼šæ ¹æ®å¯¹åº”ç±»å‹çš„æ‰§è¡Œååºåˆ—åŒ–æ“ä½œã€‚</p><h3 id="è‡ªå®šä¹‰åºåˆ—åŒ–"><a href="#è‡ªå®šä¹‰åºåˆ—åŒ–" class="headerlink" title="è‡ªå®šä¹‰åºåˆ—åŒ–"></a>è‡ªå®šä¹‰åºåˆ—åŒ–</h3><p>è¦å¯¹Java å¯¹è±¡çš„æŸäº›å­—æ®µè¿›è¡Œç‰¹æ®Šå¤„ç†ï¼Œæ¯”å¦‚éšè—æŸäº›å­—æ®µçš„åºåˆ—åŒ–ï¼Œå¯¹å­—æ®µçš„æ•°æ®æ ¼å¼åŒ–å¤„ç†ç­‰ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å®ç° JsonSerializer æ¥å£ï¼Œå¯¹åºåˆ—åŒ–é€»è¾‘è¿›è¡Œè‡ªå®šä¹‰ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬éœ€è¦å¯¹ Date ç±»å‹å±æ€§è¿›è¡Œç‰¹å®šæ ¼å¼çš„å¤„ç†ï¼Œå¯ä»¥å£°æ˜ DateSerializer ç±»å®ç°å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DateSerializer</span> <span class="keyword">implements</span> <span class="title">JsonSerializer</span>&lt;<span class="title">Date</span>&gt; </span>&#123;</span><br><span class="line">    SimpleDateFormat dateTime = <span class="keyword">new</span> SimpleDateFormat(<span class="string">&quot;yyyy-MM-dd&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> JsonElement <span class="title">serialize</span><span class="params">(Date src, Type typeOfSrc, </span></span></span><br><span class="line"><span class="function"><span class="params">                                 JsonSerializationContext context)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> JsonPrimitive(dateTime.format(src));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶ååœ¨æ„å»º Gson å¯¹è±¡å‰ï¼Œåˆ©ç”¨ GsonBuilder å°† DateSerializer å®ä¾‹è¿›è¡Œæ³¨å†Œï¼Œä½¿ç”¨æ–¹å¼å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Gson gson = <span class="keyword">new</span> GsonBuilder()</span><br><span class="line">    .registerTypeAdapter(Date.class, <span class="keyword">new</span> DateSerializer())</span><br><span class="line">    .create();</span><br></pre></td></tr></table></figure><p>è¿™æ ·ä¸€æ¥ï¼Œä¸€æ—¦é‡åˆ°è¦åºåˆ—åŒ– Date ç±»å‹çš„å­—æ®µæ—¶ï¼Œéƒ½ä¼šé€šè¿‡è‡ªå®šä¹‰çš„ <code>serialize</code> æ–¹æ³•å°†æ—¥æœŸä»¥ <code>yyyy-MM-dd</code> æ ¼å¼è¿›è¡Œè¾“å‡ºï¼Œå¦‚ä¸‹æ–¹çš„ç¤ºä¾‹ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">test_dateSerializer</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  MyObject myObject = <span class="keyword">new</span> MyObject(<span class="keyword">new</span> Date(), <span class="string">&quot;one&quot;</span>);</span><br><span class="line">  Gson gson = <span class="keyword">new</span> GsonBuilder().registerTypeAdapter(Date.class, <span class="keyword">new</span> DateSerializer()).create();</span><br><span class="line">  String json = gson.toJson(myObject);</span><br><span class="line">  String exceptedJson = <span class="string">&quot;&#123;\&quot;date\&quot;:\&quot;2019-09-08\&quot;,\&quot;name\&quot;:\&quot;one\&quot;&#125;&quot;</span>;</span><br><span class="line">  Assertions.assertEquals(exceptedJson, json); <span class="comment">// true</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyObject</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Date date;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyObject</span><span class="params">(Date date, String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.date = date;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyObject</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="è‡ªå®šä¹‰ååºåˆ—åŒ–"><a href="#è‡ªå®šä¹‰ååºåˆ—åŒ–" class="headerlink" title="è‡ªå®šä¹‰ååºåˆ—åŒ–"></a>è‡ªå®šä¹‰ååºåˆ—åŒ–</h3><p>ä¸è‡ªå®šä¹‰åºåˆ—åŒ–å®ç°æ–¹å¼ç±»ä¼¼ï¼Œæƒ³è¦è‡ªå®šä¹‰ååºåˆ—åŒ–é€»è¾‘ï¼Œå°±éœ€è¦åŒæ ·è¦å®ç°ä¸€ä¸ªå« JsonDeserializer çš„æ¥å£ï¼Œè¿›è¡Œè‡ªå®šä¹‰ååºåˆ—åŒ–é€»è¾‘çš„å®ç°ã€‚æ¯”å¦‚ç°åœ¨æœ‰ä¸ª JSON å­—ç¬¦ä¸²å†…å®¹ä¸º <code>&#123;&quot;CODE&quot;: 400, &quot;MESSAGE&quot;: &quot;å‚æ•°é”™è¯¯&quot;&#125;</code>ï¼Œéœ€è¦è¢«ååºåˆ—åŒ–ä¸ºå‰æ–‡æåˆ°çš„ Result å¯¹è±¡ï¼Œç”±äºå­—æ®µåä¸ä¸€æ ·ï¼Œä¸ºäº†å®ç°å¯¹åº”çš„è½¬æ¢ï¼Œå°±éœ€è¦è‡ªå®šä¹‰ ResultDeserializer ç±»ï¼Œå…·ä½“å®ç°å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ResultDeserializer</span> <span class="keyword">implements</span> <span class="title">JsonDeserializer</span>&lt;<span class="title">Result</span>&gt; </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Result <span class="title">deserialize</span><span class="params">(JsonElement json, </span></span></span><br><span class="line"><span class="function"><span class="params">                              Type typeOfT, </span></span></span><br><span class="line"><span class="function"><span class="params">                              JsonDeserializationContext context)</span> <span class="keyword">throws</span> JsonParseException </span>&#123;</span><br><span class="line">        JsonObject object = json.getAsJsonObject();</span><br><span class="line">        Result&lt;Object&gt; result = <span class="keyword">new</span> Result&lt;&gt;(object.getAsJsonPrimitive(<span class="string">&quot;CODE&quot;</span>)</span><br><span class="line">                                             .getAsInt(),</span><br><span class="line">                                             object.getAsJsonPrimitive(<span class="string">&quot;MESSAGE&quot;</span>)</span><br><span class="line">                                             .getAsString(), <span class="keyword">null</span>);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥å°±æ˜¯åˆ©ç”¨ GsonBuilder æ³¨å†Œ ResultDeserializer å®ä¾‹ï¼Œç”Ÿæˆå¯¹åº”çš„ Gson å¯¹è±¡ï¼Œå¹¶è¿›è¡Œååºåˆ—åŒ–æ“ä½œï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">test_resultDeserializer</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">//language=JSON</span></span><br><span class="line">String json = <span class="string">&quot;&#123;\&quot;CODE\&quot;: 400,\&quot;MESSAGE\&quot;: \&quot;å‚æ•°é”™è¯¯\&quot;&#125;&quot;</span>;</span><br><span class="line">    Gson gson = <span class="keyword">new</span> GsonBuilder().registerTypeAdapter(Result.class, <span class="keyword">new</span> ResultDeserializer())</span><br><span class="line">            .create();</span><br><span class="line">    Result result = gson.fromJson(json, Result.class);</span><br><span class="line">    Assertions.assertEquals(<span class="number">400</span>, result.code); <span class="comment">// true</span></span><br><span class="line">    Assertions.assertEquals(<span class="string">&quot;å‚æ•°é”™è¯¯&quot;</span>, result.message); <span class="comment">// true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Gsonå¸¸ç”¨æ³¨è§£"><a href="#Gsonå¸¸ç”¨æ³¨è§£" class="headerlink" title="Gsonå¸¸ç”¨æ³¨è§£"></a>Gsonå¸¸ç”¨æ³¨è§£</h2><p>Gson é™¤äº†æä¾›ä¸€äº› API ä¾›å¼€å‘è€…ä½¿ç”¨ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€äº›å…·æœ‰ç‰¹æ€§çš„æ³¨è§£å¯ä»¥ä½¿ç”¨ï¼Œæ¥ä¸‹æ¥å°±ä»‹ç»åœ¨ Gson ä¸­æœ€å¸¸ç”¨çš„æ³¨è§£ã€‚</p><h3 id="Expose"><a href="#Expose" class="headerlink" title="@Expose"></a>@Expose</h3><p>è¿™ä¸ªæ³¨è§£åªèƒ½ç”¨åœ¨å­—æ®µä¸Šï¼Œä½œç”¨å°±æ˜¯æ³¨æ˜å¯¹åº”çš„å­—æ®µæ˜¯å¦å°†åœ¨åºåˆ—åŒ–æˆ–è€…ååºåˆ—åŒ–æ—¶æš´éœ²å‡ºæ¥ï¼Œæœ‰ä¸¤ä¸ªå±æ€§ <code>serialize</code> å’Œ <code>deserialize</code> ï¼Œé»˜è®¤éƒ½ä¸º trueã€‚å½“ç»™ä¸€ä¸ªå­—æ®µåŠ ä¸Š æ³¨è§£<code>@Expose(serialize = true, deserialize = false)</code>ï¼Œåˆ™è¡¨ç¤ºäº†è¯¥å­—æ®µå°½åœ¨åºåˆ—åŒ–æ—¶å¯è§ï¼Œåœ¨ååºåˆ—åŒ–æ—¶ä¼šå¿½ç•¥èµ‹å€¼ã€‚éœ€è¦é¢å¤–æ³¨æ„çš„ä¸€ç‚¹æ˜¯ï¼Œ@Expose æ³¨è§£åªæœ‰åœ¨ç”¨ GsonBuilder æ–¹å¼æ„å»º Gson æ—¶æœ‰é™ï¼Œå¹¶ä¸”æ„å»ºå‰å¿…é¡»è°ƒç”¨ <code>excludeFieldsWithoutExposeAnnotation</code> æ–¹æ³•ï¼Œä¸‹é¢æ˜¯å…·ä½“çš„ä½¿ç”¨ç¤ºä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">test_expose</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    MySubClass subclass = <span class="keyword">new</span> MySubClass(<span class="number">42L</span>, <span class="string">&quot;the answer&quot;</span>, <span class="string">&quot;Verbose field not to serialize&quot;</span>);</span><br><span class="line">    MyClass source = <span class="keyword">new</span> MyClass(<span class="number">1L</span>, <span class="string">&quot;foo&quot;</span>, <span class="string">&quot;bar&quot;</span>, subclass);</span><br><span class="line">    Gson gson = <span class="keyword">new</span> GsonBuilder().excludeFieldsWithoutExposeAnnotation().create();</span><br><span class="line">    String s = gson.toJson(source);</span><br><span class="line">    System.out.println(s);</span><br><span class="line"><span class="comment">// &#123;&quot;id&quot;:1,&quot;name&quot;:&quot;foo&quot;,&quot;subclass&quot;:&#123;&quot;id&quot;:42,&quot;description&quot;:&quot;the answer&quot;,&quot;otherVerboseInfo&quot;:&quot;Verbose field not to serialize&quot;&#125;&#125;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyClass</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">long</span> id;</span><br><span class="line">    <span class="meta">@Expose(serialize = false, deserialize = true)</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">transient</span> String other;</span><br><span class="line">    <span class="meta">@Expose</span></span><br><span class="line">    <span class="keyword">private</span> MySubClass subclass;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MySubClass</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Expose</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">long</span> id;</span><br><span class="line">    <span class="meta">@Expose</span></span><br><span class="line">    <span class="keyword">private</span> String description;</span><br><span class="line">    <span class="meta">@Expose</span></span><br><span class="line">    <span class="keyword">private</span> String otherVerboseInfo;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>åœ¨ Gson ä¸­ <code>transient</code> å…³é”®å­—ä¿®é¥°çš„å­—æ®µé»˜è®¤ä¸ä¼šè¢«åºåˆ—åŒ–å’Œååºåˆ—åŒ–ï¼Œè¿™ä¸ªè¡Œä¸ºæ˜¯ä¸ Java åŸç”Ÿçš„åºåˆ—åŒ–å’Œååºåˆ—åŒ–æ“ä½œä¸€è‡´çš„ã€‚</p></blockquote><h3 id="Since"><a href="#Since" class="headerlink" title="@Since"></a>@Since</h3><p>è¯¥æ³¨è§£ç”¨äºæ ‡è®°å¯¹åº”å­—æ®µæˆ–è€…ç±»å‹çš„ç‰ˆæœ¬ï¼Œè®© Gson å¯ä»¥æŒ‡å®šç‰ˆæœ¬å·è¿›è¡Œåºåˆ—åŒ–å’Œååºåˆ—åŒ–æ“ä½œã€‚å½“WebæœåŠ¡ä¸Šçš„ JSON æ•°æ®å¯¹åº”çš„ç±»å­˜åœ¨å¤šä¸ªç‰ˆæœ¬çš„å­—æ®µæ—¶ï¼Œè¿™ä¸ªæ³¨è§£å°±ååˆ†æœ‰ç”¨ã€‚</p><p>åŒæ ·åœ°ï¼Œè¯¥æ³¨è§£åªé’ˆå¯¹ä½¿ç”¨ <code>GsonBuilder</code> æ–¹å¼æ„å»ºçš„ Gson å¯¹è±¡ï¼Œå¹¶ä¸”ä½¿ç”¨ <code>setVersion</code> æ–¹æ³•æŒ‡æ˜ç‰ˆæœ¬å·æ—¶æœ‰æ•ˆï¼Œåªè§£æå¯¹è±¡ä¸­å¯¹åº”ç‰ˆæœ¬çš„å­—æ®µï¼Œä¸‹é¢ä¸ºå…·ä½“ç¤ºä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">VersioningSupportTest</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">test</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        VersionedClass versionedObject = <span class="keyword">new</span> VersionedClass();</span><br><span class="line">        Gson gson = <span class="keyword">new</span> GsonBuilder().setVersion(<span class="number">1.0</span>).create();</span><br><span class="line">        String jsonOutput = gson.toJson(versionedObject);</span><br><span class="line">        System.out.println(jsonOutput); <span class="comment">// &#123;&quot;newField&quot;:&quot;new&quot;,&quot;field&quot;:&quot;old&quot;&#125;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">VersionedClass</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Since(1.1)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String newerField;</span><br><span class="line">    <span class="meta">@Since(1.0)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String newField;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String field;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">VersionedClass</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.newerField = <span class="string">&quot;newer&quot;</span>;</span><br><span class="line">        <span class="keyword">this</span>.newField = <span class="string">&quot;new&quot;</span>;</span><br><span class="line">        <span class="keyword">this</span>.field = <span class="string">&quot;old&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="SerializedName"><a href="#SerializedName" class="headerlink" title="@SerializedName"></a>@SerializedName</h3><p>è¿™ä¸ªæ³¨è§£ä½¿ç”¨èµ·æ¥æ¯”è¾ƒç®€å•ï¼Œä¹Ÿå¾ˆæœ‰ç”¨ã€‚@SerializedName æŒ‡å®šäº†æˆå‘˜å­—æ®µè¢«åºåˆ—åŒ–å’Œååºåˆ—åŒ–æ—¶æ‰€é‡‡ç”¨çš„åç§°ä¸‹é¢æ˜¯å…·ä½“ä½¿ç”¨æ–¹å¼ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JSONFieldNamingSupportTest</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">SomeObject</span> </span>&#123;</span><br><span class="line">        <span class="meta">@SerializedName(&quot;custom_naming&quot;)</span></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> String someField;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> String someOtherField;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">SomeObject</span><span class="params">(String a, String b)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.someField = a;</span><br><span class="line">            <span class="keyword">this</span>.someOtherField = b;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">test</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        SomeObject someObject = <span class="keyword">new</span> SomeObject(<span class="string">&quot;first&quot;</span>, <span class="string">&quot;second&quot;</span>);</span><br><span class="line">        String jsonRepresentation = gson.toJson(someObject);</span><br><span class="line">        System.out.println(jsonRepresentation);</span><br><span class="line">      <span class="comment">// &#123;&quot;custom_naming&quot;:&quot;first&quot;,&quot;someOtherField&quot;:&quot;second&quot;&#125;</span></span><br><span class="line">        SomeObject someObject1 = gson.fromJson(jsonRepresentation, SomeObject.class);</span><br><span class="line">        System.out.println(someObject1);</span><br><span class="line">      <span class="comment">// SomeObject&#123;someField=&#x27;first&#x27;, someOtherField=&#x27;second&#x27;&#125;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="JsonAdapter"><a href="#JsonAdapter" class="headerlink" title="@JsonAdapter"></a>@JsonAdapter</h3><p><code>@JsonAdapter</code> ä¸»è¦ä½œç”¨å°±æ˜¯ä»£æ›¿  <code>GsonBuilder.registerTypeAdapter</code> æ–¹æ³•çš„æ‰§è¡Œï¼Œç›´æ¥é€šè¿‡ <code>@JsonAdapter(aClass.class)</code> æ–¹å¼æŒ‡å®š JsonDeserializer å¯¹è±¡æˆ–è€… JsonSerializer å¯¹è±¡ï¼Œå¯ä»¥èµ·åˆ°ç›¸åŒçš„ä½œç”¨ï¼Œå¹¶ä¸”ä¼˜å…ˆçº§æ¯”<code>GsonBuilder.registerTypeAdapter</code>çš„ä¼˜å…ˆçº§æ›´é«˜ï¼Œç”±äºåªæ˜¯å°† <code>registerTypeAdapter</code>æ–¹æ³•æ‰§è¡Œç®€åŒ–æˆäº†æ³¨è§£æ–¹æ³•ï¼Œè¿™é‡Œå°±ä¸å†æ¼”ç¤ºï¼Œç›´æ¥åœ¨å‰æ–‡<strong>è‡ªå®šä¹‰ååºåˆ—åŒ–</strong>ä¸€èŠ‚çš„ Result ç±»ä¸Šä½¿ç”¨å°±å¯ä»¥çœ‹åˆ°æ•ˆæœã€‚</p><h2 id="ç»“è¯­"><a href="#ç»“è¯­" class="headerlink" title="ç»“è¯­"></a>ç»“è¯­</h2><p>^_^.</p><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><ul><li><a href="https://juejin.im/post/5d764dcc6fb9a06b130f4b2a#heading-0">é™¤äº†FastJson,ä½ è¿˜æœ‰é€‰æ‹©: Gsonç®€æ˜“æŒ‡å—</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®°æœ¬ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> Gson </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SonarQubeçš„å®‰è£…ä¸ä½¿ç”¨</title>
      <link href="post/4084397208/"/>
      <url>post/4084397208/</url>
      
        <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>éšç€ä»£ç é‡çš„è¶Šæ¥è¶Šå¤šï¼ŒåŒæ—¶å¯¹ä»£ç è´¨é‡çš„è¦æ±‚ä¹Ÿè¶Šæ¥è¶Šé«˜ï¼Œå¯¹äºä»£ç <code>review</code>çš„éœ€æ±‚è¶Šæ¥è¶Šå¤šã€‚å› æ­¤ï¼Œå¼•å…¥<code>SonarQube</code>è¿™ä¸ªå·¥å…·å¯¹Javaä»£ç è¿›è¡Œè´¨é‡ç®¡æ§ã€‚</p><blockquote><p><strong>SonarQube</strong>ï¼ˆæ›¾ç”¨å<strong>Sonar</strong>ï¼ˆå£°çº³ï¼‰ï¼‰æ˜¯ä¸€ä¸ª<a href="https://zh.wikipedia.org/wiki/%E5%BC%80%E6%BA%90">å¼€æº</a>çš„<a href="https://zh.wikipedia.org/wiki/%E8%BD%AF%E4%BB%B6%E8%B4%A8%E9%87%8F">ä»£ç è´¨é‡</a>ç®¡ç†ç³»ç»Ÿã€‚</p></blockquote><h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><h3 id="å‰ç½®æ¡ä»¶"><a href="#å‰ç½®æ¡ä»¶" class="headerlink" title="å‰ç½®æ¡ä»¶"></a>å‰ç½®æ¡ä»¶</h3><ul><li>ç³»ç»Ÿç¯å¢ƒï¼šCentos 7</li><li>Javaç¯å¢ƒï¼š1.8</li><li>SonarQubeç‰ˆæœ¬ï¼š6.7.7</li></ul><blockquote><p>ç”±äºæœ€æ–°ç‰ˆçš„SonarQube7.9è¦æ±‚Javaç¯å¢ƒå¿…é¡»æ˜¯Java11ä»¥ä¸Šï¼Œæˆ‘ä»¬ç›®å‰å¼€å‘ä½¿ç”¨çš„æ˜¯1.8ï¼Œæ‰€ä»¥é€‰ç”¨è¾ƒä½ç‰ˆæœ¬çš„6.7.7</p></blockquote><h3 id="åˆ›å»ºsonarç”¨æˆ·"><a href="#åˆ›å»ºsonarç”¨æˆ·" class="headerlink" title="åˆ›å»ºsonarç”¨æˆ·"></a>åˆ›å»ºsonarç”¨æˆ·</h3><p>ç”±äºsonarç”¨åˆ°äº†<code>es</code>ï¼Œä¸å…è®¸ç›´æ¥ä½¿ç”¨rootç”¨æˆ·è¿è¡Œï¼Œå› æ­¤ï¼Œéœ€è¦åœ¨linuxä¸‹ï¼Œåˆ›å»ºsonarç”¨æˆ·ï¼Œä¸“é—¨ç”¨æ¥è¿è¡Œsonarç¨‹åºã€‚</p><p><em>å‡è®¾å½“å‰ä½¿ç”¨çš„æ˜¯rootç”¨æˆ·ç™»å½•ï¼š</em></p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">useradd sonar</span><br><span class="line">passwd sonar</span><br><span class="line">su sonar</span><br></pre></td></tr></table></figure><h3 id="å®‰è£…mysqlæ•°æ®åº“ï¼Œåˆ›å»ºsonaråº“"><a href="#å®‰è£…mysqlæ•°æ®åº“ï¼Œåˆ›å»ºsonaråº“" class="headerlink" title="å®‰è£…mysqlæ•°æ®åº“ï¼Œåˆ›å»ºsonaråº“"></a>å®‰è£…mysqlæ•°æ®åº“ï¼Œåˆ›å»ºsonaråº“</h3><p>1ã€mysqlçš„å®‰è£…æ­¥éª¤ï¼š<a href="/2018/05/27/2018052701/">è®°å½•Linuxå®‰è£…Mysqlå…¨è¿‡ç¨‹</a></p><p>2ã€åˆ›å»ºsonaråº“</p><p>â€‹    åˆ›å»ºsonaræ•°æ®åº“ï¼Œç”¨äºä¿å­˜soanrqubeçš„æ‰«ææ•°æ®</p><h3 id="å®‰è£…sonarqube"><a href="#å®‰è£…sonarqube" class="headerlink" title="å®‰è£…sonarqube"></a>å®‰è£…sonarqube</h3><p>1ã€å°†sonar6.7.7å®‰è£…åŒ…æ‹‰åˆ°<code>/opt/SonarQube</code>ç›®å½•</p><p>2ã€è§£å‹</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">unzip sonarqube-6.7.7.zip</span><br></pre></td></tr></table></figure><p>3ã€ä¿®æ”¹é…ç½®</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">vi ./sonarqube-6.7.7/conf/sonar.properties</span><br></pre></td></tr></table></figure><p>æ·»åŠ mysqlé…ç½®ï¼š</p><figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="comment">#--------------------------------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># DATABASE</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># User credentials.</span></span><br><span class="line"><span class="comment"># Permissions to create tables, indices and triggers must be granted to JDBC user.</span></span><br><span class="line"><span class="comment"># The schema must be created first.</span></span><br><span class="line"><span class="meta">sonar.jdbc.username</span>=<span class="string">sonar</span></span><br><span class="line"><span class="meta">sonar.jdbc.password</span>=<span class="string">*******</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#----- MySQL 5.6 or greater</span></span><br><span class="line"><span class="comment"># Only InnoDB storage engine is supported (not myISAM).</span></span><br><span class="line"><span class="comment"># Only the bundled driver is supported. It can not be changed.</span></span><br><span class="line"><span class="meta">sonar.jdbc.url</span>=<span class="string">jdbc:mysql://localhost:3306/sonar?useUnicode=true&amp;characterEncoding=utf8&amp;rewriteBatchedStatements=true&amp;useConfigs=maxPerformance&amp;useSSL=false</span></span><br></pre></td></tr></table></figure><blockquote><p>çœç•¥äº†ä¸éœ€è¦å±•ç¤ºçš„éƒ¨åˆ†</p></blockquote><h3 id="åˆ›å»ºè½¯è¿æ¥"><a href="#åˆ›å»ºè½¯è¿æ¥" class="headerlink" title="åˆ›å»ºè½¯è¿æ¥"></a>åˆ›å»ºè½¯è¿æ¥</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ln -s /opt/SonarQube/sonarqube-6.7.7/bin/linux-x86-64/sonar.sh /usr/bin/sonar</span><br></pre></td></tr></table></figure><h3 id="è¿è¡Œsonar"><a href="#è¿è¡Œsonar" class="headerlink" title="è¿è¡Œsonar"></a>è¿è¡Œsonar</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sonar start</span><br></pre></td></tr></table></figure><p>é‡å¯ <code>sonar restart</code></p><p>åœæ­¢ <code>sonar stop</code></p><p>æŸ¥çœ‹çŠ¶æ€ <code>sonar status</code></p><h3 id="å¯èƒ½é‡åˆ°çš„é—®é¢˜"><a href="#å¯èƒ½é‡åˆ°çš„é—®é¢˜" class="headerlink" title="å¯èƒ½é‡åˆ°çš„é—®é¢˜"></a>å¯èƒ½é‡åˆ°çš„é—®é¢˜</h3><ul><li><p>æ²¡æœ‰ç›®å½•æƒé™ï¼š</p><p><em>å°†ç›®å½•æˆæƒç»™sonarç”¨æˆ·:</em></p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">su root</span><br><span class="line">chown -R sonar /opt/SonarQube</span><br></pre></td></tr></table></figure></li><li><p>æ²¡æœ‰æ“ä½œæƒé™</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">chmod a+x /opt/SonarQube/sonarqube-6.7.7/bin/linux-x86-64/sonar.sh</span><br><span class="line">chmod a+x /opt/SonarQube/sonarqube-6.7.7/bin/linux-x86-64/wrapper</span><br><span class="line">chmod a+x /opt/SonarQube/sonarqube-6.7.7/elasticsearch/bin/elasticsearch</span><br></pre></td></tr></table></figure></li><li><p>æ•°æ®åº“é—®é¢˜</p><p><em>å½•æ•°æ®åº“åæ‰§è¡Œï¼š</em></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">SET GLOBAL max_allowed_packet &#x3D; 4*1024*1024*16</span><br></pre></td></tr></table></figure></li></ul><h2 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h2><h3 id="Java"><a href="#Java" class="headerlink" title="Java"></a>Java</h3><p>æ‰«æJavaçš„mavené¡¹ç›®ï¼Œé¦–å…ˆè¦åœ¨<code>pom.xml</code>ä¸­æ·»åŠ é…ç½®ï¼š</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.sonarsource.scanner.maven<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>sonar-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.3.0.603<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="ä½¿ç”¨logintokenæ‰«æ"><a href="#ä½¿ç”¨logintokenæ‰«æ" class="headerlink" title="ä½¿ç”¨logintokenæ‰«æ"></a>ä½¿ç”¨logintokenæ‰«æ</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">mvn sonar:sonar \</span><br><span class="line">  -Dsonar.host.url=http://10.0.2.91:9000 \</span><br><span class="line">  -Dsonar.login=youtoken</span><br></pre></td></tr></table></figure><p>å…¶ä¸­<code>youtoken</code>å¯ä»¥åœ¨ç™»å½•sonaråå°åæ‰¾åˆ°ï¼š<code>æˆ‘çš„è´¦å· - å®‰å…¨</code></p><p><img src="https://gitee.com/cayzlh/img-repo/raw/master/2020/05/29/1_bxS48X.png" alt="token"></p><h4 id="è®¾ç½®settings-xmlæ‰«æ"><a href="#è®¾ç½®settings-xmlæ‰«æ" class="headerlink" title="è®¾ç½®settings.xmlæ‰«æ"></a>è®¾ç½®settings.xmlæ‰«æ</h4><p> ä¿®æ”¹æœ¬åœ°mavençš„<code>settings.xml</code>æ–‡ä»¶ï¼Œæ·»åŠ é…ç½®ï¼š</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">pluginGroups</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">pluginGroup</span>&gt;</span>org.sonarsource.scanner.maven<span class="tag">&lt;/<span class="name">pluginGroup</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">pluginGroups</span>&gt;</span></span><br></pre></td></tr></table></figure><hr><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">profiles</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">profile</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span>&gt;</span>sonar<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">activation</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">activeByDefault</span>&gt;</span>true<span class="tag">&lt;/<span class="name">activeByDefault</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">activation</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- é…ç½® Sonar Hoståœ°å€ï¼Œé»˜è®¤ï¼šhttp://localhost:9000 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">sonar.host.url</span>&gt;</span></span><br><span class="line">                http://10.0.2.91:9000</span><br><span class="line">            <span class="tag">&lt;/<span class="name">sonar.host.url</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">profile</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">profiles</span>&gt;</span></span><br></pre></td></tr></table></figure><p>ç„¶åæ‰§è¡Œï¼š</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">mvn clean verify sonar:sonar</span><br></pre></td></tr></table></figure><p>æˆ–</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">mvn clean install sonar:sonar</span><br></pre></td></tr></table></figure><p>æˆ–</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">mvn clean -Dmaven.test.skip=<span class="literal">true</span> verify sonar:sonar</span><br></pre></td></tr></table></figure><p>æˆ–åœ¨IDEAä¸­æ‰§è¡Œmavenæ’ä»¶ï¼š</p><p><img src="https://gitee.com/cayzlh/img-repo/raw/master/2020/05/29/2_HhJkOr.png" alt="idea sonar plugin"></p><h4 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h4><p>æ‰«æå®Œæˆåï¼Œç™»å½•sonaråå°ï¼Œå°†å¯ä»¥çœ‹åˆ°æœ¬æ¬¡æ‰«æçš„é¡¹ç›®ï¼Œå’Œç›¸åº”çš„åˆ†æï¼š</p><p><img src="https://gitee.com/cayzlh/img-repo/raw/master/2020/05/29/3_TTSvPo.png" alt="sonar"></p><h4 id="over"><a href="#over" class="headerlink" title="over"></a>over</h4><p> ^_^.</p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul><li><a href="https://blog.csdn.net/aixiaoyang168/article/details/77565756">SonarQube çš„å®‰è£…ã€é…ç½®åŠ Maven é¡¹ç›®çš„ä½¿ç”¨</a></li><li><a href="https://www.sonarqube.org/">SonarQubeå®˜ç½‘</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®°æœ¬ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> SonarQube </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä½¿ç”¨Springè¯»å–æ–‡ä»¶çš„å‡ ç§æ–¹å¼</title>
      <link href="post/1399731042/"/>
      <url>post/1399731042/</url>
      
        <content type="html"><![CDATA[<h2 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h2><p>åœ¨ä¸šåŠ¡å¼€å‘ä¸­ç»å¸¸æœ‰å¯èƒ½è¯»å–ä¸€äº›è‡ªå®šä¹‰é…ç½®æˆ–è€…æ–‡ä»¶ã€‚æ¯”å¦‚è¯´å…¬ç§é’¥æ–‡ä»¶ã€ä¸€äº›å›ºå®šçš„è¯å…¸æ–‡ä»¶ä¹‹ç±»çš„ï¼Œè¿™ä¸€ç±»ç»Ÿç§°ä¸ºèµ„æºï¼ˆResourceï¼‰ã€‚Springè‡ªå¸¦æœ‰èµ„æºåŠ è½½åŠŸèƒ½ï¼Œç”šè‡³è¿˜æœ‰éå¸¸ä¾¿åˆ©çš„æ–¹æ³•å°†è¯»å–çš„å†…å®¹æ³¨å…¥Spring beanã€‚</p><blockquote><p>æ•´ç†ç½‘ç»œä¸Šç›¸å…³æ–¹æ³•ä¸è‡ªèº«å®è·µçš„å®è·µ</p></blockquote><h2 id="é€šè¿‡Resourceæ¥å£è¯»å–æ–‡ä»¶"><a href="#é€šè¿‡Resourceæ¥å£è¯»å–æ–‡ä»¶" class="headerlink" title="é€šè¿‡Resourceæ¥å£è¯»å–æ–‡ä»¶"></a>é€šè¿‡Resourceæ¥å£è¯»å–æ–‡ä»¶</h2><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨<strong>org.springframework.core.io.Resource</strong>æ¥å£ç®€åŒ–èµ„æºæ–‡ä»¶çš„å®šä½ã€‚Springå¸®åŠ©æˆ‘ä»¬ä½¿ç”¨èµ„æºåŠ è½½å™¨æŸ¥æ‰¾å’Œè¯»å–èµ„æºï¼Œèµ„æºåŠ è½½å™¨æ ¹æ®æä¾›çš„è·¯å¾„å†³å®šé€‰æ‹©å“ªä¸ªResourceå®ç°ã€‚</p><h3 id="ä½¿ç”¨Resourceçš„å®ç°ç±»"><a href="#ä½¿ç”¨Resourceçš„å®ç°ç±»" class="headerlink" title="ä½¿ç”¨Resourceçš„å®ç°ç±»"></a>ä½¿ç”¨Resourceçš„å®ç°ç±»</h3><p> <strong>org.springframework.core.io.Resource</strong>æ¥å£å¸¸ç”¨çš„æœ‰ä¸¤ä¸ªå®ç°ç±»ï¼š</p><ul><li><p>org.springframework.core.io.ClassPathResource</p><p>ç”¨æ¥åŠ è½½<code>classpath</code>ä¸‹çš„èµ„æºï¼Œç›´æ¥è¯»å–<code>springboot</code> é…ç½®æ–‡ä»¶ <code>application.properties</code>,å…¶ä¸­å·²ç»å†™å…¥äº†ä¸€ä¸ªé…ç½® <code>server.port=8080</code></p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">classPathResourceTest</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    Resource resource = <span class="keyword">new</span> ClassPathResource(<span class="string">&quot;application.properties&quot;</span>);</span><br><span class="line">    InputStream inputStream = resource.getInputStream();</span><br><span class="line">    Properties properties = <span class="keyword">new</span> Properties();</span><br><span class="line">    properties.load(inputStream);</span><br><span class="line">    properties.forEach((o, o2) -&gt; &#123;</span><br><span class="line">        Assertions.assertThat(o).isEqualTo(<span class="string">&quot;server.address&quot;</span>);</span><br><span class="line">        Assertions.assertThat(o2).isEqualTo(<span class="string">&quot;8080&quot;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>org.springframework.core.io.FileSystemResource</p><p>ç”¨æ¥åŠ è½½ç³»ç»Ÿæ–‡ä»¶ï¼Œé€šå¸¸é€šè¿‡æ–‡ä»¶çš„ç»å¯¹å€¼æˆ–è€…ç›¸å¯¹è·¯å¾„æ¥è¯»å–ã€‚<em>éœ€è¦æ–‡ä»¶çš„è·¯å¾„ã€‚</em></p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">fileResourceTest</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    String path = <span class="string">&quot;/workspaces/springboot-demo/src/main/resources/application.properties&quot;</span>;</span><br><span class="line">    FileSystemResource resource = <span class="keyword">new</span> FileSystemResource(path);</span><br><span class="line">    InputStream inputStream = resource.getInputStream();</span><br><span class="line">    Properties properties = <span class="keyword">new</span> Properties();</span><br><span class="line">    properties.load(inputStream);</span><br><span class="line">  properties.forEach((o,o2) -&gt; &#123;</span><br><span class="line">        Assertions.assertThat(o).isEqualTo(<span class="string">&quot;server.adderss&quot;</span>);</span><br><span class="line">        Assertions.assertThat(o2).isEqualTo(<span class="string">&quot;8080&quot;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h3 id="ä½¿ç”¨ResourceLoader"><a href="#ä½¿ç”¨ResourceLoader" class="headerlink" title="ä½¿ç”¨ResourceLoader"></a>ä½¿ç”¨ResourceLoader</h3><p>ä½¿ç”¨<code>ResourceLoader</code>å¯ä»¥å®ç°å»¶è¿ŸåŠ è½½ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">resourceLoaderTest</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    ResourceLoader resourceLoader = <span class="keyword">new</span> DefaultResourceLoader();</span><br><span class="line">    String location = <span class="string">&quot;application.properties&quot;</span>;</span><br><span class="line">    Resource resource = resourceLoader.getResource(location);</span><br><span class="line">    InputStream is = resource.getInputStream();</span><br><span class="line">    Properties properties = <span class="keyword">new</span> Properties();</span><br><span class="line">    properties.load(is);</span><br><span class="line">    properties.forEach((o,o2) -&gt; &#123;</span><br><span class="line">        Assertions.assertThat(o).isEqualTo(<span class="string">&quot;server.adderss&quot;</span>);</span><br><span class="line">        Assertions.assertThat(o2).isEqualTo(<span class="string">&quot;8080&quot;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥ä½¿ç”¨<code>@Autowired</code>å°†<code>ResourceLoader</code>æ³¨å…¥ä¸º<code>bean</code>.</p><h3 id="ä½¿ç”¨-Valueæ³¨è§£"><a href="#ä½¿ç”¨-Valueæ³¨è§£" class="headerlink" title="ä½¿ç”¨@Valueæ³¨è§£"></a>ä½¿ç”¨@Valueæ³¨è§£</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Value(&quot;classpath:application.properties&quot;)</span></span><br><span class="line"><span class="keyword">private</span> Resource resource;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">resourceLoader</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    InputStream inputStream = resource.getInputStream;</span><br><span class="line">    Properties properties = <span class="keyword">new</span> Properties();</span><br><span class="line">    properties.load(inputStream);</span><br><span class="line">    </span><br><span class="line">    properties.forEach((o,o2) -&gt; &#123;</span><br><span class="line">        Assertions.assertThat(o).isEqualTo(<span class="string">&quot;server.adderss&quot;</span>);</span><br><span class="line">        Assertions.assertThat(o2).isEqualTo(<span class="string">&quot;8080&quot;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>^_^.</p>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®°æœ¬ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Spring </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Mavenä¸­Scopeçš„åˆ†ç±»</title>
      <link href="post/928941173/"/>
      <url>post/928941173/</url>
      
        <content type="html"><![CDATA[<h1 id="Scopeçš„åˆ†ç±»"><a href="#Scopeçš„åˆ†ç±»" class="headerlink" title="Scopeçš„åˆ†ç±»"></a>Scopeçš„åˆ†ç±»</h1><h2 id="compile"><a href="#compile" class="headerlink" title="compile"></a>compile</h2><p><strong>é»˜è®¤å°±æ˜¯compile</strong>ï¼Œä»€ä¹ˆéƒ½ä¸é…ç½®ä¹Ÿå°±æ˜¯æ„å‘³ç€compileã€‚compileè¡¨ç¤ºè¢«ä¾èµ–é¡¹ç›®éœ€è¦å‚ä¸å½“å‰é¡¹ç›®çš„ç¼–è¯‘ï¼Œå½“ç„¶åç»­çš„æµ‹è¯•ï¼Œè¿è¡Œå‘¨æœŸä¹Ÿå‚ä¸å…¶ä¸­ï¼Œæ˜¯ä¸€ä¸ªæ¯”è¾ƒå¼ºçš„ä¾èµ–ã€‚æ‰“åŒ…çš„æ—¶å€™é€šå¸¸éœ€è¦åŒ…å«è¿›å»ã€‚</p><h2 id="test"><a href="#test" class="headerlink" title="test"></a>test</h2><p>scopeä¸ºtestè¡¨ç¤ºä¾èµ–é¡¹ç›®ä»…ä»…å‚ä¸æµ‹è¯•ç›¸å…³çš„å·¥ä½œï¼ŒåŒ…æ‹¬æµ‹è¯•ä»£ç çš„ç¼–è¯‘ï¼Œæ‰§è¡Œã€‚æ¯”è¾ƒå…¸å‹çš„å¦‚junitã€‚</p><h2 id="runntime"><a href="#runntime" class="headerlink" title="runntime"></a>runntime</h2><p>runntimeè¡¨ç¤ºè¢«ä¾èµ–é¡¹ç›®æ— éœ€å‚ä¸é¡¹ç›®çš„ç¼–è¯‘ï¼Œä¸è¿‡åæœŸçš„æµ‹è¯•å’Œè¿è¡Œå‘¨æœŸéœ€è¦å…¶å‚ä¸ã€‚ä¸compileç›¸æ¯”ï¼Œ<strong>è·³è¿‡ç¼–è¯‘</strong>è€Œå·²ï¼Œè¯´å®è¯åœ¨ç»ˆç«¯çš„é¡¹ç›®ï¼ˆéå¼€æºï¼Œä¼ä¸šå†…éƒ¨ç³»ç»Ÿï¼‰ä¸­ï¼Œå’ŒcompileåŒºåˆ«ä¸æ˜¯å¾ˆå¤§ã€‚æ¯”è¾ƒå¸¸è§çš„å¦‚JSRÃ—Ã—Ã—çš„å®ç°ï¼Œå¯¹åº”çš„API jaræ˜¯compileçš„ï¼Œå…·ä½“å®ç°æ˜¯runtimeçš„ï¼Œcompileåªéœ€è¦çŸ¥é“æ¥å£å°±è¶³å¤Ÿäº†ã€‚oracle jdbcé©±åŠ¨æ¶åŒ…å°±æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„ä¾‹å­ï¼Œä¸€èˆ¬scopeä¸ºrunntimeã€‚å¦å¤–runntimeçš„ä¾èµ–é€šå¸¸å’Œoptionalæ­é…ä½¿ç”¨ï¼Œoptionalä¸ºtrueã€‚æˆ‘å¯ä»¥ç”¨Aå®ç°ï¼Œä¹Ÿå¯ä»¥ç”¨Bå®ç°ã€‚</p><h2 id="provided"><a href="#provided" class="headerlink" title="provided"></a>provided</h2><p>providedæ„å‘³ç€æ‰“åŒ…çš„æ—¶å€™å¯ä»¥ä¸ç”¨åŒ…è¿›å»ï¼Œåˆ«çš„è®¾æ–½(Web Container)ä¼šæä¾›ã€‚äº‹å®ä¸Šè¯¥ä¾èµ–ç†è®ºä¸Šå¯ä»¥å‚ä¸ç¼–è¯‘ï¼Œæµ‹è¯•ï¼Œè¿è¡Œç­‰å‘¨æœŸã€‚ç›¸å½“äºcompileï¼Œä½†æ˜¯åœ¨æ‰“åŒ…é˜¶æ®µåšäº†excludeçš„åŠ¨ä½œã€‚</p><h2 id="system"><a href="#system" class="headerlink" title="system"></a>system</h2><p>ä»å‚ä¸åº¦æ¥è¯´ï¼Œä¹Ÿprovidedç›¸åŒï¼Œä¸è¿‡è¢«ä¾èµ–é¡¹ä¸ä¼šä»mavenä»“åº“æŠ“ï¼Œè€Œæ˜¯ä»æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿæ‹¿ï¼Œä¸€å®šéœ€<strong>è¦é…åˆsystemPathå±æ€§ä½¿ç”¨</strong>ã€‚</p><h2 id="scopeçš„ä¾èµ–ä¼ é€’"><a href="#scopeçš„ä¾èµ–ä¼ é€’" class="headerlink" title="scopeçš„ä¾èµ–ä¼ é€’"></a>scopeçš„ä¾èµ–ä¼ é€’</h2><p>Aâ€“&gt;Bâ€“&gt;Cã€‚å½“å‰é¡¹ç›®ä¸ºAï¼ŒAä¾èµ–äºBï¼ŒBä¾èµ–äºCã€‚çŸ¥é“Båœ¨Aé¡¹ç›®ä¸­çš„scopeï¼Œé‚£ä¹ˆæ€ä¹ˆçŸ¥é“Cåœ¨Aä¸­çš„scopeå‘¢ï¼Ÿç­”æ¡ˆæ˜¯ï¼š<br> å½“Cæ˜¯testæˆ–è€…providedæ—¶ï¼ŒCç›´æ¥è¢«ä¸¢å¼ƒï¼ŒAä¸ä¾èµ–Cï¼›<br> å¦åˆ™Aä¾èµ–Cï¼ŒCçš„scopeç»§æ‰¿äºBçš„scopeã€‚</p><h2 id="import"><a href="#import" class="headerlink" title="import"></a>import</h2><p>åœ¨åšSpringBootåº”ç”¨çš„æ—¶å€™ï¼Œéƒ½ä¼šæœ‰å¦‚ä¸‹ä»£ç ï¼š</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>1.3.3.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br></pre></td></tr></table></figure><p>ç»§æ‰¿ä¸€ä¸ªçˆ¶æ¨¡å—ï¼Œç„¶åå†å¼•å…¥ç›¸åº”çš„ä¾èµ–ã€‚</p><p>ä½†æ˜¯ä¸€èˆ¬æ¥è¯´ï¼Œè‡ªå·±çš„é¡¹ç›®ä¸ä¼šç”¨springbootä½œä¸ºçˆ¶mavenï¼›Mavençš„ç»§æ‰¿å’ŒJavaçš„ç»§æ‰¿ä¸€æ ·ï¼Œæ˜¯æ— æ³•å®ç°å¤šé‡ç»§æ‰¿çš„ï¼Œå¦‚æœ10ä¸ªã€20ä¸ªç”šè‡³æ›´å¤šæ¨¡å—ç»§æ‰¿è‡ªåŒä¸€ä¸ªæ¨¡å—ï¼Œé‚£ä¹ˆæŒ‰ç…§æˆ‘ä»¬ä¹‹å‰çš„åšæ³•ï¼Œè¿™ä¸ªçˆ¶æ¨¡å—çš„dependencyManagementä¼šåŒ…å«å¤§é‡çš„ä¾èµ–ã€‚å¦‚æœä½ æƒ³æŠŠè¿™äº›ä¾èµ–åˆ†ç±»ä»¥æ›´æ¸…æ™°çš„ç®¡ç†ï¼Œé‚£å°±ä¸å¯èƒ½äº†ï¼Œimport scopeä¾èµ–èƒ½è§£å†³è¿™ä¸ªé—®é¢˜ã€‚ä½ å¯ä»¥æŠŠdependencyManagementæ”¾åˆ°å•ç‹¬çš„ä¸“é—¨ç”¨æ¥ç®¡ç†ä¾èµ–çš„pomä¸­ï¼Œç„¶ååœ¨éœ€è¦ä½¿ç”¨ä¾èµ–çš„æ¨¡å—ä¸­é€šè¿‡import scopeä¾èµ–ï¼Œå°±å¯ä»¥å¼•å…¥dependencyManagementã€‚ä¾‹å¦‚å¯ä»¥å†™è¿™æ ·ä¸€ä¸ªç”¨äºä¾èµ–ç®¡ç†çš„pomï¼š</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">project</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.test.sample<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>base-parent1<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">packaging</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactid</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>4.8.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactid</span>&gt;</span>log4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.16<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><p>ç„¶åæˆ‘å°±å¯ä»¥é€šè¿‡éç»§æ‰¿çš„æ–¹å¼æ¥å¼•å…¥è¿™æ®µä¾èµ–ç®¡ç†é…ç½®</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.test.sample<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactid</span>&gt;</span>base-parent1<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactid</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactid</span>&gt;</span>log4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>æ³¨æ„ï¼šimport scopeåªèƒ½ç”¨åœ¨dependencyManagementé‡Œé¢</p></blockquote><p>çˆ¶æ¨¡å—çš„pomå°±ä¼šéå¸¸å¹²å‡€ï¼Œç”±ä¸“é—¨çš„packagingä¸ºpomæ¥ç®¡ç†ä¾èµ–ï¼Œä¹Ÿå¥‘åˆçš„é¢å‘å¯¹è±¡è®¾è®¡ä¸­çš„å•ä¸€èŒè´£åŸåˆ™ã€‚æ­¤å¤–ï¼Œè¿˜èƒ½å¤Ÿåˆ›å»ºå¤šä¸ªè¿™æ ·çš„ä¾èµ–ç®¡ç†pomï¼Œä»¥æ›´ç»†åŒ–çš„æ–¹å¼ç®¡ç†ä¾èµ–ã€‚è¿™ç§åšæ³•ä¸é¢å‘å¯¹è±¡è®¾è®¡ä¸­ä½¿ç”¨ç»„åˆè€Œéç»§æ‰¿ä¹Ÿæœ‰ç‚¹ç›¸ä¼¼çš„å‘³é“ã€‚</p><p>ç”¨è¿™ä¸ªæ–¹æ³•æ¥è§£å†³SpringBootçš„é‚£ä¸ªç»§æ‰¿é—®é¢˜ï¼š</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>1.3.3.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><p>è¿™æ ·é…ç½®çš„è¯ï¼Œè‡ªå·±çš„é¡¹ç›®é‡Œé¢å°±ä¸éœ€è¦ç»§æ‰¿SpringBootçš„moduleäº†ï¼Œè€Œå¯ä»¥ç»§æ‰¿è‡ªå·±é¡¹ç›®çš„moduleäº†ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®°æœ¬ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> Maven </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Springbooté›†æˆShiroï¼ˆå‰åç«¯åˆ†ç¦»ï¼‰</title>
      <link href="post/416884162/"/>
      <url>post/416884162/</url>
      
        <content type="html"><![CDATA[<h2 id="æ€ç»´å¯¼å›¾"><a href="#æ€ç»´å¯¼å›¾" class="headerlink" title="æ€ç»´å¯¼å›¾"></a>æ€ç»´å¯¼å›¾</h2><p><img src="https://github.com/cayzlh/git-img-repository/raw/master/blog/2019/04/1.png" alt="Shiro"></p><h2 id="ä»€ä¹ˆæ˜¯Shiro"><a href="#ä»€ä¹ˆæ˜¯Shiro" class="headerlink" title="ä»€ä¹ˆæ˜¯Shiro"></a>ä»€ä¹ˆæ˜¯Shiro</h2><p>shiroæ˜¯apacheçš„ä¸€ä¸ªå¼€æºæ¡†æ¶ï¼Œæ˜¯ä¸€ä¸ªæƒé™ç®¡ç†çš„æ¡†æ¶ï¼Œå®ç° ç”¨æˆ·è®¤è¯ã€ç”¨æˆ·æˆæƒã€‚</p><p>springä¸­æœ‰spring security (åŸåAcegi)ï¼Œæ˜¯ä¸€ä¸ªæƒé™æ¡†æ¶ï¼Œå®ƒå’Œspringä¾èµ–è¿‡äºç´§å¯†ï¼Œæ²¡æœ‰shiroä½¿ç”¨ç®€å•ã€‚</p><p>shiroä¸ä¾èµ–äºspringï¼Œshiroä¸ä»…å¯ä»¥å®ç° webåº”ç”¨çš„æƒé™ç®¡ç†ï¼Œè¿˜å¯ä»¥å®ç°c/sç³»ç»Ÿï¼Œåˆ†å¸ƒå¼ç³»ç»Ÿæƒé™ç®¡ç†ï¼Œshiroå±äºè½»é‡æ¡†æ¶ï¼Œè¶Šæ¥è¶Šå¤šä¼ä¸šé¡¹ç›®å¼€å§‹ä½¿ç”¨shiroã€‚ </p><p>ä½¿ç”¨shiroå®ç°ç³»ç»Ÿçš„æƒé™ç®¡ç†ï¼Œæœ‰æ•ˆæé«˜å¼€å‘æ•ˆç‡ï¼Œä»è€Œé™ä½å¼€å‘æˆæœ¬ã€‚</p><blockquote><p>ç”¨æˆ·é€šè¿‡subjectç™»é™†ï¼Œå½¢æˆä¸€ä¸ªUsernamePasswordTokenï¼Œä»¤ç‰Œï¼Œåœ¨åŸŸrealmé‡Œå®Œæˆè®¤è¯ã€æˆæƒï¼ŒæˆåŠŸååŠ å…¥ç¼“å­˜ã€‚ï¼ˆrealmå¯ä»¥å†™ã€ä¹Ÿå¯ä»¥ç”¨é»˜è®¤çš„ï¼Œä¹Ÿå¯ä»¥å†™å¾ˆå¤šä¸ªåŸŸï¼‰</p></blockquote><p><img src="https://github.com/cayzlh/git-img-repository/raw/master/blog/2019/04/3.png" alt="Shiro"></p><h2 id="Shiroæ¶æ„"><a href="#Shiroæ¶æ„" class="headerlink" title="Shiroæ¶æ„"></a>Shiroæ¶æ„</h2><p><img src="https://github.com/cayzlh/git-img-repository/raw/master/blog/2019/04/2.png" alt="Shiroæ¶æ„"></p><ul><li><p><strong>subjectï¼š</strong>ä¸»ä½“ï¼Œå¯ä»¥æ˜¯ç”¨æˆ·ä¹Ÿå¯ä»¥æ˜¯ç¨‹åºï¼Œä¸»ä½“è¦è®¿é—®ç³»ç»Ÿï¼Œç³»ç»Ÿéœ€è¦å¯¹ä¸»ä½“è¿›è¡Œè®¤è¯ã€æˆæƒã€‚</p></li><li><p><strong>securityManagerï¼š</strong>å®‰å…¨ç®¡ç†å™¨ï¼Œä¸»ä½“è¿›è¡Œè®¤è¯å’Œæˆæƒéƒ½æ˜¯é€šè¿‡securityManagerè¿›è¡Œã€‚</p></li><li><p><strong>authenticatorï¼š</strong>è®¤è¯å™¨ï¼Œä¸»ä½“è¿›è¡Œè®¤è¯æœ€ç»ˆé€šè¿‡authenticatorè¿›è¡Œçš„ã€‚</p></li><li><p><strong>authorizerï¼š</strong>æˆæƒå™¨ï¼Œä¸»ä½“è¿›è¡Œæˆæƒæœ€ç»ˆé€šè¿‡authorizerè¿›è¡Œçš„ã€‚</p></li><li><p><strong>sessionManagerï¼š</strong>webåº”ç”¨ä¸­ä¸€èˆ¬æ˜¯ç”¨webå®¹å™¨å¯¹sessionè¿›è¡Œç®¡ç†ï¼Œshiroä¹Ÿæä¾›ä¸€å¥—sessionç®¡ç†çš„æ–¹å¼ã€‚</p></li><li><p><strong>SessionDaoï¼š</strong>  é€šè¿‡SessionDaoç®¡ç†sessionæ•°æ®ï¼Œé’ˆå¯¹ä¸ªæ€§åŒ–çš„sessionæ•°æ®å­˜å‚¨éœ€è¦ä½¿ç”¨sessionDaoã€‚</p></li><li><p><strong>cache Managerï¼š</strong>ç¼“å­˜ç®¡ç†å™¨ï¼Œä¸»è¦å¯¹sessionå’Œæˆæƒæ•°æ®è¿›è¡Œç¼“å­˜ï¼Œæ¯”å¦‚å°†æˆæƒæ•°æ®é€šè¿‡cacheManagerè¿›è¡Œç¼“å­˜ç®¡ç†ï¼Œå’Œehcacheæ•´åˆå¯¹ç¼“å­˜æ•°æ®è¿›è¡Œç®¡ç†ã€‚</p></li><li><p><strong>realmï¼š</strong>åŸŸï¼Œé¢†åŸŸï¼Œç›¸å½“äºæ•°æ®æºï¼Œé€šè¿‡realmå­˜å–è®¤è¯ã€æˆæƒç›¸å…³æ•°æ®ã€‚</p><p><strong>åœ¨realmä¸­å­˜å‚¨æˆæƒå’Œè®¤è¯çš„é€»è¾‘ã€‚</strong></p></li></ul><h2 id="è®¤è¯è¿‡ç¨‹"><a href="#è®¤è¯è¿‡ç¨‹" class="headerlink" title="è®¤è¯è¿‡ç¨‹"></a>è®¤è¯è¿‡ç¨‹</h2><p><img src="https://github.com/cayzlh/git-img-repository/raw/master/blog/2019/04/4.png" alt="è®¤è¯è¿‡ç¨‹"></p><h3 id="è®¤è¯æ‰§è¡Œæµç¨‹"><a href="#è®¤è¯æ‰§è¡Œæµç¨‹" class="headerlink" title="è®¤è¯æ‰§è¡Œæµç¨‹"></a>è®¤è¯æ‰§è¡Œæµç¨‹</h3><p>1ã€é€šè¿‡inié…ç½®æ–‡ä»¶åˆ›å»ºsecurityManager</p><p>2ã€è°ƒç”¨subject.loginæ–¹æ³•ä¸»ä½“æäº¤è®¤è¯ï¼Œæäº¤çš„token</p><p>3ã€securityManagerè¿›è¡Œè®¤è¯ï¼ŒsecurityManageræœ€ç»ˆç”±ModularRealmAuthenticatorè¿›è¡Œè®¤è¯ã€‚</p><p>4ã€ModularRealmAuthenticatorè°ƒç”¨IniRealm(ç»™realmä¼ å…¥token) å»inié…ç½®æ–‡ä»¶ä¸­æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯</p><p>5ã€IniRealmæ ¹æ®è¾“å…¥çš„tokenï¼ˆUsernamePasswordTokenï¼‰ä» shiro.iniæŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯ï¼Œæ ¹æ®è´¦å·æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯ï¼ˆè´¦å·å’Œå¯†ç ï¼‰</p><pre><code>å¦‚æœæŸ¥è¯¢åˆ°ç”¨æˆ·ä¿¡æ¯ï¼Œå°±ç»™ModularRealmAuthenticatorè¿”å›ç”¨æˆ·ä¿¡æ¯ï¼ˆè´¦å·å’Œå¯†ç ï¼‰å¦‚æœæŸ¥è¯¢ä¸åˆ°ï¼Œå°±ç»™ModularRealmAuthenticatorè¿”å›null</code></pre><p>6ã€ModularRealmAuthenticatoræ¥æ”¶IniRealmè¿”å›Authenticationè®¤è¯ä¿¡æ¯</p><p><strong>å¦‚æœè¿”å›çš„è®¤è¯ä¿¡æ¯æ˜¯nullï¼ŒModularRealmAuthenticatoræŠ›å‡ºå¼‚å¸¸ï¼ˆorg.apache.shiro.authc.UnknownAccountExceptionï¼‰</strong></p><p><strong>å¦‚æœè¿”å›çš„è®¤è¯ä¿¡æ¯ä¸æ˜¯nullï¼ˆè¯´æ˜inirealmæ‰¾åˆ°äº†ç”¨æˆ·ï¼‰ï¼Œå¯¹IniRealmè¿”å›ç”¨æˆ·å¯†ç  ï¼ˆåœ¨iniæ–‡ä»¶ä¸­å­˜åœ¨ï¼‰<br>å’Œ tokenä¸­çš„å¯†ç  è¿›è¡Œå¯¹æ¯”ï¼Œå¦‚æœä¸ä¸€è‡´æŠ›å‡ºå¼‚å¸¸ï¼ˆorg.apache.shiro.authc.IncorrectCredentialsExceptionï¼‰</strong></p><h2 id="æˆæƒæµç¨‹"><a href="#æˆæƒæµç¨‹" class="headerlink" title="æˆæƒæµç¨‹"></a>æˆæƒæµç¨‹</h2><p><img src="https://github.com/cayzlh/git-img-repository/raw/master/blog/2019/04/5.png" alt="æˆæƒè¿‡ç¨‹"></p><p>1ã€å¯¹subjectè¿›è¡Œæˆæƒï¼Œè°ƒç”¨æ–¹æ³•isPermittedï¼ˆâ€permissionä¸²â€ï¼‰</p><p>2ã€SecurityManageræ‰§è¡Œæˆæƒï¼Œé€šè¿‡ModularRealmAuthorizeræ‰§è¡Œæˆæƒ</p><p>3ã€ModularRealmAuthorizeræ‰§è¡Œrealmï¼ˆè‡ªå®šä¹‰çš„Realmï¼‰ä»æ•°æ®åº“æŸ¥è¯¢æƒé™æ•°æ®</p><p><strong>è°ƒç”¨realmçš„æˆæƒæ–¹æ³•ï¼šdoGetAuthorizationInfo</strong></p><p>4ã€realmä»æ•°æ®åº“æŸ¥è¯¢æƒé™æ•°æ®ï¼Œè¿”å›ModularRealmAuthorizer</p><p>5ã€ModularRealmAuthorizerè°ƒç”¨PermissionResolverè¿›è¡Œæƒé™ä¸²æ¯”å¯¹</p><p>6ã€å¦‚æœæ¯”å¯¹åï¼ŒisPermittedä¸­â€permissionä¸²â€åœ¨realmæŸ¥è¯¢åˆ°æƒé™æ•°æ®ä¸­ï¼Œè¯´æ˜ç”¨æˆ·è®¿é—®permissionä¸²æœ‰æƒé™ï¼Œå¦åˆ™ æ²¡æœ‰æƒé™ï¼ŒæŠ›å‡ºå¼‚å¸¸ã€‚</p><h2 id="å®ç°"><a href="#å®ç°" class="headerlink" title="å®ç°"></a>å®ç°</h2><blockquote><p>ä»£ç åœ°å€ï¼š<a href="https://github.com/cayzlh/spring-boot-shiro-demo">https://github.com/cayzlh/spring-boot-shiro-demo</a></p></blockquote><h3 id="è‡ªå®šä¹‰Realm"><a href="#è‡ªå®šä¹‰Realm" class="headerlink" title="è‡ªå®šä¹‰Realm"></a>è‡ªå®šä¹‰Realm</h3><p><strong>CustRealmï¼š</strong></p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomRealm</span> <span class="keyword">extends</span> <span class="title">AuthorizingRealm</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="meta">@Lazy</span></span><br><span class="line">    <span class="keyword">private</span> AuthorizingService authorizingService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Shiro çš„æƒé™æˆæƒæ˜¯é€šè¿‡ç»§æ‰¿AuthorizingRealmæŠ½è±¡ç±»ï¼Œé‡è½½doGetAuthorizationInfo();</span></span><br><span class="line"><span class="comment">     * å½“è®¿é—®åˆ°é¡µé¢çš„æ—¶å€™ï¼Œé“¾æ¥é…ç½®äº†ç›¸åº”çš„æƒé™æˆ–è€… Shiro æ ‡ç­¾æ‰ä¼šæ‰§è¡Œæ­¤æ–¹æ³•å¦åˆ™ä¸ä¼šæ‰§è¡Œï¼Œ</span></span><br><span class="line"><span class="comment">     * æ‰€ä»¥å¦‚æœåªæ˜¯ç®€å•çš„èº«ä»½è®¤è¯æ²¡æœ‰æƒé™çš„æ§åˆ¶çš„è¯ï¼Œé‚£ä¹ˆè¿™ä¸ªæ–¹æ³•å¯ä»¥ä¸è¿›è¡Œå®ç°ï¼Œç›´æ¥è¿”å› null å³å¯ã€‚</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> principalCollection</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> AuthorizationInfo <span class="title">doGetAuthorizationInfo</span><span class="params">(PrincipalCollection principalCollection)</span> </span>&#123;</span><br><span class="line">        String username = (String) <span class="keyword">super</span>.getAvailablePrincipal(principalCollection);</span><br><span class="line">        SimpleAuthorizationInfo authorizationInfo = <span class="keyword">new</span> SimpleAuthorizationInfo();</span><br><span class="line">        Set&lt;String&gt; roles = authorizingService.findRoleListByUsername(username);</span><br><span class="line">        authorizationInfo.setRoles(roles);</span><br><span class="line">        roles.forEach(role -&gt; &#123;</span><br><span class="line">            Set&lt;String&gt; permissions = authorizingService.findPermissionsByRole(roles);</span><br><span class="line">            authorizationInfo.addStringPermissions(permissions);</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">return</span> authorizationInfo;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åœ¨è®¤è¯ã€æˆæƒå†…éƒ¨å®ç°æœºåˆ¶ä¸­éƒ½æœ‰æåˆ°ï¼Œæœ€ç»ˆå¤„ç†éƒ½å°†äº¤ç»™Realè¿›è¡Œå¤„ç†ã€‚</span></span><br><span class="line"><span class="comment">     * å› ä¸ºåœ¨ Shiro ä¸­ï¼Œæœ€ç»ˆæ˜¯é€šè¿‡ Realm æ¥è·å–åº”ç”¨ç¨‹åºä¸­çš„ç”¨æˆ·ã€è§’è‰²åŠæƒé™ä¿¡æ¯çš„ã€‚</span></span><br><span class="line"><span class="comment">     * é€šå¸¸æƒ…å†µä¸‹ï¼Œåœ¨ Realm ä¸­ä¼šç›´æ¥ä»æˆ‘ä»¬çš„æ•°æ®æºä¸­è·å– Shiro éœ€è¦çš„éªŒè¯ä¿¡æ¯ã€‚</span></span><br><span class="line"><span class="comment">     * å¯ä»¥è¯´ï¼ŒRealm æ˜¯ä¸“ç”¨äºå®‰å…¨æ¡†æ¶çš„ DAO. Shiro çš„è®¤è¯è¿‡ç¨‹æœ€ç»ˆä¼šäº¤ç”± Realm æ‰§è¡Œï¼Œ</span></span><br><span class="line"><span class="comment">     * è¿™æ—¶ä¼šè°ƒç”¨ Realm çš„getAuthenticationInfo(token)æ–¹æ³•ã€‚</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * è¯¥æ–¹æ³•ä¸»è¦æ‰§è¡Œä»¥ä¸‹æ“ä½œ:</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * 1ã€æ£€æŸ¥æäº¤çš„è¿›è¡Œè®¤è¯çš„ä»¤ç‰Œä¿¡æ¯</span></span><br><span class="line"><span class="comment">     * 2ã€æ ¹æ®ä»¤ç‰Œä¿¡æ¯ä»æ•°æ®æº(é€šå¸¸ä¸ºæ•°æ®åº“)ä¸­è·å–ç”¨æˆ·ä¿¡æ¯</span></span><br><span class="line"><span class="comment">     * 3ã€å¯¹ç”¨æˆ·ä¿¡æ¯è¿›è¡ŒåŒ¹é…éªŒè¯ã€‚</span></span><br><span class="line"><span class="comment">     * 4ã€éªŒè¯é€šè¿‡å°†è¿”å›ä¸€ä¸ªå°è£…äº†ç”¨æˆ·ä¿¡æ¯çš„AuthenticationInfoå®ä¾‹ã€‚</span></span><br><span class="line"><span class="comment">     * 5ã€éªŒè¯å¤±è´¥åˆ™æŠ›å‡ºAuthenticationExceptionå¼‚å¸¸ä¿¡æ¯ã€‚</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> authenticationToken</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> AuthenticationException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> AuthenticationInfo <span class="title">doGetAuthenticationInfo</span><span class="params">(AuthenticationToken authenticationToken)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> AuthenticationException </span>&#123;</span><br><span class="line">        UsernamePasswordToken token = (UsernamePasswordToken) authenticationToken;</span><br><span class="line">        String username = token.getUsername();</span><br><span class="line">        UserInfo user = authorizingService.selectByUserName(username);</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">null</span> == user) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> UnknownAccountException(<span class="string">&quot;doGetAuthenticationInfo() has an UnknownAccountException: &quot;</span>+username);</span><br><span class="line">        &#125;</span><br><span class="line">        String passwordInToken = <span class="keyword">new</span> String(token.getPassword());</span><br><span class="line">        String passwordInDb = user.getPassword();</span><br><span class="line">        <span class="keyword">if</span> (!StringUtils.equals(passwordInDb, passwordInToken)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IncorrectCredentialsException(<span class="string">&quot;doGetAuthenticationInfo() has an IncorrectCredentialsException: &quot;</span>+username);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> SimpleAuthenticationInfo(username, passwordInToken, ByteSource.Util.bytes(user.getSalt()), getName());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="è‡ªå®šä¹‰SessionManager"><a href="#è‡ªå®šä¹‰SessionManager" class="headerlink" title="è‡ªå®šä¹‰SessionManager"></a>è‡ªå®šä¹‰SessionManager</h3><p>åœ¨æˆ‘ä»¬é¡¹ç›®ä¸­ï¼Œ ç”±äºä½¿ç”¨å‰åç«¯åˆ†ç¦»çš„æ¶æ„ï¼Œæ‰€ä»¥è¦è‡ªå®šä¹‰Shiroçš„sessionç®¡ç†ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomSessionManager</span> <span class="keyword">extends</span> <span class="title">DefaultWebSessionManager</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String HEADER_TOKEN = <span class="string">&quot;token&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String REFERENCED_SESSION_ID_SOURCE = <span class="string">&quot;Stateless request&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CustomSessionManager</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> Serializable <span class="title">getSessionId</span><span class="params">(ServletRequest request, ServletResponse response)</span> </span>&#123;</span><br><span class="line">        String id = WebUtils.toHttp(request).getHeader(HEADER_TOKEN);</span><br><span class="line">        <span class="keyword">if</span> (!StringUtils.isEmpty(id)) &#123;</span><br><span class="line">            request.setAttribute(ShiroHttpServletRequest.REFERENCED_SESSION_ID_SOURCE, REFERENCED_SESSION_ID_SOURCE);</span><br><span class="line">            request.setAttribute(ShiroHttpServletRequest.REFERENCED_SESSION_ID, id);</span><br><span class="line">            request.setAttribute(ShiroHttpServletRequest.REFERENCED_SESSION_ID_IS_VALID, Boolean.TRUE);</span><br><span class="line">            <span class="keyword">return</span> id;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">super</span>.getSessionId(request, response);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é€šè¿‡ç›‘å¬è¯·æ±‚Headeré‡Œçš„tokenå­—æ®µï¼Œå¦‚æœæœ‰å€¼ï¼Œåˆ™ä½œä¸ºshiroçš„sessionidã€‚</p><h3 id="é…ç½®Shiro"><a href="#é…ç½®Shiro" class="headerlink" title="é…ç½®Shiro"></a>é…ç½®Shiro</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ShiroConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean(name = &quot;customRealm&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> CustomRealm <span class="title">customRealm</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> CustomRealm();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean(name = &quot;sessionManager&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> SessionManager <span class="title">sessionManager</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> CustomSessionManager();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean(name = &quot;securityManager&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> DefaultWebSecurityManager <span class="title">defaultWebSecurityManager</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        DefaultWebSecurityManager securityManager = <span class="keyword">new</span> DefaultWebSecurityManager();</span><br><span class="line"></span><br><span class="line">        securityManager.setRealm(customRealm());</span><br><span class="line">        securityManager.setSessionManager(sessionManager());</span><br><span class="line">        <span class="keyword">return</span> securityManager;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean(name = &quot;lifecycleBeanPostProcessor&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> LifecycleBeanPostProcessor <span class="title">lifecycleBeanPostProcessor</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> LifecycleBeanPostProcessor();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean(name = &quot;shiroFilter&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ShiroFilterFactoryBean <span class="title">shiroFilterFactoryBean</span><span class="params">(DefaultWebSecurityManager securityManager)</span> </span>&#123;</span><br><span class="line">        ShiroFilterFactoryBean shiroFilterFactoryBean = <span class="keyword">new</span> ShiroFilterFactoryBean();</span><br><span class="line">        shiroFilterFactoryBean.setSecurityManager(securityManager);</span><br><span class="line">        <span class="keyword">return</span> shiroFilterFactoryBean;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> DefaultAdvisorAutoProxyCreator <span class="title">advisorAutoProxyCreator</span><span class="params">()</span></span>&#123;</span><br><span class="line">        DefaultAdvisorAutoProxyCreator advisorAutoProxyCreator = <span class="keyword">new</span> DefaultAdvisorAutoProxyCreator();</span><br><span class="line">        advisorAutoProxyCreator.setProxyTargetClass(<span class="keyword">true</span>);</span><br><span class="line">        <span class="keyword">return</span> advisorAutoProxyCreator;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> AuthorizationAttributeSourceAdvisor <span class="title">authorizationAttributeSourceAdvisor</span><span class="params">(DefaultWebSecurityManager securityManager)</span> </span>&#123;</span><br><span class="line">        AuthorizationAttributeSourceAdvisor authorizationAttributeSourceAdvisor = <span class="keyword">new</span> AuthorizationAttributeSourceAdvisor();</span><br><span class="line">        authorizationAttributeSourceAdvisor.setSecurityManager(securityManager);</span><br><span class="line">        <span class="keyword">return</span> authorizationAttributeSourceAdvisor;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…¶ä¸­ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> DefaultAdvisorAutoProxyCreator <span class="title">advisorAutoProxyCreator</span><span class="params">()</span></span>&#123;</span><br><span class="line">    DefaultAdvisorAutoProxyCreator advisorAutoProxyCreator = <span class="keyword">new</span> DefaultAdvisorAutoProxyCreator();</span><br><span class="line">    advisorAutoProxyCreator.setProxyTargetClass(<span class="keyword">true</span>);</span><br><span class="line">    <span class="keyword">return</span> advisorAutoProxyCreator;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> AuthorizationAttributeSourceAdvisor <span class="title">authorizationAttributeSourceAdvisor</span><span class="params">(DefaultWebSecurityManager securityManager)</span> </span>&#123;</span><br><span class="line">    AuthorizationAttributeSourceAdvisor authorizationAttributeSourceAdvisor = <span class="keyword">new</span> AuthorizationAttributeSourceAdvisor();</span><br><span class="line">    authorizationAttributeSourceAdvisor.setSecurityManager(securityManager);</span><br><span class="line">    <span class="keyword">return</span> authorizationAttributeSourceAdvisor;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>åœ¨spring bootä¸­ï¼Œ shiroä½¿ç”¨@RequiresRoles,@RequiresPermissionsæ³¨è§£æ— æ•ˆæ—¶ï¼Œéœ€è¦æ·»åŠ è¿™ä¸¤ä¸ªé…ç½®ã€‚</strong></p><h3 id="å…¶ä»–ä»£ç "><a href="#å…¶ä»–ä»£ç " class="headerlink" title="å…¶ä»–ä»£ç "></a>å…¶ä»–ä»£ç </h3><p><strong>AuthorizingServiceï¼š</strong></p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AuthorizingService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserDao userDao;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RoleDao roleDao;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> PermissionDao permissionDao;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> UserInfo <span class="title">selectByUserName</span><span class="params">(String username)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> userDao.selectByUsername(username);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Set&lt;String&gt; <span class="title">findRoleListByUsername</span><span class="params">(String username)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> roleDao.selectByUsername(username);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Set&lt;String&gt; <span class="title">findPermissionsByRole</span><span class="params">(Set&lt;String&gt; roles)</span> </span>&#123;</span><br><span class="line">        HashSet&lt;String&gt; permissions = Sets.newHashSet();</span><br><span class="line">        roles.forEach(role -&gt; permissions.addAll(permissionDao.selectByRole(role)));</span><br><span class="line">        <span class="keyword">return</span> permissions;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">login</span><span class="params">(String username, String password)</span> </span>&#123;</span><br><span class="line">        UsernamePasswordToken token = <span class="keyword">new</span> UsernamePasswordToken(username,</span><br><span class="line">                password);</span><br><span class="line">        Subject currentUser = SecurityUtils.getSubject();</span><br><span class="line">        currentUser.login(token);</span><br><span class="line">        currentUser.getSession().setTimeout(<span class="number">60</span> * <span class="number">60</span> * <span class="number">1000</span>);</span><br><span class="line">        <span class="keyword">return</span> currentUser.getSession().getId().toString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">logout</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Subject currentUser = SecurityUtils.getSubject();</span><br><span class="line">        currentUser.logout();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>PermissionDaoï¼š</strong></p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PermissionDao</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Set&lt;String&gt; <span class="title">selectByRole</span><span class="params">(String role)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">switch</span> (role) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;admin&quot;</span>:</span><br><span class="line">                <span class="keyword">return</span> Sets.newHashSet(<span class="string">&quot;Idea&quot;</span>, <span class="string">&quot;navicat&quot;</span>, <span class="string">&quot;notepad&quot;</span>, <span class="string">&quot;webstorm&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;chrome&quot;</span>);</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;java&quot;</span>:</span><br><span class="line">                <span class="keyword">return</span> Sets.newHashSet(<span class="string">&quot;Idea&quot;</span>);</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;mysql&quot;</span>:</span><br><span class="line">                <span class="keyword">return</span> Sets.newHashSet(<span class="string">&quot;navicat&quot;</span>);</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;html&quot;</span>:</span><br><span class="line">                <span class="keyword">return</span> Sets.newHashSet(<span class="string">&quot;notepad&quot;</span>);</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;javascript&quot;</span>:</span><br><span class="line">                <span class="keyword">return</span> Sets.newHashSet(<span class="string">&quot;webstorm&quot;</span>);</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;guest&quot;</span>:</span><br><span class="line">                <span class="keyword">return</span> Sets.newHashSet(<span class="string">&quot;chrome&quot;</span>);</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="keyword">return</span> Sets.newHashSet();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>RoleDaoï¼š</strong></p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RoleDao</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Set&lt;String&gt; <span class="title">selectByUsername</span><span class="params">(String username)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">switch</span> (username) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;zhangsan&quot;</span>:</span><br><span class="line">                <span class="keyword">return</span> Sets.newHashSet(<span class="string">&quot;admin&quot;</span>);</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;lisi&quot;</span>:</span><br><span class="line">                <span class="keyword">return</span> Sets.newHashSet(<span class="string">&quot;java&quot;</span>, <span class="string">&quot;mysql&quot;</span>);</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;wangwu&quot;</span>:</span><br><span class="line">                <span class="keyword">return</span> Sets.newHashSet(<span class="string">&quot;html&quot;</span>, <span class="string">&quot;javascript&quot;</span>);</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="keyword">return</span> Sets.newHashSet(<span class="string">&quot;guest&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>UserDaoï¼š</strong></p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserDao</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> UserInfo <span class="title">selectByUsername</span><span class="params">(String username)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">switch</span> (username) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;zhangsan&quot;</span>:</span><br><span class="line">                <span class="keyword">return</span> UserInfo.builder()</span><br><span class="line">                        .userName(<span class="string">&quot;zhangsan&quot;</span>).password(<span class="string">&quot;123456&quot;</span>).salt(<span class="string">&quot;123456&quot;</span>)</span><br><span class="line">                        .build();</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;lisi&quot;</span>:</span><br><span class="line">                <span class="keyword">return</span> UserInfo.builder()</span><br><span class="line">                        .userName(<span class="string">&quot;lisi&quot;</span>).password(<span class="string">&quot;123456&quot;</span>).salt(<span class="string">&quot;123456&quot;</span>)</span><br><span class="line">                        .build();</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;wangwu&quot;</span>:</span><br><span class="line">                <span class="keyword">return</span> UserInfo.builder()</span><br><span class="line">                        .userName(<span class="string">&quot;wangwu&quot;</span>).password(<span class="string">&quot;123456&quot;</span>).salt(<span class="string">&quot;123456&quot;</span>)</span><br><span class="line">                        .build();</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæ²¡æœ‰ä½¿ç”¨æ•°æ®åº“ï¼Œ ç›´æ¥æ¨¡æ‹Ÿæ•°æ®åº“æ“ä½œã€‚</p><h3 id="é›†ç¾¤"><a href="#é›†ç¾¤" class="headerlink" title="é›†ç¾¤"></a>é›†ç¾¤</h3><blockquote><p>åœ¨å®é™…é¡¹ç›®è¿è¡Œä¸­ï¼Œä¸ºäº†è¾¾åˆ°é«˜å¯ç”¨çš„ç›®çš„ï¼Œé€šå¸¸è¦æŠŠåº”ç”¨éƒ¨ç½²åœ¨å¤šå°æœåŠ¡å™¨ä¸Šï¼Œè¿™ä¸ªæ—¶å€™å°±è¦å¯¹sessionè¿›è¡Œé›†ç¾¤çš„ç®¡ç†</p></blockquote><h4 id="æ·»åŠ redisæ”¯æŒ"><a href="#æ·»åŠ redisæ”¯æŒ" class="headerlink" title="æ·»åŠ redisæ”¯æŒ"></a>æ·»åŠ redisæ”¯æŒ</h4><h5 id="pom-xml"><a href="#pom-xml" class="headerlink" title="pom.xml"></a>pom.xml</h5><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>redis.clients<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jedis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h5 id="é…ç½®æ–‡ä»¶"><a href="#é…ç½®æ–‡ä»¶" class="headerlink" title="é…ç½®æ–‡ä»¶"></a>é…ç½®æ–‡ä»¶</h5><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">shiro-demo</span></span><br><span class="line">  <span class="attr">redis:</span></span><br><span class="line">    <span class="attr">host:</span> <span class="string">redistest.xxxx.com</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">6379</span></span><br><span class="line">    <span class="attr">database:</span> <span class="number">10</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">test@2018</span></span><br><span class="line">    <span class="attr">timeout:</span> <span class="number">180000</span></span><br><span class="line">    <span class="attr">jedis:</span></span><br><span class="line">      <span class="attr">pool:</span></span><br><span class="line">        <span class="attr">max-active:</span> <span class="number">100</span></span><br><span class="line">        <span class="attr">max-wait:</span> <span class="number">360000</span></span><br><span class="line">        <span class="attr">min-idle:</span> <span class="number">0</span></span><br><span class="line">        <span class="attr">max-idle:</span> <span class="number">100</span></span><br><span class="line"><span class="attr">my:</span></span><br><span class="line">  <span class="attr">shiro:</span></span><br><span class="line">    <span class="attr">session:</span></span><br><span class="line">      <span class="attr">expireTime:</span> <span class="number">1800</span></span><br><span class="line">      <span class="attr">prefix:</span> <span class="string">you-shiro-session</span></span><br></pre></td></tr></table></figure><h5 id="æ–°å¢Javaç±»ï¼šShiroCacheManager"><a href="#æ–°å¢Javaç±»ï¼šShiroCacheManager" class="headerlink" title="æ–°å¢Javaç±»ï¼šShiroCacheManager"></a>æ–°å¢Javaç±»ï¼š<code>ShiroCacheManager</code></h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ShiroCacheManager</span> <span class="keyword">implements</span> <span class="title">CacheManager</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> RedisTemplate redisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> expireTime;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> &lt;K, V&gt; <span class="function">Cache&lt;K, V&gt; <span class="title">getCache</span><span class="params">(String name)</span> <span class="keyword">throws</span> CacheException </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ShiroRedisCache&lt;&gt;(name, redisTemplate, expireTime);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ShiroCacheManager</span><span class="params">(RedisTemplate redisTemplate, <span class="keyword">int</span> expireTime)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.redisTemplate = redisTemplate;</span><br><span class="line">        <span class="keyword">this</span>.expireTime = expireTime;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ShiroRedisCache</span>&lt;<span class="title">K</span>, <span class="title">V</span>&gt; <span class="keyword">implements</span> <span class="title">Cache</span>&lt;<span class="title">K</span>, <span class="title">V</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> String cacheKey;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> RedisTemplate redisTemplate;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">int</span> expireTime;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="title">ShiroRedisCache</span><span class="params">(String cacheKey, RedisTemplate redisTemplate, <span class="keyword">int</span> expireTime)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.cacheKey = cacheKey;</span><br><span class="line">            <span class="keyword">this</span>.redisTemplate = redisTemplate;</span><br><span class="line">            <span class="keyword">this</span>.expireTime = expireTime;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">private</span> Object <span class="title">hashKey</span><span class="params">(K key)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (key <span class="keyword">instanceof</span> PrincipalCollection) &#123;</span><br><span class="line">                PrincipalCollection principalCollection = (PrincipalCollection) key;</span><br><span class="line">                <span class="keyword">return</span> principalCollection.getPrimaryPrincipal().toString();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> key;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> V <span class="title">get</span><span class="params">(K key)</span> <span class="keyword">throws</span> CacheException </span>&#123;</span><br><span class="line">            BoundHashOperations&lt;String, K, V&gt; boundHashOperations = redisTemplate.boundHashOps(cacheKey);</span><br><span class="line">            Object realKey = hashKey(key);</span><br><span class="line">            <span class="keyword">return</span> boundHashOperations.get(realKey);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> V <span class="title">put</span><span class="params">(K key, V value)</span> <span class="keyword">throws</span> CacheException </span>&#123;</span><br><span class="line">            BoundHashOperations&lt;String, K, V&gt; boundHashOperations = redisTemplate.boundHashOps(cacheKey);</span><br><span class="line">            Object realKey = hashKey(key);</span><br><span class="line">            boundHashOperations.put((K) realKey, value);</span><br><span class="line">            boundHashOperations.expire(expireTime, TimeUnit.SECONDS);</span><br><span class="line">            <span class="keyword">return</span> value;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> V <span class="title">remove</span><span class="params">(K key)</span> <span class="keyword">throws</span> CacheException </span>&#123;</span><br><span class="line">            BoundHashOperations&lt;String, K, V&gt; boundHashOperations = redisTemplate.boundHashOps(cacheKey);</span><br><span class="line">            Object realKey = hashKey(key);</span><br><span class="line">            V value = boundHashOperations.get(realKey);</span><br><span class="line">            boundHashOperations.delete(realKey);</span><br><span class="line">            <span class="keyword">return</span> value;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">clear</span><span class="params">()</span> <span class="keyword">throws</span> CacheException </span>&#123;</span><br><span class="line">            redisTemplate.delete(cacheKey);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">size</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            BoundHashOperations&lt;String, K, V&gt; boundHashOperations = redisTemplate.boundHashOps(cacheKey);</span><br><span class="line">            <span class="keyword">return</span> boundHashOperations.size().intValue();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Set&lt;K&gt; <span class="title">keys</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            BoundHashOperations&lt;String, K, V&gt; boundHashOperations = redisTemplate.boundHashOps(cacheKey);</span><br><span class="line">            <span class="keyword">return</span> boundHashOperations.keys();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Collection&lt;V&gt; <span class="title">values</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            BoundHashOperations&lt;String, K, V&gt; boundHashOperations = redisTemplate.boundHashOps(cacheKey);</span><br><span class="line">            <span class="keyword">return</span> boundHashOperations.values();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="æ–°å¢javaç±»ï¼šRedisSessionDAOï¼Œç»§æ‰¿EnterpriseCacheSessionDAO"><a href="#æ–°å¢javaç±»ï¼šRedisSessionDAOï¼Œç»§æ‰¿EnterpriseCacheSessionDAO" class="headerlink" title="æ–°å¢javaç±»ï¼šRedisSessionDAOï¼Œç»§æ‰¿EnterpriseCacheSessionDAO"></a>æ–°å¢javaç±»ï¼šRedisSessionDAOï¼Œç»§æ‰¿EnterpriseCacheSessionDAO</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RedisSessionDAO</span> <span class="keyword">extends</span> <span class="title">EnterpriseCacheSessionDAO</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> expireTime;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String prefix;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> RedisTemplate redisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">RedisSessionDAO</span><span class="params">(RedisTemplate redisTemplate, <span class="keyword">int</span> expireTime, String prefix)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.redisTemplate = redisTemplate;</span><br><span class="line">        <span class="keyword">this</span>.expireTime = expireTime;</span><br><span class="line">        <span class="keyword">this</span>.prefix = prefix;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> Serializable <span class="title">doCreate</span><span class="params">(Session session)</span> </span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;doCreate(&#123;&#125;)&quot;</span>, session.getId());</span><br><span class="line">        Serializable sessionId = <span class="keyword">super</span>.doCreate(session);</span><br><span class="line">        redisTemplate.opsForValue().set(prefix + <span class="string">&quot;:&quot;</span> + sessionId.toString(), session);</span><br><span class="line">        <span class="keyword">return</span> sessionId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> Session <span class="title">doReadSession</span><span class="params">(Serializable sessionId)</span> </span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;doReadSession(&#123;&#125;)&quot;</span>, sessionId);</span><br><span class="line">        Session session = <span class="keyword">super</span>.doReadSession(sessionId);</span><br><span class="line">        <span class="keyword">if</span> (session == <span class="keyword">null</span>) &#123;</span><br><span class="line">            session = (Session) redisTemplate.opsForValue().get(prefix + <span class="string">&quot;:&quot;</span> + sessionId.toString());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> session;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doUpdate</span><span class="params">(Session session)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.doUpdate(session);</span><br><span class="line">        String key = prefix + <span class="string">&quot;:&quot;</span> + session.getId().toString();</span><br><span class="line">        <span class="keyword">if</span> (!redisTemplate.hasKey(key)) &#123;</span><br><span class="line">            redisTemplate.opsForValue().set(key, session);</span><br><span class="line">        &#125;</span><br><span class="line">        redisTemplate.expire(key, expireTime, TimeUnit.SECONDS);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doDelete</span><span class="params">(Session session)</span> </span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;doDelete(&#123;&#125;)&quot;</span>, session.getId());</span><br><span class="line">        <span class="keyword">super</span>.doDelete(session);</span><br><span class="line">        redisTemplate.delete(prefix + <span class="string">&quot;:&quot;</span> + session.getId().toString());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="æ–°å¢Javaç±»ï¼šRedisObjectSerializer-implements-RedisSerializer"><a href="#æ–°å¢Javaç±»ï¼šRedisObjectSerializer-implements-RedisSerializer" class="headerlink" title="æ–°å¢Javaç±»ï¼šRedisObjectSerializer implements RedisSerializer"></a>æ–°å¢Javaç±»ï¼šRedisObjectSerializer implements RedisSerializer<Object></h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RedisObjectSerializer</span> <span class="keyword">implements</span> <span class="title">RedisSerializer</span>&lt;<span class="title">Object</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Converter&lt;Object, <span class="keyword">byte</span>[]&gt; serializer = <span class="keyword">new</span> SerializingConverter();</span><br><span class="line">    <span class="keyword">private</span> Converter&lt;<span class="keyword">byte</span>[], Object&gt; deserializer = <span class="keyword">new</span> DeserializingConverter();</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">byte</span>[] EMPTY_ARRAY = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">deserialize</span><span class="params">(<span class="keyword">byte</span>[] bytes)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (isEmpty(bytes)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> deserializer.convert(bytes);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception ex) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> SerializationException(<span class="string">&quot;Cannot deserialize&quot;</span>, ex);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">byte</span>[] serialize(Object object) &#123;</span><br><span class="line">        <span class="keyword">if</span> (object == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> EMPTY_ARRAY;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> serializer.convert(object);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception ex) &#123;</span><br><span class="line">            <span class="keyword">return</span> EMPTY_ARRAY;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">isEmpty</span><span class="params">(<span class="keyword">byte</span>[] data)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (data == <span class="keyword">null</span> || data.length == <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="ä¿®æ”¹ShiroConfig"><a href="#ä¿®æ”¹ShiroConfig" class="headerlink" title="ä¿®æ”¹ShiroConfig"></a>ä¿®æ”¹ShiroConfig</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ShiroConfig</span> <span class="keyword">implements</span> <span class="title">InitializingBean</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;my.shiro.session.expireTime:1800&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> expireTime;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;my.shiro.session.prefix:you-shiro-session&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String prefix;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RedisTemplate redisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterPropertiesSet</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        ParserConfig.getGlobalInstance().setAutoTypeSupport(<span class="keyword">true</span>);</span><br><span class="line">        redisTemplate.setKeySerializer(<span class="keyword">new</span> StringRedisSerializer());</span><br><span class="line">        redisTemplate.setValueSerializer(<span class="keyword">new</span> RedisObjectSerializer());</span><br><span class="line">        redisTemplate.afterPropertiesSet();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> RedisTemplate <span class="title">redisTemplate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> RedisTemplate();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean(name = &quot;shiroCacheManager&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ShiroCacheManager <span class="title">shiroCacheManager</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ShiroCacheManager(redisTemplate, expireTime);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean(name = &quot;redisSessionDAO&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> RedisSessionDAO <span class="title">redisSessionDAO</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> RedisSessionDAO(redisTemplate, expireTime, prefix);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean(name = &quot;customRealm&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> CustomRealm <span class="title">customRealm</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> CustomRealm();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean(name = &quot;sessionManager&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> SessionManager <span class="title">sessionManager</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        CustomSessionManager sessionManager = <span class="keyword">new</span> CustomSessionManager();</span><br><span class="line">        sessionManager.setSessionDAO(redisSessionDAO());</span><br><span class="line">        <span class="keyword">return</span> sessionManager;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean(name = &quot;securityManager&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> DefaultWebSecurityManager <span class="title">defaultWebSecurityManager</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        DefaultWebSecurityManager securityManager = <span class="keyword">new</span> DefaultWebSecurityManager();</span><br><span class="line"></span><br><span class="line">        securityManager.setRealm(customRealm());</span><br><span class="line"></span><br><span class="line">        securityManager.setCacheManager(shiroCacheManager());</span><br><span class="line"></span><br><span class="line">        securityManager.setSessionManager(sessionManager());</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> securityManager;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean(name = &quot;lifecycleBeanPostProcessor&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> LifecycleBeanPostProcessor <span class="title">lifecycleBeanPostProcessor</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> LifecycleBeanPostProcessor();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean(name = &quot;shiroFilter&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ShiroFilterFactoryBean <span class="title">shiroFilterFactoryBean</span><span class="params">(DefaultWebSecurityManager securityManager)</span> </span>&#123;</span><br><span class="line">        ShiroFilterFactoryBean shiroFilterFactoryBean = <span class="keyword">new</span> ShiroFilterFactoryBean();</span><br><span class="line">        shiroFilterFactoryBean.setSecurityManager(securityManager);</span><br><span class="line">        <span class="keyword">return</span> shiroFilterFactoryBean;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> DefaultAdvisorAutoProxyCreator <span class="title">advisorAutoProxyCreator</span><span class="params">()</span></span>&#123;</span><br><span class="line">        DefaultAdvisorAutoProxyCreator advisorAutoProxyCreator = <span class="keyword">new</span> DefaultAdvisorAutoProxyCreator();</span><br><span class="line">        advisorAutoProxyCreator.setProxyTargetClass(<span class="keyword">true</span>);</span><br><span class="line">        <span class="keyword">return</span> advisorAutoProxyCreator;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> AuthorizationAttributeSourceAdvisor <span class="title">authorizationAttributeSourceAdvisor</span><span class="params">(DefaultWebSecurityManager securityManager)</span> </span>&#123;</span><br><span class="line">        AuthorizationAttributeSourceAdvisor authorizationAttributeSourceAdvisor = <span class="keyword">new</span> AuthorizationAttributeSourceAdvisor();</span><br><span class="line">        authorizationAttributeSourceAdvisor.setSecurityManager(securityManager);</span><br><span class="line">        <span class="keyword">return</span> authorizationAttributeSourceAdvisor;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="é›†ç¾¤å®Œæˆ"><a href="#é›†ç¾¤å®Œæˆ" class="headerlink" title="é›†ç¾¤å®Œæˆ"></a>é›†ç¾¤å®Œæˆ</h5><p>^_^.</p><p>ç»è¿‡ä»¥ä¸Šæ”¹é€ ï¼Œshiroå°±å¯ä»¥åœ¨åˆ†å¸ƒå¼åº”ç”¨ä¸­é›†ç¾¤ä½¿ç”¨ã€‚</p><p><a href="https://github.com/cayzlh/spring-boot-shiro-demo">é¡¹ç›®ä»£ç </a>ï¼Œåœ¨ with-redis åˆ†æ”¯ä¸­ã€‚</p><h2 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h2><p>è¿è¡ŒDemoï¼Œæµ‹è¯•ç™»å½•å’Œè¯·æ±‚å…¶ä»–æ¥å£ï¼š</p><p><img src="https://github.com/cayzlh/git-img-repository/raw/master/blog/2019/04/6.png" alt="ç™»å½•"></p><p>â€“</p><p><img src="https://github.com/cayzlh/git-img-repository/raw/master/blog/2019/04/7.png" alt="è¯·æ±‚"></p>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹æŠ€æœ¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> Spring </tag>
            
            <tag> SpringBoot </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Dockerç§æœ‰ä»“åº“çš„æ­å»ºä¸ä½¿ç”¨</title>
      <link href="post/2865582791/"/>
      <url>post/2865582791/</url>
      
        <content type="html"><![CDATA[<blockquote><p>è½¬è½½è‡ªï¼š<a href="https://github.com/eacdy/spring-cloud-book">spring-cloud-book</a></p></blockquote><p>å’ŒMavenä¸€æ ·ï¼ŒDockerä¸ä»…æä¾›äº†ä¸€ä¸ªä¸­å¤®ä»“åº“ï¼ŒåŒæ—¶ä¹Ÿå…è®¸æˆ‘ä»¬æ­å»ºç§æœ‰ä»“åº“ã€‚å¦‚æœè¯»è€…å¯¹Mavenæœ‰æ‰€äº†è§£ï¼Œå°†ä¼šå¾ˆå®¹æ˜“ç†è§£ç§æœ‰ä»“åº“çš„ä¼˜åŠ¿ï¼š</p><ul><li>èŠ‚çœå¸¦å®½ï¼Œé•œåƒæ— éœ€ä»ä¸­å¤®ä»“åº“ä¸‹è½½ï¼Œåªéœ€ä»ç§æœ‰ä»“åº“ä¸­ä¸‹è½½å³å¯</li><li>å¯¹äºç§æœ‰ä»“åº“ä¸­å·²æœ‰çš„é•œåƒï¼Œæå‡äº†ä¸‹è½½é€Ÿåº¦</li><li>ä¾¿äºå†…éƒ¨é•œåƒçš„ç»Ÿä¸€ç®¡ç†</li></ul><p>ä¸‹é¢æˆ‘ä»¬æ¥è®²è§£ä¸€ä¸‹å¦‚ä½•æ­å»ºã€ä½¿ç”¨ç§æœ‰ä»“åº“</p><h2 id="å‡†å¤‡å·¥ä½œ"><a href="#å‡†å¤‡å·¥ä½œ" class="headerlink" title="å‡†å¤‡å·¥ä½œ"></a>å‡†å¤‡å·¥ä½œ</h2><p>å‡†å¤‡ä¸¤å°å®‰è£…æœ‰Dockerçš„CentOS7çš„æœºå™¨ï¼Œä¸»æœºè§„åˆ’å¦‚ä¸‹ï¼ˆä»…ä¾›å‚è€ƒï¼‰ï¼š</p><table><thead><tr><th>ä¸»æœº</th><th>IP</th><th>è§’è‰²</th></tr></thead><tbody><tr><td>node0</td><td>192.168.11.143</td><td>Dockerå¼€å‘æœº</td></tr><tr><td>node1</td><td>192.168.11.144</td><td>Dockerç§æœ‰ä»“åº“</td></tr></tbody></table><h2 id="å®‰è£…ã€ä½¿ç”¨ç§æœ‰ä»“åº“"><a href="#å®‰è£…ã€ä½¿ç”¨ç§æœ‰ä»“åº“" class="headerlink" title="å®‰è£…ã€ä½¿ç”¨ç§æœ‰ä»“åº“"></a>å®‰è£…ã€ä½¿ç”¨ç§æœ‰ä»“åº“</h2><p>ç½‘ä¸Šæœ‰å¾ˆå¤š<code>docker-registry</code> çš„æ•™ç¨‹ï¼Œä½†æ˜¯<code>docker-registry</code> å·²ç»è¿‡æ—¶ï¼Œå¹¶ä¸”å·²ç»2å¹´ä¸ç»´æŠ¤äº†ã€‚è¯¦è§<a href="https://github.com/docker/docker-registry">https://github.com/docker/docker-registry</a> ï¼Œæ•…è€Œæœ¬æ–‡ä¸åšæ¢è®¨ï¼Œå¯¹<code>docker-registry</code> æœ‰å…´è¶£çš„ç«¥é‹å¯ä»¥æŸ¥é˜…æœ¬èŠ‚çš„å‚è€ƒæ–‡æ¡£ã€‚</p><p>æœ¬èŠ‚è®²è§£registry V2ï¼Œregistry V2éœ€è¦Dockerç‰ˆæœ¬é«˜äº1.6.0ã€‚registry V2è¦æ±‚ä½¿ç”¨httpsè®¿é—®ï¼Œé‚£ä¹ˆæˆ‘ä»¬å…ˆåšä¸€äº›å‡†å¤‡ï¼Œä¸ºäº†æ–¹ä¾¿ï¼Œè¿™è¾¹æ¨¡æ‹Ÿä»¥åŸŸå<code>reg.itmuch.com</code> è¿›è¡Œè®²è§£ã€‚</p><h3 id="ä½¿ç”¨åŸŸåæ­å»ºhttpsçš„ç§æœ‰ä»“åº“"><a href="#ä½¿ç”¨åŸŸåæ­å»ºhttpsçš„ç§æœ‰ä»“åº“" class="headerlink" title="ä½¿ç”¨åŸŸåæ­å»ºhttpsçš„ç§æœ‰ä»“åº“"></a>ä½¿ç”¨åŸŸåæ­å»ºhttpsçš„ç§æœ‰ä»“åº“</h3><ul><li>é¦–å…ˆä¿®æ”¹ä¸¤å°æœºå™¨çš„hostsï¼Œé…ç½®<code>192.168.11.144</code>  åˆ°<code> reg.itmuch.com</code> çš„æ˜ å°„</li></ul><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">echo &#x27;192.168.11.144 reg.itmuch.com&#x27;&gt;&gt; /etc/hosts</span><br></pre></td></tr></table></figure><ul><li>æ—¢ç„¶ä½¿ç”¨httpsï¼Œé‚£ä¹ˆæˆ‘ä»¬éœ€è¦ç”Ÿæˆè¯ä¹¦ï¼Œæœ¬æ–‡è®²è§£çš„æ˜¯ä½¿ç”¨opensslè‡ªç­¾åè¯ä¹¦ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ä½¿ç”¨è¯¸å¦‚<code>Letâ€™s Encrypt</code> ç­‰å·¥å…·ç”Ÿæˆè¯ä¹¦ï¼Œé¦–å…ˆåœ¨node1æœºå™¨ä¸Šç”Ÿæˆkeyï¼š</li></ul><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">mkdir -p ~/certs</span><br><span class="line">cd ~/certs</span><br><span class="line">openssl genrsa -out reg.itmuch.com.key 2048</span><br></pre></td></tr></table></figure><p>å†ç”Ÿæˆå¯†é’¥æ–‡ä»¶ï¼š</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">openssl req -newkey rsa:4096 -nodes -sha256 -keyout reg.itmuch.com.key -x509 -days 365 -out reg.itmuch.com.crt</span><br></pre></td></tr></table></figure><p>ä¼šæœ‰ä¸€äº›ä¿¡æ¯éœ€è¦å¡«å†™ï¼š</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">Country Name (2 letter code) [XX]:CN# ä½ çš„å›½å®¶åç§°</span><br><span class="line">State or Province Name (full name) []:JS# çœä»½</span><br><span class="line">Locality Name (eg, city) [Default City]:NJ# æ‰€åœ¨åŸå¸‚</span><br><span class="line">Organization Name (eg, company) [Default Company Ltd]:ITMUCH# ç»„ç»‡åç§°</span><br><span class="line">Organizational Unit Name (eg, section) []:ITMUCH# ç»„ç»‡å•å…ƒåç§°</span><br><span class="line">Common Name (eg, your name or your server&#x27;s hostname) []:reg.itmuch.com # åŸŸå</span><br><span class="line">Email Address []:eacdy0000@126.com# é‚®ç®±</span><br></pre></td></tr></table></figure><p>è¿™æ ·è‡ªç­¾åè¯ä¹¦å°±åˆ¶ä½œå®Œæˆäº†ã€‚</p><ul><li>ç”±äºæ˜¯è‡ªç­¾åè¯ä¹¦ï¼Œé»˜è®¤æ˜¯ä¸å—Dockerä¿¡ä»»çš„ï¼Œæ•…è€Œéœ€è¦å°†è¯ä¹¦æ·»åŠ åˆ°Dockerçš„æ ¹è¯ä¹¦ä¸­ï¼ŒDockeråœ¨CentOS 7ä¸­ï¼Œè¯ä¹¦å­˜æ”¾è·¯å¾„æ˜¯<code>/etc/docker/certs.d/åŸŸå</code>ï¼š</li></ul><p><code>node1</code> ç«¯ï¼š</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">mkdir -p /etc/docker/certs.d/reg.itmuch.com</span><br><span class="line">cp ~/certs/reg.itmuch.com.crt /etc/docker/certs.d/reg.itmuch.com/</span><br></pre></td></tr></table></figure><p><code>node0</code> ç«¯ï¼šå°†ç”Ÿæˆçš„è¯ä¹¦ä¸‹è½½åˆ°æ ¹è¯ä¹¦è·¯å¾„</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">mkdir -p /etc/docker/certs.d/reg.itmuch.com</span><br><span class="line">scp root@192.168.11.144:/root/certs/reg.itmuch.com.crt /etc/docker/certs.d/reg.itmuch.com/</span><br></pre></td></tr></table></figure><ul><li>é‡æ–°å¯åŠ¨<code>node0</code> å’Œ <code>node1</code> çš„Docker</li></ul><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">service docker restart</span><br></pre></td></tr></table></figure><ul><li>åœ¨<code>node1</code> ä¸Šå¯åŠ¨ç§æœ‰ä»“åº“</li></ul><p>é¦–å…ˆåˆ‡æ¢åˆ°å®¶ç›®å½•ä¸­ï¼Œè¿™ä¸€æ­¥ä¸èƒ½å°‘ï¼ŒåŸå› æ˜¯ä¸‹é¢çš„-v æŒ‚è½½äº†è¯ä¹¦ï¼Œå¦‚æœä¸åˆ‡æ¢ï¼Œå°†ä¼šå¼•ç”¨ä¸åˆ°è¯ä¹¦æ–‡ä»¶ã€‚</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cd ~</span><br></pre></td></tr></table></figure><p>å¯åŠ¨Dockerç§æœ‰ä»“åº“ï¼ˆæ³¨æ„ï¼šå¦‚æœç›´æ¥ç²˜è´´è¿è¡Œï¼Œè¯·åˆ é™¤æ‰æ³¨é‡Šï¼‰ï¼š</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker run -d -p 443:5000 --restart=always --name registry \</span><br><span class="line">  -v `pwd`/certs:/certs \# å°†â€œå½“å‰ç›®å½•/certsâ€æŒ‚è½½åˆ°å®¹å™¨çš„â€œ/certsâ€</span><br><span class="line">  -v /opt/docker-image:/opt/docker-image \</span><br><span class="line">  -e STORAGE_PATH=/opt/docker-image \# æŒ‡å®šå®¹å™¨å†…å­˜å‚¨é•œåƒçš„è·¯å¾„</span><br><span class="line">  -e REGISTRY_HTTP_TLS_CERTIFICATE=/certs/reg.itmuch.com.crt \# æŒ‡å®šè¯ä¹¦æ–‡ä»¶</span><br><span class="line">  -e REGISTRY_HTTP_TLS_KEY=/certs/reg.itmuch.com.key \# æŒ‡å®škeyæ–‡ä»¶</span><br><span class="line">  registry:2</span><br></pre></td></tr></table></figure><p>å…¶ä¸­ï¼Œä¹‹æ‰€ä»¥æŒ‚è½½/opt/docker-imageç›®å½•ï¼Œæ˜¯ä¸ºäº†é˜²æ­¢ç§æœ‰ä»“åº“å®¹å™¨è¢«åˆ é™¤ï¼Œç§æœ‰ä»“åº“ä¸­çš„é•œåƒä¹Ÿä¼šä¸¢å¤±ã€‚</p><ul><li>åœ¨<code>node0</code> ä¸Šæµ‹è¯•ï¼Œå°†é•œåƒpushåˆ°ç§æœ</li></ul><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker pull kitematic/hello-world-nginx</span><br><span class="line">docker tag kitematic/hello-world-nginx reg.itmuch.com/kitematic/hello-world-nginx # ä¸ºæœ¬åœ°é•œåƒæ‰“æ ‡ç­¾</span><br><span class="line">docker push reg.itmuch.com/kitematic/hello-world-nginx# å°†é•œåƒpushåˆ°ç§æœ</span><br></pre></td></tr></table></figure><p>ä¼šå‘ç°å¦‚ä¸‹å†…å®¹ï¼š</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">The push refers to a repository [reg.itmuch.com/kitematic/hello-world-nginx]</span><br><span class="line">5f70bf18a086: Pushed </span><br><span class="line">b51acdd3ef48: Pushed </span><br><span class="line">3f47ff454588: Pushed </span><br><span class="line">....</span><br><span class="line">latest: digest: sha256:d3e1883b703c39556f2f09da14cc3b820f69a43436655c882c0c0ded0dda6a4b size: 3226</span><br></pre></td></tr></table></figure><p>è¯´æ˜å·²ç»pushæˆåŠŸã€‚</p><ul><li>ä»ç§æœä¸­ä¸‹è½½é•œåƒï¼š</li></ul><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker pull reg.itmuch.com/kitematic/hello-world-nginx</span><br></pre></td></tr></table></figure><h3 id="é…ç½®ç™»å½•è®¤è¯"><a href="#é…ç½®ç™»å½•è®¤è¯" class="headerlink" title="é…ç½®ç™»å½•è®¤è¯"></a>é…ç½®ç™»å½•è®¤è¯</h3><p>åœ¨å¾ˆå¤šåœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬éœ€è¦ç”¨æˆ·ç™»å½•åæ‰èƒ½è®¿é—®ç§æœ‰ä»“åº“ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥å¦‚ä¸‹æ“ä½œï¼š</p><p>å»ºç«‹åœ¨ä¸Šæ–‡ç”Ÿæˆè¯ä¹¦ï¼ŒåŒæ—¶é‡å¯è¿‡DockeræœåŠ¡çš„å‰æä¸‹ï¼Œæˆ‘ä»¬è®²è§£ä¸€ä¸‹å¦‚ä½•é…ç½®ï¼š</p><ul><li>ä¸ºé˜²æ­¢ç«¯å£å†²çªï¼Œæˆ‘ä»¬é¦–å…ˆåˆ é™¤æˆ–åœæ­¢ä¹‹å‰å¯åŠ¨å¥½çš„ç§æœ‰ä»“åº“ï¼š</li></ul><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker kill registry</span><br></pre></td></tr></table></figure><ul><li>åœ¨node1æœºå™¨ä¸Šå®‰è£…<code>httpd-tools</code> ï¼š</li></ul><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">yum install httpd-tools</span><br></pre></td></tr></table></figure><ul><li>åœ¨nodeæœºå™¨ä¸Šåˆ›å»ºå¯†ç æ–‡ä»¶ï¼Œå¹¶æ·»åŠ ä¸€ä¸ªç”¨æˆ·<code>testuser</code> ï¼Œå¯†ç æ˜¯<code>testpassword</code> ï¼š</li></ul><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cd ~</span><br><span class="line">mkdir auth</span><br><span class="line">htpasswd -Bbn testuser testpassword &gt; auth/htpasswd</span><br></pre></td></tr></table></figure><ul><li>åœ¨node1æœºå™¨ä¸Šåˆ‡æ¢åˆ°<code>~</code> ç›®å½•ï¼Œå¹¶å¯åŠ¨ç§æœ‰ä»“åº“ï¼ˆæ³¨æ„ï¼šå¦‚æœç›´æ¥ç²˜è´´è¿è¡Œï¼Œè¯·åˆ é™¤æ‰æ³¨é‡Šï¼‰ï¼š</li></ul><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker run -d -p 443:5000 --restart=always --name registry2 \</span><br><span class="line">  -v /opt/docker-image:/var/lib/registry \# æŒ‚è½½å®¹å™¨å†…å­˜å‚¨é•œåƒè·¯å¾„åˆ°å®¿ä¸»æœº</span><br><span class="line">  -v `pwd`/certs:/certs \</span><br><span class="line">  -e REGISTRY_HTTP_TLS_CERTIFICATE=/certs/reg.itmuch.com.crt \</span><br><span class="line">  -e REGISTRY_HTTP_TLS_KEY=/certs/reg.itmuch.com.key \</span><br><span class="line">  -v `pwd`/auth:/auth \</span><br><span class="line">  -e &quot;REGISTRY_AUTH=htpasswd&quot; \</span><br><span class="line">  -e &quot;REGISTRY_AUTH_HTPASSWD_REALM=Registry Realm&quot; \</span><br><span class="line">  -e REGISTRY_AUTH_HTPASSWD_PATH=/auth/htpasswd \</span><br><span class="line">  registry:2</span><br></pre></td></tr></table></figure><ul><li>æµ‹è¯•ï¼š</li></ul><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker push reg.itmuch.com/kitematic/hello-world-nginx</span><br></pre></td></tr></table></figure><p>æç¤ºï¼š</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">461f75075df2: Image push failed </span><br><span class="line">no basic auth credentials</span><br></pre></td></tr></table></figure><p>è¯´æ˜éœ€è¦è®¤è¯ã€‚</p><p>æˆ‘ä»¬ç™»é™†ä¸€ä¸‹ï¼Œæ‰§è¡Œï¼š</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker login reg.imuch.com</span><br></pre></td></tr></table></figure><p>å†æ¬¡æ‰§è¡Œ</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker push reg.itmuch.com/kitematic/hello-world-nginx</span><br></pre></td></tr></table></figure><p>å°±å¯ä»¥æ­£å¸¸pushé•œåƒåˆ°ç§æœ‰ä»“åº“äº†ã€‚</p><p><strong>æ³¨æ„ï¼š</strong>å¦‚æœæƒ³è¦ä»ç§æœ‰ä»“åº“ä¸Šä¸‹è½½é•œåƒï¼ŒåŒæ ·éœ€è¦ç™»å½•ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®°æœ¬ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Docker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Dockerfileå¸¸ç”¨æŒ‡ä»¤</title>
      <link href="post/2644493537/"/>
      <url>post/2644493537/</url>
      
        <content type="html"><![CDATA[<blockquote><p>è½¬è½½è‡ªï¼š<a href="http://www.ityouknow.com/docker/2018/03/15/docker-dockerfile-command-introduction.html">Docker(ä¸‰)ï¼šDockerfile å‘½ä»¤è¯¦è§£</a>ï¼Œæ€•ä»¥åæ‰¾ä¸åˆ°</p></blockquote><h2 id="Dockerfile-æŒ‡ä»¤è¯¦è§£"><a href="#Dockerfile-æŒ‡ä»¤è¯¦è§£" class="headerlink" title="Dockerfile æŒ‡ä»¤è¯¦è§£"></a>Dockerfile æŒ‡ä»¤è¯¦è§£</h2><h3 id="1-FROM-æŒ‡å®šåŸºç¡€é•œåƒ"><a href="#1-FROM-æŒ‡å®šåŸºç¡€é•œåƒ" class="headerlink" title="1 FROM æŒ‡å®šåŸºç¡€é•œåƒ"></a>1 FROM æŒ‡å®šåŸºç¡€é•œåƒ</h3><p>FROM æŒ‡ä»¤ç”¨äºæŒ‡å®šå…¶åæ„å»ºæ–°é•œåƒæ‰€ä½¿ç”¨çš„åŸºç¡€é•œåƒã€‚FROM æŒ‡ä»¤å¿…æ˜¯ Dockerfile æ–‡ä»¶ä¸­çš„é¦–æ¡å‘½ä»¤ï¼Œå¯åŠ¨æ„å»ºæµç¨‹åï¼ŒDocker å°†ä¼šåŸºäºè¯¥é•œåƒæ„å»ºæ–°é•œåƒï¼ŒFROM åçš„å‘½ä»¤ä¹Ÿä¼šåŸºäºè¿™ä¸ªåŸºç¡€é•œåƒã€‚</p><p>FROMè¯­æ³•æ ¼å¼ä¸ºï¼š</p><figure class="highlight dockerfile"><table><tr><td class="code"><pre><span class="line"><span class="keyword">FROM</span> &lt;image&gt;</span><br></pre></td></tr></table></figure><p>æˆ–</p><figure class="highlight dockerfile"><table><tr><td class="code"><pre><span class="line"><span class="keyword">FROM</span> &lt;image&gt;:&lt;tag&gt;</span><br></pre></td></tr></table></figure><p>æˆ–</p><figure class="highlight dockerfile"><table><tr><td class="code"><pre><span class="line"><span class="keyword">FROM</span> &lt;image&gt;:&lt;digest&gt;</span><br></pre></td></tr></table></figure><p>é€šè¿‡ FROM æŒ‡å®šçš„é•œåƒï¼Œå¯ä»¥æ˜¯ä»»ä½•æœ‰æ•ˆçš„åŸºç¡€é•œåƒã€‚FROM æœ‰ä»¥ä¸‹é™åˆ¶ï¼š</p><ul><li>FROM å¿…é¡» æ˜¯ Dockerfile ä¸­ç¬¬ä¸€æ¡éæ³¨é‡Šå‘½ä»¤</li><li>åœ¨ä¸€ä¸ª Dockerfile æ–‡ä»¶ä¸­åˆ›å»ºå¤šä¸ªé•œåƒæ—¶ï¼ŒFROM å¯ä»¥å¤šæ¬¡å‡ºç°ã€‚åªéœ€åœ¨æ¯ä¸ªæ–°å‘½ä»¤ FROM ä¹‹å‰ï¼Œè®°å½•æäº¤ä¸Šæ¬¡çš„é•œåƒ IDã€‚</li><li>tag æˆ– digest æ˜¯å¯é€‰çš„ï¼Œå¦‚æœä¸ä½¿ç”¨è¿™ä¸¤ä¸ªå€¼æ—¶ï¼Œä¼šä½¿ç”¨ latest ç‰ˆæœ¬çš„åŸºç¡€é•œåƒ</li></ul><h3 id="2-RUN-æ‰§è¡Œå‘½ä»¤"><a href="#2-RUN-æ‰§è¡Œå‘½ä»¤" class="headerlink" title="2 RUN æ‰§è¡Œå‘½ä»¤"></a>2 RUN æ‰§è¡Œå‘½ä»¤</h3><p>åœ¨é•œåƒçš„æ„å»ºè¿‡ç¨‹ä¸­æ‰§è¡Œç‰¹å®šçš„å‘½ä»¤ï¼Œå¹¶ç”Ÿæˆä¸€ä¸ªä¸­é—´é•œåƒã€‚æ ¼å¼:</p><figure class="highlight dockerfile"><table><tr><td class="code"><pre><span class="line"><span class="comment">#shellæ ¼å¼</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> &lt;<span class="built_in">command</span>&gt;</span></span><br><span class="line"><span class="comment">#execæ ¼å¼</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> [<span class="string">&quot;executable&quot;</span>, <span class="string">&quot;param1&quot;</span>, <span class="string">&quot;param2&quot;</span>]</span></span><br></pre></td></tr></table></figure><ul><li>RUN å‘½ä»¤å°†åœ¨å½“å‰ image ä¸­æ‰§è¡Œä»»æ„åˆæ³•å‘½ä»¤å¹¶æäº¤æ‰§è¡Œç»“æœã€‚å‘½ä»¤æ‰§è¡Œæäº¤åï¼Œå°±ä¼šè‡ªåŠ¨æ‰§è¡Œ Dockerfile ä¸­çš„ä¸‹ä¸€ä¸ªæŒ‡ä»¤ã€‚</li><li>å±‚çº§ RUN æŒ‡ä»¤å’Œç”Ÿæˆæäº¤æ˜¯ç¬¦åˆ Docker æ ¸å¿ƒç†å¿µçš„åšæ³•ã€‚å®ƒå…è®¸åƒç‰ˆæœ¬æ§åˆ¶é‚£æ ·ï¼Œåœ¨ä»»æ„ä¸€ä¸ªç‚¹ï¼Œå¯¹ image é•œåƒè¿›è¡Œå®šåˆ¶åŒ–æ„å»ºã€‚</li><li>RUN æŒ‡ä»¤åˆ›å»ºçš„ä¸­é—´é•œåƒä¼šè¢«ç¼“å­˜ï¼Œå¹¶ä¼šåœ¨ä¸‹æ¬¡æ„å»ºä¸­ä½¿ç”¨ã€‚å¦‚æœä¸æƒ³ä½¿ç”¨è¿™äº›ç¼“å­˜é•œåƒï¼Œå¯ä»¥åœ¨æ„å»ºæ—¶æŒ‡å®š <code>--no-cache</code> å‚æ•°ï¼Œå¦‚ï¼š<code>docker build --no-cache</code>ã€‚</li></ul><h3 id="3-COPY-å¤åˆ¶æ–‡ä»¶"><a href="#3-COPY-å¤åˆ¶æ–‡ä»¶" class="headerlink" title="3 COPY å¤åˆ¶æ–‡ä»¶"></a>3 COPY å¤åˆ¶æ–‡ä»¶</h3><p>æ ¼å¼ï¼š</p><figure class="highlight dockerfile"><table><tr><td class="code"><pre><span class="line"><span class="keyword">COPY</span><span class="bash"> &lt;æºè·¯å¾„&gt;... &lt;ç›®æ ‡è·¯å¾„&gt;</span></span><br><span class="line"><span class="keyword">COPY</span><span class="bash"> [<span class="string">&quot;&lt;æºè·¯å¾„1&gt;&quot;</span>,... <span class="string">&quot;&lt;ç›®æ ‡è·¯å¾„&gt;&quot;</span>]</span></span><br></pre></td></tr></table></figure><p>å’Œ RUN æŒ‡ä»¤ä¸€æ ·ï¼Œä¹Ÿæœ‰ä¸¤ç§æ ¼å¼ï¼Œä¸€ç§ç±»ä¼¼äºå‘½ä»¤è¡Œï¼Œä¸€ç§ç±»ä¼¼äºå‡½æ•°è°ƒç”¨ã€‚COPY æŒ‡ä»¤å°†ä»æ„å»ºä¸Šä¸‹æ–‡ç›®å½•ä¸­ &lt;æºè·¯å¾„&gt; çš„æ–‡ä»¶/ç›®å½•å¤åˆ¶åˆ°æ–°çš„ä¸€å±‚çš„é•œåƒå†…çš„<code>&lt;ç›®æ ‡è·¯å¾„&gt;</code>ä½ç½®ã€‚æ¯”å¦‚ï¼š</p><figure class="highlight dockerfile"><table><tr><td class="code"><pre><span class="line"><span class="keyword">COPY</span><span class="bash"> package.json /usr/src/app/</span></span><br></pre></td></tr></table></figure><p><code>&lt;æºè·¯å¾„&gt;</code>å¯ä»¥æ˜¯å¤šä¸ªï¼Œç”šè‡³å¯ä»¥æ˜¯é€šé…ç¬¦ï¼Œå…¶é€šé…ç¬¦è§„åˆ™è¦æ»¡è¶³ Go çš„ filepath.Match è§„åˆ™ï¼Œå¦‚ï¼š</p><figure class="highlight dockerfile"><table><tr><td class="code"><pre><span class="line"><span class="keyword">COPY</span><span class="bash"> hom* /mydir/</span></span><br><span class="line"><span class="keyword">COPY</span><span class="bash"> hom?.txt /mydir/</span></span><br></pre></td></tr></table></figure><p><code>&lt;ç›®æ ‡è·¯å¾„&gt;</code>å¯ä»¥æ˜¯å®¹å™¨å†…çš„ç»å¯¹è·¯å¾„ï¼Œä¹Ÿå¯ä»¥æ˜¯ç›¸å¯¹äºå·¥ä½œç›®å½•çš„ç›¸å¯¹è·¯å¾„ï¼ˆå·¥ä½œç›®å½•å¯ä»¥ç”¨ WORKDIR æŒ‡ä»¤æ¥æŒ‡å®šï¼‰ã€‚ç›®æ ‡è·¯å¾„ä¸éœ€è¦äº‹å…ˆåˆ›å»ºï¼Œå¦‚æœç›®å½•ä¸å­˜åœ¨ä¼šåœ¨å¤åˆ¶æ–‡ä»¶å‰å…ˆè¡Œåˆ›å»ºç¼ºå¤±ç›®å½•ã€‚</p><p>æ­¤å¤–ï¼Œè¿˜éœ€è¦æ³¨æ„ä¸€ç‚¹ï¼Œä½¿ç”¨ COPY æŒ‡ä»¤ï¼Œæºæ–‡ä»¶çš„å„ç§å…ƒæ•°æ®éƒ½ä¼šä¿ç•™ã€‚æ¯”å¦‚è¯»ã€å†™ã€æ‰§è¡Œæƒé™ã€æ–‡ä»¶å˜æ›´æ—¶é—´ç­‰ã€‚è¿™ä¸ªç‰¹æ€§å¯¹äºé•œåƒå®šåˆ¶å¾ˆæœ‰ç”¨ã€‚ç‰¹åˆ«æ˜¯æ„å»ºç›¸å…³æ–‡ä»¶éƒ½åœ¨ä½¿ç”¨ Git è¿›è¡Œç®¡ç†çš„æ—¶å€™ã€‚</p><h3 id="4-ADD-æ›´é«˜çº§çš„å¤åˆ¶æ–‡ä»¶"><a href="#4-ADD-æ›´é«˜çº§çš„å¤åˆ¶æ–‡ä»¶" class="headerlink" title="4 ADD æ›´é«˜çº§çš„å¤åˆ¶æ–‡ä»¶"></a>4 ADD æ›´é«˜çº§çš„å¤åˆ¶æ–‡ä»¶</h3><p>ADD æŒ‡ä»¤å’Œ COPY çš„æ ¼å¼å’Œæ€§è´¨åŸºæœ¬ä¸€è‡´ã€‚ä½†æ˜¯åœ¨ COPY åŸºç¡€ä¸Šå¢åŠ äº†ä¸€äº›åŠŸèƒ½ã€‚æ¯”å¦‚<code>&lt;æºè·¯å¾„&gt;</code>å¯ä»¥æ˜¯ä¸€ä¸ª URLï¼Œè¿™ç§æƒ…å†µä¸‹ï¼ŒDocker å¼•æ“ä¼šè¯•å›¾å»ä¸‹è½½è¿™ä¸ªé“¾æ¥çš„æ–‡ä»¶æ”¾åˆ°<code>&lt;ç›®æ ‡è·¯å¾„&gt;</code>å»ã€‚</p><p>åœ¨æ„å»ºé•œåƒæ—¶ï¼Œå¤åˆ¶ä¸Šä¸‹æ–‡ä¸­çš„æ–‡ä»¶åˆ°é•œåƒå†…ï¼Œæ ¼å¼ï¼š</p><figure class="highlight dockerfile"><table><tr><td class="code"><pre><span class="line"><span class="keyword">ADD</span><span class="bash"> &lt;æºè·¯å¾„&gt;... &lt;ç›®æ ‡è·¯å¾„&gt;</span></span><br><span class="line"><span class="keyword">ADD</span><span class="bash"> [<span class="string">&quot;&lt;æºè·¯å¾„&gt;&quot;</span>,... <span class="string">&quot;&lt;ç›®æ ‡è·¯å¾„&gt;&quot;</span>]</span></span><br></pre></td></tr></table></figure><p><strong>æ³¨æ„</strong><br>å¦‚æœ docker å‘ç°æ–‡ä»¶å†…å®¹è¢«æ”¹å˜ï¼Œåˆ™æ¥ä¸‹æ¥çš„æŒ‡ä»¤éƒ½ä¸ä¼šå†ä½¿ç”¨ç¼“å­˜ã€‚å…³äºå¤åˆ¶æ–‡ä»¶æ—¶éœ€è¦å¤„ç†çš„/ï¼ŒåŸºæœ¬è·Ÿæ­£å¸¸çš„ copy ä¸€è‡´</p><h3 id="5-ENV-è®¾ç½®ç¯å¢ƒå˜é‡"><a href="#5-ENV-è®¾ç½®ç¯å¢ƒå˜é‡" class="headerlink" title="5 ENV è®¾ç½®ç¯å¢ƒå˜é‡"></a>5 ENV è®¾ç½®ç¯å¢ƒå˜é‡</h3><p>æ ¼å¼æœ‰ä¸¤ç§ï¼š</p><figure class="highlight dockerfile"><table><tr><td class="code"><pre><span class="line"><span class="keyword">ENV</span> &lt;key&gt; &lt;value&gt;</span><br><span class="line"><span class="keyword">ENV</span> &lt;key1&gt;=&lt;value1&gt; &lt;key2&gt;=&lt;value2&gt;...</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªæŒ‡ä»¤å¾ˆç®€å•ï¼Œå°±æ˜¯è®¾ç½®ç¯å¢ƒå˜é‡è€Œå·²ï¼Œæ— è®ºæ˜¯åé¢çš„å…¶å®ƒæŒ‡ä»¤ï¼Œå¦‚ RUNï¼Œè¿˜æ˜¯è¿è¡Œæ—¶çš„åº”ç”¨ï¼Œéƒ½å¯ä»¥ç›´æ¥ä½¿ç”¨è¿™é‡Œå®šä¹‰çš„ç¯å¢ƒå˜é‡ã€‚</p><figure class="highlight dockerfile"><table><tr><td class="code"><pre><span class="line"><span class="keyword">ENV</span> VERSION=<span class="number">1.0</span> DEBUG=on \</span><br><span class="line">    NAME=<span class="string">&quot;Happy Feet&quot;</span></span><br></pre></td></tr></table></figure><p>è¿™ä¸ªä¾‹å­ä¸­æ¼”ç¤ºäº†å¦‚ä½•æ¢è¡Œï¼Œä»¥åŠå¯¹å«æœ‰ç©ºæ ¼çš„å€¼ç”¨åŒå¼•å·æ‹¬èµ·æ¥çš„åŠæ³•ï¼Œè¿™å’Œ Shell ä¸‹çš„è¡Œä¸ºæ˜¯ä¸€è‡´çš„ã€‚</p><h3 id="6-EXPOSE"><a href="#6-EXPOSE" class="headerlink" title="6 EXPOSE"></a>6 EXPOSE</h3><p>ä¸ºæ„å»ºçš„é•œåƒè®¾ç½®ç›‘å¬ç«¯å£ï¼Œä½¿å®¹å™¨åœ¨è¿è¡Œæ—¶ç›‘å¬ã€‚æ ¼å¼ï¼š</p><figure class="highlight dockerfile"><table><tr><td class="code"><pre><span class="line"><span class="keyword">EXPOSE</span> &lt;port&gt; [&lt;port&gt;...]</span><br></pre></td></tr></table></figure><p>EXPOSE æŒ‡ä»¤å¹¶ä¸ä¼šè®©å®¹å™¨ç›‘å¬ host çš„ç«¯å£ï¼Œå¦‚æœéœ€è¦ï¼Œéœ€è¦åœ¨ docker run æ—¶ä½¿ç”¨ <code>-p</code>ã€<code>-P</code> å‚æ•°æ¥å‘å¸ƒå®¹å™¨ç«¯å£åˆ° host çš„æŸä¸ªç«¯å£ä¸Šã€‚</p><h3 id="7-VOLUME-å®šä¹‰åŒ¿åå·"><a href="#7-VOLUME-å®šä¹‰åŒ¿åå·" class="headerlink" title="7 VOLUME å®šä¹‰åŒ¿åå·"></a>7 VOLUME å®šä¹‰åŒ¿åå·</h3><p>VOLUMEç”¨äºåˆ›å»ºæŒ‚è½½ç‚¹ï¼Œå³å‘åŸºäºæ‰€æ„å»ºé•œåƒåˆ›å§‹çš„å®¹å™¨æ·»åŠ å·ï¼š</p><figure class="highlight dockerfile"><table><tr><td class="code"><pre><span class="line"><span class="keyword">VOLUME</span><span class="bash"> [<span class="string">&quot;/data&quot;</span>]</span></span><br></pre></td></tr></table></figure><p>ä¸€ä¸ªå·å¯ä»¥å­˜åœ¨äºä¸€ä¸ªæˆ–å¤šä¸ªå®¹å™¨çš„æŒ‡å®šç›®å½•ï¼Œè¯¥ç›®å½•å¯ä»¥ç»•è¿‡è”åˆæ–‡ä»¶ç³»ç»Ÿï¼Œå¹¶å…·æœ‰ä»¥ä¸‹åŠŸèƒ½ï¼š</p><ul><li>å·å¯ä»¥å®¹å™¨é—´å…±äº«å’Œé‡ç”¨</li><li>å®¹å™¨å¹¶ä¸ä¸€å®šè¦å’Œå…¶å®ƒå®¹å™¨å…±äº«å·</li><li>ä¿®æ”¹å·åä¼šç«‹å³ç”Ÿæ•ˆ</li><li>å¯¹å·çš„ä¿®æ”¹ä¸ä¼šå¯¹é•œåƒäº§ç”Ÿå½±å“</li><li>å·ä¼šä¸€ç›´å­˜åœ¨ï¼Œç›´åˆ°æ²¡æœ‰ä»»ä½•å®¹å™¨åœ¨ä½¿ç”¨å®ƒ</li></ul><p>VOLUME è®©æˆ‘ä»¬å¯ä»¥å°†æºä»£ç ã€æ•°æ®æˆ–å…¶å®ƒå†…å®¹æ·»åŠ åˆ°é•œåƒä¸­ï¼Œè€Œåˆä¸å¹¶æäº¤åˆ°é•œåƒä¸­ï¼Œå¹¶ä½¿æˆ‘ä»¬å¯ä»¥å¤šä¸ªå®¹å™¨é—´å…±äº«è¿™äº›å†…å®¹ã€‚</p><h3 id="8-WORKDIR-æŒ‡å®šå·¥ä½œç›®å½•"><a href="#8-WORKDIR-æŒ‡å®šå·¥ä½œç›®å½•" class="headerlink" title="8 WORKDIR æŒ‡å®šå·¥ä½œç›®å½•"></a>8 WORKDIR æŒ‡å®šå·¥ä½œç›®å½•</h3><p>WORKDIRç”¨äºåœ¨å®¹å™¨å†…è®¾ç½®ä¸€ä¸ªå·¥ä½œç›®å½•ï¼š</p><figure class="highlight dockerfile"><table><tr><td class="code"><pre><span class="line"><span class="keyword">WORKDIR</span><span class="bash"> /path/to/workdir</span></span><br></pre></td></tr></table></figure><p>é€šè¿‡WORKDIRè®¾ç½®å·¥ä½œç›®å½•åï¼ŒDockerfile ä¸­å…¶åçš„å‘½ä»¤ RUNã€CMDã€ENTRYPOINTã€ADDã€COPY ç­‰å‘½ä»¤éƒ½ä¼šåœ¨è¯¥ç›®å½•ä¸‹æ‰§è¡Œã€‚ å¦‚ï¼Œä½¿ç”¨WORKDIRè®¾ç½®å·¥ä½œç›®å½•ï¼š</p><figure class="highlight dockerfile"><table><tr><td class="code"><pre><span class="line"><span class="keyword">WORKDIR</span><span class="bash"> /a</span></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="bash"> b</span></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="bash"> c</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> <span class="built_in">pwd</span></span></span><br></pre></td></tr></table></figure><p>åœ¨ä»¥ä¸Šç¤ºä¾‹ä¸­ï¼Œpwd æœ€ç»ˆå°†ä¼šåœ¨ <code>/a/b/c</code> ç›®å½•ä¸­æ‰§è¡Œã€‚åœ¨ä½¿ç”¨ docker run è¿è¡Œå®¹å™¨æ—¶ï¼Œå¯ä»¥é€šè¿‡<code>-w</code>å‚æ•°è¦†ç›–æ„å»ºæ—¶æ‰€è®¾ç½®çš„å·¥ä½œç›®å½•ã€‚</p><h3 id="9-USER-æŒ‡å®šå½“å‰ç”¨æˆ·"><a href="#9-USER-æŒ‡å®šå½“å‰ç”¨æˆ·" class="headerlink" title="9 USER æŒ‡å®šå½“å‰ç”¨æˆ·"></a>9 USER æŒ‡å®šå½“å‰ç”¨æˆ·</h3><p>USER ç”¨äºæŒ‡å®šè¿è¡Œé•œåƒæ‰€ä½¿ç”¨çš„ç”¨æˆ·ï¼š</p><figure class="highlight dockerfile"><table><tr><td class="code"><pre><span class="line"><span class="keyword">USER</span> daemon</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨USERæŒ‡å®šç”¨æˆ·æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ç”¨æˆ·åã€UID æˆ– GIDï¼Œæˆ–æ˜¯ä¸¤è€…çš„ç»„åˆã€‚ä»¥ä¸‹éƒ½æ˜¯åˆæ³•çš„æŒ‡å®šè¯•ï¼š</p><figure class="highlight dockerfile"><table><tr><td class="code"><pre><span class="line"><span class="keyword">USER</span> <span class="keyword">user</span></span><br><span class="line"><span class="keyword">USER</span> <span class="keyword">user</span>:group</span><br><span class="line"><span class="keyword">USER</span> uid</span><br><span class="line"><span class="keyword">USER</span> uid:gid</span><br><span class="line"><span class="keyword">USER</span> <span class="keyword">user</span>:gid</span><br><span class="line"><span class="keyword">USER</span> uid:group</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨USERæŒ‡å®šç”¨æˆ·åï¼ŒDockerfile ä¸­å…¶åçš„å‘½ä»¤ RUNã€CMDã€ENTRYPOINT éƒ½å°†ä½¿ç”¨è¯¥ç”¨æˆ·ã€‚é•œåƒæ„å»ºå®Œæˆåï¼Œé€šè¿‡ docker run è¿è¡Œå®¹å™¨æ—¶ï¼Œå¯ä»¥é€šè¿‡ <code>-u</code> å‚æ•°æ¥è¦†ç›–æ‰€æŒ‡å®šçš„ç”¨æˆ·ã€‚</p><h3 id="10-CMD"><a href="#10-CMD" class="headerlink" title="10 CMD"></a>10 CMD</h3><p>CMDç”¨äºæŒ‡å®šåœ¨å®¹å™¨å¯åŠ¨æ—¶æ‰€è¦æ‰§è¡Œçš„å‘½ä»¤ã€‚CMD æœ‰ä»¥ä¸‹ä¸‰ç§æ ¼å¼ï¼š</p><figure class="highlight dockerfile"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CMD</span><span class="bash"> [<span class="string">&quot;executable&quot;</span>,<span class="string">&quot;param1&quot;</span>,<span class="string">&quot;param2&quot;</span>]</span></span><br><span class="line"><span class="keyword">CMD</span><span class="bash"> [<span class="string">&quot;param1&quot;</span>,<span class="string">&quot;param2&quot;</span>]</span></span><br><span class="line"><span class="keyword">CMD</span><span class="bash"> <span class="built_in">command</span> param1 param2</span></span><br></pre></td></tr></table></figure><p>çœç•¥å¯æ‰§è¡Œæ–‡ä»¶çš„ exec æ ¼å¼ï¼Œè¿™ç§å†™æ³•ä½¿ CMD ä¸­çš„å‚æ•°å½“åš ENTRYPOINT çš„é»˜è®¤å‚æ•°ï¼Œæ­¤æ—¶ ENTRYPOINT ä¹Ÿåº”è¯¥æ˜¯ exec æ ¼å¼ï¼Œå…·ä½“ä¸ ENTRYPOINT çš„ç»„åˆä½¿ç”¨ï¼Œå‚è€ƒ ENTRYPOINTã€‚</p><p><strong>æ³¨æ„</strong><br>ä¸ RUN æŒ‡ä»¤çš„åŒºåˆ«ï¼šRUN åœ¨æ„å»ºçš„æ—¶å€™æ‰§è¡Œï¼Œå¹¶ç”Ÿæˆä¸€ä¸ªæ–°çš„é•œåƒï¼ŒCMD åœ¨å®¹å™¨è¿è¡Œçš„æ—¶å€™æ‰§è¡Œï¼Œåœ¨æ„å»ºæ—¶ä¸è¿›è¡Œä»»ä½•æ“ä½œã€‚</p><h3 id="11-ENTRYPOINT"><a href="#11-ENTRYPOINT" class="headerlink" title="11 ENTRYPOINT"></a>11 ENTRYPOINT</h3><p>ENTRYPOINT ç”¨äºç»™å®¹å™¨é…ç½®ä¸€ä¸ªå¯æ‰§è¡Œç¨‹åºã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ¯æ¬¡ä½¿ç”¨é•œåƒåˆ›å»ºå®¹å™¨æ—¶ï¼Œé€šè¿‡ ENTRYPOINT æŒ‡å®šçš„ç¨‹åºéƒ½ä¼šè¢«è®¾ç½®ä¸ºé»˜è®¤ç¨‹åºã€‚ENTRYPOINT æœ‰ä»¥ä¸‹ä¸¤ç§å½¢å¼ï¼š</p><figure class="highlight dockerfile"><table><tr><td class="code"><pre><span class="line"><span class="keyword">ENTRYPOINT</span><span class="bash"> [<span class="string">&quot;executable&quot;</span>, <span class="string">&quot;param1&quot;</span>, <span class="string">&quot;param2&quot;</span>]</span></span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="bash"> <span class="built_in">command</span> param1 param2</span></span><br></pre></td></tr></table></figure><p>ENTRYPOINT ä¸ CMD éå¸¸ç±»ä¼¼ï¼Œä¸åŒçš„æ˜¯é€šè¿‡<code>docker run</code>æ‰§è¡Œçš„å‘½ä»¤ä¸ä¼šè¦†ç›– ENTRYPOINTï¼Œè€Œ<code>docker run</code>å‘½ä»¤ä¸­æŒ‡å®šçš„ä»»ä½•å‚æ•°ï¼Œéƒ½ä¼šè¢«å½“åšå‚æ•°å†æ¬¡ä¼ é€’ç»™ ENTRYPOINTã€‚Dockerfile ä¸­åªå…è®¸æœ‰ä¸€ä¸ª ENTRYPOINT å‘½ä»¤ï¼Œå¤šæŒ‡å®šæ—¶ä¼šè¦†ç›–å‰é¢çš„è®¾ç½®ï¼Œè€Œåªæ‰§è¡Œæœ€åçš„ ENTRYPOINT æŒ‡ä»¤ã€‚</p><p><code>docker run</code>è¿è¡Œå®¹å™¨æ—¶æŒ‡å®šçš„å‚æ•°éƒ½ä¼šè¢«ä¼ é€’ç»™ ENTRYPOINT ï¼Œä¸”ä¼šè¦†ç›– CMD å‘½ä»¤æŒ‡å®šçš„å‚æ•°ã€‚å¦‚ï¼Œæ‰§è¡Œ<code>docker run &lt;image&gt; -d</code>æ—¶ï¼Œ-d å‚æ•°å°†è¢«ä¼ é€’ç»™å…¥å£ç‚¹ã€‚</p><p>ä¹Ÿå¯ä»¥é€šè¿‡<code>docker run --entrypoint</code>é‡å†™ ENTRYPOINT å…¥å£ç‚¹ã€‚å¦‚ï¼šå¯ä»¥åƒä¸‹é¢è¿™æ ·æŒ‡å®šä¸€ä¸ªå®¹å™¨æ‰§è¡Œç¨‹åºï¼š</p><figure class="highlight dockerfile"><table><tr><td class="code"><pre><span class="line"><span class="keyword">ENTRYPOINT</span><span class="bash"> [<span class="string">&quot;/usr/bin/nginx&quot;</span>]</span></span><br></pre></td></tr></table></figure><p>å®Œæ•´æ„å»ºä»£ç ï¼š</p><figure class="highlight dockerfile"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Version: 0.0.3</span></span><br><span class="line"><span class="keyword">FROM</span> ubuntu:<span class="number">16.04</span></span><br><span class="line"><span class="keyword">MAINTAINER</span> ä½•æ°‘ä¸‰ <span class="string">&quot;cn.liuht@gmail.com&quot;</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> apt-get update</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> apt-get install -y nginx</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> <span class="built_in">echo</span> <span class="string">&#x27;Hello World, æˆ‘æ˜¯ä¸ªå®¹å™¨&#x27;</span> \ </span></span><br><span class="line">   &gt; /var/www/html/index.html</span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="bash"> [<span class="string">&quot;/usr/sbin/nginx&quot;</span>]</span></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">80</span></span><br></pre></td></tr></table></figure><p>ä½¿ç”¨docker buildæ„å»ºé•œåƒï¼Œå¹¶å°†é•œåƒæŒ‡å®šä¸º itbilu/testï¼š</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker build -t=<span class="string">&quot;itbilu/test&quot;</span> .</span><br></pre></td></tr></table></figure><p>æ„å»ºå®Œæˆåï¼Œä½¿ç”¨itbilu/testå¯åŠ¨ä¸€ä¸ªå®¹å™¨ï¼š</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker run -i -t  itbilu/<span class="built_in">test</span> -g <span class="string">&quot;daemon off;&quot;</span></span><br></pre></td></tr></table></figure><p>åœ¨è¿è¡Œå®¹å™¨æ—¶ï¼Œæˆ‘ä»¬ä½¿ç”¨äº† <code>-g &quot;daemon off;&quot;</code>ï¼Œè¿™ä¸ªå‚æ•°å°†ä¼šè¢«ä¼ é€’ç»™ ENTRYPOINTï¼Œæœ€ç»ˆåœ¨å®¹å™¨ä¸­æ‰§è¡Œçš„å‘½ä»¤ä¸º <code>/usr/sbin/nginx -g &quot;daemon off;&quot;</code>ã€‚</p><h3 id="12-LABEL"><a href="#12-LABEL" class="headerlink" title="12 LABEL"></a>12 LABEL</h3><p>LABELç”¨äºä¸ºé•œåƒæ·»åŠ å…ƒæ•°æ®ï¼Œå…ƒæ•°ä»¥é”®å€¼å¯¹çš„å½¢å¼æŒ‡å®šï¼š</p><figure class="highlight dockerfile"><table><tr><td class="code"><pre><span class="line"><span class="keyword">LABEL</span><span class="bash"> &lt;key&gt;=&lt;value&gt; &lt;key&gt;=&lt;value&gt; &lt;key&gt;=&lt;value&gt; ...</span></span><br></pre></td></tr></table></figure><p>ä½¿ç”¨LABELæŒ‡å®šå…ƒæ•°æ®æ—¶ï¼Œä¸€æ¡LABELæŒ‡å®šå¯ä»¥æŒ‡å®šä¸€æˆ–å¤šæ¡å…ƒæ•°æ®ï¼ŒæŒ‡å®šå¤šæ¡å…ƒæ•°æ®æ—¶ä¸åŒå…ƒæ•°æ®ä¹‹é—´é€šè¿‡ç©ºæ ¼åˆ†éš”ã€‚æ¨èå°†æ‰€æœ‰çš„å…ƒæ•°æ®é€šè¿‡ä¸€æ¡LABELæŒ‡ä»¤æŒ‡å®šï¼Œä»¥å…ç”Ÿæˆè¿‡å¤šçš„ä¸­é—´é•œåƒã€‚ å¦‚ï¼Œé€šè¿‡LABELæŒ‡å®šä¸€äº›å…ƒæ•°æ®ï¼š</p><figure class="highlight dockerfile"><table><tr><td class="code"><pre><span class="line"><span class="keyword">LABEL</span><span class="bash"> version=<span class="string">&quot;1.0&quot;</span> description=<span class="string">&quot;è¿™æ˜¯ä¸€ä¸ªWebæœåŠ¡å™¨&quot;</span> by=<span class="string">&quot;ITç¬”å½•&quot;</span></span></span><br></pre></td></tr></table></figure><p>æŒ‡å®šåå¯ä»¥é€šè¿‡docker inspectæŸ¥çœ‹ï¼š</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker inspect itbilu/<span class="built_in">test</span></span><br><span class="line"><span class="string">&quot;Labels&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;version&quot;</span>: <span class="string">&quot;1.0&quot;</span>,</span><br><span class="line">    <span class="string">&quot;description&quot;</span>: <span class="string">&quot;è¿™æ˜¯ä¸€ä¸ªWebæœåŠ¡å™¨&quot;</span>,</span><br><span class="line">    <span class="string">&quot;by&quot;</span>: <span class="string">&quot;ITç¬”å½•&quot;</span></span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><h3 id="13-ARG"><a href="#13-ARG" class="headerlink" title="13 ARG"></a>13 ARG</h3><p>ARGç”¨äºæŒ‡å®šä¼ é€’ç»™æ„å»ºè¿è¡Œæ—¶çš„å˜é‡ï¼š</p><figure class="highlight dockerfile"><table><tr><td class="code"><pre><span class="line"><span class="keyword">ARG</span> &lt;name&gt;[=&lt;default value&gt;]</span><br></pre></td></tr></table></figure><p>å¦‚ï¼Œé€šè¿‡ARGæŒ‡å®šä¸¤ä¸ªå˜é‡ï¼š</p><figure class="highlight dockerfile"><table><tr><td class="code"><pre><span class="line"><span class="keyword">ARG</span> site</span><br><span class="line"><span class="keyword">ARG</span> build_user=ITç¬”å½•</span><br></pre></td></tr></table></figure><p>ä»¥ä¸Šæˆ‘ä»¬æŒ‡å®šäº† site å’Œ build_user ä¸¤ä¸ªå˜é‡ï¼Œå…¶ä¸­ build_user æŒ‡å®šäº†é»˜è®¤å€¼ã€‚åœ¨ä½¿ç”¨ docker build æ„å»ºé•œåƒæ—¶ï¼Œå¯ä»¥é€šè¿‡ <code>--build-arg &lt;varname&gt;=&lt;value&gt;</code> å‚æ•°æ¥æŒ‡å®šæˆ–é‡è®¾ç½®è¿™äº›å˜é‡çš„å€¼ã€‚</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker build --build-arg site=itiblu.com -t itbilu/<span class="built_in">test</span> .</span><br></pre></td></tr></table></figure><p>è¿™æ ·æˆ‘ä»¬æ„å»ºäº† itbilu/test é•œåƒï¼Œå…¶ä¸­siteä¼šè¢«è®¾ç½®ä¸º itbilu.comï¼Œç”±äºæ²¡æœ‰æŒ‡å®š build_userï¼Œå…¶å€¼å°†æ˜¯é»˜è®¤å€¼ IT ç¬”å½•ã€‚</p><h3 id="14-ONBUILD"><a href="#14-ONBUILD" class="headerlink" title="14 ONBUILD"></a>14 ONBUILD</h3><p>ONBUILDç”¨äºè®¾ç½®é•œåƒè§¦å‘å™¨ï¼š</p><figure class="highlight dockerfile"><table><tr><td class="code"><pre><span class="line"><span class="keyword">ONBUILD</span> [INSTRUCTION]</span><br></pre></td></tr></table></figure><p>å½“æ‰€æ„å»ºçš„é•œåƒè¢«ç”¨åšå…¶å®ƒé•œåƒçš„åŸºç¡€é•œåƒï¼Œè¯¥é•œåƒä¸­çš„è§¦å‘å™¨å°†ä¼šè¢«é’¥è§¦å‘ã€‚ å¦‚ï¼Œå½“é•œåƒè¢«ä½¿ç”¨æ—¶ï¼Œå¯èƒ½éœ€è¦åšä¸€äº›å¤„ç†ï¼š</p><figure class="highlight dockerfile"><table><tr><td class="code"><pre><span class="line">[...]</span><br><span class="line"><span class="keyword">ONBUILD</span> <span class="keyword">ADD</span><span class="bash"> . /app/src</span></span><br><span class="line"><span class="keyword">ONBUILD</span> <span class="keyword">RUN</span><span class="bash"> /usr/<span class="built_in">local</span>/bin/python-build --dir /app/src</span></span><br><span class="line">[...]</span><br></pre></td></tr></table></figure><h3 id="15-STOPSIGNAL"><a href="#15-STOPSIGNAL" class="headerlink" title="15 STOPSIGNAL"></a>15 STOPSIGNAL</h3><p>STOPSIGNALç”¨äºè®¾ç½®åœæ­¢å®¹å™¨æ‰€è¦å‘é€çš„ç³»ç»Ÿè°ƒç”¨ä¿¡å·ï¼š</p><figure class="highlight dockerfile"><table><tr><td class="code"><pre><span class="line"><span class="keyword">STOPSIGNAL</span> signal</span><br></pre></td></tr></table></figure><p>æ‰€ä½¿ç”¨çš„ä¿¡å·å¿…é¡»æ˜¯å†…æ ¸ç³»ç»Ÿè°ƒç”¨è¡¨ä¸­çš„åˆæ³•çš„å€¼ï¼Œå¦‚ï¼šSIGKILLã€‚</p><h3 id="16-SHELL"><a href="#16-SHELL" class="headerlink" title="16 SHELL"></a>16 SHELL</h3><p>SHELLç”¨äºè®¾ç½®æ‰§è¡Œå‘½ä»¤ï¼ˆshellå¼ï¼‰æ‰€ä½¿ç”¨çš„çš„é»˜è®¤ shell ç±»å‹ï¼š</p><figure class="highlight dockerfile"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SHELL</span><span class="bash"> [<span class="string">&quot;executable&quot;</span>, <span class="string">&quot;parameters&quot;</span>]</span></span><br></pre></td></tr></table></figure><p>SHELLåœ¨Windowsç¯å¢ƒä¸‹æ¯”è¾ƒæœ‰ç”¨ï¼ŒWindows ä¸‹é€šå¸¸ä¼šæœ‰ cmd å’Œ powershell ä¸¤ç§ shellï¼Œå¯èƒ½è¿˜ä¼šæœ‰ shã€‚è¿™æ—¶å°±å¯ä»¥é€šè¿‡ SHELL æ¥æŒ‡å®šæ‰€ä½¿ç”¨çš„ shell ç±»å‹ï¼š</p><figure class="highlight dockerfile"><table><tr><td class="code"><pre><span class="line"><span class="keyword">FROM</span> microsoft/windowsservercore</span><br><span class="line"></span><br><span class="line"><span class="comment"># Executed as cmd /S /C echo default</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> <span class="built_in">echo</span> default</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Executed as cmd /S /C powershell -command Write-Host default</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> powershell -<span class="built_in">command</span> Write-Host default</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Executed as powershell -command Write-Host hello</span></span><br><span class="line"><span class="keyword">SHELL</span><span class="bash"> [<span class="string">&quot;powershell&quot;</span>, <span class="string">&quot;-command&quot;</span>]</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> Write-Host hello</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Executed as cmd /S /C echo hello</span></span><br><span class="line"><span class="keyword">SHELL</span><span class="bash"> [<span class="string">&quot;cmd&quot;</span>, <span class="string">&quot;/S&quot;</span><span class="string">&quot;, &quot;</span>/C<span class="string">&quot;]</span></span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> <span class="built_in">echo</span> hello</span></span><br></pre></td></tr></table></figure><h2 id="Dockerfile-ä½¿ç”¨ç»éªŒ"><a href="#Dockerfile-ä½¿ç”¨ç»éªŒ" class="headerlink" title="Dockerfile ä½¿ç”¨ç»éªŒ"></a>Dockerfile ä½¿ç”¨ç»éªŒ</h2><h3 id="Dockerfile-ç¤ºä¾‹"><a href="#Dockerfile-ç¤ºä¾‹" class="headerlink" title="Dockerfile ç¤ºä¾‹"></a>Dockerfile ç¤ºä¾‹</h3><p><strong>æ„å»ºNginxè¿è¡Œç¯å¢ƒ</strong></p><figure class="highlight dockerfile"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æŒ‡å®šåŸºç¡€é•œåƒ</span></span><br><span class="line"><span class="keyword">FROM</span> sameersbn/ubuntu:<span class="number">14.04</span>.<span class="number">20161014</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç»´æŠ¤è€…ä¿¡æ¯</span></span><br><span class="line"><span class="keyword">MAINTAINER</span> sameer@damagehead.com</span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¾ç½®ç¯å¢ƒ</span></span><br><span class="line"><span class="keyword">ENV</span> RTMP_VERSION=<span class="number">1.1</span>.<span class="number">10</span> \</span><br><span class="line">    NPS_VERSION=<span class="number">1.11</span>.<span class="number">33.4</span> \</span><br><span class="line">    LIBAV_VERSION=<span class="number">11.8</span> \</span><br><span class="line">    NGINX_VERSION=<span class="number">1.10</span>.<span class="number">1</span> \</span><br><span class="line">    NGINX_USER=www-data \</span><br><span class="line">    NGINX_SITECONF_DIR=/etc/nginx/sites-enabled \</span><br><span class="line">    NGINX_LOG_DIR=/var/log/nginx \</span><br><span class="line">    NGINX_TEMP_DIR=/var/lib/nginx \</span><br><span class="line">    NGINX_SETUP_DIR=/var/cache/nginx</span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¾ç½®æ„å»ºæ—¶å˜é‡ï¼Œé•œåƒå»ºç«‹å®Œæˆåå°±å¤±æ•ˆ</span></span><br><span class="line"><span class="keyword">ARG</span> BUILD_LIBAV=false</span><br><span class="line"><span class="keyword">ARG</span> WITH_DEBUG=false</span><br><span class="line"><span class="keyword">ARG</span> WITH_PAGESPEED=true</span><br><span class="line"><span class="keyword">ARG</span> WITH_RTMP=true</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¤åˆ¶æœ¬åœ°æ–‡ä»¶åˆ°å®¹å™¨ç›®å½•ä¸­</span></span><br><span class="line"><span class="keyword">COPY</span><span class="bash"> setup/ <span class="variable">$&#123;NGINX_SETUP_DIR&#125;</span>/</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> bash <span class="variable">$&#123;NGINX_SETUP_DIR&#125;</span>/install.sh</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¤åˆ¶æœ¬åœ°é…ç½®æ–‡ä»¶åˆ°å®¹å™¨ç›®å½•ä¸­</span></span><br><span class="line"><span class="keyword">COPY</span><span class="bash"> nginx.conf /etc/nginx/nginx.conf</span></span><br><span class="line"><span class="keyword">COPY</span><span class="bash"> entrypoint.sh /sbin/entrypoint.sh</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿è¡ŒæŒ‡ä»¤</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> chmod 755 /sbin/entrypoint.sh</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å…è®¸æŒ‡å®šçš„ç«¯å£</span></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">80</span>/tcp <span class="number">443</span>/tcp <span class="number">1935</span>/tcp</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŒ‡å®šç½‘ç«™ç›®å½•æŒ‚è½½ç‚¹</span></span><br><span class="line"><span class="keyword">VOLUME</span><span class="bash"> [<span class="string">&quot;<span class="variable">$&#123;NGINX_SITECONF_DIR&#125;</span>&quot;</span>]</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="bash"> [<span class="string">&quot;/sbin/entrypoint.sh&quot;</span>]</span></span><br><span class="line"><span class="keyword">CMD</span><span class="bash"> [<span class="string">&quot;/usr/sbin/nginx&quot;</span>]</span></span><br></pre></td></tr></table></figure><p><strong>æ„å»ºtomcat ç¯å¢ƒ</strong></p><p>Dockerfileæ–‡ä»¶</p><figure class="highlight dockerfile"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æŒ‡å®šåŸºäºçš„åŸºç¡€é•œåƒ</span></span><br><span class="line"><span class="keyword">FROM</span> ubuntu:<span class="number">13.10</span>  </span><br><span class="line"></span><br><span class="line"><span class="comment"># ç»´æŠ¤è€…ä¿¡æ¯</span></span><br><span class="line"><span class="keyword">MAINTAINER</span> zhangjiayang <span class="string">&quot;zhangjiayang@sczq.com.cn&quot;</span>  </span><br><span class="line">  </span><br><span class="line"><span class="comment"># é•œåƒçš„æŒ‡ä»¤æ“ä½œ</span></span><br><span class="line"><span class="comment"># è·å–APTæ›´æ–°çš„èµ„æºåˆ—è¡¨</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> <span class="built_in">echo</span> <span class="string">&quot;deb http://archive.ubuntu.com/ubuntu precise main universe&quot;</span>&gt; /etc/apt/sources.list</span></span><br><span class="line"><span class="comment"># æ›´æ–°è½¯ä»¶</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> apt-get update  </span></span><br><span class="line">  </span><br><span class="line"><span class="comment"># Install curl  </span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> apt-get -y install curl  </span></span><br><span class="line">  </span><br><span class="line"><span class="comment"># Install JDK 7  </span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> <span class="built_in">cd</span> /tmp &amp;&amp;  curl -L <span class="string">&#x27;http://download.oracle.com/otn-pub/java/jdk/7u65-b17/jdk-7u65-linux-x64.tar.gz&#x27;</span> -H <span class="string">&#x27;Cookie: oraclelicense=accept-securebackup-cookie; gpw_e24=Dockerfile&#x27;</span> | tar -xz  </span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> mkdir -p /usr/lib/jvm  </span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> mv /tmp/jdk1.7.0_65/ /usr/lib/jvm/java-7-oracle/  </span></span><br><span class="line">  </span><br><span class="line"><span class="comment"># Set Oracle JDK 7 as default Java  </span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> update-alternatives --install /usr/bin/java java /usr/lib/jvm/java-7-oracle/bin/java 300     </span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> update-alternatives --install /usr/bin/javac javac /usr/lib/jvm/java-7-oracle/bin/javac 300     </span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¾ç½®ç³»ç»Ÿç¯å¢ƒ</span></span><br><span class="line"><span class="keyword">ENV</span> JAVA_HOME /usr/lib/jvm/java-<span class="number">7</span>-oracle/  </span><br><span class="line">  </span><br><span class="line"><span class="comment"># Install tomcat7  </span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> <span class="built_in">cd</span> /tmp &amp;&amp; curl -L <span class="string">&#x27;http://archive.apache.org/dist/tomcat/tomcat-7/v7.0.8/bin/apache-tomcat-7.0.8.tar.gz&#x27;</span> | tar -xz  </span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> mv /tmp/apache-tomcat-7.0.8/ /opt/tomcat7/  </span></span><br><span class="line">  </span><br><span class="line"><span class="keyword">ENV</span> CATALINA_HOME /opt/tomcat7  </span><br><span class="line"><span class="keyword">ENV</span> PATH $PATH:$CATALINA_HOME/bin  </span><br><span class="line"></span><br><span class="line"><span class="comment"># å¤ä»¶tomcat7.shåˆ°å®¹å™¨ä¸­çš„ç›®å½• </span></span><br><span class="line"><span class="keyword">ADD</span><span class="bash"> tomcat7.sh /etc/init.d/tomcat7  </span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> chmod 755 /etc/init.d/tomcat7  </span></span><br><span class="line">  </span><br><span class="line"><span class="comment"># Expose ports.  æŒ‡å®šæš´éœ²çš„ç«¯å£</span></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">8080</span>  </span><br><span class="line">  </span><br><span class="line"><span class="comment"># Define default command.  </span></span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="bash"> service tomcat7 start &amp;&amp; tail -f /opt/tomcat7/logs/catalina.out</span></span><br></pre></td></tr></table></figure><p><code>tomcat7.sh</code>å‘½ä»¤æ–‡ä»¶</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">export JAVA_HOME=/usr/lib/jvm/java-7-oracle/  </span><br><span class="line">export TOMCAT_HOME=/opt/tomcat7  </span><br><span class="line">  </span><br><span class="line">case $1 in  </span><br><span class="line">start)  </span><br><span class="line">  sh $TOMCAT_HOME/bin/startup.sh  </span><br><span class="line">;;  </span><br><span class="line">stop)  </span><br><span class="line">  sh $TOMCAT_HOME/bin/shutdown.sh  </span><br><span class="line">;;  </span><br><span class="line">restart)  </span><br><span class="line">  sh $TOMCAT_HOME/bin/shutdown.sh  </span><br><span class="line">  sh $TOMCAT_HOME/bin/startup.sh  </span><br><span class="line">;;  </span><br><span class="line">esac  </span><br><span class="line">exit 0</span><br></pre></td></tr></table></figure><h3 id="åŸåˆ™ä¸å»ºè®®"><a href="#åŸåˆ™ä¸å»ºè®®" class="headerlink" title="åŸåˆ™ä¸å»ºè®®"></a>åŸåˆ™ä¸å»ºè®®</h3><ul><li>å®¹å™¨è½»é‡åŒ–ã€‚ä»é•œåƒä¸­äº§ç”Ÿçš„å®¹å™¨åº”è¯¥å°½é‡è½»é‡åŒ–ï¼Œèƒ½åœ¨è¶³å¤ŸçŸ­çš„æ—¶é—´å†…åœæ­¢ã€é”€æ¯ã€é‡æ–°ç”Ÿæˆå¹¶æ›¿æ¢åŸæ¥çš„å®¹å™¨ã€‚</li><li>ä½¿ç”¨ <code>.gitignore</code>ã€‚åœ¨å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼ŒDockerfile ä¼šå’Œæ„å»ºæ‰€éœ€çš„æ–‡ä»¶æ”¾åœ¨åŒä¸€ä¸ªç›®å½•ä¸­ï¼Œä¸ºäº†æé«˜æ„å»ºçš„æ€§èƒ½ï¼Œåº”è¯¥ä½¿ç”¨ <code>.gitignore</code> æ¥è¿‡æ»¤æ‰ä¸éœ€è¦çš„æ–‡ä»¶å’Œç›®å½•ã€‚</li><li>ä¸ºäº†å‡å°‘é•œåƒçš„å¤§å°ï¼Œå‡å°‘ä¾èµ–ï¼Œä»…å®‰è£…éœ€è¦çš„è½¯ä»¶åŒ…ã€‚</li><li>ä¸€ä¸ªå®¹å™¨åªåšä¸€ä»¶äº‹ã€‚è§£è€¦å¤æ‚çš„åº”ç”¨ï¼Œåˆ†æˆå¤šä¸ªå®¹å™¨ï¼Œè€Œä¸æ˜¯æ‰€æœ‰ä¸œè¥¿éƒ½æ”¾åœ¨ä¸€ä¸ªå®¹å™¨å†…è¿è¡Œã€‚å¦‚ä¸€ä¸ª Python Web åº”ç”¨ï¼Œå¯èƒ½éœ€è¦ Serverã€DBã€Cacheã€MQã€Log ç­‰å‡ ä¸ªå®¹å™¨ã€‚ä¸€ä¸ªæ›´åŠ æç«¯çš„è¯´æ³•ï¼šOne process per containerã€‚</li><li>å‡å°‘é•œåƒçš„å›¾å±‚ã€‚ä¸è¦å¤šä¸ª Labelã€ENV ç­‰æ ‡ç­¾ã€‚</li><li>å¯¹ç»­è¡Œçš„å‚æ•°æŒ‰ç…§å­—æ¯è¡¨æ’åºï¼Œç‰¹åˆ«æ˜¯ä½¿ç”¨<code>apt-get install -y</code>å®‰è£…åŒ…çš„æ—¶å€™ã€‚</li><li>ä½¿ç”¨æ„å»ºç¼“å­˜ã€‚å¦‚æœä¸æƒ³ä½¿ç”¨ç¼“å­˜ï¼Œå¯ä»¥åœ¨æ„å»ºçš„æ—¶å€™ä½¿ç”¨å‚æ•°<code>--no-cache=true</code>æ¥å¼ºåˆ¶é‡æ–°ç”Ÿæˆä¸­é—´é•œåƒã€‚</li></ul>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®°æœ¬ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Docker </tag>
            
            <tag> Dockerfile </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Dockerfileä½¿ç”¨ä»‹ç»</title>
      <link href="post/c15a63a5/"/>
      <url>post/c15a63a5/</url>
      
        <content type="html"><![CDATA[<blockquote><p>è½¬è‡ªï¼š<a href="http://www.ityouknow.com/docker/2018/03/12/docker-use-dockerfile.html">Docker(äºŒ)ï¼šDockerfile ä½¿ç”¨ä»‹ç»</a>ï¼Œ æ€•ä»¥åæ‰¾ä¸åˆ°</p></blockquote><h2 id="Dockerfile-æ¦‚å¿µ"><a href="#Dockerfile-æ¦‚å¿µ" class="headerlink" title="Dockerfile æ¦‚å¿µ"></a>Dockerfile æ¦‚å¿µ</h2><p>Docker é•œåƒæ˜¯ä¸€ä¸ªç‰¹æ®Šçš„æ–‡ä»¶ç³»ç»Ÿï¼Œé™¤äº†æä¾›å®¹å™¨è¿è¡Œæ—¶æ‰€éœ€çš„ç¨‹åºã€åº“ã€èµ„æºã€é…ç½®ç­‰æ–‡ä»¶å¤–ï¼Œè¿˜åŒ…å«äº†ä¸€äº›ä¸ºè¿è¡Œæ—¶å‡†å¤‡çš„ä¸€äº›é…ç½®å‚æ•°ï¼ˆå¦‚åŒ¿åå·ã€ç¯å¢ƒå˜é‡ã€ç”¨æˆ·ç­‰ï¼‰ã€‚é•œåƒä¸åŒ…å«ä»»ä½•åŠ¨æ€æ•°æ®ï¼Œå…¶å†…å®¹åœ¨æ„å»ºä¹‹åä¹Ÿä¸ä¼šè¢«æ”¹å˜ã€‚</p><p>é•œåƒçš„å®šåˆ¶å®é™…ä¸Šå°±æ˜¯å®šåˆ¶æ¯ä¸€å±‚æ‰€æ·»åŠ çš„é…ç½®ã€æ–‡ä»¶ã€‚å¦‚æœæˆ‘ä»¬å¯ä»¥æŠŠæ¯ä¸€å±‚ä¿®æ”¹ã€å®‰è£…ã€æ„å»ºã€æ“ä½œçš„å‘½ä»¤éƒ½å†™å…¥ä¸€ä¸ªè„šæœ¬ï¼Œç”¨è¿™ä¸ªè„šæœ¬æ¥æ„å»ºã€å®šåˆ¶é•œåƒï¼Œé‚£ä¹ˆä¹‹å‰æåŠçš„æ— æ³•é‡å¤çš„é—®é¢˜ã€é•œåƒæ„å»ºé€æ˜æ€§çš„é—®é¢˜ã€ä½“ç§¯çš„é—®é¢˜å°±éƒ½ä¼šè§£å†³ã€‚è¿™ä¸ªè„šæœ¬å°±æ˜¯ Dockerfileã€‚</p><p>Dockerfile æ˜¯ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶ï¼Œå…¶å†…åŒ…å«äº†ä¸€æ¡æ¡çš„æŒ‡ä»¤(Instruction)ï¼Œæ¯ä¸€æ¡æŒ‡ä»¤æ„å»ºä¸€å±‚ï¼Œå› æ­¤æ¯ä¸€æ¡æŒ‡ä»¤çš„å†…å®¹ï¼Œå°±æ˜¯æè¿°è¯¥å±‚åº”å½“å¦‚ä½•æ„å»ºã€‚æœ‰äº† Dockerfileï¼Œå½“æˆ‘ä»¬éœ€è¦å®šåˆ¶è‡ªå·±é¢å¤–çš„éœ€æ±‚æ—¶ï¼Œåªéœ€åœ¨ Dockerfile ä¸Šæ·»åŠ æˆ–è€…ä¿®æ”¹æŒ‡ä»¤ï¼Œé‡æ–°ç”Ÿæˆ image å³å¯ï¼Œçœå»äº†æ•²å‘½ä»¤çš„éº»çƒ¦ã€‚</p><h2 id="Dockerfile-æ–‡ä»¶æ ¼å¼"><a href="#Dockerfile-æ–‡ä»¶æ ¼å¼" class="headerlink" title="Dockerfile æ–‡ä»¶æ ¼å¼"></a>Dockerfile æ–‡ä»¶æ ¼å¼</h2><p>Dockerfileæ–‡ä»¶æ ¼å¼å¦‚ä¸‹ï¼š</p><figure class="highlight dockerfile"><table><tr><td class="code"><pre><span class="line"><span class="comment">##  Dockerfileæ–‡ä»¶æ ¼å¼</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># This dockerfile uses the ubuntu image</span></span><br><span class="line"><span class="comment"># VERSION 2 - EDITION 1</span></span><br><span class="line"><span class="comment"># Author: docker_user</span></span><br><span class="line"><span class="comment"># Command format: Instruction [arguments / command] ..</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># 1ã€ç¬¬ä¸€è¡Œå¿…é¡»æŒ‡å®š åŸºç¡€é•œåƒä¿¡æ¯</span></span><br><span class="line"><span class="keyword">FROM</span> ubuntu</span><br><span class="line"> </span><br><span class="line"><span class="comment"># 2ã€ç»´æŠ¤è€…ä¿¡æ¯</span></span><br><span class="line"><span class="keyword">MAINTAINER</span> docker_user docker_user@email.com</span><br><span class="line"> </span><br><span class="line"><span class="comment"># 3ã€é•œåƒæ“ä½œæŒ‡ä»¤</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> <span class="built_in">echo</span> <span class="string">&quot;deb http://archive.ubuntu.com/ubuntu/ raring main universe&quot;</span> &gt;&gt; /etc/apt/sources.list</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> apt-get update &amp;&amp; apt-get install -y nginx</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> <span class="built_in">echo</span> <span class="string">&quot;\ndaemon off;&quot;</span> &gt;&gt; /etc/nginx/nginx.conf</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># 4ã€å®¹å™¨å¯åŠ¨æ‰§è¡ŒæŒ‡ä»¤</span></span><br><span class="line"><span class="keyword">CMD</span><span class="bash"> /usr/sbin/nginx</span></span><br></pre></td></tr></table></figure><p>Dockerfile åˆ†ä¸ºå››éƒ¨åˆ†ï¼š<strong>åŸºç¡€é•œåƒä¿¡æ¯ã€ç»´æŠ¤è€…ä¿¡æ¯ã€é•œåƒæ“ä½œæŒ‡ä»¤ã€å®¹å™¨å¯åŠ¨æ‰§è¡ŒæŒ‡ä»¤</strong>ã€‚ä¸€å¼€å§‹å¿…é¡»è¦æŒ‡æ˜æ‰€åŸºäºçš„é•œåƒåç§°ï¼Œæ¥ä¸‹æ¥ä¸€èˆ¬ä¼šè¯´æ˜ç»´æŠ¤è€…ä¿¡æ¯ï¼›åé¢åˆ™æ˜¯é•œåƒæ“ä½œæŒ‡ä»¤ï¼Œä¾‹å¦‚ RUN æŒ‡ä»¤ã€‚æ¯æ‰§è¡Œä¸€æ¡RUN æŒ‡ä»¤ï¼Œé•œåƒæ·»åŠ æ–°çš„ä¸€å±‚ï¼Œå¹¶æäº¤ï¼›æœ€åæ˜¯ CMD æŒ‡ä»¤ï¼Œæ¥æŒ‡æ˜è¿è¡Œå®¹å™¨æ—¶çš„æ“ä½œå‘½ä»¤ã€‚</p><h2 id="æ„å»ºé•œåƒ"><a href="#æ„å»ºé•œåƒ" class="headerlink" title="æ„å»ºé•œåƒ"></a>æ„å»ºé•œåƒ</h2><p>docker build å‘½ä»¤ä¼šæ ¹æ® Dockerfile æ–‡ä»¶åŠä¸Šä¸‹æ–‡æ„å»ºæ–° Docker é•œåƒã€‚æ„å»ºä¸Šä¸‹æ–‡æ˜¯æŒ‡ Dockerfile æ‰€åœ¨çš„æœ¬åœ°è·¯å¾„æˆ–ä¸€ä¸ªURLï¼ˆGitä»“åº“åœ°å€ï¼‰ã€‚æ„å»ºä¸Šä¸‹æ–‡ç¯å¢ƒä¼šè¢«é€’å½’å¤„ç†ï¼Œæ‰€ä»¥æ„å»ºæ‰€æŒ‡å®šçš„è·¯å¾„è¿˜åŒ…æ‹¬äº†å­ç›®å½•ï¼Œè€ŒURLè¿˜åŒ…æ‹¬äº†å…¶ä¸­æŒ‡å®šçš„å­æ¨¡å—ã€‚</p><p>å°†å½“å‰ç›®å½•åšä¸ºæ„å»ºä¸Šä¸‹æ–‡æ—¶ï¼Œå¯ä»¥åƒä¸‹é¢è¿™æ ·ä½¿ç”¨docker buildå‘½ä»¤æ„å»ºé•œåƒï¼š</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker build .</span><br><span class="line">Sending build context to Docker daemon  6.51 MB</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>è¯´æ˜ï¼šæ„å»ºä¼šåœ¨ Docker åå°å®ˆæŠ¤è¿›ç¨‹ï¼ˆdaemonï¼‰ä¸­æ‰§è¡Œï¼Œè€Œä¸æ˜¯<code>CLI</code>ä¸­ã€‚æ„å»ºå‰ï¼Œæ„å»ºè¿›ç¨‹ä¼šå°†å…¨éƒ¨å†…å®¹ï¼ˆé€’å½’ï¼‰å‘é€åˆ°å®ˆæŠ¤è¿›ç¨‹ã€‚å¤§å¤šæƒ…å†µä¸‹ï¼Œåº”è¯¥å°†ä¸€ä¸ªç©ºç›®å½•ä½œä¸ºæ„å»ºä¸Šä¸‹æ–‡ç¯å¢ƒï¼Œå¹¶å°† Dockerfile æ–‡ä»¶æ”¾åœ¨è¯¥ç›®å½•ä¸‹ã€‚</p><p>åœ¨æ„å»ºä¸Šä¸‹æ–‡ä¸­ä½¿ç”¨çš„ Dockerfile æ–‡ä»¶ï¼Œæ˜¯ä¸€ä¸ªæ„å»ºæŒ‡ä»¤æ–‡ä»¶ã€‚ä¸ºäº†æé«˜æ„å»ºæ€§èƒ½ï¼Œå¯ä»¥é€šè¿‡<code>.dockerignore</code>æ–‡ä»¶æ’é™¤ä¸Šä¸‹æ–‡ç›®å½•ä¸‹ä¸éœ€è¦çš„æ–‡ä»¶å’Œç›®å½•ã€‚</p><p>åœ¨ Docker æ„å»ºé•œåƒçš„ç¬¬ä¸€æ­¥ï¼Œdocker CLI ä¼šå…ˆåœ¨ä¸Šä¸‹æ–‡ç›®å½•ä¸­å¯»æ‰¾<code>.dockerignore</code>æ–‡ä»¶ï¼Œæ ¹æ®<code>.dockerignore</code> æ–‡ä»¶æ’é™¤ä¸Šä¸‹æ–‡ç›®å½•ä¸­çš„éƒ¨åˆ†æ–‡ä»¶å’Œç›®å½•ï¼Œç„¶åæŠŠå‰©ä¸‹çš„æ–‡ä»¶å’Œç›®å½•ä¼ é€’ç»™ Docker æœåŠ¡ã€‚</p><p>Dockerfile ä¸€èˆ¬ä½äºæ„å»ºä¸Šä¸‹æ–‡çš„æ ¹ç›®å½•ä¸‹ï¼Œä¹Ÿå¯ä»¥é€šè¿‡<code>-f</code>æŒ‡å®šè¯¥æ–‡ä»¶çš„ä½ç½®ï¼š</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker build -f /path/to/a/Dockerfile .</span><br></pre></td></tr></table></figure><p>æ„å»ºæ—¶ï¼Œè¿˜å¯ä»¥é€šè¿‡<code>-t</code>å‚æ•°æŒ‡å®šæ„å»ºæˆé•œåƒçš„ä»“åº“ã€æ ‡ç­¾ã€‚</p><h2 id="é•œåƒæ ‡ç­¾"><a href="#é•œåƒæ ‡ç­¾" class="headerlink" title="é•œåƒæ ‡ç­¾"></a>é•œåƒæ ‡ç­¾</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker build -t nginx/v3 .</span><br></pre></td></tr></table></figure><p>å¦‚æœå­˜åœ¨å¤šä¸ªä»“åº“ä¸‹ï¼Œæˆ–ä½¿ç”¨å¤šä¸ªé•œåƒæ ‡ç­¾ï¼Œå°±å¯ä»¥ä½¿ç”¨å¤šä¸ª<code>-t</code>å‚æ•°ï¼š</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker build -t nginx/v3:1.0.2 -t nginx/v3:latest .</span><br></pre></td></tr></table></figure><p>åœ¨ Docker å®ˆæŠ¤è¿›ç¨‹æ‰§è¡Œ Dockerfile ä¸­çš„æŒ‡ä»¤å‰ï¼Œé¦–å…ˆä¼šå¯¹ Dockerfile è¿›è¡Œè¯­æ³•æ£€æŸ¥ï¼Œæœ‰è¯­æ³•é”™è¯¯æ—¶ä¼šè¿”å›ï¼š</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker build -t nginx/v3 .</span><br><span class="line">Sending build context to Docker daemon 2.048 kB</span><br><span class="line">Error response from daemon: Unknown instruction: RUNCMD</span><br></pre></td></tr></table></figure><h2 id="ç¼“å­˜"><a href="#ç¼“å­˜" class="headerlink" title="ç¼“å­˜"></a>ç¼“å­˜</h2><p>Docker å®ˆæŠ¤è¿›ç¨‹ä¼šä¸€æ¡ä¸€æ¡çš„æ‰§è¡Œ Dockerfile ä¸­çš„æŒ‡ä»¤ï¼Œè€Œä¸”ä¼šåœ¨æ¯ä¸€æ­¥æäº¤å¹¶ç”Ÿæˆä¸€ä¸ªæ–°é•œåƒï¼Œæœ€åä¼šè¾“å‡ºæœ€ç»ˆé•œåƒçš„IDã€‚ç”Ÿæˆå®Œæˆåï¼ŒDocker å®ˆæŠ¤è¿›ç¨‹ä¼šè‡ªåŠ¨æ¸…ç†ä½ å‘é€çš„ä¸Šä¸‹æ–‡ã€‚ Dockerfileæ–‡ä»¶ä¸­çš„æ¯æ¡æŒ‡ä»¤ä¼šè¢«ç‹¬ç«‹æ‰§è¡Œï¼Œå¹¶ä¼šåˆ›å»ºä¸€ä¸ªæ–°é•œåƒï¼ŒRUN cd /tmpç­‰å‘½ä»¤ä¸ä¼šå¯¹ä¸‹æ¡æŒ‡ä»¤äº§ç”Ÿå½±å“ã€‚ Docker ä¼šé‡ç”¨å·²ç”Ÿæˆçš„ä¸­é—´é•œåƒï¼Œä»¥åŠ é€Ÿdocker buildçš„æ„å»ºé€Ÿåº¦ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªä½¿ç”¨äº†ç¼“å­˜é•œåƒçš„æ‰§è¡Œè¿‡ç¨‹ï¼š</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ docker build -t svendowideit/ambassador .</span><br><span class="line">Sending build context to Docker daemon 15.36 kB</span><br><span class="line">Step 1/4 : FROM alpine:3.2</span><br><span class="line"> ---&gt; 31f630c65071</span><br><span class="line">Step 2/4 : MAINTAINER SvenDowideit@home.org.au</span><br><span class="line"> ---&gt; Using cache</span><br><span class="line"> ---&gt; 2a1c91448f5f</span><br><span class="line">Step 3/4 : RUN apk update &amp;&amp;      apk add socat &amp;&amp;        rm -r /var/cache/</span><br><span class="line"> ---&gt; Using cache</span><br><span class="line"> ---&gt; 21ed6e7fbb73</span><br><span class="line">Step 4/4 : CMD env | grep _TCP= | (sed <span class="string">&#x27;s/.*_PORT_\([0-9]*\)_TCP=tcp:\/\/\(.*\):\(.*\)/socat -t 100000000 TCP4-LISTEN:\1,fork,reuseaddr TCP4:\2:\3 \&amp;/&#x27;</span> &amp;&amp; <span class="built_in">echo</span> <span class="built_in">wait</span>) | sh</span><br><span class="line"> ---&gt; Using cache</span><br><span class="line"> ---&gt; 7ea8aef582cc</span><br><span class="line">Successfully built 7ea8aef582cc</span><br></pre></td></tr></table></figure><p>æ„å»ºç¼“å­˜ä»…ä¼šä½¿ç”¨æœ¬åœ°çˆ¶ç”Ÿæˆé“¾ä¸Šçš„é•œåƒï¼Œå¦‚æœä¸æƒ³ä½¿ç”¨æœ¬åœ°ç¼“å­˜çš„é•œåƒï¼Œä¹Ÿå¯ä»¥é€šè¿‡<code>--cache-from</code>æŒ‡å®šç¼“å­˜ã€‚æŒ‡å®šåå°†ä¸å†ä½¿ç”¨æœ¬åœ°ç”Ÿæˆçš„é•œåƒé“¾ï¼Œè€Œæ˜¯ä»é•œåƒä»“åº“ä¸­ä¸‹è½½ã€‚</p><h2 id="å¯»æ‰¾ç¼“å­˜çš„é€»è¾‘"><a href="#å¯»æ‰¾ç¼“å­˜çš„é€»è¾‘" class="headerlink" title="å¯»æ‰¾ç¼“å­˜çš„é€»è¾‘"></a>å¯»æ‰¾ç¼“å­˜çš„é€»è¾‘</h2><p>Docker å¯»æ‰¾ç¼“å­˜çš„é€»è¾‘å…¶å®å°±æ˜¯æ ‘å‹ç»“æ„æ ¹æ® Dockerfile æŒ‡ä»¤éå†å­èŠ‚ç‚¹çš„è¿‡ç¨‹ã€‚ä¸‹å›¾å¯ä»¥è¯´æ˜è¿™ä¸ªé€»è¾‘ã€‚</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">     FROM base_image:version           Dockerfile:</span><br><span class="line">           +----------+                FROM base_image:version</span><br><span class="line">           |base image|                RUN cmd1  --&gt; use cache because we found base image</span><br><span class="line">           +-----X----+                RUN cmd11 --&gt; use cache because we found cmd1</span><br><span class="line">                / \</span><br><span class="line">               /   \</span><br><span class="line">       RUN cmd1     RUN cmd2           Dockerfile:</span><br><span class="line">       +------+     +------+           FROM base_image:version</span><br><span class="line">       |image1|     |image2|           RUN cmd2  --&gt; use cache because we found base image</span><br><span class="line">       +---X--+     +------+           RUN cmd21 --&gt; not use cache because there<span class="string">&#x27;s no child node</span></span><br><span class="line"><span class="string">          / \                                        running cmd21, so we build a new image here</span></span><br><span class="line"><span class="string">         /   \</span></span><br><span class="line"><span class="string">RUN cmd11     RUN cmd12</span></span><br><span class="line"><span class="string">+-------+     +-------+</span></span><br><span class="line"><span class="string">|image11|     |image12|</span></span><br><span class="line"><span class="string">+-------+     +-------+</span></span><br></pre></td></tr></table></figure><p>å¤§éƒ¨åˆ†æŒ‡ä»¤å¯ä»¥æ ¹æ®ä¸Šè¿°é€»è¾‘å»å¯»æ‰¾ç¼“å­˜ï¼Œé™¤äº† ADD å’Œ COPY ã€‚è¿™ä¸¤ä¸ªæŒ‡ä»¤ä¼šå¤åˆ¶æ–‡ä»¶å†…å®¹åˆ°é•œåƒå†…ï¼Œé™¤äº†æŒ‡ä»¤ç›¸åŒä»¥å¤–ï¼ŒDocker è¿˜ä¼šæ£€æŸ¥æ¯ä¸ªæ–‡ä»¶å†…å®¹æ ¡éªŒ(ä¸åŒ…æ‹¬æœ€åä¿®æ”¹æ—¶é—´å’Œæœ€åè®¿é—®æ—¶é—´)ï¼Œå¦‚æœæ ¡éªŒä¸ä¸€è‡´ï¼Œåˆ™ä¸ä¼šä½¿ç”¨ç¼“å­˜ã€‚</p><p>é™¤äº†è¿™ä¸¤ä¸ªå‘½ä»¤ï¼ŒDocker å¹¶ä¸ä¼šå»æ£€æŸ¥å®¹å™¨å†…çš„æ–‡ä»¶å†…å®¹ï¼Œæ¯”å¦‚ <code>RUN apt-get -y update</code>ï¼Œæ¯æ¬¡æ‰§è¡Œæ—¶æ–‡ä»¶å¯èƒ½éƒ½ä¸ä¸€æ ·ï¼Œä½†æ˜¯ Docker è®¤ä¸ºå‘½ä»¤ä¸€è‡´ï¼Œä¼šç»§ç»­ä½¿ç”¨ç¼“å­˜ã€‚è¿™æ ·ä¸€æ¥ï¼Œä»¥åæ„å»ºæ—¶éƒ½ä¸ä¼šå†é‡æ–°è¿è¡Œ<code>apt-get -y update</code>ã€‚</p><p>å¦‚æœ Docker æ²¡æœ‰æ‰¾åˆ°å½“å‰æŒ‡ä»¤çš„ç¼“å­˜ï¼Œåˆ™ä¼šæ„å»ºä¸€ä¸ªæ–°çš„é•œåƒï¼Œå¹¶ä¸”ä¹‹åçš„æ‰€æœ‰æŒ‡ä»¤éƒ½ä¸ä¼šå†å»å¯»æ‰¾ç¼“å­˜ã€‚</p><h2 id="ç®€å•ç¤ºä¾‹"><a href="#ç®€å•ç¤ºä¾‹" class="headerlink" title="ç®€å•ç¤ºä¾‹"></a>ç®€å•ç¤ºä¾‹</h2><p>æ¥ä¸‹æ¥ç”¨ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹æ¥æ„Ÿå—ä¸€ä¸‹ Dockerfile æ˜¯å¦‚ä½•ç”¨æ¥æ„å»ºé•œåƒå¯åŠ¨å®¹å™¨ã€‚æˆ‘ä»¬ä»¥å®šåˆ¶ nginx é•œåƒä¸ºä¾‹ï¼Œåœ¨ä¸€ä¸ªç©ºç™½ç›®å½•ä¸­ï¼Œå»ºç«‹ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶ï¼Œå¹¶å‘½åä¸º Dockerfileï¼š</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">mkdir mynginx</span><br><span class="line"><span class="built_in">cd</span> mynginx</span><br><span class="line">vi Dockerfile</span><br></pre></td></tr></table></figure><p>æ„å»ºä¸€ä¸ª Dockerfile æ–‡ä»¶å†…å®¹ä¸ºï¼š</p><figure class="highlight dockerfile"><table><tr><td class="code"><pre><span class="line"><span class="keyword">FROM</span> nginx</span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> <span class="built_in">echo</span> <span class="string">&#x27;&lt;h1&gt;Hello, Docker!&lt;/h1&gt;&#x27;</span> &gt; /usr/share/nginx/html/index.html</span></span><br><span class="line">vi Dockerfile</span><br></pre></td></tr></table></figure><p>è¿™ä¸ª Dockerfile å¾ˆç®€å•ï¼Œä¸€å…±å°±ä¸¤è¡Œæ¶‰åŠåˆ°äº†ä¸¤æ¡æŒ‡ä»¤ï¼šFROM å’Œ RUNï¼ŒFROM è¡¨ç¤ºè·å–æŒ‡å®šåŸºç¡€é•œåƒï¼ŒRUN æ‰§è¡Œå‘½ä»¤ï¼Œåœ¨æ‰§è¡Œçš„è¿‡ç¨‹ä¸­é‡å†™äº† nginx çš„é»˜è®¤é¡µé¢ä¿¡æ¯ï¼Œå°†ä¿¡æ¯æ›¿æ¢ä¸ºï¼šHello, Docker!ã€‚</p><p>åœ¨ Dockerfile æ–‡ä»¶æ‰€åœ¨ç›®å½•æ‰§è¡Œï¼š</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker build -t nginx:v1 .</span><br></pre></td></tr></table></figure><p>å‘½ä»¤æœ€åæœ‰ä¸€ä¸ª. è¡¨ç¤ºå½“å‰ç›®å½•</p><p>æ„å»ºå®Œæˆä¹‹åï¼Œä½¿ç”¨ <code>docker images</code> å‘½ä»¤æŸ¥çœ‹æ‰€æœ‰é•œåƒï¼Œå¦‚æœå­˜åœ¨ REPOSITORY ä¸º nginx å’Œ TAG æ˜¯ v1 çš„ä¿¡æ¯ï¼Œå°±è¡¨ç¤ºæ„å»ºæˆåŠŸã€‚</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker images</span><br><span class="line">REPOSITORY                      TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">nginx                           v1                  8c92471de2cc        6 minutes ago       108.6 MB</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥ä½¿ç”¨ docker run å‘½ä»¤æ¥å¯åŠ¨å®¹å™¨</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker run  --name docker_nginx_v1   -d -p 80:80 nginx:v1</span><br></pre></td></tr></table></figure><p>è¿™æ¡å‘½ä»¤ä¼šç”¨ nginx é•œåƒå¯åŠ¨ä¸€ä¸ªå®¹å™¨ï¼Œå‘½åä¸º<code>docker_nginx_v1</code>ï¼Œå¹¶ä¸”æ˜ å°„äº† 80 ç«¯å£ï¼Œè¿™æ ·æˆ‘ä»¬å¯ä»¥ç”¨æµè§ˆå™¨å»è®¿é—®è¿™ä¸ª nginx æœåŠ¡å™¨ï¼š<code>http://192.168.0.54/</code>ï¼Œé¡µé¢è¿”å›ä¿¡æ¯ï¼š</p><p><img src="https://github.com/cayzlh/git-img-repository/raw/master/blog/2019/09/19.png" alt="img"></p><p>è¿™æ ·ä¸€ä¸ªç®€å•ä½¿ç”¨ Dockerfile æ„å»ºé•œåƒï¼Œè¿è¡Œå®¹å™¨çš„ç¤ºä¾‹å°±å®Œæˆäº†ï¼</p><h2 id="ä¿®æ”¹å®¹å™¨å†…å®¹"><a href="#ä¿®æ”¹å®¹å™¨å†…å®¹" class="headerlink" title="ä¿®æ”¹å®¹å™¨å†…å®¹"></a>ä¿®æ”¹å®¹å™¨å†…å®¹</h2><p>å®¹å™¨å¯åŠ¨åï¼Œéœ€è¦å¯¹å®¹å™¨å†…çš„æ–‡ä»¶è¿›è¡Œè¿›ä¸€æ­¥çš„å®Œå–„ï¼Œå¯ä»¥ä½¿ç”¨<code>docker exec -it xx bash</code>å‘½ä»¤å†æ¬¡è¿›è¡Œä¿®æ”¹ï¼Œä»¥ä¸Šé¢çš„ç¤ºä¾‹ä¸ºåŸºç¡€ï¼Œä¿®æ”¹ nginx å¯åŠ¨é¡µé¢å†…å®¹ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">docker exec -it docker_nginx_v1   bash</span><br><span class="line">root@3729b97e8226:&#x2F;# echo &#39;&lt;h1&gt;Hello, Docker neo!&lt;&#x2F;h1&gt;&#39; &gt; &#x2F;usr&#x2F;share&#x2F;nginx&#x2F;html&#x2F;index.html</span><br><span class="line">root@3729b97e8226:&#x2F;# exit</span><br><span class="line">exit</span><br></pre></td></tr></table></figure><p>ä»¥äº¤äº’å¼ç»ˆç«¯æ–¹å¼è¿›å…¥ docker_nginx_v1 å®¹å™¨ï¼Œå¹¶æ‰§è¡Œäº† bash å‘½ä»¤ï¼Œä¹Ÿå°±æ˜¯è·å¾—ä¸€ä¸ªå¯æ“ä½œçš„ Shellã€‚ç„¶åï¼Œæˆ‘ä»¬ç”¨<code>&lt;h1&gt;Hello, Docker neo!&lt;/h1&gt;</code>è¦†ç›–äº† <code>/usr/share/nginx/html/index.html</code> çš„å†…å®¹ã€‚</p><p>å†æ¬¡åˆ·æ–°æµè§ˆå™¨ï¼Œä¼šå‘ç°å†…å®¹è¢«æ”¹å˜ã€‚</p><p><img src="https://github.com/cayzlh/git-img-repository/raw/master/blog/2019/09/20.png" alt="img"></p><p>ä¿®æ”¹äº†å®¹å™¨çš„æ–‡ä»¶ï¼Œä¹Ÿå°±æ˜¯æ”¹åŠ¨äº†å®¹å™¨çš„å­˜å‚¨å±‚ï¼Œå¯ä»¥é€šè¿‡ docker diff å‘½ä»¤çœ‹åˆ°å…·ä½“çš„æ”¹åŠ¨ã€‚</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">docker diff docker_nginx_v1 </span><br><span class="line">... </span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®°æœ¬ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Docker </tag>
            
            <tag> Dockerfile </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Redisçš„ä½¿ç”¨åœºæ™¯</title>
      <link href="post/3351059309/"/>
      <url>post/3351059309/</url>
      
        <content type="html"><![CDATA[<blockquote><p>è½¬è‡ªï¼š<a href="https://juejin.im/entry/5c4e6153e51d452d7b70daf9?utm_source=gold_browser_extension">ä½¿ç”¨è¿‡Redisï¼Œæˆ‘ç«Ÿç„¶è¿˜ä¸çŸ¥é“Rdb</a></p></blockquote><p>æ•´ç†Redisçš„ä½¿ç”¨åœºæ™¯</p><h2 id="å­—ç¬¦ä¸²ç¼“å­˜"><a href="#å­—ç¬¦ä¸²ç¼“å­˜" class="headerlink" title="å­—ç¬¦ä¸²ç¼“å­˜"></a>å­—ç¬¦ä¸²ç¼“å­˜</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash">redis-&gt;<span class="built_in">set</span>();</span></span><br><span class="line"></span><br><span class="line"><span class="meta">$</span><span class="bash">redis-&gt;get();</span></span><br><span class="line"></span><br><span class="line"><span class="meta">$</span><span class="bash">redis-&gt;hset();</span></span><br><span class="line"></span><br><span class="line"><span class="meta">$</span><span class="bash">redis-&gt;hget();</span></span><br></pre></td></tr></table></figure><h2 id="é˜Ÿåˆ—"><a href="#é˜Ÿåˆ—" class="headerlink" title="é˜Ÿåˆ—"></a>é˜Ÿåˆ—</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash">redis-&gt;rpush();</span></span><br><span class="line"></span><br><span class="line"><span class="meta">$</span><span class="bash">redis-&gt;lpop();</span></span><br><span class="line"></span><br><span class="line"><span class="meta">$</span><span class="bash">redis-&gt;lrange();</span></span><br></pre></td></tr></table></figure><h2 id="å‘å¸ƒè®¢é˜…"><a href="#å‘å¸ƒè®¢é˜…" class="headerlink" title="å‘å¸ƒè®¢é˜…"></a>å‘å¸ƒè®¢é˜…</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash">redis-&gt;publish();</span></span><br><span class="line"></span><br><span class="line"><span class="meta">$</span><span class="bash">redis-&gt;subscribe();</span></span><br></pre></td></tr></table></figure><h2 id="è®¡æ•°å™¨"><a href="#è®¡æ•°å™¨" class="headerlink" title="è®¡æ•°å™¨"></a>è®¡æ•°å™¨</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash">redis-&gt;<span class="built_in">set</span>();</span></span><br><span class="line"></span><br><span class="line"><span class="meta">$</span><span class="bash">redis-&gt;incr();</span></span><br></pre></td></tr></table></figure><h2 id="æ’è¡Œæ¦œ"><a href="#æ’è¡Œæ¦œ" class="headerlink" title="æ’è¡Œæ¦œ"></a>æ’è¡Œæ¦œ</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash">redis-&gt;zadd();</span></span><br><span class="line"></span><br><span class="line"><span class="meta">$</span><span class="bash">redis-&gt;zrevrange();</span></span><br><span class="line"></span><br><span class="line"><span class="meta">$</span><span class="bash">redis-&gt;zrange();</span></span><br></pre></td></tr></table></figure><h2 id="é›†åˆé—´æ“ä½œ"><a href="#é›†åˆé—´æ“ä½œ" class="headerlink" title="é›†åˆé—´æ“ä½œ"></a>é›†åˆé—´æ“ä½œ</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash">redis-&gt;sadd();</span></span><br><span class="line"></span><br><span class="line"><span class="meta">$</span><span class="bash">redis-&gt;spop();</span></span><br><span class="line"></span><br><span class="line"><span class="meta">$</span><span class="bash">redis-&gt;sinter();</span></span><br><span class="line"></span><br><span class="line"><span class="meta">$</span><span class="bash">redis-&gt;sunion();</span></span><br><span class="line"></span><br><span class="line"><span class="meta">$</span><span class="bash">redis-&gt;sdiff();</span></span><br></pre></td></tr></table></figure><h2 id="æ‚²è§‚é”"><a href="#æ‚²è§‚é”" class="headerlink" title="æ‚²è§‚é”"></a>æ‚²è§‚é”</h2><p>è§£é‡Šï¼šæ‚²è§‚é”(Pessimistic Lock), é¡¾åæ€ä¹‰ï¼Œå°±æ˜¯å¾ˆæ‚²è§‚ã€‚</p><p>æ¯æ¬¡å»æ‹¿æ•°æ®çš„æ—¶å€™éƒ½è®¤ä¸ºåˆ«äººä¼šä¿®æ”¹ï¼Œæ‰€ä»¥æ¯æ¬¡åœ¨æ‹¿æ•°æ®çš„æ—¶å€™éƒ½ä¼šä¸Šé”ã€‚</p><p>åœºæ™¯ï¼šå¦‚æœé¡¹ç›®ä¸­ä½¿ç”¨äº†ç¼“å­˜ä¸”å¯¹ç¼“å­˜è®¾ç½®äº†è¶…æ—¶æ—¶é—´ã€‚</p><p>å½“å¹¶å‘é‡æ¯”è¾ƒå¤§çš„æ—¶å€™ï¼Œå¦‚æœæ²¡æœ‰é”æœºåˆ¶ï¼Œé‚£ä¹ˆç¼“å­˜è¿‡æœŸçš„ç¬é—´ï¼Œ</p><p>å¤§é‡å¹¶å‘è¯·æ±‚ä¼šç©¿é€ç¼“å­˜ç›´æ¥æŸ¥è¯¢æ•°æ®åº“ï¼Œé€ æˆé›ªå´©æ•ˆåº”ã€‚</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">/**</span><br><span class="line"></span><br><span class="line"> * è·å–é”</span><br><span class="line"></span><br><span class="line"> * @param  String  $key    é”æ ‡è¯†</span><br><span class="line"></span><br><span class="line"> * @param  Int     $expire é”è¿‡æœŸæ—¶é—´</span><br><span class="line"></span><br><span class="line"> * @return Boolean</span><br><span class="line"></span><br><span class="line"> */</span><br><span class="line"></span><br><span class="line">public function lock($key = &#x27;&#x27;, $expire = 5) &#123;</span><br><span class="line"></span><br><span class="line">    $is_lock = $this-&gt;_redis-&gt;setnx($key, time()+$expire);</span><br><span class="line"></span><br><span class="line">    //ä¸èƒ½è·å–é”</span><br><span class="line"></span><br><span class="line">    if(!$is_lock)&#123;</span><br><span class="line"></span><br><span class="line">        //åˆ¤æ–­é”æ˜¯å¦è¿‡æœŸ</span><br><span class="line"></span><br><span class="line">        $lock_time = $this-&gt;_redis-&gt;get($key);</span><br><span class="line"></span><br><span class="line">        //é”å·²è¿‡æœŸï¼Œåˆ é™¤é”ï¼Œé‡æ–°è·å–</span><br><span class="line"></span><br><span class="line">        if (time() &gt; $lock_time) &#123;</span><br><span class="line"></span><br><span class="line">            unlock($key);</span><br><span class="line"></span><br><span class="line">            $is_lock = $this-&gt;_redis-&gt;setnx($key, time() + $expire);</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    return $is_lock? true : false;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"></span><br><span class="line"> * é‡Šæ”¾é”</span><br><span class="line"></span><br><span class="line"> * @param  String  $key é”æ ‡è¯†</span><br><span class="line"></span><br><span class="line"> * @return Boolean</span><br><span class="line"></span><br><span class="line"> */</span><br><span class="line"></span><br><span class="line">public function unlock($key = &#x27;&#x27;)&#123;</span><br><span class="line"></span><br><span class="line">    return $this-&gt;_redis-&gt;del($key);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// å®šä¹‰é”æ ‡è¯†</span><br><span class="line"></span><br><span class="line"><span class="meta">$</span><span class="bash">key = <span class="string">&#x27;test_lock&#x27;</span>;</span></span><br><span class="line"></span><br><span class="line">// è·å–é”</span><br><span class="line"></span><br><span class="line"><span class="meta">$</span><span class="bash">is_lock = lock(<span class="variable">$key</span>, 10);</span></span><br><span class="line"></span><br><span class="line">if ($is_lock) &#123;</span><br><span class="line"></span><br><span class="line">    echo &#x27;get lock success&lt;br&gt;&#x27;;</span><br><span class="line"></span><br><span class="line">    echo &#x27;do sth..&lt;br&gt;&#x27;;</span><br><span class="line"></span><br><span class="line">    sleep(5);</span><br><span class="line"></span><br><span class="line">    echo &#x27;success&lt;br&gt;&#x27;;</span><br><span class="line"></span><br><span class="line">    unlock($key);</span><br><span class="line"></span><br><span class="line">&#125; else &#123; //è·å–é”å¤±è´¥</span><br><span class="line"></span><br><span class="line">    echo &#x27;request too frequently&lt;br&gt;&#x27;;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ä¹è§‚é”"><a href="#ä¹è§‚é”" class="headerlink" title="ä¹è§‚é”"></a>ä¹è§‚é”</h2><p>è§£é‡Šï¼šä¹è§‚é”(Optimistic Lock), é¡¾åæ€ä¹‰ï¼Œå°±æ˜¯å¾ˆä¹è§‚ã€‚</p><p>æ¯æ¬¡å»æ‹¿æ•°æ®çš„æ—¶å€™éƒ½è®¤ä¸ºåˆ«äººä¸ä¼šä¿®æ”¹ï¼Œæ‰€ä»¥ä¸ä¼šä¸Šé”ã€‚</p><p>watchå‘½ä»¤ä¼šç›‘è§†ç»™å®šçš„keyï¼Œå½“execæ—¶å€™å¦‚æœç›‘è§†çš„keyä»è°ƒç”¨watchåå‘ç”Ÿè¿‡å˜åŒ–ï¼Œåˆ™æ•´ä¸ªäº‹åŠ¡ä¼šå¤±è´¥ã€‚</p><p>ä¹Ÿå¯ä»¥è°ƒç”¨watchå¤šæ¬¡ç›‘è§†å¤šä¸ªkeyã€‚è¿™æ ·å°±å¯ä»¥å¯¹æŒ‡å®šçš„keyåŠ ä¹è§‚é”äº†ã€‚</p><p>æ³¨æ„watchçš„keyæ˜¯å¯¹æ•´ä¸ªè¿æ¥æœ‰æ•ˆçš„ï¼Œäº‹åŠ¡ä¹Ÿä¸€æ ·ã€‚</p><p>å¦‚æœè¿æ¥æ–­å¼€ï¼Œç›‘è§†å’Œäº‹åŠ¡éƒ½ä¼šè¢«è‡ªåŠ¨æ¸…é™¤ã€‚</p><p>å½“ç„¶äº†execï¼Œdiscardï¼Œunwatchå‘½ä»¤éƒ½ä¼šæ¸…é™¤è¿æ¥ä¸­çš„æ‰€æœ‰ç›‘è§†ã€‚</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash">strKey = <span class="string">&#x27;test_age&#x27;</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">$</span><span class="bash">redis-&gt;<span class="built_in">set</span>(<span class="variable">$strKey</span>,10);</span></span><br><span class="line"></span><br><span class="line"><span class="meta">$</span><span class="bash">age = <span class="variable">$redis</span>-&gt;get(<span class="variable">$strKey</span>);</span></span><br><span class="line"></span><br><span class="line">echo &quot;---- Current Age:&#123;$age&#125; ---- &lt;br/&gt;&lt;br/&gt;&quot;;</span><br><span class="line"></span><br><span class="line"><span class="meta">$</span><span class="bash">redis-&gt;watch(<span class="variable">$strKey</span>);</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> å¼€å¯äº‹åŠ¡</span></span><br><span class="line"></span><br><span class="line"><span class="meta">$</span><span class="bash">redis-&gt;multi();</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> åœ¨è¿™ä¸ªæ—¶å€™æ–°å¼€äº†ä¸€ä¸ªæ–°ä¼šè¯æ‰§è¡Œ</span></span><br><span class="line"></span><br><span class="line"><span class="meta">$</span><span class="bash">redis-&gt;<span class="built_in">set</span>(<span class="variable">$strKey</span>,30);  <span class="comment">#æ–°ä¼šè¯</span></span></span><br><span class="line"></span><br><span class="line">echo &quot;---- Current Age:&#123;$age&#125; ---- &lt;br/&gt;&lt;br/&gt;&quot;; # 30</span><br><span class="line"></span><br><span class="line"><span class="meta">$</span><span class="bash">redis-&gt;<span class="built_in">set</span>(<span class="variable">$strKey</span>,20);</span></span><br><span class="line"></span><br><span class="line"><span class="meta">$</span><span class="bash">redis-&gt;<span class="built_in">exec</span>();</span></span><br><span class="line"></span><br><span class="line"><span class="meta">$</span><span class="bash">age = <span class="variable">$redis</span>-&gt;get(<span class="variable">$strKey</span>);</span></span><br><span class="line"></span><br><span class="line">echo &quot;---- Current Age:&#123;$age&#125; ---- &lt;br/&gt;&lt;br/&gt;&quot;; # 30</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> å½“<span class="built_in">exec</span>æ—¶å€™å¦‚æœç›‘è§†çš„keyä»è°ƒç”¨watchåå‘ç”Ÿè¿‡å˜åŒ–ï¼Œåˆ™æ•´ä¸ªäº‹åŠ¡ä¼šå¤±è´¥</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®°æœ¬ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Redis </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JDK8ç‰¹æ€§ä¸€è§ˆ</title>
      <link href="post/1abc3648/"/>
      <url>post/1abc3648/</url>
      
        <content type="html"><![CDATA[<blockquote><p>è½¬è‡ªï¼š<a href="https://github.com/winterbe/java8-tutorial">https://github.com/winterbe/java8-tutorial</a></p><p>è½¬è‡ªï¼š<a href="https://juejin.im/post/5c3d7c8a51882525dd591ac7?utm_source=gold_browser_extension#%E5%87%BD%E6%95%B0%E5%BC%8F%E6%8E%A5%E5%8F%A3-Functional-Interface">Java8 æ–°ç‰¹æ€§æŒ‡å¯¼æ‰‹å†Œ</a></p></blockquote><h2 id="æ¥å£å†…å…è®¸æ·»åŠ é»˜è®¤å®ç°çš„æ–¹æ³•"><a href="#æ¥å£å†…å…è®¸æ·»åŠ é»˜è®¤å®ç°çš„æ–¹æ³•" class="headerlink" title="æ¥å£å†…å…è®¸æ·»åŠ é»˜è®¤å®ç°çš„æ–¹æ³•"></a>æ¥å£å†…å…è®¸æ·»åŠ é»˜è®¤å®ç°çš„æ–¹æ³•</h2><p>Java 8 å…è®¸æˆ‘ä»¬é€šè¿‡ <code>default</code> å…³é”®å­—å¯¹æ¥å£ä¸­å®šä¹‰çš„æŠ½è±¡æ–¹æ³•æä¾›ä¸€ä¸ªé»˜è®¤çš„å®ç°ã€‚</p><p>è¯·çœ‹ä¸‹é¢ç¤ºä¾‹ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å®šä¹‰ä¸€ä¸ªå…¬å¼æ¥å£</span></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Formula</span> </span>&#123;</span><br><span class="line">    <span class="comment">// è®¡ç®—</span></span><br><span class="line">    <span class="function"><span class="keyword">double</span> <span class="title">calculate</span><span class="params">(<span class="keyword">int</span> a)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ±‚å¹³æ–¹æ ¹</span></span><br><span class="line">    <span class="function"><span class="keyword">default</span> <span class="keyword">double</span> <span class="title">sqrt</span><span class="params">(<span class="keyword">int</span> a)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Math.sqrt(a);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ä¸Šé¢è¿™ä¸ªæ¥å£ä¸­ï¼Œæˆ‘ä»¬é™¤äº†å®šä¹‰äº†ä¸€ä¸ªæŠ½è±¡æ–¹æ³• <code>calculate</code>ï¼Œè¿˜å®šä¹‰äº†ä¸€ä¸ªå¸¦æœ‰é»˜è®¤å®ç°çš„æ–¹æ³• <code>sqrt</code>ã€‚ æˆ‘ä»¬åœ¨å®ç°è¿™ä¸ªæ¥å£æ—¶ï¼Œå¯ä»¥åªéœ€è¦å®ç° <code>calculate</code> æ–¹æ³•ï¼Œé»˜è®¤æ–¹æ³• <code>sqrt</code> å¯ä»¥ç›´æ¥è°ƒç”¨å³å¯ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬å¯ä»¥ä¸å¿…å¼ºåˆ¶å®ç° <code>sqrt</code> æ–¹æ³•ã€‚</p><blockquote><p>è¡¥å……ï¼šé€šè¿‡ <code>default</code> å…³é”®å­—è¿™ä¸ªæ–°ç‰¹æ€§ï¼Œå¯ä»¥éå¸¸æ–¹ä¾¿åœ°å¯¹ä¹‹å‰çš„æ¥å£åšæ‹“å±•ï¼Œè€Œæ­¤æ¥å£çš„å®ç°ç±»ä¸å¿…åšä»»ä½•æ”¹åŠ¨ã€‚</p></blockquote><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Formula formula = <span class="keyword">new</span> Formula() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">calculate</span><span class="params">(<span class="keyword">int</span> a)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> sqrt(a * <span class="number">100</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">formula.calculate(<span class="number">100</span>);     <span class="comment">// 100.0</span></span><br><span class="line">formula.sqrt(<span class="number">16</span>);           <span class="comment">// 4.0</span></span><br></pre></td></tr></table></figure><p>ä¸Šé¢é€šè¿‡åŒ¿åå¯¹è±¡å®ç°äº† <code>Formula</code> æ¥å£ã€‚ä½†æ˜¯å³ä½¿æ˜¯è¿™æ ·ï¼Œæˆ‘ä»¬ä¸ºäº†å®Œæˆä¸€ä¸ª <code>sqrt(a * 100)</code>ç®€å•è®¡ç®—ï¼Œå°±å†™äº† 6 è¡Œä»£ç ï¼Œå¾ˆæ˜¯å†—ä½™ã€‚</p><h2 id="Lamdbaè¡¨è¾¾å¼"><a href="#Lamdbaè¡¨è¾¾å¼" class="headerlink" title="Lamdbaè¡¨è¾¾å¼"></a>Lamdbaè¡¨è¾¾å¼</h2><p>åœ¨å­¦ä¹  <code>Lambda</code> è¡¨è¾¾å¼ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹ä¸€æ®µè€ç‰ˆæœ¬çš„ç¤ºä¾‹ä»£ç ï¼Œå…¶å¯¹ä¸€ä¸ªå«æœ‰å­—ç¬¦ä¸²çš„é›†åˆè¿›è¡Œæ’åºï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">List&lt;String&gt; names = Arrays.asList(<span class="string">&quot;peter&quot;</span>, <span class="string">&quot;anna&quot;</span>, <span class="string">&quot;mike&quot;</span>, <span class="string">&quot;xenia&quot;</span>);</span><br><span class="line"></span><br><span class="line">Collections.sort(names, <span class="keyword">new</span> Comparator&lt;String&gt;() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compare</span><span class="params">(String a, String b)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> b.compareTo(a);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p><code>Collections</code> å·¥å…·ç±»æä¾›äº†é™æ€æ–¹æ³• <code>sort</code> æ–¹æ³•ï¼Œå…¥å‚æ˜¯ä¸€ä¸ª <code>List</code> é›†åˆï¼Œå’Œä¸€ä¸ª <code>Comparator</code> æ¯”è¾ƒå™¨ï¼Œä»¥ä¾¿å¯¹ç»™å®šçš„ <code>List</code> é›†åˆè¿›è¡Œ æ’åºã€‚ä¸Šé¢çš„ç¤ºä¾‹ä»£ç åˆ›å»ºäº†ä¸€ä¸ªåŒ¿åå†…éƒ¨ç±»ä½œä¸ºå…¥å‚ï¼Œè¿™ç§ç±»ä¼¼çš„æ“ä½œåœ¨æˆ‘ä»¬æ—¥å¸¸çš„å·¥ä½œä¸­éšå¤„å¯è§ã€‚</p><p>Java 8 ä¸­ä¸å†æ¨èè¿™ç§å†™æ³•ï¼Œè€Œæ˜¯æ¨èä½¿ç”¨ Lambda è¡¨è¾¾ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Collections.sort(names, (String a, String b) -&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> b.compareTo(a);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>æ­£å¦‚ä½ çœ‹åˆ°çš„ï¼Œä¸Šé¢è¿™æ®µä»£ç å˜å¾—ç®€çŸ­å¾ˆå¤šè€Œä¸”æ˜“äºé˜…è¯»ã€‚ä½†æ˜¯æˆ‘ä»¬è¿˜å¯ä»¥å†ç²¾ç‚¼ä¸€ç‚¹ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Collections.sort(names, (String a, String b) -&gt; b.compareTo(a));</span><br></pre></td></tr></table></figure><p><code>List</code> é›†åˆç°åœ¨å·²ç»æ·»åŠ äº† <code>sort</code> æ–¹æ³•ã€‚è€Œä¸” Java ç¼–è¯‘å™¨èƒ½å¤Ÿæ ¹æ®<strong>ç±»å‹æ¨æ–­æœºåˆ¶</strong>åˆ¤æ–­å‡ºå‚æ•°ç±»å‹ï¼Œè¿™æ ·ï¼Œè¿å…¥å‚çš„ç±»å‹éƒ½å¯ä»¥çœç•¥äº†ï¼</p><h2 id="å‡½æ•°å¼æ¥å£-Functional-Interface"><a href="#å‡½æ•°å¼æ¥å£-Functional-Interface" class="headerlink" title="å‡½æ•°å¼æ¥å£ Functional Interface"></a>å‡½æ•°å¼æ¥å£ Functional Interface</h2><p>æŠ›å‡ºä¸€ä¸ªç–‘é—®ï¼šåœ¨æˆ‘ä»¬ä¹¦å†™ä¸€æ®µ Lambda è¡¨è¾¾å¼åï¼ˆæ¯”å¦‚ä¸Šä¸€ç« èŠ‚ä¸­åŒ¿åå†…éƒ¨ç±»çš„ Lambda è¡¨è¾¾å¼ç¼©å†™å½¢å¼ï¼‰ï¼ŒJava ç¼–è¯‘å™¨æ˜¯å¦‚ä½•è¿›è¡Œç±»å‹æ¨æ–­çš„ï¼Œå®ƒåˆæ˜¯æ€ä¹ˆçŸ¥é“é‡å†™çš„å“ªä¸ªæ–¹æ³•çš„ï¼Ÿ</p><p>éœ€è¦è¯´æ˜çš„æ˜¯ï¼Œä¸æ˜¯æ¯ä¸ªæ¥å£éƒ½å¯ä»¥ç¼©å†™æˆ Lambda è¡¨è¾¾å¼ã€‚åªæœ‰é‚£äº›å‡½æ•°å¼æ¥å£ï¼ˆFunctional Interfaceï¼‰æ‰èƒ½ç¼©å†™æˆ Lambda è¡¨ç¤ºå¼ã€‚</p><p>é‚£ä¹ˆä»€ä¹ˆæ˜¯å‡½æ•°å¼æ¥å£ï¼ˆFunctional Interfaceï¼‰å‘¢ï¼Ÿ</p><p>æ‰€è°“å‡½æ•°å¼æ¥å£ï¼ˆFunctional Interfaceï¼‰å°±æ˜¯åªåŒ…å«ä¸€ä¸ªæŠ½è±¡æ–¹æ³•çš„å£°æ˜ã€‚é’ˆå¯¹è¯¥æ¥å£ç±»å‹çš„æ‰€æœ‰ Lambda è¡¨è¾¾å¼éƒ½ä¼šä¸è¿™ä¸ªæŠ½è±¡æ–¹æ³•åŒ¹é…ã€‚</p><blockquote><p>æ³¨æ„ï¼šä½ å¯èƒ½ä¼šæœ‰ç–‘é—®ï¼ŒJava 8 ä¸­ä¸æ˜¯å…è®¸é€šè¿‡ defualt å…³é”®å­—æ¥ä¸ºæ¥å£æ·»åŠ é»˜è®¤æ–¹æ³•å—ï¼Ÿé‚£å®ƒç®—ä¸ç®—æŠ½è±¡æ–¹æ³•å‘¢ï¼Ÿç­”æ¡ˆæ˜¯ï¼šä¸ç®—ã€‚å› æ­¤ï¼Œä½ å¯ä»¥æ¯«æ— é¡¾å¿Œçš„æ·»åŠ é»˜è®¤æ–¹æ³•ï¼Œå®ƒå¹¶ä¸è¿åå‡½æ•°å¼æ¥å£ï¼ˆFunctional Interfaceï¼‰çš„å®šä¹‰ã€‚</p></blockquote><p>æ€»ç»“ä¸€ä¸‹ï¼šåªè¦æ¥å£ä¸­ä»…ä»…åŒ…å«ä¸€ä¸ªæŠ½è±¡æ–¹æ³•ï¼Œæˆ‘ä»¬å°±å¯ä»¥å°†å…¶æ”¹å†™ä¸º Lambda è¡¨è¾¾å¼ã€‚ä¸ºäº†ä¿è¯ä¸€ä¸ªæ¥å£æ˜ç¡®çš„è¢«å®šä¹‰ä¸ºä¸€ä¸ªå‡½æ•°å¼æ¥å£ï¼ˆFunctional Interfaceï¼‰ï¼Œæˆ‘ä»¬éœ€è¦ä¸ºè¯¥æ¥å£æ·»åŠ æ³¨è§£ï¼š<code>@FunctionalInterface</code>ã€‚è¿™æ ·ï¼Œä¸€æ—¦ä½ æ·»åŠ äº†ç¬¬äºŒä¸ªæŠ½è±¡æ–¹æ³•ï¼Œç¼–è¯‘å™¨ä¼šç«‹åˆ»æŠ›å‡ºé”™è¯¯æç¤ºã€‚</p><p>ç¤ºä¾‹ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@FunctionalInterface</span></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Converter</span>&lt;<span class="title">F</span>, <span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    <span class="function">T <span class="title">convert</span><span class="params">(F from)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¤ºä¾‹ä»£ç 2ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Converter&lt;String, Integer&gt; converter = (from) -&gt; Integer.valueOf(from);</span><br><span class="line">Integer converted = converter.convert(<span class="string">&quot;123&quot;</span>);</span><br><span class="line">System.out.println(converted);    <span class="comment">// 123</span></span><br></pre></td></tr></table></figure><blockquote><p>æ³¨æ„ï¼šä¸Šé¢çš„ç¤ºä¾‹ä»£ç ï¼Œå³ä½¿å»æ‰ <code>@FunctionalInterface</code> ä¹Ÿæ˜¯å¥½ä½¿çš„ï¼Œå®ƒä»…ä»…æ˜¯ä¸€ç§çº¦æŸè€Œå·²ã€‚</p></blockquote><h2 id="ä¾¿æ·çš„å¼•ç”¨ç±»çš„æ„é€ å™¨åŠæ–¹æ³•"><a href="#ä¾¿æ·çš„å¼•ç”¨ç±»çš„æ„é€ å™¨åŠæ–¹æ³•" class="headerlink" title="ä¾¿æ·çš„å¼•ç”¨ç±»çš„æ„é€ å™¨åŠæ–¹æ³•"></a>ä¾¿æ·çš„å¼•ç”¨ç±»çš„æ„é€ å™¨åŠæ–¹æ³•</h2><p>å°ä¼™ä¼´ä»¬ï¼Œè¿˜è®°å¾—ä¸Šä¸€ä¸ªç« èŠ‚è¿™æ®µç¤ºä¾‹ä»£ç ä¹ˆï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@FunctionalInterface</span></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Converter</span>&lt;<span class="title">F</span>, <span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    <span class="function">T <span class="title">convert</span><span class="params">(F from)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Converter&lt;String, Integer&gt; converter = (from) -&gt; Integer.valueOf(from);</span><br><span class="line">Integer converted = converter.convert(<span class="string">&quot;123&quot;</span>);</span><br><span class="line">System.out.println(converted);    <span class="comment">// 123</span></span><br></pre></td></tr></table></figure><p>ä¸Šé¢è¿™æ®µä»£ç ï¼Œé€šè¿‡ Java 8 çš„æ–°ç‰¹æ€§ï¼Œè¿›ä¸€æ­¥ç®€åŒ–ä¸Šé¢çš„ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Converter&lt;String, Integer&gt; converter = Integer::valueOf;</span><br><span class="line">Integer converted = converter.convert(<span class="string">&quot;123&quot;</span>);</span><br><span class="line">System.out.println(converted);   <span class="comment">// 123</span></span><br></pre></td></tr></table></figure><p>Java 8 ä¸­å…è®¸ä½ é€šè¿‡ <code>::</code> å…³é”®å­—æ¥å¼•ç”¨ç±»çš„æ–¹æ³•æˆ–æ„é€ å™¨ã€‚ä¸Šé¢çš„ä»£ç ç®€å•çš„ç¤ºä¾‹äº†å¦‚ä½•å¼•ç”¨é™æ€æ–¹æ³•ï¼Œå½“ç„¶ï¼Œé™¤äº†é™æ€æ–¹æ³•ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥å¼•ç”¨æ™®é€šæ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Something</span> </span>&#123;</span><br><span class="line">    <span class="function">String <span class="title">startsWith</span><span class="params">(String s)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> String.valueOf(s.charAt(<span class="number">0</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Something something = <span class="keyword">new</span> Something();</span><br><span class="line">Converter&lt;String, String&gt; converter = something::startsWith;</span><br><span class="line">String converted = converter.convert(<span class="string">&quot;Java&quot;</span>);</span><br><span class="line">System.out.println(converted);    <span class="comment">// &quot;J&quot;</span></span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å†æ¥çœ‹çœ‹å¦‚ä½•é€šè¿‡ <code>::</code> å…³é”®å­—æ¥å¼•ç”¨ç±»çš„æ„é€ å™¨ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬å…ˆæ¥å®šä¹‰ä¸€ä¸ªç¤ºä¾‹ç±»ï¼Œåœ¨ç±»ä¸­å£°æ˜ä¸¤ä¸ªæ„é€ å™¨ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">    String firstName;</span><br><span class="line">    String lastName;</span><br><span class="line"></span><br><span class="line">    Person() &#123;&#125;</span><br><span class="line"></span><br><span class="line">    Person(String firstName, String lastName) &#123;</span><br><span class="line">        <span class="keyword">this</span>.firstName = firstName;</span><br><span class="line">        <span class="keyword">this</span>.lastName = lastName;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åï¼Œæˆ‘ä»¬å†å®šä¹‰ä¸€ä¸ªå·¥å‚æ¥å£ï¼Œç”¨æ¥ç”Ÿæˆ <code>Person</code> ç±»ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Person å·¥å‚</span></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">PersonFactory</span>&lt;<span class="title">P</span> <span class="keyword">extends</span> <span class="title">Person</span>&gt; </span>&#123;</span><br><span class="line">    <span class="function">P <span class="title">create</span><span class="params">(String firstName, String lastName)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡ <code>::</code> å…³é”®å­—æ¥å¼•ç”¨ <code>Person</code> ç±»çš„æ„é€ å™¨ï¼Œæ¥ä»£æ›¿æ‰‹åŠ¨å»å®ç°è¿™ä¸ªå·¥å‚æ¥å£ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ç›´æ¥å¼•ç”¨ Person æ„é€ å™¨</span></span><br><span class="line">PersonFactory&lt;Person&gt; personFactory = Person::<span class="keyword">new</span>;</span><br><span class="line">Person person = personFactory.create(<span class="string">&quot;Peter&quot;</span>, <span class="string">&quot;Parker&quot;</span>);</span><br></pre></td></tr></table></figure><p><code>Person::new</code> è¿™æ®µä»£ç ï¼Œèƒ½å¤Ÿç›´æ¥å¼•ç”¨ <code>Person</code> ç±»çš„æ„é€ å™¨ã€‚ç„¶å Java ç¼–è¯‘å™¨èƒ½å¤Ÿæ ¹æ®ä¸Šä¸‹æ–‡é€‰ä¸­æ­£ç¡®çš„æ„é€ å™¨å»å®ç° <code>PersonFactory.create</code> æ–¹æ³•ã€‚</p><h2 id="Lamdbaè®¿é—®å¤–éƒ¨å˜é‡åŠæ¥å£é»˜è®¤æ–¹æ³•"><a href="#Lamdbaè®¿é—®å¤–éƒ¨å˜é‡åŠæ¥å£é»˜è®¤æ–¹æ³•" class="headerlink" title="Lamdbaè®¿é—®å¤–éƒ¨å˜é‡åŠæ¥å£é»˜è®¤æ–¹æ³•"></a>Lamdbaè®¿é—®å¤–éƒ¨å˜é‡åŠæ¥å£é»˜è®¤æ–¹æ³•</h2><p>åœ¨æœ¬ç« èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†ä¼šè®¨è®ºå¦‚ä½•åœ¨ lambda è¡¨è¾¾å¼ä¸­è®¿é—®å¤–éƒ¨å˜é‡ï¼ˆåŒ…æ‹¬ï¼šå±€éƒ¨å˜é‡ï¼Œæˆå‘˜å˜é‡ï¼Œé™æ€å˜é‡ï¼Œæ¥å£çš„é»˜è®¤æ–¹æ³•.ï¼‰ï¼Œå®ƒä¸åŒ¿åå†…éƒ¨ç±»è®¿é—®å¤–éƒ¨å˜é‡å¾ˆç›¸ä¼¼ã€‚</p><h3 id="è®¿é—®å±€éƒ¨å˜é‡"><a href="#è®¿é—®å±€éƒ¨å˜é‡" class="headerlink" title="è®¿é—®å±€éƒ¨å˜é‡"></a>è®¿é—®å±€éƒ¨å˜é‡</h3><p>åœ¨ Lambda è¡¨è¾¾å¼ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥è®¿é—®å¤–éƒ¨çš„ <code>final</code> ç±»å‹å˜é‡ï¼Œå¦‚ä¸‹é¢çš„ç¤ºä¾‹ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// è½¬æ¢å™¨</span></span><br><span class="line"><span class="meta">@FunctionalInterface</span></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Converter</span>&lt;<span class="title">F</span>, <span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    <span class="function">T <span class="title">convert</span><span class="params">(F from)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line">å¤åˆ¶ä»£ç </span><br><span class="line"><span class="keyword">final</span> <span class="keyword">int</span> num = <span class="number">1</span>;</span><br><span class="line">Converter&lt;Integer, String&gt; stringConverter =</span><br><span class="line">        (from) -&gt; String.valueOf(from + num);</span><br><span class="line"></span><br><span class="line">stringConverter.convert(<span class="number">2</span>);     <span class="comment">// 3</span></span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure><p>ä¸åŒ¿åå†…éƒ¨ç±»ä¸åŒçš„æ˜¯ï¼Œæˆ‘ä»¬ä¸å¿…æ˜¾å¼å£°æ˜ <code>num</code> å˜é‡ä¸º <code>final</code> ç±»å‹ï¼Œä¸‹é¢è¿™æ®µä»£ç åŒæ ·æœ‰æ•ˆï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">int</span> num = <span class="number">1</span>;</span><br><span class="line">Converter&lt;Integer, String&gt; stringConverter =</span><br><span class="line">        (from) -&gt; String.valueOf(from + num);</span><br><span class="line"></span><br><span class="line">stringConverter.convert(<span class="number">2</span>);     <span class="comment">// 3</span></span><br></pre></td></tr></table></figure><p>ä½†æ˜¯ <code>num</code> å˜é‡å¿…é¡»ä¸ºéšå¼çš„ <code>final</code> ç±»å‹ï¼Œä½•ä¸ºéšå¼çš„ <code>final</code> å‘¢ï¼Ÿå°±æ˜¯è¯´åˆ°ç¼–è¯‘æœŸä¸ºæ­¢ï¼Œ<code>num</code> å¯¹è±¡æ˜¯ä¸èƒ½è¢«æ”¹å˜çš„ï¼Œå¦‚ä¸‹é¢è¿™æ®µä»£ç ï¼Œå°±ä¸èƒ½è¢«ç¼–è¯‘é€šè¿‡ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">int</span> num = <span class="number">1</span>;</span><br><span class="line">Converter&lt;Integer, String&gt; stringConverter =</span><br><span class="line">        (from) -&gt; String.valueOf(from + num);</span><br><span class="line">num = <span class="number">3</span>;</span><br></pre></td></tr></table></figure><p>åœ¨ lambda è¡¨è¾¾å¼å†…éƒ¨æ”¹å˜ <code>num</code> å€¼åŒæ ·ç¼–è¯‘ä¸é€šè¿‡ï¼Œéœ€è¦æ³¨æ„, æ¯”å¦‚ä¸‹é¢çš„ç¤ºä¾‹ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">int</span> num = <span class="number">1</span>;</span><br><span class="line">Converter&lt;Integer, String&gt; converter = (from) -&gt; &#123;</span><br><span class="line">String value = String.valueOf(from + num);</span><br><span class="line">num = <span class="number">3</span>;</span><br><span class="line"><span class="keyword">return</span> value;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="è®¿é—®æˆå‘˜å˜é‡å’Œé™æ€å˜é‡"><a href="#è®¿é—®æˆå‘˜å˜é‡å’Œé™æ€å˜é‡" class="headerlink" title="è®¿é—®æˆå‘˜å˜é‡å’Œé™æ€å˜é‡"></a>è®¿é—®æˆå‘˜å˜é‡å’Œé™æ€å˜é‡</h3><p>ä¸Šä¸€ç« èŠ‚ä¸­ï¼Œäº†è§£äº†å¦‚ä½•åœ¨ Lambda è¡¨è¾¾å¼ä¸­è®¿é—®å±€éƒ¨å˜é‡ã€‚ä¸å±€éƒ¨å˜é‡ç›¸æ¯”ï¼Œåœ¨ Lambda è¡¨è¾¾å¼ä¸­å¯¹æˆå‘˜å˜é‡å’Œé™æ€å˜é‡æ‹¥æœ‰è¯»å†™æƒé™ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@FunctionalInterface</span></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Converter</span>&lt;<span class="title">F</span>, <span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    <span class="function">T <span class="title">convert</span><span class="params">(F from)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line">    </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Lambda4</span> </span>&#123;</span><br><span class="line">    <span class="comment">// é™æ€å˜é‡</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">int</span> outerStaticNum;</span><br><span class="line">    <span class="comment">// æˆå‘˜å˜é‡</span></span><br><span class="line">    <span class="keyword">int</span> outerNum;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">testScopes</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Converter&lt;Integer, String&gt; stringConverter1 = (from) -&gt; &#123;</span><br><span class="line">            <span class="comment">// å¯¹æˆå‘˜å˜é‡èµ‹å€¼</span></span><br><span class="line">            outerNum = <span class="number">23</span>;</span><br><span class="line">            <span class="keyword">return</span> String.valueOf(from);</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        Converter&lt;Integer, String&gt; stringConverter2 = (from) -&gt; &#123;</span><br><span class="line">            <span class="comment">// å¯¹é™æ€å˜é‡èµ‹å€¼</span></span><br><span class="line">            outerStaticNum = <span class="number">72</span>;</span><br><span class="line">            <span class="keyword">return</span> String.valueOf(from);</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="è®¿é—®æ¥å£çš„é»˜è®¤æ–¹æ³•"><a href="#è®¿é—®æ¥å£çš„é»˜è®¤æ–¹æ³•" class="headerlink" title="è®¿é—®æ¥å£çš„é»˜è®¤æ–¹æ³•"></a>è®¿é—®æ¥å£çš„é»˜è®¤æ–¹æ³•</h3><p>è¿˜è®°å¾—ç¬¬ä¸€ç« èŠ‚ä¸­å®šä¹‰çš„é‚£ä¸ª <code>Formula</code> (å…¬å¼) æ¥å£å—ï¼Ÿ</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@FunctionalInterface</span></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Formula</span> </span>&#123;</span><br><span class="line"><span class="comment">// è®¡ç®—</span></span><br><span class="line"><span class="function"><span class="keyword">double</span> <span class="title">calculate</span><span class="params">(<span class="keyword">int</span> a)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ±‚å¹³æ–¹æ ¹</span></span><br><span class="line"><span class="function"><span class="keyword">default</span> <span class="keyword">double</span> <span class="title">sqrt</span><span class="params">(<span class="keyword">int</span> a)</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> Math.sqrt(a);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å½“æ—¶ï¼Œæˆ‘ä»¬åœ¨æ¥å£ä¸­å®šä¹‰äº†ä¸€ä¸ªå¸¦æœ‰é»˜è®¤å®ç°çš„ <code>sqrt</code> æ±‚å¹³æ–¹æ ¹æ–¹æ³•ï¼Œåœ¨åŒ¿åå†…éƒ¨ç±»ä¸­æˆ‘ä»¬å¯ä»¥å¾ˆæ–¹ä¾¿çš„è®¿é—®æ­¤æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Formula formula = <span class="keyword">new</span> Formula() &#123;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">calculate</span><span class="params">(<span class="keyword">int</span> a)</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> sqrt(a * <span class="number">100</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯åœ¨ lambda è¡¨è¾¾å¼ä¸­å¯ä¸è¡Œï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Formula formula = (a) -&gt; sqrt(a * <span class="number">100</span>);</span><br></pre></td></tr></table></figure><p>å¸¦æœ‰é»˜è®¤å®ç°çš„æ¥å£æ–¹æ³•ï¼Œæ˜¯<strong>ä¸èƒ½</strong>åœ¨ lambda è¡¨è¾¾å¼ä¸­è®¿é—®çš„ï¼Œä¸Šé¢è¿™æ®µä»£ç å°†æ— æ³•è¢«ç¼–è¯‘é€šè¿‡ã€‚</p><h2 id="å†…ç½®çš„å‡½æ•°å¼æ¥å£"><a href="#å†…ç½®çš„å‡½æ•°å¼æ¥å£" class="headerlink" title="å†…ç½®çš„å‡½æ•°å¼æ¥å£"></a>å†…ç½®çš„å‡½æ•°å¼æ¥å£</h2><p>JDK 1.8 API åŒ…å«äº†å¾ˆå¤šå†…ç½®çš„å‡½æ•°å¼æ¥å£ã€‚å…¶ä¸­å°±åŒ…æ‹¬æˆ‘ä»¬åœ¨è€ç‰ˆæœ¬ä¸­ç»å¸¸è§åˆ°çš„ Comparator å’Œ Runnableï¼ŒJava 8 ä¸ºä»–ä»¬éƒ½æ·»åŠ äº† @FunctionalInterface æ³¨è§£ï¼Œä»¥ç”¨æ¥æ”¯æŒ Lambda è¡¨è¾¾å¼ã€‚</p><p>å€¼å¾—ä¸€æçš„æ˜¯ï¼Œé™¤äº† Comparator å’Œ Runnable å¤–ï¼Œè¿˜æœ‰ä¸€äº›æ–°çš„å‡½æ•°å¼æ¥å£ï¼Œå®ƒä»¬å¾ˆå¤šéƒ½å€Ÿé‰´äºçŸ¥åçš„ <a href="https://link.juejin.im/?target=https://github.com/google/guava">Google Guava</a> åº“ã€‚</p><h3 id="Predicateæ–­è¨€"><a href="#Predicateæ–­è¨€" class="headerlink" title="Predicateæ–­è¨€"></a>Predicateæ–­è¨€</h3><p><code>Predicate</code> æ˜¯ä¸€ä¸ªå¯ä»¥æŒ‡å®šå…¥å‚ç±»å‹ï¼Œå¹¶è¿”å› boolean å€¼çš„å‡½æ•°å¼æ¥å£ã€‚å®ƒå†…éƒ¨æä¾›äº†ä¸€äº›å¸¦æœ‰é»˜è®¤å®ç°çš„æ–¹æ³•ï¼Œå¯ä»¥ è¢«ç”¨æ¥ç»„åˆä¸€ä¸ªå¤æ‚çš„é€»è¾‘åˆ¤æ–­ï¼ˆ<code>and</code>, <code>or</code>, <code>negate</code>ï¼‰ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Predicate&lt;String&gt; predicate = (s) -&gt; s.length() &gt; <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">predicate.test(<span class="string">&quot;foo&quot;</span>);              <span class="comment">// true</span></span><br><span class="line">predicate.negate().test(<span class="string">&quot;foo&quot;</span>);     <span class="comment">// false</span></span><br><span class="line"></span><br><span class="line">Predicate&lt;Boolean&gt; nonNull = Objects::nonNull;</span><br><span class="line">Predicate&lt;Boolean&gt; isNull = Objects::isNull;</span><br><span class="line"></span><br><span class="line">Predicate&lt;String&gt; isEmpty = String::isEmpty;</span><br><span class="line">Predicate&lt;String&gt; isNotEmpty = isEmpty.negate();</span><br></pre></td></tr></table></figure><h3 id="Function"><a href="#Function" class="headerlink" title="Function"></a>Function</h3><p><code>Function</code> å‡½æ•°å¼æ¥å£çš„ä½œç”¨æ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥ä¸ºå…¶æä¾›ä¸€ä¸ªåŸæ–™ï¼Œä»–ç»™ç”Ÿäº§ä¸€ä¸ªæœ€ç»ˆçš„äº§å“ã€‚é€šè¿‡å®ƒæä¾›çš„é»˜è®¤æ–¹æ³•ï¼Œç»„åˆ,é“¾è¡Œå¤„ç†(<code>compose</code>, <code>andThen</code>)ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Function&lt;String, Integer&gt; toInteger = Integer::valueOf;</span><br><span class="line">Function&lt;String, String&gt; backToString = toInteger.andThen(String::valueOf);</span><br><span class="line"></span><br><span class="line">backToString.apply(<span class="string">&quot;123&quot;</span>);     <span class="comment">// &quot;123&quot;</span></span><br></pre></td></tr></table></figure><h3 id="Supplierç”Ÿäº§è€…"><a href="#Supplierç”Ÿäº§è€…" class="headerlink" title="Supplierç”Ÿäº§è€…"></a>Supplierç”Ÿäº§è€…</h3><p><code>Supplier</code> ä¸ <code>Function</code> ä¸åŒï¼Œå®ƒä¸æ¥å—å…¥å‚ï¼Œç›´æ¥ä¸ºæˆ‘ä»¬ç”Ÿäº§ä¸€ä¸ªæŒ‡å®šçš„ç»“æœï¼Œæœ‰ç‚¹åƒç”Ÿäº§è€…æ¨¡å¼ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">    String firstName;</span><br><span class="line">    String lastName;</span><br><span class="line"></span><br><span class="line">    Person() &#123;&#125;</span><br><span class="line"></span><br><span class="line">    Person(String firstName, String lastName) &#123;</span><br><span class="line">        <span class="keyword">this</span>.firstName = firstName;</span><br><span class="line">        <span class="keyword">this</span>.lastName = lastName;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Supplier&lt;Person&gt; personSupplier = Person::<span class="keyword">new</span>;</span><br><span class="line">personSupplier.get();   <span class="comment">// new Person</span></span><br></pre></td></tr></table></figure><p>###Consumeræ¶ˆè´¹è€…</p><p>å¯¹äº <code>Consumer</code>ï¼Œæˆ‘ä»¬éœ€è¦æä¾›å…¥å‚ï¼Œç”¨æ¥è¢«æ¶ˆè´¹ï¼Œå¦‚ä¸‹é¢è¿™æ®µç¤ºä¾‹ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">    String firstName;</span><br><span class="line">    String lastName;</span><br><span class="line"></span><br><span class="line">    Person() &#123;&#125;</span><br><span class="line"></span><br><span class="line">    Person(String firstName, String lastName) &#123;</span><br><span class="line">        <span class="keyword">this</span>.firstName = firstName;</span><br><span class="line">        <span class="keyword">this</span>.lastName = lastName;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Consumer&lt;Person&gt; greeter = (p) -&gt; System.out.println(<span class="string">&quot;Hello, &quot;</span> + p.firstName);</span><br><span class="line">greeter.accept(<span class="keyword">new</span> Person(<span class="string">&quot;Luke&quot;</span>, <span class="string">&quot;Skywalker&quot;</span>));</span><br></pre></td></tr></table></figure><h3 id="Comparator"><a href="#Comparator" class="headerlink" title="Comparator"></a>Comparator</h3><p><code>Comparator</code> åœ¨ Java 8 ä¹‹å‰æ˜¯ä½¿ç”¨æ¯”è¾ƒæ™®éçš„ã€‚Java 8 ä¸­é™¤äº†å°†å…¶å‡çº§æˆäº†å‡½æ•°å¼æ¥å£ï¼Œè¿˜ä¸ºå®ƒæ‹“å±•äº†ä¸€äº›é»˜è®¤æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Comparator&lt;Person&gt; comparator = (p1, p2) -&gt; p1.firstName.compareTo(p2.firstName);</span><br><span class="line"></span><br><span class="line">Person p1 = <span class="keyword">new</span> Person(<span class="string">&quot;John&quot;</span>, <span class="string">&quot;Doe&quot;</span>);</span><br><span class="line">Person p2 = <span class="keyword">new</span> Person(<span class="string">&quot;Alice&quot;</span>, <span class="string">&quot;Wonderland&quot;</span>);</span><br><span class="line"></span><br><span class="line">comparator.compare(p1, p2);             <span class="comment">// &gt; 0</span></span><br><span class="line">comparator.reversed().compare(p1, p2);  <span class="comment">// &lt; 0</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="Optional"><a href="#Optional" class="headerlink" title="Optional"></a>Optional</h2><p>é¦–å…ˆï¼Œ<code>Optional</code> å®ƒä¸æ˜¯ä¸€ä¸ªå‡½æ•°å¼æ¥å£ï¼Œè®¾è®¡å®ƒçš„ç›®çš„æ˜¯ä¸ºäº†é˜²æ­¢ç©ºæŒ‡é’ˆå¼‚å¸¸ï¼ˆ<code>NullPointerException</code>ï¼‰ï¼Œè¦çŸ¥é“åœ¨ Java ç¼–ç¨‹ä¸­ï¼Œ ç©ºæŒ‡é’ˆå¼‚å¸¸å¯æ˜¯è‡­åæ˜­è‘—çš„ã€‚</p><p>è®©æˆ‘ä»¬æ¥å¿«é€Ÿäº†è§£ä¸€ä¸‹ <code>Optional</code> è¦å¦‚ä½•ä½¿ç”¨ï¼ä½ å¯ä»¥å°† <code>Optional</code> çœ‹åšæ˜¯åŒ…è£…å¯¹è±¡ï¼ˆå¯èƒ½æ˜¯ <code>null</code>, ä¹Ÿæœ‰å¯èƒ½é <code>null</code>ï¼‰çš„å®¹å™¨ã€‚å½“ä½ å®šä¹‰äº† ä¸€ä¸ªæ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•è¿”å›çš„å¯¹è±¡å¯èƒ½æ˜¯ç©ºï¼Œä¹Ÿæœ‰å¯èƒ½éç©ºçš„æ—¶å€™ï¼Œä½ å°±å¯ä»¥è€ƒè™‘ç”¨ <code>Optional</code> æ¥åŒ…è£…å®ƒï¼Œè¿™ä¹Ÿæ˜¯åœ¨ Java 8 è¢«æ¨èä½¿ç”¨çš„åšæ³•ã€‚</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Optional&lt;String&gt; optional = Optional.of(<span class="string">&quot;bam&quot;</span>);</span><br><span class="line"></span><br><span class="line">optional.isPresent();           <span class="comment">// true</span></span><br><span class="line">optional.get();                 <span class="comment">// &quot;bam&quot;</span></span><br><span class="line">optional.orElse(<span class="string">&quot;fallback&quot;</span>);    <span class="comment">// &quot;bam&quot;</span></span><br><span class="line"></span><br><span class="line">optional.ifPresent((s) -&gt; System.out.println(s.charAt(<span class="number">0</span>)));     <span class="comment">// &quot;b&quot;</span></span><br></pre></td></tr></table></figure><h2 id="Streamæµ"><a href="#Streamæµ" class="headerlink" title="Streamæµ"></a>Streamæµ</h2><p><em>ä»€ä¹ˆæ˜¯ Stream æµï¼Ÿ</em></p><p>ç®€å•æ¥è¯´ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>java.util.Stream</code> å¯¹ä¸€ä¸ªåŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªå…ƒç´ çš„é›†åˆåšå„ç§æ“ä½œã€‚è¿™äº›æ“ä½œå¯èƒ½æ˜¯ <em>ä¸­é—´æ“ä½œ</em> äº¦æˆ–æ˜¯ <em>ç»ˆç«¯æ“ä½œ</em>ã€‚ ç»ˆç«¯æ“ä½œä¼šè¿”å›ä¸€ä¸ªç»“æœï¼Œè€Œä¸­é—´æ“ä½œä¼šè¿”å›ä¸€ä¸ª <code>Stream</code> æµã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä½ åªèƒ½å¯¹å®ç°äº† <code>java.util.Collection</code> æ¥å£çš„ç±»åšæµçš„æ“ä½œã€‚</p><blockquote><p><code>Map</code> ä¸æ”¯æŒ <code>Stream</code> æµã€‚</p></blockquote><p><code>Stream</code> æµæ”¯æŒåŒæ­¥æ‰§è¡Œï¼Œä¹Ÿæ”¯æŒå¹¶å‘æ‰§è¡Œã€‚</p><h3 id="Filterè¿‡æ»¤"><a href="#Filterè¿‡æ»¤" class="headerlink" title="Filterè¿‡æ»¤"></a>Filterè¿‡æ»¤</h3><p>é¦–å…ˆï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ª <code>List</code> é›†åˆï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">List&lt;String&gt; stringCollection = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">stringCollection.add(<span class="string">&quot;ddd2&quot;</span>);</span><br><span class="line">stringCollection.add(<span class="string">&quot;aaa2&quot;</span>);</span><br><span class="line">stringCollection.add(<span class="string">&quot;bbb1&quot;</span>);</span><br><span class="line">stringCollection.add(<span class="string">&quot;aaa1&quot;</span>);</span><br><span class="line">stringCollection.add(<span class="string">&quot;bbb3&quot;</span>);</span><br><span class="line">stringCollection.add(<span class="string">&quot;ccc&quot;</span>);</span><br><span class="line">stringCollection.add(<span class="string">&quot;bbb2&quot;</span>);</span><br><span class="line">stringCollection.add(<span class="string">&quot;ddd1&quot;</span>);</span><br></pre></td></tr></table></figure><p><code>Filter</code> çš„å…¥å‚æ˜¯ä¸€ä¸ª <code>Predicate</code>, ä¸Šé¢å·²ç»è¯´åˆ°ï¼Œ<code>Predicate</code> æ˜¯ä¸€ä¸ªæ–­è¨€çš„ä¸­é—´æ“ä½œï¼Œå®ƒèƒ½å¤Ÿå¸®æˆ‘ä»¬ç­›é€‰å‡ºæˆ‘ä»¬éœ€è¦çš„é›†åˆå…ƒç´ ã€‚å®ƒçš„è¿”å‚åŒæ · æ˜¯ä¸€ä¸ª <code>Stream</code> æµï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ <code>foreach</code>ç»ˆç«¯æ“ä½œï¼Œæ¥æ‰“å°è¢«ç­›é€‰çš„å…ƒç´ ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">stringCollection</span><br><span class="line">    .stream()</span><br><span class="line">    .filter((s) -&gt; s.startsWith(<span class="string">&quot;a&quot;</span>))</span><br><span class="line">    .forEach(System.out::println);</span><br><span class="line"></span><br><span class="line"><span class="comment">// &quot;aaa2&quot;, &quot;aaa1&quot;</span></span><br></pre></td></tr></table></figure><blockquote><p>æ³¨æ„ï¼š<code>foreach</code> æ˜¯ä¸€ä¸ªç»ˆç«¯æ“ä½œï¼Œå®ƒçš„è¿”å‚æ˜¯ <code>void</code>, æˆ‘ä»¬æ— æ³•å¯¹å…¶å†æ¬¡è¿›è¡Œæµæ“ä½œã€‚</p></blockquote><h3 id="Sortedæ’åº"><a href="#Sortedæ’åº" class="headerlink" title="Sortedæ’åº"></a>Sortedæ’åº</h3><p><code>Sorted</code> åŒæ ·æ˜¯ä¸€ä¸ªä¸­é—´æ“ä½œï¼Œå®ƒçš„è¿”å‚æ˜¯ä¸€ä¸ª <code>Stream</code> æµã€‚å¦å¤–ï¼Œæˆ‘ä»¬å¯ä»¥ä¼ å…¥ä¸€ä¸ª <code>Comparator</code> ç”¨æ¥è‡ªå®šä¹‰æ’åºï¼Œå¦‚æœä¸ä¼ ï¼Œåˆ™ä½¿ç”¨é»˜è®¤çš„æ’åºè§„åˆ™ã€‚</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">stringCollection</span><br><span class="line">    .stream()</span><br><span class="line">    .sorted()</span><br><span class="line">    .filter((s) -&gt; s.startsWith(<span class="string">&quot;a&quot;</span>))</span><br><span class="line">    .forEach(System.out::println);</span><br><span class="line"></span><br><span class="line"><span class="comment">// &quot;aaa1&quot;, &quot;aaa2&quot;</span></span><br></pre></td></tr></table></figure><p>éœ€è¦æ³¨æ„ï¼Œ<code>sorted</code> ä¸ä¼šå¯¹ <code>stringCollection</code> åšå‡ºä»»ä½•æ”¹å˜ï¼Œ<code>stringCollection</code> è¿˜æ˜¯åŸæœ‰çš„é‚£äº›ä¸ªå…ƒç´ ï¼Œä¸”é¡ºåºä¸å˜ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">System.out.println(stringCollection);</span><br><span class="line"><span class="comment">// ddd2, aaa2, bbb1, aaa1, bbb3, ccc, bbb2, ddd1</span></span><br></pre></td></tr></table></figure><h3 id="Mapè½¬æ¢"><a href="#Mapè½¬æ¢" class="headerlink" title="Mapè½¬æ¢"></a>Mapè½¬æ¢</h3><p>ä¸­é—´æ“ä½œ <code>Map</code> èƒ½å¤Ÿå¸®åŠ©æˆ‘ä»¬å°† <code>List</code> ä¸­çš„æ¯ä¸€ä¸ªå…ƒç´ åšåŠŸèƒ½å¤„ç†ã€‚ä¾‹å¦‚ä¸‹é¢çš„ç¤ºä¾‹ï¼Œé€šè¿‡ <code>map</code>æˆ‘ä»¬å°†æ¯ä¸€ä¸ª <code>string</code> è½¬æˆå¤§å†™ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">stringCollection</span><br><span class="line">    .stream()</span><br><span class="line">    .map(String::toUpperCase)</span><br><span class="line">    .sorted((a, b) -&gt; b.compareTo(a))</span><br><span class="line">    .forEach(System.out::println);</span><br><span class="line"></span><br><span class="line"><span class="comment">// &quot;DDD2&quot;, &quot;DDD1&quot;, &quot;CCC&quot;, &quot;BBB3&quot;, &quot;BBB2&quot;, &quot;AAA2&quot;, &quot;AAA1&quot;</span></span><br></pre></td></tr></table></figure><p>å¦å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥åšå¯¹è±¡ä¹‹é—´çš„è½¬æ¢ï¼Œä¸šåŠ¡ä¸­æ¯”è¾ƒå¸¸ç”¨çš„æ˜¯å°† <code>DO</code>ï¼ˆæ•°æ®åº“å¯¹è±¡ï¼‰ è½¬æ¢æˆ <code>BO</code>ï¼ˆä¸šåŠ¡å¯¹è±¡ï¼‰ ã€‚</p><h3 id="MatchåŒ¹é…"><a href="#MatchåŒ¹é…" class="headerlink" title="MatchåŒ¹é…"></a>MatchåŒ¹é…</h3><p>é¡¾åæ€ä¹‰ï¼Œ<code>match</code> ç”¨æ¥åšåŒ¹é…æ“ä½œï¼Œå®ƒçš„è¿”å›å€¼æ˜¯ä¸€ä¸ª <code>boolean</code> ç±»å‹ã€‚é€šè¿‡ <code>match</code>, æˆ‘ä»¬å¯ä»¥æ–¹ä¾¿çš„éªŒè¯ä¸€ä¸ª <code>list</code> ä¸­æ˜¯å¦å­˜åœ¨æŸä¸ªç±»å‹çš„å…ƒç´ ã€‚</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// éªŒè¯ list ä¸­ string æ˜¯å¦æœ‰ä»¥ a å¼€å¤´çš„, åŒ¹é…åˆ°ç¬¬ä¸€ä¸ªï¼Œå³è¿”å› true</span></span><br><span class="line"><span class="keyword">boolean</span> anyStartsWithA =</span><br><span class="line">    stringCollection</span><br><span class="line">        .stream()</span><br><span class="line">        .anyMatch((s) -&gt; s.startsWith(<span class="string">&quot;a&quot;</span>));</span><br><span class="line"></span><br><span class="line">System.out.println(anyStartsWithA);      <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// éªŒè¯ list ä¸­ string æ˜¯å¦éƒ½æ˜¯ä»¥ a å¼€å¤´çš„</span></span><br><span class="line"><span class="keyword">boolean</span> allStartsWithA =</span><br><span class="line">    stringCollection</span><br><span class="line">        .stream()</span><br><span class="line">        .allMatch((s) -&gt; s.startsWith(<span class="string">&quot;a&quot;</span>));</span><br><span class="line"></span><br><span class="line">System.out.println(allStartsWithA);      <span class="comment">// false</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// éªŒè¯ list ä¸­ string æ˜¯å¦éƒ½ä¸æ˜¯ä»¥ z å¼€å¤´çš„,</span></span><br><span class="line"><span class="keyword">boolean</span> noneStartsWithZ =</span><br><span class="line">    stringCollection</span><br><span class="line">        .stream()</span><br><span class="line">        .noneMatch((s) -&gt; s.startsWith(<span class="string">&quot;z&quot;</span>));</span><br><span class="line"></span><br><span class="line">System.out.println(noneStartsWithZ);      <span class="comment">// true</span></span><br></pre></td></tr></table></figure><h3 id="Countè®¡æ•°"><a href="#Countè®¡æ•°" class="headerlink" title="Countè®¡æ•°"></a>Countè®¡æ•°</h3><p><code>count</code> æ˜¯ä¸€ä¸ªç»ˆç«¯æ“ä½œï¼Œå®ƒèƒ½å¤Ÿç»Ÿè®¡ <code>stream</code> æµä¸­çš„å…ƒç´ æ€»æ•°ï¼Œè¿”å›å€¼æ˜¯ <code>long</code> ç±»å‹ã€‚</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å…ˆå¯¹ list ä¸­å­—ç¬¦ä¸²å¼€å¤´ä¸º b è¿›è¡Œè¿‡æ»¤ï¼Œè®©åç»Ÿè®¡æ•°é‡</span></span><br><span class="line"><span class="keyword">long</span> startsWithB =</span><br><span class="line">    stringCollection</span><br><span class="line">        .stream()</span><br><span class="line">        .filter((s) -&gt; s.startsWith(<span class="string">&quot;b&quot;</span>))</span><br><span class="line">        .count();</span><br><span class="line"></span><br><span class="line">System.out.println(startsWithB);    <span class="comment">// 3</span></span><br></pre></td></tr></table></figure><h3 id="Reduceæ±‡èš"><a href="#Reduceæ±‡èš" class="headerlink" title="Reduceæ±‡èš"></a>Reduceæ±‡èš</h3><p><code>Reduce</code> ä¸­æ–‡ç¿»è¯‘ä¸ºï¼š<em>å‡å°‘ã€ç¼©å°</em>ã€‚é€šè¿‡å…¥å‚çš„ <code>Function</code>ï¼Œæˆ‘ä»¬èƒ½å¤Ÿå°† <code>list</code> å½’çº¦æˆä¸€ä¸ªå€¼ã€‚å®ƒçš„è¿”å›ç±»å‹æ˜¯ <code>Optional</code> ç±»å‹ã€‚</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Optional&lt;String&gt; reduced =</span><br><span class="line">    stringCollection</span><br><span class="line">        .stream()</span><br><span class="line">        .sorted()</span><br><span class="line">        .reduce((s1, s2) -&gt; s1 + <span class="string">&quot;#&quot;</span> + s2);</span><br><span class="line"></span><br><span class="line">reduced.ifPresent(System.out::println);</span><br><span class="line"><span class="comment">// &quot;aaa1#aaa2#bbb1#bbb2#bbb3#ccc#ddd1#ddd2&quot;</span></span><br></pre></td></tr></table></figure><p>##Parallel Streamså¹¶è¡Œæµ</p><p>å‰é¢ç« èŠ‚æˆ‘ä»¬è¯´è¿‡ï¼Œ<code>stream</code> æµæ˜¯æ”¯æŒ<strong>é¡ºåº</strong>å’Œ<strong>å¹¶è¡Œ</strong>çš„ã€‚é¡ºåºæµæ“ä½œæ˜¯å•çº¿ç¨‹æ“ä½œï¼Œè€Œå¹¶è¡Œæµæ˜¯é€šè¿‡å¤šçº¿ç¨‹æ¥å¤„ç†çš„ï¼Œèƒ½å¤Ÿå……åˆ†åˆ©ç”¨ç‰©ç†æœº å¤šæ ¸ CPU çš„ä¼˜åŠ¿ï¼ŒåŒæ—¶å¤„ç†é€Ÿåº¦æ›´å¿«ã€‚</p><p>é¦–å…ˆï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªåŒ…å« 1000000 UUID list é›†åˆã€‚</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">int</span> max = <span class="number">1000000</span>;</span><br><span class="line">List&lt;String&gt; values = <span class="keyword">new</span> ArrayList&lt;&gt;(max);</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; max; i++) &#123;</span><br><span class="line">    UUID uuid = UUID.randomUUID();</span><br><span class="line">    values.add(uuid.toString());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆ†åˆ«é€šè¿‡é¡ºåºæµå’Œå¹¶è¡Œæµï¼Œå¯¹è¿™ä¸ª list è¿›è¡Œæ’åºï¼Œæµ‹ç®—è€—æ—¶:</p><h3 id="é¡ºåºæµæ’åº"><a href="#é¡ºåºæµæ’åº" class="headerlink" title="é¡ºåºæµæ’åº"></a>é¡ºåºæµæ’åº</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// çº³ç§’</span></span><br><span class="line"><span class="keyword">long</span> t0 = System.nanoTime();</span><br><span class="line"></span><br><span class="line"><span class="keyword">long</span> count = values.stream().sorted().count();</span><br><span class="line">System.out.println(count);</span><br><span class="line"></span><br><span class="line"><span class="keyword">long</span> t1 = System.nanoTime();</span><br><span class="line"></span><br><span class="line"><span class="comment">// çº³ç§’è½¬å¾®ç§’</span></span><br><span class="line"><span class="keyword">long</span> millis = TimeUnit.NANOSECONDS.toMillis(t1 - t0);</span><br><span class="line">System.out.println(String.format(<span class="string">&quot;é¡ºåºæµæ’åºè€—æ—¶: %d ms&quot;</span>, millis));</span><br><span class="line"></span><br><span class="line"><span class="comment">// é¡ºåºæµæ’åºè€—æ—¶: 899 ms</span></span><br></pre></td></tr></table></figure><h3 id="å¹¶è¡Œæµæ’åº"><a href="#å¹¶è¡Œæµæ’åº" class="headerlink" title="å¹¶è¡Œæµæ’åº"></a>å¹¶è¡Œæµæ’åº</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// çº³ç§’</span></span><br><span class="line"><span class="keyword">long</span> t0 = System.nanoTime();</span><br><span class="line"></span><br><span class="line"><span class="keyword">long</span> count = values.parallelStream().sorted().count();</span><br><span class="line">System.out.println(count);</span><br><span class="line"></span><br><span class="line"><span class="keyword">long</span> t1 = System.nanoTime();</span><br><span class="line"></span><br><span class="line"><span class="comment">// çº³ç§’è½¬å¾®ç§’</span></span><br><span class="line"><span class="keyword">long</span> millis = TimeUnit.NANOSECONDS.toMillis(t1 - t0);</span><br><span class="line">System.out.println(String.format(<span class="string">&quot;å¹¶è¡Œæµæ’åºè€—æ—¶: %d ms&quot;</span>, millis));</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¹¶è¡Œæµæ’åºè€—æ—¶: 472 ms</span></span><br></pre></td></tr></table></figure><p>æ­£å¦‚ä½ æ‰€è§ï¼ŒåŒæ ·çš„é€»è¾‘å¤„ç†ï¼Œé€šè¿‡å¹¶è¡Œæµï¼Œæˆ‘ä»¬çš„æ€§èƒ½æå‡äº†è¿‘ **50%**ã€‚å®Œæˆè¿™ä¸€åˆ‡ï¼Œæˆ‘ä»¬éœ€è¦åšçš„ä»…ä»…æ˜¯å°† <code>stream</code> æ”¹æˆäº† <code>parallelStream</code>ã€‚</p><h2 id="Mapé›†åˆ"><a href="#Mapé›†åˆ" class="headerlink" title="Mapé›†åˆ"></a>Mapé›†åˆ</h2><p>å‰é¢å·²ç»æåˆ°è¿‡ <code>Map</code> æ˜¯ä¸æ”¯æŒ <code>Stream</code> æµçš„ï¼Œå› ä¸º <code>Map</code> æ¥å£å¹¶æ²¡æœ‰åƒ <code>Collection</code> æ¥å£é‚£æ ·ï¼Œå®šä¹‰äº† <code>stream()</code> æ–¹æ³•ã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹å…¶ <code>key</code>, <code>values</code>, <code>entry</code> ä½¿ç”¨ æµæ“ä½œï¼Œå¦‚ <code>map.keySet().stream()</code>, <code>map.values().stream()</code> å’Œ <code>map.entrySet().stream()</code>.</p><p>å¦å¤–, JDK 8 ä¸­å¯¹ <code>map</code> æä¾›äº†ä¸€äº›å…¶ä»–æ–°ç‰¹æ€§:</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Map&lt;Integer, String&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">    <span class="comment">// ä¸è€ç‰ˆä¸åŒçš„æ˜¯ï¼ŒputIfAbent() æ–¹æ³•åœ¨ put ä¹‹å‰ï¼Œ</span></span><br><span class="line">    <span class="comment">// ä¼šåˆ¤æ–­ key æ˜¯å¦å·²ç»å­˜åœ¨ï¼Œå­˜åœ¨åˆ™ç›´æ¥è¿”å› value, å¦åˆ™ put, å†è¿”å› value</span></span><br><span class="line">    map.putIfAbsent(i, <span class="string">&quot;val&quot;</span> + i);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// forEach å¯ä»¥å¾ˆæ–¹ä¾¿åœ°å¯¹ map è¿›è¡Œéå†æ“ä½œ</span></span><br><span class="line">map.forEach((key, value) -&gt; System.out.println(value));</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>é™¤äº†ä¸Šé¢çš„ <code>putIfAbsent()</code> å’Œ <code>forEach()</code> å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥å¾ˆæ–¹ä¾¿åœ°å¯¹æŸä¸ª <code>key</code> çš„å€¼åšç›¸å…³æ“ä½œï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// computeIfPresent(), å½“ key å­˜åœ¨æ—¶ï¼Œæ‰ä¼šåšç›¸å…³å¤„ç†</span></span><br><span class="line"><span class="comment">// å¦‚ä¸‹ï¼šå¯¹ key ä¸º 3 çš„å€¼ï¼Œå†…éƒ¨ä¼šå…ˆåˆ¤æ–­å€¼æ˜¯å¦å­˜åœ¨ï¼Œå­˜åœ¨ï¼Œåˆ™åš value + key çš„æ‹¼æ¥æ“ä½œ</span></span><br><span class="line">map.computeIfPresent(<span class="number">3</span>, (num, val) -&gt; val + num);</span><br><span class="line">map.get(<span class="number">3</span>);             <span class="comment">// val33</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å…ˆåˆ¤æ–­ key ä¸º 9 çš„å…ƒç´ æ˜¯å¦å­˜åœ¨ï¼Œå­˜åœ¨ï¼Œåˆ™åšåˆ é™¤æ“ä½œ</span></span><br><span class="line">map.computeIfPresent(<span class="number">9</span>, (num, val) -&gt; <span class="keyword">null</span>);</span><br><span class="line">map.containsKey(<span class="number">9</span>);     <span class="comment">// false</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// computeIfAbsent(), å½“ key ä¸å­˜åœ¨æ—¶ï¼Œæ‰ä¼šåšç›¸å…³å¤„ç†</span></span><br><span class="line"><span class="comment">// å¦‚ä¸‹ï¼šå…ˆåˆ¤æ–­ key ä¸º 23 çš„å…ƒç´ æ˜¯å¦å­˜åœ¨ï¼Œä¸å­˜åœ¨ï¼Œåˆ™æ·»åŠ </span></span><br><span class="line">map.computeIfAbsent(<span class="number">23</span>, num -&gt; <span class="string">&quot;val&quot;</span> + num);</span><br><span class="line">map.containsKey(<span class="number">23</span>);    <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å…ˆåˆ¤æ–­ key ä¸º 3 çš„å…ƒç´ æ˜¯å¦å­˜åœ¨ï¼Œå­˜åœ¨ï¼Œåˆ™ä¸åšä»»ä½•å¤„ç†</span></span><br><span class="line">map.computeIfAbsent(<span class="number">3</span>, num -&gt; <span class="string">&quot;bam&quot;</span>);</span><br><span class="line">map.get(<span class="number">3</span>);             <span class="comment">// val33</span></span><br></pre></td></tr></table></figure><p>å…³äºåˆ é™¤æ“ä½œï¼ŒJDK 8 ä¸­æä¾›äº†èƒ½å¤Ÿæ–°çš„ <code>remove()</code> API:</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">map.remove(<span class="number">3</span>, <span class="string">&quot;val3&quot;</span>);</span><br><span class="line">map.get(<span class="number">3</span>);             <span class="comment">// val33</span></span><br><span class="line"></span><br><span class="line">map.remove(<span class="number">3</span>, <span class="string">&quot;val33&quot;</span>);</span><br><span class="line">map.get(<span class="number">3</span>);             <span class="comment">// null</span></span><br></pre></td></tr></table></figure><p>å¦‚ä¸Šä»£ç ï¼Œåªæœ‰å½“ç»™å®šçš„ <code>key</code> å’Œ <code>value</code> å®Œå…¨åŒ¹é…æ—¶ï¼Œæ‰ä¼šæ‰§è¡Œåˆ é™¤æ“ä½œã€‚</p><p>å…³äºæ·»åŠ æ–¹æ³•ï¼ŒJDK 8 ä¸­æä¾›äº†å¸¦æœ‰é»˜è®¤å€¼çš„ <code>getOrDefault()</code> æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// è‹¥ key 42 ä¸å­˜åœ¨ï¼Œåˆ™è¿”å› not found</span></span><br><span class="line">map.getOrDefault(<span class="number">42</span>, <span class="string">&quot;not found&quot;</span>);  <span class="comment">// not found</span></span><br></pre></td></tr></table></figure><p>å¯¹äº <code>value</code> çš„åˆå¹¶æ“ä½œä¹Ÿå˜å¾—æ›´åŠ ç®€å•ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// merge æ–¹æ³•ï¼Œä¼šå…ˆåˆ¤æ–­è¿›è¡Œåˆå¹¶çš„ key æ˜¯å¦å­˜åœ¨ï¼Œä¸å­˜åœ¨ï¼Œåˆ™ä¼šæ·»åŠ å…ƒç´ </span></span><br><span class="line">map.merge(<span class="number">9</span>, <span class="string">&quot;val9&quot;</span>, (value, newValue) -&gt; value.concat(newValue));</span><br><span class="line">map.get(<span class="number">9</span>);             <span class="comment">// val9</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// è‹¥ key çš„å…ƒç´ å­˜åœ¨ï¼Œåˆ™å¯¹ value æ‰§è¡Œæ‹¼æ¥æ“ä½œ</span></span><br><span class="line">map.merge(<span class="number">9</span>, <span class="string">&quot;concat&quot;</span>, (value, newValue) -&gt; value.concat(newValue));</span><br><span class="line">map.get(<span class="number">9</span>);             <span class="comment">// val9concat</span></span><br></pre></td></tr></table></figure><h2 id="æ–°çš„æ—¥æœŸAPI"><a href="#æ–°çš„æ—¥æœŸAPI" class="headerlink" title="æ–°çš„æ—¥æœŸAPI"></a>æ–°çš„æ—¥æœŸAPI</h2><p>Java 8 ä¸­åœ¨åŒ… <code>java.time</code> ä¸‹æ·»åŠ äº†æ–°çš„æ—¥æœŸ API. å®ƒå’Œ <a href="https://link.juejin.im/?target=http://www.joda.org/joda-time/">Joda-Time</a> åº“ç›¸ä¼¼ï¼Œä½†åˆä¸å®Œå…¨ç›¸åŒã€‚</p><h3 id="Clock"><a href="#Clock" class="headerlink" title="Clock"></a>Clock</h3><p><code>Clock</code> æä¾›å¯¹å½“å‰æ—¥æœŸå’Œæ—¶é—´çš„è®¿é—®ã€‚æˆ‘ä»¬å¯ä»¥åˆ©ç”¨å®ƒæ¥æ›¿ä»£ <code>System.currentTimeMillis()</code> æ–¹æ³•ã€‚å¦å¤–ï¼Œé€šè¿‡ <code>clock.instant()</code> èƒ½å¤Ÿè·å–ä¸€ä¸ª <code>instant</code> å®ä¾‹ï¼Œ æ­¤å®ä¾‹èƒ½å¤Ÿæ–¹ä¾¿åœ°è½¬æ¢æˆè€ç‰ˆæœ¬ä¸­çš„ <code>java.util.Date</code> å¯¹è±¡ã€‚</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Clock clock = Clock.systemDefaultZone();</span><br><span class="line"><span class="keyword">long</span> millis = clock.millis();</span><br><span class="line"></span><br><span class="line">Instant instant = clock.instant();</span><br><span class="line">Date legacyDate = Date.from(instant);   <span class="comment">// è€ç‰ˆæœ¬ java.util.Date</span></span><br></pre></td></tr></table></figure><h3 id="Timezonesæ—¶åŒº"><a href="#Timezonesæ—¶åŒº" class="headerlink" title="Timezonesæ—¶åŒº"></a>Timezonesæ—¶åŒº</h3><p><code>ZoneId</code> ä»£è¡¨æ—¶åŒºç±»ã€‚é€šè¿‡é™æ€å·¥å‚æ–¹æ³•æ–¹ä¾¿åœ°è·å–å®ƒï¼Œå…¥å‚æˆ‘ä»¬å¯ä»¥ä¼ å…¥æŸä¸ªæ—¶åŒºç¼–ç ã€‚å¦å¤–ï¼Œæ—¶åŒºç±»è¿˜å®šä¹‰äº†ä¸€ä¸ªåç§»é‡ï¼Œç”¨æ¥åœ¨å½“å‰æ—¶åˆ»æˆ–æŸæ—¶é—´ ä¸ç›®æ ‡æ—¶åŒºæ—¶é—´ä¹‹é—´è¿›è¡Œè½¬æ¢ã€‚</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">System.out.println(ZoneId.getAvailableZoneIds());</span><br><span class="line"><span class="comment">// prints all available timezone ids</span></span><br><span class="line"></span><br><span class="line">ZoneId zone1 = ZoneId.of(<span class="string">&quot;Europe/Berlin&quot;</span>);</span><br><span class="line">ZoneId zone2 = ZoneId.of(<span class="string">&quot;Brazil/East&quot;</span>);</span><br><span class="line">System.out.println(zone1.getRules());</span><br><span class="line">System.out.println(zone2.getRules());</span><br><span class="line"></span><br><span class="line"><span class="comment">// ZoneRules[currentStandardOffset=+01:00]</span></span><br><span class="line"><span class="comment">// ZoneRules[currentStandardOffset=-03:00]</span></span><br></pre></td></tr></table></figure><h3 id="LocalTime"><a href="#LocalTime" class="headerlink" title="LocalTime"></a>LocalTime</h3><p><code>LocalTime</code> è¡¨ç¤ºä¸€ä¸ªæ²¡æœ‰æŒ‡å®šæ—¶åŒºçš„æ—¶é—´ç±»ï¼Œä¾‹å¦‚ï¼Œ<code>10 p.m</code>.æˆ–è€… <code>17ï¼š30:15</code>ï¼Œä¸‹é¢ç¤ºä¾‹ä»£ç ä¸­ï¼Œå°†ä¼šä½¿ç”¨ä¸Šé¢åˆ›å»ºçš„ æ—¶åŒºå¯¹è±¡åˆ›å»ºä¸¤ä¸ª <code>LocalTime</code>ã€‚ç„¶åæˆ‘ä»¬ä¼šæ¯”è¾ƒä¸¤ä¸ªæ—¶é—´ï¼Œå¹¶è®¡ç®—å®ƒä»¬ä¹‹é—´çš„å°æ—¶å’Œåˆ†é’Ÿçš„ä¸åŒã€‚</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">LocalTime now1 = LocalTime.now(zone1);</span><br><span class="line">LocalTime now2 = LocalTime.now(zone2);</span><br><span class="line"></span><br><span class="line">System.out.println(now1.isBefore(now2));  <span class="comment">// false</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">long</span> hoursBetween = ChronoUnit.HOURS.between(now1, now2);</span><br><span class="line"><span class="keyword">long</span> minutesBetween = ChronoUnit.MINUTES.between(now1, now2);</span><br><span class="line"></span><br><span class="line">System.out.println(hoursBetween);       <span class="comment">// -3</span></span><br><span class="line">System.out.println(minutesBetween);     <span class="comment">// -239</span></span><br></pre></td></tr></table></figure><p><code>LocalTime</code> æä¾›å¤šä¸ªé™æ€å·¥å‚æ–¹æ³•ï¼Œç›®çš„æ˜¯ä¸ºäº†ç®€åŒ–å¯¹æ—¶é—´å¯¹è±¡å®ä¾‹çš„åˆ›å»ºå’Œæ“ä½œï¼ŒåŒ…æ‹¬å¯¹æ—¶é—´å­—ç¬¦ä¸²è¿›è¡Œè§£æçš„æ“ä½œç­‰ã€‚</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">LocalTime late = LocalTime.of(<span class="number">23</span>, <span class="number">59</span>, <span class="number">59</span>);</span><br><span class="line">System.out.println(late);       <span class="comment">// 23:59:59</span></span><br><span class="line"></span><br><span class="line">DateTimeFormatter germanFormatter =</span><br><span class="line">    DateTimeFormatter</span><br><span class="line">        .ofLocalizedTime(FormatStyle.SHORT)</span><br><span class="line">        .withLocale(Locale.GERMAN);</span><br><span class="line"></span><br><span class="line">LocalTime leetTime = LocalTime.parse(<span class="string">&quot;13:37&quot;</span>, germanFormatter);</span><br><span class="line">System.out.println(leetTime);   <span class="comment">// 13:37</span></span><br></pre></td></tr></table></figure><h3 id="LocalDate"><a href="#LocalDate" class="headerlink" title="LocalDate"></a>LocalDate</h3><p><code>LocalDate</code> æ˜¯ä¸€ä¸ªæ—¥æœŸå¯¹è±¡ï¼Œä¾‹å¦‚ï¼š<code>2014-03-11</code>ã€‚å®ƒå’Œ <code>LocalTime</code> ä¸€æ ·æ˜¯ä¸ª <code>final</code> ç±»å‹å¯¹è±¡ã€‚ä¸‹é¢çš„ä¾‹å­æ¼”ç¤ºäº†å¦‚ä½•é€šè¿‡åŠ å‡æ—¥ï¼Œæœˆï¼Œå¹´ç­‰æ¥è®¡ç®—ä¸€ä¸ªæ–°çš„æ—¥æœŸã€‚</p><blockquote><p><code>LocalDate</code>, <code>LocalTime</code>, å› ä¸ºæ˜¯ <code>final</code> ç±»å‹çš„å¯¹è±¡ï¼Œæ¯ä¸€æ¬¡æ“ä½œéƒ½ä¼šè¿”å›ä¸€ä¸ªæ–°çš„æ—¶é—´å¯¹è±¡ã€‚</p></blockquote><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">LocalDate today = LocalDate.now();</span><br><span class="line"><span class="comment">// ä»Šå¤©åŠ ä¸€å¤©</span></span><br><span class="line">LocalDate tomorrow = today.plus(<span class="number">1</span>, ChronoUnit.DAYS);</span><br><span class="line"><span class="comment">// æ˜å¤©å‡ä¸¤å¤©</span></span><br><span class="line">LocalDate yesterday = tomorrow.minusDays(<span class="number">2</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2014 å¹´ä¸ƒæœˆçš„ç¬¬å››å¤©</span></span><br><span class="line">LocalDate independenceDay = LocalDate.of(<span class="number">2014</span>, Month.JULY, <span class="number">4</span>);</span><br><span class="line">DayOfWeek dayOfWeek = independenceDay.getDayOfWeek();</span><br><span class="line">System.out.println(dayOfWeek);    <span class="comment">// æ˜ŸæœŸäº”</span></span><br></pre></td></tr></table></figure><p>ä¹Ÿå¯ä»¥ç›´æ¥è§£ææ—¥æœŸå­—ç¬¦ä¸²ï¼Œç”Ÿæˆ <code>LocalDate</code> å®ä¾‹ã€‚ï¼ˆå’Œ <code>LocalTime</code> æ“ä½œä¸€æ ·ç®€å•ï¼‰</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">DateTimeFormatter germanFormatter =</span><br><span class="line">    DateTimeFormatter</span><br><span class="line">        .ofLocalizedDate(FormatStyle.MEDIUM)</span><br><span class="line">        .withLocale(Locale.GERMAN);</span><br><span class="line"></span><br><span class="line">LocalDate xmas = LocalDate.parse(<span class="string">&quot;24.12.2014&quot;</span>, germanFormatter);</span><br><span class="line">System.out.println(xmas);   <span class="comment">// 2014-12-24</span></span><br></pre></td></tr></table></figure><h3 id="LocalDateTime"><a href="#LocalDateTime" class="headerlink" title="LocalDateTime"></a>LocalDateTime</h3><p><code>LocalDateTime</code> æ˜¯ä¸€ä¸ª<strong>æ—¥æœŸ-æ—¶é—´</strong>å¯¹è±¡ã€‚ä½ ä¹Ÿå¯ä»¥å°†å…¶çœ‹æˆæ˜¯ <code>LocalDate</code> å’Œ <code>LocalTime</code> çš„ç»“åˆä½“ã€‚æ“ä½œä¸Šï¼Œä¹Ÿå¤§è‡´ç›¸åŒã€‚</p><blockquote><p><code>LocalDateTime</code> åŒæ ·æ˜¯ä¸€ä¸ª <code>final</code> ç±»å‹å¯¹è±¡ã€‚</p></blockquote><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">LocalDateTime sylvester = LocalDateTime.of(<span class="number">2014</span>, Month.DECEMBER, <span class="number">31</span>, <span class="number">23</span>, <span class="number">59</span>, <span class="number">59</span>);</span><br><span class="line"></span><br><span class="line">DayOfWeek dayOfWeek = sylvester.getDayOfWeek();</span><br><span class="line">System.out.println(dayOfWeek);      <span class="comment">// æ˜ŸæœŸä¸‰</span></span><br><span class="line"></span><br><span class="line">Month month = sylvester.getMonth();</span><br><span class="line">System.out.println(month);          <span class="comment">// åäºŒæœˆ</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// è·å–æ”¹æ—¶é—´æ˜¯è¯¥å¤©ä¸­çš„ç¬¬å‡ åˆ†é’Ÿ</span></span><br><span class="line"><span class="keyword">long</span> minuteOfDay = sylvester.getLong(ChronoField.MINUTE_OF_DAY);</span><br><span class="line">System.out.println(minuteOfDay);    <span class="comment">// 1439</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å¦‚æœå†åŠ ä¸Šçš„æ—¶åŒºä¿¡æ¯ï¼Œ<code>LocalDateTime</code> è¿˜èƒ½å¤Ÿè¢«è½¬æ¢æˆ <code>Instance</code> å®ä¾‹ã€‚<code>Instance</code> èƒ½å¤Ÿè¢«è½¬æ¢æˆè€ç‰ˆæœ¬ä¸­ <code>java.util.Date</code> å¯¹è±¡ã€‚</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Instant instant = sylvester</span><br><span class="line">        .atZone(ZoneId.systemDefault())</span><br><span class="line">        .toInstant();</span><br><span class="line"></span><br><span class="line">Date legacyDate = Date.from(instant);</span><br><span class="line">System.out.println(legacyDate);     <span class="comment">// Wed Dec 31 23:59:59 CET 2014</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æ ¼å¼åŒ– <code>LocalDateTime</code> å¯¹è±¡å°±å’Œæ ¼å¼åŒ– LocalDate æˆ–è€… LocalTime ä¸€æ ·ã€‚é™¤äº†ä½¿ç”¨é¢„å®šä¹‰çš„æ ¼å¼ä»¥å¤–ï¼Œä¹Ÿå¯ä»¥è‡ªå®šä¹‰æ ¼å¼åŒ–è¾“å‡ºã€‚</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">DateTimeFormatter formatter =</span><br><span class="line">    DateTimeFormatter</span><br><span class="line">        .ofPattern(<span class="string">&quot;MMM dd, yyyy - HH:mm&quot;</span>);</span><br><span class="line"></span><br><span class="line">LocalDateTime parsed = LocalDateTime.parse(<span class="string">&quot;Nov 03, 2014 - 07:13&quot;</span>, formatter);</span><br><span class="line">String string = formatter.format(parsed);</span><br><span class="line">System.out.println(string);     <span class="comment">// Nov 03, 2014 - 07:13</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><blockquote><p>æ³¨æ„ï¼šå’Œ <code>java.text.NumberFormat</code> ä¸åŒï¼Œæ–°çš„ <code>DateTimeFormatter</code> ç±»æ˜¯ <code>final</code> ç±»å‹çš„ï¼ŒåŒæ—¶ä¹Ÿæ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚</p></blockquote><h2 id="Annotationsæ³¨è§£"><a href="#Annotationsæ³¨è§£" class="headerlink" title="Annotationsæ³¨è§£"></a>Annotationsæ³¨è§£</h2><p>åœ¨ Java 8 ä¸­ï¼Œæ³¨è§£æ˜¯å¯ä»¥é‡å¤çš„ã€‚è®©æˆ‘é€šè¿‡ä¸‹é¢çš„ç¤ºä¾‹ä»£ç ï¼Œæ¥çœ‹çœ‹åˆ°åº•æ˜¯å’‹å›äº‹ã€‚</p><p>é¦–å…ˆï¼Œæˆ‘ä»¬å®šä¹‰ä¸€ä¸ªåŒ…è£…æ³¨è§£ï¼Œé‡Œé¢åŒ…å«äº†ä¸€ä¸ªæœ‰ç€å®é™…æ³¨è§£çš„æ•°ç»„ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@interface</span> Hints &#123;</span><br><span class="line">    Hint[] value();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Repeatable(Hints.class)</span></span><br><span class="line"><span class="meta">@interface</span> Hint &#123;</span><br><span class="line">    <span class="function">String <span class="title">value</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>Java 8 ä¸­ï¼Œé€šè¿‡ <code>@Repeatable</code>ï¼Œå…è®¸æˆ‘ä»¬å¯¹åŒä¸€ä¸ªç±»ä½¿ç”¨å¤šé‡æ³¨è§£ï¼š</p><p>ç¬¬ä¸€ç§å½¢æ€ï¼šä½¿ç”¨æ³¨è§£å®¹å™¨ï¼ˆè€æ–¹æ³•ï¼‰</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Hints(&#123;@Hint(&quot;hint1&quot;), @Hint(&quot;hint2&quot;)&#125;)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ç¬¬äºŒç§å½¢æ€ï¼šä½¿ç”¨å¯é‡å¤æ³¨è§£ï¼ˆæ–°æ–¹æ³•ï¼‰</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Hint(&quot;hint1&quot;)</span></span><br><span class="line"><span class="meta">@Hint(&quot;hint2&quot;)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ç¬¬äºŒç§å½¢æ€ï¼ŒJava ç¼–è¯‘å™¨èƒ½å¤Ÿåœ¨å†…éƒ¨è‡ªåŠ¨å¯¹ <code>@Hint</code> è¿›è¡Œè®¾ç½®ã€‚è¿™å¯¹äºéœ€è¦é€šè¿‡åå°„æ¥è¯»å–æ³¨è§£ä¿¡æ¯æ—¶ï¼Œæ˜¯éå¸¸é‡è¦çš„ã€‚</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Hint hint = Person.class.getAnnotation(Hint.class);</span><br><span class="line">System.out.println(hint);                   <span class="comment">// null</span></span><br><span class="line"></span><br><span class="line">Hints hints1 = Person.class.getAnnotation(Hints.class);</span><br><span class="line">System.out.println(hints1.value().length);  <span class="comment">// 2</span></span><br><span class="line"></span><br><span class="line">Hint[] hints2 = Person.class.getAnnotationsByType(Hint.class);</span><br><span class="line">System.out.println(hints2.length);          <span class="comment">// 2</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å°½ç®¡æˆ‘ä»¬ç»å¯¹ä¸ä¼šåœ¨ <code>Person</code> ç±»ä¸Šå£°æ˜ <code>@Hints</code> æ³¨è§£ï¼Œä½†æ˜¯å®ƒçš„ä¿¡æ¯ä»ç„¶æ˜¯å¯ä»¥é€šè¿‡ <code>getAnnotation(Hints.class)</code> æ¥è¯»å–çš„ã€‚ å¹¶ä¸”ï¼Œ<code>getAnnotationsByType</code> æ–¹æ³•ä¼šæ›´æ–¹ä¾¿ï¼Œå› ä¸ºå®ƒèµ‹äºˆäº†æ‰€æœ‰ <code>@Hints</code> æ³¨è§£æ ‡æ³¨çš„æ–¹æ³•ç›´æ¥çš„è®¿é—®æƒé™ã€‚</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Target(&#123;ElementType.TYPE_PARAMETER, ElementType.TYPE_USE&#125;)</span></span><br><span class="line"><span class="meta">@interface</span> MyAnnotation &#123;&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹æŠ€æœ¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä½¿ç”¨markdownç”»æµç¨‹å›¾ã€æ—¶åºå›¾</title>
      <link href="post/913648702/"/>
      <url>post/913648702/</url>
      
        <content type="html"><![CDATA[<blockquote><p>ä½¿ç”¨<code>markdown</code>æ¥å†™æ–‡ç« ï¼Œåšç¬”è®°æ˜¯éå¸¸æ–¹ä¾¿çš„ï¼Œè¿™é‡Œè®°å½•ä¸€äº›é«˜çº§ç”¨æ³•ï¼Œä½¿ç”¨<code>markdown</code>ç”»æµç¨‹å›¾ã€æ—¶åºå›¾ã€ç”˜ç‰¹å›¾ã€‚</p><p>å·¥å…·ï¼š<code>Typora</code></p></blockquote><h2 id="UMLæ—¶åºå›¾"><a href="#UMLæ—¶åºå›¾" class="headerlink" title="UMLæ—¶åºå›¾"></a>UMLæ—¶åºå›¾</h2><p>åœ¨<code>hexo</code>ä¸­éœ€è¦é…åˆä½¿ç”¨<code>hexo-filter-sequence</code>ä»¥åŠ<code>hexo-filter-mermaid-diagrams</code>æ’ä»¶æ”¯æŒæ¸²æŸ“ï¼Œå…·ä½“å‚è€ƒï¼š<a href="/2018/06/23/2018062301/">Hexoå¸¸ç”¨æ’ä»¶</a></p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">npm install --save hexo-filter-mermaid-diagrams</span><br><span class="line">npm install --save hexo-filter-sequence</span><br><span class="line">npm install --save hexo-filter-flowchart</span><br></pre></td></tr></table></figure><h3 id="ç®€å•ç¤ºä¾‹"><a href="#ç®€å•ç¤ºä¾‹" class="headerlink" title="ç®€å•ç¤ºä¾‹"></a>ç®€å•ç¤ºä¾‹</h3><p>æºä»£ç (<strong>åæ–œæ ç”¨äºè½¬ä¹‰ï¼Œå®é™…ä¸éœ€è¦</strong>)ï¼š</p><figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">\<span class="code">`\`</span>\`sequence</span><br><span class="line">A-&gt;B: Hello B(è¯·æ±‚)?</span><br><span class="line">Note right of B: å¯¹Bçš„ä¸€äº›æè¿°ä¿¡æ¯</span><br><span class="line">Note left of A: å¯¹Açš„ä¸€äº›æè¿°</span><br><span class="line">B--&gt;A: I&#x27;m find(å“åº”)!ä¸¤æ æ˜¯è™šçº¿</span><br><span class="line">A-&gt;B: I&#x27;m really find.</span><br><span class="line">B-B: I&#x27;m touch myself.</span><br><span class="line">\<span class="code">`\`</span>\`</span><br></pre></td></tr></table></figure><p>æ•ˆæœï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">A-&gt;B: Hello B(è¯·æ±‚)?</span><br><span class="line">Note right of B: å¯¹Bçš„ä¸€äº›æè¿°ä¿¡æ¯</span><br><span class="line">Note left of A: å¯¹Açš„ä¸€äº›æè¿°</span><br><span class="line">B--&gt;A: I&#39;m find(å“åº”)!ä¸¤æ æ˜¯è™šçº¿</span><br><span class="line">A-&gt;B: I&#39;m really find.</span><br><span class="line">B-B: I&#39;m touch myself.</span><br></pre></td></tr></table></figure><h3 id="å¤æ‚ç¤ºä¾‹"><a href="#å¤æ‚ç¤ºä¾‹" class="headerlink" title="å¤æ‚ç¤ºä¾‹"></a>å¤æ‚ç¤ºä¾‹</h3><p>æºä»£ç ï¼š</p><figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">\<span class="code">`\`</span>\`sequence</span><br><span class="line">Title: ä½¿ç”¨ï¼šå¤æ‚ä½¿ç”¨</span><br><span class="line">A-&gt;B: Hello B?ï¼ˆè¯·æ±‚ï¼‰</span><br><span class="line">Note right of B: å¯¹Bçš„æè¿°</span><br><span class="line">Note left of A: å¯¹Açš„æè¿°(æç¤º)</span><br><span class="line">B--&gt;A: I&#x27;m Find!(å“åº”)</span><br><span class="line">B-&gt;C: How are you?</span><br><span class="line">C--&gt;&gt;A: B touch me</span><br><span class="line">A-&gt;B: are you sureï¼Ÿ</span><br><span class="line">Note over C,B: We are friend</span><br><span class="line">participant C</span><br><span class="line">Note right of C: æ²¡äººé™ªæˆ‘ç©</span><br><span class="line">\<span class="code">`\`</span>\`</span><br></pre></td></tr></table></figure><p>æ•ˆæœï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Title: ä½¿ç”¨ï¼šå¤æ‚ä½¿ç”¨</span><br><span class="line">A-&gt;B: Hello B?ï¼ˆè¯·æ±‚ï¼‰</span><br><span class="line">Note right of B: å¯¹Bçš„æè¿°</span><br><span class="line">Note left of A: å¯¹Açš„æè¿°(æç¤º)</span><br><span class="line">B--&gt;A: I&#39;m Find!(å“åº”)</span><br><span class="line">B-&gt;C: How are you?</span><br><span class="line">C--&gt;&gt;A: B touch me</span><br><span class="line">A-&gt;B: are you sureï¼Ÿ</span><br><span class="line">Note over C,B: We are friend</span><br><span class="line">participant C</span><br><span class="line">Note right of C: æ²¡äººé™ªæˆ‘ç©</span><br></pre></td></tr></table></figure><h3 id="æ ‡å‡†ç¤ºä¾‹ï¼ˆä½¿ç”¨mermaidæ ‡ç­¾ï¼‰"><a href="#æ ‡å‡†ç¤ºä¾‹ï¼ˆä½¿ç”¨mermaidæ ‡ç­¾ï¼‰" class="headerlink" title="æ ‡å‡†ç¤ºä¾‹ï¼ˆä½¿ç”¨mermaidæ ‡ç­¾ï¼‰"></a>æ ‡å‡†ç¤ºä¾‹ï¼ˆä½¿ç”¨mermaidæ ‡ç­¾ï¼‰</h3><p>ä»¥ä¸‹æ˜¯æ ‡å‡†çš„<code>UML</code>æ—¶åºå›¾ç¤ºä¾‹ï¼š</p><p>æºç ï¼š</p><figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">\<span class="code">`\`</span>\`mermaid</span><br><span class="line">%% æ—¶åºå›¾ä¾‹å­,-&gt; ç›´çº¿ï¼Œ--&gt;è™šçº¿ï¼Œ-&gt;&gt;å®çº¿ç®­å¤´</span><br><span class="line"></span><br><span class="line">sequenceDiagram</span><br><span class="line"></span><br><span class="line">participant å¼ ä¸‰</span><br><span class="line"></span><br><span class="line">participant æå››</span><br><span class="line"></span><br><span class="line">å¼ ä¸‰-&gt;ç‹äº”: ç‹äº”ä½ å¥½å—ï¼Ÿ</span><br><span class="line"></span><br><span class="line">loop å¥åº·æ£€æŸ¥</span><br><span class="line"></span><br><span class="line">ç‹äº”-&gt;ç‹äº”: ä¸ç–¾ç—…æˆ˜æ–—</span><br><span class="line"></span><br><span class="line">end</span><br><span class="line"></span><br><span class="line">Note right of ç‹äº”: åˆç† é£Ÿç‰© <span class="xml"><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span>çœ‹åŒ»ç”Ÿ...</span><br><span class="line"></span><br><span class="line">æå››--&gt;&gt;å¼ ä¸‰: å¾ˆå¥½!</span><br><span class="line"></span><br><span class="line">ç‹äº”-&gt;æå››: ä½ æ€ä¹ˆæ ·?</span><br><span class="line"></span><br><span class="line">æå››--&gt;ç‹äº”: å¾ˆå¥½!</span><br><span class="line">\<span class="code">`\`</span>\`</span><br></pre></td></tr></table></figure><p>æ•ˆæœï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">%% æ—¶åºå›¾ä¾‹å­,-&gt; ç›´çº¿ï¼Œ--&gt;è™šçº¿ï¼Œ-&gt;&gt;å®çº¿ç®­å¤´</span><br><span class="line"></span><br><span class="line">sequenceDiagram</span><br><span class="line"></span><br><span class="line">participant å¼ ä¸‰</span><br><span class="line"></span><br><span class="line">participant æå››</span><br><span class="line"></span><br><span class="line">å¼ ä¸‰-&gt;ç‹äº”: ç‹äº”ä½ å¥½å—ï¼Ÿ</span><br><span class="line"></span><br><span class="line">loop å¥åº·æ£€æŸ¥</span><br><span class="line"></span><br><span class="line">ç‹äº”-&gt;ç‹äº”: ä¸ç–¾ç—…æˆ˜æ–—</span><br><span class="line"></span><br><span class="line">end</span><br><span class="line"></span><br><span class="line">Note right of ç‹äº”: åˆç† é£Ÿç‰© &lt;br&#x2F;&gt;çœ‹åŒ»ç”Ÿ...</span><br><span class="line"></span><br><span class="line">æå››--&gt;&gt;å¼ ä¸‰: å¾ˆå¥½!</span><br><span class="line"></span><br><span class="line">ç‹äº”-&gt;æå››: ä½ æ€ä¹ˆæ ·?</span><br><span class="line"></span><br><span class="line">æå››--&gt;ç‹äº”: å¾ˆå¥½!</span><br></pre></td></tr></table></figure><h2 id="æµç¨‹å›¾"><a href="#æµç¨‹å›¾" class="headerlink" title="æµç¨‹å›¾"></a>æµç¨‹å›¾</h2><h3 id="æ¨ªå‘æµç¨‹å›¾"><a href="#æ¨ªå‘æµç¨‹å›¾" class="headerlink" title="æ¨ªå‘æµç¨‹å›¾"></a>æ¨ªå‘æµç¨‹å›¾</h3><p>æºç ï¼š</p><figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">\<span class="code">`\`</span>\`mermaid</span><br><span class="line">graph LR</span><br><span class="line"></span><br><span class="line">A[æ–¹å½¢] --&gt;B(åœ†è§’)</span><br><span class="line"></span><br><span class="line">B --&gt; C&#123;æ¡ä»¶a&#125;</span><br><span class="line"></span><br><span class="line">C --&gt;|a=1| D[ç»“æœ1]</span><br><span class="line"></span><br><span class="line">C --&gt;|a=2| E[ç»“æœ2]</span><br><span class="line"></span><br><span class="line">F[æ¨ªå‘æµç¨‹å›¾]</span><br><span class="line">\<span class="code">`\`</span>\`</span><br></pre></td></tr></table></figure><p>æ•ˆæœï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">graph LR</span><br><span class="line"></span><br><span class="line">A[æ–¹å½¢] --&gt;B(åœ†è§’)</span><br><span class="line"></span><br><span class="line">B --&gt; C&#123;æ¡ä»¶a&#125;</span><br><span class="line"></span><br><span class="line">C --&gt;|a&#x3D;1| D[ç»“æœ1]</span><br><span class="line"></span><br><span class="line">C --&gt;|a&#x3D;2| E[ç»“æœ2]</span><br><span class="line"></span><br><span class="line">F[æ¨ªå‘æµç¨‹å›¾]</span><br></pre></td></tr></table></figure><h3 id="çºµå‘æµç¨‹å›¾"><a href="#çºµå‘æµç¨‹å›¾" class="headerlink" title="çºµå‘æµç¨‹å›¾"></a>çºµå‘æµç¨‹å›¾</h3><p>æºç ï¼š</p><figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">\<span class="code">`\`</span>\`mermaid</span><br><span class="line">graph TD</span><br><span class="line"></span><br><span class="line">A[æ–¹å½¢] --&gt;B(åœ†è§’)</span><br><span class="line"></span><br><span class="line">B --&gt; C&#123;æ¡ä»¶a&#125;</span><br><span class="line"></span><br><span class="line">C --&gt;|a=1| D[ç»“æœ1]</span><br><span class="line"></span><br><span class="line">C --&gt;|a=2| E[ç»“æœ2]</span><br><span class="line"></span><br><span class="line">F[ç«–å‘æµç¨‹å›¾]</span><br><span class="line">\<span class="code">`\`</span>\`</span><br></pre></td></tr></table></figure><p>æ•ˆæœï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">graph TD</span><br><span class="line"></span><br><span class="line">A[æ–¹å½¢] --&gt;B(åœ†è§’)</span><br><span class="line"></span><br><span class="line">B --&gt; C&#123;æ¡ä»¶a&#125;</span><br><span class="line"></span><br><span class="line">C --&gt;|a&#x3D;1| D[ç»“æœ1]</span><br><span class="line"></span><br><span class="line">C --&gt;|a&#x3D;2| E[ç»“æœ2]</span><br><span class="line"></span><br><span class="line">F[ç«–å‘æµç¨‹å›¾]</span><br></pre></td></tr></table></figure><h3 id="æ ‡å‡†æµç¨‹å›¾-flow"><a href="#æ ‡å‡†æµç¨‹å›¾-flow" class="headerlink" title="æ ‡å‡†æµç¨‹å›¾(flow)"></a>æ ‡å‡†æµç¨‹å›¾(flow)</h3><p>æºç ï¼š</p><figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">\<span class="code">`\`</span>\`flow</span><br><span class="line">st=&gt;start: å¼€å§‹æ¡†</span><br><span class="line">op=&gt;operation: å¤„ç†æ¡†</span><br><span class="line">cond=&gt;condition: åˆ¤æ–­æ¡†(æ˜¯æˆ–å¦?)</span><br><span class="line">sub1=&gt;subroutine: å­æµç¨‹</span><br><span class="line">io=&gt;inputoutput: è¾“å…¥è¾“å‡ºæ¡†</span><br><span class="line">e=&gt;end: ç»“æŸæ¡†</span><br><span class="line">st-&gt;op-&gt;cond</span><br><span class="line">cond(yes)-&gt;io-&gt;e</span><br><span class="line">cond(no)-&gt;sub1(right)-&gt;op</span><br><span class="line">\<span class="code">`\`</span>\`</span><br></pre></td></tr></table></figure><p>æ•ˆæœï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">st&#x3D;&gt;start: å¼€å§‹æ¡†</span><br><span class="line">op&#x3D;&gt;operation: å¤„ç†æ¡†</span><br><span class="line">cond&#x3D;&gt;condition: åˆ¤æ–­æ¡†(æ˜¯æˆ–å¦?)</span><br><span class="line">sub1&#x3D;&gt;subroutine: å­æµç¨‹</span><br><span class="line">io&#x3D;&gt;inputoutput: è¾“å…¥è¾“å‡ºæ¡†</span><br><span class="line">e&#x3D;&gt;end: ç»“æŸæ¡†</span><br><span class="line">st-&gt;op-&gt;cond</span><br><span class="line">cond(yes)-&gt;io-&gt;e</span><br><span class="line">cond(no)-&gt;sub1(right)-&gt;op</span><br></pre></td></tr></table></figure><h2 id="ç”˜ç‰¹å›¾"><a href="#ç”˜ç‰¹å›¾" class="headerlink" title="ç”˜ç‰¹å›¾"></a>ç”˜ç‰¹å›¾</h2><p>æºç ï¼š</p><figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">\<span class="code">`\`</span>\`mermaid</span><br><span class="line">%% è¯­æ³•ç¤ºä¾‹</span><br><span class="line"></span><br><span class="line">gantt</span><br><span class="line"></span><br><span class="line">dateFormat  YYYY-MM-DD</span><br><span class="line"></span><br><span class="line">title è½¯ä»¶å¼€å‘ç”˜ç‰¹å›¾</span><br><span class="line"></span><br><span class="line">section è®¾è®¡</span><br><span class="line"></span><br><span class="line">éœ€æ±‚                      :done,    des1, 2018-01-06,2014-01-08</span><br><span class="line"></span><br><span class="line">åŸå‹                      :active,  des2, 2018-01-09, 3d</span><br><span class="line"></span><br><span class="line">UIè®¾è®¡                     :         des3, after des2, 5d</span><br><span class="line"></span><br><span class="line">æœªæ¥ä»»åŠ¡                     :         des4, after des3, 5d</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">section å¼€å‘</span><br><span class="line"></span><br><span class="line">å­¦ä¹ å‡†å¤‡ç†è§£éœ€æ±‚                      :crit, done, 2018-01-06,24h</span><br><span class="line"></span><br><span class="line">è®¾è®¡æ¡†æ¶                             :crit, done, after des2, 2d</span><br><span class="line"></span><br><span class="line">å¼€å‘                                 :crit, active, 3d</span><br><span class="line"></span><br><span class="line">æœªæ¥ä»»åŠ¡                              :crit, 5d</span><br><span class="line"></span><br><span class="line">è€                                   :2d</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">section æµ‹è¯•</span><br><span class="line"></span><br><span class="line">åŠŸèƒ½æµ‹è¯•                              :active, a1, after des3, 3d</span><br><span class="line"></span><br><span class="line">å‹åŠ›æµ‹è¯•                               :after a1  , 20h</span><br><span class="line"></span><br><span class="line">æµ‹è¯•æŠ¥å‘Š                               : 48h</span><br><span class="line">\<span class="code">`\`</span>\`</span><br></pre></td></tr></table></figure><p>æ•ˆæœï¼š</p><p>å½“å‰åœ¨<code>hexo</code>ä¸­æ¸²æŸ“ä¸å‡ºæ¥ï¼Œåœ¨<code>Typora</code>èƒ½å±•ç¤ºå¦‚ä¸‹ï¼Œåç»­è§£å†³<code>Hexo</code>å±•ç¤ºé—®é¢˜ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/cayzlh/git-img-repository@master/uPic/1.png" alt="1"></p>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®°æœ¬ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> markdown </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Githubä¸Šä¼ å¤§æ–‡ä»¶</title>
      <link href="post/1301075481/"/>
      <url>post/1301075481/</url>
      
        <content type="html"><![CDATA[<p>å¾€<code>GitHub</code>ä¸Š<code>push</code>å•ä¸ªè¶…è¿‡<code>100M</code>æ–‡ä»¶çš„æ—¶å€™ï¼Œä¼šæŠ¥ä¸€ä¸‹é”™è¯¯ï¼š</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">remote: Resolving deltas: 100% (472/472), done.</span><br><span class="line">remote: error: GH001: Large files detected.</span><br><span class="line">You may want to try Git Large File Storage - https://git-lfs.github.com.</span><br></pre></td></tr></table></figure><h2 id="è§£å†³"><a href="#è§£å†³" class="headerlink" title="è§£å†³"></a>è§£å†³</h2><p>æ ¹æ®æç¤ºï¼Œè®¿é—®<a href="https://link.jianshu.com/?t=https://git-lfs.github.com">https://git-lfs.github.com</a>ï¼Œé€šè¿‡å®‰è£…<code>git-lfs</code>æ¥ä¸Šä¼ å¤§æ–‡ä»¶ã€‚</p><h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><ul><li><p>ç›´æ¥åœ¨å®˜ç½‘ä¸‹è½½å®‰è£…</p></li><li><p><code>Homebrew</code>å®‰è£…ï¼š</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">brew install git-lfs</span><br></pre></td></tr></table></figure></li><li><p><code>MacPorts</code>å®‰è£…ï¼š</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">port install git-lfs</span><br></pre></td></tr></table></figure></li></ul><h2 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h2><ul><li><p>åœ¨é¡¹ç›®æ ¹ç›®å½•æ‰§è¡Œä¸€æ¬¡</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git lfs install</span><br></pre></td></tr></table></figure></li><li><p>é€‰æ‹©å¸Œæœ›<code>Git LFS</code>ç®¡ç†ï¼ˆæˆ–ç›´æ¥ç¼–è¾‘<code>.gitattributes</code>ï¼‰çš„æ–‡ä»¶ç±»å‹ã€‚å¯ä»¥éšæ—¶é…ç½®å…¶ä»–æ–‡ä»¶æ‰©å±•åã€‚</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git lfs track &quot;*.psd&quot;</span><br></pre></td></tr></table></figure></li><li><p>å°†<code>.gitattributes</code>æ–‡ä»¶åŠ å…¥åˆ°ç‰ˆæœ¬æ§åˆ¶</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git add .gitattributes</span><br></pre></td></tr></table></figure></li><li><p>åƒå¾€å¸¸ä¸€æ ·æäº¤å¹¶æ¨é€åˆ°GitHubã€‚</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git add file.psd</span><br><span class="line">git commit -m &quot;Add design file&quot;</span><br><span class="line">git push origin master</span><br></pre></td></tr></table></figure></li></ul><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>å½“éœ€è¦ç”¨<code>GitHub</code>æ¥ä¿å­˜ä¸€äº›ç”µå­ä¹¦ç­‰æ–‡ä»¶çš„æ—¶å€™ï¼Œå°±å¯ä»¥ä½¿ç”¨è¿™ç§æ–¹å¼æ¥<code>push</code>ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®°æœ¬ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Github </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Dockerçš„ç½‘ç»œæ¨¡å¼</title>
      <link href="post/2907325745/"/>
      <url>post/2907325745/</url>
      
        <content type="html"><![CDATA[<p><code>Docker</code>åœ¨åˆ›å»ºå®¹å™¨çš„æ—¶å€™ï¼Œå¯ä»¥ä½¿ç”¨<code>--net</code>é€‰é¡¹æŒ‡å®šå®¹å™¨çš„çš„ç½‘ç»œæ¨¡å¼ã€‚</p><h2 id="ç½‘ç»œæ¨¡å¼"><a href="#ç½‘ç»œæ¨¡å¼" class="headerlink" title="ç½‘ç»œæ¨¡å¼"></a>ç½‘ç»œæ¨¡å¼</h2><p><code>Docker</code>æ”¯æŒ4ç§ç½‘ç»œæ¨¡å¼ä¾›å¤§å®¶é€‰æ‹©ï¼š</p><ul><li><strong>host</strong>æ¨¡å¼ï¼Œä½¿ç”¨<code>- -net=host</code>æŒ‡å®šã€‚</li><li><strong>container</strong>æ¨¡å¼ï¼Œä½¿ç”¨<code>- -net=container:NAME_or_ID</code>æŒ‡å®šã€‚</li><li><strong>none</strong>æ¨¡å¼ï¼Œä½¿ç”¨<code>- -net=none</code>æŒ‡å®šã€‚</li><li><strong>bridge</strong>æ¨¡å¼ï¼Œä½¿ç”¨<code>- -net=bridge</code>æŒ‡å®šï¼Œé»˜è®¤è®¾ç½®ã€‚</li></ul><h2 id="hostæ¨¡å¼"><a href="#hostæ¨¡å¼" class="headerlink" title="hostæ¨¡å¼"></a>hostæ¨¡å¼</h2><p>ä¼—æ‰€å‘¨çŸ¥ï¼Œ<code>Docker</code>ä½¿ç”¨äº†<code>Linux</code>çš„<code>Namespaces</code>æŠ€æœ¯æ¥è¿›è¡Œèµ„æºéš”ç¦»ï¼Œå¦‚<code>PID Namespace</code>éš”ç¦»è¿›ç¨‹ï¼Œ<code>Mount Namespace</code>éš”ç¦»æ–‡ä»¶ç³»ç»Ÿï¼Œ<code>Network Namespace</code>éš”ç¦»ç½‘ç»œç­‰ã€‚ä¸€ä¸ª<code>Network Namespace</code>æä¾›äº†ä¸€ä»½ç‹¬ç«‹çš„ç½‘ç»œç¯å¢ƒï¼ŒåŒ…æ‹¬<strong>ç½‘å¡</strong>ã€<strong>è·¯ç”±</strong>ã€<strong>Iptable</strong>è§„åˆ™ç­‰éƒ½ä¸å…¶ä»–çš„<code>Network Namespace</code>éš”ç¦»ã€‚ä¸€ä¸ª<code>Docker</code>å®¹å™¨ä¸€èˆ¬ä¼šåˆ†é…ä¸€ä¸ªç‹¬ç«‹çš„<code>Network Namespace</code>ã€‚ä½†å¦‚æœå¯åŠ¨å®¹å™¨çš„æ—¶å€™ä½¿ç”¨ho<code>st</code>æ¨¡å¼ï¼Œé‚£ä¹ˆè¿™ä¸ªå®¹å™¨å°†ä¸ä¼šè·å¾—ä¸€ä¸ªç‹¬ç«‹çš„<code>Network Namespace</code>ï¼Œè€Œæ˜¯å’Œå®¿ä¸»æœºå…±ç”¨ä¸€ä¸ª<code>Network Namespace</code>ã€‚å®¹å™¨å°†ä¸ä¼šè™šæ‹Ÿå‡ºè‡ªå·±çš„ç½‘å¡ï¼Œé…ç½®è‡ªå·±çš„<code>IP</code>ç­‰ï¼Œè€Œæ˜¯ä½¿ç”¨å®¿ä¸»æœºçš„<code>IP</code>å’Œç«¯å£ã€‚</p><p>ä¾‹å¦‚ï¼Œæˆ‘ä»¬åœ¨<code>10.10.101.105/24</code>çš„æœºå™¨ä¸Šç”¨<code>host</code>æ¨¡å¼å¯åŠ¨ä¸€ä¸ªå«æœ‰<code>web</code>åº”ç”¨çš„<code>Docker</code>å®¹å™¨ï¼Œç›‘å¬<code>tcp80</code>ç«¯å£ã€‚å½“æˆ‘ä»¬åœ¨å®¹å™¨ä¸­æ‰§è¡Œä»»ä½•ç±»ä¼¼<code>ifconfig</code>å‘½ä»¤æŸ¥çœ‹ç½‘ç»œç¯å¢ƒæ—¶ï¼Œçœ‹åˆ°çš„éƒ½æ˜¯å®¿ä¸»æœºä¸Šçš„ä¿¡æ¯ã€‚è€Œå¤–ç•Œè®¿é—®å®¹å™¨ä¸­çš„åº”ç”¨ï¼Œåˆ™ç›´æ¥ä½¿ç”¨<code>10.10.101.105:80</code>å³å¯ï¼Œä¸ç”¨ä»»ä½•<code>NAT</code>è½¬æ¢ï¼Œå°±å¦‚ç›´æ¥è·‘åœ¨å®¿ä¸»æœºä¸­ä¸€æ ·ã€‚ä½†æ˜¯ï¼Œå®¹å™¨çš„å…¶ä»–æ–¹é¢ï¼Œå¦‚æ–‡ä»¶ç³»ç»Ÿã€è¿›ç¨‹åˆ—è¡¨ç­‰è¿˜æ˜¯å’Œå®¿ä¸»æœºéš”ç¦»çš„ã€‚</p><h2 id="containeræ¨¡å¼"><a href="#containeræ¨¡å¼" class="headerlink" title="containeræ¨¡å¼"></a>containeræ¨¡å¼</h2><p>åœ¨ç†è§£äº†<code>host</code>æ¨¡å¼åï¼Œè¿™ä¸ªæ¨¡å¼ä¹Ÿå°±å¥½ç†è§£äº†ã€‚è¿™ä¸ªæ¨¡å¼æŒ‡å®šæ–°åˆ›å»ºçš„å®¹å™¨å’Œå·²ç»å­˜åœ¨çš„ä¸€ä¸ªå®¹å™¨å…±äº«ä¸€ä¸ª<code>Network Namespace</code>ï¼Œè€Œä¸æ˜¯å’Œå®¿ä¸»æœºå…±äº«ã€‚æ–°åˆ›å»ºçš„å®¹å™¨ä¸ä¼šåˆ›å»ºè‡ªå·±çš„ç½‘å¡ï¼Œé…ç½®è‡ªå·±çš„<code>IP</code>ï¼Œè€Œæ˜¯å’Œä¸€ä¸ªæŒ‡å®šçš„<strong>å®¹å™¨å…±äº«IP</strong>ã€<strong>ç«¯å£èŒƒå›´</strong>ç­‰ã€‚åŒæ ·ï¼Œä¸¤ä¸ªå®¹å™¨é™¤äº†ç½‘ç»œæ–¹é¢ï¼Œå…¶ä»–çš„å¦‚æ–‡ä»¶ç³»ç»Ÿã€è¿›ç¨‹åˆ—è¡¨ç­‰è¿˜æ˜¯éš”ç¦»çš„ã€‚ä¸¤ä¸ªå®¹å™¨çš„è¿›ç¨‹å¯ä»¥é€šè¿‡loç½‘å¡è®¾å¤‡é€šä¿¡ã€‚</p><h2 id="noneæ¨¡å¼"><a href="#noneæ¨¡å¼" class="headerlink" title="noneæ¨¡å¼"></a>noneæ¨¡å¼</h2><p>è¿™ä¸ªæ¨¡å¼å’Œå‰ä¸¤ä¸ªä¸åŒã€‚åœ¨è¿™ç§æ¨¡å¼ä¸‹ï¼Œ<code>Docker</code>å®¹å™¨æ‹¥æœ‰è‡ªå·±çš„<code>Network Namespace</code>ï¼Œä½†æ˜¯ï¼Œå¹¶ä¸ä¸º<code>Docker</code>å®¹å™¨è¿›è¡Œä»»ä½•ç½‘ç»œé…ç½®ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™ä¸ª<code>Docker</code>å®¹å™¨æ²¡æœ‰ç½‘å¡ã€IPã€è·¯ç”±ç­‰ä¿¡æ¯ã€‚éœ€è¦æˆ‘ä»¬è‡ªå·±ä¸º<code>Docker</code>å®¹å™¨æ·»åŠ ç½‘å¡ã€é…ç½®<code>IP</code>ç­‰ã€‚</p><h2 id="bridgeæ¨¡å¼"><a href="#bridgeæ¨¡å¼" class="headerlink" title="bridgeæ¨¡å¼"></a>bridgeæ¨¡å¼</h2><p><code>bridge</code>æ¨¡å¼æ˜¯<code>Docker</code>é»˜è®¤çš„ç½‘ç»œè®¾ç½®ï¼Œæ­¤æ¨¡å¼ä¼šä¸ºæ¯ä¸€ä¸ªå®¹å™¨åˆ†é…<code>Network Namespace</code>ã€è®¾ç½®<code>IP</code>ç­‰ï¼Œå¹¶å°†ä¸€ä¸ªä¸»æœºä¸Šçš„<code>Docker</code>å®¹å™¨è¿æ¥åˆ°ä¸€ä¸ªè™šæ‹Ÿç½‘æ¡¥ä¸Šã€‚</p><h3 id="bridgeæ¨¡å¼çš„æ‹“æ‰‘"><a href="#bridgeæ¨¡å¼çš„æ‹“æ‰‘" class="headerlink" title="bridgeæ¨¡å¼çš„æ‹“æ‰‘"></a>bridgeæ¨¡å¼çš„æ‹“æ‰‘</h3><p>å½“<code>Docker server</code>å¯åŠ¨æ—¶ï¼Œä¼šåœ¨ä¸»æœºä¸Šåˆ›å»ºä¸€ä¸ªåä¸º<code>docker0</code>çš„è™šæ‹Ÿç½‘æ¡¥ï¼Œæ­¤ä¸»æœºä¸Šå¯åŠ¨çš„<code>Docker</code>å®¹å™¨ä¼šè¿æ¥åˆ°è¿™ä¸ªè™šæ‹Ÿç½‘æ¡¥ä¸Šã€‚è™šæ‹Ÿç½‘æ¡¥çš„å·¥ä½œæ–¹å¼å’Œç‰©ç†äº¤æ¢æœºç±»ä¼¼ï¼Œè¿™æ ·ä¸»æœºä¸Šçš„æ‰€æœ‰å®¹å™¨å°±é€šè¿‡äº¤æ¢æœºè¿åœ¨äº†ä¸€ä¸ªäºŒå±‚ç½‘ç»œä¸­ã€‚æ¥ä¸‹æ¥å°±è¦ä¸ºå®¹å™¨åˆ†é…IPäº†ï¼Œ<code>Docker</code>ä¼šä»<code>RFC1918</code>æ‰€å®šä¹‰çš„ç§æœ‰<code>IP</code>ç½‘æ®µä¸­ï¼Œé€‰æ‹©ä¸€ä¸ªå’Œå®¿ä¸»æœºä¸åŒçš„IPåœ°å€å’Œå­ç½‘åˆ†é…ç»™<code>docker0</code>ï¼Œè¿æ¥åˆ°<code>docker0</code>çš„å®¹å™¨å°±ä»è¿™ä¸ªå­ç½‘ä¸­é€‰æ‹©ä¸€ä¸ªæœªå ç”¨çš„IPä½¿ç”¨ã€‚å¦‚ä¸€èˆ¬<code>Docker</code>ä¼šä½¿ç”¨<code>172.17.0.0/16</code>è¿™ä¸ªç½‘æ®µï¼Œå¹¶å°†<code>172.17.42.1/16</code>åˆ†é…ç»™<code>docker0</code>ç½‘æ¡¥ï¼ˆåœ¨ä¸»æœºä¸Šä½¿ç”¨<code>ifconfig</code>å‘½ä»¤æ˜¯å¯ä»¥çœ‹åˆ°<code>docker0</code>çš„ï¼Œå¯ä»¥è®¤ä¸ºå®ƒæ˜¯ç½‘æ¡¥çš„ç®¡ç†æ¥å£ï¼Œåœ¨å®¿ä¸»æœºä¸Šä½œä¸ºä¸€å—è™šæ‹Ÿç½‘å¡ä½¿ç”¨ï¼‰ã€‚å•æœºç¯å¢ƒä¸‹çš„ç½‘ç»œæ‹“æ‰‘å¦‚ä¸‹ï¼Œä¸»æœºåœ°å€ä¸º<code>10.10.101.105/24</code>ã€‚</p><p><img src="https://github.com/cayzlh/git-img-repository/raw/master/blog/2019/01/05/1.png" alt="bridgeçš„æ‹“æ‰‘"></p><p>-</p><p><img src="https://github.com/cayzlh/git-img-repository/raw/master/blog/2019/01/05/2.png" alt="bridgeçš„æ‹“æ‰‘"></p><p>-</p><h3 id="é»˜è®¤æ¨¡å¼"><a href="#é»˜è®¤æ¨¡å¼" class="headerlink" title="é»˜è®¤æ¨¡å¼"></a>é»˜è®¤æ¨¡å¼</h3><p>å®‰è£…å®Œ<code>Docker</code>çš„æ—¶å€™ï¼Œä¼šè‡ªåŠ¨åˆ›å»ºä¸‰ä¸ªç½‘ç»œã€‚ä½¿ç”¨<code>docker network ls</code>å‘½ä»¤å¯ä»¥æŸ¥çœ‹è¿™äº›ç½‘ç»œï¼š</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> docker network ls</span>               </span><br><span class="line"></span><br><span class="line">NETWORK ID          NAME                DRIVER              SCOPE</span><br><span class="line">75b73b341642        bridge              bridge              local</span><br><span class="line">dbef3961eb84        host                host                local</span><br><span class="line">90741a2555ee        none                null                local</span><br></pre></td></tr></table></figure><p>è¿™ä¸‰ä¸ªç½‘ç»œéƒ½å»ºåœ¨<code>Docker</code>ä¸­ã€‚è¿è¡Œå®¹å™¨æ—¶ï¼Œå¯ä»¥ä½¿ç”¨è¯¥<code>--network</code>æ ‡å¿—æ¥æŒ‡å®šå®¹å™¨åº”è¿æ¥åˆ°çš„ç½‘ç»œã€‚</p><h3 id="é»˜è®¤ç½‘æ¡¥"><a href="#é»˜è®¤ç½‘æ¡¥" class="headerlink" title="é»˜è®¤ç½‘æ¡¥"></a>é»˜è®¤ç½‘æ¡¥</h3><p><code>Docker</code> æœåŠ¡å¯åŠ¨åé»˜è®¤ä¼šåˆ›å»ºä¸€ä¸ª <code>docker0</code> ç½‘æ¡¥ï¼ˆå…¶ä¸Šæœ‰ä¸€ä¸ª <code>docker0</code> å†…éƒ¨æ¥å£ï¼‰ï¼Œå®ƒåœ¨å†…æ ¸å±‚è¿é€šäº†å…¶ä»–çš„ç‰©ç†æˆ–è™šæ‹Ÿç½‘å¡ï¼Œè¿™å°±å°†æ‰€æœ‰å®¹å™¨å’Œæœ¬åœ°ä¸»æœºéƒ½æ”¾åˆ°åŒä¸€ä¸ªç‰©ç†ç½‘ç»œã€‚</p><p><code>Docker</code> é»˜è®¤æŒ‡å®šäº† <code>docker0</code> æ¥å£ çš„ <code>IP</code> åœ°å€å’Œå­ç½‘æ©ç ï¼Œè®©ä¸»æœºå’Œå®¹å™¨ä¹‹é—´å¯ä»¥é€šè¿‡ç½‘æ¡¥ç›¸äº’é€šä¿¡ï¼Œå®ƒè¿˜ç»™å‡ºäº† <code>MTU</code>ï¼ˆæ¥å£å…è®¸æ¥æ”¶çš„æœ€å¤§ä¼ è¾“å•å…ƒï¼‰ï¼Œé€šå¸¸æ˜¯ <code>1500 Bytes</code>ï¼Œæˆ–å®¿ä¸»ä¸»æœºç½‘ç»œè·¯ç”±ä¸Šæ”¯æŒçš„é»˜è®¤å€¼ã€‚è¿™äº›å€¼éƒ½å¯ä»¥åœ¨æœåŠ¡å¯åŠ¨çš„æ—¶å€™è¿›è¡Œé…ç½®ã€‚</p><p><code>bridge</code>æ‰€æœ‰<code>Docker</code>ä¸»æœºä¸Šéƒ½å­˜åœ¨é»˜è®¤ç½‘ç»œã€‚å¦‚æœæ‚¨ä¸æŒ‡å®šå…¶ä»–ç½‘ç»œï¼Œåˆ™æ–°çš„å®¹å™¨ä¼šè‡ªåŠ¨è¿æ¥åˆ°é»˜è®¤<code>bridge</code>ç½‘ç»œã€‚</p><p>ä½¿ç”¨<code>docker network inspect</code>å‘½ä»¤å¯ä»¥æŸ¥çœ‹ç›¸å…³çš„ç½‘ç»œä¿¡æ¯ï¼š</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> docker network inspect 75b73b341642</span></span><br><span class="line"></span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;Name&quot;: &quot;bridge&quot;,</span><br><span class="line">        &quot;Id&quot;: &quot;75b73b3416429364a268ba6db607cb6bffbc921241714228d22fd95c15cde76f&quot;,</span><br><span class="line">        &quot;Created&quot;: &quot;2019-01-01T05:13:00.609463Z&quot;,</span><br><span class="line">        &quot;Scope&quot;: &quot;local&quot;,</span><br><span class="line">        &quot;Driver&quot;: &quot;bridge&quot;,</span><br><span class="line">        &quot;EnableIPv6&quot;: false,</span><br><span class="line">        &quot;IPAM&quot;: &#123;</span><br><span class="line">            &quot;Driver&quot;: &quot;default&quot;,</span><br><span class="line">            &quot;Options&quot;: null,</span><br><span class="line">            &quot;Config&quot;: [</span><br><span class="line">                &#123;</span><br><span class="line">                    &quot;Subnet&quot;: &quot;172.17.0.0/16&quot;,</span><br><span class="line">                    &quot;Gateway&quot;: &quot;172.17.0.1&quot;</span><br><span class="line">                &#125;</span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;Internal&quot;: false,</span><br><span class="line">        &quot;Attachable&quot;: false,</span><br><span class="line">        &quot;Ingress&quot;: false,</span><br><span class="line">        &quot;ConfigFrom&quot;: &#123;</span><br><span class="line">            &quot;Network&quot;: &quot;&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;ConfigOnly&quot;: false,</span><br><span class="line">        &quot;Containers&quot;: &#123;</span><br><span class="line">            &quot;1bd6dc5dbb7c6a73801ce682d4fe590cff14ba046837c75de70b7a2f756cdd21&quot;: &#123;</span><br><span class="line">                &quot;Name&quot;: &quot;boring_nash&quot;,</span><br><span class="line">                &quot;EndpointID&quot;: &quot;060084e59605428932e9862193ede495b23459d4d8039b1ef4e0f25099726599&quot;,</span><br><span class="line">                &quot;MacAddress&quot;: &quot;02:42:ac:11:00:03&quot;,</span><br><span class="line">                &quot;IPv4Address&quot;: &quot;172.17.0.3/16&quot;,</span><br><span class="line">                &quot;IPv6Address&quot;: &quot;&quot;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;3dc606b07fbbbc2e2040104764b81cf6fbccf1594f4da99fcf03264ad2fcb9d6&quot;: &#123;</span><br><span class="line">                &quot;Name&quot;: &quot;rabbitmq&quot;,</span><br><span class="line">                &quot;EndpointID&quot;: &quot;08031fb6659f74caa2940d473f3c5ccbc849a5af485361705e63c3df66927e8c&quot;,</span><br><span class="line">                &quot;MacAddress&quot;: &quot;02:42:ac:11:00:02&quot;,</span><br><span class="line">                &quot;IPv4Address&quot;: &quot;172.17.0.2/16&quot;,</span><br><span class="line">                &quot;IPv6Address&quot;: &quot;&quot;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;4b8887d1cf1cbe7c8d17990d2c91dce95f7099e9a9f178b6feed525b7879a369&quot;: &#123;</span><br><span class="line">                &quot;Name&quot;: &quot;objective-mysql&quot;,</span><br><span class="line">                &quot;EndpointID&quot;: &quot;9732e3b010e7053cf8e3d0f0985e5e26557d75a4930d100452ac71c5e97ecc15&quot;,</span><br><span class="line">                &quot;MacAddress&quot;: &quot;02:42:ac:11:00:04&quot;,</span><br><span class="line">                &quot;IPv4Address&quot;: &quot;172.17.0.4/16&quot;,</span><br><span class="line">                &quot;IPv6Address&quot;: &quot;&quot;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;Options&quot;: &#123;</span><br><span class="line">            &quot;com.docker.network.bridge.default_bridge&quot;: &quot;true&quot;,</span><br><span class="line">            &quot;com.docker.network.bridge.enable_icc&quot;: &quot;true&quot;,</span><br><span class="line">            &quot;com.docker.network.bridge.enable_ip_masquerade&quot;: &quot;true&quot;,</span><br><span class="line">            &quot;com.docker.network.bridge.host_binding_ipv4&quot;: &quot;0.0.0.0&quot;,</span><br><span class="line">            &quot;com.docker.network.bridge.name&quot;: &quot;docker0&quot;,</span><br><span class="line">            &quot;com.docker.network.driver.mtu&quot;: &quot;1500&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;Labels&quot;: &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®°æœ¬ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Docker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Dockerä½¿ç”¨rabbitmq</title>
      <link href="post/2495347071/"/>
      <url>post/2495347071/</url>
      
        <content type="html"><![CDATA[<h2 id="ä»€ä¹ˆæ˜¯RabbitMQï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯RabbitMQï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯RabbitMQï¼Ÿ"></a>ä»€ä¹ˆæ˜¯RabbitMQï¼Ÿ</h2><p>RabbitMQæ˜¯å¼€æºæ¶ˆæ¯ä»£ç†è½¯ä»¶ï¼ˆæœ‰æ—¶ç§°ä¸ºé¢å‘æ¶ˆæ¯çš„ä¸­é—´ä»¶ï¼‰ï¼Œå®ƒå®ç°äº†é«˜çº§æ¶ˆæ¯é˜Ÿåˆ—åè®®ï¼ˆAMQPï¼‰ã€‚RabbitMQæœåŠ¡å™¨é‡‡ç”¨Erlangç¼–ç¨‹è¯­è¨€ç¼–å†™ï¼Œæ„å»ºäºOpen Telecom Platformæ¡†æ¶ä¹‹ä¸Šï¼Œç”¨äºé›†ç¾¤å’Œæ•…éšœè½¬ç§»ã€‚ä¸ä»£ç†æ¥å£çš„å®¢æˆ·ç«¯åº“å¯ç”¨äºæ‰€æœ‰ä¸»è¦ç¼–ç¨‹è¯­è¨€ã€‚</p><h2 id="å¦‚ä½•åœ¨Dockerä½¿ç”¨RabbitMQé•œåƒ"><a href="#å¦‚ä½•åœ¨Dockerä½¿ç”¨RabbitMQé•œåƒ" class="headerlink" title="å¦‚ä½•åœ¨Dockerä½¿ç”¨RabbitMQé•œåƒ"></a>å¦‚ä½•åœ¨Dockerä½¿ç”¨RabbitMQé•œåƒ</h2><h3 id="è¿è¡Œå®ˆæŠ¤è¿›ç¨‹"><a href="#è¿è¡Œå®ˆæŠ¤è¿›ç¨‹" class="headerlink" title="è¿è¡Œå®ˆæŠ¤è¿›ç¨‹"></a>è¿è¡Œå®ˆæŠ¤è¿›ç¨‹</h3><p>å…³äºRabbitMQçš„ä¸€ä¸ªé‡è¦æ³¨æ„äº‹é¡¹æ˜¯å®ƒæ ¹æ®æ‰€è°“çš„â€œèŠ‚ç‚¹åç§°â€å­˜å‚¨æ•°æ®ï¼Œé»˜è®¤ä¸ºä¸»æœºåã€‚è¿™å¯¹äºåœ¨Dockerä¸­çš„ä½¿ç”¨æ„å‘³ç€æˆ‘ä»¬åº”è¯¥ä¸ºæ¯ä¸ªå®ˆæŠ¤è¿›ç¨‹æŒ‡å®š<code>-h</code>/ <code>--hostname</code>explicitï¼Œè¿™æ ·æˆ‘ä»¬å°±ä¸ä¼šè·å¾—éšæœºä¸»æœºåå¹¶ä¸”å¯ä»¥è·Ÿè¸ªæˆ‘ä»¬çš„æ•°æ®ï¼š</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> docker run -d --hostname my-rabbit --name some-rabbit rabbitmq:3</span></span><br></pre></td></tr></table></figure><p>è¿™å°†å¯åŠ¨ä¸€ä¸ªä¾¦å¬é»˜è®¤ç«¯å£5672çš„RabbitMQå®¹å™¨ã€‚å¦‚æœä½ ç»™å®ƒä¸€åˆ†é’Ÿï¼Œé‚£ä¹ˆ<code>docker logs some-rabbit</code>ä½ ä¼šåœ¨è¾“å‡ºä¸­çœ‹åˆ°ç±»ä¼¼äºçš„å—ï¼š</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">=INFO REPORT==== 6-Jul-2015::20:47:02 ===</span><br><span class="line">node           : rabbit@my-rabbit</span><br><span class="line">home dir       : /var/lib/rabbitmq</span><br><span class="line">config file(s) : /etc/rabbitmq/rabbitmq.config</span><br><span class="line">cookie hash    : UoNOcDhfxW9uoZ92wh6BjA==</span><br><span class="line">log            : tty</span><br><span class="line">sasl log       : tty</span><br><span class="line">database dir   : /var/lib/rabbitmq/mnesia/rabbit@my-rabbit</span><br></pre></td></tr></table></figure><p>è¯·æ³¨æ„<code>database dir</code>é‚£é‡Œï¼Œç‰¹åˆ«æ˜¯å®ƒçš„â€œèŠ‚ç‚¹åç§°â€é™„åŠ åˆ°æ–‡ä»¶å­˜å‚¨çš„æœ«å°¾ã€‚<code>/var/lib/rabbitmq</code>é»˜è®¤æƒ…å†µä¸‹ï¼Œæ­¤å›¾åƒä¼šç”Ÿæˆæ‰€æœ‰å·ã€‚</p><h3 id="å†…å­˜é™åˆ¶"><a href="#å†…å­˜é™åˆ¶" class="headerlink" title="å†…å­˜é™åˆ¶"></a>å†…å­˜é™åˆ¶</h3><p>RabbitMQåŒ…å«æ˜ç¡®è·Ÿè¸ªå’Œç®¡ç†å†…å­˜ä½¿ç”¨çš„åŠŸèƒ½ï¼Œå› æ­¤éœ€è¦äº†è§£cgroupå¼ºåŠ çš„é™åˆ¶ã€‚</p><p>ä¸Šæ¸¸é…ç½®è®¾ç½®ä¸º<code>vm_memory_high_watermark</code>ï¼Œæ–‡æ¡£ä¸­çš„<a href="https://www.rabbitmq.com/memory.html">â€œMemory Alarmsâ€</a>ä¸­å¯¹æ­¤è¿›è¡Œäº†æè¿°ã€‚</p><p>åœ¨æ­¤å›¾åƒä¸­ï¼Œæ­¤å€¼é€šè¿‡è®¾ç½®<code>RABBITMQ_VM_MEMORY_HIGH_WATERMARK</code>ã€‚æ­¤ç¯å¢ƒå˜é‡çš„å€¼è§£é‡Šå¦‚ä¸‹ï¼š</p><ul><li><code>0.49</code>è¢«è§†ä¸º<code>49%</code>ï¼Œå°±åƒä¸Šæ¸¸ï¼ˆ<code>&#123; vm_memory_high_watermark, 0.49 &#125;</code>ï¼‰</li><li><code>56%</code>è¢«è§†ä¸º<code>56%</code>ï¼ˆ<code>0.56</code>; <code>&#123; vm_memory_high_watermark, 0.56 &#125;</code>ï¼‰</li><li><code>1073741824</code>è¢«è§†ä¸ºç»å¯¹å­—èŠ‚æ•°ï¼ˆ<code>&#123; vm_memory_high_watermark, &#123; absolute, 1073741824 &#125; &#125;</code>ï¼‰</li><li><code>1024MiB</code>è¢«è§†ä¸ºå…·æœ‰unitï¼ˆ<code>&#123; vm_memory_high_watermark, &#123; absolute, &quot;1024MiB&quot; &#125; &#125;</code>ï¼‰çš„ç»å¯¹å­—èŠ‚æ•°</li></ul><p>ä¸»è¦çš„è¡Œä¸ºå·®å¼‚åœ¨äºå¦‚ä½•å¤„ç†ç™¾åˆ†æ¯”ã€‚å¦‚æœå½“å‰å®¹å™¨å…·æœ‰å†…å­˜é™åˆ¶ï¼ˆ<code>--memory</code>/ <code>-m</code>ï¼‰ï¼Œåˆ™å°†æ ¹æ®å†…å­˜é™åˆ¶å°†ç™¾åˆ†æ¯”å€¼è®¡ç®—ä¸ºç»å¯¹å­—èŠ‚å€¼ï¼Œè€Œä¸æ˜¯æŒ‰åŸæ ·ä¼ é€’ç»™RabbitMQã€‚ä¾‹å¦‚ï¼Œå¯¹äºä¸€ä¸ªå®¹å™¨è¿è¡Œ<code>--memory 2048m</code>ï¼ˆä»¥åŠéšå«çš„ä¸Šæ¸¸é»˜è®¤<code>RABBITMQ_VM_MEMORY_HIGH_WATERMARK</code>çš„<code>40%</code>ï¼‰å°†è®¾ç½®æœ‰æ•ˆé™åˆ¶<code>819MB</code>ï¼ˆè¿™æ˜¯<code>40%</code>çš„<code>2048MB</code>ï¼‰ã€‚</p><h3 id="ç®¡ç†æ’ä»¶"><a href="#ç®¡ç†æ’ä»¶" class="headerlink" title="ç®¡ç†æ’ä»¶"></a>ç®¡ç†æ’ä»¶</h3><p>é»˜è®¤æƒ…å†µä¸‹å®‰è£…å¹¶å¯ç”¨äº†<a href="https://www.rabbitmq.com/management.html">ç®¡ç†æ’ä»¶</a>æä¾›çš„ç¬¬äºŒç»„æ ‡ç­¾ï¼Œå¯åœ¨æ ‡å‡†ç®¡ç†ç«¯å£15672ä¸Šä½¿ç”¨ï¼Œé»˜è®¤ç”¨æˆ·åå’Œå¯†ç ä¸º<code>guest</code>/ <code>guest</code>ï¼š</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> docker run -d --hostname my-rabbit --name some-rabbit rabbitmq:3-management</span></span><br></pre></td></tr></table></figure><p>æ‚¨å¯ä»¥é€šè¿‡<code>http://container-ip:15672</code>æµè§ˆå™¨è®¿é—®å®ƒï¼Œæˆ–è€…å¦‚æœæ‚¨éœ€è¦åœ¨ä¸»æœºå¤–éƒ¨è®¿é—®ï¼Œè¯·è®¿é—®ç«¯å£8080ï¼š</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> docker run -d --hostname my-rabbit --name some-rabbit -p 8080:15672 \</span></span><br><span class="line"><span class="bash">rabbitmq:3-management</span></span><br></pre></td></tr></table></figure><p>ç„¶åï¼Œæ‚¨å¯ä»¥è½¬åˆ°<code>http://localhost:8080</code>æˆ–<code>http://host-ip:8080</code>åœ¨æµè§ˆå™¨ä¸­ã€‚</p><h3 id="ç¯å¢ƒå˜é‡"><a href="#ç¯å¢ƒå˜é‡" class="headerlink" title="ç¯å¢ƒå˜é‡"></a>ç¯å¢ƒå˜é‡</h3><p>Dockerfileä¸­å®šä¹‰äº†ä¸€å°éƒ¨åˆ†å¯èƒ½çš„ç¯å¢ƒå˜é‡ï¼Œè¿™äº›å˜é‡å°†é€šè¿‡dockerå¼•æ“ä¼ é€’ï¼ˆå¦‚ä¸‹æ‰€ç¤ºï¼‰ã€‚æœ‰å…³RabbitMQæœ¬èº«æ”¯æŒçš„ç¯å¢ƒå˜é‡åˆ—è¡¨ï¼Œè¯·å‚é˜…ï¼š<a href="https://www.rabbitmq.com/configure.html">https</a>ï¼š<a href="https://www.rabbitmq.com/configure.html">//www.rabbitmq.com/configure.html</a></p><p>å¯¹äºæ²¡æœ‰ç®¡ç†æ’ä»¶çš„SSLé…ç½®ï¼š</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">RABBITMQ_SSL_CACERTFILE</span><br><span class="line">RABBITMQ_SSL_CERTFILE</span><br><span class="line">RABBITMQ_SSL_DEPTH</span><br><span class="line">RABBITMQ_SSL_FAIL_IF_NO_PEER_CERT</span><br><span class="line">RABBITMQ_SSL_KEYFILE</span><br><span class="line">RABBITMQ_SSL_VERIFY</span><br></pre></td></tr></table></figure><p>å¯¹äºä½¿ç”¨ç®¡ç†æ’ä»¶çš„SSLé…ç½®ï¼š</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">RABBITMQ_MANAGEMENT_SSL_CACERTFILE</span><br><span class="line">RABBITMQ_MANAGEMENT_SSL_CERTFILE</span><br><span class="line">RABBITMQ_MANAGEMENT_SSL_DEPTH</span><br><span class="line">RABBITMQ_MANAGEMENT_SSL_FAIL_IF_NO_PEER_CERT</span><br><span class="line">RABBITMQ_MANAGEMENT_SSL_KEYFILE</span><br><span class="line">RABBITMQ_MANAGEMENT_SSL_VERIFY</span><br></pre></td></tr></table></figure><h3 id="è®¾ç½®é»˜è®¤ç”¨æˆ·å’Œå¯†ç "><a href="#è®¾ç½®é»˜è®¤ç”¨æˆ·å’Œå¯†ç " class="headerlink" title="è®¾ç½®é»˜è®¤ç”¨æˆ·å’Œå¯†ç "></a>è®¾ç½®é»˜è®¤ç”¨æˆ·å’Œå¯†ç </h3><p>å¦‚æœä½ æƒ³æ”¹å˜é»˜è®¤çš„ç”¨æˆ·åå’Œå¯†ç <code>guest</code>/ <code>guest</code>ï¼Œä½ å¯ä»¥ç”¨è¿™æ ·åš<code>RABBITMQ_DEFAULT_USER</code>å’Œ<code>RABBITMQ_DEFAULT_PASS</code>ç¯å¢ƒå˜é‡ï¼š</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> docker run -d --hostname my-rabbit --name some-rabbit \</span></span><br><span class="line"><span class="bash">-e RABBITMQ_DEFAULT_USER=user \</span></span><br><span class="line"><span class="bash">-e RABBITMQ_DEFAULT_PASS=password rabbitmq:3-management</span></span><br></pre></td></tr></table></figure><p>ç„¶åï¼Œæ‚¨å¯ä»¥è½¬åˆ°<code>http://localhost:8080</code>æˆ–<code>http://host-ip:8080</code>åœ¨æµè§ˆå™¨ä¸­ä½¿ç”¨<code>user</code>/ <code>password</code>æ¥è®¿é—®ç®¡ç†æ§åˆ¶å°</p><p>è¦ä»æ–‡ä»¶è€Œä¸æ˜¯ç¯å¢ƒå˜é‡ä¸­è·å–ç”¨æˆ·åå’Œå¯†ç <code>_FILE</code>ï¼Œè¯·åœ¨ç¯å¢ƒå˜é‡åç§°ä¸­æ·»åŠ åç¼€ï¼ˆä¾‹å¦‚ï¼Œ<code>RABBITMQ_DEFAULT_USER_FILE=/run/secrets/xxx</code>ä½¿ç”¨<a href="https://docs.docker.com/engine/swarm/secrets/">Docker Secrets</a>ï¼‰ã€‚</p><h3 id="è®¾ç½®é»˜è®¤vhost"><a href="#è®¾ç½®é»˜è®¤vhost" class="headerlink" title="è®¾ç½®é»˜è®¤vhost"></a>è®¾ç½®é»˜è®¤vhost</h3><p>å¦‚æœè¦æ›´æ”¹é»˜è®¤vhostï¼Œå¯ä»¥ä½¿ç”¨<code>RABBITMQ_DEFAULT_VHOST</code>ç¯å¢ƒå˜é‡ï¼š</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> docker run -d --hostname my-rabbit --name some-rabbit\ -e RABBITMQ_DEFAULT_VHOST=my_vhost rabbitmq:3-management</span></span><br></pre></td></tr></table></figure><h3 id="å¯ç”¨HiPE"><a href="#å¯ç”¨HiPE" class="headerlink" title="å¯ç”¨HiPE"></a>å¯ç”¨HiPE</h3><p>æœ‰å…³å„ç§é…ç½®é€‰é¡¹çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è§<a href="http://www.rabbitmq.com/configure.html#config-items">RabbitMQâ€œé…ç½®â€</a>ã€‚</p><p>è¦åœ¨å¯åŠ¨æ—¶å¯ç”¨HiPEç¼–è¯‘å™¨ï¼Œè¯·ä½¿ç”¨<code>RABBITMQ_HIPE_COMPILE</code>set to <code>1</code>ã€‚æ ¹æ®å®˜æ–¹æ–‡ä»¶ï¼š</p><blockquote><p>è®¾ç½®ä¸ºtrueä»¥ä½¿ç”¨HiPEé¢„ç¼–è¯‘RabbitMQçš„éƒ¨åˆ†ï¼ŒHiPEæ˜¯Erlangçš„å³æ—¶ç¼–è¯‘å™¨ã€‚è¿™å°†ä»¥å¢åŠ å¯åŠ¨æ—¶é—´ä¸ºä»£ä»·æ¥å¢åŠ æœåŠ¡å™¨ååé‡ã€‚æ‚¨å¯èƒ½ä¼šåœ¨å¯åŠ¨æ—¶å»¶è¿Ÿå‡ åˆ†é’Ÿåçœ‹åˆ°20-50ï¼…çš„æ€§èƒ½æå‡ã€‚</p></blockquote><p>å› æ­¤ï¼Œåœ¨é…ç½®è¿è¡ŒçŠ¶å†µæ£€æŸ¥ï¼Œè‡ªåŠ¨ç¾¤é›†ç­‰æ—¶è€ƒè™‘å¯åŠ¨å»¶è¿Ÿéå¸¸é‡è¦ã€‚</p><h3 id="å¯ç”¨æ’ä»¶"><a href="#å¯ç”¨æ’ä»¶" class="headerlink" title="å¯ç”¨æ’ä»¶"></a>å¯ç”¨æ’ä»¶</h3><p>ä¾‹ <code>enabled_plugins</code></p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[rabbitmq_federation_management,rabbitmq_management,rabbitmq_mqtt,rabbitmq_stomp].</span><br></pre></td></tr></table></figure><h3 id="é™„åŠ é…ç½®"><a href="#é™„åŠ é…ç½®" class="headerlink" title="é™„åŠ é…ç½®"></a>é™„åŠ é…ç½®</h3><p>å¦‚æœéœ€è¦å…¶ä»–é…ç½®ï¼Œå»ºè®®æä¾›é€‚å½“çš„<code>/etc/rabbitmq/rabbitmq.conf</code>æ–‡ä»¶ï¼ˆ<a href="https://www.rabbitmq.com/configure.html#configuration-files">æœ‰å…³è¯¦ç»†ä¿¡æ¯</a>ï¼Œè¯·å‚é˜…<a href="https://www.rabbitmq.com/configure.html#configuration-files">RabbitMQæ–‡æ¡£çš„â€œé…ç½®æ–‡ä»¶â€éƒ¨åˆ†</a>ï¼‰ï¼Œä¾‹å¦‚é€šè¿‡bind-mountï¼Œ<a href="https://docs.docker.com/engine/swarm/configs/">Docker Configs</a>æˆ–<code>Dockerfile</code>å¸¦æœ‰<code>COPY</code>æŒ‡ä»¤çš„short ã€‚</p><p>æˆ–è€…ï¼Œå¯ä»¥ä½¿ç”¨<code>RABBITMQ_SERVER_ADDITIONAL_ERL_ARGS</code>ç¯å¢ƒå˜é‡ï¼Œå…¶è¯­æ³•<a href="http://erlang.org/doc/design_principles/applications.html#id81887">åœ¨Erlang OTPè®¾è®¡åŸåˆ™ç”¨æˆ·æŒ‡å—çš„7.8èŠ‚ï¼ˆâ€œé…ç½®åº”ç”¨ç¨‹åºâ€ï¼‰ä¸­</a>æè¿°<a href="http://erlang.org/doc/design_principles/applications.html#id81887">ï¼ˆ</a><code>-ApplName</code> is çš„é€‚å½“å€¼<code>-rabbit</code>ï¼‰ï¼Œæ­¤æ–¹æ³•éœ€è¦ç¨å¾®ä¸åŒçš„å†ç°ç›¸å½“äº<code>rabbitmq.conf</code>ã€‚ä¾‹å¦‚ï¼Œé…ç½®<a href="https://www.rabbitmq.com/configure.html#config-items"><code>channel_max</code></a>çœ‹èµ·æ¥åƒ<code>-e RABBITMQ_SERVER_ADDITIONAL_ERL_ARGS=&quot;-rabbit channel_max 4007&quot;</code>ã€‚å˜é‡<code>channel_max</code>ä¸å…¶å€¼ä¹‹é—´çš„ç©ºé—´åœ¨<code>4007</code>ç¯å¢ƒä¸­ç¿»è¯‘æ—¶æ­£ç¡®å˜ä¸ºé€—å·çš„ä½ç½®ã€‚</p><p>å…¶ä»–é…ç½®é”®å°†è¢«æŒ‡å®šä¸ºåˆ—è¡¨ã€‚ä¾‹å¦‚ï¼Œé…ç½®ä¸¤è€…<a href="https://www.rabbitmq.com/configure.html#config-items"><code>channel_max</code></a>å¹¶<a href="https://www.rabbitmq.com/ldap.html#overview"><code>auth_backends</code></a>çœ‹èµ·æ¥åƒ<code>-e RABBITMQ_SERVER_ADDITIONAL_ERL_ARGS=&quot;-rabbit channel_max 4007 auth_backends [rabbit_auth_backend_ldap,rabbit_auth_backend_internal]&quot;</code>ã€‚è¯·æ³¨æ„ï¼ŒæŸäº›å˜é‡ï¼ˆä¾‹å¦‚forï¼‰<code>auth_backends</code>è¦æ±‚å°†å…¶å€¼æ‹¬åœ¨æ‹¬å·ä¸­ï¼Œå¹¶å°†å¤šä¸ªå€¼æ˜ç¡®åœ°åŒ…æ‹¬åœ¨é€—å·ä¸­ä½œä¸ºåˆ†éš”ç¬¦ã€‚</p><h2 id="è¿æ¥åˆ°å®ˆæŠ¤è¿›ç¨‹"><a href="#è¿æ¥åˆ°å®ˆæŠ¤è¿›ç¨‹" class="headerlink" title="è¿æ¥åˆ°å®ˆæŠ¤è¿›ç¨‹"></a>è¿æ¥åˆ°å®ˆæŠ¤è¿›ç¨‹</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> docker run --name some-app --link some-rabbit:rabbit \</span></span><br><span class="line"><span class="bash">-d application-that-uses-rabbitmq</span></span><br></pre></td></tr></table></figure><h2 id="spring-cloud-busä¸­ä½¿ç”¨"><a href="#spring-cloud-busä¸­ä½¿ç”¨" class="headerlink" title="spring cloud busä¸­ä½¿ç”¨"></a>spring cloud busä¸­ä½¿ç”¨</h2><h3 id="æ‹‰å–rabbitmqé•œåƒ"><a href="#æ‹‰å–rabbitmqé•œåƒ" class="headerlink" title="æ‹‰å–rabbitmqé•œåƒ"></a>æ‹‰å–rabbitmqé•œåƒ</h3><p>æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œæ‹‰å–<code>latest</code>ç‰ˆå®˜æ–¹é•œåƒï¼š</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker pull rabbitmq:management</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨å¸¦ç®¡ç†ç•Œé¢çš„é•œåƒã€‚</p><p><img src="https://github.com/cayzlh/git-img-repository/raw/master/blog/2019/01/01/2.png" alt="docker-rabbitmq"></p><h3 id="ä½¿ç”¨é•œåƒ"><a href="#ä½¿ç”¨é•œåƒ" class="headerlink" title="ä½¿ç”¨é•œåƒ"></a>ä½¿ç”¨é•œåƒ</h3><p>æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œä½¿ç”¨é•œåƒï¼š</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker run -d --name rabbitmq --publish 5671:5671 \</span><br><span class="line"> --publish 5672:5672 --publish 4369:4369 \</span><br><span class="line"> --publish 25672:25672 --publish 15671:15671 --publish 15672:15672 \</span><br><span class="line">rabbitmq:management</span><br></pre></td></tr></table></figure><p>å¯åŠ¨ä¹‹åè®¿é—®<a href="http://localhost:15672/">http://localhost:15672/</a>èƒ½å¤Ÿçœ‹åˆ°<code>Web</code>ç®¡ç†ç•Œé¢ï¼Œä½¿ç”¨<strong>guest / guest</strong>ç™»å½•ä¹‹åçœ‹åˆ°å¦‚ä¸‹ç•Œé¢ï¼Œè¯´æ˜é•œåƒå·²ç»è¿è¡Œã€‚</p><p><img src="https://github.com/cayzlh/git-img-repository/raw/master/blog/2019/01/01/3.png" alt="docker-rabbitmq"></p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul><li><a href="https://hub.docker.com/_/rabbitmq">rabbitmq</a></li><li><a href="https://blog.cayzlh.com/2019/01/01/2019010101/">https://blog.cayzlh.com/2019/01/01/2019010101/</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®°æœ¬ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Docker </tag>
            
            <tag> rabbitmq </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>easyexcelåœ¨Safariæµè§ˆå™¨å¯¼å‡ºæ–‡ä»¶æ ¼å¼æœ‰é—®é¢˜</title>
      <link href="post/3864213278/"/>
      <url>post/3864213278/</url>
      
        <content type="html"><![CDATA[<blockquote><p><strong>JAVAè§£æExcelå·¥å…·easyexcel</strong></p><p>Javaè§£æã€ç”ŸæˆExcelæ¯”è¾ƒæœ‰åçš„æ¡†æ¶æœ‰Apache poiã€jxlã€‚ä½†ä»–ä»¬éƒ½å­˜åœ¨ä¸€ä¸ªä¸¥é‡çš„é—®é¢˜å°±æ˜¯éå¸¸çš„è€—å†…å­˜ï¼Œpoiæœ‰ä¸€å¥—SAXæ¨¡å¼çš„APIå¯ä»¥ä¸€å®šç¨‹åº¦çš„è§£å†³ä¸€äº›å†…å­˜æº¢å‡ºçš„é—®é¢˜ï¼Œä½†POIè¿˜æ˜¯æœ‰ä¸€äº›ç¼ºé™·ï¼Œæ¯”å¦‚07ç‰ˆExcelè§£å‹ç¼©ä»¥åŠè§£å‹åå­˜å‚¨éƒ½æ˜¯åœ¨å†…å­˜ä¸­å®Œæˆçš„ï¼Œå†…å­˜æ¶ˆè€—ä¾ç„¶å¾ˆå¤§ã€‚easyexcelé‡å†™äº†poiå¯¹07ç‰ˆExcelçš„è§£æï¼Œèƒ½å¤ŸåŸæœ¬ä¸€ä¸ª3Mçš„excelç”¨POI saxä¾ç„¶éœ€è¦100Må·¦å³å†…å­˜é™ä½åˆ°KBçº§åˆ«ï¼Œå¹¶ä¸”å†å¤§çš„excelä¸ä¼šå‡ºç°å†…å­˜æº¢å‡ºï¼Œ03ç‰ˆä¾èµ–POIçš„saxæ¨¡å¼ã€‚åœ¨ä¸Šå±‚åšäº†æ¨¡å‹è½¬æ¢çš„å°è£…ï¼Œè®©ä½¿ç”¨è€…æ›´åŠ ç®€å•æ–¹ä¾¿ã€‚</p></blockquote><h2 id="å°å‘"><a href="#å°å‘" class="headerlink" title="å°å‘"></a>å°å‘</h2><p>æœ€è¿‘åœ¨ä½¿ç”¨easyexcelçš„æ—¶å€™ï¼Œç¢°åˆ°ä¸€ä¸ªå°å‘ï¼š</p><p>åœ¨ä½¿ç”¨<code>Safari</code>æµè§ˆå™¨è¿›è¡Œå¯¼å‡ºçš„æ—¶å€™ï¼Œå¯¼å‡ºçš„æ–‡ä»¶ä¼šè‡ªåŠ¨å¢åŠ ä¸€ä¸ª<code>.xlw</code>åç¼€ï¼Œå¾ˆçƒ¦ã€‚ã€‚</p><p>åæ¥é€šè¿‡æœç´¢è§£å†³äº†é—®é¢˜ï¼Œåœ¨è¿™é‡Œè®°å½•ä¸€æ³¢ã€‚</p><p>å°†åŸæ¥çš„ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">response.setContentType(<span class="string">&quot;application/vnd.ms-excel&quot;</span>);</span><br></pre></td></tr></table></figure><p>æ”¹æˆï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">response.setContentType(</span><br><span class="line">    <span class="string">&quot;application/vnd.openxmlformats-officedocument.spreadsheetml.sheet&quot;</span>);</span><br></pre></td></tr></table></figure><p>ç„¶åæ‰€æœ‰æµè§ˆå™¨éƒ½æ²¡æœ‰é—®é¢˜äº†ã€‚</p><h2 id="å·¥å…·ç±»"><a href="#å·¥å…·ç±»" class="headerlink" title="å·¥å…·ç±»"></a>å·¥å…·ç±»</h2><p>è´´ä¸€ä¸‹easyexcelå¯¼å‡ºçš„å·¥å…·ç±»ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ExcelUtil</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Logger logger = LoggerFactory.getLogger(ExcelUtil.class);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å¯¼å‡º</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> list å¯¼å‡ºæ•°æ®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> excelName excelåç§°</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> response response</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> clazz clazz</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">export</span><span class="params">(List&lt;? extends BaseRowModel&gt; list, </span></span></span><br><span class="line"><span class="function"><span class="params">            String excelName, HttpServletResponse response,</span></span></span><br><span class="line"><span class="function"><span class="params">            Class&lt;? extends BaseRowModel&gt; clazz)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        ServletOutputStream out = <span class="keyword">null</span>;</span><br><span class="line">        ExcelWriter writer = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            out = response.getOutputStream();</span><br><span class="line">            writer = <span class="keyword">new</span> ExcelWriter(out, ExcelTypeEnum.XLSX, <span class="keyword">true</span>);</span><br><span class="line">            String fileName = excelName + </span><br><span class="line">                <span class="keyword">new</span> SimpleDateFormat(<span class="string">&quot;yyyy-MM-dd&quot;</span>).format(<span class="keyword">new</span> Date());</span><br><span class="line"></span><br><span class="line">            Sheet sheet2 = <span class="keyword">new</span> Sheet(<span class="number">2</span>, <span class="number">3</span>, clazz, <span class="string">&quot;sheet&quot;</span>, <span class="keyword">null</span>);</span><br><span class="line">            writer.write(list, sheet2);</span><br><span class="line">            response.setCharacterEncoding(<span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line"><span class="comment">//            response.setContentType(&quot;application/vnd.ms-excel&quot;);</span></span><br><span class="line">            response.setContentType(</span><br><span class="line">            <span class="string">&quot;application/vnd.openxmlformats-officedocument.spreadsheetml.sheet&quot;</span>);</span><br><span class="line"></span><br><span class="line">            setFileDownloadHeader(response, fileName);</span><br><span class="line"></span><br><span class="line">            out.flush();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">null</span> != writer) &#123;</span><br><span class="line">                writer.finish();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">null</span> != out) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    out.flush();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                    logger.error(<span class="string">&quot;excelå¯¼å‡ºå‡ºé”™&quot;</span>, e);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">setFileDownloadHeader</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">        HttpServletResponse response, String filename)</span> </span>&#123;</span><br><span class="line">        String headerValue = <span class="string">&quot;attachment;&quot;</span>;</span><br><span class="line">        headerValue += <span class="string">&quot; filename=\&quot;&quot;</span> </span><br><span class="line">            + encodeURIComponent(filename) + <span class="string">&quot;\&quot;;&quot;</span>;</span><br><span class="line">        headerValue += <span class="string">&quot; filename*=utf-8&#x27;&#x27;&quot;</span> </span><br><span class="line">            + encodeURIComponent(filename + <span class="string">&quot;.xlsx&quot;</span>);</span><br><span class="line">        response.setHeader(<span class="string">&quot;Content-Disposition&quot;</span>, headerValue);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> String <span class="title">encodeURIComponent</span><span class="params">(String value)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> URLEncoder.encode(value, <span class="string">&quot;UTF-8&quot;</span>)</span><br><span class="line">                .replaceAll(<span class="string">&quot;\\+&quot;</span>, <span class="string">&quot;%20&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (UnsupportedEncodingException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®°æœ¬ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> easyexcel </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¾®æœåŠ¡çš„ä¼˜ç¼ºç‚¹</title>
      <link href="post/ded3e7ee/"/>
      <url>post/ded3e7ee/</url>
      
        <content type="html"><![CDATA[<blockquote><p>æœ¬æ–‡æ¥è‡ªNginxå®˜æ–¹åšå®¢ï¼Œæ˜¯å¾®æœåŠ¡ç³»åˆ—æ–‡ç« çš„ç¬¬ä¸€ç¯‡ï¼Œä¸»è¦æ¢è®¨äº†ä¼ ç»Ÿçš„å•ä½“å¼åº”ç”¨çš„ä¸è¶³ï¼Œä»¥åŠå¾®æœåŠ¡æ¶æ„çš„ä¼˜åŠ¿ä¸æŒ‘æˆ˜ã€‚æ­£å¦‚ä½œè€…æ‰€è¯´ï¼Œå¾®æœåŠ¡æ¶æ„æ›´é€‚åˆç”¨äºæ„å»ºå¤æ‚çš„åº”ç”¨ï¼Œå°½ç®¡å®ƒä¹Ÿæœ‰è‡ªå·±çš„ä¸è¶³ã€‚</p><p>è½¬è‡ªï¼š<a href="http://dockone.io/article/394">å¾®æœåŠ¡å®æˆ˜ï¼ˆä¸€ï¼‰ï¼šå¾®æœåŠ¡æ¶æ„çš„ä¼˜åŠ¿ä¸ä¸è¶³</a></p></blockquote><h2 id="å•ä½“å¼åº”ç”¨çš„ä¸è¶³"><a href="#å•ä½“å¼åº”ç”¨çš„ä¸è¶³" class="headerlink" title="å•ä½“å¼åº”ç”¨çš„ä¸è¶³"></a>å•ä½“å¼åº”ç”¨çš„ä¸è¶³</h2><p>å•ä½“å¼åº”ç”¨å¼€å‘ç®€å•å´æœ‰å¾ˆå¤§çš„å±€é™æ€§ã€‚ä¸€ä¸ªç®€å•çš„åº”ç”¨ä¼šéšç€æ—¶é—´æ¨ç§»é€æ¸å˜å¤§ã€‚åœ¨æ¯æ¬¡çš„<strong>sprint</strong>ä¸­ï¼Œå¼€å‘å›¢é˜Ÿéƒ½ä¼šé¢å¯¹æ–°â€œæ•…äº‹â€ï¼Œç„¶åå¼€å‘è®¸å¤šæ–°ä»£ç ã€‚å‡ å¹´åï¼Œè¿™ä¸ªå°è€Œç®€å•çš„åº”ç”¨ä¼šå˜æˆäº†ä¸€ä¸ªå·¨å¤§çš„æ€ªç‰©ã€‚</p><p>ä¸€æ—¦ä½ çš„åº”ç”¨å˜æˆä¸€ä¸ªåˆå¤§åˆå¤æ‚çš„æ€ªç‰©ï¼Œé‚£å¼€å‘å›¢é˜Ÿè‚¯å®šå¾ˆç—›è‹¦ã€‚æ•æ·å¼€å‘å’Œéƒ¨ç½²ä¸¾æ­¥ç»´è‰°ï¼Œå…¶ä¸­æœ€ä¸»è¦é—®é¢˜å°±æ˜¯è¿™ä¸ªåº”ç”¨å¤ªå¤æ‚ï¼Œä»¥è‡³äºä»»ä½•å•ä¸ªå¼€å‘è€…éƒ½ä¸å¯èƒ½ææ‡‚å®ƒã€‚å› æ­¤ï¼Œä¿®æ­£bugå’Œæ­£ç¡®çš„æ·»åŠ æ–°åŠŸèƒ½å˜çš„éå¸¸å›°éš¾ï¼Œå¹¶ä¸”å¾ˆè€—æ—¶ã€‚å¦å¤–ï¼Œå›¢é˜Ÿå£«æ°”ä¹Ÿä¼šèµ°ä¸‹å¡è·¯ã€‚å¦‚æœä»£ç éš¾äºç†è§£ï¼Œå°±ä¸å¯èƒ½è¢«æ­£ç¡®çš„ä¿®æ”¹ã€‚æœ€ç»ˆä¼šèµ°å‘å·¨å¤§çš„ã€ä¸å¯ç†è§£çš„æ³¥æ½­ã€‚</p><p>å•ä½“å¼åº”ç”¨ä¹Ÿä¼šé™ä½å¼€å‘é€Ÿåº¦ã€‚åº”ç”¨è¶Šå¤§ï¼Œå¯åŠ¨æ—¶é—´ä¼šè¶Šé•¿ã€‚æ¯”å¦‚ï¼Œæœ€è¿‘çš„ä¸€ä¸ªè°ƒæŸ¥è¡¨æ˜ï¼Œæœ‰æ—¶å€™åº”ç”¨çš„å¯åŠ¨æ—¶é—´å±…ç„¶è¶…è¿‡äº†12åˆ†é’Ÿã€‚æˆ‘è¿˜å¬è¯´æŸäº›åº”ç”¨éœ€è¦40åˆ†é’Ÿå¯åŠ¨æ—¶é—´ã€‚å¦‚æœå¼€å‘è€…éœ€è¦ç»å¸¸é‡å¯åº”ç”¨ï¼Œé‚£ä¹ˆå¤§éƒ¨åˆ†æ—¶é—´å°±è¦åœ¨ç­‰å¾…ä¸­æ¸¡è¿‡ï¼Œç”Ÿäº§æ•ˆç‡å—åˆ°æå¤§å½±å“ã€‚</p><p>å¦å¤–ï¼Œå¤æ‚è€Œå·¨å¤§çš„å•ä½“å¼åº”ç”¨ä¹Ÿä¸åˆ©äºæŒç»­æ€§å¼€å‘ã€‚ä»Šå¤©ï¼ŒSaaSåº”ç”¨å¸¸æ€å°±æ˜¯æ¯å¤©ä¼šæ”¹å˜å¾ˆå¤šæ¬¡ï¼Œè€Œè¿™å¯¹äºå•ä½“å¼åº”ç”¨æ¨¡å¼éå¸¸å›°éš¾ã€‚å¦å¤–ï¼Œè¿™ç§å˜åŒ–å¸¦æ¥çš„å½±å“å¹¶æ²¡æœ‰å¾ˆå¥½çš„è¢«ç†è§£ï¼Œæ‰€ä»¥ä¸å¾—ä¸åšå¾ˆå¤šæ‰‹å·¥æµ‹è¯•ã€‚é‚£ä¹ˆæ¥ä¸‹æ¥ï¼ŒæŒç»­éƒ¨ç½²ä¹Ÿä¼šå¾ˆè‰°éš¾ã€‚</p><p>å•ä½“å¼åº”ç”¨åœ¨ä¸åŒæ¨¡å—å‘ç”Ÿèµ„æºå†²çªæ—¶ï¼Œæ‰©å±•å°†ä¼šéå¸¸å›°éš¾ã€‚æ¯”å¦‚ï¼Œä¸€ä¸ªæ¨¡å—å®Œæˆä¸€ä¸ªCPUæ•æ„Ÿé€»è¾‘ï¼Œåº”è¯¥éƒ¨ç½²åœ¨AWS EC2 Compute Optimized instancesï¼Œè€Œå¦å¤–ä¸€ä¸ªå†…å­˜æ•°æ®åº“æ¨¡å—æ›´åˆé€‚äºEC2 Memory-optimized instancesã€‚ç„¶è€Œï¼Œç”±äºè¿™äº›æ¨¡å—éƒ¨ç½²åœ¨ä¸€èµ·ï¼Œå› æ­¤ä¸å¾—ä¸åœ¨ç¡¬ä»¶é€‰æ‹©ä¸Šåšä¸€ä¸ªå¦¥åã€‚</p><p>å•ä½“å¼åº”ç”¨å¦å¤–ä¸€ä¸ªé—®é¢˜æ˜¯å¯é æ€§ã€‚å› ä¸ºæ‰€æœ‰æ¨¡å—éƒ½è¿è¡Œåœ¨ä¸€ä¸ªè¿›ç¨‹ä¸­ï¼Œä»»ä½•ä¸€ä¸ªæ¨¡å—ä¸­çš„ä¸€ä¸ªbugï¼Œæ¯”å¦‚å†…å­˜æ³„éœ²ï¼Œå°†ä¼šæœ‰å¯èƒ½å¼„å®æ•´ä¸ªè¿›ç¨‹ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œå› ä¸ºæ‰€æœ‰åº”ç”¨å®ä¾‹éƒ½æ˜¯å”¯ä¸€çš„ï¼Œè¿™ä¸ªbugå°†ä¼šå½±å“åˆ°æ•´ä¸ªåº”ç”¨çš„å¯é æ€§ã€‚</p><p>æœ€åï¼Œå•ä½“å¼åº”ç”¨ä½¿å¾—é‡‡ç”¨æ–°æ¶æ„å’Œè¯­è¨€éå¸¸å›°éš¾ã€‚æ¯”å¦‚ï¼Œè®¾æƒ³ä½ æœ‰ä¸¤ç™¾ä¸‡è¡Œé‡‡ç”¨XYZæ¡†æ¶å†™çš„ä»£ç ã€‚å¦‚æœæƒ³æ”¹æˆABCæ¡†æ¶ï¼Œæ— è®ºæ˜¯æ—¶é—´è¿˜æ˜¯æˆæœ¬éƒ½æ˜¯éå¸¸æ˜‚è´µçš„ï¼Œå³ä½¿ABCæ¡†æ¶æ›´å¥½ã€‚å› æ­¤ï¼Œè¿™æ˜¯ä¸€ä¸ªæ— æ³•é€¾è¶Šçš„é¸¿æ²Ÿã€‚ä½ ä¸å¾—ä¸åœ¨æœ€åˆé€‰æ‹©é¢å‰ä½å¤´ã€‚</p><p><strong>æ€»ç»“ä¸€ä¸‹ï¼š</strong>ä¸€å¼€å§‹ä½ æœ‰ä¸€ä¸ªå¾ˆæˆåŠŸçš„å…³é”®ä¸šåŠ¡åº”ç”¨ï¼Œåæ¥å°±å˜æˆäº†ä¸€ä¸ªå·¨å¤§çš„ï¼Œæ— æ³•ç†è§£çš„æ€ªç‰©ã€‚å› ä¸ºé‡‡ç”¨è¿‡æ—¶çš„ï¼Œæ•ˆç‡ä½çš„æŠ€æœ¯ï¼Œä½¿å¾—é›‡ä½£æœ‰æ½œåŠ›çš„å¼€å‘è€…å¾ˆå›°éš¾ã€‚åº”ç”¨æ— æ³•æ‰©å±•ï¼Œå¯é æ€§å¾ˆä½ï¼Œæœ€ç»ˆï¼Œæ•æ·æ€§å¼€å‘å’Œéƒ¨ç½²å˜çš„æ— æ³•å®Œæˆã€‚</p><h2 id="å¾®å¤„ç†æ¶æ„â€”â€”å¤„ç†å¤æ‚äº‹ç‰©"><a href="#å¾®å¤„ç†æ¶æ„â€”â€”å¤„ç†å¤æ‚äº‹ç‰©" class="headerlink" title="å¾®å¤„ç†æ¶æ„â€”â€”å¤„ç†å¤æ‚äº‹ç‰©"></a>å¾®å¤„ç†æ¶æ„â€”â€”å¤„ç†å¤æ‚äº‹ç‰©</h2><p>è®¸å¤šå…¬å¸ï¼Œæ¯”å¦‚Amazonã€eBayå’ŒNetFlixï¼Œé€šè¿‡é‡‡ç”¨å¾®å¤„ç†ç»“æ„æ¨¡å¼è§£å†³äº†ä¸Šè¿°é—®é¢˜ã€‚å…¶æ€è·¯ä¸æ˜¯å¼€å‘ä¸€ä¸ªå·¨å¤§çš„å•ä½“å¼çš„åº”ç”¨ï¼Œè€Œæ˜¯å°†åº”ç”¨åˆ†è§£ä¸ºå°çš„ã€äº’ç›¸è¿æ¥çš„å¾®æœåŠ¡ã€‚</p><p>ä¸€ä¸ªå¾®æœåŠ¡ä¸€èˆ¬å®ŒæˆæŸä¸ªç‰¹å®šçš„åŠŸèƒ½ï¼Œæ¯”å¦‚ä¸‹å•ç®¡ç†ã€å®¢æˆ·ç®¡ç†ç­‰ç­‰ã€‚æ¯ä¸€ä¸ªå¾®æœåŠ¡éƒ½æ˜¯å¾®å‹å…­è§’å½¢åº”ç”¨ï¼Œéƒ½æœ‰è‡ªå·±çš„ä¸šåŠ¡é€»è¾‘å’Œé€‚é…å™¨ã€‚ä¸€äº›å¾®æœåŠ¡è¿˜ä¼šå‘å¸ƒAPIç»™å…¶å®ƒå¾®æœåŠ¡å’Œåº”ç”¨å®¢æˆ·ç«¯ä½¿ç”¨ã€‚å…¶å®ƒå¾®æœåŠ¡å®Œæˆä¸€ä¸ªWeb UIï¼Œè¿è¡Œæ—¶ï¼Œæ¯ä¸€ä¸ªå®ä¾‹å¯èƒ½æ˜¯ä¸€ä¸ªäº‘VMæˆ–è€…æ˜¯Dockerå®¹å™¨ã€‚</p><p><img src="https://github.com/cayzlh/git-img-repository/raw/master/blog/2018/12/15/1.png"></p><p>å¾®æœåŠ¡æ¶æ„æ¨¡å¼åœ¨ä¸Šå›¾ä¸­å¯¹åº”äºä»£è¡¨å¯æ‰©å±•Scale Cubeçš„Yè½´ï¼Œè¿™æ˜¯ä¸€ä¸ªåœ¨ã€ŠThe Art of Scalabilityã€‹ä¹¦ä¸­æè¿°è¿‡çš„ä¸‰ç»´æ‰©å±•æ¨¡å‹ã€‚å¦å¤–ä¸¤ä¸ªå¯æ‰©å±•è½´ï¼ŒXè½´ç”±è´Ÿè½½å‡è¡¡å™¨åç«¯è¿è¡Œçš„å¤šä¸ªåº”ç”¨å‰¯æœ¬ç»„æˆï¼ŒZè½´æ˜¯å°†éœ€æ±‚è·¯ç”±åˆ°ç›¸å…³æœåŠ¡ã€‚</p><p>åº”ç”¨åŸºæœ¬å¯ä»¥ç”¨ä»¥ä¸Šä¸‰ä¸ªç»´åº¦æ¥è¡¨ç¤ºï¼ŒYè½´ä»£è¡¨å°†åº”ç”¨åˆ†è§£ä¸ºå¾®æœåŠ¡ã€‚è¿è¡Œæ—¶ï¼ŒXè½´ä»£è¡¨è¿è¡Œå¤šä¸ªéšè—åœ¨è´Ÿè½½å‡è¡¡å™¨ä¹‹åçš„å®ä¾‹ï¼Œæä¾›ååèƒ½åŠ›ã€‚ä¸€äº›åº”ç”¨å¯èƒ½è¿˜æ˜¯ç”¨Zè½´å°†æœåŠ¡åˆ†åŒºã€‚ä¸‹é¢çš„å›¾æ¼”ç¤ºè¡Œç¨‹ç®¡ç†æœåŠ¡å¦‚ä½•éƒ¨ç½²åœ¨è¿è¡ŒäºAWS EC2ä¸Šçš„Dockerä¸Šã€‚</p><p><img src="https://github.com/cayzlh/git-img-repository/raw/master/blog/2018/12/15/2.png"></p><p>è¿è¡Œæ—¶ï¼Œè¡Œç¨‹ç®¡ç†æœåŠ¡ç”±å¤šä¸ªæœåŠ¡å®ä¾‹æ„æˆã€‚æ¯ä¸€ä¸ªæœåŠ¡å®ä¾‹éƒ½æ˜¯ä¸€ä¸ªDockerå®¹å™¨ã€‚ä¸ºäº†ä¿è¯é«˜å¯ç”¨ï¼Œè¿™äº›å®¹å™¨ä¸€èˆ¬éƒ½è¿è¡Œåœ¨å¤šä¸ªäº‘VMä¸Šã€‚æœåŠ¡å®ä¾‹å‰æ˜¯ä¸€å±‚è¯¸å¦‚NGINXçš„è´Ÿè½½å‡è¡¡å™¨ï¼Œä»–ä»¬è´Ÿè´£åœ¨å„ä¸ªå®ä¾‹é—´åˆ†å‘è¯·æ±‚ã€‚è´Ÿè½½å‡è¡¡å™¨ä¹ŸåŒæ—¶å¤„ç†å…¶å®ƒè¯·æ±‚ï¼Œä¾‹å¦‚ç¼“å­˜ã€æƒé™æ§åˆ¶ã€APIç»Ÿè®¡å’Œç›‘æ§ã€‚</p><p>è¿™ç§å¾®æœåŠ¡æ¶æ„æ¨¡å¼æ·±åˆ»å½±å“äº†åº”ç”¨å’Œæ•°æ®åº“ä¹‹é—´çš„å…³ç³»ï¼Œ<strong>ä¸åƒä¼ ç»Ÿå¤šä¸ªæœåŠ¡å…±äº«ä¸€ä¸ªæ•°æ®åº“ï¼Œå¾®æœåŠ¡æ¶æ„æ¯ä¸ªæœåŠ¡éƒ½æœ‰è‡ªå·±çš„æ•°æ®åº“</strong>ã€‚å¦å¤–ï¼Œè¿™ç§æ€è·¯ä¹Ÿå½±å“åˆ°äº†ä¼ä¸šçº§æ•°æ®æ¨¡å¼ã€‚åŒæ—¶ï¼Œè¿™ç§æ¨¡å¼æ„å‘³ç€å¤šä»½æ•°æ®ï¼Œä½†æ˜¯ï¼Œå¦‚æœä½ æƒ³è·å¾—å¾®æœåŠ¡å¸¦æ¥çš„å¥½å¤„ï¼Œæ¯ä¸ªæœåŠ¡ç‹¬æœ‰ä¸€ä¸ªæ•°æ®åº“æ˜¯å¿…é¡»çš„ï¼Œå› ä¸ºè¿™ç§æ¶æ„éœ€è¦è¿™ç§æ¾è€¦åˆã€‚ä¸‹é¢çš„å›¾æ¼”ç¤ºç¤ºä¾‹åº”ç”¨æ•°æ®åº“æ¶æ„ã€‚</p><p><img src="https://github.com/cayzlh/git-img-repository/raw/master/blog/2018/12/15/3.png"></p><p>æ¯ç§æœåŠ¡éƒ½æœ‰è‡ªå·±çš„æ•°æ®åº“ï¼Œå¦å¤–ï¼Œæ¯ç§æœåŠ¡å¯ä»¥ç”¨æ›´é€‚åˆè‡ªå·±çš„æ•°æ®åº“ç±»å‹ï¼Œä¹Ÿè¢«ç§°ä½œå¤šè¯­è¨€ä¸€è‡´æ€§æ¶æ„ã€‚æ¯”å¦‚ï¼Œé©¾é©¶å‘˜ç®¡ç†ï¼ˆå‘ç°å“ªä¸ªé©¾é©¶å‘˜æ›´é è¿‘ä¹˜å®¢ï¼‰ï¼Œå¿…é¡»ä½¿ç”¨æ”¯æŒåœ°ç†ä¿¡æ¯æŸ¥è¯¢çš„æ•°æ®åº“ã€‚</p><p>è¡¨é¢ä¸Šçœ‹æ¥ï¼Œå¾®æœåŠ¡æ¶æ„æ¨¡å¼æœ‰ç‚¹åƒSOAï¼Œä»–ä»¬éƒ½ç”±å¤šä¸ªæœåŠ¡æ„æˆã€‚ä½†æ˜¯ï¼Œå¯ä»¥ä»å¦å¤–ä¸€ä¸ªè§’åº¦çœ‹æ­¤é—®é¢˜ï¼Œå¾®æœåŠ¡æ¶æ„æ¨¡å¼æ˜¯ä¸€ä¸ªä¸åŒ…å«WebæœåŠ¡ï¼ˆWS-ï¼‰å’ŒESBæœåŠ¡çš„SOAã€‚å¾®æœåŠ¡åº”ç”¨ä¹äºé‡‡ç”¨ç®€å•è½»é‡çº§åè®®ï¼Œæ¯”å¦‚RESTï¼Œè€Œä¸æ˜¯WS-ï¼Œåœ¨å¾®æœåŠ¡å†…éƒ¨é¿å…ä½¿ç”¨ESBä»¥åŠESBç±»ä¼¼åŠŸèƒ½ã€‚å¾®æœåŠ¡æ¶æ„æ¨¡å¼ä¹Ÿæ‹’ç»ä½¿ç”¨canonical schemaç­‰SOAæ¦‚å¿µã€‚</p><h2 id="å¾®æœåŠ¡çš„å¥½å¤„"><a href="#å¾®æœåŠ¡çš„å¥½å¤„" class="headerlink" title="å¾®æœåŠ¡çš„å¥½å¤„"></a>å¾®æœåŠ¡çš„å¥½å¤„</h2><p>å¾®æœåŠ¡æ¶æ„æ¨¡å¼æœ‰å¾ˆå¤šå¥½å¤„ã€‚é¦–å…ˆï¼Œé€šè¿‡åˆ†è§£å·¨å¤§å•ä½“å¼åº”ç”¨ä¸ºå¤šä¸ªæœåŠ¡æ–¹æ³•è§£å†³äº†å¤æ‚æ€§é—®é¢˜ã€‚åœ¨åŠŸèƒ½ä¸å˜çš„æƒ…å†µä¸‹ï¼Œåº”ç”¨è¢«åˆ†è§£ä¸ºå¤šä¸ªå¯ç®¡ç†çš„åˆ†æ”¯æˆ–æœåŠ¡ã€‚æ¯ä¸ªæœåŠ¡éƒ½æœ‰ä¸€ä¸ªç”¨RPC-æˆ–è€…æ¶ˆæ¯é©±åŠ¨APIå®šä¹‰æ¸…æ¥šçš„è¾¹ç•Œã€‚å¾®æœåŠ¡æ¶æ„æ¨¡å¼ç»™é‡‡ç”¨å•ä½“å¼ç¼–ç æ–¹å¼å¾ˆéš¾å®ç°çš„åŠŸèƒ½æä¾›äº†æ¨¡å—åŒ–çš„è§£å†³æ–¹æ¡ˆï¼Œç”±æ­¤ï¼Œå•ä¸ªæœåŠ¡å¾ˆå®¹æ˜“å¼€å‘ã€ç†è§£å’Œç»´æŠ¤ã€‚</p><p>ç¬¬äºŒï¼Œè¿™ç§æ¶æ„ä½¿å¾—æ¯ä¸ªæœåŠ¡éƒ½å¯ä»¥æœ‰ä¸“é—¨å¼€å‘å›¢é˜Ÿæ¥å¼€å‘ã€‚å¼€å‘è€…å¯ä»¥è‡ªç”±é€‰æ‹©å¼€å‘æŠ€æœ¯ï¼Œæä¾›APIæœåŠ¡ã€‚å½“ç„¶ï¼Œè®¸å¤šå…¬å¸è¯•å›¾é¿å…æ··ä¹±ï¼Œåªæä¾›æŸäº›æŠ€æœ¯é€‰æ‹©ã€‚ç„¶åï¼Œè¿™ç§è‡ªç”±æ„å‘³ç€å¼€å‘è€…ä¸éœ€è¦è¢«è¿«ä½¿ç”¨æŸé¡¹ç›®å¼€å§‹æ—¶é‡‡ç”¨çš„è¿‡æ—¶æŠ€æœ¯ï¼Œä»–ä»¬å¯ä»¥é€‰æ‹©ç°åœ¨çš„æŠ€æœ¯ã€‚ç”šè‡³äºï¼Œå› ä¸ºæœåŠ¡éƒ½æ˜¯ç›¸å¯¹ç®€å•ï¼Œå³ä½¿ç”¨ç°åœ¨æŠ€æœ¯é‡å†™ä»¥å‰ä»£ç ä¹Ÿä¸æ˜¯å¾ˆå›°éš¾çš„äº‹æƒ…ã€‚</p><p>ç¬¬ä¸‰ï¼Œå¾®æœåŠ¡æ¶æ„æ¨¡å¼æ˜¯æ¯ä¸ªå¾®æœåŠ¡ç‹¬ç«‹çš„éƒ¨ç½²ã€‚å¼€å‘è€…ä¸å†éœ€è¦åè°ƒå…¶å®ƒæœåŠ¡éƒ¨ç½²å¯¹æœ¬æœåŠ¡çš„å½±å“ã€‚è¿™ç§æ”¹å˜å¯ä»¥åŠ å¿«éƒ¨ç½²é€Ÿåº¦ã€‚UIå›¢é˜Ÿå¯ä»¥é‡‡ç”¨ABæµ‹è¯•ï¼Œå¿«é€Ÿçš„éƒ¨ç½²å˜åŒ–ã€‚å¾®æœåŠ¡æ¶æ„æ¨¡å¼ä½¿å¾—æŒç»­åŒ–éƒ¨ç½²æˆä¸ºå¯èƒ½ã€‚</p><p>æœ€åï¼Œå¾®æœåŠ¡æ¶æ„æ¨¡å¼ä½¿å¾—æ¯ä¸ªæœåŠ¡ç‹¬ç«‹æ‰©å±•ã€‚ä½ å¯ä»¥æ ¹æ®æ¯ä¸ªæœåŠ¡çš„è§„æ¨¡æ¥éƒ¨ç½²æ»¡è¶³éœ€æ±‚çš„è§„æ¨¡ã€‚ç”šè‡³äºï¼Œä½ å¯ä»¥ä½¿ç”¨æ›´é€‚åˆäºæœåŠ¡èµ„æºéœ€æ±‚çš„ç¡¬ä»¶ã€‚æ¯”å¦‚ï¼Œä½ å¯ä»¥åœ¨EC2 Compute Optimized instancesä¸Šéƒ¨ç½²CPUæ•æ„Ÿçš„æœåŠ¡ï¼Œè€Œåœ¨EC2 memory-optimized instancesä¸Šéƒ¨ç½²å†…å­˜æ•°æ®åº“ã€‚</p><h2 id="å¾®æœåŠ¡çš„ä¸è¶³"><a href="#å¾®æœåŠ¡çš„ä¸è¶³" class="headerlink" title="å¾®æœåŠ¡çš„ä¸è¶³"></a>å¾®æœåŠ¡çš„ä¸è¶³</h2><p>Fred Brooksåœ¨30å¹´å‰å†™é“ï¼Œâ€œthere are no silver bulletsâ€ï¼Œåƒä»»ä½•å…¶å®ƒç§‘æŠ€ä¸€æ ·ï¼Œå¾®æœåŠ¡æ¶æ„ä¹Ÿæœ‰ä¸è¶³ã€‚å…¶ä¸­ä¸€ä¸ªè·Ÿä»–çš„åå­—ç±»ä¼¼ï¼Œã€å¾®æœåŠ¡ã€å¼ºè°ƒäº†æœåŠ¡å¤§å°ï¼Œå®é™…ä¸Šï¼Œæœ‰ä¸€äº›å¼€å‘è€…é¼“å¹å»ºç«‹ç¨å¾®å¤§ä¸€äº›çš„ï¼Œ10-100 LOCæœåŠ¡ç»„ã€‚å°½ç®¡å°æœåŠ¡æ›´ä¹äºè¢«é‡‡ç”¨ï¼Œä½†æ˜¯ä¸è¦å¿˜äº†è¿™åªæ˜¯ç»ˆç«¯çš„é€‰æ‹©è€Œä¸æ˜¯æœ€ç»ˆçš„ç›®çš„ã€‚å¾®æœåŠ¡çš„ç›®çš„æ˜¯æœ‰æ•ˆçš„æ‹†åˆ†åº”ç”¨ï¼Œå®ç°æ•æ·å¼€å‘å’Œéƒ¨ç½²ã€‚</p><p>å¦å¤–ä¸€ä¸ªä¸»è¦çš„ä¸è¶³æ˜¯ï¼Œå¾®æœåŠ¡åº”ç”¨æ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿï¼Œç”±æ­¤ä¼šå¸¦æ¥å›ºæœ‰çš„å¤æ‚æ€§ã€‚å¼€å‘è€…éœ€è¦åœ¨RPCæˆ–è€…æ¶ˆæ¯ä¼ é€’ä¹‹é—´é€‰æ‹©å¹¶å®Œæˆè¿›ç¨‹é—´é€šè®¯æœºåˆ¶ã€‚æ›´ç”šäºï¼Œä»–ä»¬å¿…é¡»å†™ä»£ç æ¥å¤„ç†æ¶ˆæ¯ä¼ é€’ä¸­é€Ÿåº¦è¿‡æ…¢æˆ–è€…ä¸å¯ç”¨ç­‰å±€éƒ¨å¤±æ•ˆé—®é¢˜ã€‚å½“ç„¶è¿™å¹¶ä¸æ˜¯ä»€ä¹ˆéš¾äº‹ï¼Œä½†ç›¸å¯¹äºå•ä½“å¼åº”ç”¨ä¸­é€šè¿‡è¯­è¨€å±‚çº§çš„æ–¹æ³•æˆ–è€…è¿›ç¨‹è°ƒç”¨ï¼Œå¾®æœåŠ¡ä¸‹è¿™ç§æŠ€æœ¯æ˜¾å¾—æ›´å¤æ‚ä¸€äº›ã€‚</p><p>å¦å¤–ä¸€ä¸ªå…³äºå¾®æœåŠ¡çš„æŒ‘æˆ˜æ¥è‡ªäºåˆ†åŒºçš„æ•°æ®åº“æ¶æ„ã€‚å•†ä¸šäº¤æ˜“ä¸­åŒæ—¶ç»™å¤šä¸ªä¸šåŠ¡åˆ†ä¸»ä½“æ›´æ–°æ¶ˆæ¯å¾ˆæ™®éã€‚è¿™ç§äº¤æ˜“å¯¹äºå•ä½“å¼åº”ç”¨æ¥è¯´å¾ˆå®¹æ˜“ï¼Œå› ä¸ºåªæœ‰ä¸€ä¸ªæ•°æ®åº“ã€‚åœ¨å¾®æœåŠ¡æ¶æ„åº”ç”¨ä¸­ï¼Œéœ€è¦æ›´æ–°ä¸åŒæœåŠ¡æ‰€ä½¿ç”¨çš„ä¸åŒçš„æ•°æ®åº“ã€‚ä½¿ç”¨åˆ†å¸ƒå¼äº¤æ˜“å¹¶ä¸ä¸€å®šæ˜¯å¥½çš„é€‰æ‹©ï¼Œä¸ä»…ä»…æ˜¯å› ä¸ºCAPç†è®ºï¼Œè¿˜å› ä¸ºä»Šå¤©é«˜æ‰©å±•æ€§çš„NoSQLæ•°æ®åº“å’Œæ¶ˆæ¯ä¼ é€’ä¸­é—´ä»¶å¹¶ä¸æ”¯æŒè¿™ä¸€éœ€æ±‚ã€‚æœ€ç»ˆä½ ä¸å¾—ä¸ä½¿ç”¨ä¸€ä¸ªæœ€ç»ˆä¸€è‡´æ€§çš„æ–¹æ³•ï¼Œä»è€Œå¯¹å¼€å‘è€…æå‡ºäº†æ›´é«˜çš„è¦æ±‚å’ŒæŒ‘æˆ˜ã€‚</p><p>æµ‹è¯•ä¸€ä¸ªåŸºäºå¾®æœåŠ¡æ¶æ„çš„åº”ç”¨ä¹Ÿæ˜¯å¾ˆå¤æ‚çš„ä»»åŠ¡ã€‚æ¯”å¦‚ï¼Œé‡‡ç”¨æµè¡Œçš„Spring Bootæ¶æ„ï¼Œå¯¹ä¸€ä¸ªå•ä½“å¼webåº”ç”¨ï¼Œæµ‹è¯•å®ƒçš„REST APIï¼Œæ˜¯å¾ˆå®¹æ˜“çš„äº‹æƒ…ã€‚åè¿‡æ¥ï¼ŒåŒæ ·çš„æœåŠ¡æµ‹è¯•éœ€è¦å¯åŠ¨å’Œå®ƒæœ‰å…³çš„æ‰€æœ‰æœåŠ¡ï¼ˆè‡³å°‘éœ€è¦è¿™äº›æœåŠ¡çš„stubsï¼‰ã€‚å†é‡ç”³ä¸€æ¬¡ï¼Œä¸èƒ½ä½ä¼°äº†é‡‡ç”¨å¾®æœåŠ¡æ¶æ„å¸¦æ¥çš„å¤æ‚æ€§ã€‚</p><p>å¦å¤–ä¸€ä¸ªæŒ‘æˆ˜åœ¨äºï¼Œå¾®æœåŠ¡æ¶æ„æ¨¡å¼åº”ç”¨çš„æ”¹å˜å°†ä¼šæ³¢åŠå¤šä¸ªæœåŠ¡ã€‚æ¯”å¦‚ï¼Œå‡è®¾ä½ åœ¨å®Œæˆä¸€ä¸ªæ¡ˆä¾‹ï¼Œéœ€è¦ä¿®æ”¹æœåŠ¡Aã€Bã€Cï¼Œè€ŒAä¾èµ–Bï¼ŒBä¾èµ–Cã€‚åœ¨å•ä½“å¼åº”ç”¨ä¸­ï¼Œä½ åªéœ€è¦æ”¹å˜ç›¸å…³æ¨¡å—ï¼Œæ•´åˆå˜åŒ–ï¼Œéƒ¨ç½²å°±å¥½äº†ã€‚å¯¹æ¯”ä¹‹ä¸‹ï¼Œå¾®æœåŠ¡æ¶æ„æ¨¡å¼å°±éœ€è¦è€ƒè™‘ç›¸å…³æ”¹å˜å¯¹ä¸åŒæœåŠ¡çš„å½±å“ã€‚æ¯”å¦‚ï¼Œä½ éœ€è¦æ›´æ–°æœåŠ¡Cï¼Œç„¶åæ˜¯Bï¼Œæœ€åæ‰æ˜¯Aï¼Œå¹¸è¿çš„æ˜¯ï¼Œè®¸å¤šæ”¹å˜ä¸€èˆ¬åªå½±å“ä¸€ä¸ªæœåŠ¡ï¼Œè€Œéœ€è¦åè°ƒå¤šæœåŠ¡çš„æ”¹å˜å¾ˆå°‘ã€‚</p><p>éƒ¨ç½²ä¸€ä¸ªå¾®æœåŠ¡åº”ç”¨ä¹Ÿå¾ˆå¤æ‚ï¼Œä¸€ä¸ªåˆ†å¸ƒå¼åº”ç”¨åªéœ€è¦ç®€å•åœ¨å¤æ‚å‡è¡¡å™¨åé¢éƒ¨ç½²å„è‡ªçš„æœåŠ¡å™¨å°±å¥½äº†ã€‚æ¯ä¸ªåº”ç”¨å®ä¾‹æ˜¯éœ€è¦é…ç½®è¯¸å¦‚æ•°æ®åº“å’Œæ¶ˆæ¯ä¸­é—´ä»¶ç­‰åŸºç¡€æœåŠ¡ã€‚ç›¸å¯¹æ¯”ï¼Œä¸€ä¸ªå¾®æœåŠ¡åº”ç”¨ä¸€èˆ¬ç”±å¤§æ‰¹æœåŠ¡æ„æˆã€‚ä¾‹å¦‚ï¼Œæ ¹æ®Adrian Cockcroftï¼Œ<a href="https://sudo.hailoapp.com/services/2015/03/09/journey-into-a-microservice-world-part-3/">Hailoæœ‰160ä¸ªä¸åŒæœåŠ¡æ„æˆ</a>ï¼ŒNetFlixæœ‰å¤§çº¦600ä¸ªæœåŠ¡ã€‚æ¯ä¸ªæœåŠ¡éƒ½æœ‰å¤šä¸ªå®ä¾‹ã€‚è¿™å°±é€ æˆè®¸å¤šéœ€è¦é…ç½®ã€éƒ¨ç½²ã€æ‰©å±•å’Œç›‘æ§çš„éƒ¨åˆ†ï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œä½ è¿˜éœ€è¦å®Œæˆä¸€ä¸ªæœåŠ¡å‘ç°æœºåˆ¶ï¼ˆåç»­æ–‡ç« ä¸­å‘è¡¨ï¼‰ï¼Œä»¥ç”¨æ¥å‘ç°ä¸å®ƒé€šè®¯æœåŠ¡çš„åœ°å€ï¼ˆåŒ…æ‹¬æœåŠ¡å™¨åœ°å€å’Œç«¯å£ï¼‰ã€‚ä¼ ç»Ÿçš„è§£å†³é—®é¢˜åŠæ³•ä¸èƒ½ç”¨äºè§£å†³è¿™ä¹ˆå¤æ‚çš„é—®é¢˜ã€‚æ¥ç»­è€Œæ¥ï¼ŒæˆåŠŸéƒ¨ç½²ä¸€ä¸ªå¾®æœåŠ¡åº”ç”¨éœ€è¦å¼€å‘è€…æœ‰è¶³å¤Ÿçš„æ§åˆ¶éƒ¨ç½²æ–¹æ³•ï¼Œå¹¶é«˜åº¦è‡ªåŠ¨åŒ–ã€‚</p><p>ä¸€ç§è‡ªåŠ¨åŒ–æ–¹æ³•æ˜¯ä½¿ç”¨PaaSæœåŠ¡ï¼Œä¾‹å¦‚<a href="http://www.cloudfoundry.org/">Cloud Foundry</a>ã€‚PaaSç»™å¼€å‘è€…æä¾›ä¸€ä¸ªéƒ¨ç½²å’Œç®¡ç†å¾®æœåŠ¡çš„ç®€å•æ–¹æ³•ï¼Œå®ƒæŠŠæ‰€æœ‰è¿™äº›é—®é¢˜éƒ½æ‰“åŒ…å†…ç½®è§£å†³äº†ã€‚åŒæ—¶ï¼Œé…ç½®PaaSçš„ç³»ç»Ÿå’Œç½‘ç»œä¸“å®¶å¯ä»¥é‡‡ç”¨æœ€ä½³å®è·µå’Œç­–ç•¥æ¥ç®€åŒ–è¿™äº›é—®é¢˜ã€‚å¦å¤–ä¸€ä¸ªè‡ªåŠ¨éƒ¨ç½²å¾®æœåŠ¡åº”ç”¨çš„æ–¹æ³•æ˜¯å¼€å‘å¯¹äºä½ æ¥è¯´æœ€åŸºç¡€çš„PaaSç³»ç»Ÿã€‚ä¸€ä¸ªå…¸å‹çš„å¼€å§‹ç‚¹æ˜¯ä½¿ç”¨ä¸€ä¸ªé›†ç¾¤åŒ–æ–¹æ¡ˆï¼Œæ¯”å¦‚é…åˆDockerä½¿ç”¨Mesosæˆ–è€…Kubernetesã€‚åé¢çš„ç³»åˆ—æˆ‘ä»¬ä¼šçœ‹çœ‹å¦‚ä½•åŸºäºè½¯ä»¶éƒ¨ç½²æ–¹æ³•ä¾‹å¦‚NGINXï¼Œå¯ä»¥æ–¹ä¾¿çš„åœ¨å¾®æœåŠ¡å±‚é¢æä¾›ç¼“å­˜ã€æƒé™æ§åˆ¶ã€APIç»Ÿè®¡å’Œç›‘æ§ã€‚</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>æ„å»ºå¤æ‚çš„åº”ç”¨çœŸçš„æ˜¯éå¸¸å›°éš¾ã€‚å•ä½“å¼çš„æ¶æ„æ›´é€‚åˆè½»é‡çº§çš„ç®€å•åº”ç”¨ã€‚å¦‚æœä½ ç”¨å®ƒæ¥å¼€å‘å¤æ‚åº”ç”¨ï¼Œé‚£çœŸçš„ä¼šå¾ˆç³Ÿç³•ã€‚å¾®æœåŠ¡æ¶æ„æ¨¡å¼å¯ä»¥ç”¨æ¥æ„å»ºå¤æ‚åº”ç”¨ï¼Œå½“ç„¶ï¼Œè¿™ç§æ¶æ„æ¨¡å‹ä¹Ÿæœ‰è‡ªå·±çš„ç¼ºç‚¹å’ŒæŒ‘æˆ˜ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹æŠ€æœ¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> è½¬è½½ </tag>
            
            <tag> å¾®æœåŠ¡ </tag>
            
            <tag> Spring </tag>
            
            <tag> SpringCloud </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Springç»Ÿä¸€å¼‚å¸¸è¿”å›</title>
      <link href="post/1239641408/"/>
      <url>post/1239641408/</url>
      
        <content type="html"><![CDATA[<blockquote><p>è®°å½•ä¸€æ¬¡åœ¨Springä¸­å¤„ç†ç»Ÿä¸€å¼‚å¸¸å¤„ç†çš„æ–¹æ³•</p></blockquote><h2 id="RestControllerAdvice"><a href="#RestControllerAdvice" class="headerlink" title="@RestControllerAdvice"></a>@RestControllerAdvice</h2><p><code>@ControllerAdvice</code>ï¼Œæ˜¯Spring3.2æä¾›çš„æ–°æ³¨è§£ï¼Œä»åå­—ä¸Šå¯ä»¥çœ‹å‡ºå¤§ä½“æ„æ€æ˜¯æ§åˆ¶å™¨å¢å¼ºã€‚</p><h2 id="ExceptionHandler"><a href="#ExceptionHandler" class="headerlink" title="@ExceptionHandler"></a>@ExceptionHandler</h2><p><code>@ExceptionHandler</code>ç”¨æ¥ä¸<code>@RestControllerAdvice</code>é…åˆä½¿ç”¨ï¼Œå½“æ•è·åˆ°æŒ‡å®šçš„å¼‚å¸¸æ—¶ï¼Œå¯ä»¥ä½œå‡ºç›¸åº”å¤„ç†ã€‚</p><p>è¿™é‡Œå±•ç¤ºå½“å‚æ•°ç­¾åå¤±è´¥æ—¶çš„å¼‚å¸¸å¤„ç†ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RestControllerAdvice</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SignatureExceptionHandler</span> <span class="keyword">extends</span> <span class="title">ResponseEntityExceptionHandler</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SignatureExceptionHandler</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ExceptionHandler(SignatureExpireException.class)</span></span><br><span class="line">    <span class="keyword">public</span> RestResponse&lt;?&gt; handleSignatureExpireException(SignatureExpireException ex) &#123;</span><br><span class="line"><span class="comment">// å½“ç„¶ï¼Œ è¿™æ˜¯æœ€ç®€å•çš„å¤„ç†ï¼Œè¿˜å¯ä»¥æœ‰å¤šç§æ‹“å±•æ–¹å¼ï¼Œè¿™é‡Œåªå±•ç¤ºä¸€ä¸‹æ€ä¹ˆä½¿ç”¨</span></span><br><span class="line">        <span class="keyword">return</span> ResultBuilder.signatureError(ErrorCodeEnum.SIGNATURE_ERROR, </span><br><span class="line">                                            ex.getMessage());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ—¶ï¼Œ å½“æ•è·åˆ°<code>SignatureExpireException</code>å¼‚å¸¸çš„æ—¶å€™ï¼Œ å°±ä¼šè¿›å…¥è¿™ä¸ª<code>handler</code>é‡Œé¢æ¥å¤„ç†ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹æŠ€æœ¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> Spring </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç­¾åå‚æ•°Mapå­—å…¸æ’åº</title>
      <link href="post/1792286158/"/>
      <url>post/1792286158/</url>
      
        <content type="html"><![CDATA[<blockquote><p>ç”±äºä¸šåŠ¡éœ€è¦ï¼Œéœ€è¦å¯¹è¯·æ±‚è¿›è¡Œçš„ç­¾åï¼Œå…¶ä¸­æœ‰ä¸€éƒ¨åˆ†çš„ç®—æ³•å°±æ˜¯éœ€è¦å¯¹æ‰€æœ‰å‚æ•°è¿›è¡Œå­—å…¸æ’åº</p></blockquote><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ–¹æ³•ç”¨é€”: å¯¹æ‰€æœ‰ä¼ å…¥å‚æ•°æŒ‰ç…§å­—æ®µåçš„ ASCII ç ä»å°åˆ°å¤§æ’åºï¼ˆå­—å…¸åºï¼‰ï¼Œå¹¶ä¸”ç”Ÿæˆurlå‚æ•°ä¸²</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> paramsMap  è¦æ’åºçš„Mapå¯¹è±¡</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> urlEncode  æ˜¯å¦éœ€è¦URLENCODE</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> keyToLower æ˜¯å¦éœ€è¦å°†Keyè½¬æ¢ä¸ºå…¨å°å†™ true:keyè½¬åŒ–æˆå°å†™ï¼Œfalse:ä¸è½¬åŒ–</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">formatUrlMap</span><span class="params">(Map&lt;String, Object&gt; paramsMap, </span></span></span><br><span class="line"><span class="function"><span class="params">                                  <span class="keyword">boolean</span> urlEncode, <span class="keyword">boolean</span> keyToLower)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    String buff = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    Map&lt;String, Object&gt; tmpMap = paramsMap;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        List&lt;Map.Entry&lt;String, Object&gt;&gt; infoIds = </span><br><span class="line">            <span class="keyword">new</span> ArrayList&lt;Map.Entry&lt;String, Object&gt;&gt;(tmpMap.entrySet());</span><br><span class="line"></span><br><span class="line">        <span class="comment">//å¯¹æ‰€æœ‰ä¼ å…¥å‚æ•°æŒ‰ç…§å­—æ®µåçš„ASCIIç ä»å°åˆ°å¤§æ’åºï¼ˆå­—å…¸åºï¼‰</span></span><br><span class="line">        Collections.sort(infoIds, <span class="keyword">new</span> Comparator&lt;Map.Entry&lt;String, Object&gt;&gt;() &#123;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compare</span><span class="params">(Map.Entry&lt;String, Object&gt; o1, </span></span></span><br><span class="line"><span class="function"><span class="params">                               Map.Entry&lt;String, Object&gt; o2)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> (o1.getKey()).toString().compareTo(o2.getKey());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//æ„é€ URL é”®å€¼å¯¹çš„æ ¼å¼</span></span><br><span class="line">        StringBuffer buf = <span class="keyword">new</span> StringBuffer();</span><br><span class="line">        <span class="keyword">for</span> (Map.Entry&lt;String, Object&gt; item : infoIds) &#123;</span><br><span class="line">            <span class="keyword">if</span> (StringUtils.isNotBlank(item.getKey())) &#123;</span><br><span class="line">                String key = item.getKey();</span><br><span class="line">                String value = item.getValue().toString();</span><br><span class="line">                <span class="keyword">if</span> (urlEncode) &#123;</span><br><span class="line">                    value = URLEncoder.encode(value, <span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (keyToLower) &#123;</span><br><span class="line">                    buf.append(key.toLowerCase() + <span class="string">&quot;=&quot;</span> + value);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    buf.append(key + <span class="string">&quot;=&quot;</span> + value);</span><br><span class="line">                &#125;</span><br><span class="line">                buf.append(<span class="string">&quot;&amp;&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        buff = buf.toString();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isNotEmpty(buff)) &#123;</span><br><span class="line">            buff = buff.substring(<span class="number">0</span>, buff.length() - <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> buff;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ’åºåå¯ä»¥è¿›è¡Œå…¶ä»–å¤„ç†ï¼Œæ¯”å¦‚æ‹¼ä¸Š<code>nonce</code>ã€æ—¶é—´æˆ³ç­‰ï¼›</p>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹æŠ€æœ¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> Map </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Mavenä¸­dependencyManagementçš„ä½œç”¨</title>
      <link href="post/3157433927/"/>
      <url>post/3157433927/</url>
      
        <content type="html"><![CDATA[<h2 id="è¯´æ˜"><a href="#è¯´æ˜" class="headerlink" title="è¯´æ˜"></a>è¯´æ˜</h2><p>ä½¿ç”¨<code>dependencyManagement</code>å¯ä»¥ç»Ÿä¸€ç®¡ç†é¡¹ç›®çš„ç‰ˆæœ¬å·ï¼Œç¡®ä¿åº”ç”¨çš„å„ä¸ªé¡¹ç›®çš„ä¾èµ–å’Œç‰ˆæœ¬ä¸€è‡´ï¼Œä¸ç”¨æ¯ä¸ªæ¨¡å—é¡¹ç›®éƒ½å¼„ä¸€ä¸ªç‰ˆæœ¬å·ï¼Œä¸åˆ©äºç®¡ç†ï¼Œå½“éœ€è¦å˜æ›´ç‰ˆæœ¬å·çš„æ—¶å€™åªéœ€è¦åœ¨çˆ¶ç±»å®¹å™¨é‡Œæ›´æ–°ï¼Œä¸éœ€è¦ä»»ä½•ä¸€ä¸ªå­é¡¹ç›®çš„ä¿®æ”¹ï¼›å¦‚æœæŸä¸ªå­é¡¹ç›®éœ€è¦å¦å¤–ä¸€ä¸ªç‰¹æ®Šçš„ç‰ˆæœ¬å·æ—¶ï¼Œåªéœ€è¦åœ¨è‡ªå·±çš„æ¨¡å—<code>dependencies</code>ä¸­å£°æ˜ä¸€ä¸ªç‰ˆæœ¬å·å³å¯ã€‚å­ç±»å°±ä¼šä½¿ç”¨å­ç±»å£°æ˜çš„ç‰ˆæœ¬å·ï¼Œä¸ç»§æ‰¿äºçˆ¶ç±»ç‰ˆæœ¬å·ã€‚</p><p>##dependencyManagementä¸dependencysçš„åŒºåˆ«</p><p>1)<code>Dependencies</code>ç›¸å¯¹äº<code>dependencyManagement</code>ï¼Œæ‰€æœ‰ç”Ÿå‘½åœ¨<code>dependencies</code>é‡Œçš„ä¾èµ–éƒ½ä¼šè‡ªåŠ¨å¼•å…¥ï¼Œå¹¶é»˜è®¤è¢«æ‰€æœ‰çš„å­é¡¹ç›®ç»§æ‰¿ã€‚</p><p>2)<code>dependencyManagement</code>é‡Œåªæ˜¯å£°æ˜ä¾èµ–ï¼Œå¹¶ä¸è‡ªåŠ¨å®ç°å¼•å…¥ï¼Œå› æ­¤å­é¡¹ç›®éœ€è¦æ˜¾ç¤ºçš„å£°æ˜éœ€è¦ç”¨çš„ä¾èµ–ã€‚å¦‚æœä¸åœ¨å­é¡¹ç›®ä¸­å£°æ˜ä¾èµ–ï¼Œæ˜¯ä¸ä¼šä»çˆ¶é¡¹ç›®ä¸­ç»§æ‰¿ä¸‹æ¥çš„ï¼›åªæœ‰åœ¨å­é¡¹ç›®ä¸­å†™äº†è¯¥ä¾èµ–é¡¹ï¼Œå¹¶ä¸”æ²¡æœ‰æŒ‡å®šå…·ä½“ç‰ˆæœ¬ï¼Œæ‰ä¼šä»çˆ¶é¡¹ç›®ä¸­ç»§æ‰¿è¯¥é¡¹ï¼Œå¹¶ä¸”<code>version</code>å’Œ<code>scope</code>éƒ½è¯»å–è‡ªçˆ¶<code>pom</code>;å¦å¤–å¦‚æœå­é¡¹ç›®ä¸­æŒ‡å®šäº†ç‰ˆæœ¬å·ï¼Œé‚£ä¹ˆä¼šä½¿ç”¨å­é¡¹ç›®ä¸­æŒ‡å®šçš„jar<code>ç‰ˆæœ¬</code>ã€‚</p><h2 id="ç¤ºä¾‹è¯´æ˜"><a href="#ç¤ºä¾‹è¯´æ˜" class="headerlink" title="ç¤ºä¾‹è¯´æ˜"></a>ç¤ºä¾‹è¯´æ˜</h2><p>åœ¨çˆ¶æ¨¡å—ä¸­ï¼š</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.44<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencyManagement</span>&gt;</span></span><br></pre></td></tr></table></figure><p>åœ¨å­æ¨¡å—ä¸­ï¼š</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><p>åªéœ€è¦æŒ‡å®š<code>groupId</code>å’Œ<code>artifactId</code>å³å¯ï¼Œä¸éœ€è¦é¢å¤–æŒ‡å®šç‰ˆæœ¬å·ï¼›</p><p>åœ¨<code>Maven</code>å¤šæ¨¡å—çš„æ—¶å€™ï¼Œç®¡ç†ä¾èµ–å…³ç³»æ˜¯éå¸¸é‡è¦çš„ï¼Œå„ç§ä¾èµ–åŒ…å†²çªï¼ŒæŸ¥è¯¢é—®é¢˜èµ·æ¥éå¸¸å¤æ‚ï¼Œä½¿ç”¨<code>dependencyManagement</code>å¯ä»¥æœ‰æ•ˆçš„ç®¡ç†ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®°æœ¬ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> Maven </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linuxä¸‹findä¸execçš„ä½¿ç”¨</title>
      <link href="post/424495342/"/>
      <url>post/424495342/</url>
      
        <content type="html"><![CDATA[<blockquote><p><strong>execå‘½ä»¤</strong>ç”¨äºè°ƒç”¨å¹¶æ‰§è¡ŒæŒ‡ä»¤çš„å‘½ä»¤ã€‚execå‘½ä»¤é€šå¸¸ç”¨åœ¨shellè„šæœ¬ç¨‹åºä¸­ï¼Œå¯ä»¥è°ƒç”¨å…¶ä»–çš„å‘½ä»¤ã€‚å¦‚æœåœ¨å½“å‰ç»ˆç«¯ä¸­ä½¿ç”¨å‘½ä»¤ï¼Œåˆ™å½“æŒ‡å®šçš„å‘½ä»¤æ‰§è¡Œå®Œæ¯•åä¼šç«‹å³é€€å‡ºç»ˆç«¯ã€‚</p></blockquote><h3 id="execçš„åŸºæœ¬ç”¨æ³•"><a href="#execçš„åŸºæœ¬ç”¨æ³•" class="headerlink" title="execçš„åŸºæœ¬ç”¨æ³•"></a>execçš„åŸºæœ¬ç”¨æ³•</h3><p><code>-exec</code>å‚æ•°åé¢è·Ÿçš„å°±æ˜¯æˆ‘ä»¬æƒ³è¿›ä¸€æ­¥æ“ä½œçš„å‘½ä»¤ï¼Œæ¯”å¦‚<code>rm</code>ï¼Œ<code>mv</code>ç­‰ç­‰ã€‚<code>exec</code>æ˜¯ä»¥åˆ†å·â€<code>;</code>â€œä½œä¸ºç»“æŸæ ‡è¯†ç¬¦çš„ï¼Œè€ƒè™‘åˆ°å„ä¸ªç³»ç»Ÿå¹³å°å¯¹åˆ†å·çš„ä¸åŒè§£é‡Šï¼Œæˆ‘ä»¬åœ¨åˆ†å·å‰å†åŠ ä¸ªåæ–œæ ï¼Œä¾¿äºç§»æ¤ã€‚è€Œåœ¨åˆ†å·å‰ï¼Œé€šå¸¸ä¹Ÿä¼šæœ‰ä¸€å¯¹èŠ±æ‹¬å·**{}**ï¼Œä»£è¡¨å‰é¢<code>find</code>å‘½ä»¤æŸ¥æ‰¾å‡ºæ¥çš„æ–‡ä»¶åã€‚</p><h3 id="Example-1-ä½¿ç”¨findå‘½ä»¤æŸ¥æ‰¾ç›¸å…³æ–‡ä»¶åï¼Œå†ä½¿ç”¨lså‘½ä»¤å°†å®ƒä»¬çš„è¯¦ç»†ä¿¡æ¯åˆ—å‡ºæ¥"><a href="#Example-1-ä½¿ç”¨findå‘½ä»¤æŸ¥æ‰¾ç›¸å…³æ–‡ä»¶åï¼Œå†ä½¿ç”¨lså‘½ä»¤å°†å®ƒä»¬çš„è¯¦ç»†ä¿¡æ¯åˆ—å‡ºæ¥" class="headerlink" title="Example 1 ä½¿ç”¨findå‘½ä»¤æŸ¥æ‰¾ç›¸å…³æ–‡ä»¶åï¼Œå†ä½¿ç”¨lså‘½ä»¤å°†å®ƒä»¬çš„è¯¦ç»†ä¿¡æ¯åˆ—å‡ºæ¥"></a>Example 1 ä½¿ç”¨findå‘½ä»¤æŸ¥æ‰¾ç›¸å…³æ–‡ä»¶åï¼Œå†ä½¿ç”¨lså‘½ä»¤å°†å®ƒä»¬çš„è¯¦ç»†ä¿¡æ¯åˆ—å‡ºæ¥</h3><p>æƒ³æŠŠå½“å‰ç›®å½•ä¸‹æ‰€æœ‰çš„.oæ–‡ä»¶å…¨éƒ¨æ‰¾å‡ºæ¥ï¼Œå¹¶ç”¨ <code>ls -l</code> å‘½ä»¤å°†å®ƒä»¬åˆ—å‡ºæ¥ã€‚å®ç°è¿™ä¸ªéœ€æ±‚çš„å‘½ä»¤å¦‚ä¸‹ï¼š</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">find . -name &quot;*.o&quot; -type f -exec ls -l &#123;&#125; \;</span><br></pre></td></tr></table></figure><p>åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ç”¨<code>find</code> å‘½ä»¤åŒ¹é…åˆ°äº†å½“å‰ç›®å½•ä¸‹çš„æ‰€æœ‰<code>.o</code>æ–‡ä»¶ï¼Œå¹¶åœ¨ <code>-exec</code> é€‰é¡¹ä¸­ä½¿ç”¨ <code>ls -l</code> å‘½ä»¤å°†å®ƒä»¬çš„è¯¦ç»†ä¿¡æ¯åˆ—å‡ºæ¥ã€‚</p><h3 id="Example-2-ä½¿ç”¨findå‘½ä»¤æŸ¥æ‰¾ç›¸å…³æ–‡ä»¶åï¼Œå†ä½¿ç”¨rmå‘½ä»¤å°†å®ƒä»¬åˆ é™¤"><a href="#Example-2-ä½¿ç”¨findå‘½ä»¤æŸ¥æ‰¾ç›¸å…³æ–‡ä»¶åï¼Œå†ä½¿ç”¨rmå‘½ä»¤å°†å®ƒä»¬åˆ é™¤" class="headerlink" title="Example 2 ä½¿ç”¨findå‘½ä»¤æŸ¥æ‰¾ç›¸å…³æ–‡ä»¶åï¼Œå†ä½¿ç”¨rmå‘½ä»¤å°†å®ƒä»¬åˆ é™¤"></a>Example 2 ä½¿ç”¨findå‘½ä»¤æŸ¥æ‰¾ç›¸å…³æ–‡ä»¶åï¼Œå†ä½¿ç”¨rmå‘½ä»¤å°†å®ƒä»¬åˆ é™¤</h3><p>æƒ³æŠŠå½“å‰ç›®å½•ä¸‹æ‰€æœ‰çš„.oæ–‡ä»¶å…¨éƒ¨æ‰¾å‡ºæ¥ï¼Œå¹¶ç”¨rmå‘½ä»¤å°†å®ƒä»¬åˆ é™¤ã€‚å®ç°è¿™ä¸ªéœ€æ±‚çš„å‘½ä»¤å¦‚ä¸‹ï¼š</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">find . -name &quot;*.o&quot; -exec rm &#123;&#125; \;</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œå®Œè¿™ä¸ªå‘½ä»¤åï¼Œè¯¥ç›®å½•ä¸‹æ‰€æœ‰çš„.oæ–‡ä»¶éƒ½è¢«åˆ é™¤ã€‚</p><h3 id="Example-3-ä½¿ç”¨-execé€‰é¡¹çš„å®‰å…¨æ¨¡å¼ï¼Œå°†å¯¹æ¯ä¸ªåŒ¹é…åˆ°çš„æ–‡ä»¶è¿›è¡Œæ“ä½œä¹‹å‰æç¤ºç”¨æˆ·"><a href="#Example-3-ä½¿ç”¨-execé€‰é¡¹çš„å®‰å…¨æ¨¡å¼ï¼Œå°†å¯¹æ¯ä¸ªåŒ¹é…åˆ°çš„æ–‡ä»¶è¿›è¡Œæ“ä½œä¹‹å‰æç¤ºç”¨æˆ·" class="headerlink" title="Example 3 ä½¿ç”¨-execé€‰é¡¹çš„å®‰å…¨æ¨¡å¼ï¼Œå°†å¯¹æ¯ä¸ªåŒ¹é…åˆ°çš„æ–‡ä»¶è¿›è¡Œæ“ä½œä¹‹å‰æç¤ºç”¨æˆ·"></a>Example 3 ä½¿ç”¨-execé€‰é¡¹çš„å®‰å…¨æ¨¡å¼ï¼Œå°†å¯¹æ¯ä¸ªåŒ¹é…åˆ°çš„æ–‡ä»¶è¿›è¡Œæ“ä½œä¹‹å‰æç¤ºç”¨æˆ·</h3><p>åœ¨å®ä¾‹2ä¸­ï¼ŒåŒ¹é…åˆ°æ–‡ä»¶åå°±ç«‹åˆ»æ‰§è¡Œ<code>rm</code>å‘½ä»¤ï¼Œè¿™æ ·æ“ä½œæœ‰äº›å±é™©ï¼Œå› ä¸ºå¦‚æœä¸€æ—¦è¯¯æ“ä½œï¼Œæœ‰å¯èƒ½ä¼šå¼•èµ·ç¾éš¾æ€§çš„åæœã€‚</p><p><code>exec</code>çš„å®‰å…¨æ¨¡å¼å°±æ˜¯ä¸ºäº†é¿å…è¿™ä¸ªé—®é¢˜è€Œäº§ç”Ÿã€‚å®ƒä¼šåœ¨åŒ¹é…åˆ°æŸä¸ªæ–‡ä»¶åï¼Œåœ¨è¿›è¡Œæ“ä½œä¹‹å‰ä¼šå…ˆé—®ä¸€ä¸‹ä½ ï¼Œç»è¿‡ç¡®è®¤å®ƒæ‰ä¼šè¿›è¡Œç›¸åº”æ“ä½œã€‚</p><p>åŒæ ·çš„å®ä¾‹2çš„éœ€æ±‚ï¼Œå¦‚æœé‡‡ç”¨å®‰å…¨æ¨¡å¼çš„è¯ï¼Œå‘½ä»¤æ˜¯è¿™æ ·çš„ï¼š</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">find . -name &quot;*.o&quot; -ok rm &#123;&#125; \;</span><br></pre></td></tr></table></figure><h3 id="Example-4-æœç´¢åŒ¹é…åˆ°çš„æ–‡ä»¶ä¸­çš„å…³é”®å†…å®¹"><a href="#Example-4-æœç´¢åŒ¹é…åˆ°çš„æ–‡ä»¶ä¸­çš„å…³é”®å†…å®¹" class="headerlink" title="Example 4 æœç´¢åŒ¹é…åˆ°çš„æ–‡ä»¶ä¸­çš„å…³é”®å†…å®¹"></a>Example 4 æœç´¢åŒ¹é…åˆ°çš„æ–‡ä»¶ä¸­çš„å…³é”®å†…å®¹</h3><p>å‡å¦‚ç°åœ¨æœ‰ä¸ªå¾ˆå¤§å‹çš„é¡¹ç›®ï¼ˆå¦‚<code>Linux</code>å†…æ ¸ï¼‰ï¼Œæƒ³åœ¨é‡Œé¢æœç´¢ä¸€ä¸ªå«æœ‰æŸå…³é”®å­—çš„æ–‡ä»¶ã€‚å¯ä»¥ä½¿ç”¨<code>grep</code>å‘½ä»¤æ£€ç´¢æ‰€æœ‰çš„æ–‡ä»¶ã€‚è¿™æ ·åšè‚¯å®šæ˜¯å¯ä»¥çš„ï¼Œä½†å¦‚æœé¡¹ç›®å¾ˆå¤§çš„è¯ï¼Œè¿™æ ·å¤ªè€—æ—¶äº†ï¼Œæ•ˆç‡å¤ªä½ã€‚</p><p>å¯ä»¥å…ˆç”¨<code>find</code>å‘½ä»¤æ‰¾åˆ°æ‰€ä»¥ç›¸å…³æ–‡ä»¶ï¼Œç„¶åå†ç”¨<code>grep</code>å‘½ä»¤æ£€ç´¢é‚£äº›æ–‡ä»¶å³å¯ã€‚å› ä¸ºå·²ç»ä½¿ç”¨<code>find</code>è¿‡æ»¤ä¸€éäº†ï¼Œæ‰€ä»¥è¿™æ ·æ“ä½œä¼šèŠ‚çº¦å¾ˆå¤šæ—¶é—´ï¼Œæé«˜æ•ˆç‡ã€‚</p><p>å‘½ä»¤å¦‚ä¸‹ï¼š</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">find . -name &quot;*.h&quot; -exec grep -rns &quot;hello&quot; &#123;&#125; \;</span><br></pre></td></tr></table></figure><h3 id="Example-5-æŸ¥æ‰¾æ–‡ä»¶å¹¶ç§»åŠ¨åˆ°æŒ‡å®šç›®å½•"><a href="#Example-5-æŸ¥æ‰¾æ–‡ä»¶å¹¶ç§»åŠ¨åˆ°æŒ‡å®šç›®å½•" class="headerlink" title="Example 5 æŸ¥æ‰¾æ–‡ä»¶å¹¶ç§»åŠ¨åˆ°æŒ‡å®šç›®å½•"></a>Example 5 æŸ¥æ‰¾æ–‡ä»¶å¹¶ç§»åŠ¨åˆ°æŒ‡å®šç›®å½•</h3><p>è¿™ä¸ªéœ€æ±‚å°±æ¯”è¾ƒç®€å•äº†ã€‚æ¯”å¦‚ç°åœ¨æƒ³æŠŠæ‰€æœ‰çš„<code>.o</code>æ–‡ä»¶æ‰¾å‡ºæ¥ï¼Œç„¶åæ–°ä»–ä»¬<code>mv</code>åˆ°<code>buil</code>ç›®å½•ã€‚å‘½ä»¤å¦‚ä¸‹ï¼š</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">find . -name &quot;*.o&quot; -exec cp &#123;&#125; build \;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®°æœ¬ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> exec </tag>
            
            <tag> find </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Javaä½¿ç”¨Optionalä¼˜é›…åœ°åˆ¤ç©º</title>
      <link href="post/3451676695/"/>
      <url>post/3451676695/</url>
      
        <content type="html"><![CDATA[<p>Java8ç‰¹æ€§ä¸­çš„<code>Optional</code>å¯ä»¥ç”¨æ¥ä¼˜é›…çš„åˆ¤ç©ºï¼Œ<code>Optional</code>æ¥è‡ªå®˜æ–¹çš„ä»‹ç»å¦‚ä¸‹ï¼š</p><blockquote><p>A container object which may or may not contain a non-null value. If a value is present, isPresent() will return true and get() will return the value.</p></blockquote><p><strong>ä¸€ä¸ªå¯èƒ½åŒ…å«ä¹Ÿå¯èƒ½ä¸åŒ…å«é<code>null</code>å€¼çš„å®¹å™¨å¯¹è±¡ã€‚ å¦‚æœå­˜åœ¨å€¼ï¼Œ<code>isPresent()</code>å°†è¿”å›<code>true</code>ï¼Œ<code>get()</code>å°†è¿”å›è¯¥å€¼ã€‚</strong></p><p>å¦‚ä¸‹ä»£ç ï¼Œéœ€è¦è·å¾—<code>Test2</code>ä¸­çš„<code>Info</code>ä¿¡æ¯ï¼Œä½†æ˜¯å‚æ•°ä¸º<code>Test4</code>ï¼Œæˆ‘ä»¬è¦ä¸€å±‚å±‚çš„ç”³è¯·ï¼Œæ¯ä¸€å±‚éƒ½è·å¾—çš„å¯¹è±¡éƒ½å¯èƒ½æ˜¯ç©ºï¼Œæœ€åçš„ä»£ç çœ‹èµ·æ¥å°±åƒè¿™æ ·ã€‚</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">testSimple</span><span class="params">(Test4 test)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (test == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (test.getTest3() == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (test.getTest3().getTest2() == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (test.getTest3().getTest2().getInfo() == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> test.getTest3().getTest2().getInfo();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨<code>Optional</code>ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">testOptional</span><span class="params">(Test test)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> Optional.ofNullable(test).flatMap(Test::getTest3)</span><br><span class="line">        .flatMap(Test3::getTest2)</span><br><span class="line">        .map(Test2::getInfo)</span><br><span class="line">        .orElse(<span class="string">&quot;&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>1ã€<code>Optional.ofNullable(test)</code>ï¼Œå¦‚æœtestä¸ºç©ºï¼Œåˆ™è¿”å›ä¸€ä¸ªå•ä¾‹ç©º<code>Optional</code>å¯¹è±¡ï¼Œå¦‚æœéç©ºåˆ™è¿”å›ä¸€ä¸ª<code>Optional</code>åŒ…è£…å¯¹è±¡ï¼Œ<code>Optional</code>å°†<code>test</code>åŒ…è£…ï¼›</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="function">Optional&lt;T&gt; <span class="title">ofNullable</span><span class="params">(T value)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> value == <span class="keyword">null</span> ? empty() : of(value);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>2ã€f<code>latMap(Test::getTest3)</code>åˆ¤æ–­<code>test</code>æ˜¯å¦ä¸ºç©ºï¼Œå¦‚æœä¸ºç©ºï¼Œç»§ç»­è¿”å›ç¬¬ä¸€æ­¥ä¸­çš„å•ä¾‹<code>Optional</code>å¯¹è±¡ï¼Œå¦åˆ™è°ƒç”¨<code>Test</code>çš„<code>getTest3</code>æ–¹æ³•ï¼›</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span>&lt;U&gt; Optional&lt;U&gt; <span class="title">flatMap</span><span class="params">(Function&lt;? <span class="keyword">super</span> T, Optional&lt;U&gt;&gt; mapper)</span> </span>&#123;</span><br><span class="line">    Objects.requireNonNull(mapper);</span><br><span class="line">    <span class="keyword">if</span> (!isPresent())</span><br><span class="line">        <span class="keyword">return</span> empty();</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Objects.requireNonNull(mapper.apply(value));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>3ã€<code>flatMap(Test3::getTest2)</code>åŒä¸Šè°ƒç”¨<code>Test3</code>çš„<code>getTest2</code>æ–¹æ³•ï¼›</p><p>4ã€<code>map(Test2::getInfo)</code>åŒ<code>flatMap</code>ç±»ä¼¼ï¼Œä½†æ˜¯<code>flatMap</code>è¦æ±‚<code>Test3::getTest2</code>è¿”å›å€¼ä¸º<code>Optional</code>ç±»å‹ï¼Œè€Œ<code>map</code>ä¸éœ€è¦ï¼Œ<code>flatMap</code>ä¸ä¼šå¤šå±‚åŒ…è£…ï¼Œmapè¿”å›ä¼šå†æ¬¡åŒ…è£…<code>Optional</code>ï¼›</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span>&lt;U&gt; Optional&lt;U&gt; <span class="title">map</span><span class="params">(Function&lt;? <span class="keyword">super</span> T, ? extends U&gt; mapper)</span> </span>&#123;</span><br><span class="line">    Objects.requireNonNull(mapper);</span><br><span class="line">    <span class="keyword">if</span> (!isPresent())</span><br><span class="line">        <span class="keyword">return</span> empty();</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Optional.ofNullable(mapper.apply(value));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>5ã€<code>orElse(&quot;&quot;);</code>è·å¾—<code>map</code>ä¸­çš„<code>value</code>ï¼Œä¸ä¸ºç©ºåˆ™ç›´æ¥è¿”å›<code>value</code>ï¼Œä¸ºç©ºåˆ™è¿”å›ä¼ å…¥çš„å‚æ•°ä½œä¸ºé»˜è®¤å€¼ã€‚</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> T <span class="title">orElse</span><span class="params">(T other)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> value != <span class="keyword">null</span> ? value : other;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨<code>Optional</code>åçš„ä»£ç æ˜¯ä¸æ˜¯ç¬é—´å˜å¾—éå¸¸æ•´æ´ï¼Œæˆ–è®¸çœ‹åˆ°è¿™æ®µä»£ç ä½ ä¼šæœ‰å¾ˆå¤šç–‘é—®ï¼Œé’ˆå¯¹å¤æ‚çš„ä¸€é•¿ä¸²åˆ¤ç©ºï¼ŒOptionalæœ‰å®ƒçš„ä¼˜åŠ¿ï¼Œä½†æ˜¯å¯¹äºç®€å•çš„åˆ¤ç©ºä½¿ç”¨<code>Optional</code>ä¹Ÿä¼šå¢åŠ ä»£ç çš„é˜…è¯»æˆæœ¬ã€ç¼–ç é‡ä»¥åŠå›¢é˜Ÿæ–°æˆå‘˜çš„å­¦ä¹ æˆæœ¬ã€‚æ¯•ç«Ÿ<code>Optional</code>åœ¨ç°åœ¨è¿˜å¹¶æ²¡æœ‰é‚£æ ·æµè¡Œï¼Œå®ƒè¿˜æ‹¥æœ‰ä¸€å®šçš„å±€é™æ€§ã€‚</p><hr><p><strong>æ–‡ç« å†…å®¹æ¥æº</strong></p><ul><li><a href="http://blog.imuxuan.com/">http://blog.imuxuan.com</a></li><li>JavaçŸ¥éŸ³ å¾®ä¿¡å…¬ä¼—å·</li></ul>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹æŠ€æœ¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> Optional </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linuxæ’æŸ¥Javaé—®é¢˜å·¥å…·å•</title>
      <link href="post/2012147641/"/>
      <url>post/2012147641/</url>
      
        <content type="html"><![CDATA[<blockquote><p>è®°å½•ä¸€äº›åœ¨Linuxä¸­æ’æŸ¥Javaé—®é¢˜çš„å·¥å…·ï¼Œå¯ä»¥è®©åç»­å¿˜è®°äº†å¯å¿«é€Ÿç¿»é˜…</p></blockquote><h1 id="Linuxå‘½ä»¤"><a href="#Linuxå‘½ä»¤" class="headerlink" title="Linuxå‘½ä»¤"></a>Linuxå‘½ä»¤</h1><h2 id="tail"><a href="#tail" class="headerlink" title="tail"></a>tail</h2><p>æœ€å¸¸ç”¨çš„<code>tail -f</code></p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">tail -200f error.log # å€’æ•°200è¡Œå¹¶è¿›å…¥å®æ—¶ç›‘å¬æ–‡ä»¶å†™å…¥æ¨¡å¼</span><br></pre></td></tr></table></figure><h2 id="grep"><a href="#grep" class="headerlink" title="grep"></a>grep</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">grep forest f.txt     #æ–‡ä»¶æŸ¥æ‰¾</span><br><span class="line">grep forest f.txt cpf.txt #å¤šæ–‡ä»¶æŸ¥æ‰¾</span><br><span class="line">grep &#x27;log&#x27; /home/admin -r -n #ç›®å½•ä¸‹æŸ¥æ‰¾æ‰€æœ‰ç¬¦åˆå…³é”®å­—çš„æ–‡ä»¶</span><br><span class="line">cat f.txt | grep -i shopbase    </span><br><span class="line">grep &#x27;shopbase&#x27; /home/admin -r -n --include *.&#123;vm,java&#125; #æŒ‡å®šæ–‡ä»¶åç¼€</span><br><span class="line">grep &#x27;shopbase&#x27; /home/admin -r -n --exclude *.&#123;vm,java&#125; #ååŒ¹é…</span><br><span class="line">seq 10 | grep 5 -A 3    #ä¸ŠåŒ¹é…</span><br><span class="line">seq 10 | grep 5 -B 3    #ä¸‹åŒ¹é…</span><br><span class="line">seq 10 | grep 5 -C 3    #ä¸Šä¸‹åŒ¹é…ï¼Œå¹³æ—¶ç”¨è¿™ä¸ªå°±å¦¥äº†</span><br><span class="line">cat f.txt | grep -c &#x27;SHOPBASE&#x27;</span><br></pre></td></tr></table></figure><h2 id="awk"><a href="#awk" class="headerlink" title="awk"></a>awk</h2><h3 id="åŸºç¡€å‘½ä»¤"><a href="#åŸºç¡€å‘½ä»¤" class="headerlink" title="åŸºç¡€å‘½ä»¤"></a>åŸºç¡€å‘½ä»¤</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">grep forest f.txt     #æ–‡ä»¶æŸ¥æ‰¾</span><br><span class="line">grep forest f.txt cpf.txt #å¤šæ–‡ä»¶æŸ¥æ‰¾</span><br><span class="line">grep &#x27;log&#x27; /home/admin -r -n #ç›®å½•ä¸‹æŸ¥æ‰¾æ‰€æœ‰ç¬¦åˆå…³é”®å­—çš„æ–‡ä»¶</span><br><span class="line">cat f.txt | grep -i shopbase    </span><br><span class="line">grep &#x27;shopbase&#x27; /home/admin -r -n --include *.&#123;vm,java&#125; #æŒ‡å®šæ–‡ä»¶åç¼€</span><br><span class="line">grep &#x27;shopbase&#x27; /home/admin -r -n --exclude *.&#123;vm,java&#125; #ååŒ¹é…</span><br><span class="line">seq 10 | grep 5 -A 3    #ä¸ŠåŒ¹é…</span><br><span class="line">seq 10 | grep 5 -B 3    #ä¸‹åŒ¹é…</span><br><span class="line">seq 10 | grep 5 -C 3    #ä¸Šä¸‹åŒ¹é…ï¼Œå¹³æ—¶ç”¨è¿™ä¸ªå°±å¦¥äº†</span><br><span class="line">cat f.txt | grep -c &#x27;SHOPBASE&#x27;</span><br></pre></td></tr></table></figure><h3 id="åŒ¹é…"><a href="#åŒ¹é…" class="headerlink" title="åŒ¹é…"></a>åŒ¹é…</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">awk &#x27;/ldb/ &#123;print&#125;&#x27; f.txt   #åŒ¹é…ldb</span><br><span class="line">awk &#x27;!/ldb/ &#123;print&#125;&#x27; f.txt  #ä¸åŒ¹é…ldb</span><br><span class="line">awk &#x27;/ldb/ &amp;&amp; /LISTEN/ &#123;print&#125;&#x27; f.txt   #åŒ¹é…ldbå’ŒLISTEN</span><br><span class="line">awk &#x27;$5 ~ /ldb/ &#123;print&#125;&#x27; f.txt #ç¬¬äº”åˆ—åŒ¹é…ldb</span><br></pre></td></tr></table></figure><h3 id="å†…å»ºå˜é‡"><a href="#å†…å»ºå˜é‡" class="headerlink" title="å†…å»ºå˜é‡"></a>å†…å»ºå˜é‡</h3><p>NR:NRè¡¨ç¤ºä»awkå¼€å§‹æ‰§è¡Œåï¼ŒæŒ‰ç…§è®°å½•åˆ†éš”ç¬¦è¯»å–çš„æ•°æ®æ¬¡æ•°ï¼Œé»˜è®¤çš„è®°å½•åˆ†éš”ç¬¦ä¸ºæ¢è¡Œç¬¦ï¼Œå› æ­¤é»˜è®¤çš„å°±æ˜¯è¯»å–çš„æ•°æ®è¡Œæ•°ï¼ŒNRå¯ä»¥ç†è§£ä¸ºNumber of Recordçš„ç¼©å†™ã€‚</p><p>FNR:åœ¨awkå¤„ç†å¤šä¸ªè¾“å…¥æ–‡ä»¶çš„æ—¶å€™ï¼Œåœ¨å¤„ç†å®Œç¬¬ä¸€ä¸ªæ–‡ä»¶åï¼ŒNRå¹¶ä¸ä¼šä»1å¼€å§‹ï¼Œè€Œæ˜¯ç»§ç»­ç´¯åŠ ï¼Œå› æ­¤å°±å‡ºç°äº†FNRï¼Œæ¯å½“å¤„ç†ä¸€ä¸ªæ–°æ–‡ä»¶çš„æ—¶å€™ï¼ŒFNRå°±ä»1å¼€å§‹è®¡æ•°ï¼ŒFNRå¯ä»¥ç†è§£ä¸ºFile Number of Recordã€‚</p><p>NF: NFè¡¨ç¤ºç›®å‰çš„è®°å½•è¢«åˆ†å‰²çš„å­—æ®µçš„æ•°ç›®ï¼ŒNFå¯ä»¥ç†è§£ä¸ºNumber of Fieldã€‚</p><h2 id="find"><a href="#find" class="headerlink" title="find"></a>find</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo -u admin find /home/admin /tmp /usr -name \*.log(å¤šä¸ªç›®å½•å»æ‰¾)</span><br><span class="line">find . -iname \*.txt(å¤§å°å†™éƒ½åŒ¹é…)</span><br><span class="line">find . -type d(å½“å‰ç›®å½•ä¸‹çš„æ‰€æœ‰å­ç›®å½•)</span><br><span class="line">find /usr -type l(å½“å‰ç›®å½•ä¸‹æ‰€æœ‰çš„ç¬¦å·é“¾æ¥)</span><br><span class="line">find /usr -type l -name &quot;z*&quot; -ls(ç¬¦å·é“¾æ¥çš„è¯¦ç»†ä¿¡æ¯ eg:inode,ç›®å½•)</span><br><span class="line">find /home/admin -size +250000k(è¶…è¿‡250000kçš„æ–‡ä»¶ï¼Œå½“ç„¶+æ”¹æˆ-å°±æ˜¯å°äºäº†)</span><br><span class="line">find /home/admin f -perm 777 -exec ls -l &#123;&#125; \; (æŒ‰ç…§æƒé™æŸ¥è¯¢æ–‡ä»¶)</span><br><span class="line">find /home/admin -atime -1  1å¤©å†…è®¿é—®è¿‡çš„æ–‡ä»¶</span><br><span class="line">find /home/admin -ctime -1  1å¤©å†…çŠ¶æ€æ”¹å˜è¿‡çš„æ–‡ä»¶    </span><br><span class="line">find /home/admin -mtime -1  1å¤©å†…ä¿®æ”¹è¿‡çš„æ–‡ä»¶</span><br><span class="line">find /home/admin -amin -1  1åˆ†é’Ÿå†…è®¿é—®è¿‡çš„æ–‡ä»¶</span><br><span class="line">find /home/admin -cmin -1  1åˆ†é’Ÿå†…çŠ¶æ€æ”¹å˜è¿‡çš„æ–‡ä»¶    </span><br><span class="line">find /home/admin -mmin -1  1åˆ†é’Ÿå†…ä¿®æ”¹è¿‡çš„æ–‡ä»¶</span><br></pre></td></tr></table></figure><h2 id="pgm"><a href="#pgm" class="headerlink" title="pgm"></a>pgm</h2><p>æ‰¹é‡æŸ¥è¯¢vm-shopbaseæ»¡è¶³æ¡ä»¶çš„æ—¥å¿—</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">pgm -A -f vm-shopbase \</span><br><span class="line">&#x27;cat /home/admin/shopbase/logs/shopbase.log.2017-01-17|grep 2069861630&#x27;</span><br></pre></td></tr></table></figure><h2 id="top"><a href="#top" class="headerlink" title="top"></a>top</h2><p>topé™¤äº†çœ‹ä¸€äº›åŸºæœ¬ä¿¡æ¯ä¹‹å¤–ï¼Œå‰©ä¸‹çš„å°±æ˜¯é…åˆæ¥æŸ¥è¯¢vmçš„å„ç§é—®é¢˜äº†</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ps -ef | grep java</span><br><span class="line">top -H -p pid</span><br></pre></td></tr></table></figure><p>è·å¾—çº¿ç¨‹10è¿›åˆ¶è½¬16è¿›åˆ¶åjstackå»æŠ“çœ‹è¿™ä¸ªçº¿ç¨‹åˆ°åº•åœ¨å¹²å•¥</p><h2 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">netstat -nat|awk  &#x27;&#123;print $6&#125;&#x27;|sort|uniq -c|sort -rn </span><br><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥çœ‹å½“å‰è¿æ¥</span></span><br></pre></td></tr></table></figure><h1 id="Javaè‡ªå¸¦å·¥å…·"><a href="#Javaè‡ªå¸¦å·¥å…·" class="headerlink" title="Javaè‡ªå¸¦å·¥å…·"></a>Javaè‡ªå¸¦å·¥å…·</h1><h2 id="jps"><a href="#jps" class="headerlink" title="jps"></a>jps</h2><p>ç”¨ä¸€æ¡å‘½ä»¤ï¼š</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo -u admin /opt/taobao/java/bin/jps -mlvV</span><br></pre></td></tr></table></figure><h2 id="jstack"><a href="#jstack" class="headerlink" title="jstack"></a>jstack</h2><h3 id="æ™®é€šç”¨æ³•ï¼š"><a href="#æ™®é€šç”¨æ³•ï¼š" class="headerlink" title="æ™®é€šç”¨æ³•ï¼š"></a>æ™®é€šç”¨æ³•ï¼š</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo -u admin /opt/taobao/install/ajdk-8_1_1_fp1-b52/bin/jstack 2815</span><br></pre></td></tr></table></figure><h3 id="native-javaæ ˆï¼š"><a href="#native-javaæ ˆï¼š" class="headerlink" title="native + javaæ ˆï¼š"></a>native + javaæ ˆï¼š</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo -u admin /opt/taobao/install/ajdk-8_1_1_fp1-b52/bin/jstack -m 2815</span><br></pre></td></tr></table></figure><h2 id="jinfo"><a href="#jinfo" class="headerlink" title="jinfo"></a>jinfo</h2><p>å¯çœ‹ç³»ç»Ÿå¯åŠ¨çš„å‚æ•°</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo -u admin /opt/install/ajdk-8_1_1_fp1-b52/bin/jinfo -flags 2815</span><br></pre></td></tr></table></figure><h2 id="jamp"><a href="#jamp" class="headerlink" title="jamp"></a>jamp</h2><ol><li><p>æŸ¥çœ‹å †çš„æƒ…å†µ</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo -u admin /opt/install/ajdk-8_1_1_fp1-b52/bin/jmap -heap 2815</span><br></pre></td></tr></table></figure></li><li><p>dump</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo -u admin /opt/install/ajdk-8_1_1_fp1-b52/bin/jmap \</span><br><span class="line">-dump:live,format=b,file=/tmp/heap2.bin 2815</span><br></pre></td></tr></table></figure><p>æˆ–è€…</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo -u admin /opt/install/ajdk-8_1_1_fp1-b52/bin/jmap \</span><br><span class="line">-dump:format=b,file=/tmp/heap3.bin 2815</span><br></pre></td></tr></table></figure></li><li><p>æŸ¥çœ‹å †è¢«è°å ç”¨ï¼Œé…åˆ<code>zprofiler</code>å’Œ<code>btrace</code>ï¼Œæ›´æ–¹ä¾¿çš„æ’æŸ¥é—®é¢˜</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo -u admin /opt/install/ajdk-8_1_1_fp1-b52/bin/jmap \</span><br><span class="line">-histo 2815 | head -10</span><br></pre></td></tr></table></figure></li></ol><h2 id="jstat"><a href="#jstat" class="headerlink" title="jstat"></a>jstat</h2><p>jstatå‚æ•°ä¼—å¤šï¼Œä½†æ˜¯ä½¿ç”¨ä¸€ä¸ªå°±å¤Ÿäº†</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo -u admin /opt/install/ajdk-8_1_1_fp1-b52/bin/jstat \ </span><br><span class="line">-gcutil 2815 1000 </span><br></pre></td></tr></table></figure><h2 id="jdb"><a href="#jdb" class="headerlink" title="jdb"></a>jdb</h2><p>jdbå¯ä»¥ç”¨æ¥é¢„å‘debug,å‡è®¾ä½ é¢„å‘çš„java_homeæ˜¯/opt/taobao/java/ï¼Œè¿œç¨‹è°ƒè¯•ç«¯å£æ˜¯8000ï¼Œé‚£ä¹ˆï¼š</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo -u admin /opt/java/bin/jdb -attach 8000</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®°æœ¬ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Shellè„šæœ¬ç®€æ˜æ•™ç¨‹</title>
      <link href="post/1847503891/"/>
      <url>post/1847503891/</url>
      
        <content type="html"><![CDATA[<blockquote><p>Shellè„šæœ¬,å°±æ˜¯åˆ©ç”¨Shellçš„å‘½ä»¤è§£é‡Šçš„åŠŸèƒ½ï¼Œå¯¹ä¸€ä¸ªçº¯æ–‡æœ¬çš„æ–‡ä»¶è¿›è¡Œè§£æï¼Œç„¶åæ‰§è¡Œè¿™äº›åŠŸèƒ½ï¼Œä¹Ÿå¯ä»¥è¯´Shellè„šæœ¬å°±æ˜¯ä¸€ç³»åˆ—å‘½ä»¤çš„é›†åˆã€‚</p><p>Shellå¯ä»¥ç›´æ¥ä½¿ç”¨åœ¨win/Unix/Linuxä¸Šé¢ï¼Œå¹¶ä¸”å¯ä»¥è°ƒç”¨å¤§é‡ç³»ç»Ÿå†…éƒ¨çš„åŠŸèƒ½æ¥è§£é‡Šæ‰§è¡Œç¨‹åºï¼Œå¦‚æœç†Ÿç»ƒæŒæ¡Shellè„šæœ¬ï¼Œå¯ä»¥è®©æˆ‘ä»¬æ“ä½œè®¡ç®—æœºå˜å¾—æ›´åŠ è½»æ¾ï¼Œä¹Ÿä¼šèŠ‚çœå¾ˆå¤šæ—¶é—´ã€‚</p></blockquote><h2 id="Shellçš„åº”ç”¨åœºæ™¯"><a href="#Shellçš„åº”ç”¨åœºæ™¯" class="headerlink" title="Shellçš„åº”ç”¨åœºæ™¯"></a>Shellçš„åº”ç”¨åœºæ™¯</h2><h3 id="Shellèƒ½åšä»€ä¹ˆ"><a href="#Shellèƒ½åšä»€ä¹ˆ" class="headerlink" title="Shellèƒ½åšä»€ä¹ˆ"></a>Shellèƒ½åšä»€ä¹ˆ</h3><ul><li>å°†ä¸€äº›å¤æ‚çš„å‘½ä»¤ç®€å•åŒ–(å¹³æ—¶æˆ‘ä»¬æäº¤ä¸€æ¬¡githubä»£ç å¯èƒ½éœ€è¦å¾ˆå¤šæ­¥éª¤ï¼Œä½†æ˜¯å¯ä»¥ç”¨Shellç®€åŒ–æˆä¸€æ­¥)</li><li>å¯ä»¥å†™ä¸€äº›è„šæœ¬è‡ªåŠ¨å®ç°ä¸€ä¸ªå·¥ç¨‹ä¸­è‡ªåŠ¨æ›´æ¢æœ€æ–°çš„sdk(åº“)</li><li>è‡ªåŠ¨æ‰“åŒ…ã€ç¼–è¯‘ã€å‘å¸ƒç­‰åŠŸèƒ½</li><li>æ¸…ç†ç£ç›˜ä¸­ç©ºæ–‡ä»¶å¤¹</li><li>æ€»ä¹‹ä¸€åˆ‡æœ‰è§„å¾‹çš„æ´»è„šæœ¬éƒ½å¯ä»¥å°è¯•ä¸€ä¸‹</li></ul><h3 id="Shellä¸èƒ½åšä»€ä¹ˆ"><a href="#Shellä¸èƒ½åšä»€ä¹ˆ" class="headerlink" title="Shellä¸èƒ½åšä»€ä¹ˆ"></a>Shellä¸èƒ½åšä»€ä¹ˆ</h3><ul><li>éœ€è¦ç²¾å¯†çš„è¿ç®—çš„æ—¶å€™</li><li>éœ€è¦è¯­è¨€æ•ˆç‡å¾ˆé«˜çš„æ—¶å€™</li><li>éœ€è¦ä¸€äº›ç½‘ç»œæ“ä½œçš„æ—¶å€™</li><li>æ€»ä¹‹Shellå°±æ˜¯å¯ä»¥å¿«é€Ÿå¼€å‘ä¸€ä¸ªè„šæœ¬ç®€åŒ–å¼€å‘æµç¨‹ï¼Œå¹¶ä¸å¯ä»¥ç”¨æ¥æ›¿ä»£é«˜çº§è¯­è¨€</li></ul><h3 id="Shellå·¥ä½œåŸç†"><a href="#Shellå·¥ä½œåŸç†" class="headerlink" title="Shellå·¥ä½œåŸç†"></a>Shellå·¥ä½œåŸç†</h3><p>Shellå¯ä»¥è¢«ç§°ä½œæ˜¯è„šæœ¬è¯­è¨€ï¼Œå› ä¸ºå®ƒæœ¬èº«æ˜¯ä¸éœ€è¦ç¼–è¯‘çš„ï¼Œè€Œæ˜¯é€šè¿‡è§£é‡Šå™¨è§£é‡Šä¹‹åå†ç¼–è¯‘æ‰§è¡Œï¼Œå’Œä¼ ç»Ÿè¯­è¨€ç›¸æ¯”å¤šäº†è§£é‡Šçš„è¿‡ç¨‹æ‰€ä»¥æ•ˆç‡ä¼šç•¥å·®äºä¼ ç»Ÿçš„ç›´æ¥ç¼–è¯‘çš„è¯­è¨€ã€‚</p><h2 id="å¦‚ä½•ç¼–å†™Shellè„šæœ¬"><a href="#å¦‚ä½•ç¼–å†™Shellè„šæœ¬" class="headerlink" title="å¦‚ä½•ç¼–å†™Shellè„šæœ¬"></a>å¦‚ä½•ç¼–å†™Shellè„šæœ¬</h2><p><strong>æœ€ç®€å•çš„è„šæœ¬ï¼š</strong></p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line">echo &quot;Hello World.&quot;</span><br></pre></td></tr></table></figure><p>åªéœ€è¦æ‰“å¼€æ–‡æœ¬ç¼–è¾‘å·¥å…·ï¼Œç¼–è¾‘æˆä»¥ä¸Šçš„æ ·å­,ç„¶åä¿å­˜æˆtest.sh</p><p><strong>è¿è¡Œè„šæœ¬ï¼š</strong></p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">chmod +x ./test.sh</span><br><span class="line">./test.sh</span><br><span class="line"></span><br><span class="line">Hello World.</span><br></pre></td></tr></table></figure><blockquote><p>å…³äºç¬¬ä¸€è¡Œä¸­çš„<code>#!/bin/bash</code>ï¼š</p><p>æ¯”è¾ƒå¸¸è§çš„è¯´æ³•æ˜¯ï¼š<strong>ç¬¬ä¸€è¡Œçš„å†…å®¹æŒ‡å®šäº†shellè„šæœ¬è§£é‡Šå™¨çš„è·¯å¾„ï¼Œè€Œä¸”è¿™ä¸ªæŒ‡å®šè·¯å¾„åªèƒ½æ”¾åœ¨æ–‡ä»¶çš„ç¬¬ä¸€è¡Œ</strong></p></blockquote><h3 id="Shellä¸­çš„å˜é‡"><a href="#Shellä¸­çš„å˜é‡" class="headerlink" title="Shellä¸­çš„å˜é‡"></a>Shellä¸­çš„å˜é‡</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">myText=&quot;hello world&quot;</span><br><span class="line">muNum=100</span><br></pre></td></tr></table></figure><p><strong>è¿™é‡Œé¢éœ€è¦æ³¨æ„çš„å°±æ˜¯ï¼Œâ€œ=â€å‰åä¸èƒ½æœ‰ç©ºæ ¼ï¼Œå‘½åè§„åˆ™å°±å’Œå…¶å®ƒè¯­è¨€ä¸€æ ·äº†ã€‚</strong></p><h3 id="è®¿é—®å˜é‡"><a href="#è®¿é—®å˜é‡" class="headerlink" title="è®¿é—®å˜é‡"></a>è®¿é—®å˜é‡</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">myText=&quot;hello world&quot;</span><br><span class="line">muNum=100</span><br><span class="line">echo $myText</span><br><span class="line">echo muNum</span><br></pre></td></tr></table></figure><p><strong>å½“æƒ³è¦è®¿é—®å˜é‡çš„æ—¶å€™ï¼Œéœ€è¦ä½¿ç”¨$ï¼Œå¦åˆ™è¾“å‡ºçš„å°†æ˜¯çº¯æ–‡æœ¬å†…å®¹ã€‚</strong></p><h3 id="Shellä¸­çš„å››åˆ™è¿ç®—"><a href="#Shellä¸­çš„å››åˆ™è¿ç®—" class="headerlink" title="Shellä¸­çš„å››åˆ™è¿ç®—"></a>Shellä¸­çš„å››åˆ™è¿ç®—</h3><table><thead><tr><th>è¿ç®—ç¬¦</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td>+</td><td>åŠ æ³•è¿ç®—</td></tr><tr><td>-</td><td>å‡æ³•è¿ç®—</td></tr><tr><td>*</td><td>ä¹˜æ³•è¿ç®—</td></tr><tr><td>/</td><td>é™¤æ³•è¿ç®—</td></tr></tbody></table><h4 id="ä¾‹å­ï¼š"><a href="#ä¾‹å­ï¼š" class="headerlink" title="ä¾‹å­ï¼š"></a>ä¾‹å­ï¼š</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line">echo &quot;Hello World !&quot;</span><br><span class="line">a=3</span><br><span class="line">b=5</span><br><span class="line">val=`expr $a + $b`</span><br><span class="line">echo &quot;Total value : $val&quot;</span><br><span class="line"></span><br><span class="line">val=`expr $a - $b`</span><br><span class="line">echo &quot;Total value : $val&quot;</span><br><span class="line"></span><br><span class="line">val=`expr $a \* $b`</span><br><span class="line">echo &quot;Total value : $val&quot;</span><br><span class="line"></span><br><span class="line">val=`expr $a / $b`</span><br><span class="line">echo &quot;Total value : $val&quot;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œé¢éœ€è¦æ³¨æ„çš„å°±æ˜¯ï¼Œ<strong>å®šä¹‰å˜é‡çš„æ—¶å€™â€œ=â€å‰åæ˜¯ä¸èƒ½æœ‰ç©ºæ ¼çš„ï¼Œä½†æ˜¯è¿›è¡Œå››åˆ™è¿ç®—çš„æ—¶å€™è¿ç®—ç¬¦å·å‰åä¸€å®šè¦æœ‰ç©ºæ ¼ï¼Œä¹˜æ³•çš„æ—¶å€™éœ€è¦è¿›è¡Œè½¬ä¹‰ã€‚</strong></p><h3 id="å…¶å®ƒè¿ç®—ç¬¦-ã€-ã€-ã€ï¼ã€-oã€-a"><a href="#å…¶å®ƒè¿ç®—ç¬¦-ã€-ã€-ã€ï¼ã€-oã€-a" class="headerlink" title="å…¶å®ƒè¿ç®—ç¬¦ =ã€==ã€!=ã€ï¼ã€-oã€-a"></a>å…¶å®ƒè¿ç®—ç¬¦ =ã€==ã€!=ã€ï¼ã€-oã€-a</h3><table><thead><tr><th>è¿ç®—ç¬¦</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td>%</td><td>æ±‚ä½™</td></tr><tr><td>==</td><td>ç›¸ç­‰</td></tr><tr><td>=</td><td>èµ‹å€¼</td></tr><tr><td>!=</td><td>ä¸ç›¸ç­‰</td></tr><tr><td>!</td><td>ä¸</td></tr><tr><td>-o</td><td>æˆ–</td></tr><tr><td>-a</td><td>é</td></tr></tbody></table><h4 id="ä¾‹å­ï¼š-1"><a href="#ä¾‹å­ï¼š-1" class="headerlink" title="ä¾‹å­ï¼š"></a>ä¾‹å­ï¼š</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">a=3</span><br><span class="line">b=5</span><br><span class="line">val=`expr $a / $b`</span><br><span class="line">echo &quot;Total value : $val&quot;</span><br><span class="line"></span><br><span class="line">val=`expr $a % $b`</span><br><span class="line">echo &quot;Total value : $val&quot;</span><br><span class="line"></span><br><span class="line">if [ $a == $b ]</span><br><span class="line">then</span><br><span class="line">   echo &quot;a is equal to b&quot;</span><br><span class="line">fi</span><br><span class="line">if [ $a != $b ]</span><br><span class="line">then</span><br><span class="line">   echo &quot;a is not equal to b&quot;</span><br><span class="line">fi</span><br></pre></td></tr></table></figure><h3 id="å…³ç³»è¿ç®—ç¬¦"><a href="#å…³ç³»è¿ç®—ç¬¦" class="headerlink" title="å…³ç³»è¿ç®—ç¬¦"></a>å…³ç³»è¿ç®—ç¬¦</h3><table><thead><tr><th>è¿ç®—ç¬¦</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td>-eq</td><td>ä¸¤ä¸ªæ•°ç›¸ç­‰è¿”å›true</td></tr><tr><td>-ne</td><td>ä¸¤ä¸ªæ•°ä¸ç›¸ç­‰è¿”å›true</td></tr><tr><td>-gt</td><td>å·¦ä¾§æ•°å¤§äºå³ä¾§æ•°è¿”å›true</td></tr><tr><td>-It</td><td>å·¦ä¾§æ•°å°äºå³ä¾§æ•°è¿”å›true</td></tr><tr><td>-ge</td><td>å·¦ä¾§æ•°å¤§äºç­‰äºå³ä¾§æ•°è¿”å›true</td></tr><tr><td>-le</td><td>å·¦ä¾§æ•°å°äºç­‰äºå³ä¾§æ•°è¿”å›true</td></tr></tbody></table><h4 id="ä¾‹å­ï¼š-2"><a href="#ä¾‹å­ï¼š-2" class="headerlink" title="ä¾‹å­ï¼š"></a>ä¾‹å­ï¼š</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/sh</span></span><br><span class="line">a=10</span><br><span class="line">b=20</span><br><span class="line">if [ $a -eq $b ]</span><br><span class="line">then</span><br><span class="line">   echo &quot;true&quot;</span><br><span class="line">else</span><br><span class="line">   echo &quot;false&quot;</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">if [ $a -ne $b ]</span><br><span class="line">then</span><br><span class="line">   echo &quot;true&quot;</span><br><span class="line">else</span><br><span class="line">   echo &quot;false&quot;</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">if [ $a -gt $b ]</span><br><span class="line">then</span><br><span class="line">   echo &quot;true&quot;</span><br><span class="line">else</span><br><span class="line">   echo &quot;false&quot;</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">if [ $a -lt $b ]</span><br><span class="line">then</span><br><span class="line">   echo &quot;true&quot;</span><br><span class="line">else</span><br><span class="line">   echo &quot;false&quot;</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">if [ $a -ge $b ]</span><br><span class="line">then</span><br><span class="line">   echo &quot;true&quot;</span><br><span class="line">else</span><br><span class="line">   echo &quot;false&quot;</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">if [ $a -le $b ]</span><br><span class="line">then</span><br><span class="line">   echo &quot;true&quot;</span><br><span class="line">else</span><br><span class="line">   echo &quot;false&quot;</span><br><span class="line">fi</span><br></pre></td></tr></table></figure><h3 id="å­—ç¬¦ä¸²è¿ç®—ç¬¦"><a href="#å­—ç¬¦ä¸²è¿ç®—ç¬¦" class="headerlink" title="å­—ç¬¦ä¸²è¿ç®—ç¬¦"></a>å­—ç¬¦ä¸²è¿ç®—ç¬¦</h3><table><thead><tr><th>è¿ç®—ç¬¦</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td>=</td><td>ä¸¤ä¸ªå­—ç¬¦ä¸²ç›¸ç­‰è¿”å›true</td></tr><tr><td>!=</td><td>ä¸¤ä¸ªå­—ç¬¦ä¸²ä¸ç›¸ç­‰è¿”å›true</td></tr><tr><td>-z</td><td>å­—ç¬¦ä¸²é•¿åº¦ä¸º0è¿”å›true</td></tr><tr><td>-n</td><td>å­—ç¬¦ä¸²é•¿åº¦ä¸ä¸º0è¿”å›true</td></tr></tbody></table><p>è¿˜æœ‰ï¼š</p><table><thead><tr><th>è¿ç®—ç¬¦</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td>-d file</td><td>æ£€æµ‹æ–‡ä»¶æ˜¯å¦æ˜¯ç›®å½•ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™è¿”å› true</td></tr><tr><td>-r file</td><td>æ£€æµ‹æ–‡ä»¶æ˜¯å¦å¯è¯»ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™è¿”å› true</td></tr><tr><td>-w file</td><td>æ£€æµ‹æ–‡ä»¶æ˜¯å¦å¯å†™ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™è¿”å› true</td></tr><tr><td>-x file</td><td>æ£€æµ‹æ–‡ä»¶æ˜¯å¦å¯æ‰§è¡Œï¼Œå¦‚æœæ˜¯ï¼Œåˆ™è¿”å› true</td></tr><tr><td>-s file</td><td>æ£€æµ‹æ–‡ä»¶æ˜¯å¦ä¸ºç©ºï¼ˆæ–‡ä»¶å¤§å°æ˜¯å¦å¤§äº0ï¼Œä¸ä¸ºç©ºè¿”å› true</td></tr><tr><td>-e file</td><td>æ£€æµ‹æ–‡ä»¶ï¼ˆåŒ…æ‹¬ç›®å½•ï¼‰æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™è¿”å› true</td></tr></tbody></table><h3 id="å­—ç¬¦ä¸²"><a href="#å­—ç¬¦ä¸²" class="headerlink" title="å­—ç¬¦ä¸²"></a>å­—ç¬¦ä¸²</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/sh</span></span><br><span class="line">mtext=&quot;hello&quot;  #å®šä¹‰å­—ç¬¦ä¸²</span><br><span class="line">mtext2=&quot;world&quot;</span><br><span class="line">mtext3=$mtext&quot; &quot;$mtext2  #å­—ç¬¦ä¸²çš„æ‹¼æ¥</span><br><span class="line">echo $mtext3  #è¾“å‡ºå­—ç¬¦ä¸²</span><br><span class="line">echo $&#123;#mtext3&#125;  #è¾“å‡ºå­—ç¬¦ä¸²é•¿åº¦</span><br><span class="line">echo $&#123;mtext3:1:4&#125;  #æˆªå–å­—ç¬¦ä¸²</span><br></pre></td></tr></table></figure><h3 id="æ•°ç»„"><a href="#æ•°ç»„" class="headerlink" title="æ•°ç»„"></a>æ•°ç»„</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/sh</span></span><br><span class="line">array=(1 2 3 4 5)  #å®šä¹‰æ•°ç»„</span><br><span class="line">array2=(aa bb cc dd ee)  #å®šä¹‰æ•°ç»„</span><br><span class="line">value=$&#123;array[3]&#125;  #æ‰¾åˆ°æŸä¸€ä¸ªä¸‹æ ‡çš„æ•°ï¼Œç„¶åèµ‹å€¼</span><br><span class="line">echo $value  #æ‰“å°</span><br><span class="line">value2=$&#123;array2[3]&#125;  #æ‰¾åˆ°æŸä¸€ä¸ªä¸‹æ ‡çš„æ•°ï¼Œç„¶åèµ‹å€¼</span><br><span class="line">echo $value2  #æ‰“å°</span><br><span class="line">length=$&#123;#array[*]&#125;  #è·å–æ•°ç»„é•¿åº¦</span><br><span class="line">echo $length</span><br></pre></td></tr></table></figure><h3 id="è¾“å‡ºç¨‹åº"><a href="#è¾“å‡ºç¨‹åº" class="headerlink" title="è¾“å‡ºç¨‹åº"></a>è¾“å‡ºç¨‹åº</h3><p><strong>echo</strong></p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/sh</span></span><br><span class="line">echo &quot;hello world&quot;  </span><br><span class="line">echo hello world  </span><br><span class="line"></span><br><span class="line">text=&quot;hello world&quot;</span><br><span class="line">echo $text</span><br><span class="line">echo -e &quot;hello world&quot;  #è¾“å‡ºå¹¶ä¸”æ¢è¡Œ</span><br><span class="line">echo &quot;hello world&quot; &gt; a.txt  #é‡å®šå‘åˆ°æ–‡ä»¶</span><br><span class="line">echo `date`  #è¾“å‡ºå½“å‰ç³»ç»Ÿæ—¶é—´</span><br></pre></td></tr></table></figure><h3 id="åˆ¤æ–­è¯­å¥"><a href="#åˆ¤æ–­è¯­å¥" class="headerlink" title="åˆ¤æ–­è¯­å¥"></a>åˆ¤æ–­è¯­å¥</h3><ul><li>if</li><li>if-else</li><li>if-elseIf</li><li>case</li></ul><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/sh</span></span><br><span class="line">a=10</span><br><span class="line">b=20</span><br><span class="line">if [ $a == $b ]</span><br><span class="line">then</span><br><span class="line">   echo &quot;true&quot;</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if [ $a == $b ]</span><br><span class="line">then</span><br><span class="line">   echo &quot;true&quot;</span><br><span class="line">else</span><br><span class="line">   echo &quot;false&quot;</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if [ $a == $b ]</span><br><span class="line">then</span><br><span class="line">   echo &quot;a is equal to b&quot;</span><br><span class="line">elif [ $a -gt $b ]</span><br><span class="line">then</span><br><span class="line">   echo &quot;a is greater than b&quot;</span><br><span class="line">elif [ $a -lt $b ]</span><br><span class="line">then</span><br><span class="line">   echo &quot;a is less than b&quot;</span><br><span class="line">else</span><br><span class="line">   echo &quot;None of the condition met&quot;</span><br><span class="line">fi</span><br></pre></td></tr></table></figure><h3 id="testå‘½ä»¤"><a href="#testå‘½ä»¤" class="headerlink" title="testå‘½ä»¤"></a>testå‘½ä»¤</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">test $[num1] -eq $[num2]  #åˆ¤æ–­ä¸¤ä¸ªå˜é‡æ˜¯å¦ç›¸ç­‰</span><br><span class="line">test num1=num2  #åˆ¤æ–­ä¸¤ä¸ªæ•°å­—æ˜¯å¦ç›¸ç­‰</span><br></pre></td></tr></table></figure><table><thead><tr><th>å‚æ•°</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td>-e file</td><td>æ–‡ä»¶å­˜åœ¨åˆ™è¿”å›çœŸ</td></tr><tr><td>-r file</td><td>æ–‡ä»¶å­˜åœ¨å¹¶ä¸”å¯è¯»åˆ™è¿”å›çœŸ</td></tr><tr><td>-w file</td><td>æ–‡ä»¶å­˜åœ¨å¹¶ä¸”å¯å†™åˆ™è¿”å›çœŸ</td></tr><tr><td>-x file</td><td>æ–‡ä»¶å­˜åœ¨å¹¶ä¸”å¯æ‰§è¡Œåˆ™è¿”å›çœŸ</td></tr><tr><td>-s file</td><td>æ–‡ä»¶å­˜åœ¨å¹¶ä¸”å†…å®¹ä¸ä¸ºç©ºåˆ™è¿”å›çœŸ</td></tr><tr><td>-d file</td><td>æ–‡ä»¶ç›®å½•å­˜åœ¨åˆ™è¿”å›çœŸ</td></tr></tbody></table><h3 id="forå¾ªç¯"><a href="#forå¾ªç¯" class="headerlink" title="forå¾ªç¯"></a>forå¾ªç¯</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/sh</span></span><br><span class="line"></span><br><span class="line">for i in &#123;1..5&#125;</span><br><span class="line">do</span><br><span class="line">    echo $i</span><br><span class="line">done</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">for i in 5 6 7 8 9</span><br><span class="line">do</span><br><span class="line">    echo $i</span><br><span class="line">done</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">for FILE in $HOME/.bash*</span><br><span class="line">do</span><br><span class="line">   echo $FILE</span><br><span class="line">done</span><br></pre></td></tr></table></figure><h3 id="whileå¾ªç¯"><a href="#whileå¾ªç¯" class="headerlink" title="whileå¾ªç¯"></a>whileå¾ªç¯</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/sh</span></span><br><span class="line">COUNTER=0</span><br><span class="line">while [ $COUNTER -lt 5 ]</span><br><span class="line">do</span><br><span class="line">    COUNTER=`expr $COUNTER + 1`</span><br><span class="line">    echo $COUNTER</span><br><span class="line">done</span><br><span class="line"></span><br><span class="line">echo &#x27;è¯·è¾“å…¥ã€‚ã€‚ã€‚&#x27;</span><br><span class="line">echo &#x27;ctrl + d å³å¯åœæ­¢è¯¥ç¨‹åº&#x27;</span><br><span class="line">while read FILM</span><br><span class="line">do</span><br><span class="line">    echo &quot;Yeah! great film the $FILM&quot;</span><br><span class="line">done</span><br></pre></td></tr></table></figure><p>ä»¥ä¸Šæ˜¯whileå¾ªç¯çš„ä¸¤ç§ç”¨æ³•ï¼Œç¬¬ä¸€ç§æ˜¯æ¯”è¾ƒå¸¸è§„çš„ï¼Œæ‰§è¡Œå¾ªç¯ï¼Œç„¶åæ¯æ¬¡éƒ½æŠŠæ§åˆ¶çš„æ•°åŠ 1ï¼Œå°±å¯ä»¥è®©whileå¾ªç¯æœ‰é€€å‡ºçš„æ¡ä»¶äº†ã€‚ç¬¬äºŒç§æ˜¯ç”¨æˆ·ä»é”®ç›˜æ•°æ®ï¼Œç„¶åæŠŠç”¨æˆ·è¾“å…¥çš„æ–‡å­—è¾“å‡ºå‡ºæ¥ã€‚</p><h3 id="è·³å‡ºå¾ªç¯"><a href="#è·³å‡ºå¾ªç¯" class="headerlink" title="è·³å‡ºå¾ªç¯"></a>è·³å‡ºå¾ªç¯</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">break  #è·³å‡ºæ‰€æœ‰å¾ªç¯</span><br><span class="line">break n  #è·³å‡ºç¬¬nå±‚få¾ªç¯</span><br><span class="line">continue  #è·³å‡ºå½“å‰å¾ªç¯</span><br></pre></td></tr></table></figure><h3 id="å‡½æ•°"><a href="#å‡½æ•°" class="headerlink" title="å‡½æ•°"></a>å‡½æ•°</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/sh</span></span><br><span class="line"></span><br><span class="line">sysout()&#123;</span><br><span class="line">    echo &quot;hello world&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">sysout</span><br></pre></td></tr></table></figure><p>å®šä¹‰ä¸€ä¸ªæ²¡æœ‰è¿”å›å€¼çš„å‡½æ•°ï¼Œç„¶åè°ƒç”¨è¯¥å‡½æ•°ã€‚</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/sh</span></span><br><span class="line"></span><br><span class="line">test()&#123;</span><br><span class="line"></span><br><span class="line">    aNum=3</span><br><span class="line">    anotherNum=5</span><br><span class="line">    return $(($aNum+$anotherNum))</span><br><span class="line">&#125;</span><br><span class="line">test</span><br><span class="line">result=$?</span><br><span class="line">echo $result</span><br></pre></td></tr></table></figure><p>å®šä¹‰ä¸€ä¸ªæœ‰è¿”å›å€¼çš„å‡½æ•°ï¼Œè°ƒç”¨è¯¥å‡½æ•°ï¼Œè¾“å‡ºç»“æœã€‚</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/sh</span></span><br><span class="line"></span><br><span class="line">test()&#123;</span><br><span class="line">    echo $1  #æ¥æ”¶ç¬¬ä¸€ä¸ªå‚æ•°</span><br><span class="line">    echo $2  #æ¥æ”¶ç¬¬äºŒä¸ªå‚æ•°</span><br><span class="line">    echo $3  #æ¥æ”¶ç¬¬ä¸‰ä¸ªå‚æ•°</span><br><span class="line">    echo $#  #æ¥æ”¶åˆ°å‚æ•°çš„ä¸ªæ•°</span><br><span class="line">    echo $*  #æ¥æ”¶åˆ°çš„æ‰€æœ‰å‚æ•°</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">test aa bb cc</span><br></pre></td></tr></table></figure><p>å®šä¹‰äº†ä¸€ä¸ªéœ€è¦ä¼ é€’å‚æ•°çš„å‡½æ•°ã€‚</p><h3 id="é‡å®šå‘"><a href="#é‡å®šå‘" class="headerlink" title="é‡å®šå‘"></a>é‡å®šå‘</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">echo result &gt; file  #å°†ç»“æœå†™å…¥æ–‡ä»¶ï¼Œç»“æœä¸ä¼šåœ¨æ§åˆ¶å°å±•ç¤ºï¼Œè€Œæ˜¯åœ¨æ–‡ä»¶ä¸­ï¼Œè¦†ç›–å†™</span><br><span class="line">echo result &gt;&gt; file  #å°†ç»“æœå†™å…¥æ–‡ä»¶ï¼Œç»“æœä¸ä¼šåœ¨æ§åˆ¶å°å±•ç¤ºï¼Œè€Œæ˜¯åœ¨æ–‡ä»¶ä¸­ï¼Œè¿½åŠ å†™</span><br><span class="line">echo input &lt; file  #è·å–è¾“å…¥æµ</span><br></pre></td></tr></table></figure><h3 id="å†™ä¸€ä¸ªè‡ªåŠ¨è¾“å…¥å‘½ä»¤çš„è„šæœ¬"><a href="#å†™ä¸€ä¸ªè‡ªåŠ¨è¾“å…¥å‘½ä»¤çš„è„šæœ¬" class="headerlink" title="å†™ä¸€ä¸ªè‡ªåŠ¨è¾“å…¥å‘½ä»¤çš„è„šæœ¬"></a>å†™ä¸€ä¸ªè‡ªåŠ¨è¾“å…¥å‘½ä»¤çš„è„šæœ¬</h3><p><strong>è‡ªåŠ¨æäº¤githubçš„è„šæœ¬</strong></p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line">echo &quot;-------Begin-------&quot;</span><br><span class="line">git add .</span><br><span class="line">git commit -m $1</span><br><span class="line">echo $1</span><br><span class="line">git push origin master</span><br><span class="line">echo &quot;--------End--------&quot;</span><br></pre></td></tr></table></figure><h2 id="IntelliJ-IDEAä¸­ç¼–å†™Shellè„šæœ¬"><a href="#IntelliJ-IDEAä¸­ç¼–å†™Shellè„šæœ¬" class="headerlink" title="IntelliJ IDEAä¸­ç¼–å†™Shellè„šæœ¬"></a>IntelliJ IDEAä¸­ç¼–å†™Shellè„šæœ¬</h2><p>ä½¿ç”¨<code>bashsupport</code>æ’ä»¶ã€‚</p><p>å…·ä½“å‚è€ƒè¿™ä¸ªé“¾æ¥ï¼š<a href="https://blog.csdn.net/u012443641/article/details/81295999">IDEAä¸­ç¼–å†™è„šæœ¬å¹¶è¿è¡Œshellè„šæœ¬</a></p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul><li> [ç¨‹åºçŒ¿] å¾®ä¿¡å…¬ä¼—å·</li><li><a href="https://www.jianshu.com/p/71cb62f08768"><strong>å…³ç®ç³linSir</strong></a></li></ul>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®°æœ¬ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> Shell </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ­å»ºGitæœåŠ¡å™¨</title>
      <link href="post/3721444167/"/>
      <url>post/3721444167/</url>
      
        <content type="html"><![CDATA[<blockquote><p>è™½ç„¶ä»¥å‰ä¹Ÿæ­è¿‡ï¼Œä½†æ˜¯é‡æ–°æ­å»ºä¸€æ¬¡çš„æ—¶å€™è¿˜è¦é‡æ–°ä»ç½‘ç»œä¸ŠæŸ¥æ‰¾èµ„æ–™ï¼›</p><p>æœ€è¿‘æƒ³ç€åˆ«æŠŠç§Ÿæ¥çš„æœåŠ¡å™¨è’äº†ï¼Œè‡ªå·±æ­ä¸ª<code>Git</code>æœåŠ¡å™¨æ”¾ç‚¹ä¸œè¥¿ä¸Šå»ï¼Œé¡ºè·¯è®°å½•ä¸€æ³¢æ­å»ºè¿‡ç¨‹ã€‚</p></blockquote><h2 id="ç¬¬ä¸€æ­¥"><a href="#ç¬¬ä¸€æ­¥" class="headerlink" title="ç¬¬ä¸€æ­¥"></a>ç¬¬ä¸€æ­¥</h2><p>åœ¨æœåŠ¡å™¨ä¸Šå®‰è£… <code>git</code>ï¼š</p><p><code>centos</code>ï¼š</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo yum install git</span><br></pre></td></tr></table></figure><p><code>ubuntu</code>ï¼š</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo apt-get install git</span><br></pre></td></tr></table></figure><h2 id="ç¬¬äºŒæ­¥"><a href="#ç¬¬äºŒæ­¥" class="headerlink" title="ç¬¬äºŒæ­¥"></a>ç¬¬äºŒæ­¥</h2><p>åˆ›å»º <code>git</code> ç”¨æˆ·ï¼Œç”¨æ¥è¿è¡Œ<code>git</code>æœåŠ¡</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo adduser git</span><br></pre></td></tr></table></figure><p>å¯ä»¥åŒæ—¶ä¸º<code>git</code>ç”¨æˆ·ä¿®æ”¹å¯†ç </p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo passwd git</span><br></pre></td></tr></table></figure><h2 id="ç¬¬ä¸‰æ­¥"><a href="#ç¬¬ä¸‰æ­¥" class="headerlink" title="ç¬¬ä¸‰æ­¥"></a>ç¬¬ä¸‰æ­¥</h2><p><strong>å…å¯†ç™»å½•</strong></p><p>é€šè¿‡è¯ä¹¦çš„æ–¹å¼æ¥é€šè¿‡<code>ssh</code>ä½¿ç”¨<code>git</code>åŠŸèƒ½ï¼Œéœ€è¦åˆ›å»ºè¯ä¹¦ï¼Œå¹¶æ”¶é›†éœ€è¦ç™»å½•çš„ç”¨æˆ·çš„å…¬é’¥æ–‡ä»¶ï¼ˆ<code>~/.ssh/id_rsa.pub</code>ï¼‰ï¼Œå¯¼å…¥åˆ°/<code>home/git/.ssh/authorized_keys</code>æ–‡ä»¶å†…ï¼Œä¸€è¡Œä¸€ä¸ªï¼›</p><blockquote><p>å…¬é’¥å¯ä»¥é€šè¿‡æ‰§è¡Œ<code>ssh-keygen -t rsa -C &quot;yourname@mail.com&quot;</code>è¿›è¡Œç”Ÿæˆ</p></blockquote><p><strong>ä¿®æ”¹<code>authorized_keys</code>æ–‡ä»¶çš„æƒé™</strong></p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">chmod 600 authorized_keys</span><br></pre></td></tr></table></figure><p><em>è¿™ä¸€æ­¥å¿…é¡»è¦åšï¼Œä¸ç„¶éªŒè¯çš„æ—¶å€™è¿˜æ˜¯ä¼šéœ€è¦è®©ä½ è¾“å…¥å¯†ç ï¼Œå…·ä½“åŸå› ä¸çŸ¥ï¼›</em></p><h2 id="ç¬¬å››æ­¥"><a href="#ç¬¬å››æ­¥" class="headerlink" title="ç¬¬å››æ­¥"></a>ç¬¬å››æ­¥</h2><p>åˆå§‹åŒ–<code>git</code>ä»“åº“ï¼Œæ‰¾ä¸ªåœ°æ”¾ç”¨æ¥æ”¾ä½ çš„<code>git</code>ä»“åº“ï¼Œè¿™é‡Œæˆ‘é€‰äº†<code>/data/repositorys</code>è¿™ä¸ªè·¯å¾„ï¼›</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git init --bare TestGit.git</span><br></pre></td></tr></table></figure><p><code>git</code>åˆ›å»ºä¸€ä¸ªè£¸ä»“åº“ï¼Œè£¸ä»“åº“æ²¡æœ‰å·¥ä½œåŒºï¼Œå› ä¸ºæœåŠ¡å™¨ä¸Šçš„gitä»“åº“çº¯ç²¹ä¸ºäº†å…±äº«ï¼Œæ‰€æœ‰ä¸èƒ½è®©ç”¨æˆ·ç›´æ¥ç™»å½•åˆ°æœåŠ¡å™¨ä¸Šå»æ”¹å·¥ä½œåŒºï¼Œå¹¶ä¸”æœåŠ¡å™¨çš„<code>git</code>ä»“åº“é€šå¸¸ä»¥ <code>.git</code> ç»“å°¾ã€‚ç„¶åï¼Œä¿®æ”¹<code>owner</code>æ”¹ä¸º<code>git</code>ï¼š</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo chown -R git:git TestGit.git</span><br></pre></td></tr></table></figure><h2 id="ç¬¬äº”æ­¥"><a href="#ç¬¬äº”æ­¥" class="headerlink" title="ç¬¬äº”æ­¥"></a>ç¬¬äº”æ­¥</h2><p>ç¦ç”¨<code>shell</code>ç™»å½•ï¼š<br>å¤„äºå®‰å…¨çš„è€ƒè™‘ï¼Œç¬¬äºŒæ­¥åˆ›å»ºçš„gitç”¨æˆ·ä¸å…è®¸ç™»å½•<code>shell</code>ï¼Œè¿™å¯ä»¥é€šè¿‡ç¼–è¾‘ <code>/etc/passwd</code>æ–‡ä»¶å®Œæˆã€‚</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git:x:1003:1003::/home/git:/bin/bash</span><br></pre></td></tr></table></figure><p>æ”¹ä¸ºï¼š</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git:x:1003:1003::/home/git:/usr/bin/git-shell</span><br></pre></td></tr></table></figure><p>è¿™æ ·ï¼Œ<code>git</code>ç”¨æˆ·å¯ä»¥æ­£å¸¸é€šè¿‡<code>ssh</code>ä½¿ç”¨<code>git</code>ï¼Œä½†æ— æ³•ç™»å½•<code>shell</code>ï¼Œå› ä¸ºæˆ‘ä»¬ä¸ºgitç”¨æˆ·æŒ‡å®šçš„<code>git-shell</code>æ¯æ¬¡ä¸€ç™»å½•å°±è‡ªåŠ¨é€€å‡ºã€‚</p><h2 id="ç¬¬å…­æ­¥"><a href="#ç¬¬å…­æ­¥" class="headerlink" title="ç¬¬å…­æ­¥"></a>ç¬¬å…­æ­¥</h2><p>éªŒè¯ï¼Œå…‹éš†è¿œç¨‹ä»“åº“ï¼š<br>ç°åœ¨ï¼Œå¯ä»¥é€šè¿‡<code>git clone</code>å‘½ä»¤å…‹éš†è¿œç¨‹ä»“åº“äº†ï¼Œåœ¨å„è‡ªçš„ç”µè„‘ä¸Šè¿è¡Œï¼š</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git clone git@server:/data/repositorys/TestGit.git</span><br></pre></td></tr></table></figure><p>å¦‚æœæœåŠ¡å™¨<code>SSH</code>ç«¯å£ä¸æ˜¯é»˜è®¤çš„22çš„è¯ï¼Œå¯ä»¥è¿™æ ·ï¼š</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git clone ssh://git@server:port/data/repositorys/TestGit.git</span><br></pre></td></tr></table></figure><p>è¿è¡Œå®Œæˆåï¼Œæ­£å¸¸çš„æƒ…å†µä¸‹ä¼šå‡ºç°ä»¥ä¸‹æç¤ºï¼š</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">Cloning into &#x27;TestGit&#x27;...</span><br><span class="line">warning: You appear to have cloned an empty repository.</span><br></pre></td></tr></table></figure><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul><li><a href="https://google.com/">Google</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®°æœ¬ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Git </tag>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Dockerä½¿ç”¨redisé•œåƒ</title>
      <link href="post/3795648683/"/>
      <url>post/3795648683/</url>
      
        <content type="html"><![CDATA[<blockquote><p>Redisæ˜¯ä¸€ä¸ªå¼€æºçš„ï¼Œè”ç½‘çš„ï¼Œå†…å­˜ä¸­çš„é”®å€¼æ•°æ®å­˜å‚¨ï¼Œå…·æœ‰å¯é€‰çš„æŒä¹…æ€§ã€‚</p></blockquote><h1 id="å®‰è£…redis"><a href="#å®‰è£…redis" class="headerlink" title="å®‰è£…redis"></a>å®‰è£…redis</h1><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker pull redis</span><br></pre></td></tr></table></figure><h1 id="å¯åŠ¨Dockerå®ä¾‹"><a href="#å¯åŠ¨Dockerå®ä¾‹" class="headerlink" title="å¯åŠ¨Dockerå®ä¾‹"></a>å¯åŠ¨Dockerå®ä¾‹</h1><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker run --name some-redis -d redis</span><br></pre></td></tr></table></figure><p>æˆ–è€…<strong>ä»æŒä¹…å­˜å‚¨å¼€å§‹ï¼š</strong></p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker run --name some-redis -d redis redis-server --appendonly yes</span><br></pre></td></tr></table></figure><p>ç»‘å®šæœ¬åœ°ç«¯å£ï¼š</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker run --name dev-redis -p 6379:6379 -d redis redis-server --appendonly yes</span><br></pre></td></tr></table></figure><p>æˆ–è€…<strong>é€šè¿‡redis-cli</strong></p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker run -it --link some-redis:redis --rm redis redis-cli -h redis -p 6379</span><br></pre></td></tr></table></figure><h2 id="å¦å¤–ï¼Œå¦‚æœæƒ³ä½¿ç”¨è‡ªå·±çš„redis-conf-â€¦â€¦"><a href="#å¦å¤–ï¼Œå¦‚æœæƒ³ä½¿ç”¨è‡ªå·±çš„redis-conf-â€¦â€¦" class="headerlink" title="å¦å¤–ï¼Œå¦‚æœæƒ³ä½¿ç”¨è‡ªå·±çš„redis.conf â€¦â€¦"></a>å¦å¤–ï¼Œå¦‚æœæƒ³ä½¿ç”¨è‡ªå·±çš„redis.conf â€¦â€¦</h2><p> æ‚¨å¯ä»¥åˆ›å»ºè‡ªå·±çš„Dockerfileï¼Œå°†ä¸Šä¸‹æ–‡ä¸­çš„redis.confæ·»åŠ åˆ°/ data /ä¸­ï¼Œå°±åƒè¿™æ ·ï¼š</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">FROM redis</span><br><span class="line">COPY redis.conf /usr/local/etc/redis/redis.conf</span><br><span class="line">CMD [ &quot;redis-server&quot;, &quot;/usr/local/etc/redis/redis.conf&quot; ]</span><br></pre></td></tr></table></figure><p>æˆ–è€…ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨<code>docker run</code>é€‰é¡¹åœ¨ç›¸åŒçš„è¡Œä¸­æŒ‡å®šæŸäº›å†…å®¹ï¼š</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker run -v /myredis/conf/redis.conf:/usr/local/etc/redis/redis.conf \ </span><br><span class="line">--name myredis redis redis-server /usr/local/etc/redis/redis.conf</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®°æœ¬ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Docker </tag>
            
            <tag> Redis </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Dockerå…sudoæ“ä½œ</title>
      <link href="post/6082d88c/"/>
      <url>post/6082d88c/</url>
      
        <content type="html"><![CDATA[<blockquote><p>Dockerå‘½ä»¤é»˜è®¤åœ¨Linuxé»˜è®¤ä½¿ç”¨rootç”¨æˆ·æ‰§è¡Œï¼Œå®˜æ–¹åŸæ–‡ï¼š</p><p>The docker daemon binds to a Unix socket instead of a TCP port. By default that Unix socket is owned by the user root and other users can access it with sudo. For this reason, docker daemon always runs as the root user.<br>To avoid having to use sudo when you use the docker command, create a Unix group called docker and add users to it. When the docker daemon starts, it makes the ownership of the Unix socket read/writable by the docker group.</p><p>dockerå®ˆæŠ¤ç¨‹åºç»‘å®šåˆ°Unixå¥—æ¥å­—è€Œä¸æ˜¯TCPç«¯å£ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼ŒUnixå¥—æ¥å­—ç”±ç”¨æˆ·rootæ‹¥æœ‰ï¼Œå…¶ä»–ç”¨æˆ·å¯ä»¥ä½¿ç”¨sudoè®¿é—®å®ƒã€‚ å› æ­¤ï¼Œdockerå®ˆæŠ¤ç¨‹åºå§‹ç»ˆä»¥rootç”¨æˆ·èº«ä»½è¿è¡Œã€‚<br>è¦é¿å…åœ¨ä½¿ç”¨dockerå‘½ä»¤æ—¶ä½¿ç”¨sudoï¼Œè¯·åˆ›å»ºä¸€ä¸ªåä¸ºdockerçš„Unixç»„å¹¶å‘å…¶æ·»åŠ ç”¨æˆ·ã€‚ å½“dockerå®ˆæŠ¤ç¨‹åºå¯åŠ¨æ—¶ï¼Œå®ƒä¼šä½¿dockerç»„å¯¹Unixå¥—æ¥å­—çš„æ‰€æœ‰æƒè¿›è¡Œè¯»/å†™ã€‚</p></blockquote><p><strong>ä½†æ˜¯æˆ‘ä»¬è‡ªå·±ä½¿ç”¨çš„æ—¶å€™é€šå¸¸ä¼šè§‰å¾—æ¯”è¾ƒéº»çƒ¦ï¼Œ</strong>ä»¥ä¸‹æ­¥éª¤å°†ç”¨æˆ·åŠ å…¥Dockerç”¨æˆ·ç»„ï¼Œä¸éœ€è¦ä½¿ç”¨sudoå‘½ä»¤æ¥æ‰§è¡Œdockerçš„å‘½ä»¤ã€‚</p><h3 id="åˆ›å»ºdockerç»„"><a href="#åˆ›å»ºdockerç»„" class="headerlink" title="åˆ›å»ºdockerç»„"></a>åˆ›å»ºdockerç»„</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo groupadd docker</span><br></pre></td></tr></table></figure><h3 id="å°†å½“å‰ç”¨æˆ·åŠ å…¥dockerç»„"><a href="#å°†å½“å‰ç”¨æˆ·åŠ å…¥dockerç»„" class="headerlink" title="å°†å½“å‰ç”¨æˆ·åŠ å…¥dockerç»„"></a>å°†å½“å‰ç”¨æˆ·åŠ å…¥dockerç»„</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo gpasswd -a $&#123;USER&#125; docker</span><br></pre></td></tr></table></figure><h3 id="é‡æ–°å¯åŠ¨dockeræœåŠ¡ï¼ˆä¸‹é¢æ˜¯CentOS7çš„å‘½ä»¤ï¼‰"><a href="#é‡æ–°å¯åŠ¨dockeræœåŠ¡ï¼ˆä¸‹é¢æ˜¯CentOS7çš„å‘½ä»¤ï¼‰" class="headerlink" title="é‡æ–°å¯åŠ¨dockeræœåŠ¡ï¼ˆä¸‹é¢æ˜¯CentOS7çš„å‘½ä»¤ï¼‰"></a>é‡æ–°å¯åŠ¨dockeræœåŠ¡ï¼ˆä¸‹é¢æ˜¯CentOS7çš„å‘½ä»¤ï¼‰</h3> <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo systemctl restart docker</span><br></pre></td></tr></table></figure><h3 id="å½“å‰ç”¨æˆ·é€€å‡ºç³»ç»Ÿé‡æ–°ç™»é™†"><a href="#å½“å‰ç”¨æˆ·é€€å‡ºç³»ç»Ÿé‡æ–°ç™»é™†" class="headerlink" title="å½“å‰ç”¨æˆ·é€€å‡ºç³»ç»Ÿé‡æ–°ç™»é™†"></a>å½“å‰ç”¨æˆ·é€€å‡ºç³»ç»Ÿé‡æ–°ç™»é™†</h3><p> é‡æ–°ç™»å½•åå¯ä»¥ç›´æ¥æ‰§è¡Œdockerå‘½ä»¤ï¼š</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker ps</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®°æœ¬ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Docker </tag>
            
            <tag> å…sudo </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linuxä¸­æ–¹ä¾¿çš„Bashåˆ«å</title>
      <link href="post/3554012870/"/>
      <url>post/3554012870/</url>
      
        <content type="html"><![CDATA[<blockquote><p>Linuxä¸­é€šè¿‡aliasåˆ›å»ºåˆ«å, å¯ä»¥å°†å‘½ä»¤è¡Œä¸Šå¸¸ç”¨çš„é•¿å‘½ä»¤ç®€åŒ–æˆä¸€ä¸ªæ˜“æ‡‚çš„çŸ­å‘½ä»¤æ¥ä½¿ç”¨;</p><p>è¦ä½¿ç”¨Bashåˆ«å, éœ€è¦å°†å…¶æ·»åŠ åˆ°<code>.bash_profile</code>æ–‡ä»¶, è¯¥æ–‡ä»¶ä½äº <code>~/</code>ç›®å½•ä¸­.</p></blockquote><h3 id="è§£å‹taræ–‡ä»¶"><a href="#è§£å‹taræ–‡ä»¶" class="headerlink" title="è§£å‹taræ–‡ä»¶"></a>è§£å‹taræ–‡ä»¶</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">alias untar=&#x27;tar -zxvf &#x27;</span><br></pre></td></tr></table></figure><h3 id="ä¸‹è½½å‡ºé—®é¢˜-æ¢å¤ä¸‹è½½"><a href="#ä¸‹è½½å‡ºé—®é¢˜-æ¢å¤ä¸‹è½½" class="headerlink" title="ä¸‹è½½å‡ºé—®é¢˜, æ¢å¤ä¸‹è½½"></a>ä¸‹è½½å‡ºé—®é¢˜, æ¢å¤ä¸‹è½½</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">alias wget=&#x27;wget -c &#x27;</span><br></pre></td></tr></table></figure><h3 id="ä¸‹è½½æ–‡ä»¶å¹¶æµ‹è¯•æ ¡éªŒå’Œ"><a href="#ä¸‹è½½æ–‡ä»¶å¹¶æµ‹è¯•æ ¡éªŒå’Œ" class="headerlink" title="ä¸‹è½½æ–‡ä»¶å¹¶æµ‹è¯•æ ¡éªŒå’Œ"></a>ä¸‹è½½æ–‡ä»¶å¹¶æµ‹è¯•æ ¡éªŒå’Œ</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">alias sha=&#x27;shasum -a 256 &#x27;</span><br></pre></td></tr></table></figure><h3 id="pingå‘½ä»¤é™åˆ¶åœ¨5ä¸ªping"><a href="#pingå‘½ä»¤é™åˆ¶åœ¨5ä¸ªping" class="headerlink" title="pingå‘½ä»¤é™åˆ¶åœ¨5ä¸ªping"></a>pingå‘½ä»¤é™åˆ¶åœ¨5ä¸ªping</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">alias ping=&#x27;ping -c 5&#x27;</span><br></pre></td></tr></table></figure><h3 id="è·å–ä½ çš„å¤–éƒ¨-IP-åœ°å€"><a href="#è·å–ä½ çš„å¤–éƒ¨-IP-åœ°å€" class="headerlink" title="è·å–ä½ çš„å¤–éƒ¨ IP åœ°å€"></a>è·å–ä½ çš„å¤–éƒ¨ IP åœ°å€</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">alias ipe=&#x27;curl ipinfo.io/ip&#x27;</span><br></pre></td></tr></table></figure><h3 id="å…³äºlså‘½ä»¤çš„åˆ«åï¼š"><a href="#å…³äºlså‘½ä»¤çš„åˆ«åï¼š" class="headerlink" title="å…³äºlså‘½ä»¤çš„åˆ«åï¼š"></a>å…³äºlså‘½ä»¤çš„åˆ«åï¼š</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> å¸¦é¢œè‰²çš„lsåˆ«å</span></span><br><span class="line">alias ls=&#x27;ls --color=auto&#x27;</span><br><span class="line"> </span><br><span class="line">alias ll=&#x27;ls -la&#x27;</span><br><span class="line"> </span><br><span class="line"><span class="meta">#</span><span class="bash"> æ˜¾ç¤ºéšè—æ–‡ä»¶æˆ–ç›®å½•çš„å‘½ä»¤åˆ«å</span></span><br><span class="line">alias l.=&#x27;ls -d .* --color=auto&#x27;</span><br></pre></td></tr></table></figure><h3 id="å…³äºcdå‘½ä»¤çš„åˆ«å"><a href="#å…³äºcdå‘½ä»¤çš„åˆ«å" class="headerlink" title="å…³äºcdå‘½ä»¤çš„åˆ«å"></a>å…³äºcdå‘½ä»¤çš„åˆ«å</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> è¿›å…¥çˆ¶ç›®å½•</span></span><br><span class="line">alias cd..=&#x27;cd ..&#x27;</span><br><span class="line"> </span><br><span class="line"><span class="meta">#</span><span class="bash"> å¿«é€Ÿè¿”å›åˆ°çˆ¶ç›®å½•</span></span><br><span class="line">alias ..=&#x27;cd ..&#x27;</span><br><span class="line">alias ...=&#x27;cd ../../&#x27;</span><br><span class="line">alias ....=&#x27;cd ../../../&#x27;</span><br><span class="line">alias .....=&#x27;cd ../../../../&#x27;</span><br><span class="line">alias .4=&#x27;cd ../../../../&#x27;</span><br><span class="line">alias .5=&#x27;cd ../../../../../&#x27;</span><br></pre></td></tr></table></figure><h3 id="å…³äºgrepå‘½ä»¤çš„åˆ«å"><a href="#å…³äºgrepå‘½ä»¤çš„åˆ«å" class="headerlink" title="å…³äºgrepå‘½ä»¤çš„åˆ«å"></a>å…³äºgrepå‘½ä»¤çš„åˆ«å</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> åŠ å…¥é¢œè‰²è¾“å‡ºï¼Œåœ¨æœç´¢<span class="built_in">log</span>æ–‡ä»¶æ—¶å¾ˆæœ‰ç”¨</span></span><br><span class="line">alias grep=&#x27;grep --color=auto&#x27;</span><br><span class="line">alias egrep=&#x27;egrep --color=auto&#x27;</span><br><span class="line">alias fgrep=&#x27;fgrep --color=auto&#x27;</span><br></pre></td></tr></table></figure><h3 id="å›æ”¶ç«™åŠŸèƒ½"><a href="#å›æ”¶ç«™åŠŸèƒ½" class="headerlink" title="å›æ”¶ç«™åŠŸèƒ½"></a>å›æ”¶ç«™åŠŸèƒ½</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">mkdir -p ~/.trash</span><br><span class="line">alias rm=trash</span><br><span class="line">alias r=trash</span><br><span class="line">alias rl=&#x27;ls ~/.trash/&#x27;</span><br><span class="line">alias ur=undelfile</span><br><span class="line"></span><br><span class="line">undelfile()</span><br><span class="line">&#123;</span><br><span class="line">    mv -i ~/.trash/$@ ./</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">trash()</span><br><span class="line">&#123;</span><br><span class="line">    mv -i $@ ~/.trash/</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">cleartrash()</span><br><span class="line">&#123;</span><br><span class="line">    read -p &quot;clear sure?[n]&quot; confirm</span><br><span class="line">    [ $confirm == &#x27;y&#x27; ] || [ $confirm == &#x27;Y&#x27; ] &amp;&amp; /bin/rm -rf ~/.trash/*</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬æ˜¯åœ¨å®¶ç›®å½•ä¸‹å»ºç«‹ä¸€ä¸ª <code>.trash</code> çš„éšè—æ–‡ä»¶å¤¹ï¼Œä½œä¸ºå›æ”¶ç«™ã€‚ç„¶åï¼Œæˆ‘ä»¬å¯¹ rm å‘½ä»¤è¿›è¡Œé‡å®šä¹‰ã€‚å½“æˆ‘ä»¬æ‰§è¡Œ rm æˆ–è€… r çš„æ—¶å€™ï¼Œå°†æ‰§è¡Œ trash å‡½æ•°ã€‚è€Œåœ¨ trash å‡½æ•°é‡Œï¼Œåªåšä¸€ä»¶äº‹ï¼š</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">mv -i $@ ~/.trash/</span><br></pre></td></tr></table></figure><p>å°±æ˜¯å°† rm ä¹‹åæ‰€æœ‰çš„æ–‡ä»¶ç§»åŠ¨åˆ° .trash ç›®å½•ä¸‹ï¼ˆå³æ¨¡æ‹Ÿä¸¢è¿›å›æ”¶ç«™ï¼‰ã€‚<code>-i</code> é€‰é¡¹è¡¨ç¤ºå¦‚æœ .trash ç›®å½•æœ‰åŒåæ–‡ä»¶çš„è¯ï¼Œå°†æç¤ºæ˜¯å¦è¦†ç›–ã€‚</p><p>æˆ‘ä»¬å°† <code>rl</code> å®šä¹‰ä¸º <code>ls ~/.trash/</code> ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ rl æ¥æŸ¥çœ‹ .trash ç›®å½•ä¸‹çš„æ–‡ä»¶ï¼Œå³è¢«ã€Œåˆ é™¤ã€çš„æ–‡ä»¶ã€‚</p><p>å¦‚æœè¦è¿˜åŸæ–‡ä»¶ï¼Œå¯ä»¥æ‰§è¡Œ <code>ur</code> ï¼Œè€Œ ur å°†æ‰§è¡Œ <code>undelfile</code> å‡½æ•°ã€‚åœ¨ undelfile é‡Œï¼Œåˆå°† ur ä¹‹åçš„æ–‡ä»¶ä» .trash ç›®å½•ç§»å›åˆ°åŸç›®å½•ï¼Œä»è€Œå®ç°æ–‡ä»¶åˆ é™¤è¿˜åŸã€‚</p><p>å½“è¿‡äº†ä¸€æ®µæ—¶é—´åï¼Œå›æ”¶ç«™é‡Œæ–‡ä»¶å¤ªå¤šäº†ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>cleartrash</code> å‘½ä»¤æ¸…ç©ºå›æ”¶ç«™ã€‚å®ƒå°†æ‰§è¡ŒåŒåå‡½æ•°ï¼Œè°ƒç”¨ <code>/bin/rm</code> å‘½ä»¤å°† .trash ç›®å½•æ¸…ç©ºã€‚</p><h4 id="åˆ é™¤æ–‡ä»¶"><a href="#åˆ é™¤æ–‡ä»¶" class="headerlink" title="åˆ é™¤æ–‡ä»¶"></a>åˆ é™¤æ–‡ä»¶</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">~/workspace/test Â» touch file1 file2 file3</span><br><span class="line">~/workspace/test Â» ls</span><br><span class="line">file1 file2 file3</span><br><span class="line">~/workspace/test Â» rm file1 file2</span><br><span class="line">~/workspace/test Â» r file3</span><br></pre></td></tr></table></figure><h4 id="æŸ¥çœ‹å›æ”¶ç«™æ–‡ä»¶"><a href="#æŸ¥çœ‹å›æ”¶ç«™æ–‡ä»¶" class="headerlink" title="æŸ¥çœ‹å›æ”¶ç«™æ–‡ä»¶"></a>æŸ¥çœ‹å›æ”¶ç«™æ–‡ä»¶</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">~/workspace/test Â» rl</span><br><span class="line"></span><br><span class="line">file1                          file2                                  file3 </span><br></pre></td></tr></table></figure><h4 id="è¿˜åŸè¢«åˆ é™¤çš„æ–‡ä»¶"><a href="#è¿˜åŸè¢«åˆ é™¤çš„æ–‡ä»¶" class="headerlink" title="è¿˜åŸè¢«åˆ é™¤çš„æ–‡ä»¶"></a>è¿˜åŸè¢«åˆ é™¤çš„æ–‡ä»¶</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">~/workspace/test Â» ur file1</span><br><span class="line">~/workspace/test Â» ur file2</span><br><span class="line">~/workspace/test Â» ur file3</span><br><span class="line">~/workspace/test Â» ls</span><br><span class="line">file1 file2 file3</span><br></pre></td></tr></table></figure><h4 id="æ¸…ç©ºå›æ”¶ç«™"><a href="#æ¸…ç©ºå›æ”¶ç«™" class="headerlink" title="æ¸…ç©ºå›æ”¶ç«™"></a>æ¸…ç©ºå›æ”¶ç«™</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">~/workspace/test Â» rm file1 file2 file3</span><br><span class="line">~/workspace/test Â» cleartrash</span><br><span class="line">clear sure?[n]y</span><br><span class="line">~/workspace/test Â» rl</span><br><span class="line">~/workspace/test Â» </span><br></pre></td></tr></table></figure><hr><p><strong>æ³¨æ„ :</strong></p><p>å°†ä»¥ä¸Šå‘½ä»¤ç¼–è¾‘åˆ°åˆ° <code>~/.bash_profile</code>å, éœ€è¦æ‰§è¡Œ<code>source ~/.bash_profile</code>å‘½ä»¤ä½¿å…¶ç”Ÿæ•ˆ;</p>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®°æœ¬ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> Bash </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MySqlæ•°æ®åº“ä¼˜åŒ–ç»†èŠ‚</title>
      <link href="post/2814564083/"/>
      <url>post/2814564083/</url>
      
        <content type="html"><![CDATA[<blockquote><p>MySQL  æ•°æ®åº“æ€§èƒ½çš„ä¼˜åŒ–æ˜¯ MySQL  æ•°æ®åº“å‘å±•çš„å¿…ç»ä¹‹è·¯ï¼Œ MySQL  æ•°æ®åº“æ€§èƒ½çš„ä¼˜åŒ–ä¹Ÿæ˜¯ MySQL  æ•°æ®åº“å‰è¿›çš„è§è¯ã€‚è®°å½•ä¸€äº›MySQLä¼˜åŒ–çš„ä¸€äº›ç»†èŠ‚</p></blockquote><h3 id="é€‰å–æœ€é€‚ç”¨çš„å­—æ®µå±æ€§ï¼ˆå‡ºå¤„ï¼‰"><a href="#é€‰å–æœ€é€‚ç”¨çš„å­—æ®µå±æ€§ï¼ˆå‡ºå¤„ï¼‰" class="headerlink" title="é€‰å–æœ€é€‚ç”¨çš„å­—æ®µå±æ€§ï¼ˆå‡ºå¤„ï¼‰"></a>é€‰å–æœ€é€‚ç”¨çš„å­—æ®µå±æ€§ï¼ˆ<a href="https://www.sojson.com/blog/41.html">å‡ºå¤„</a>ï¼‰</h3><p>MySQL  å¯ä»¥å¾ˆå¥½çš„æ”¯æŒå¤§æ•°æ®é‡çš„å­˜å–ï¼Œä½†æ˜¯ä¸€èˆ¬è¯´æ¥ï¼Œæ•°æ®åº“ä¸­çš„è¡¨è¶Šå°ï¼Œåœ¨å®ƒä¸Šé¢æ‰§è¡Œçš„æŸ¥è¯¢ä¹Ÿå°±ä¼šè¶Šå¿«ã€‚å› æ­¤ï¼Œåœ¨åˆ›å»ºè¡¨çš„æ—¶å€™ï¼Œä¸ºäº†è·å¾—æ›´å¥½çš„æ€§èƒ½ï¼Œæˆ‘ä»¬å¯ä»¥å°†è¡¨ä¸­å­—æ®µçš„å®½åº¦è®¾å¾—å°½å¯èƒ½å°ã€‚ä¾‹å¦‚ï¼Œåœ¨å®šä¹‰é‚®æ”¿ç¼–ç è¿™ä¸ªå­—æ®µæ—¶ï¼Œå¦‚æœå°†å…¶è®¾ç½®ä¸º<code>CHAR(255)ï¼Œ</code>æ˜¾ç„¶ç»™æ•°æ®åº“å¢åŠ äº†ä¸å¿…è¦çš„ç©ºé—´ï¼Œç”šè‡³ä½¿ç”¨<code>VARCHAR</code>è¿™ç§ç±»å‹ä¹Ÿæ˜¯å¤šä½™çš„ï¼Œå› ä¸º<code>CHAR(6)</code>å°±å¯ä»¥å¾ˆå¥½çš„å®Œæˆä»»åŠ¡äº†ã€‚åŒæ ·çš„ï¼Œå¦‚æœå¯ä»¥çš„è¯ï¼Œæˆ‘ä»¬åº”è¯¥ä½¿ç”¨<code>MEDIUMINT</code>è€Œä¸æ˜¯<code>BIGIN</code>æ¥å®šä¹‰æ•´å‹å­—æ®µã€‚</p><p>å¦å¤–ä¸€ä¸ªæé«˜æ•ˆç‡çš„æ–¹æ³•æ˜¯åœ¨å¯èƒ½çš„æƒ…å†µä¸‹ï¼Œåº”è¯¥å°½é‡æŠŠå­—æ®µè®¾ç½®ä¸º<code>NOT NULL</code>ï¼Œè¿™æ ·åœ¨å°†æ¥æ‰§è¡ŒæŸ¥è¯¢çš„æ—¶å€™ï¼Œæ•°æ®åº“ä¸ç”¨å»æ¯”è¾ƒ<code>NULL</code>å€¼ã€‚</p><p>å¯¹äºæŸäº›æ–‡æœ¬å­—æ®µï¼Œä¾‹å¦‚â€œçœä»½â€æˆ–è€…â€œæ€§åˆ«â€ï¼Œæˆ‘ä»¬å¯ä»¥å°†å®ƒä»¬å®šä¹‰ä¸º<code>ENUM</code>ç±»å‹ã€‚å› ä¸ºåœ¨ MySQL  ä¸­ï¼Œ<code>ENUM</code>ç±»å‹è¢«å½“ä½œæ•°å€¼å‹æ•°æ®æ¥å¤„ç†ï¼Œè€Œæ•°å€¼å‹æ•°æ®è¢«å¤„ç†èµ·æ¥çš„é€Ÿåº¦è¦æ¯”æ–‡æœ¬ç±»å‹å¿«å¾—å¤šã€‚è¿™æ ·ï¼Œæˆ‘ä»¬åˆå¯ä»¥æé«˜æ•°æ®åº“çš„æ€§èƒ½ã€‚</p><h3 id="ä½¿ç”¨è¿æ¥ï¼ˆJOINï¼‰æ¥ä»£æ›¿å­æŸ¥è¯¢-Sub-Queries-ï¼ˆå‡ºå¤„ï¼‰"><a href="#ä½¿ç”¨è¿æ¥ï¼ˆJOINï¼‰æ¥ä»£æ›¿å­æŸ¥è¯¢-Sub-Queries-ï¼ˆå‡ºå¤„ï¼‰" class="headerlink" title="ä½¿ç”¨è¿æ¥ï¼ˆJOINï¼‰æ¥ä»£æ›¿å­æŸ¥è¯¢(Sub-Queries)ï¼ˆå‡ºå¤„ï¼‰"></a>ä½¿ç”¨è¿æ¥ï¼ˆJOINï¼‰æ¥ä»£æ›¿å­æŸ¥è¯¢(Sub-Queries)ï¼ˆ<a href="https://www.sojson.com/blog/41.html">å‡ºå¤„</a>ï¼‰</h3><p>MySQL  ä»4.1å¼€å§‹æ”¯æŒ SQL  çš„å­æŸ¥è¯¢ã€‚è¿™ä¸ªæŠ€æœ¯å¯ä»¥ä½¿ç”¨<code>SELECT</code>è¯­å¥æ¥åˆ›å»ºä¸€ä¸ªå•åˆ—çš„æŸ¥è¯¢ç»“æœï¼Œç„¶åæŠŠè¿™ä¸ªç»“æœä½œä¸ºè¿‡æ»¤æ¡ä»¶ç”¨åœ¨å¦ä¸€ä¸ªæŸ¥è¯¢ä¸­ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬è¦å°†å®¢æˆ·åŸºæœ¬ä¿¡æ¯è¡¨ä¸­æ²¡æœ‰ä»»ä½•è®¢å•çš„å®¢æˆ·åˆ é™¤æ‰ï¼Œå°±å¯ä»¥åˆ©ç”¨å­æŸ¥è¯¢å…ˆä»é”€å”®ä¿¡æ¯è¡¨ä¸­å°†æ‰€æœ‰å‘å‡ºè®¢å•çš„å®¢æˆ·<code>ID</code>å–å‡ºæ¥ï¼Œç„¶åå°†ç»“æœä¼ é€’ç»™ä¸»æŸ¥è¯¢ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">DELETE FROM customerinfo</span><br><span class="line">WHERE CustomerID NOT in (SELECT CustomerID FROM salesinfo );</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨å­æŸ¥è¯¢å¯ä»¥ä¸€æ¬¡æ€§çš„å®Œæˆå¾ˆå¤šé€»è¾‘ä¸Šéœ€è¦å¤šä¸ªæ­¥éª¤æ‰èƒ½å®Œæˆçš„ SQL  æ“ä½œï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥é¿å…äº‹åŠ¡æˆ–è€…è¡¨é”æ­»ï¼Œå¹¶ä¸”å†™èµ·æ¥ä¹Ÿå¾ˆå®¹æ˜“ã€‚ä½†æ˜¯ï¼Œæœ‰äº›æƒ…å†µä¸‹ï¼Œå­æŸ¥è¯¢å¯ä»¥è¢«æ›´æœ‰æ•ˆç‡çš„è¿æ¥ï¼ˆ<code>JOIN</code>ï¼‰.. æ›¿ä»£ã€‚ä¾‹å¦‚ï¼Œå‡è®¾æˆ‘ä»¬è¦å°†æ‰€æœ‰æ²¡æœ‰è®¢å•è®°å½•çš„ç”¨æˆ·å–å‡ºæ¥ï¼Œå¯ä»¥ç”¨ä¸‹é¢è¿™ä¸ªæŸ¥è¯¢å®Œæˆï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">SELECT * FROM customerinfoWHERE CustomerID NOT in (SELECT CustomerID FROM salesinfo )</span><br></pre></td></tr></table></figure><p>å¦‚æœä½¿ç”¨è¿æ¥ï¼ˆ<code>JOIN</code>ï¼‰.. æ¥å®Œæˆè¿™ä¸ªæŸ¥è¯¢å·¥ä½œï¼Œé€Ÿåº¦å°†ä¼šå¿«å¾ˆå¤šã€‚å°¤å…¶æ˜¯å½“<code>salesinfo</code>è¡¨ä¸­å¯¹<code>CustomerID</code>å»ºæœ‰ç´¢å¼•çš„è¯ï¼Œæ€§èƒ½å°†ä¼šæ›´å¥½ï¼ŒæŸ¥è¯¢å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">SELECT * FROM customerinfoLEFT JOIN salesinfo ON customerinfo.CustomerID&#x3D;salesinfo.CustomerID</span><br><span class="line">WHERE salesinfo.CustomerID IS NULL</span><br></pre></td></tr></table></figure><p>è¿æ¥ï¼ˆ<code>JOIN</code>ï¼‰.. ä¹‹æ‰€ä»¥æ›´æœ‰æ•ˆç‡ä¸€äº›ï¼Œæ˜¯å› ä¸º  MySQL  ä¸éœ€è¦åœ¨å†…å­˜ä¸­åˆ›å»ºä¸´æ—¶è¡¨æ¥å®Œæˆè¿™ä¸ªé€»è¾‘ä¸Šçš„éœ€è¦ä¸¤ä¸ªæ­¥éª¤çš„æŸ¥è¯¢å·¥ä½œã€‚</p><h3 id="ä½¿ç”¨è”åˆ-UNION-æ¥ä»£æ›¿æ‰‹åŠ¨åˆ›å»ºçš„ä¸´æ—¶è¡¨ï¼ˆå‡ºå¤„ï¼‰"><a href="#ä½¿ç”¨è”åˆ-UNION-æ¥ä»£æ›¿æ‰‹åŠ¨åˆ›å»ºçš„ä¸´æ—¶è¡¨ï¼ˆå‡ºå¤„ï¼‰" class="headerlink" title="ä½¿ç”¨è”åˆ(UNION)æ¥ä»£æ›¿æ‰‹åŠ¨åˆ›å»ºçš„ä¸´æ—¶è¡¨ï¼ˆå‡ºå¤„ï¼‰"></a>ä½¿ç”¨è”åˆ(<code>UNION</code>)æ¥ä»£æ›¿æ‰‹åŠ¨åˆ›å»ºçš„ä¸´æ—¶è¡¨ï¼ˆ<a href="https://www.sojson.com/blog/41.html">å‡ºå¤„</a>ï¼‰</h3><p>MySQL  ä» 4.0 çš„ç‰ˆæœ¬å¼€å§‹æ”¯æŒ <code>UNION</code>æŸ¥è¯¢ï¼Œå®ƒå¯ä»¥æŠŠéœ€è¦ä½¿ç”¨ä¸´æ—¶è¡¨çš„ä¸¤æ¡æˆ–æ›´å¤šçš„ <code>SELECT</code>æŸ¥è¯¢åˆå¹¶çš„ä¸€ä¸ªæŸ¥è¯¢ä¸­ã€‚åœ¨å®¢æˆ·ç«¯çš„æŸ¥è¯¢ä¼šè¯ç»“æŸçš„æ—¶å€™ï¼Œä¸´æ—¶è¡¨ä¼šè¢«è‡ªåŠ¨åˆ é™¤ï¼Œä»è€Œä¿è¯æ•°æ®åº“æ•´é½ã€é«˜æ•ˆã€‚ä½¿ç”¨ <code>UNION</code>æ¥åˆ›å»ºæŸ¥è¯¢çš„æ—¶å€™ï¼Œæˆ‘ä»¬åªéœ€è¦ç”¨ <code>UNION</code>ä½œä¸ºå…³é”®å­—æŠŠå¤šä¸ª <code>SELECT</code>è¯­å¥è¿æ¥èµ·æ¥å°±å¯ä»¥äº†ï¼Œè¦æ³¨æ„çš„æ˜¯æ‰€æœ‰ <code>SELECT</code>è¯­å¥ä¸­çš„å­—æ®µæ•°ç›®è¦æƒ³åŒã€‚ä¸‹é¢çš„ä¾‹å­å°±æ¼”ç¤ºäº†ä¸€ä¸ªä½¿ç”¨ <code>UNION</code>çš„æŸ¥è¯¢ã€‚</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">SELECT Name, Phone FROM client</span><br><span class="line">UNION</span><br><span class="line">SELECT Name, BirthDate FROM author</span><br><span class="line">UNION</span><br><span class="line">SELECT Name, Supplier FROM product</span><br></pre></td></tr></table></figure><h3 id="äº‹åŠ¡ï¼ˆå‡ºå¤„ï¼‰"><a href="#äº‹åŠ¡ï¼ˆå‡ºå¤„ï¼‰" class="headerlink" title="äº‹åŠ¡ï¼ˆå‡ºå¤„ï¼‰"></a>äº‹åŠ¡ï¼ˆ<a href="https://www.sojson.com/blog/41.html">å‡ºå¤„</a>ï¼‰</h3><p>å°½ç®¡æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å­æŸ¥è¯¢ï¼ˆ<code>Sub-Queries</code>ï¼‰ã€è¿æ¥ï¼ˆ<code>JOIN</code>ï¼‰å’Œè”åˆï¼ˆ<code>UNION</code>ï¼‰æ¥åˆ›å»ºå„ç§å„æ ·çš„æŸ¥è¯¢ï¼Œä½†ä¸æ˜¯æ‰€æœ‰çš„æ•°æ®åº“æ“ä½œéƒ½å¯ä»¥åªç”¨ä¸€æ¡æˆ–å°‘æ•°å‡ æ¡ SQL  è¯­å¥å°±å¯ä»¥å®Œæˆçš„ã€‚æ›´å¤šçš„æ—¶å€™æ˜¯éœ€è¦ç”¨åˆ°ä¸€ç³»åˆ—çš„è¯­å¥æ¥å®ŒæˆæŸç§å·¥ä½œã€‚ä½†æ˜¯åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå½“è¿™ä¸ªè¯­å¥å—ä¸­çš„æŸä¸€æ¡è¯­å¥è¿è¡Œå‡ºé”™çš„æ—¶å€™ï¼Œæ•´ä¸ªè¯­å¥å—çš„æ“ä½œå°±ä¼šå˜å¾—ä¸ç¡®å®šèµ·æ¥ã€‚è®¾æƒ³ä¸€ä¸‹ï¼Œè¦æŠŠæŸä¸ªæ•°æ®åŒæ—¶æ’å…¥ä¸¤ä¸ªç›¸å…³è”çš„è¡¨ä¸­ï¼Œå¯èƒ½ä¼šå‡ºç°è¿™æ ·çš„æƒ…å†µï¼šç¬¬ä¸€ä¸ªè¡¨ä¸­æˆåŠŸæ›´æ–°åï¼Œæ•°æ®åº“çªç„¶å‡ºç°æ„å¤–çŠ¶å†µï¼Œé€ æˆç¬¬äºŒä¸ªè¡¨ä¸­çš„æ“ä½œæ²¡æœ‰å®Œæˆï¼Œè¿™æ ·ï¼Œå°±ä¼šé€ æˆæ•°æ®çš„ä¸å®Œæ•´ï¼Œç”šè‡³ä¼šç ´åæ•°æ®åº“ä¸­çš„æ•°æ®ã€‚è¦é¿å…è¿™ç§æƒ…å†µï¼Œå°±åº”è¯¥ä½¿ç”¨äº‹åŠ¡ï¼Œå®ƒçš„ä½œç”¨æ˜¯ï¼šè¦ä¹ˆè¯­å¥å—ä¸­æ¯æ¡è¯­å¥éƒ½æ“ä½œæˆåŠŸï¼Œè¦ä¹ˆéƒ½å¤±è´¥ã€‚æ¢å¥è¯è¯´ï¼Œå°±æ˜¯å¯ä»¥ä¿æŒæ•°æ®åº“ä¸­æ•°æ®çš„ä¸€è‡´æ€§å’Œå®Œæ•´æ€§ã€‚äº‹ç‰©ä»¥<code>BEGIN</code>å…³é”®å­—å¼€å§‹ï¼Œ<code>COMMIT</code>å…³é”®å­—ç»“æŸã€‚åœ¨è¿™ä¹‹é—´çš„ä¸€æ¡ SQL  æ“ä½œå¤±è´¥ï¼Œé‚£ä¹ˆï¼Œ<code>ROLLBACK</code>å‘½ä»¤å°±å¯ä»¥æŠŠæ•°æ®åº“æ¢å¤åˆ°<code>BEGIN</code>å¼€å§‹ä¹‹å‰çš„çŠ¶æ€ã€‚</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">BEGIN;</span><br><span class="line">INSERT INTO salesinfo SET CustomerID&#x3D;14;</span><br><span class="line">UPDATE inventory SET Quantity&#x3D;11</span><br><span class="line">WHERE item&#x3D;&#39;book&#39;;</span><br><span class="line">COMMIT;</span><br></pre></td></tr></table></figure><p>äº‹åŠ¡çš„å¦ä¸€ä¸ªé‡è¦ä½œç”¨æ˜¯å½“å¤šä¸ªç”¨æˆ·åŒæ—¶ä½¿ç”¨ç›¸åŒçš„æ•°æ®æºæ—¶ï¼Œå®ƒå¯ä»¥åˆ©ç”¨é”å®šæ•°æ®åº“çš„æ–¹æ³•æ¥ä¸ºç”¨æˆ·æä¾›ä¸€ç§å®‰å…¨çš„è®¿é—®æ–¹å¼ï¼Œè¿™æ ·å¯ä»¥ä¿è¯ç”¨æˆ·çš„æ“ä½œä¸è¢«å…¶å®ƒçš„ç”¨æˆ·æ‰€å¹²æ‰°ã€‚</p><h3 id="ä¸ç”¨ä»¥ä¸‹æ“ä½œ"><a href="#ä¸ç”¨ä»¥ä¸‹æ“ä½œ" class="headerlink" title="ä¸ç”¨ä»¥ä¸‹æ“ä½œ"></a>ä¸ç”¨ä»¥ä¸‹æ“ä½œ</h3><ol><li><p>æ˜¾ç¤ºæˆ–éšå¼çš„ç±»å‹è½¬æ¢</p><p>æ¯”å¦‚ <code>SELECT id FROM table WHERE id=&#39;1&#39;</code><br>å†å¦‚åœ¨<code>WHERE</code>å­å¥ä¸­<code>numeric</code> å‹å’Œ<code>int</code>å‹çš„åˆ—ç›¸æ¯”è¾ƒå°±å±äºéšå¼è½¬æ¢</p></li><li><p>ä½¿ç”¨éåŒç±»å‹çš„åˆ—è¿›è¡Œç­‰å€¼æŸ¥è¯¢</p></li><li><p>åœ¨WHEREå­å¥ä¸­çš„<code>&quot;=&quot;</code>å·¦è¾¹è¡¨è¾¾å¼è¿›è¡Œå‡½æ•°ã€ç®—æœ¯è¿ç®—æˆ–å…¶ä»–è¡¨è¾¾å¼è¿ç®—</p></li><li><p>ä½¿ç”¨å‰ç¼€ä¸º<code>%</code>çš„<code>LIKE</code></p></li><li><p>ä½¿ç”¨è´Ÿå‘æŸ¥è¯¢ï¼Œå¦‚<code>NOT</code>, <code>!=</code>, <code>&lt;&gt;</code>, <code>!&gt;</code>, <code>1&lt;</code>, <code>NOT EXISTS</code>, <code>NOT IN</code>ä»¥åŠ<code>NOT LIKE</code></p><p>æ¯”å¦‚ <code>NOT IN</code>ä¼šæŠŠç©ºå’Œ<code>NULL</code>ç»™æŸ¥å‡ºæ¥</p></li><li><p>åœ¨æ•°æ®åº“ä¸­è·‘å¤§æŸ¥è¯¢</p></li><li><p>å•æ¡<code>SQL</code>è¯­å¥åŒæ—¶æ›´æ–°å¤šä¸ªè¡¨</p></li><li><p>ä½¿ç”¨è·¨åº“æŸ¥è¯¢</p></li></ol><p>å»ºè®®æ‹†åˆ†æˆå•è¡¨ç®€å•æŸ¥è¯¢ï¼Œé€šè¿‡ç¨‹åºè¿›è¡Œå…³è”</p><h3 id="é¿å…ä½¿ç”¨ä»¥ä¸‹æ“ä½œ"><a href="#é¿å…ä½¿ç”¨ä»¥ä¸‹æ“ä½œ" class="headerlink" title="é¿å…ä½¿ç”¨ä»¥ä¸‹æ“ä½œ"></a>é¿å…ä½¿ç”¨ä»¥ä¸‹æ“ä½œ</h3><ol><li><p>é¿å…å¤§äº‹åŠ¡</p><p>äº‹åŠ¡è¦ç®€å•ï¼Œæ•´ä¸ªäº‹åŠ¡çš„æ—¶é—´é•¿åº¦ä¸è¦å¤ªé•¿ã€‚<br>æ‹†åˆ†å¤æ‚<code>SQL</code>ä¸ºå¤šä¸ªå°<code>SQL</code>ï¼Œé¿å…å¤§äº‹åŠ¡</p></li><li><p>é¿å…ä½¿ç”¨ï¼šè§¦å‘å™¨ã€å‡½æ•°ã€å­˜å‚¨è¿‡ç¨‹ã€è§†å›¾</p></li><li><p>é¿å…åœ¨æ•°æ®åº“ä¸­è¿›æ•°å­¦è¿ç®—</p><p><code>MySQL</code>ä¸æ“…é•¿æ•°å­¦è¿ç®—å’Œé€»è¾‘åˆ¤æ–­</p></li><li><p>é¿å…å–å‡ºå¤§å­—æ®µä¸”æ— ç”¨çš„å†…å®¹</p><p><code>SELECT</code>åªè·å–å¿…è¦çš„å­—æ®µï¼Œå°½é‡å°‘ä½¿ç”¨<code>SELECT *</code></p></li><li><p>é¿å…ä½¿ç”¨å¤§è¡¨çš„<code>JOIN</code></p></li><li><p>é¿å…ä¸€æ¬¡æ›´æ–°å¤ªå¤šæ•°æ®</p><p>æ¯”å¦‚ï¼Œå¯¹æ•°æ®çš„æ›´æ–°è¦æ‰“æ•£åæ‰¹é‡æ›´æ–°</p></li><li><p>å°½é‡é¿å…ä½¿ç”¨å­æŸ¥è¯¢ï¼Œå»ºè®®å°†å­æŸ¥è¯¢è½¬æ¢æˆå…³è”æŸ¥è¯¢  </p><p>ä½†ç”±äºå­æŸ¥è¯¢ä¸ä½¿ç”¨ç´¢å¼•ï¼Œåœ¨å…³è”æŸ¥è¯¢ä¹Ÿä¸ä½¿ç”¨ç´¢å¼•çš„æƒ…å†µä¸‹ï¼Œå­æŸ¥è¯¢æ˜¯è¦ä¼˜äºå…³è”æŸ¥è¯¢çš„ã€‚å› æ­¤è‡³äºæ˜¯ä½¿ç”¨å…³è”æŸ¥è¯¢è¿˜æ˜¯å­æŸ¥è¯¢åˆ™éœ€è¦ä½¿ç”¨<code>EXPLAIN</code>å¯¹<code>SQL</code>è¿›è¡Œåˆ†ææ‰æ˜¯ä¸‡å…¨ä¹‹ç­–</p></li></ol><h3 id="æ›¿æ¢ä½¿ç”¨"><a href="#æ›¿æ¢ä½¿ç”¨" class="headerlink" title="æ›¿æ¢ä½¿ç”¨"></a>æ›¿æ¢ä½¿ç”¨</h3><ol><li><p>ç”¨<code>IN</code>ä»£æ›¿<code>OR</code></p><p><code>OR</code>çš„æ•ˆç‡æ²¡æœ‰<code>IN</code>çš„æ•ˆç‡é«˜</p></li><li><p><code>IN</code>æ¡ä»¶é‡Œé¢çš„æ•°æ®çš„ä¸ªæ•°å»ºè®®æ§åˆ¶åœ¨500ä¸ªä»¥å†…</p><p>è¦å­¦ä¼šä½¿ç”¨<code>EXISTS</code>ä»£æ›¿<code>IN</code>ï¼Œ<code>EXISTS</code>åœ¨ä¸€äº›åœºæ™¯æŸ¥è¯¢ä¼šæ¯”<code>IN</code>å¿«</p></li><li><p>ç”¨<code>UNION ALL</code>ä»£æ›¿<code>UNION</code></p></li><li><p>ä½¿ç”¨<code>EXISTS</code>æ¥åˆ¤æ–­è®°å½•æ˜¯å¦å­˜åœ¨ï¼Œè€Œä¸ä½¿ç”¨<code>SELECT COUNT(1)</code>æ¥åˆ¤æ–­è®°å½•æ˜¯å¦å­˜åœ¨</p></li></ol>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®°æœ¬ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> MySQL </tag>
            
            <tag> ä¼˜åŒ– </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Streamè¡¨è¾¾å¼è¯­æ³•</title>
      <link href="post/2675058551/"/>
      <url>post/2675058551/</url>
      
        <content type="html"><![CDATA[<blockquote><p>æœ¬æ–‡è½¬è‡ªï¼š<a href="http://ifeve.com/">ifeve.com</a></p></blockquote><h1 id="Streamåˆä½“éªŒ"><a href="#Streamåˆä½“éªŒ" class="headerlink" title="Streamåˆä½“éªŒ"></a>Streamåˆä½“éªŒ</h1><blockquote><p>A sequence of elements supporting sequential and parallel aggregate operations.</p><p>ä»¥ä¸Šæ˜¯Javaé‡Œé¢æ˜¯å¯¹Streamçš„å®šä¹‰ï¼Œè§£è¯»ä¸€ä¸‹è¿™å¥è¯ï¼š</p><ol><li><strong>Streamæ˜¯å…ƒç´ çš„é›†åˆï¼Œè¿™ç‚¹è®©Streamçœ‹èµ·æ¥ç”¨äº›ç±»ä¼¼Iteratorï¼›</strong></li><li><strong>å¯ä»¥æ”¯æŒé¡ºåºå’Œå¹¶è¡Œçš„å¯¹åŸStreamè¿›è¡Œæ±‡èšçš„æ“ä½œï¼›</strong></li></ol></blockquote><p><strong>å¯ä»¥æŠŠStreamå½“æˆä¸€ä¸ªé«˜çº§ç‰ˆæœ¬çš„Iteratorã€‚</strong></p><p><strong>åŸå§‹ç‰ˆæœ¬çš„Iteratorï¼Œç”¨æˆ·åªèƒ½ä¸€ä¸ªä¸€ä¸ªçš„éå†å…ƒç´ å¹¶å¯¹å…¶æ‰§è¡ŒæŸäº›æ“ä½œï¼›</strong></p><p><strong>é«˜çº§ç‰ˆæœ¬çš„Streamï¼Œç”¨æˆ·åªè¦ç»™å‡ºéœ€è¦å¯¹å…¶åŒ…å«çš„å…ƒç´ æ‰§è¡Œä»€ä¹ˆæ“ä½œï¼Œæ¯”å¦‚â€œè¿‡æ»¤æ‰é•¿åº¦å¤§äº10çš„å­—ç¬¦ä¸²â€ã€â€œè·å–æ¯ä¸ªå­—ç¬¦ä¸²çš„é¦–å­—æ¯â€ç­‰ï¼Œå…·ä½“è¿™äº›æ“ä½œå¦‚ä½•åº”ç”¨åˆ°æ¯ä¸ªå…ƒç´ ä¸Šï¼Œå°±ç»™Streamå°±å¥½äº†ï¼</strong></p><p>ä¸‹é¢ä¸€æ®µä»£ç ç›´è§‚çš„è®¤è¯†ä¸€ä¸‹Streamï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Listsæ˜¯Guavaä¸­çš„ä¸€ä¸ªå·¥å…·ç±»</span></span><br><span class="line">List&lt;Integer&gt; nums = Lists.newArrayList(<span class="number">1</span>,<span class="keyword">null</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="keyword">null</span>,<span class="number">6</span>);</span><br><span class="line">nums.stream().filter(num -&gt; num != <span class="keyword">null</span>).count();</span><br></pre></td></tr></table></figure><p>ä¸Šé¢è¿™æ®µä»£ç æ˜¯è·å–ä¸€ä¸ªListä¸­ï¼Œå…ƒç´ ä¸ä¸ºnullçš„ä¸ªæ•°ã€‚æˆ‘ä»¬ç°åœ¨å¼€å§‹æ·±å…¥è§£åˆ¨è¿™ä¸ªä¾‹å­ï¼Œå®Œæˆä»¥åä½ å¯èƒ½å¯ä»¥åŸºæœ¬æŒæ¡Streamçš„ç”¨æ³•ï¼</p><h2 id="å‰–æStreamé€šç”¨è¯­æ³•"><a href="#å‰–æStreamé€šç”¨è¯­æ³•" class="headerlink" title="å‰–æStreamé€šç”¨è¯­æ³•"></a>å‰–æStreamé€šç”¨è¯­æ³•</h2><p><img src="https://gitee.com/cayzlh/img-repo/raw/master/2020/04/25/uBgJF4.jpg" alt="å‰–æStreamé€šç”¨è¯­æ³•"></p><p>å›¾ç‰‡å°±æ˜¯å¯¹äºStreamä¾‹å­çš„ä¸€ä¸ªè§£æï¼Œå¯ä»¥å¾ˆæ¸…æ¥šçš„çœ‹è§ï¼šåŸæœ¬ä¸€æ¡è¯­å¥è¢«ä¸‰ç§é¢œè‰²çš„æ¡†åˆ†å‰²æˆäº†ä¸‰ä¸ªéƒ¨åˆ†ã€‚</p><p>çº¢è‰²æ¡†ä¸­çš„è¯­å¥æ˜¯ä¸€ä¸ªStreamçš„ç”Ÿå‘½å¼€å§‹çš„åœ°æ–¹ï¼Œè´Ÿè´£åˆ›å»ºä¸€ä¸ªStreamå®ä¾‹ï¼›</p><p>ç»¿è‰²æ¡†ä¸­çš„è¯­å¥æ˜¯èµ‹äºˆStreamçµé­‚çš„åœ°æ–¹ï¼ŒæŠŠä¸€ä¸ªStreamè½¬æ¢æˆå¦å¤–ä¸€ä¸ªStreamï¼Œçº¢æ¡†çš„è¯­å¥ç”Ÿæˆçš„æ˜¯ä¸€ä¸ªåŒ…å«æ‰€æœ‰numså˜é‡çš„Streamï¼Œè¿›è¿‡ç»¿æ¡†çš„filteræ–¹æ³•ä»¥åï¼Œé‡æ–°ç”Ÿæˆäº†ä¸€ä¸ªè¿‡æ»¤æ‰åŸnumsåˆ—è¡¨æ‰€æœ‰nullä»¥åçš„Streamï¼›</p><p>è“è‰²æ¡†ä¸­çš„è¯­å¥æ˜¯ä¸°æ”¶çš„åœ°æ–¹ï¼ŒæŠŠStreamçš„é‡Œé¢åŒ…å«çš„å†…å®¹æŒ‰ç…§æŸç§ç®—æ³•æ¥æ±‡èšæˆä¸€ä¸ªå€¼ï¼Œä¾‹å­ä¸­æ˜¯è·å–Streamä¸­åŒ…å«çš„å…ƒç´ ä¸ªæ•°ã€‚</p><p><img src="https://gitee.com/cayzlh/img-repo/raw/master/2020/04/25/Kz1wEs.jpg" alt="å‰–æStreamé€šç”¨è¯­æ³•"></p><p>åœ¨æ­¤æˆ‘ä»¬æ€»ç»“ä¸€ä¸‹<strong>ä½¿ç”¨Streamçš„åŸºæœ¬æ­¥éª¤ï¼š</strong></p><ol><li>åˆ›å»ºStreamï¼›</li><li>è½¬æ¢Streamï¼Œæ¯æ¬¡è½¬æ¢åŸæœ‰Streamå¯¹è±¡ä¸æ”¹å˜ï¼Œè¿”å›ä¸€ä¸ªæ–°çš„Streamå¯¹è±¡ï¼ˆ<strong>å¯ä»¥æœ‰å¤šæ¬¡è½¬æ¢</strong>ï¼‰ï¼›</li><li>å¯¹Streamè¿›è¡Œèšåˆï¼ˆReduceï¼‰æ“ä½œï¼Œè·å–æƒ³è¦çš„ç»“æœï¼›</li></ol><h1 id="åˆ›å»ºStream"><a href="#åˆ›å»ºStream" class="headerlink" title="åˆ›å»ºStream"></a>åˆ›å»ºStream</h1><p>æœ€å¸¸ç”¨çš„åˆ›å»ºStreamæœ‰ä¸¤ç§é€”å¾„ï¼š</p><ol><li>é€šè¿‡Streamæ¥å£çš„é™æ€å·¥å‚æ–¹æ³•ï¼ˆæ³¨æ„ï¼šJava8é‡Œæ¥å£å¯ä»¥å¸¦é™æ€æ–¹æ³•ï¼‰ï¼›</li><li>é€šè¿‡Collectionæ¥å£çš„é»˜è®¤æ–¹æ³•ï¼ˆé»˜è®¤æ–¹æ³•ï¼šDefault methodï¼Œä¹Ÿæ˜¯Java8ä¸­çš„ä¸€ä¸ªæ–°ç‰¹æ€§ï¼Œå°±æ˜¯æ¥å£ä¸­çš„ä¸€ä¸ªå¸¦æœ‰å®ç°çš„æ–¹æ³•ï¼‰â€“stream()ï¼ŒæŠŠä¸€ä¸ªCollectionå¯¹è±¡è½¬æ¢æˆStream</li></ol><h2 id="ä½¿ç”¨Streamé™æ€æ–¹æ³•æ¥åˆ›å»ºStream"><a href="#ä½¿ç”¨Streamé™æ€æ–¹æ³•æ¥åˆ›å»ºStream" class="headerlink" title="ä½¿ç”¨Streamé™æ€æ–¹æ³•æ¥åˆ›å»ºStream"></a>ä½¿ç”¨Streamé™æ€æ–¹æ³•æ¥åˆ›å»ºStream</h2><ol><li><p>ofæ–¹æ³•ï¼šæœ‰ä¸¤ä¸ªoverloadæ–¹æ³•ï¼Œä¸€ä¸ªæ¥å—å˜é•¿å‚æ•°ï¼Œä¸€ä¸ªæ¥å£å•ä¸€å€¼</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Stream&lt;Integer&gt; integerStream = Stream.of(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">5</span>);</span><br><span class="line">Stream&lt;String&gt; stringStream = Stream.of(<span class="string">&quot;taobao&quot;</span>);</span><br></pre></td></tr></table></figure></li><li><p>generatoræ–¹æ³•ï¼šç”Ÿæˆä¸€ä¸ªæ— é™é•¿åº¦çš„Streamï¼Œå…¶å…ƒç´ çš„ç”Ÿæˆæ˜¯é€šè¿‡ç»™å®šçš„Supplierï¼ˆè¿™ä¸ªæ¥å£å¯ä»¥çœ‹æˆä¸€ä¸ªå¯¹è±¡çš„å·¥å‚ï¼Œæ¯æ¬¡è°ƒç”¨è¿”å›ä¸€ä¸ªç»™å®šç±»å‹çš„å¯¹è±¡ï¼‰</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Stream.generate(<span class="keyword">new</span> Supplier&lt;Double&gt;() &#123;</span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> Double <span class="title">get</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> Math.random();</span><br><span class="line">&#125;</span><br><span class="line">&#125;);</span><br><span class="line">Stream.generate(() -&gt; Math.random());</span><br><span class="line">Stream.generate(Math::random);</span><br></pre></td></tr></table></figure><p>ä¸‰æ¡è¯­å¥çš„ä½œç”¨éƒ½æ˜¯ä¸€æ ·çš„ï¼Œåªæ˜¯ä½¿ç”¨äº†lambdaè¡¨è¾¾å¼å’Œæ–¹æ³•å¼•ç”¨çš„è¯­æ³•æ¥ç®€åŒ–ä»£ç ã€‚æ¯æ¡è¯­å¥å…¶å®éƒ½æ˜¯ç”Ÿæˆä¸€ä¸ªæ— é™é•¿åº¦çš„Streamï¼Œå…¶ä¸­å€¼æ˜¯éšæœºçš„ã€‚<em>è¿™ä¸ªæ— é™é•¿åº¦Streamæ˜¯æ‡’åŠ è½½ï¼Œä¸€èˆ¬è¿™ç§æ— é™é•¿åº¦çš„Streaméƒ½ä¼šé…åˆStreamçš„limit()æ–¹æ³•æ¥ç”¨ã€‚</em></p></li><li><p>iterateæ–¹æ³•ï¼šä¹Ÿæ˜¯ç”Ÿæˆæ— é™é•¿åº¦çš„Streamï¼Œå’Œgeneratorä¸åŒçš„æ˜¯ï¼Œå…¶å…ƒç´ çš„ç”Ÿæˆæ˜¯é‡å¤å¯¹ç»™å®šçš„ç§å­å€¼(seed)è°ƒç”¨ç”¨æˆ·æŒ‡å®šå‡½æ•°æ¥ç”Ÿæˆçš„ã€‚å…¶ä¸­åŒ…å«çš„å…ƒç´ å¯ä»¥è®¤ä¸ºæ˜¯ï¼šseedï¼Œf(seed),f(f(seed))æ— é™å¾ªç¯</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Stream.iterate(<span class="number">1</span>, item -&gt; item + <span class="number">1</span>).limit(<span class="number">10</span>).forEach(System.out::println);</span><br></pre></td></tr></table></figure><p>è¿™æ®µä»£ç å°±æ˜¯å…ˆè·å–ä¸€ä¸ªæ— é™é•¿åº¦çš„æ­£æ•´æ•°é›†åˆçš„Streamï¼Œç„¶åå–å‡ºå‰10ä¸ªæ‰“å°ã€‚<strong>åƒä¸‡è®°ä½ä½¿ç”¨limitæ–¹æ³•ï¼Œä¸ç„¶ä¼šæ— é™æ‰“å°ä¸‹å»ã€‚</strong></p></li></ol><h2 id="é€šè¿‡Collectionå­ç±»è·å–Stream"><a href="#é€šè¿‡Collectionå­ç±»è·å–Stream" class="headerlink" title="é€šè¿‡Collectionå­ç±»è·å–Stream"></a>é€šè¿‡Collectionå­ç±»è·å–Stream</h2><p>æŸ¥çœ‹Java docå°±å¯ä»¥å‘ç°Collectionæ¥å£æœ‰ä¸€ä¸ªstreamæ–¹æ³•ï¼Œæ‰€ä»¥å…¶æ‰€æœ‰å­ç±»éƒ½éƒ½å¯ä»¥è·å–å¯¹åº”çš„Streamå¯¹è±¡ã€‚</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Collection</span>&lt;<span class="title">E</span>&gt; <span class="keyword">extends</span> <span class="title">Iterable</span>&lt;<span class="title">E</span>&gt; </span>&#123;</span><br><span class="line">    <span class="comment">//å…¶ä»–æ–¹æ³•çœç•¥</span></span><br><span class="line"><span class="function"><span class="keyword">default</span> Stream&lt;E&gt; <span class="title">stream</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> StreamSupport.stream(spliterator(), <span class="keyword">false</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="è½¬æ¢Stream"><a href="#è½¬æ¢Stream" class="headerlink" title="è½¬æ¢Stream"></a>è½¬æ¢Stream</h1><p>è½¬æ¢Streamå…¶å®å°±æ˜¯æŠŠä¸€ä¸ªStreamé€šè¿‡æŸäº›è¡Œä¸ºè½¬æ¢æˆä¸€ä¸ªæ–°çš„Streamã€‚Streamæ¥å£ä¸­å®šä¹‰äº†å‡ ä¸ªå¸¸ç”¨çš„è½¬æ¢æ–¹æ³•ï¼Œä¸‹é¢æŒ‘é€‰å‡ ä¸ªå¸¸ç”¨çš„è½¬æ¢æ–¹æ³•æ¥è§£é‡Šã€‚</p><ol><li><p><code>distinct</code>: å¯¹äºStreamä¸­åŒ…å«çš„å…ƒç´ è¿›è¡Œå»é‡æ“ä½œï¼ˆå»é‡é€»è¾‘ä¾èµ–å…ƒç´ çš„equalsæ–¹æ³•ï¼‰ï¼Œæ–°ç”Ÿæˆçš„Streamä¸­æ²¡æœ‰é‡å¤çš„å…ƒç´ ï¼›</p><p>distinctæ–¹æ³•ç¤ºæ„å›¾ï¼š</p><p><img src="https://gitee.com/cayzlh/img-repo/raw/master/2020/04/25/EcOtNh.jpg" alt="distinctæ–¹æ³•ç¤ºæ„å›¾"></p></li><li><p><code>filter</code>: å¯¹äºStreamä¸­åŒ…å«çš„å…ƒç´ ä½¿ç”¨ç»™å®šçš„è¿‡æ»¤å‡½æ•°è¿›è¡Œè¿‡æ»¤æ“ä½œï¼Œæ–°ç”Ÿæˆçš„StreamåªåŒ…å«ç¬¦åˆæ¡ä»¶çš„å…ƒç´ ï¼›</p><p>filteræ–¹æ³•ç¤ºæ„å›¾ï¼š</p><p><img src="https://gitee.com/cayzlh/img-repo/raw/master/2020/04/25/H9VDBX.jpg" alt="filteræ–¹æ³•ç¤ºæ„å›¾"></p></li><li><p><code>map</code>: å¯¹äºStreamä¸­åŒ…å«çš„å…ƒç´ ä½¿ç”¨ç»™å®šçš„è½¬æ¢å‡½æ•°è¿›è¡Œè½¬æ¢æ“ä½œï¼Œæ–°ç”Ÿæˆçš„StreamåªåŒ…å«è½¬æ¢ç”Ÿæˆçš„å…ƒç´ </p><p>è¿™ä¸ªæ–¹æ³•æœ‰ä¸‰ä¸ªå¯¹äºåŸå§‹ç±»å‹çš„å˜ç§æ–¹æ³•ï¼Œåˆ†åˆ«æ˜¯ï¼š<code>mapToInt</code>ï¼Œ<code>mapToLong</code>å’Œ<code>mapToDouble</code>ã€‚è¿™ä¸‰ä¸ªæ–¹æ³•ä¹Ÿæ¯”è¾ƒå¥½ç†è§£ï¼Œæ¯”å¦‚<code>mapToInt</code>å°±æ˜¯æŠŠåŸå§‹<code>Stream</code>è½¬æ¢æˆä¸€ä¸ªæ–°çš„<code>Stream</code>ï¼Œè¿™ä¸ªæ–°ç”Ÿæˆçš„<code>Stream</code>ä¸­çš„å…ƒç´ éƒ½æ˜¯<code>int</code>ç±»å‹ã€‚ä¹‹æ‰€ä»¥ä¼šæœ‰è¿™æ ·ä¸‰ä¸ªå˜ç§æ–¹æ³•ï¼Œå¯ä»¥å…é™¤è‡ªåŠ¨è£…ç®±/æ‹†ç®±çš„é¢å¤–æ¶ˆè€—ï¼›</p><p>mapæ–¹æ³•ç¤ºæ„å›¾ï¼š</p><p><img src="https://gitee.com/cayzlh/img-repo/raw/master/2020/04/25/2JGFXm.jpg" alt="mapæ–¹æ³•ç¤ºæ„å›¾"></p></li><li><p><code>flatMap</code>ï¼šå’Œ<code>map</code>ç±»ä¼¼ï¼Œä¸åŒçš„æ˜¯å…¶æ¯ä¸ªå…ƒç´ è½¬æ¢å¾—åˆ°çš„æ˜¯Streamå¯¹è±¡ï¼Œä¼šæŠŠå­Streamä¸­çš„å…ƒç´ å‹ç¼©åˆ°çˆ¶é›†åˆä¸­ï¼›</p><p>flatMapæ–¹æ³•ç¤ºæ„å›¾ï¼š</p><p><img src="https://gitee.com/cayzlh/img-repo/raw/master/2020/04/25/e7TGdu.jpg" alt="`flatMap`æ–¹æ³•ç¤ºæ„å›¾"></p></li><li><p><code>peek</code>: ç”Ÿæˆä¸€ä¸ªåŒ…å«åŸStreamçš„æ‰€æœ‰å…ƒç´ çš„æ–°Streamï¼ŒåŒæ—¶ä¼šæä¾›ä¸€ä¸ªæ¶ˆè´¹å‡½æ•°ï¼ˆConsumerå®ä¾‹ï¼‰ï¼Œæ–°Streamæ¯ä¸ªå…ƒç´ è¢«æ¶ˆè´¹çš„æ—¶å€™éƒ½ä¼šæ‰§è¡Œç»™å®šçš„æ¶ˆè´¹å‡½æ•°ï¼›</p><p>peekæ–¹æ³•ç¤ºæ„å›¾ï¼š</p><p><img src="https://gitee.com/cayzlh/img-repo/raw/master/2020/04/25/iC3J2q.jpg" alt="peekæ–¹æ³•ç¤ºæ„å›¾"></p></li><li><p><code>limit</code>: å¯¹ä¸€ä¸ªStreamè¿›è¡Œæˆªæ–­æ“ä½œï¼Œè·å–å…¶å‰Nä¸ªå…ƒç´ ï¼Œå¦‚æœåŸStreamä¸­åŒ…å«çš„å…ƒç´ ä¸ªæ•°å°äºNï¼Œé‚£å°±è·å–å…¶æ‰€æœ‰çš„å…ƒç´ ï¼›</p><p>limitæ–¹æ³•ç¤ºæ„å›¾ï¼š</p><p><img src="https://gitee.com/cayzlh/img-repo/raw/master/2020/04/25/8grjYJ.jpg" alt="limitæ–¹æ³•ç¤ºæ„å›¾"></p></li><li><p><code>skip</code>: è¿”å›ä¸€ä¸ªä¸¢å¼ƒåŸStreamçš„å‰Nä¸ªå…ƒç´ åå‰©ä¸‹å…ƒç´ ç»„æˆçš„æ–°Streamï¼Œå¦‚æœåŸStreamä¸­åŒ…å«çš„å…ƒç´ ä¸ªæ•°å°äºNï¼Œé‚£ä¹ˆè¿”å›ç©ºStreamï¼›</p><p>skipæ–¹æ³•ç¤ºæ„å›¾ï¼š</p><p><img src="https://gitee.com/cayzlh/img-repo/raw/master/2020/04/25/F5wQkI.jpg" alt="skipæ–¹æ³•ç¤ºæ„å›¾"></p></li><li><p>ç»¼åˆä½¿ç”¨ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">List&lt;Integer&gt; nums = Lists.newArrayList(<span class="number">1</span>,<span class="number">1</span>,<span class="keyword">null</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="keyword">null</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">10</span>);</span><br><span class="line">System.out.println(â€œsum is:â€+nums.stream().filter(num -&gt; num != <span class="keyword">null</span>).</span><br><span class="line">   distinct().mapToInt(num -&gt; num * <span class="number">2</span>).</span><br><span class="line">               peek(System.out::println).skip(<span class="number">2</span>).limit(<span class="number">4</span>).sum());   </span><br></pre></td></tr></table></figure><p>è¿™æ®µä»£ç æ¼”ç¤ºäº†ä¸Šé¢ä»‹ç»çš„æ‰€æœ‰è½¬æ¢æ–¹æ³•ï¼ˆé™¤äº†flatMapï¼‰ã€‚</p><p>ç®€å•è§£é‡Šä¸€ä¸‹è¿™æ®µä»£ç çš„å«ä¹‰ï¼šç»™å®šä¸€ä¸ª<code>Integer</code>ç±»å‹çš„<code>List</code>ï¼Œè·å–å…¶å¯¹åº”çš„Streamå¯¹è±¡ï¼Œç„¶åè¿›è¡Œè¿‡æ»¤æ‰nullï¼Œå†å»é‡ï¼Œå†æ¯ä¸ªå…ƒç´ ä¹˜ä»¥2ï¼Œå†æ¯ä¸ªå…ƒç´ è¢«æ¶ˆè´¹çš„æ—¶å€™æ‰“å°è‡ªèº«ï¼Œåœ¨è·³è¿‡å‰ä¸¤ä¸ªå…ƒç´ ï¼Œæœ€åå»å‰å››ä¸ªå…ƒç´ è¿›è¡ŒåŠ å’Œè¿ç®—(è§£é‡Šä¸€å¤§å †ï¼Œå¾ˆåƒåºŸè¯ï¼Œå› ä¸ºåŸºæœ¬çœ‹äº†æ–¹æ³•åå°±çŸ¥é“è¦åšä»€ä¹ˆäº†ã€‚è¿™ä¸ªå°±æ˜¯å£°æ˜å¼ç¼–ç¨‹çš„ä¸€å¤§å¥½å¤„ï¼)ã€‚</p></li><li><p>æ€§èƒ½é—®é¢˜</p><p>å¯èƒ½ä¼šæœ‰è¿™æ ·çš„ç–‘é—®ï¼šåœ¨å¯¹äºä¸€ä¸ªStreamè¿›è¡Œå¤šæ¬¡è½¬æ¢æ“ä½œï¼Œæ¯æ¬¡éƒ½å¯¹Streamçš„æ¯ä¸ªå…ƒç´ è¿›è¡Œè½¬æ¢ï¼Œè€Œä¸”æ˜¯æ‰§è¡Œå¤šæ¬¡ï¼Œè¿™æ ·æ—¶é—´å¤æ‚åº¦å°±æ˜¯ä¸€ä¸ªforå¾ªç¯é‡ŒæŠŠæ‰€æœ‰æ“ä½œéƒ½åšæ‰çš„Nï¼ˆè½¬æ¢çš„æ¬¡æ•°ï¼‰å€å•Šã€‚<strong>å…¶å®ä¸æ˜¯è¿™æ ·çš„ï¼Œè½¬æ¢æ“ä½œéƒ½æ˜¯<code>lazy</code>çš„ï¼Œå¤šä¸ªè½¬æ¢æ“ä½œåªä¼šåœ¨æ±‡èšæ“ä½œçš„æ—¶å€™èåˆèµ·æ¥ï¼Œä¸€æ¬¡å¾ªç¯å®Œæˆã€‚å¯ä»¥è¿™æ ·ç®€å•çš„ç†è§£ï¼ŒStreamé‡Œæœ‰ä¸ªæ“ä½œå‡½æ•°çš„é›†åˆï¼Œæ¯æ¬¡è½¬æ¢æ“ä½œå°±æ˜¯æŠŠè½¬æ¢å‡½æ•°æ”¾å…¥è¿™ä¸ªé›†åˆä¸­ï¼Œåœ¨æ±‡èšæ“ä½œçš„æ—¶å€™å¾ªç¯Streamå¯¹åº”çš„é›†åˆï¼Œç„¶åå¯¹æ¯ä¸ªå…ƒç´ æ‰§è¡Œæ‰€æœ‰çš„å‡½æ•°ã€‚</strong></p></li></ol><h1 id="æ±‡èšï¼ˆReduceï¼‰Stream"><a href="#æ±‡èšï¼ˆReduceï¼‰Stream" class="headerlink" title="æ±‡èšï¼ˆReduceï¼‰Stream"></a>æ±‡èšï¼ˆReduceï¼‰Stream</h1><p><strong>Java docä¸­å¯¹äºå…¶å®šä¹‰ï¼š</strong></p><blockquote><p>A reduction operation (also called a fold) takes a sequence of input elements and combines them into a single summary result by repeated application of a combining operation, such as finding the sum or maximum of a set of numbers, or accumulating elements into a list. The streams classes have multiple forms of general reduction operations, called reduce() and collect(), as well as multiple specialized reduction forms such as sum(), max(), or count().</p><p>æ±‡èšæ“ä½œï¼ˆä¹Ÿç§°ä¸ºæŠ˜å ï¼‰æ¥å—ä¸€ä¸ªå…ƒç´ åºåˆ—ä¸ºè¾“å…¥ï¼Œåå¤ä½¿ç”¨æŸä¸ªåˆå¹¶æ“ä½œï¼ŒæŠŠåºåˆ—ä¸­çš„å…ƒç´ åˆå¹¶æˆä¸€ä¸ªæ±‡æ€»çš„ç»“æœã€‚æ¯”å¦‚æŸ¥æ‰¾ä¸€ä¸ªæ•°å­—åˆ—è¡¨çš„æ€»å’Œæˆ–è€…æœ€å¤§å€¼ï¼Œæˆ–è€…æŠŠè¿™äº›æ•°å­—ç´¯ç§¯æˆä¸€ä¸ªListå¯¹è±¡ã€‚Streamæ¥å£æœ‰ä¸€äº›é€šç”¨çš„æ±‡èšæ“ä½œï¼Œæ¯”å¦‚reduce()å’Œcollect()ï¼›ä¹Ÿæœ‰ä¸€äº›ç‰¹å®šç”¨é€”çš„æ±‡èšæ“ä½œï¼Œæ¯”å¦‚sum(),max()å’Œcount()ã€‚<strong>æ³¨æ„ï¼šsumæ–¹æ³•ä¸æ˜¯æ‰€æœ‰çš„Streamå¯¹è±¡éƒ½æœ‰çš„ï¼Œåªæœ‰IntStreamã€LongStreamå’ŒDoubleStreamæ˜¯å®ä¾‹æ‰æœ‰ã€‚</strong></p></blockquote><p>åˆ†ä¸¤éƒ¨åˆ†æ¥ä»‹ç»æ±‡èšæ“ä½œï¼š</p><ol><li><strong>å¯å˜æ±‡èš</strong>ï¼šæŠŠè¾“å…¥çš„å…ƒç´ ä»¬ç´¯ç§¯åˆ°ä¸€ä¸ªå¯å˜çš„å®¹å™¨ä¸­ï¼Œæ¯”å¦‚Collectionæˆ–è€…StringBuilderï¼›</li><li><strong>å…¶ä»–æ±‡èš</strong>ï¼šé™¤å»å¯å˜æ±‡èšå‰©ä¸‹çš„ï¼Œä¸€èˆ¬éƒ½ä¸æ˜¯é€šè¿‡åå¤ä¿®æ”¹æŸä¸ªå¯å˜å¯¹è±¡ï¼Œè€Œæ˜¯é€šè¿‡æŠŠå‰ä¸€æ¬¡çš„æ±‡èšç»“æœå½“æˆä¸‹ä¸€æ¬¡çš„å…¥å‚ï¼Œåå¤å¦‚æ­¤ã€‚æ¯”å¦‚reduceï¼Œcountï¼ŒallMatchï¼›</li></ol><h2 id="å¯å˜æ±‡èš"><a href="#å¯å˜æ±‡èš" class="headerlink" title="å¯å˜æ±‡èš"></a>å¯å˜æ±‡èš</h2><p>å¯å˜æ±‡èšå¯¹åº”çš„åªæœ‰ä¸€ä¸ªæ–¹æ³•ï¼šcollectï¼Œæ­£å¦‚å…¶åå­—æ˜¾ç¤ºçš„ï¼Œå®ƒå¯ä»¥æŠŠStreamä¸­çš„è¦æœ‰å…ƒç´ æ”¶é›†åˆ°ä¸€ä¸ªç»“æœå®¹å™¨ä¸­ï¼ˆæ¯”å¦‚Collectionï¼‰ã€‚å…ˆçœ‹ä¸€ä¸‹æœ€é€šç”¨çš„collectæ–¹æ³•çš„å®šä¹‰ï¼ˆè¿˜æœ‰å…¶ä»–overrideæ–¹æ³•ï¼‰ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">&lt;R&gt; <span class="function">R <span class="title">collect</span><span class="params">(Supplier&lt;R&gt; supplier,</span></span></span><br><span class="line"><span class="function"><span class="params">                  BiConsumer&lt;R, ? <span class="keyword">super</span> T&gt; accumulator,</span></span></span><br><span class="line"><span class="function"><span class="params">                  BiConsumer&lt;R, R&gt; combiner)</span></span>;</span><br></pre></td></tr></table></figure><p>å…ˆæ¥çœ‹çœ‹è¿™ä¸‰ä¸ªå‚æ•°çš„å«ä¹‰ï¼š</p><p><code>Supplier supplier</code>æ˜¯ä¸€ä¸ªå·¥å‚å‡½æ•°ï¼Œç”¨æ¥ç”Ÿæˆä¸€ä¸ªæ–°çš„å®¹å™¨ï¼›</p><p><code>BiConsumer accumulator</code>ä¹Ÿæ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œç”¨æ¥æŠŠStreamä¸­çš„å…ƒç´ æ·»åŠ åˆ°ç»“æœå®¹å™¨ä¸­ï¼›</p><p><code>BiConsumer combiner</code>è¿˜æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œç”¨æ¥æŠŠä¸­é—´çŠ¶æ€çš„å¤šä¸ªç»“æœå®¹å™¨åˆå¹¶æˆä¸ºä¸€ä¸ªï¼ˆå¹¶å‘çš„æ—¶å€™ä¼šç”¨åˆ°ï¼‰ï¼›</p><p>æ¥æ®µä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">List&lt;Integer&gt; nums = Lists.newArrayList(<span class="number">1</span>,<span class="number">1</span>,<span class="keyword">null</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="keyword">null</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">10</span>);</span><br><span class="line">       List&lt;Integer&gt; numsWithoutNull = nums.stream().filter(num -&gt; num != <span class="keyword">null</span>).</span><br><span class="line">               collect(() -&gt; <span class="keyword">new</span> ArrayList&lt;Integer&gt;(),</span><br><span class="line">                       (list, item) -&gt; list.add(item),</span><br><span class="line">                       (list1, list2) -&gt; list1.addAll(list2));</span><br></pre></td></tr></table></figure><p>ä¸Šé¢è¿™æ®µä»£ç å°±æ˜¯å¯¹ä¸€ä¸ªå…ƒç´ æ˜¯Integerç±»å‹çš„Listï¼Œå…ˆè¿‡æ»¤æ‰å…¨éƒ¨çš„nullï¼Œç„¶åæŠŠå‰©ä¸‹çš„å…ƒç´ æ”¶é›†åˆ°ä¸€ä¸ªæ–°çš„Listä¸­ã€‚è¿›ä¸€æ­¥çœ‹ä¸€ä¸‹collectæ–¹æ³•çš„ä¸‰ä¸ªå‚æ•°ï¼Œéƒ½æ˜¯lambdaå½¢å¼çš„å‡½æ•°ã€‚</p><ul><li>ç¬¬ä¸€ä¸ªå‡½æ•°ç”Ÿæˆä¸€ä¸ªæ–°çš„ArrayListå®ä¾‹ï¼›</li><li>ç¬¬äºŒä¸ªå‡½æ•°æ¥å—ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªæ˜¯å‰é¢ç”Ÿæˆçš„ArrayListå¯¹è±¡ï¼ŒäºŒä¸ªæ˜¯streamä¸­åŒ…å«çš„å…ƒç´ ï¼Œå‡½æ•°ä½“å°±æ˜¯æŠŠstreamä¸­çš„å…ƒç´ åŠ å…¥ArrayListå¯¹è±¡ä¸­ã€‚ç¬¬äºŒä¸ªå‡½æ•°è¢«åå¤è°ƒç”¨ç›´åˆ°åŸstreamçš„å…ƒç´ è¢«æ¶ˆè´¹å®Œæ¯•ï¼›</li><li>ç¬¬ä¸‰ä¸ªå‡½æ•°ä¹Ÿæ˜¯æ¥å—ä¸¤ä¸ªå‚æ•°ï¼Œè¿™ä¸¤ä¸ªéƒ½æ˜¯ArrayListç±»å‹çš„ï¼Œå‡½æ•°ä½“å°±æ˜¯æŠŠç¬¬äºŒä¸ªArrayListå…¨éƒ¨åŠ å…¥åˆ°ç¬¬ä¸€ä¸ªä¸­ï¼›</li></ul><p>ä½†æ˜¯ä¸Šé¢çš„collectæ–¹æ³•è°ƒç”¨ä¹Ÿæœ‰ç‚¹å¤ªå¤æ‚äº†ï¼Œæ¥çœ‹ä¸€ä¸‹collectæ–¹æ³•å¦å¤–ä¸€ä¸ªoverrideçš„ç‰ˆæœ¬ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">&lt;R, A&gt; <span class="function">R <span class="title">collect</span><span class="params">(Collector&lt;? <span class="keyword">super</span> T, A, R&gt; collector)</span></span>;</span><br></pre></td></tr></table></figure><p><strong>Java8è¿˜ç»™æˆ‘ä»¬æä¾›äº†Collectorçš„å·¥å…·ç±»ï¼Œå…¶ä¸­å·²ç»å®šä¹‰äº†ä¸€äº›é™æ€å·¥å‚æ–¹æ³•ï¼Œæ¯”å¦‚ï¼šCollectors.toCollection()æ”¶é›†åˆ°Collectionä¸­, Collectors.toList()æ”¶é›†åˆ°Listä¸­å’ŒCollectors.toSet()æ”¶é›†åˆ°Setä¸­ã€‚</strong></p><p>ä½¿ç”¨Collectorså¯¹äºä»£ç çš„ç®€åŒ–ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">List&lt;Integer&gt; numsWithoutNull = nums.stream().filter(num -&gt; num != <span class="keyword">null</span>).</span><br><span class="line">                collect(Collectors.toList());</span><br></pre></td></tr></table></figure><h2 id="å…¶ä»–æ±‡èš"><a href="#å…¶ä»–æ±‡èš" class="headerlink" title="å…¶ä»–æ±‡èš"></a>å…¶ä»–æ±‡èš</h2><ul><li><strong>reduceæ–¹æ³•ï¼š</strong>reduceæ–¹æ³•éå¸¸çš„é€šç”¨ï¼Œåé¢ä»‹ç»çš„countï¼Œsumç­‰éƒ½å¯ä»¥ä½¿ç”¨å…¶å®ç°ã€‚</li></ul><p>reduceæ–¹æ³•çš„ç¬¬ä¸€ç§å½¢å¼ï¼Œå…¶æ–¹æ³•å®šä¹‰å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function">Optional&lt;T&gt; <span class="title">reduce</span><span class="params">(BinaryOperator&lt;T&gt; accumulator)</span></span>;</span><br></pre></td></tr></table></figure><p>æ¥å—ä¸€ä¸ªBinaryOperatorç±»å‹çš„å‚æ•°ï¼Œåœ¨ä½¿ç”¨çš„æ—¶å€™å¯ä»¥ç”¨lambdaè¡¨è¾¾å¼æ¥ã€‚</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">List&lt;Integer&gt; ints = Lists.newArrayList(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">10</span>);</span><br><span class="line">System.out.println(<span class="string">&quot;ints sum is:&quot;</span> + ints.stream().reduce((sum, item) -&amp;gt; sum + item).get());</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°reduceæ–¹æ³•æ¥å—ä¸€ä¸ªå‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°æœ‰ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ä¸Šæ¬¡å‡½æ•°æ‰§è¡Œçš„è¿”å›å€¼ï¼ˆä¹Ÿç§°ä¸ºä¸­é—´ç»“æœï¼‰ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯streamä¸­çš„å…ƒç´ ï¼Œè¿™ä¸ªå‡½æ•°æŠŠè¿™ä¸¤ä¸ªå€¼ç›¸åŠ ï¼Œå¾—åˆ°çš„å’Œä¼šè¢«èµ‹å€¼ç»™ä¸‹æ¬¡æ‰§è¡Œè¿™ä¸ªå‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°ã€‚è¦æ³¨æ„çš„æ˜¯ï¼š<strong>ç¬¬ä¸€æ¬¡æ‰§è¡Œçš„æ—¶å€™ç¬¬ä¸€ä¸ªå‚æ•°çš„å€¼æ˜¯Streamçš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯Streamçš„ç¬¬äºŒä¸ªå…ƒç´ </strong>ã€‚è¿™ä¸ªæ–¹æ³•è¿”å›å€¼ç±»å‹æ˜¯Optionalï¼Œè¿™æ˜¯Java8é˜²æ­¢å‡ºç°NPEçš„ä¸€ç§å¯è¡Œæ–¹æ³•ï¼Œåé¢çš„æ–‡ç« ä¼šè¯¦ç»†ä»‹ç»ï¼Œè¿™é‡Œå°±ç®€å•çš„è®¤ä¸ºæ˜¯ä¸€ä¸ªå®¹å™¨ï¼Œå…¶ä¸­å¯èƒ½ä¼šåŒ…å«0ä¸ªæˆ–è€…1ä¸ªå¯¹è±¡ã€‚</p><p><strong>reduceæ–¹æ³•è¿˜æœ‰ä¸€ä¸ªå¾ˆå¸¸ç”¨çš„å˜ç§ï¼š</strong></p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function">T <span class="title">reduce</span><span class="params">(T identity, BinaryOperator&lt;T&gt; accumulator)</span></span>;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªå®šä¹‰ä¸Šä¸Šé¢å·²ç»ä»‹ç»è¿‡çš„åŸºæœ¬ä¸€è‡´ï¼Œä¸åŒçš„æ˜¯ï¼šå®ƒå…è®¸ç”¨æˆ·æä¾›ä¸€ä¸ªå¾ªç¯è®¡ç®—çš„åˆå§‹å€¼ï¼Œå¦‚æœStreamä¸ºç©ºï¼Œå°±ç›´æ¥è¿”å›è¯¥å€¼ã€‚è€Œä¸”è¿™ä¸ªæ–¹æ³•ä¸ä¼šè¿”å›Optionalï¼Œå› ä¸ºå…¶ä¸ä¼šå‡ºç°nullå€¼ã€‚</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">List&lt;Integer&gt; ints = Lists.newArrayList(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">10</span>);</span><br><span class="line">System.out.println(<span class="string">&quot;ints sum is:&quot;</span> + ints.stream().reduce(<span class="number">0</span>, (sum, item) -&gt; sum + item));</span><br></pre></td></tr></table></figure><ul><li><strong>countæ–¹æ³•ï¼š</strong>è·å–Streamä¸­å…ƒç´ çš„ä¸ªæ•°</li></ul><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">List&lt;Integer&gt; ints = Lists.newArrayList(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">10</span>);</span><br><span class="line">System.out.println(<span class="string">&quot;ints sum is:&quot;</span> + ints.stream().count());</span><br></pre></td></tr></table></figure><hr><p>å…¶ä»–æ–¹æ³•ï¼š</p><ul><li><strong>allMatchï¼š</strong>æ˜¯ä¸æ˜¯Streamä¸­çš„æ‰€æœ‰å…ƒç´ éƒ½æ»¡è¶³ç»™å®šçš„åŒ¹é…æ¡ä»¶</li><li><strong>anyMatchï¼š</strong>Streamä¸­æ˜¯å¦å­˜åœ¨ä»»ä½•ä¸€ä¸ªå…ƒç´ æ»¡è¶³åŒ¹é…æ¡ä»¶</li><li><strong>findFirstï¼š</strong> è¿”å›Streamä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œå¦‚æœStreamä¸ºç©ºï¼Œè¿”å›ç©ºOptional</li><li><strong>noneMatchï¼š</strong>æ˜¯ä¸æ˜¯Streamä¸­çš„æ‰€æœ‰å…ƒç´ éƒ½ä¸æ»¡è¶³ç»™å®šçš„åŒ¹é…æ¡ä»¶</li><li><strong>maxå’Œminï¼š</strong>ä½¿ç”¨ç»™å®šçš„æ¯”è¾ƒå™¨ï¼ˆOperatorï¼‰ï¼Œè¿”å›Streamä¸­çš„æœ€å¤§|æœ€å°å€¼</li></ul><h1 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h1><ul><li><a href="http://ifeve.com/">ifeve.com</a></li><li>ã€ŠJava SE 8 for the Really Impatientã€‹</li><li>Java 8 Tutorial</li><li>Java 8 API doc</li></ul>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹æŠ€æœ¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> Stream </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>lambdaè¡¨è¾¾å¼è¯­æ³•</title>
      <link href="post/645430451/"/>
      <url>post/645430451/</url>
      
        <content type="html"><![CDATA[<blockquote><p>æœ¬æ–‡è½¬è‡ªï¼š<a href="http://ifeve.com/">ifeve.com</a></p></blockquote><h1 id="Lambdaåˆä½“éªŒ"><a href="#Lambdaåˆä½“éªŒ" class="headerlink" title="Lambdaåˆä½“éªŒ"></a>Lambdaåˆä½“éªŒ</h1><blockquote><p> a function (or a subroutine) defined, and possibly called, without being bound to an identifierã€‚</p><p>ä»¥ä¸Šæ˜¯ç»´åŸºç™¾ç§‘ä¸Šå¯¹äºâ€œLambda expressionâ€çš„è§£é‡Šï¼Œç®€å•æ¥è¯´å°±æ˜¯ï¼š<strong>ä¸€ä¸ªä¸ç”¨è¢«ç»‘å®šåˆ°ä¸€ä¸ªæ ‡è¯†ç¬¦ä¸Šï¼Œå¹¶ä¸”å¯èƒ½è¢«è°ƒç”¨çš„å‡½æ•°ã€‚</strong></p></blockquote><p>è¿™ä¸ªè§£é‡Šè¿˜ä¸å¤Ÿé€šä¿—ï¼Œlambdaè¡¨è¾¾å¼å¯ä»¥è¿™æ ·å®šä¹‰ï¼ˆä¸ç²¾ç¡®ï¼‰ï¼š<strong>ä¸€æ®µå¸¦æœ‰è¾“å…¥å‚æ•°çš„å¯æ‰§è¡Œè¯­å¥å—ã€‚</strong></p><p>å…ˆæä¾›ä¸€ä¸ªæ²¡ç”¨streamçš„lambdaè¡¨è¾¾å¼çš„ä¾‹å­ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//è¿™é‡Œçœç•¥listçš„æ„é€ </span></span><br><span class="line">List&lt;String&gt; names = ...;</span><br><span class="line">Collections.sort(names, (o1, o2) -&gt; o1.compareTo(o2));</span><br></pre></td></tr></table></figure><p>-</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//è¿™é‡Œçœç•¥listçš„æ„é€ </span></span><br><span class="line">List&lt;String&gt; names = ...;</span><br><span class="line">Collections.sort(names, <span class="keyword">new</span> Comparator&lt;String&gt;() &#123;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compare</span><span class="params">(String o1, String o2)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> o1.compareTo(o2);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>ä¸Šé¢ä¸¤æ®µä»£ç åˆ†åˆ«æ˜¯ï¼š<strong>ä½¿ç”¨lambdaè¡¨è¾¾å¼æ¥æ’åºå’Œä½¿ç”¨åŒ¿åå†…éƒ¨ç±»æ¥æ’åºã€‚</strong></p><p>è¿™ä¸ªä¾‹å­å¯ä»¥å¾ˆæ˜æ˜¾çš„çœ‹å‡ºlambdaè¡¨è¾¾å¼ç®€åŒ–ä»£ç çš„æ•ˆæœã€‚æ¥ä¸‹æ¥å±•ç¤ºlambdaè¡¨è¾¾å¼å’Œå…¶å¥½åŸºå‹Streamçš„é…åˆï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">List&lt;String&gt; names = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">names.add(<span class="string">&quot;TaoBao&quot;</span>);</span><br><span class="line">names.add(<span class="string">&quot;ZhiFuBao&quot;</span>);</span><br><span class="line">List&lt;String&gt; lowercaseNames = names.stream().map((String name) -&gt; &#123;<span class="keyword">return</span> name.toLowerCase();&#125;).collect(Collectors.toList());</span><br></pre></td></tr></table></figure><p>è¿™æ®µä»£ç å°±æ˜¯å¯¹ä¸€ä¸ªå­—ç¬¦ä¸²çš„åˆ—è¡¨ï¼ŒæŠŠå…¶ä¸­åŒ…å«çš„æ¯ä¸ªå­—ç¬¦ä¸²éƒ½è½¬æ¢æˆå…¨å°å†™çš„å­—ç¬¦ä¸²ã€‚æ³¨æ„ä»£ç ç¬¬å››è¡Œçš„mapæ–¹æ³•è°ƒç”¨ï¼Œè¿™é‡Œmapæ–¹æ³•å°±æ˜¯æ¥å—äº†ä¸€ä¸ªlambdaè¡¨è¾¾å¼ï¼ˆ<em>å…¶å®æ˜¯ä¸€ä¸ªjava.util.function.Functionçš„å®ä¾‹</em>ï¼‰ã€‚</p><p><strong>çœ‹çœ‹åœ¨Java8ä¹‹å‰ï¼Œå¦‚æœæˆ‘ä»¬æƒ³åšä¸Šé¢ä»£ç çš„æ“ä½œåº”è¯¥æ€ä¹ˆåŠã€‚</strong></p><ul><li><p>æ™®é€šé’å¹´çš„ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">List&lt;String&gt; names = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">names.add(<span class="string">&quot;TaoBao&quot;</span>);</span><br><span class="line">names.add(<span class="string">&quot;ZhiFuBao&quot;</span>);</span><br><span class="line">List&lt;String&gt; lowercaseNames = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line"><span class="keyword">for</span> (String name : names) &#123;</span><br><span class="line">  lowercaseNames.add(name.toLowerCase());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>æ–‡è‰ºé’å¹´çš„ä»£ç ï¼ˆå€ŸåŠ©Guavaï¼‰:</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">List&lt;String&gt; names = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">names.add(<span class="string">&quot;TaoBao&quot;</span>);</span><br><span class="line">names.add(<span class="string">&quot;ZhiFuBao&quot;</span>);</span><br><span class="line">List&lt;String&gt; lowercaseNames = FluentIterable.from(names).transform(<span class="keyword">new</span> Function&lt;String, String&gt;() &#123;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> String <span class="title">apply</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> name.toLowerCase();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;).toList();</span><br></pre></td></tr></table></figure></li></ul><p>åœ¨æ­¤ï¼Œä¸å†è®¨è®ºæ™®é€šé’å¹´å’Œæ–‡è‰ºé’å¹´çš„ä»£ç é£æ ¼å­°ä¼˜å­°åŠ£ï¼ˆæœ‰å…´è¶£çš„å¯ä»¥å»googleæœç´¢â€œå‘½ä»¤å¼ç¼–ç¨‹vså£°æ˜å¼ç¼–ç¨‹â€ï¼‰ã€‚</p><p>æ–‡è‰ºé’å¹´ä»£ç åˆçœ‹èµ·æ¥çœ‹èµ·æ¥å¹²æ‰°ä¿¡æ¯æœ‰ç‚¹å¤šï¼ŒFunctionåŒ¿åç±»çš„æ„é€ è¯­æ³•ç¨ç¨æœ‰ç‚¹å†—é•¿ã€‚æ‰€ä»¥<strong>Java8çš„lambdaè¡¨è¾¾å¼ç»™æˆ‘ä»¬æä¾›äº†åˆ›å»ºSAMï¼ˆSingle Abstract Methodï¼‰æ¥å£æ›´åŠ ç®€å•çš„è¯­æ³•ç³–ã€‚</strong></p><h1 id="Lambdaè¯­æ³•è¯¦è§£"><a href="#Lambdaè¯­æ³•è¯¦è§£" class="headerlink" title="Lambdaè¯­æ³•è¯¦è§£"></a>Lambdaè¯­æ³•è¯¦è§£</h1><p><strong>æŠ½è±¡ä¸€ä¸‹lambdaè¡¨è¾¾å¼çš„ä¸€èˆ¬è¯­æ³•ï¼š</strong></p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">(Type1 param1, Type2 param2, ..., TypeN paramN) -&gt; &#123;</span><br><span class="line">  statment1;</span><br><span class="line">  statment2;</span><br><span class="line">  <span class="comment">//.............</span></span><br><span class="line">  <span class="keyword">return</span> statmentM;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»lambdaè¡¨è¾¾å¼çš„ä¸€èˆ¬è¯­æ³•å¯ä»¥çœ‹å‡ºæ¥ï¼Œè¿˜æ˜¯æŒºç¬¦åˆä¸Šé¢ç»™å‡ºçš„éç²¾ç¡®ç‰ˆæœ¬çš„å®šä¹‰â€“<strong>â€œä¸€æ®µå¸¦æœ‰è¾“å…¥å‚æ•°çš„å¯æ‰§è¡Œè¯­å¥å—â€ã€‚</strong></p><p>ä¸Šé¢çš„lambdaè¡¨è¾¾å¼è¯­æ³•å¯ä»¥è®¤ä¸ºæ˜¯æœ€å…¨çš„ç‰ˆæœ¬ï¼Œå†™èµ·æ¥è¿˜æ˜¯ç¨ç¨æœ‰äº›ç¹çã€‚åˆ«ç€æ€¥ï¼Œä¸‹é¢é™†ç»­ä»‹ç»ä¸€ä¸‹lambdaè¡¨è¾¾å¼çš„å„ç§ç®€åŒ–ç‰ˆï¼š</p><ol><li><p>å‚æ•°ç±»å‹çœç•¥â€“ç»å¤§å¤šæ•°æƒ…å†µï¼Œç¼–è¯‘å™¨éƒ½å¯ä»¥ä»ä¸Šä¸‹æ–‡ç¯å¢ƒä¸­æ¨æ–­å‡ºlambdaè¡¨è¾¾å¼çš„å‚æ•°ç±»å‹ã€‚è¿™æ ·lambdaè¡¨è¾¾å¼å°±å˜æˆäº†ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">(param1,param2, ..., paramN) -&gt; &#123;</span><br><span class="line">  statment1;</span><br><span class="line">  statment2;</span><br><span class="line">  <span class="comment">//.............</span></span><br><span class="line">  <span class="keyword">return</span> statmentM;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>å½“lambdaè¡¨è¾¾å¼çš„å‚æ•°ä¸ªæ•°åªæœ‰ä¸€ä¸ªï¼Œå¯ä»¥çœç•¥å°æ‹¬å·ã€‚lambdaè¡¨è¾¾å¼ç®€å†™ä¸ºï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">param1 -&gt; &#123;</span><br><span class="line">  statment1;</span><br><span class="line">  statment2;</span><br><span class="line">  <span class="comment">//.............</span></span><br><span class="line">  <span class="keyword">return</span> statmentM;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥æœ€å¼€å§‹çš„ä¾‹å­å†æ¬¡ç®€åŒ–ä¸ºï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">List&lt;String&gt; lowercaseNames = names.stream().map(name -&gt; &#123;<span class="keyword">return</span> name.toLowerCase();&#125;).collect(Collectors.toList());</span><br></pre></td></tr></table></figure></li><li><p>å½“lambdaè¡¨è¾¾å¼åªåŒ…å«ä¸€æ¡è¯­å¥æ—¶ï¼Œå¯ä»¥çœç•¥å¤§æ‹¬å·ã€returnå’Œè¯­å¥ç»“å°¾çš„åˆ†å·ã€‚lambdaè¡¨è¾¾å¼ç®€åŒ–ä¸ºï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">param1 -&gt; statment</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥æœ€å¼€å§‹çš„ä¾‹å­å†æ¬¡ç®€åŒ–ä¸ºï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">List&lt;String&gt; lowercaseNames = names.stream().map(name -&gt; name.toLowerCase()).collect(Collectors.toList());</span><br></pre></td></tr></table></figure></li><li><p>ä½¿ç”¨Method Referenceï¼ˆæ–¹æ³•å¼•ç”¨ï¼‰:</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">List&lt;String&gt; lowercaseNames = names.stream().map(String::toLowerCase).collect(Collectors.toList());</span><br></pre></td></tr></table></figure></li></ol><h1 id="Lambdaè¡¨è¾¾å¼çœ¼ä¸­çš„å¤–éƒ¨ä¸–ç•Œ"><a href="#Lambdaè¡¨è¾¾å¼çœ¼ä¸­çš„å¤–éƒ¨ä¸–ç•Œ" class="headerlink" title="Lambdaè¡¨è¾¾å¼çœ¼ä¸­çš„å¤–éƒ¨ä¸–ç•Œ"></a>Lambdaè¡¨è¾¾å¼çœ¼ä¸­çš„å¤–éƒ¨ä¸–ç•Œ</h1><blockquote><p>lambdaè¡¨è¾¾å¼å…¶å®æ˜¯å¿«é€Ÿåˆ›å»ºSAMæ¥å£çš„è¯­æ³•ç³–ï¼ŒåŸå…ˆçš„SAMæ¥å£éƒ½å¯ä»¥è®¿é—®æ¥å£å¤–éƒ¨å˜é‡ï¼Œlambdaè¡¨è¾¾å¼è‚¯å®šä¹Ÿæ˜¯å¯ä»¥ï¼ˆä¸ä½†å¯ä»¥ï¼Œåœ¨java8ä¸­è¿˜åšäº†ä¸€ä¸ªå°å°çš„å‡çº§ï¼‰ã€‚</p></blockquote><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">String[] array = &#123;<span class="string">&quot;a&quot;</span>, <span class="string">&quot;b&quot;</span>, <span class="string">&quot;c&quot;</span>&#125;;</span><br><span class="line"><span class="keyword">for</span>(Integer i : Lists.newArrayList(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>))&#123;</span><br><span class="line">  Stream.of(array).map(item -&gt; Strings.padEnd(item, i, <span class="string">&#x27;@&#x27;</span>)).forEach(System.out::println);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„è¿™ä¸ªä¾‹å­ä¸­ï¼Œmapä¸­çš„lambdaè¡¨è¾¾å¼è®¿é—®å¤–éƒ¨å˜é‡Integer iã€‚å¹¶ä¸”å¯ä»¥è®¿é—®å¤–éƒ¨å˜é‡æ˜¯lambdaè¡¨è¾¾å¼çš„ä¸€ä¸ªé‡è¦ç‰¹æ€§ï¼Œè¿™æ ·æˆ‘ä»¬å¯ä»¥çœ‹å‡ºæ¥lambdaè¡¨è¾¾å¼çš„ä¸‰ä¸ªé‡è¦ç»„æˆéƒ¨åˆ†ï¼š</p><ul><li>è¾“å…¥å‚æ•°</li><li>å¯æ‰§è¡Œè¯­å¥</li><li>å­˜æ”¾å¤–éƒ¨å˜é‡çš„ç©ºé—´</li></ul><p>ä¸è¿‡lambdaè¡¨è¾¾å¼è®¿é—®å¤–éƒ¨å˜é‡æœ‰ä¸€ä¸ªéå¸¸é‡è¦çš„é™åˆ¶ï¼š<strong>å˜é‡ä¸å¯å˜ï¼ˆåªæ˜¯å¼•ç”¨ä¸å¯å˜ï¼Œè€Œä¸æ˜¯çœŸæ­£çš„ä¸å¯å˜ï¼‰ã€‚</strong></p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">String[] array = &#123;<span class="string">&quot;a&quot;</span>, <span class="string">&quot;b&quot;</span>, <span class="string">&quot;c&quot;</span>&#125;;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i&lt;<span class="number">4</span>; i++)&#123;</span><br><span class="line">  Stream.of(array).map(item -&gt; Strings.padEnd(item, i, <span class="string">&#x27;@&#x27;</span>)).forEach(System.out::println);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„ä»£ç ï¼Œä¼šæŠ¥ç¼–è¯‘é”™è¯¯ã€‚å› ä¸ºå˜é‡iè¢«lambdaè¡¨è¾¾å¼å¼•ç”¨ï¼Œæ‰€ä»¥ç¼–è¯‘å™¨ä¼šéšå¼çš„æŠŠå…¶å½“æˆfinalæ¥å¤„ç†ã€‚</p><blockquote><p>ä»¥å‰javaçš„åŒ¿åå†…éƒ¨ç±»åœ¨è®¿é—®å¤–éƒ¨å˜é‡çš„æ—¶å€™ï¼Œå¤–éƒ¨å˜é‡å¿…é¡»ç”¨finalä¿®é¥°ã€‚<strong>åœ¨java8å¯¹è¿™ä¸ªé™åˆ¶åšäº†ä¼˜åŒ–ï¼ˆå‰é¢è¯´çš„å°å°ä¼˜åŒ–ï¼‰ï¼Œå¯ä»¥ä¸ç”¨æ˜¾ç¤ºä½¿ç”¨finalä¿®é¥°ï¼Œä½†æ˜¯ç¼–è¯‘å™¨éšå¼å½“æˆfinalæ¥å¤„ç†ã€‚</strong></p></blockquote><h1 id="Lambdaçœ¼ä¸­çš„this"><a href="#Lambdaçœ¼ä¸­çš„this" class="headerlink" title="Lambdaçœ¼ä¸­çš„this"></a>Lambdaçœ¼ä¸­çš„this</h1><p>åœ¨lambdaä¸­ï¼Œthisä¸æ˜¯æŒ‡å‘lambdaè¡¨è¾¾å¼äº§ç”Ÿçš„é‚£ä¸ªSAMå¯¹è±¡ï¼Œè€Œæ˜¯å£°æ˜å®ƒçš„å¤–éƒ¨å¯¹è±¡ã€‚</p><h1 id="æ–¹æ³•å¼•ç”¨ï¼ˆMethod-referenceï¼‰å’Œæ„é€ å™¨å¼•ç”¨ï¼ˆconstruct-referenceï¼‰"><a href="#æ–¹æ³•å¼•ç”¨ï¼ˆMethod-referenceï¼‰å’Œæ„é€ å™¨å¼•ç”¨ï¼ˆconstruct-referenceï¼‰" class="headerlink" title="æ–¹æ³•å¼•ç”¨ï¼ˆMethod referenceï¼‰å’Œæ„é€ å™¨å¼•ç”¨ï¼ˆconstruct referenceï¼‰"></a>æ–¹æ³•å¼•ç”¨ï¼ˆMethod referenceï¼‰å’Œæ„é€ å™¨å¼•ç”¨ï¼ˆconstruct referenceï¼‰</h1><h2 id="æ–¹æ³•å¼•ç”¨"><a href="#æ–¹æ³•å¼•ç”¨" class="headerlink" title="æ–¹æ³•å¼•ç”¨"></a>æ–¹æ³•å¼•ç”¨</h2><p>æ–¹æ³•å¼•ç”¨å¯ä»¥åœ¨æŸäº›æ¡ä»¶æˆç«‹çš„æƒ…å†µä¸‹ï¼Œæ›´åŠ ç®€åŒ–lambdaè¡¨è¾¾å¼çš„å£°æ˜ã€‚</p><p>æ–¹æ³•å¼•ç”¨è¯­æ³•æ ¼å¼æœ‰ä»¥ä¸‹ä¸‰ç§ï¼š</p><ul><li><strong>objectName::instanceMethod</strong></li><li><strong>ClassName::staticMethod</strong></li><li><strong>ClassName::instanceMethod</strong></li></ul><p>å‰ä¸¤ç§æ–¹å¼ç±»ä¼¼ï¼Œç­‰åŒäºæŠŠlambdaè¡¨è¾¾å¼çš„å‚æ•°ç›´æ¥å½“æˆ<code>instanceMethod|staticMethod</code>çš„å‚æ•°æ¥è°ƒç”¨ã€‚æ¯”å¦‚<code>System.out::println</code>ç­‰åŒäº<code>x-&gt;System.out.println(x)</code>ï¼›<code>Math::max</code>ç­‰åŒäº<code>(x, y)-&gt;Math.max(x,y)</code>ã€‚</p><p>æœ€åä¸€ç§æ–¹å¼ï¼Œç­‰åŒäºæŠŠlambdaè¡¨è¾¾å¼çš„ç¬¬ä¸€ä¸ªå‚æ•°å½“æˆ<code>instanceMethod</code>çš„ç›®æ ‡å¯¹è±¡ï¼Œå…¶ä»–å‰©ä½™å‚æ•°å½“æˆè¯¥æ–¹æ³•çš„å‚æ•°ã€‚æ¯”å¦‚<code>String::toLowerCase</code>ç­‰åŒäº<code>x-&gt;x.toLowerCase()</code>ã€‚</p><h2 id="æ„é€ å™¨å¼•ç”¨"><a href="#æ„é€ å™¨å¼•ç”¨" class="headerlink" title="æ„é€ å™¨å¼•ç”¨"></a>æ„é€ å™¨å¼•ç”¨</h2><p>æ„é€ å™¨å¼•ç”¨è¯­æ³•å¦‚ä¸‹ï¼š<code>ClassName::new</code>ï¼ŒæŠŠlambdaè¡¨è¾¾å¼çš„å‚æ•°å½“æˆ<code>ClassName</code>æ„é€ å™¨çš„å‚æ•° ã€‚ä¾‹å¦‚<code>BigDecimal::new</code>ç­‰åŒäº<code>x-&gt;new BigDecimal(x)</code>ã€‚</p><h1 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h1><ul><li><a href="http://ifeve.com/">ifeve.com</a></li><li>ã€ŠJava SE 8 for the Really Impatientã€‹</li><li>Java 8 Tutorial</li><li>Java 8 API doc</li></ul>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹æŠ€æœ¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> lambda </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Redisé«˜é€¼æ ¼æŒ‡ä»¤</title>
      <link href="post/4134566530/"/>
      <url>post/4134566530/</url>
      
        <content type="html"><![CDATA[<h1 id="keys"><a href="#keys" class="headerlink" title="keys"></a>keys</h1><p>è¿‡åº¦ä½¿ç”¨<code>keys</code>è¿™ä¸ªå‘½ä»¤ï¼Œå°†ä¼šå¯¼è‡´å‡ºç°æ€§èƒ½æ¯›åˆºã€‚è¿™ä¸ªå‘½ä»¤çš„æ—¶é—´å¤æ‚åº¦æ˜¯O(N)ï¼Œè€Œä¸”redisåˆæ˜¯å•çº¿ç¨‹æ‰§è¡Œï¼Œåœ¨æ‰§è¡Œkeysæ—¶å³ä½¿æ˜¯æ—¶é—´å¤æ‚åº¦åªæœ‰O(1)ä¾‹å¦‚SETæˆ–è€…GETè¿™ç§ç®€å•å‘½ä»¤ä¹Ÿä¼šå µå¡ï¼Œä»è€Œå¯¼è‡´è¿™ä¸ªæ—¶é—´ç‚¹æ€§èƒ½æŠ–åŠ¨ï¼Œç”šè‡³å¯èƒ½å‡ºç°timeoutã€‚</p><blockquote><p><strong>å¼ºçƒˆå»ºè®®ç”Ÿäº§ç¯å¢ƒå±è”½keyså‘½ä»¤</strong></p></blockquote><h1 id="scan"><a href="#scan" class="headerlink" title="scan"></a>scan</h1><p>æ—¢ç„¶<code>keys</code>å‘½ä»¤ä¸æ¨èä½¿ç”¨ï¼Œé‚£å°±å°±ç”¨<code>scan</code>å‘½ä»¤ã€‚å¦‚æœæŠŠkeyså‘½ä»¤æ¯”ä½œç±»ä¼¼<code>select * from users where username like &#39;%afei%&#39;</code>è¿™ç§SQLï¼Œé‚£ä¹ˆscanåº”è¯¥æ˜¯<code>select * from users where id&gt;? limit 10</code>è¿™ç§å‘½ä»¤ã€‚</p><p>å®˜æ–¹æ–‡æ¡£ç”¨æ³•å¦‚ä¸‹ï¼š</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">SCAN cursor [MATCH pattern] [COUNT count]</span><br></pre></td></tr></table></figure><p>åˆå§‹æ‰§è¡Œscanå‘½ä»¤ä¾‹å¦‚<code>scan 0</code>ã€‚SCANå‘½ä»¤æ˜¯ä¸€ä¸ªåŸºäºæ¸¸æ ‡çš„è¿­ä»£å™¨ã€‚è¿™æ„å‘³ç€å‘½ä»¤æ¯æ¬¡è¢«è°ƒç”¨éƒ½éœ€è¦ä½¿ç”¨ä¸Šä¸€æ¬¡è¿™ä¸ªè°ƒç”¨è¿”å›çš„æ¸¸æ ‡ä½œä¸ºè¯¥æ¬¡è°ƒç”¨çš„æ¸¸æ ‡å‚æ•°ï¼Œä»¥æ­¤æ¥å»¶ç»­ä¹‹å‰çš„è¿­ä»£è¿‡ç¨‹ã€‚å½“SCANå‘½ä»¤çš„æ¸¸æ ‡å‚æ•°è¢«è®¾ç½®ä¸º0æ—¶ï¼ŒæœåŠ¡å™¨å°†å¼€å§‹ä¸€æ¬¡æ–°çš„è¿­ä»£ï¼Œè€Œ<strong>å½“redisæœåŠ¡å™¨å‘ç”¨æˆ·è¿”å›å€¼ä¸º0çš„æ¸¸æ ‡æ—¶ï¼Œè¡¨ç¤ºè¿­ä»£å·²ç»“æŸ</strong>ï¼Œè¿™æ˜¯å”¯ä¸€è¿­ä»£ç»“æŸçš„åˆ¤å®šæ–¹å¼ï¼Œè€Œä¸èƒ½é€šè¿‡è¿”å›ç»“æœé›†æ˜¯å¦ä¸ºç©ºåˆ¤æ–­è¿­ä»£ç»“æŸã€‚</p><p>ä½¿ç”¨æ–¹å¼ï¼š</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6380&gt; scan 0</span><br><span class="line">1) &quot;22&quot;</span><br><span class="line">2)  1) &quot;23&quot;</span><br><span class="line">    2) &quot;20&quot;</span><br><span class="line">    3) &quot;14&quot;</span><br><span class="line">    4) &quot;2&quot;</span><br><span class="line">    5) &quot;19&quot;</span><br><span class="line">    6) &quot;9&quot;</span><br><span class="line">    7) &quot;3&quot;</span><br><span class="line">    8) &quot;21&quot;</span><br><span class="line">    9) &quot;12&quot;</span><br><span class="line">   10) &quot;25&quot;</span><br><span class="line">   11) &quot;7&quot;</span><br></pre></td></tr></table></figure><p>è¿”å›ç»“æœåˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†ï¼šç¬¬ä¸€éƒ¨åˆ†å³1)å°±æ˜¯ä¸‹ä¸€æ¬¡è¿­ä»£æ¸¸æ ‡ï¼Œç¬¬äºŒéƒ¨åˆ†å³2)å°±æ˜¯æœ¬æ¬¡è¿­ä»£ç»“æœé›†ã€‚</p><h1 id="slowlog"><a href="#slowlog" class="headerlink" title="slowlog"></a>slowlog</h1><p>ä¸Šé¢æåˆ°ä¸èƒ½ä½¿ç”¨<code>keys</code>å‘½ä»¤ï¼Œå¦‚æœå°±æœ‰å¼€å‘è¿™ä¹ˆåšäº†å‘¢ï¼Œæˆ‘ä»¬å¦‚ä½•å¾—çŸ¥ï¼Ÿä¸å…¶ä»–ä»»æ„å­˜å‚¨ç³»ç»Ÿä¾‹å¦‚<code>mysql</code>ï¼Œ<code>mongodb</code>å¯ä»¥æŸ¥çœ‹æ…¢æ—¥å¿—ä¸€æ ·ï¼Œredisä¹Ÿå¯ä»¥ï¼Œå³é€šè¿‡å‘½ä»¤<code>slowlog</code>ã€‚ç”¨æ³•å¦‚ä¸‹ï¼š</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">SLOWLOG subcommand [argument]</span><br></pre></td></tr></table></figure><p>subcommandä¸»è¦æœ‰ï¼š</p><ul><li><strong>get</strong>ï¼Œç”¨æ³•ï¼š<code>slowlog get [argument]</code>ï¼Œè·å–<code>argument</code>å‚æ•°æŒ‡å®šæ•°é‡çš„æ…¢æ—¥å¿—ã€‚</li><li><strong>len</strong>ï¼Œç”¨æ³•ï¼š<code>slowlog len</code>ï¼Œæ€»æ…¢æ—¥å¿—æ•°é‡ã€‚</li><li><strong>reset</strong>ï¼Œç”¨æ³•ï¼š<code>slowlog reset</code>ï¼Œæ¸…ç©ºæ…¢æ—¥å¿—ã€‚</li></ul><p>æ‰§è¡Œç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6380&gt; slowlog get 5</span><br><span class="line">1) 1) (integer) 2</span><br><span class="line">   2) (integer) 1532656201</span><br><span class="line">   3) (integer) 2033</span><br><span class="line">   4) 1) &quot;flushddbb&quot;</span><br><span class="line">2) 1) (integer) 1  ----  æ…¢æ—¥å¿—ç¼–ç ï¼Œä¸€èˆ¬ä¸ç”¨care</span><br><span class="line">   2) (integer) 1532646897  ----  å¯¼è‡´æ…¢æ—¥å¿—çš„å‘½ä»¤æ‰§è¡Œçš„æ—¶é—´ç‚¹ï¼Œå¦‚æœapiæœ‰timeoutï¼Œå¯ä»¥é€šè¿‡å¯¹æ¯”è¿™ä¸ªæ—¶é—´ï¼Œåˆ¤æ–­å¯èƒ½æ˜¯æ…¢æ—¥å¿—å‘½ä»¤æ‰§è¡Œå¯¼è‡´çš„</span><br><span class="line">   3) (integer) 26424  ----  å¯¼è‡´æ…¢æ—¥å¿—æ‰§è¡Œçš„rediså‘½ä»¤ï¼Œé€šè¿‡4)å¯çŸ¥ï¼Œæ‰§è¡Œconfig rewriteå¯¼è‡´æ…¢æ—¥å¿—ï¼Œæ€»è€—æ—¶26ms+</span><br><span class="line">   4) 1) &quot;config&quot;</span><br><span class="line">      2) &quot;rewrite&quot;</span><br></pre></td></tr></table></figure><blockquote><p>å‘½ä»¤è€—æ—¶è¶…è¿‡å¤šå°‘æ‰ä¼šä¿å­˜åˆ°<code>slowlog</code>ä¸­ï¼Œå¯ä»¥é€šè¿‡å‘½ä»¤<code>config set slowlog-log-slower-than 2000</code>é…ç½®å¹¶ä¸”ä¸éœ€è¦é‡å¯<code>redis</code>ã€‚æ³¨æ„ï¼šå•ä½æ˜¯å¾®ç§’ï¼Œ2000å¾®ç§’å³2æ¯«ç§’ã€‚</p></blockquote><h1 id="rename-command"><a href="#rename-command" class="headerlink" title="rename-command"></a>rename-command</h1><p>ä¸ºäº†é˜²æ­¢æŠŠé—®é¢˜å¸¦åˆ°ç”Ÿäº§ç¯å¢ƒï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡é…ç½®æ–‡ä»¶é‡å‘½åä¸€äº›å±é™©å‘½ä»¤ï¼Œä¾‹å¦‚<code>keys</code>ç­‰ä¸€äº›é«˜å±å‘½ä»¤ã€‚æ“ä½œéå¸¸ç®€å•ï¼Œåªéœ€è¦åœ¨confé…ç½®æ–‡ä»¶å¢åŠ å¦‚ä¸‹æ‰€ç¤ºé…ç½®å³å¯ï¼š</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">rename-command flushdb flushddbb</span><br><span class="line">rename-command flushall flushallall</span><br><span class="line">rename-command keys keysys</span><br></pre></td></tr></table></figure><h1 id="bigkeys"><a href="#bigkeys" class="headerlink" title="bigkeys"></a>bigkeys</h1><p>éšç€é¡¹ç›®è¶Šåšè¶Šå¤§ï¼Œç¼“å­˜ä½¿ç”¨è¶Šæ¥è¶Šä¸è§„èŒƒã€‚æˆ‘ä»¬å¦‚ä½•æ£€æŸ¥ç”Ÿäº§ç¯å¢ƒä¸Šä¸€äº›æœ‰é—®é¢˜çš„æ•°æ®ã€‚<code>bigkeys</code>å°±æ´¾ä¸Šç”¨åœºäº†ï¼Œç”¨æ³•å¦‚ä¸‹ï¼š</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">redis-cli -p 6380 --bigkeys</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">... ...</span><br><span class="line">-------- summary -------</span><br><span class="line"></span><br><span class="line">Sampled 526 keys in the keyspace!</span><br><span class="line">Total key length in bytes is 1524 (avg len 2.90)</span><br><span class="line"></span><br><span class="line">Biggest string found &#x27;test&#x27; has 10005 bytes</span><br><span class="line">Biggest   list found &#x27;commentlist&#x27; has 13 items</span><br><span class="line"></span><br><span class="line">524 strings with 15181 bytes (99.62% of keys, avg size 28.97)</span><br><span class="line">2 lists with 19 items (00.38% of keys, avg size 9.50)</span><br><span class="line">0 sets with 0 members (00.00% of keys, avg size 0.00)</span><br><span class="line">0 hashs with 0 fields (00.00% of keys, avg size 0.00)</span><br><span class="line">0 zsets with 0 members (00.00% of keys, avg size 0.00)</span><br></pre></td></tr></table></figure><p>æœ€å5è¡Œå¯çŸ¥ï¼Œæ²¡æœ‰<code>set</code>,<code>hash</code>,<code>zset</code>å‡ ç§æ•°æ®ç»“æ„çš„æ•°æ®ã€‚<code>string</code>ç±»å‹æœ‰524ä¸ªï¼Œlistç±»å‹æœ‰ä¸¤ä¸ªï¼›é€šè¿‡<code>Biggest ... ...</code>å¯çŸ¥ï¼Œæœ€å¤§<code>string</code>ç»“æ„çš„keyæ˜¯<code>test</code>ï¼Œæœ€å¤§listç»“æ„çš„keyæ˜¯<code>commentlist</code>ã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™ä¸ª<strong>bigkeyså¾—åˆ°çš„æœ€å¤§ï¼Œä¸ä¸€å®šæ˜¯æœ€å¤§</strong>ã€‚è¯´æ˜åŸå› å‰ï¼Œé¦–å…ˆè¯´æ˜<code>bigkeys</code>çš„åŸç†ï¼Œéå¸¸ç®€å•ï¼Œé€šè¿‡scanå‘½ä»¤éå†ï¼Œå„ç§ä¸åŒæ•°æ®ç»“æ„çš„keyï¼Œåˆ†åˆ«é€šè¿‡ä¸åŒçš„å‘½ä»¤å¾—åˆ°æœ€å¤§çš„keyï¼š</p><ul><li>å¦‚æœæ˜¯stringç»“æ„ï¼Œé€šè¿‡<code>strlen</code>åˆ¤æ–­ï¼›</li><li>å¦‚æœæ˜¯listç»“æ„ï¼Œé€šè¿‡<code>llen</code>åˆ¤æ–­ï¼›</li><li>å¦‚æœæ˜¯hashç»“æ„ï¼Œé€šè¿‡<code>hlen</code>åˆ¤æ–­ï¼›</li><li>å¦‚æœæ˜¯setç»“æ„ï¼Œé€šè¿‡<code>scard</code>åˆ¤æ–­ï¼›</li><li>å¦‚æœæ˜¯sorted setç»“æ„ï¼Œé€šè¿‡<code>zcard</code>åˆ¤æ–­ã€‚</li></ul><blockquote><p>æ­£å› ä¸ºè¿™æ ·çš„åˆ¤æ–­æ–¹å¼ï¼Œè™½ç„¶stringç»“æ„è‚¯å®šå¯ä»¥æ­£ç¡®çš„ç­›é€‰å‡ºæœ€å ç”¨ç¼“å­˜ï¼Œä¹Ÿå¯ä»¥è¯´æœ€å¤§çš„<code>key</code>ã€‚ä½†æ˜¯<code>list</code>ä¸ä¸€å®šï¼Œä¾‹å¦‚ï¼Œç°åœ¨æœ‰ä¸¤ä¸ª<code>list</code>ç±»å‹çš„<code>key</code>ï¼Œåˆ†åˆ«æ˜¯ï¼š<code>numberlist--[0,1,2]</code>ï¼Œ<code>stringlist--[&quot;123456789123456789&quot;]</code>ï¼Œç”±äºé€šè¿‡<code>llen</code>åˆ¤æ–­ï¼Œæ‰€ä»¥<code>numberlist</code>è¦å¤§äº<code>stringlist</code>ã€‚è€Œäº‹å®ä¸Š<code>stringlist</code>æ›´å ç”¨å†…å­˜ã€‚å…¶ä»–ä¸‰ç§æ•°æ®ç»“æ„<code>hash</code>ï¼Œ<code>set</code>ï¼Œ<code>sorted setéƒ½ä¼šå­˜</code>åœ¨è¿™ä¸ªé—®é¢˜ã€‚ä½¿ç”¨<code>bigkeys</code>ä¸€å®šè¦æ³¨æ„è¿™ä¸€ç‚¹ã€‚</p></blockquote><h1 id="monitor"><a href="#monitor" class="headerlink" title="monitor"></a>monitor</h1><p>å‡è®¾ç”Ÿäº§ç¯å¢ƒæ²¡æœ‰å±è”½<code>keys</code>ç­‰ä¸€äº›é«˜å±å‘½ä»¤ï¼Œå¹¶ä¸”<code>slowlog</code>ä¸­è¿˜ä¸æ–­æœ‰æ–°çš„<code>keys</code>å¯¼è‡´æ…¢æ—¥å¿—ã€‚é‚£å¦‚ä½•æªå‡ºè¿™äº›å‘½ä»¤æ˜¯ç”±è°æ‰§è¡Œçš„å‘¢ï¼Ÿè¿™å°±æ˜¯<code>monitor</code>çš„ç”¨å¤„ï¼Œç”¨æ³•å¦‚ä¸‹ï¼š</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">redis-cli -p 6380 monitor</span><br></pre></td></tr></table></figure><p>å¦‚æœå½“å‰redisç¯å¢ƒOPSæ¯”è¾ƒé«˜ï¼Œé‚£ä¹ˆå»ºè®®ç»“åˆlinuxç®¡é“å‘½ä»¤ä¼˜åŒ–ï¼Œåªè¾“å‡ºkeyså‘½ä»¤çš„æ‰§è¡Œæƒ…å†µï¼š</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[afei@redis ~]# redis-cli -p 6380 monitor | grep keys </span><br><span class="line">1532645266.656525 [0 10.0.0.1:43544] &quot;keyss&quot; &quot;*&quot;</span><br><span class="line">1532645287.257657 [0 10.0.0.1:43544] &quot;keyss&quot; &quot;44*&quot;</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œç»“æœä¸­å¾ˆæ¸…æ¥šçš„çœ‹åˆ°keyså‘½åæ‰§è¡Œæ¥æºã€‚é€šè¿‡è¾“å‡ºçš„IPå’Œç«¯å£ä¿¡æ¯ï¼Œå°±èƒ½åœ¨ç›®æ ‡æœåŠ¡å™¨ä¸Šæ‰¾åˆ°æ‰§è¡Œè¿™æ¡å‘½ä»¤çš„è¿›ç¨‹ï¼Œæªå‡ºå…ƒå‡¶ï¼Œå‹’ä»¤æ•´æ”¹ã€‚</p><h1 id="info"><a href="#info" class="headerlink" title="info"></a>info</h1><p>å¦‚æœè¯´å“ªä¸ªå‘½ä»¤èƒ½æœ€å…¨é¢åæ˜ å½“å‰<code>redis</code>è¿è¡Œæƒ…å†µï¼Œé‚£ä¹ˆé<code>info</code>è«å±ã€‚ç”¨æ³•å¦‚ä¸‹ï¼š</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">INFO [section]</span><br></pre></td></tr></table></figure><p><code>section</code>å¯é€‰å€¼æœ‰ï¼š</p><ul><li><strong>Server</strong>ï¼šè¿è¡Œçš„rediså®ä¾‹ä¸€äº›ä¿¡æ¯ï¼ŒåŒ…æ‹¬ï¼šredisç‰ˆæœ¬ï¼Œæ“ä½œç³»ç»Ÿä¿¡æ¯ï¼Œç«¯å£ï¼ŒGCCç‰ˆæœ¬ï¼Œé…ç½®æ–‡ä»¶è·¯å¾„ç­‰ï¼›</li><li><strong>Clients</strong>ï¼šrediså®¢æˆ·ç«¯ä¿¡æ¯ï¼ŒåŒ…æ‹¬ï¼šå·²è¿æ¥å®¢æˆ·ç«¯æ•°é‡ï¼Œé˜»å¡å®¢æˆ·ç«¯æ•°é‡ç­‰ï¼›</li><li><strong>Memory</strong>ï¼šä½¿ç”¨å†…å­˜ï¼Œå³°å€¼å†…å­˜ï¼Œå†…å­˜ç¢ç‰‡ç‡ï¼Œå†…å­˜åˆ†é…æ–¹å¼ã€‚è¿™å‡ ä¸ªå‚æ•°éƒ½éå¸¸é‡è¦ï¼›</li><li><strong>Persistence</strong>ï¼šAOFå’ŒRDBæŒä¹…åŒ–ä¿¡æ¯ï¼›</li><li><strong>Stats</strong>ï¼šä¸€äº›ç»Ÿè®¡ä¿¡æ¯ï¼Œæœ€é‡è¦ä¸‰ä¸ªå‚æ•°ï¼šOPS(<code>instantaneous_ops_per_sec</code>)ï¼Œ<code>keyspace_hits</code>å’Œ<code>keyspace_misses</code>ä¸¤ä¸ªå‚æ•°ååº”ç¼“å­˜å‘½ä¸­ç‡ï¼›</li><li><strong>Replication</strong>ï¼šredisé›†ç¾¤ä¿¡æ¯ï¼›</li><li><strong>CPU</strong>ï¼šCPUç›¸å…³ä¿¡æ¯ï¼›</li><li><strong>Keyspace</strong>ï¼šredisä¸­å„ä¸ªDBé‡Œkeyçš„ä¿¡æ¯ï¼›</li></ul><h1 id="config"><a href="#config" class="headerlink" title="config"></a>config</h1><p>configæ˜¯ä¸€ä¸ªéå¸¸æœ‰ä»·å€¼çš„å‘½ä»¤ï¼Œä¸»è¦ä½“ç°åœ¨å¯¹redisçš„è¿ç»´ã€‚å› ä¸ºç”Ÿäº§ç¯å¢ƒä¸€èˆ¬æ˜¯ä¸å…è®¸éšæ„é‡å¯çš„ï¼Œä¸èƒ½å› ä¸ºéœ€è¦è°ƒä¼˜ä¸€äº›å‚æ•°å°±ä¿®æ”¹<code>conf</code>é…ç½®æ–‡ä»¶å¹¶é‡å¯ã€‚<code>redis</code>ä½œè€…æ—©å°±æƒ³åˆ°äº†è¿™ä¸€ç‚¹ï¼Œé€šè¿‡<code>config</code>å‘½ä»¤èƒ½çƒ­ä¿®æ”¹ä¸€äº›é…ç½®ï¼Œä¸éœ€è¦é‡å¯rediså®ä¾‹ï¼Œå¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤æŸ¥çœ‹å“ªäº›å‚æ•°å¯ä»¥çƒ­ä¿®æ”¹ï¼š</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">config get *</span><br></pre></td></tr></table></figure><p>çƒ­ä¿®æ”¹å°±æ¯”è¾ƒå®¹æ˜“äº†ï¼Œæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤å³å¯ï¼š</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">config set </span><br></pre></td></tr></table></figure><p>ä¾‹å¦‚ï¼š<code>config set slowlog-max-len 100</code>ï¼Œ<code>config set maxclients 1024</code></p><p>è¿™æ ·ä¿®æ”¹çš„è¯ï¼Œå¦‚æœä»¥åç”±äºæŸäº›åŸå› <code>redis</code>å®ä¾‹æ•…éšœéœ€è¦é‡å¯ï¼Œé‚£é€šè¿‡<code>config</code>çƒ­ä¿®æ”¹çš„å‚æ•°å°±ä¼šè¢«é…ç½®æ–‡ä»¶ä¸­çš„å‚æ•°è¦†ç›–ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦é€šè¿‡ä¸€ä¸ªå‘½ä»¤å°†<code>config</code>çƒ­ä¿®æ”¹çš„å‚æ•°åˆ·åˆ°<code>redis</code>é…ç½®æ–‡ä»¶ä¸­æŒä¹…åŒ–ï¼Œé€šè¿‡æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤å³å¯ï¼š</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">config rewrite</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œè¯¥å‘½ä»¤åï¼Œæˆ‘ä»¬èƒ½åœ¨<code>config</code>æ–‡ä»¶ä¸­çœ‹åˆ°ç±»ä¼¼è¿™ç§ä¿¡æ¯ï¼š</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> å¦‚æœconfä¸­æœ¬æ¥å°±æœ‰è¿™ä¸ªå‚æ•°ï¼Œé€šè¿‡æ‰§è¡Œconfig <span class="built_in">set</span>ï¼Œé‚£ä¹ˆredisç›´æ¥åŸåœ°ä¿®æ”¹é…ç½®æ–‡ä»¶</span></span><br><span class="line">maxclients 1024</span><br><span class="line"><span class="meta">#</span><span class="bash"> å¦‚æœconfä¸­æ²¡æœ‰è¿™ä¸ªå‚æ•°ï¼Œé€šè¿‡æ‰§è¡Œconfig <span class="built_in">set</span>ï¼Œé‚£ä¹ˆredisä¼šè¿½åŠ åœ¨Generated by CONFIG REWRITEå­—æ ·åé¢</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Generated by CONFIG REWRITE</span></span><br><span class="line">save 600 60</span><br><span class="line">slowlog-max-len 100</span><br></pre></td></tr></table></figure><h1 id="set"><a href="#set" class="headerlink" title="set"></a>set</h1><p>å®˜æ–¹æ–‡æ¡£ä»‹ç»çš„ç”¨æ³•å¦‚ä¸‹ï¼š</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">SET key value [EX seconds] [PX milliseconds] [NX|XX]</span><br></pre></td></tr></table></figure><p>ä½ å¯èƒ½ç”¨çš„æ¯”è¾ƒå¤šçš„å°±æ˜¯<code>set key value</code>ï¼Œæˆ–è€…<code>SETEX key seconds value</code>ï¼Œæ‰€ä»¥å¾ˆå¤šåŒå­¦ç”¨<code>redis</code>å®ç°åˆ†å¸ƒå¼é”åˆ†ä¸ºä¸¤æ­¥ï¼šé¦–å…ˆæ‰§è¡Œ<code>SETNX key value</code>ï¼Œç„¶åæ‰§è¡Œ<code>EXPIRE key seconds</code>ã€‚å¾ˆæ˜æ˜¾ï¼Œè¿™ç§å®ç°æœ‰å¾ˆä¸¥é‡çš„é—®é¢˜ï¼Œå› ä¸ºä¸¤æ­¥æ‰§è¡Œä¸å…·å¤‡åŸå­æ€§ï¼Œå¦‚æœæ‰§è¡Œç¬¬ä¸€ä¸ªå‘½ä»¤åå‡ºç°æŸäº›æœªçŸ¥å¼‚å¸¸å¯¼è‡´æ— æ³•æ‰§è¡Œ<code>EXPIRE key seconds</code>ï¼Œé‚£ä¹ˆåˆ†å¸ƒå¼é”å°±ä¼šä¸€ç›´æ— æ³•å¾—åˆ°é‡Šæ”¾ã€‚</p><p>é€šè¿‡<code>SET</code>å‘½ä»¤å®ç°åˆ†å¸ƒå¼é”çš„æ­£å¼å§¿åŠ¿åº”è¯¥æ˜¯<code>SET key value EX seconds NX</code>ï¼ˆEXå’ŒPXä»»é€‰ï¼Œå–å†³äºå¯¹è¿‡æœŸæ—¶é—´ç²¾åº¦è¦æ±‚ï¼‰ã€‚å¦å¤–ï¼Œvalueä¹Ÿæœ‰è¦æ±‚ï¼Œæœ€å¥½æ˜¯ä¸€ä¸ªç±»ä¼¼<code>UUID</code>è¿™ç§å…·å¤‡å”¯ä¸€æ€§çš„å­—ç¬¦ä¸²ã€‚å½“ç„¶å¦‚æœé—®ä½ <code>redis</code>æ˜¯å¦è¿˜æœ‰å…¶ä»–å®ç°åˆ†å¸ƒå¼é”çš„æ–¹æ¡ˆã€‚ä½ èƒ½è¯´å‡º<code>redlock</code>ï¼Œé‚£å¯¹æ–¹ä¸€å®šçœ¼å‰ä¸€äº®ï¼Œå¿ƒé‡Œå¯¹ä½ ç«–èµ·å¤§æ‹‡æŒ‡ï¼Œä½†å˜´ä¸Šä¸ä¼šè¯´ã€‚</p><h1 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h1><ul><li>é˜¿é£çš„åšå®¢ï¼Œå…¬ä¼—å·</li></ul>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®°æœ¬ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Redis </tag>
            
            <tag> æŒ‡ä»¤ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Redisé…ç½®è®¤è¯å¯†ç </title>
      <link href="post/3508477588/"/>
      <url>post/3508477588/</url>
      
        <content type="html"><![CDATA[<h2 id="æ–¹æ³•ä¸€ï¼Œä¿®æ”¹é…ç½®æ–‡ä»¶"><a href="#æ–¹æ³•ä¸€ï¼Œä¿®æ”¹é…ç½®æ–‡ä»¶" class="headerlink" title="æ–¹æ³•ä¸€ï¼Œä¿®æ”¹é…ç½®æ–‡ä»¶"></a>æ–¹æ³•ä¸€ï¼Œä¿®æ”¹é…ç½®æ–‡ä»¶</h2><h3 id="ä¿®æ”¹redis-conf"><a href="#ä¿®æ”¹redis-conf" class="headerlink" title="ä¿®æ”¹redis.conf"></a>ä¿®æ”¹redis.conf</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">vi redis.conf</span><br></pre></td></tr></table></figure><p>æ‰¾åˆ°ï¼š</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">requirepass myRedis</span><br></pre></td></tr></table></figure><p>å°†æ³¨é‡Šå»æ‰ï¼ŒæŠŠ<code>myRedis</code>æ¢æˆä½ çš„å¯†ç ã€‚</p><h3 id="é‡å¯redis"><a href="#é‡å¯redis" class="headerlink" title="é‡å¯redis"></a>é‡å¯redis</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo service redis restart</span><br><span class="line"><span class="meta">#</span><span class="bash"> æˆ–è€…</span></span><br><span class="line">sudo service redis stop</span><br><span class="line">sudo redis-server /etc/redis.conf</span><br></pre></td></tr></table></figure><h3 id="è¿™ä¸ªæ—¶å€™å°è¯•ç™»å½•redisï¼Œå‘ç°å¯ä»¥ç™»ä¸Šï¼Œä½†æ˜¯æ‰§è¡Œå…·ä½“å‘½ä»¤æ˜¯æç¤ºæ“ä½œä¸å…è®¸"><a href="#è¿™ä¸ªæ—¶å€™å°è¯•ç™»å½•redisï¼Œå‘ç°å¯ä»¥ç™»ä¸Šï¼Œä½†æ˜¯æ‰§è¡Œå…·ä½“å‘½ä»¤æ˜¯æç¤ºæ“ä½œä¸å…è®¸" class="headerlink" title="è¿™ä¸ªæ—¶å€™å°è¯•ç™»å½•redisï¼Œå‘ç°å¯ä»¥ç™»ä¸Šï¼Œä½†æ˜¯æ‰§è¡Œå…·ä½“å‘½ä»¤æ˜¯æç¤ºæ“ä½œä¸å…è®¸"></a>è¿™ä¸ªæ—¶å€™å°è¯•ç™»å½•redisï¼Œå‘ç°å¯ä»¥ç™»ä¸Šï¼Œä½†æ˜¯æ‰§è¡Œå…·ä½“å‘½ä»¤æ˜¯æç¤ºæ“ä½œä¸å…è®¸</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo redis-cli</span><br></pre></td></tr></table></figure><p><img src="https://github.com/cayzlh/git-img-repository/raw/master/blog/2018091302/1.png" alt="Redisé…ç½®è®¤è¯å¯†ç "></p><h3 id="å°è¯•ç”¨å¯†ç ç™»å½•å¹¶æ‰§è¡Œå…·ä½“çš„å‘½ä»¤çœ‹åˆ°å¯ä»¥æˆåŠŸæ‰§è¡Œ"><a href="#å°è¯•ç”¨å¯†ç ç™»å½•å¹¶æ‰§è¡Œå…·ä½“çš„å‘½ä»¤çœ‹åˆ°å¯ä»¥æˆåŠŸæ‰§è¡Œ" class="headerlink" title="å°è¯•ç”¨å¯†ç ç™»å½•å¹¶æ‰§è¡Œå…·ä½“çš„å‘½ä»¤çœ‹åˆ°å¯ä»¥æˆåŠŸæ‰§è¡Œ"></a>å°è¯•ç”¨å¯†ç ç™»å½•å¹¶æ‰§è¡Œå…·ä½“çš„å‘½ä»¤çœ‹åˆ°å¯ä»¥æˆåŠŸæ‰§è¡Œ</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo redis-cli -a yourpasswd</span><br></pre></td></tr></table></figure><p><img src="https://github.com/cayzlh/git-img-repository/raw/master/blog/2018091302/2.png" alt="Redisé…ç½®è®¤è¯å¯†ç "></p><h2 id="æ–¹æ³•äºŒï¼Œé€šè¿‡å‘½ä»¤è¡Œè¿›è¡Œé…ç½®"><a href="#æ–¹æ³•äºŒï¼Œé€šè¿‡å‘½ä»¤è¡Œè¿›è¡Œé…ç½®" class="headerlink" title="æ–¹æ³•äºŒï¼Œé€šè¿‡å‘½ä»¤è¡Œè¿›è¡Œé…ç½®"></a>æ–¹æ³•äºŒï¼Œé€šè¿‡å‘½ä»¤è¡Œè¿›è¡Œé…ç½®</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">redis 127.0.0.1:6379[1]&gt; config set requirepass my_redis</span><br><span class="line">OK</span><br><span class="line">redis 127.0.0.1:6379[1]&gt; config get requirepass</span><br><span class="line">1) &quot;requirepass&quot;</span><br><span class="line">2) &quot;my_redis&quot;</span><br></pre></td></tr></table></figure><p>æ— éœ€é‡å¯redis , ä½¿ç”¨ä¿®æ”¹åçš„å¯†ç ç™»å½•redisï¼Œå¯ä»¥æ‰§è¡Œç›¸åº”æ“ä½œ</p><blockquote><p>ç”¨è¿™ç§æ–¹æ³•ä¿®æ”¹å¯†ç ï¼Œé‡å¯redisåï¼Œç”¨æ–°é…ç½®çš„å¯†ç ç™»å½•redisæ‰§è¡Œæ“ä½œï¼Œå‘ç°æ–°çš„å¯†ç å¤±æ•ˆï¼Œredisé‡æ–°ä½¿ç”¨äº†é…ç½®æ–‡ä»¶ä¸­çš„å¯†ç ã€‚</p></blockquote><p><em>é™¤äº†åœ¨ç™»å½•æ—¶é€šè¿‡ -a å‚æ•°åˆ¶å®šå¯†ç å¤–ï¼Œè¿˜å¯ä»¥ç™»å½•æ—¶ä¸æŒ‡å®šå¯†ç ï¼Œè€Œåœ¨æ‰§è¡Œæ“ä½œå‰è¿›è¡Œè®¤è¯ã€‚</em></p><h2 id="masteré…ç½®äº†å¯†ç ï¼Œslaveå¦‚ä½•é…ç½®"><a href="#masteré…ç½®äº†å¯†ç ï¼Œslaveå¦‚ä½•é…ç½®" class="headerlink" title="masteré…ç½®äº†å¯†ç ï¼Œslaveå¦‚ä½•é…ç½®"></a>masteré…ç½®äº†å¯†ç ï¼Œslaveå¦‚ä½•é…ç½®</h2><p>è‹¥masteré…ç½®äº†å¯†ç åˆ™slaveä¹Ÿè¦é…ç½®ç›¸åº”çš„å¯†ç å‚æ•°å¦åˆ™æ— æ³•è¿›è¡Œæ­£å¸¸å¤åˆ¶çš„ã€‚ slaveä¸­é…ç½®æ–‡ä»¶å†…æ‰¾åˆ°å¦‚ä¸‹è¡Œï¼Œç§»é™¤æ³¨é‡Šï¼Œä¿®æ”¹å¯†ç å³å¯ã€‚</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">masterauth  mstpassword</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®°æœ¬ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> Redis </tag>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Javaé›†åˆæ¡†æ¶</title>
      <link href="post/158677550/"/>
      <url>post/158677550/</url>
      
        <content type="html"><![CDATA[<h2 id="é›†åˆæ¡†æ¶åº•å±‚æ•°æ®ç»“æ„æ€»ç»“"><a href="#é›†åˆæ¡†æ¶åº•å±‚æ•°æ®ç»“æ„æ€»ç»“" class="headerlink" title="é›†åˆæ¡†æ¶åº•å±‚æ•°æ®ç»“æ„æ€»ç»“"></a>é›†åˆæ¡†æ¶åº•å±‚æ•°æ®ç»“æ„æ€»ç»“</h2><h3 id="Collection"><a href="#Collection" class="headerlink" title="Collection"></a>Collection</h3><h4 id="List"><a href="#List" class="headerlink" title="List"></a>List</h4><ul><li><strong>Arraylistï¼š</strong> Objectæ•°ç»„</li><li><strong>Vectorï¼š</strong> Objectæ•°ç»„</li><li><strong>LinkedListï¼š</strong> åŒå‘å¾ªç¯é“¾è¡¨</li></ul><h4 id="Set"><a href="#Set" class="headerlink" title="Set"></a>Set</h4><ul><li><strong>HashSetï¼ˆæ— åºï¼Œå”¯ä¸€ï¼‰:</strong>  åŸºäº HashMap å®ç°çš„ï¼Œåº•å±‚é‡‡ç”¨ HashMap æ¥ä¿å­˜å…ƒç´ </li><li><strong>LinkedHashSetï¼š</strong> LinkedHashSet ç»§æ‰¿ä¸ HashSetï¼Œå¹¶ä¸”å…¶å†…éƒ¨æ˜¯é€šè¿‡ LinkedHashMap æ¥å®ç°çš„ã€‚æœ‰ç‚¹ç±»ä¼¼äºæˆ‘ä»¬ä¹‹å‰è¯´çš„LinkedHashMap å…¶å†…éƒ¨æ˜¯åŸºäº Hashmap å®ç°ä¸€æ ·ï¼Œä¸è¿‡è¿˜æ˜¯æœ‰ä¸€ç‚¹ç‚¹åŒºåˆ«çš„ã€‚</li><li><strong>TreeSetï¼ˆæœ‰åºï¼Œå”¯ä¸€ï¼‰ï¼š</strong> çº¢é»‘æ ‘(è‡ªå¹³è¡¡çš„æ’åºäºŒå‰æ ‘ã€‚)</li></ul><h4 id="Map"><a href="#Map" class="headerlink" title="Map"></a>Map</h4><ul><li><strong>HashMapï¼š</strong> JDK1.8ä¹‹å‰HashMapç”±æ•°ç»„+é“¾è¡¨ç»„æˆçš„ï¼Œæ•°ç»„æ˜¯HashMapçš„ä¸»ä½“ï¼Œé“¾è¡¨åˆ™æ˜¯ä¸»è¦ä¸ºäº†è§£å†³å“ˆå¸Œå†²çªè€Œå­˜åœ¨çš„ï¼ˆâ€œæ‹‰é“¾æ³•â€è§£å†³å†²çªï¼‰.JDK1.8ä»¥ååœ¨è§£å†³å“ˆå¸Œå†²çªæ—¶æœ‰äº†è¾ƒå¤§çš„å˜åŒ–ï¼Œå½“é“¾è¡¨é•¿åº¦å¤§äºé˜ˆå€¼ï¼ˆé»˜è®¤ä¸º8ï¼‰æ—¶ï¼Œå°†é“¾è¡¨è½¬åŒ–ä¸ºçº¢é»‘æ ‘ï¼Œä»¥å‡å°‘æœç´¢æ—¶é—´</li><li><strong>LinkedHashMap:</strong> LinkedHashMap ç»§æ‰¿è‡ª HashMapï¼Œæ‰€ä»¥å®ƒçš„åº•å±‚ä»ç„¶æ˜¯åŸºäºæ‹‰é“¾å¼æ•£åˆ—ç»“æ„å³ç”±æ•°ç»„å’Œé“¾è¡¨æˆ–çº¢é»‘æ ‘ç»„æˆã€‚å¦å¤–ï¼ŒLinkedHashMap åœ¨ä¸Šé¢ç»“æ„çš„åŸºç¡€ä¸Šï¼Œå¢åŠ äº†ä¸€æ¡åŒå‘é“¾è¡¨ï¼Œä½¿å¾—ä¸Šé¢çš„ç»“æ„å¯ä»¥ä¿æŒé”®å€¼å¯¹çš„æ’å…¥é¡ºåºã€‚åŒæ—¶é€šè¿‡å¯¹é“¾è¡¨è¿›è¡Œç›¸åº”çš„æ“ä½œï¼Œå®ç°äº†è®¿é—®é¡ºåºç›¸å…³é€»è¾‘ã€‚</li><li><strong>HashTable:</strong> æ•°ç»„+é“¾è¡¨ç»„æˆçš„ï¼Œæ•°ç»„æ˜¯ HashMap çš„ä¸»ä½“ï¼Œé“¾è¡¨åˆ™æ˜¯ä¸»è¦ä¸ºäº†è§£å†³å“ˆå¸Œå†²çªè€Œå­˜åœ¨çš„</li><li><strong>TreeMap:</strong> çº¢é»‘æ ‘ï¼ˆè‡ªå¹³è¡¡çš„æ’åºäºŒå‰æ ‘ï¼‰</li></ul><h4 id="é›†åˆæ¡†æ¶ä½“ç³»å¦‚å›¾"><a href="#é›†åˆæ¡†æ¶ä½“ç³»å¦‚å›¾" class="headerlink" title="é›†åˆæ¡†æ¶ä½“ç³»å¦‚å›¾"></a>é›†åˆæ¡†æ¶ä½“ç³»å¦‚å›¾</h4><p><img src="https://github.com/cayzlh/git-img-repository/raw/master/blog/2018090501/3.png" alt="åŒå‘é“¾è¡¨"></p><h2 id="é›†åˆæ¥å£"><a href="#é›†åˆæ¥å£" class="headerlink" title="é›†åˆæ¥å£"></a>é›†åˆæ¥å£</h2><blockquote><p>é›†åˆæ¡†æ¶å®šä¹‰äº†ä¸€äº›æ¥å£ã€‚æœ¬èŠ‚æä¾›äº†æ¯ä¸ªæ¥å£çš„æ¦‚è¿°ï¼š</p></blockquote><table><thead><tr><th>åºå·</th><th>æ¥å£æè¿°</th></tr></thead><tbody><tr><td>1</td><td>Collection æ¥å£ Collection æ˜¯æœ€åŸºæœ¬çš„é›†åˆæ¥å£ï¼Œä¸€ä¸ª Collection ä»£è¡¨ä¸€ç»„ Objectï¼Œ<br />å³ Collection çš„å…ƒç´ , Javaä¸æä¾›ç›´æ¥ç»§æ‰¿è‡ªCollectionçš„ç±»ï¼Œ<br />åªæä¾›ç»§æ‰¿äºçš„å­æ¥å£(å¦‚Listå’Œset)ã€‚Collection æ¥å£å­˜å‚¨ä¸€ç»„ä¸å”¯ä¸€ï¼Œæ— åºçš„å¯¹è±¡ã€‚</td></tr><tr><td>2</td><td>List æ¥å£ Listæ¥å£æ˜¯ä¸€ä¸ªæœ‰åºçš„ Collection<br />ä½¿ç”¨æ­¤æ¥å£èƒ½å¤Ÿç²¾ç¡®çš„æ§åˆ¶æ¯ä¸ªå…ƒç´ æ’å…¥çš„ä½ç½®ï¼Œ<br />èƒ½å¤Ÿé€šè¿‡ç´¢å¼•(å…ƒç´ åœ¨Listä¸­ä½ç½®ï¼Œç±»ä¼¼äºæ•°ç»„çš„ä¸‹æ ‡)æ¥è®¿é—®Listä¸­çš„å…ƒç´ ï¼Œ<br />ç¬¬ä¸€ä¸ªå…ƒç´ çš„ç´¢å¼•ä¸º 0ï¼Œè€Œä¸”å…è®¸æœ‰ç›¸åŒçš„å…ƒç´ ã€‚<br />List æ¥å£å­˜å‚¨ä¸€ç»„ä¸å”¯ä¸€ï¼Œæœ‰åºï¼ˆæ’å…¥é¡ºåºï¼‰çš„å¯¹è±¡ã€‚</td></tr><tr><td>3</td><td>Set Set å…·æœ‰ä¸ Collection å®Œå…¨ä¸€æ ·çš„æ¥å£ï¼Œ<br />åªæ˜¯è¡Œä¸ºä¸Šä¸åŒï¼ŒSet ä¸ä¿å­˜é‡å¤çš„å…ƒç´ ã€‚<br />Set æ¥å£å­˜å‚¨ä¸€ç»„å”¯ä¸€ï¼Œæ— åºçš„å¯¹è±¡ã€‚</td></tr><tr><td>4</td><td>SortedSet  ç»§æ‰¿äºSetä¿å­˜æœ‰åºçš„é›†åˆã€‚</td></tr><tr><td>5</td><td>Map Map æ¥å£å­˜å‚¨ä¸€ç»„é”®å€¼å¯¹è±¡ï¼Œæä¾›keyï¼ˆé”®ï¼‰åˆ°valueï¼ˆå€¼ï¼‰çš„æ˜ å°„ã€‚</td></tr><tr><td>6</td><td>Map.Entry  æè¿°åœ¨ä¸€ä¸ªMapä¸­çš„ä¸€ä¸ªå…ƒç´ ï¼ˆé”®/å€¼å¯¹ï¼‰ã€‚æ˜¯ä¸€ä¸ªMapçš„å†…éƒ¨ç±»ã€‚</td></tr><tr><td>7</td><td>SortedMap ç»§æ‰¿äº Mapï¼Œä½¿ Key ä¿æŒåœ¨å‡åºæ’åˆ—ã€‚</td></tr><tr><td>8</td><td>Enumeration è¿™æ˜¯ä¸€ä¸ªä¼ ç»Ÿçš„æ¥å£å’Œå®šä¹‰çš„æ–¹æ³•ï¼Œ<br />é€šè¿‡å®ƒå¯ä»¥æšä¸¾ï¼ˆä¸€æ¬¡è·å¾—ä¸€ä¸ªï¼‰å¯¹è±¡é›†åˆä¸­çš„å…ƒç´ ã€‚è¿™ä¸ªä¼ ç»Ÿæ¥å£å·²è¢«è¿­ä»£å™¨å–ä»£ã€‚</td></tr></tbody></table><h3 id="Setå’ŒListçš„åŒºåˆ«"><a href="#Setå’ŒListçš„åŒºåˆ«" class="headerlink" title="Setå’ŒListçš„åŒºåˆ«"></a>Setå’ŒListçš„åŒºåˆ«</h3><ul><li>Set æ¥å£å®ä¾‹å­˜å‚¨çš„æ˜¯æ— åºçš„ï¼Œä¸é‡å¤çš„æ•°æ®ã€‚List æ¥å£å®ä¾‹å­˜å‚¨çš„æ˜¯æœ‰åºçš„ï¼Œå¯ä»¥é‡å¤çš„å…ƒç´ ã€‚</li><li>Setæ£€ç´¢æ•ˆç‡ä½ä¸‹ï¼Œåˆ é™¤å’Œæ’å…¥æ•ˆç‡é«˜ï¼Œæ’å…¥å’Œåˆ é™¤ä¸ä¼šå¼•èµ·å…ƒç´ ä½ç½®æ”¹å˜ **&lt;å®ç°ç±»æœ‰HashSet,TreeSet&gt;**ã€‚</li><li>Listå’Œæ•°ç»„ç±»ä¼¼ï¼Œå¯ä»¥åŠ¨æ€å¢é•¿ï¼Œæ ¹æ®å®é™…å­˜å‚¨çš„æ•°æ®çš„é•¿åº¦è‡ªåŠ¨å¢é•¿Listçš„é•¿åº¦ã€‚æŸ¥æ‰¾å…ƒç´ æ•ˆç‡é«˜ï¼Œæ’å…¥åˆ é™¤æ•ˆç‡ä½ï¼Œå› ä¸ºä¼šå¼•èµ·å…¶ä»–å…ƒç´ ä½ç½®æ”¹å˜ <strong>&lt;å®ç°ç±»æœ‰ArrayList,LinkedList,Vector&gt;</strong> ã€‚</li></ul><h2 id="é›†åˆå®ç°ç±»ï¼ˆé›†åˆç±»ï¼‰"><a href="#é›†åˆå®ç°ç±»ï¼ˆé›†åˆç±»ï¼‰" class="headerlink" title="é›†åˆå®ç°ç±»ï¼ˆé›†åˆç±»ï¼‰"></a>é›†åˆå®ç°ç±»ï¼ˆé›†åˆç±»ï¼‰</h2><blockquote><p>Javaæä¾›äº†ä¸€å¥—å®ç°äº†Collectionæ¥å£çš„æ ‡å‡†é›†åˆç±»ã€‚å…¶ä¸­ä¸€äº›æ˜¯å…·ä½“ç±»ï¼Œè¿™äº›ç±»å¯ä»¥ç›´æ¥æ‹¿æ¥ä½¿ç”¨ï¼Œè€Œå¦å¤–ä¸€äº›æ˜¯æŠ½è±¡ç±»ï¼Œæä¾›äº†æ¥å£çš„éƒ¨åˆ†å®ç°ã€‚</p></blockquote><p>æ ‡å‡†é›†åˆç±»æ±‡æ€»äºä¸‹è¡¨ï¼š</p><table><thead><tr><th>åºå·</th><th>ç±»æè¿°</th></tr></thead><tbody><tr><td>1</td><td><strong>AbstractCollection</strong>  å®ç°äº†å¤§éƒ¨åˆ†çš„é›†åˆæ¥å£ã€‚</td></tr><tr><td>2</td><td><strong>AbstractList</strong>  ç»§æ‰¿äºAbstractCollection å¹¶ä¸”å®ç°äº†å¤§éƒ¨åˆ†Listæ¥å£ã€‚</td></tr><tr><td>3</td><td><strong>AbstractSequentialList</strong>  ç»§æ‰¿äº AbstractList ï¼Œ<br />æä¾›äº†å¯¹æ•°æ®å…ƒç´ çš„é“¾å¼è®¿é—®è€Œä¸æ˜¯éšæœºè®¿é—®ã€‚</td></tr><tr><td>4</td><td>LinkedList è¯¥ç±»å®ç°äº†Listæ¥å£ï¼Œå…è®¸æœ‰nullï¼ˆç©ºï¼‰å…ƒç´ ã€‚<br />ä¸»è¦ç”¨äºåˆ›å»ºé“¾è¡¨æ•°æ®ç»“æ„ï¼Œè¯¥ç±»æ²¡æœ‰åŒæ­¥æ–¹æ³•ï¼Œå¦‚æœå¤šä¸ªçº¿ç¨‹åŒæ—¶è®¿é—®ä¸€ä¸ªListï¼Œ<br />åˆ™å¿…é¡»è‡ªå·±å®ç°è®¿é—®åŒæ­¥ï¼Œè§£å†³æ–¹æ³•å°±æ˜¯åœ¨åˆ›å»ºListæ—¶å€™æ„é€ ä¸€ä¸ªåŒæ­¥çš„Listã€‚<br />ä¾‹å¦‚ï¼š<br /><code>Listlist=Collections.synchronizedList(newLinkedList(...));</code><br />LinkedList æŸ¥æ‰¾æ•ˆç‡ä½ã€‚</td></tr><tr><td>5</td><td>ArrayList è¯¥ç±»ä¹Ÿæ˜¯å®ç°äº†Listçš„æ¥å£.<br />å®ç°äº†å¯å˜å¤§å°çš„æ•°ç»„ï¼Œéšæœºè®¿é—®å’Œéå†å…ƒç´ æ—¶ï¼Œæä¾›æ›´å¥½çš„æ€§èƒ½ã€‚<br />è¯¥ç±»ä¹Ÿæ˜¯éåŒæ­¥çš„,åœ¨å¤šçº¿ç¨‹çš„æƒ…å†µä¸‹ä¸è¦ä½¿ç”¨ã€‚ArrayList å¢é•¿å½“å‰é•¿åº¦çš„50%ï¼Œæ’å…¥åˆ é™¤æ•ˆç‡ä½ã€‚</td></tr><tr><td>6</td><td><strong>AbstractSet</strong>  ç»§æ‰¿äºAbstractCollection å¹¶ä¸”å®ç°äº†å¤§éƒ¨åˆ†Setæ¥å£ã€‚</td></tr><tr><td>7</td><td>HashSet è¯¥ç±»å®ç°äº†Setæ¥å£ï¼Œä¸å…è®¸å‡ºç°é‡å¤å…ƒç´ ï¼Œ<br />ä¸ä¿è¯é›†åˆä¸­å…ƒç´ çš„é¡ºåºï¼Œå…è®¸åŒ…å«å€¼ä¸ºnullçš„å…ƒç´ ï¼Œä½†æœ€å¤šåªèƒ½ä¸€ä¸ªã€‚</td></tr><tr><td>8</td><td>LinkedHashSet å…·æœ‰å¯é¢„çŸ¥è¿­ä»£é¡ºåºçš„ <code>Set</code> æ¥å£çš„å“ˆå¸Œè¡¨å’Œé“¾æ¥åˆ—è¡¨å®ç°ã€‚</td></tr><tr><td>9</td><td>TreeSet è¯¥ç±»å®ç°äº†Setæ¥å£ï¼Œå¯ä»¥å®ç°æ’åºç­‰åŠŸèƒ½ã€‚</td></tr><tr><td>10</td><td><strong>AbstractMap</strong>  å®ç°äº†å¤§éƒ¨åˆ†çš„Mapæ¥å£ã€‚</td></tr><tr><td>11</td><td>HashMap  HashMap æ˜¯ä¸€ä¸ªæ•£åˆ—è¡¨ï¼Œå®ƒå­˜å‚¨çš„å†…å®¹æ˜¯é”®å€¼å¯¹(key-value)æ˜ å°„ã€‚<br /> è¯¥ç±»å®ç°äº†Mapæ¥å£ï¼Œæ ¹æ®é”®çš„HashCodeå€¼å­˜å‚¨æ•°æ®ï¼Œ<br />å…·æœ‰å¾ˆå¿«çš„è®¿é—®é€Ÿåº¦ï¼Œæœ€å¤šå…è®¸ä¸€æ¡è®°å½•çš„é”®ä¸ºnullï¼Œä¸æ”¯æŒçº¿ç¨‹åŒæ­¥ã€‚</td></tr><tr><td>12</td><td>TreeMap  ç»§æ‰¿äº†AbstractMapï¼Œå¹¶ä¸”ä½¿ç”¨ä¸€é¢—æ ‘ã€‚</td></tr><tr><td>13</td><td>WeakHashMap  ç»§æ‰¿AbstractMapç±»ï¼Œä½¿ç”¨å¼±å¯†é’¥çš„å“ˆå¸Œè¡¨ã€‚</td></tr><tr><td>14</td><td>LinkedHashMap  ç»§æ‰¿äºHashMapï¼Œä½¿ç”¨å…ƒç´ çš„è‡ªç„¶é¡ºåºå¯¹å…ƒç´ è¿›è¡Œæ’åº.</td></tr><tr><td>15</td><td>IdentityHashMap  ç»§æ‰¿AbstractMapç±»ï¼Œæ¯”è¾ƒæ–‡æ¡£æ—¶ä½¿ç”¨å¼•ç”¨ç›¸ç­‰ã€‚</td></tr></tbody></table><p>é€šè¿‡java.utilåŒ…ä¸­å®šä¹‰çš„ç±»ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><table><thead><tr><th>åºå·</th><th>ç±»æè¿°</th></tr></thead><tbody><tr><td>1</td><td>Vector  è¯¥ç±»å’ŒArrayListéå¸¸ç›¸ä¼¼ï¼Œä½†æ˜¯è¯¥ç±»æ˜¯åŒæ­¥çš„ï¼Œ<br />å¯ä»¥ç”¨åœ¨å¤šçº¿ç¨‹çš„æƒ…å†µï¼Œè¯¥ç±»å…è®¸è®¾ç½®é»˜è®¤çš„å¢é•¿é•¿åº¦ï¼Œé»˜è®¤æ‰©å®¹æ–¹å¼ä¸ºåŸæ¥çš„2å€ã€‚</td></tr><tr><td>2</td><td>Stack  æ ˆæ˜¯Vectorçš„ä¸€ä¸ªå­ç±»ï¼Œå®ƒå®ç°äº†ä¸€ä¸ªæ ‡å‡†çš„åè¿›å…ˆå‡ºçš„æ ˆã€‚</td></tr><tr><td>3</td><td>Dictionary  Dictionary ç±»æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œç”¨æ¥å­˜å‚¨é”®/å€¼å¯¹ï¼Œä½œç”¨å’ŒMapç±»ç›¸ä¼¼ã€‚</td></tr><tr><td>4</td><td>Hashtable  Hashtable æ˜¯ Dictionary(å­—å…¸) ç±»çš„å­ç±»ï¼Œä½äº java.util åŒ…ä¸­ã€‚</td></tr><tr><td>5</td><td>Properties  Properties ç»§æ‰¿äº Hashtableï¼Œè¡¨ç¤ºä¸€ä¸ªæŒä¹…çš„å±æ€§é›†ï¼Œ<br />å±æ€§åˆ—è¡¨ä¸­æ¯ä¸ªé”®åŠå…¶å¯¹åº”å€¼éƒ½æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ã€‚</td></tr><tr><td>6</td><td>BitSet ä¸€ä¸ªBitsetç±»åˆ›å»ºä¸€ç§ç‰¹æ®Šç±»å‹çš„æ•°ç»„æ¥ä¿å­˜ä½å€¼ã€‚BitSetä¸­æ•°ç»„å¤§å°ä¼šéšéœ€è¦å¢åŠ ã€‚</td></tr></tbody></table><h2 id="é›†åˆç®—æ³•"><a href="#é›†åˆç®—æ³•" class="headerlink" title="é›†åˆç®—æ³•"></a>é›†åˆç®—æ³•</h2><p>é›†åˆæ¡†æ¶å®šä¹‰äº†å‡ ç§ç®—æ³•ï¼Œå¯ç”¨äºé›†åˆå’Œæ˜ å°„ã€‚è¿™äº›ç®—æ³•è¢«å®šä¹‰ä¸ºé›†åˆç±»çš„é™æ€æ–¹æ³•ã€‚</p><p>åœ¨å°è¯•æ¯”è¾ƒä¸å…¼å®¹çš„ç±»å‹æ—¶ï¼Œä¸€äº›æ–¹æ³•èƒ½å¤ŸæŠ›å‡º ClassCastExceptionå¼‚å¸¸ã€‚å½“è¯•å›¾ä¿®æ”¹ä¸€ä¸ªä¸å¯ä¿®æ”¹çš„é›†åˆæ—¶ï¼ŒæŠ›å‡ºUnsupportedOperationExceptionå¼‚å¸¸ã€‚</p><p>é›†åˆå®šä¹‰ä¸‰ä¸ªé™æ€çš„å˜é‡ï¼šEMPTY_SETï¼ŒEMPTY_LISTï¼ŒEMPTY_MAPçš„ã€‚è¿™äº›å˜é‡éƒ½ä¸å¯æ”¹å˜ã€‚</p><table><thead><tr><th>åºå·</th><th>ç®—æ³•æè¿°</th></tr></thead><tbody><tr><td>1</td><td>Collection Algorithms è¿™é‡Œæ˜¯ä¸€ä¸ªåˆ—è¡¨ä¸­çš„æ‰€æœ‰ç®—æ³•å®ç°ã€‚</td></tr></tbody></table><h3 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h3><blockquote><p>Javaé›†åˆæ¡†æ¶ä¸ºç¨‹åºå‘˜æä¾›äº†é¢„å…ˆåŒ…è£…çš„æ•°æ®ç»“æ„å’Œç®—æ³•æ¥æ“çºµä»–ä»¬ã€‚</p><p>é›†åˆæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå¯å®¹çº³å…¶ä»–å¯¹è±¡çš„å¼•ç”¨ã€‚é›†åˆæ¥å£å£°æ˜å¯¹æ¯ä¸€ç§ç±»å‹çš„é›†åˆå¯ä»¥æ‰§è¡Œçš„æ“ä½œã€‚</p><p>é›†åˆæ¡†æ¶çš„ç±»å’Œæ¥å£å‡åœ¨java.utilåŒ…ä¸­ã€‚</p><p>ä»»ä½•å¯¹è±¡åŠ å…¥é›†åˆç±»åï¼Œè‡ªåŠ¨è½¬å˜ä¸ºObjectç±»å‹ï¼Œæ‰€ä»¥åœ¨å–å‡ºçš„æ—¶å€™ï¼Œéœ€è¦è¿›è¡Œå¼ºåˆ¶ç±»å‹è½¬æ¢ã€‚</p></blockquote><h2 id="Arraylist-ä¸-LinkedList-å¼‚åŒ"><a href="#Arraylist-ä¸-LinkedList-å¼‚åŒ" class="headerlink" title="Arraylist ä¸ LinkedList å¼‚åŒ"></a>Arraylist ä¸ LinkedList å¼‚åŒ</h2><p> <strong>1. æ˜¯å¦ä¿è¯çº¿ç¨‹å®‰å…¨ï¼š</strong> ArrayList å’Œ LinkedList éƒ½æ˜¯ä¸åŒæ­¥çš„ï¼Œä¹Ÿå°±æ˜¯ä¸ä¿è¯çº¿ç¨‹å®‰å…¨ï¼›</p><p><strong>2. åº•å±‚æ•°æ®ç»“æ„ï¼š</strong> Arraylist åº•å±‚ä½¿ç”¨çš„æ˜¯Objectæ•°ç»„ï¼›LinkedList åº•å±‚ä½¿ç”¨çš„æ˜¯åŒå‘å¾ªç¯é“¾è¡¨æ•°æ®ç»“æ„ï¼›</p><p><strong>3. æ’å…¥å’Œåˆ é™¤æ˜¯å¦å—å…ƒç´ ä½ç½®çš„å½±å“ï¼š</strong> â‘  <strong>ArrayList é‡‡ç”¨æ•°ç»„å­˜å‚¨ï¼Œæ‰€ä»¥æ’å…¥å’Œåˆ é™¤å…ƒç´ çš„æ—¶é—´å¤æ‚åº¦å—å…ƒç´ ä½ç½®çš„å½±å“ã€‚</strong> æ¯”å¦‚ï¼šæ‰§è¡Œ<code>add(E e)</code>æ–¹æ³•çš„æ—¶å€™ï¼Œ ArrayList ä¼šé»˜è®¤åœ¨å°†æŒ‡å®šçš„å…ƒç´ è¿½åŠ åˆ°æ­¤åˆ—è¡¨çš„æœ«å°¾ï¼Œè¿™ç§æƒ…å†µæ—¶é—´å¤æ‚åº¦å°±æ˜¯O(1)ã€‚ä½†æ˜¯å¦‚æœè¦åœ¨æŒ‡å®šä½ç½® i æ’å…¥å’Œåˆ é™¤å…ƒç´ çš„è¯ï¼ˆ<code>add(int index, E element)</code>ï¼‰æ—¶é—´å¤æ‚åº¦å°±ä¸º O(n-i)ã€‚å› ä¸ºåœ¨è¿›è¡Œä¸Šè¿°æ“ä½œçš„æ—¶å€™é›†åˆä¸­ç¬¬ i å’Œç¬¬ i ä¸ªå…ƒç´ ä¹‹åçš„(n-i)ä¸ªå…ƒç´ éƒ½è¦æ‰§è¡Œå‘åä½/å‘å‰ç§»ä¸€ä½çš„æ“ä½œã€‚ â‘¡ <strong>LinkedList é‡‡ç”¨é“¾è¡¨å­˜å‚¨ï¼Œæ‰€ä»¥æ’å…¥ï¼Œåˆ é™¤å…ƒç´ æ—¶é—´å¤æ‚åº¦ä¸å—å…ƒç´ ä½ç½®çš„å½±å“ï¼Œéƒ½æ˜¯è¿‘ä¼¼ Oï¼ˆ1ï¼‰è€Œæ•°ç»„ä¸ºè¿‘ä¼¼ Oï¼ˆnï¼‰ã€‚</strong></p><p><strong>4. æ˜¯å¦æ”¯æŒå¿«é€Ÿéšæœºè®¿é—®ï¼š</strong> LinkedList ä¸æ”¯æŒé«˜æ•ˆçš„éšæœºå…ƒç´ è®¿é—®ï¼Œè€ŒArrayList å®ç°äº†RandmoAccess æ¥å£ï¼Œæ‰€ä»¥æœ‰éšæœºè®¿é—®åŠŸèƒ½ã€‚å¿«é€Ÿéšæœºè®¿é—®å°±æ˜¯é€šè¿‡å…ƒç´ çš„åºå·å¿«é€Ÿè·å–å…ƒç´ å¯¹è±¡(å¯¹åº”äº<code>get(int index)</code>æ–¹æ³•)ã€‚</p><p><strong>5. å†…å­˜ç©ºé—´å ç”¨ï¼š</strong> ArrayListçš„ç©º é—´æµªè´¹ä¸»è¦ä½“ç°åœ¨åœ¨liståˆ—è¡¨çš„ç»“å°¾ä¼šé¢„ç•™ä¸€å®šçš„å®¹é‡ç©ºé—´ï¼Œè€ŒLinkedListçš„ç©ºé—´èŠ±è´¹åˆ™ä½“ç°åœ¨å®ƒçš„æ¯ä¸€ä¸ªå…ƒç´ éƒ½éœ€è¦æ¶ˆè€—æ¯”ArrayListæ›´å¤šçš„ç©ºé—´ï¼ˆå› ä¸ºè¦å­˜æ”¾ç›´æ¥åç»§å’Œç›´æ¥å‰é©±ä»¥åŠæ•°æ®ï¼‰ã€‚</p><blockquote><p><strong>æ•°æ®ç»“æ„åŸºç¡€ä¹‹åŒå‘é“¾è¡¨</strong>: </p><p>åŒå‘é“¾è¡¨ä¹Ÿå«åŒé“¾è¡¨ï¼Œæ˜¯é“¾è¡¨çš„ä¸€ç§ï¼Œå®ƒçš„æ¯ä¸ªæ•°æ®ç»“ç‚¹ä¸­éƒ½æœ‰ä¸¤ä¸ªæŒ‡é’ˆï¼Œåˆ†åˆ«æŒ‡å‘ç›´æ¥åç»§å’Œç›´æ¥å‰é©±ã€‚æ‰€ä»¥ï¼Œä»åŒå‘é“¾è¡¨ä¸­çš„ä»»æ„ä¸€ä¸ªç»“ç‚¹å¼€å§‹ï¼Œéƒ½å¯ä»¥å¾ˆæ–¹ä¾¿åœ°è®¿é—®å®ƒçš„å‰é©±ç»“ç‚¹å’Œåç»§ç»“ç‚¹ã€‚ä¸€èˆ¬æˆ‘ä»¬éƒ½æ„é€ åŒå‘å¾ªç¯é“¾è¡¨ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼ŒåŒæ—¶ä¸‹å›¾ä¹Ÿæ˜¯LinkedList åº•å±‚ä½¿ç”¨çš„æ˜¯åŒå‘å¾ªç¯é“¾è¡¨æ•°æ®ç»“æ„ã€‚</p><p><img src="https://github.com/cayzlh/git-img-repository/raw/master/blog/2018090501/1.png" alt="åŒå‘é“¾è¡¨"></p></blockquote><h2 id="ArrayList-ä¸-Vector-åŒºåˆ«"><a href="#ArrayList-ä¸-Vector-åŒºåˆ«" class="headerlink" title="ArrayList ä¸ Vector åŒºåˆ«"></a>ArrayList ä¸ Vector åŒºåˆ«</h2><p>Vectorç±»çš„æ‰€æœ‰æ–¹æ³•éƒ½æ˜¯åŒæ­¥çš„ã€‚å¯ä»¥ç”±ä¸¤ä¸ªçº¿ç¨‹å®‰å…¨åœ°è®¿é—®ä¸€ä¸ªVectorå¯¹è±¡ã€ä½†æ˜¯ä¸€ä¸ªçº¿ç¨‹è®¿é—®Vectorçš„è¯ä»£ç è¦åœ¨åŒæ­¥æ“ä½œä¸Šè€—è´¹å¤§é‡çš„æ—¶é—´ã€‚</p><p>Arraylistä¸æ˜¯åŒæ­¥çš„ï¼Œæ‰€ä»¥åœ¨ä¸éœ€è¦ä¿è¯çº¿ç¨‹å®‰å…¨æ—¶æ—¶å»ºè®®ä½¿ç”¨Arraylistã€‚</p><h2 id="HashMap-å’Œ-Hashtable-çš„åŒºåˆ«"><a href="#HashMap-å’Œ-Hashtable-çš„åŒºåˆ«" class="headerlink" title="HashMap å’Œ Hashtable çš„åŒºåˆ«"></a>HashMap å’Œ Hashtable çš„åŒºåˆ«</h2><ol><li><strong>çº¿ç¨‹æ˜¯å¦å®‰å…¨ï¼š</strong> HashMap æ˜¯éçº¿ç¨‹å®‰å…¨çš„ï¼ŒHashTable æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼›HashTable å†…éƒ¨çš„æ–¹æ³•åŸºæœ¬éƒ½ç»è¿‡  <code>synchronized</code>  ä¿®é¥°ã€‚ï¼ˆå¦‚æœä½ è¦ä¿è¯çº¿ç¨‹å®‰å…¨çš„è¯å°±ä½¿ç”¨ ConcurrentHashMap å§ï¼ï¼‰ï¼›</li><li><strong>æ•ˆç‡ï¼š</strong> å› ä¸ºçº¿ç¨‹å®‰å…¨çš„é—®é¢˜ï¼ŒHashMap è¦æ¯” HashTable æ•ˆç‡é«˜ä¸€ç‚¹ã€‚å¦å¤–ï¼ŒHashTable åŸºæœ¬è¢«æ·˜æ±°ï¼Œä¸è¦åœ¨ä»£ç ä¸­ä½¿ç”¨å®ƒï¼›</li><li><strong>å¯¹Null key å’ŒNull valueçš„æ”¯æŒï¼š</strong> HashMap ä¸­ï¼Œnull å¯ä»¥ä½œä¸ºé”®ï¼Œè¿™æ ·çš„é”®åªæœ‰ä¸€ä¸ªï¼Œå¯ä»¥æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªé”®æ‰€å¯¹åº”çš„å€¼ä¸º nullã€‚ã€‚ä½†æ˜¯åœ¨ HashTable ä¸­ put è¿›çš„é”®å€¼åªè¦æœ‰ä¸€ä¸ª nullï¼Œç›´æ¥æŠ›å‡º NullPointerExceptionã€‚</li><li><strong>åˆå§‹å®¹é‡å¤§å°å’Œæ¯æ¬¡æ‰©å……å®¹é‡å¤§å°çš„ä¸åŒ ï¼š</strong>   â‘ åˆ›å»ºæ—¶å¦‚æœä¸æŒ‡å®šå®¹é‡åˆå§‹å€¼ï¼ŒHashtable é»˜è®¤çš„åˆå§‹å¤§å°ä¸º11ï¼Œä¹‹åæ¯æ¬¡æ‰©å……ï¼Œå®¹é‡å˜ä¸ºåŸæ¥çš„2n+1ã€‚HashMap é»˜è®¤çš„åˆå§‹åŒ–å¤§å°ä¸º16ã€‚ä¹‹åæ¯æ¬¡æ‰©å……ï¼Œå®¹é‡å˜ä¸ºåŸæ¥çš„2å€ã€‚â‘¡åˆ›å»ºæ—¶å¦‚æœç»™å®šäº†å®¹é‡åˆå§‹å€¼ï¼Œé‚£ä¹ˆ Hashtable ä¼šç›´æ¥ä½¿ç”¨ä½ ç»™å®šçš„å¤§å°ï¼Œè€Œ HashMap ä¼šå°†å…¶æ‰©å……ä¸º2çš„å¹‚æ¬¡æ–¹å¤§å°ã€‚ä¹Ÿå°±æ˜¯è¯´ HashMap æ€»æ˜¯ä½¿ç”¨2çš„å¹‚ä½œä¸ºå“ˆå¸Œè¡¨çš„å¤§å°,åé¢ä¼šä»‹ç»åˆ°ä¸ºä»€ä¹ˆæ˜¯2çš„å¹‚æ¬¡æ–¹ã€‚</li><li><strong>åº•å±‚æ•°æ®ç»“æ„ï¼š</strong> JDK1.8 ä»¥åçš„ HashMap åœ¨è§£å†³å“ˆå¸Œå†²çªæ—¶æœ‰äº†è¾ƒå¤§çš„å˜åŒ–ï¼Œå½“é“¾è¡¨é•¿åº¦å¤§äºé˜ˆå€¼ï¼ˆé»˜è®¤ä¸º8ï¼‰æ—¶ï¼Œå°†é“¾è¡¨è½¬åŒ–ä¸ºçº¢é»‘æ ‘ï¼Œä»¥å‡å°‘æœç´¢æ—¶é—´ã€‚Hashtable æ²¡æœ‰è¿™æ ·çš„æœºåˆ¶ã€‚</li></ol><h2 id="HashSet-å’Œ-HashMap-åŒºåˆ«"><a href="#HashSet-å’Œ-HashMap-åŒºåˆ«" class="headerlink" title="HashSet å’Œ HashMap åŒºåˆ«"></a>HashSet å’Œ HashMap åŒºåˆ«</h2><p><img src="https://github.com/cayzlh/git-img-repository/raw/master/blog/2018090501/2.png" alt="HashSet å’Œ HashMap åŒºåˆ«"></p><h2 id="ConcurrentHashMap-å’Œ-Hashtable-çš„åŒºåˆ«"><a href="#ConcurrentHashMap-å’Œ-Hashtable-çš„åŒºåˆ«" class="headerlink" title="ConcurrentHashMap å’Œ Hashtable çš„åŒºåˆ«"></a>ConcurrentHashMap å’Œ Hashtable çš„åŒºåˆ«</h2><p>ConcurrentHashMap å’Œ Hashtable çš„åŒºåˆ«ä¸»è¦ä½“ç°åœ¨å®ç°çº¿ç¨‹å®‰å…¨çš„æ–¹å¼ä¸Šä¸åŒã€‚</p><ul><li><strong>åº•å±‚æ•°æ®ç»“æ„ï¼š</strong> JDK1.7çš„ ConcurrentHashMap åº•å±‚é‡‡ç”¨ <strong>åˆ†æ®µçš„æ•°ç»„+é“¾è¡¨</strong> å®ç°ï¼ŒJDK1.8 é‡‡ç”¨çš„æ•°æ®ç»“æ„è·ŸHashMap1.8çš„ç»“æ„ä¸€æ ·ï¼Œæ•°ç»„+é“¾è¡¨/çº¢é»‘äºŒå‰æ ‘ã€‚Hashtable å’Œ JDK1.8 ä¹‹å‰çš„ HashMap çš„åº•å±‚æ•°æ®ç»“æ„ç±»ä¼¼éƒ½æ˜¯é‡‡ç”¨ <strong>æ•°ç»„+é“¾è¡¨</strong> çš„å½¢å¼ï¼Œæ•°ç»„æ˜¯ HashMap çš„ä¸»ä½“ï¼Œé“¾è¡¨åˆ™æ˜¯ä¸»è¦ä¸ºäº†è§£å†³å“ˆå¸Œå†²çªè€Œå­˜åœ¨çš„ï¼›</li><li><strong>å®ç°çº¿ç¨‹å®‰å…¨çš„æ–¹å¼ï¼ˆé‡è¦ï¼‰ï¼š</strong> â‘  <strong>åœ¨JDK1.7çš„æ—¶å€™ï¼ŒConcurrentHashMapï¼ˆåˆ†æ®µé”ï¼‰</strong> å¯¹æ•´ä¸ªæ¡¶æ•°ç»„è¿›è¡Œäº†åˆ†å‰²åˆ†æ®µ(Segment)ï¼Œæ¯ä¸€æŠŠé”åªé”å®¹å™¨å…¶ä¸­ä¸€éƒ¨åˆ†æ•°æ®ï¼Œå¤šçº¿ç¨‹è®¿é—®å®¹å™¨é‡Œä¸åŒæ•°æ®æ®µçš„æ•°æ®ï¼Œå°±ä¸ä¼šå­˜åœ¨é”ç«äº‰ï¼Œæé«˜å¹¶å‘è®¿é—®ç‡ã€‚ï¼ˆé»˜è®¤åˆ†é…16ä¸ªSegmentï¼Œæ¯”Hashtableæ•ˆç‡æé«˜16å€ã€‚ï¼‰ <strong>åˆ°äº† JDK1.8 çš„æ—¶å€™å·²ç»æ‘’å¼ƒäº†Segmentçš„æ¦‚å¿µï¼Œè€Œæ˜¯ç›´æ¥ç”¨ Node æ•°ç»„+é“¾è¡¨+çº¢é»‘æ ‘çš„æ•°æ®ç»“æ„æ¥å®ç°ï¼Œå¹¶å‘æ§åˆ¶ä½¿ç”¨ synchronized å’Œ CAS æ¥æ“ä½œã€‚ï¼ˆJDK1.6ä»¥å å¯¹ synchronizedé”åšäº†å¾ˆå¤šä¼˜åŒ–ï¼‰</strong>  æ•´ä¸ªçœ‹èµ·æ¥å°±åƒæ˜¯ä¼˜åŒ–è¿‡ä¸”çº¿ç¨‹å®‰å…¨çš„ HashMapï¼Œè™½ç„¶åœ¨JDK1.8ä¸­è¿˜èƒ½çœ‹åˆ° Segment çš„æ•°æ®ç»“æ„ï¼Œä½†æ˜¯å·²ç»ç®€åŒ–äº†å±æ€§ï¼Œåªæ˜¯ä¸ºäº†å…¼å®¹æ—§ç‰ˆæœ¬ï¼›â‘¡ <strong>Hashtable(åŒä¸€æŠŠé”)</strong> :ä½¿ç”¨ synchronized æ¥ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œæ•ˆç‡éå¸¸ä½ä¸‹ã€‚å½“ä¸€ä¸ªçº¿ç¨‹è®¿é—®åŒæ­¥æ–¹æ³•æ—¶ï¼Œå…¶ä»–çº¿ç¨‹ä¹Ÿè®¿é—®åŒæ­¥æ–¹æ³•ï¼Œå¯èƒ½ä¼šè¿›å…¥é˜»å¡æˆ–è½®è¯¢çŠ¶æ€ï¼Œå¦‚ä½¿ç”¨ put æ·»åŠ å…ƒç´ ï¼Œå¦ä¸€ä¸ªçº¿ç¨‹ä¸èƒ½ä½¿ç”¨ put æ·»åŠ å…ƒç´ ï¼Œä¹Ÿä¸èƒ½ä½¿ç”¨ getï¼Œç«äº‰ä¼šè¶Šæ¥è¶Šæ¿€çƒˆæ•ˆç‡è¶Šä½ã€‚</li></ul><h2 id="å‚è€ƒæ–‡çŒ®"><a href="#å‚è€ƒæ–‡çŒ®" class="headerlink" title="å‚è€ƒæ–‡çŒ®"></a>å‚è€ƒæ–‡çŒ®</h2><ul><li><p><a href="https://juejin.im/post/5b7e955be51d4538de11550c">https://juejin.im/post/5b7e955be51d4538de11550c</a> </p></li><li><p><a href="http://www.runoob.com/java/java-tutorial.html">èœé¸Ÿæ•™ç¨‹</a></p></li></ul>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹æŠ€æœ¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> é›†åˆæ¡†æ¶ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>RedisåŸºç¡€çŸ¥è¯†æ€»ç»“</title>
      <link href="post/3447421152/"/>
      <url>post/3447421152/</url>
      
        <content type="html"><![CDATA[<h3 id="ä»€ä¹ˆæ˜¯redis"><a href="#ä»€ä¹ˆæ˜¯redis" class="headerlink" title="ä»€ä¹ˆæ˜¯redis?"></a>ä»€ä¹ˆæ˜¯redis?</h3><p>Redis æ˜¯ä¸€ä¸ªåŸºäºå†…å­˜çš„é«˜æ€§èƒ½key-valueæ•°æ®åº“ã€‚ </p><h3 id="Reidsçš„ç‰¹ç‚¹"><a href="#Reidsçš„ç‰¹ç‚¹" class="headerlink" title="Reidsçš„ç‰¹ç‚¹"></a>Reidsçš„ç‰¹ç‚¹</h3><p><code>Redis</code>æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ª<code>Key-Value</code>ç±»å‹çš„å†…å­˜æ•°æ®åº“ï¼Œå¾ˆåƒ<code>memcached</code>ï¼Œæ•´ä¸ªæ•°æ®åº“ç»Ÿç»ŸåŠ è½½åœ¨å†…å­˜å½“ä¸­è¿›è¡Œæ“ä½œï¼Œå®šæœŸé€šè¿‡å¼‚æ­¥æ“ä½œæŠŠæ•°æ®åº“æ•°æ®flushåˆ°ç¡¬ç›˜ä¸Šè¿›è¡Œä¿å­˜ã€‚</p><p>å› ä¸ºæ˜¯çº¯å†…å­˜æ“ä½œï¼Œ<code>Redis</code>çš„æ€§èƒ½éå¸¸å‡ºè‰²ï¼Œæ¯ç§’å¯ä»¥å¤„ç†è¶…è¿‡ 10ä¸‡æ¬¡è¯»å†™æ“ä½œï¼Œæ˜¯å·²çŸ¥æ€§èƒ½æœ€å¿«çš„<code>Key-Value DB</code>ã€‚</p><p>Redisçš„å‡ºè‰²ä¹‹å¤„ä¸ä»…ä»…æ˜¯æ€§èƒ½ï¼ŒRedisæœ€å¤§çš„é­…åŠ›æ˜¯æ”¯æŒä¿å­˜å¤šç§æ•°æ®ç»“æ„ï¼Œæ­¤å¤–å•ä¸ªvalueçš„æœ€å¤§é™åˆ¶æ˜¯1GBï¼Œä¸åƒ memcachedåªèƒ½ä¿å­˜1MBçš„æ•°æ®ï¼Œå› æ­¤Rediså¯ä»¥ç”¨æ¥å®ç°å¾ˆå¤šæœ‰ç”¨çš„åŠŸèƒ½ã€‚</p><p>æ¯”æ–¹è¯´ç”¨ä»–çš„Listæ¥åšFIFOåŒå‘é“¾è¡¨ï¼Œå®ç°ä¸€ä¸ªè½»é‡çº§çš„é«˜æ€§ èƒ½æ¶ˆæ¯é˜Ÿåˆ—æœåŠ¡ï¼Œç”¨ä»–çš„Setå¯ä»¥åšé«˜æ€§èƒ½çš„tagç³»ç»Ÿç­‰ç­‰ã€‚å¦å¤–Redisä¹Ÿå¯ä»¥å¯¹å­˜å…¥çš„Key-Valueè®¾ç½®expireæ—¶é—´ï¼Œå› æ­¤ä¹Ÿå¯ä»¥è¢«å½“ä½œä¸€ ä¸ªåŠŸèƒ½åŠ å¼ºç‰ˆçš„memcachedæ¥ç”¨ã€‚</p><p>Redisçš„ä¸»è¦ç¼ºç‚¹æ˜¯æ•°æ®åº“å®¹é‡å—åˆ°ç‰©ç†å†…å­˜çš„é™åˆ¶ï¼Œä¸èƒ½ç”¨ä½œæµ·é‡æ•°æ®çš„é«˜æ€§èƒ½è¯»å†™ï¼Œå› æ­¤Redisé€‚åˆçš„åœºæ™¯ä¸»è¦å±€é™åœ¨è¾ƒå°æ•°æ®é‡çš„é«˜æ€§èƒ½æ“ä½œå’Œè¿ç®—ä¸Šã€‚</p><h3 id="ä½¿ç”¨redisæœ‰å“ªäº›å¥½å¤„"><a href="#ä½¿ç”¨redisæœ‰å“ªäº›å¥½å¤„" class="headerlink" title="ä½¿ç”¨redisæœ‰å“ªäº›å¥½å¤„"></a>ä½¿ç”¨redisæœ‰å“ªäº›å¥½å¤„</h3><ol><li>é€Ÿåº¦å¿«ï¼Œå› ä¸ºæ•°æ®å­˜åœ¨å†…å­˜ä¸­ï¼Œç±»ä¼¼äºHashMapï¼ŒHashMapçš„ä¼˜åŠ¿å°±æ˜¯æŸ¥æ‰¾å’Œæ“ä½œçš„æ—¶é—´å¤æ‚åº¦éƒ½æ˜¯O(1) </li><li>æ”¯æŒä¸°å¯Œæ•°æ®ç±»å‹ï¼Œæ”¯æŒstringï¼Œlistï¼Œsetï¼Œsorted setï¼Œhash </li><li>æ”¯æŒäº‹åŠ¡ï¼Œæ“ä½œéƒ½æ˜¯åŸå­æ€§ï¼Œæ‰€è°“çš„åŸå­æ€§å°±æ˜¯å¯¹æ•°æ®çš„æ›´æ”¹è¦ä¹ˆå…¨éƒ¨æ‰§è¡Œï¼Œè¦ä¹ˆå…¨éƒ¨ä¸æ‰§è¡Œ </li><li>ä¸°å¯Œçš„ç‰¹æ€§ï¼šå¯ç”¨äºç¼“å­˜ï¼Œæ¶ˆæ¯ï¼ŒæŒ‰keyè®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œè¿‡æœŸåå°†ä¼šè‡ªåŠ¨åˆ é™¤</li></ol><h3 id="redis-æ”¯æŒå“ªäº›æ•°æ®ç»“æ„"><a href="#redis-æ”¯æŒå“ªäº›æ•°æ®ç»“æ„" class="headerlink" title="redis æ”¯æŒå“ªäº›æ•°æ®ç»“æ„"></a>redis æ”¯æŒå“ªäº›æ•°æ®ç»“æ„</h3><p>æ”¯æŒå¤šç§ç±»å‹çš„æ•°æ®ç»“æ„ï¼Œå¦‚å­—ç¬¦ä¸²ï¼ˆStringï¼‰ï¼Œæ•£åˆ—ï¼ˆHashï¼‰ï¼Œåˆ—è¡¨ï¼ˆListï¼‰ï¼Œé›†åˆï¼ˆSetï¼‰ï¼Œæœ‰åºé›†åˆï¼ˆSorted Setæˆ–è€…æ˜¯ZSetï¼‰ä¸èŒƒå›´æŸ¥è¯¢ï¼ŒBitmapsï¼ŒHyperloglogs å’Œåœ°ç†ç©ºé—´ï¼ˆGeospatialï¼‰ç´¢å¼•åŠå¾„æŸ¥è¯¢ã€‚å…¶ä¸­å¸¸è§çš„æ•°æ®ç»“æ„ç±»å‹æœ‰ï¼šStringã€Listã€Setã€Hashã€ZSetè¿™5ç§ã€‚</p><h4 id="Javaä¸­å¯¹Redisæ•°æ®ç±»å‹çš„æ“ä½œ"><a href="#Javaä¸­å¯¹Redisæ•°æ®ç±»å‹çš„æ“ä½œ" class="headerlink" title="Javaä¸­å¯¹Redisæ•°æ®ç±»å‹çš„æ“ä½œ"></a>Javaä¸­å¯¹Redisæ•°æ®ç±»å‹çš„æ“ä½œ</h4><h5 id="String"><a href="#String" class="headerlink" title="String"></a>String</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StringTest</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span>  Jedis jedis = JedisPoolUtil.getJedis();</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="comment">//æ·»åŠ å’Œè·å–</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">fun</span><span class="params">()</span></span>&#123;</span><br><span class="line">        jedis.set(<span class="string">&quot;num&quot;</span>,<span class="string">&quot;1&quot;</span>);</span><br><span class="line">        System.out.println(jedis.get(<span class="string">&quot;num&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="comment">//åˆ é™¤å€¼</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">fun1</span><span class="params">()</span></span>&#123;</span><br><span class="line">        jedis.del(<span class="string">&quot;num&quot;</span>);</span><br><span class="line">        System.out.println(jedis.get(<span class="string">&quot;num&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="comment">//è‡ªå‡å’Œè‡ªå‡</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">fun2</span><span class="params">()</span></span>&#123;</span><br><span class="line">        jedis.set(<span class="string">&quot;num&quot;</span>,<span class="string">&quot;1&quot;</span>);</span><br><span class="line">        System.out.println(jedis.get(<span class="string">&quot;num&quot;</span>));</span><br><span class="line">        jedis.decr(<span class="string">&quot;num&quot;</span>);</span><br><span class="line">        System.out.println(jedis.get(<span class="string">&quot;num&quot;</span>));</span><br><span class="line">        jedis.incr(<span class="string">&quot;num&quot;</span>);</span><br><span class="line">        jedis.incr(<span class="string">&quot;num&quot;</span>);</span><br><span class="line">        System.out.println(jedis.get(<span class="string">&quot;num&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="comment">//åŠ ä¸Š/å‡å» ä¸€ä¸ªæ•°</span></span><br><span class="line">    <span class="comment">//incrBy è¿”å›çš„æ˜¯ä¿®æ”¹ä¹‹åçš„å€¼å¦‚æœåŸå€¼æ˜¯å­—ç¬¦ä¸²ä¸æ˜¯æ•°å­—ï¼Œåˆ™ä¼šæŠ›å‡ºå¼‚å¸¸</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">fun3</span><span class="params">()</span></span>&#123;</span><br><span class="line">        Long num = jedis.incrBy(<span class="string">&quot;num&quot;</span>, <span class="number">3</span>);</span><br><span class="line">        System.out.println(num);</span><br><span class="line">        jedis.decrBy(<span class="string">&quot;num&quot;</span>,<span class="number">10</span>);</span><br><span class="line"></span><br><span class="line">        System.out.println(jedis.get(<span class="string">&quot;num&quot;</span>));</span><br><span class="line">        jedis.set(<span class="string">&quot;name&quot;</span>,<span class="string">&quot;caopengfei&quot;</span>);</span><br><span class="line">        <span class="comment">//jedis.decrBy(&quot;name&quot;,1);</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="comment">//å­—ç¬¦ä¸²æ‹¼æ¥</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">fun4</span><span class="params">()</span></span>&#123;</span><br><span class="line">        Long len = jedis.append(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;123&quot;</span>);</span><br><span class="line">        System.out.println(len);</span><br><span class="line">        System.out.println(jedis.get(<span class="string">&quot;name&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="Hash"><a href="#Hash" class="headerlink" title="Hash"></a>Hash</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HashTest</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> Jedis jedis = JedisPoolUtil.getJedis();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//    hash æ“ä½œçš„æ˜¯mapå¯¹è±¡</span></span><br><span class="line"><span class="comment">//    é€‚åˆå­˜å‚¨é”®å€¼å¯¹è±¡çš„ä¿¡æ¯</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="comment">//å­˜å€¼ å‚æ•°ç¬¬ä¸€ä¸ªå˜é‡çš„åç§°ï¼Œ mapé”®å(key)ï¼Œ mapé”®å€¼(value)</span></span><br><span class="line"><span class="comment">//    è°ƒç”¨hset</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">fun</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Long num = jedis.hset(<span class="string">&quot;hash1&quot;</span>, <span class="string">&quot;username&quot;</span>, <span class="string">&quot;caopengfei&quot;</span>);</span><br><span class="line">        System.out.println(num);</span><br><span class="line">        String hget = jedis.hget(<span class="string">&quot;hash1&quot;</span>, <span class="string">&quot;username&quot;</span>);</span><br><span class="line">        System.out.println(hget);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="comment">//ä¹Ÿå¯ä»¥å­˜å¤šä¸ªkey</span></span><br><span class="line"><span class="comment">//    è°ƒç”¨hmset</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">fun1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Map&lt;String, String&gt; map = <span class="keyword">new</span> HashMap&lt;String, String&gt;();</span><br><span class="line">        map.put(<span class="string">&quot;username&quot;</span>, <span class="string">&quot;caopengfei&quot;</span>);</span><br><span class="line">        map.put(<span class="string">&quot;age&quot;</span>, <span class="string">&quot;25&quot;</span>);</span><br><span class="line">        map.put(<span class="string">&quot;sex&quot;</span>, <span class="string">&quot;ç”·&quot;</span>);</span><br><span class="line">        String res = jedis.hmset(<span class="string">&quot;hash2&quot;</span>, map);</span><br><span class="line">        System.out.println(res);<span class="comment">//ok</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="comment">//è·å–hashä¸­æ‰€æœ‰çš„å€¼</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">fun2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Map&lt;String, String&gt; map2 = <span class="keyword">new</span> HashMap&lt;String, String&gt;();</span><br><span class="line">        map2 = jedis.hgetAll(<span class="string">&quot;hash2&quot;</span>);</span><br><span class="line">        System.out.println(map2);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line"><span class="comment">//    åˆ é™¤hashä¸­çš„é”® å¯ä»¥åˆ é™¤ä¸€ä¸ªä¹Ÿå¯ä»¥åˆ é™¤å¤šä¸ªï¼Œè¿”å›çš„æ˜¯åˆ é™¤çš„ä¸ªæ•°</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">fun3</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Long num = jedis.hdel(<span class="string">&quot;hash2&quot;</span>, <span class="string">&quot;username&quot;</span>, <span class="string">&quot;age&quot;</span>);</span><br><span class="line">        System.out.println(num);</span><br><span class="line">        Map&lt;String, String&gt; map2 = <span class="keyword">new</span> HashMap&lt;String, String&gt;();</span><br><span class="line">        map2 = jedis.hgetAll(<span class="string">&quot;hash2&quot;</span>);</span><br><span class="line">        System.out.println(map2);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="comment">//å¢åŠ hashä¸­çš„é”®å€¼å¯¹</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">fun4</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Map&lt;String, String&gt; map2 = <span class="keyword">new</span> HashMap&lt;String, String&gt;();</span><br><span class="line">        map2 = jedis.hgetAll(<span class="string">&quot;hash2&quot;</span>);</span><br><span class="line">        System.out.println(map2);</span><br><span class="line">        jedis.hincrBy(<span class="string">&quot;hash2&quot;</span>, <span class="string">&quot;age&quot;</span>, <span class="number">10</span>);</span><br><span class="line">        map2 = jedis.hgetAll(<span class="string">&quot;hash2&quot;</span>);</span><br><span class="line">        System.out.println(map2);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="comment">//åˆ¤æ–­hashæ˜¯å¦å­˜åœ¨æŸä¸ªå€¼</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">fun5</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(jedis.hexists(<span class="string">&quot;hash2&quot;</span>, <span class="string">&quot;username&quot;</span>));</span><br><span class="line">        System.out.println(jedis.hexists(<span class="string">&quot;hash2&quot;</span>, <span class="string">&quot;age&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="comment">//è·å–hashä¸­é”®å€¼å¯¹çš„ä¸ªæ•°</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">fun6</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(jedis.hlen(<span class="string">&quot;hash2&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//    è·å–ä¸€ä¸ªhashä¸­æ‰€æœ‰çš„keyå€¼</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">fun7</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Set&lt;String&gt; hash2 = jedis.hkeys(<span class="string">&quot;hash2&quot;</span>);</span><br><span class="line">        System.out.println(hash2);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//    è·å–æ‰€æœ‰çš„valueå€¼</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">fun8</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        List&lt;String&gt; hash2 = jedis.hvals(<span class="string">&quot;hash2&quot;</span>);</span><br><span class="line">        System.out.println(hash2);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="Listæ“ä½œ"><a href="#Listæ“ä½œ" class="headerlink" title="Listæ“ä½œ"></a>Listæ“ä½œ</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testList</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    jedis.flushDB();</span><br><span class="line">    System.out.println(<span class="string">&quot;===========æ·»åŠ ä¸€ä¸ªlist===========&quot;</span>);</span><br><span class="line">    jedis.lpush(<span class="string">&quot;collections&quot;</span>, <span class="string">&quot;ArrayList&quot;</span>, <span class="string">&quot;Vector&quot;</span>, <span class="string">&quot;Stack&quot;</span>, <span class="string">&quot;HashMap&quot;</span>, <span class="string">&quot;WeakHashMap&quot;</span>, <span class="string">&quot;LinkedHashMap&quot;</span>);</span><br><span class="line">    jedis.lpush(<span class="string">&quot;collections&quot;</span>, <span class="string">&quot;HashSet&quot;</span>);</span><br><span class="line">    jedis.lpush(<span class="string">&quot;collections&quot;</span>, <span class="string">&quot;TreeSet&quot;</span>);</span><br><span class="line">    jedis.lpush(<span class="string">&quot;collections&quot;</span>, <span class="string">&quot;TreeMap&quot;</span>);</span><br><span class="line">    System.out.println(<span class="string">&quot;collectionsçš„å†…å®¹ï¼š&quot;</span>+jedis.lrange(<span class="string">&quot;collections&quot;</span>, <span class="number">0</span>, -<span class="number">1</span>));<span class="comment">//-1ä»£è¡¨å€’æ•°ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œ-2ä»£è¡¨å€’æ•°ç¬¬äºŒä¸ªå…ƒç´ </span></span><br><span class="line">    System.out.println(<span class="string">&quot;collectionsåŒºé—´0-3çš„å…ƒç´ ï¼š&quot;</span>+jedis.lrange(<span class="string">&quot;collections&quot;</span>,<span class="number">0</span>,<span class="number">3</span>));</span><br><span class="line">    System.out.println(<span class="string">&quot;===============================&quot;</span>);</span><br><span class="line">    <span class="comment">// åˆ é™¤åˆ—è¡¨æŒ‡å®šçš„å€¼ ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸ºåˆ é™¤çš„ä¸ªæ•°ï¼ˆæœ‰é‡å¤æ—¶ï¼‰ï¼Œåaddè¿›å»çš„å€¼å…ˆè¢«åˆ ï¼Œç±»ä¼¼äºå‡ºæ ˆ</span></span><br><span class="line">    System.out.println(<span class="string">&quot;åˆ é™¤æŒ‡å®šå…ƒç´ ä¸ªæ•°ï¼š&quot;</span>+jedis.lrem(<span class="string">&quot;collections&quot;</span>, <span class="number">2</span>, <span class="string">&quot;HashMap&quot;</span>));</span><br><span class="line">    System.out.println(<span class="string">&quot;collectionsçš„å†…å®¹ï¼š&quot;</span>+jedis.lrange(<span class="string">&quot;collections&quot;</span>, <span class="number">0</span>, -<span class="number">1</span>));</span><br><span class="line">    System.out.println(<span class="string">&quot;åˆ é™¤ä¸‹è¡¨0-3åŒºé—´ä¹‹å¤–çš„å…ƒç´ ï¼š&quot;</span>+jedis.ltrim(<span class="string">&quot;collections&quot;</span>, <span class="number">0</span>, <span class="number">3</span>));</span><br><span class="line">    System.out.println(<span class="string">&quot;collectionsçš„å†…å®¹ï¼š&quot;</span>+jedis.lrange(<span class="string">&quot;collections&quot;</span>, <span class="number">0</span>, -<span class="number">1</span>));</span><br><span class="line">    System.out.println(<span class="string">&quot;collectionsåˆ—è¡¨å‡ºæ ˆï¼ˆå·¦ç«¯ï¼‰ï¼š&quot;</span>+jedis.lpop(<span class="string">&quot;collections&quot;</span>));</span><br><span class="line">    System.out.println(<span class="string">&quot;collectionsçš„å†…å®¹ï¼š&quot;</span>+jedis.lrange(<span class="string">&quot;collections&quot;</span>, <span class="number">0</span>, -<span class="number">1</span>));</span><br><span class="line">    System.out.println(<span class="string">&quot;collectionsæ·»åŠ å…ƒç´ ï¼Œä»åˆ—è¡¨å³ç«¯ï¼Œä¸lpushç›¸å¯¹åº”ï¼š&quot;</span>+jedis.rpush(<span class="string">&quot;collections&quot;</span>, <span class="string">&quot;EnumMap&quot;</span>));</span><br><span class="line">    System.out.println(<span class="string">&quot;collectionsçš„å†…å®¹ï¼š&quot;</span>+jedis.lrange(<span class="string">&quot;collections&quot;</span>, <span class="number">0</span>, -<span class="number">1</span>));</span><br><span class="line">    System.out.println(<span class="string">&quot;collectionsåˆ—è¡¨å‡ºæ ˆï¼ˆå³ç«¯ï¼‰ï¼š&quot;</span>+jedis.rpop(<span class="string">&quot;collections&quot;</span>));</span><br><span class="line">    System.out.println(<span class="string">&quot;collectionsçš„å†…å®¹ï¼š&quot;</span>+jedis.lrange(<span class="string">&quot;collections&quot;</span>, <span class="number">0</span>, -<span class="number">1</span>));</span><br><span class="line">    System.out.println(<span class="string">&quot;ä¿®æ”¹collectionsæŒ‡å®šä¸‹æ ‡1çš„å†…å®¹ï¼š&quot;</span>+jedis.lset(<span class="string">&quot;collections&quot;</span>, <span class="number">1</span>, <span class="string">&quot;LinkedArrayList&quot;</span>));</span><br><span class="line">    System.out.println(<span class="string">&quot;collectionsçš„å†…å®¹ï¼š&quot;</span>+jedis.lrange(<span class="string">&quot;collections&quot;</span>, <span class="number">0</span>, -<span class="number">1</span>));</span><br><span class="line">    System.out.println(<span class="string">&quot;===============================&quot;</span>);</span><br><span class="line">    System.out.println(<span class="string">&quot;collectionsçš„é•¿åº¦ï¼š&quot;</span>+jedis.llen(<span class="string">&quot;collections&quot;</span>));</span><br><span class="line">    System.out.println(<span class="string">&quot;è·å–collectionsä¸‹æ ‡ä¸º2çš„å…ƒç´ ï¼š&quot;</span>+jedis.lindex(<span class="string">&quot;collections&quot;</span>, <span class="number">2</span>));</span><br><span class="line">    System.out.println(<span class="string">&quot;===============================&quot;</span>);</span><br><span class="line">    jedis.lpush(<span class="string">&quot;sortedList&quot;</span>, <span class="string">&quot;3&quot;</span>,<span class="string">&quot;6&quot;</span>,<span class="string">&quot;2&quot;</span>,<span class="string">&quot;0&quot;</span>,<span class="string">&quot;7&quot;</span>,<span class="string">&quot;4&quot;</span>);</span><br><span class="line">    System.out.println(<span class="string">&quot;sortedListæ’åºå‰ï¼š&quot;</span>+jedis.lrange(<span class="string">&quot;sortedList&quot;</span>, <span class="number">0</span>, -<span class="number">1</span>));</span><br><span class="line">    System.out.println(jedis.sort(<span class="string">&quot;sortedList&quot;</span>));</span><br><span class="line">    System.out.println(<span class="string">&quot;sortedListæ’åºåï¼š&quot;</span>+jedis.lrange(<span class="string">&quot;sortedList&quot;</span>, <span class="number">0</span>, -<span class="number">1</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="Setæ“ä½œ"><a href="#Setæ“ä½œ" class="headerlink" title="Setæ“ä½œ"></a>Setæ“ä½œ</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* Seté›†åˆï¼Œå’ŒListç±»çš„åŒºåˆ«å°±æ˜¯</span></span><br><span class="line"><span class="comment">* setä¸­ä¸ä¼šå‡ºç°é‡å¤çš„æ•°æ®</span></span><br><span class="line"><span class="comment">* ä»–å¯ä»¥è¿›è¡Œèšåˆæ“ä½œæ•ˆç‡æ¯”è¾ƒé«˜</span></span><br><span class="line"><span class="comment">* å…¶ä½™çš„æ“ä½œåŸºæœ¬ä¸Šå’Œlistç›¸åŒ</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">* */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SetTest</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span>  Jedis jedis = JedisPoolUtil.getJedis();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="comment">/*æ·»åŠ å…ƒç´ åˆ é™¤å…ƒç´ */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">fun</span><span class="params">()</span></span>&#123;</span><br><span class="line">        Long num = jedis.sadd(<span class="string">&quot;myset&quot;</span>, <span class="string">&quot;a&quot;</span>, <span class="string">&quot;a&quot;</span>, <span class="string">&quot;b&quot;</span>,<span class="string">&quot;abc&quot;</span>);</span><br><span class="line">        System.out.println(num);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="comment">/*è·å¾—å…ƒç´ */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">fun1</span><span class="params">()</span></span>&#123;</span><br><span class="line">        Set&lt;String&gt; myset = jedis.smembers(<span class="string">&quot;myset&quot;</span>);</span><br><span class="line">        System.out.println(myset);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="comment">/*ç§»é™¤å…ƒç´ */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">fun2</span><span class="params">()</span></span>&#123;</span><br><span class="line">        jedis.srem(<span class="string">&quot;myset&quot;</span>,<span class="string">&quot;a&quot;</span>,<span class="string">&quot;b&quot;</span>);</span><br><span class="line">        Set&lt;String&gt; myset = jedis.smembers(<span class="string">&quot;myset&quot;</span>);</span><br><span class="line">        System.out.println(myset);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="comment">//åˆ¤æ–­æ˜¯å¦è¿™ä¸ªsetä¸­å­˜åœ¨æŸä¸ªå€¼</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">fun3</span><span class="params">()</span></span>&#123;</span><br><span class="line">        Boolean sismember = jedis.sismember(<span class="string">&quot;myset&quot;</span>, <span class="string">&quot;a&quot;</span>);</span><br><span class="line">        System.out.println(sismember);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="comment">//è·å¾—A-B è·å¾—å·®é›†åˆ</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">fun4</span><span class="params">()</span></span>&#123;</span><br><span class="line">        jedis.sadd(<span class="string">&quot;myset1&quot;</span>,<span class="string">&quot;123&quot;</span>,<span class="string">&quot;32&quot;</span>,<span class="string">&quot;abc&quot;</span>,<span class="string">&quot;def&quot;</span>,<span class="string">&quot;123456&quot;</span>,<span class="string">&quot;sdfasd&quot;</span>);</span><br><span class="line">        jedis.sadd(<span class="string">&quot;myset2&quot;</span>,<span class="string">&quot;abc&quot;</span>,<span class="string">&quot;345&quot;</span>,<span class="string">&quot;123&quot;</span>,<span class="string">&quot;fda&quot;</span>);</span><br><span class="line">        Set&lt;String&gt; sdiff = jedis.sdiff(<span class="string">&quot;myset1&quot;</span>, <span class="string">&quot;myset2&quot;</span>);</span><br><span class="line">        System.out.println(sdiff);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="comment">//è·å¾—äº¤é›†</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">fun5</span><span class="params">()</span></span>&#123;</span><br><span class="line">        Set&lt;String&gt; sinter = jedis.sinter(<span class="string">&quot;myset1&quot;</span>, <span class="string">&quot;myset2&quot;</span>);</span><br><span class="line">        System.out.println(sinter);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line"><span class="comment">//    è·å¾—å¹¶é›†åˆ</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">fun6</span><span class="params">()</span></span>&#123;</span><br><span class="line">        Set&lt;String&gt; sunion = jedis.sunion(<span class="string">&quot;myset1&quot;</span>, <span class="string">&quot;myset2&quot;</span>);</span><br><span class="line">        System.out.println(sunion);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line"><span class="comment">//    æˆå‘˜æ•°é‡</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">fun7</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(jedis.scard(<span class="string">&quot;myset1&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line"><span class="comment">//    è·å¾—éšæœºçš„ä¸€ä¸ªæˆå‘˜</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">fun8</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(jedis.srandmember(<span class="string">&quot;myset1&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line"><span class="comment">//    å°†ç›¸å·®çš„æˆå‘˜æ”¾åˆ°ä¸€ä¸ªæ–°çš„setä¸­åŒç†äº¤é›†å’Œå¹¶é›†éƒ½å¯ä»¥åé¢å‡</span></span><br><span class="line"><span class="comment">//    åŠ ä¸Šä¸€ä¸ªstoreå³å¯</span></span><br><span class="line"><span class="comment">//    å¹¶è¿”å›æ–°çš„é•¿åº¦</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">fun9</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(jedis.sdiffstore(<span class="string">&quot;myset3&quot;</span>,<span class="string">&quot;myset1&quot;</span>,<span class="string">&quot;myset2&quot;</span>));</span><br><span class="line">        System.out.println(jedis.smembers(<span class="string">&quot;myset3&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="SortedSet-æ“ä½œ"><a href="#SortedSet-æ“ä½œ" class="headerlink" title="SortedSet æ“ä½œ"></a>SortedSet æ“ä½œ</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">å’Œsetæä¸ºçš„ç±»ä¼¼ï¼Œä»–ä»¬æ˜¯å­—ç¬¦ä¸²çš„é›†åˆï¼Œæ²¡æœ‰é‡å¤çš„æ•°æ®</span></span><br><span class="line"><span class="comment">å·®åˆ«æ˜¯sortedsetæ¯ä¸ªæˆå‘˜ä¸­éƒ½ä¼šæœ‰ä¸€ä¸ªåˆ†æ•°ï¼ˆscoreï¼‰ä¸ä¹‹å…³è”</span></span><br><span class="line"><span class="comment">ï¼Œredisæ­£æ˜¯é€šè¿‡åˆ†æ•°æ¥ä¸ºé›†åˆä¸­çš„æˆå‘˜è¿›è¡Œä»å°åˆ°å¤§çš„æ’åº</span></span><br><span class="line"><span class="comment">sortedsetä¸­æ•°æ®å¿…é¡»å•ä¸€ä½†æ˜¯ä»–çš„scoreå¯ä»¥æ˜¯é‡å¤çš„</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SortedsetTest</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span>  Jedis jedis = JedisPoolUtil.getJedis();</span><br><span class="line"><span class="comment">//    æ·»åŠ å…ƒç´ </span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">fun</span><span class="params">()</span></span>&#123;</span><br><span class="line">        jedis.zadd(<span class="string">&quot;mysort&quot;</span>,<span class="number">100.0</span>, <span class="string">&quot;zhangsan&quot;</span>);</span><br><span class="line">        jedis.zadd(<span class="string">&quot;mysort&quot;</span>,<span class="number">200.0</span>,<span class="string">&quot;lisi&quot;</span>);</span><br><span class="line">        jedis.zadd(<span class="string">&quot;mysort&quot;</span>,<span class="number">50.0</span>,<span class="string">&quot;wangwu&quot;</span>);</span><br><span class="line">        Map&lt;String ,Double&gt;map = <span class="keyword">new</span> HashMap&lt;String ,Double&gt;();</span><br><span class="line">        map.put(<span class="string">&quot;mutouliu&quot;</span>,<span class="number">70.0</span>);</span><br><span class="line"></span><br><span class="line">        jedis.zadd(<span class="string">&quot;mysort&quot;</span>,map);</span><br><span class="line">        Set&lt;String&gt; mysort = jedis.zrange(<span class="string">&quot;mysort&quot;</span>, <span class="number">0</span>, -<span class="number">1</span>);</span><br><span class="line">        System.out.println(mysort);</span><br><span class="line">        Set&lt;String&gt; mysort1 = jedis.zrange(<span class="string">&quot;mysort&quot;</span>, <span class="number">1</span>, <span class="number">2</span>);</span><br><span class="line">        System.out.println(mysort1);</span><br><span class="line">    &#125;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><h3 id="redisç›¸æ¯”memcachedæœ‰å“ªäº›ä¼˜åŠ¿"><a href="#redisç›¸æ¯”memcachedæœ‰å“ªäº›ä¼˜åŠ¿" class="headerlink" title="redisç›¸æ¯”memcachedæœ‰å“ªäº›ä¼˜åŠ¿"></a>redisç›¸æ¯”memcachedæœ‰å“ªäº›ä¼˜åŠ¿</h3><ol><li>memcachedæ‰€æœ‰çš„å€¼å‡æ˜¯ç®€å•çš„å­—ç¬¦ä¸²ï¼Œredisä½œä¸ºå…¶æ›¿ä»£è€…ï¼Œæ”¯æŒæ›´ä¸ºä¸°å¯Œçš„æ•°æ®ç±»å‹ </li><li>redisçš„é€Ÿåº¦æ¯”memcachedå¿«å¾ˆå¤š</li><li>rediså¯ä»¥æŒä¹…åŒ–å…¶æ•°æ®</li></ol><h3 id="Memcacheä¸Redisçš„åŒºåˆ«éƒ½æœ‰å“ªäº›"><a href="#Memcacheä¸Redisçš„åŒºåˆ«éƒ½æœ‰å“ªäº›" class="headerlink" title="Memcacheä¸Redisçš„åŒºåˆ«éƒ½æœ‰å“ªäº›"></a>Memcacheä¸Redisçš„åŒºåˆ«éƒ½æœ‰å“ªäº›</h3><ol><li>å­˜å‚¨æ–¹å¼ MemecacheæŠŠæ•°æ®å…¨éƒ¨å­˜åœ¨å†…å­˜ä¹‹ä¸­ï¼Œæ–­ç”µåä¼šæŒ‚æ‰ï¼Œæ•°æ®ä¸èƒ½è¶…è¿‡å†…å­˜å¤§å°ã€‚ Redisæœ‰éƒ¨ä»½å­˜åœ¨ç¡¬ç›˜ä¸Šï¼Œè¿™æ ·èƒ½ä¿è¯æ•°æ®çš„æŒä¹…æ€§ã€‚ </li><li>æ•°æ®æ”¯æŒç±»å‹ Memcacheå¯¹æ•°æ®ç±»å‹æ”¯æŒç›¸å¯¹ç®€å•ã€‚ Redisæœ‰å¤æ‚çš„æ•°æ®ç±»å‹ã€‚ </li><li>ä½¿ç”¨åº•å±‚æ¨¡å‹ä¸åŒ å®ƒä»¬ä¹‹é—´åº•å±‚å®ç°æ–¹å¼ ä»¥åŠä¸å®¢æˆ·ç«¯ä¹‹é—´é€šä¿¡çš„åº”ç”¨åè®®ä¸ä¸€æ ·ã€‚ Redisç›´æ¥è‡ªå·±æ„å»ºäº†VM æœºåˆ¶ ï¼Œå› ä¸ºä¸€èˆ¬çš„ç³»ç»Ÿè°ƒç”¨ç³»ç»Ÿå‡½æ•°çš„è¯ï¼Œä¼šæµªè´¹ä¸€å®šçš„æ—¶é—´å»ç§»åŠ¨å’Œè¯·æ±‚ã€‚ </li></ol><h3 id="rediså¸¸è§æ€§èƒ½é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ"><a href="#rediså¸¸è§æ€§èƒ½é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ" class="headerlink" title="rediså¸¸è§æ€§èƒ½é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ:"></a>rediså¸¸è§æ€§èƒ½é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ:</h3><ol><li>Masterå†™å†…å­˜å¿«ç…§ï¼Œsaveå‘½ä»¤è°ƒåº¦rdbSaveå‡½æ•°ï¼Œä¼šé˜»å¡ä¸»çº¿ç¨‹çš„å·¥ä½œï¼Œå½“å¿«ç…§æ¯”è¾ƒå¤§æ—¶å¯¹æ€§èƒ½å½±å“æ˜¯éå¸¸å¤§çš„ï¼Œä¼šé—´æ–­æ€§æš‚åœæœåŠ¡ï¼Œæ‰€ä»¥Masteræœ€å¥½ä¸è¦å†™å†…å­˜å¿«ç…§ã€‚</li><li>Master AOFæŒä¹…åŒ–ï¼Œå¦‚æœä¸é‡å†™AOFæ–‡ä»¶ï¼Œè¿™ä¸ªæŒä¹…åŒ–æ–¹å¼å¯¹æ€§èƒ½çš„å½±å“æ˜¯æœ€å°çš„ï¼Œä½†æ˜¯AOFæ–‡ä»¶ä¼šä¸æ–­å¢å¤§ï¼ŒAOFæ–‡ä»¶è¿‡å¤§ä¼šå½±å“Masteré‡å¯çš„æ¢å¤é€Ÿåº¦ã€‚Masteræœ€å¥½ä¸è¦åšä»»ä½•æŒä¹…åŒ–å·¥ä½œï¼ŒåŒ…æ‹¬å†…å­˜å¿«ç…§å’ŒAOFæ—¥å¿—æ–‡ä»¶ï¼Œç‰¹åˆ«æ˜¯ä¸è¦å¯ç”¨å†…å­˜å¿«ç…§åšæŒä¹…åŒ–,å¦‚æœæ•°æ®æ¯”è¾ƒå…³é”®ï¼ŒæŸä¸ªSlaveå¼€å¯AOFå¤‡ä»½æ•°æ®ï¼Œç­–ç•¥ä¸ºæ¯ç§’åŒæ­¥ä¸€æ¬¡ã€‚</li><li>Masterè°ƒç”¨BGREWRITEAOFé‡å†™AOFæ–‡ä»¶ï¼ŒAOFåœ¨é‡å†™çš„æ—¶å€™ä¼šå å¤§é‡çš„CPUå’Œå†…å­˜èµ„æºï¼Œå¯¼è‡´æœåŠ¡loadè¿‡é«˜ï¼Œå‡ºç°çŸ­æš‚æœåŠ¡æš‚åœç°è±¡ã€‚</li><li>Redisä¸»ä»å¤åˆ¶çš„æ€§èƒ½é—®é¢˜ï¼Œä¸ºäº†ä¸»ä»å¤åˆ¶çš„é€Ÿåº¦å’Œè¿æ¥çš„ç¨³å®šæ€§ï¼ŒSlaveå’ŒMasteræœ€å¥½åœ¨åŒä¸€ä¸ªå±€åŸŸç½‘å†…</li></ol><h3 id="mySQLé‡Œæœ‰2000wæ•°æ®ï¼Œredisä¸­åªå­˜20wçš„æ•°æ®ï¼Œå¦‚ä½•ä¿è¯redisä¸­çš„æ•°æ®éƒ½æ˜¯çƒ­ç‚¹æ•°æ®"><a href="#mySQLé‡Œæœ‰2000wæ•°æ®ï¼Œredisä¸­åªå­˜20wçš„æ•°æ®ï¼Œå¦‚ä½•ä¿è¯redisä¸­çš„æ•°æ®éƒ½æ˜¯çƒ­ç‚¹æ•°æ®" class="headerlink" title="mySQLé‡Œæœ‰2000wæ•°æ®ï¼Œredisä¸­åªå­˜20wçš„æ•°æ®ï¼Œå¦‚ä½•ä¿è¯redisä¸­çš„æ•°æ®éƒ½æ˜¯çƒ­ç‚¹æ•°æ®"></a>mySQLé‡Œæœ‰2000wæ•°æ®ï¼Œredisä¸­åªå­˜20wçš„æ•°æ®ï¼Œå¦‚ä½•ä¿è¯redisä¸­çš„æ•°æ®éƒ½æ˜¯çƒ­ç‚¹æ•°æ®</h3><blockquote><p><em>redis å†…å­˜æ•°æ®é›†å¤§å°ä¸Šå‡åˆ°ä¸€å®šå¤§å°çš„æ—¶å€™ï¼Œå°±ä¼šæ–½è¡Œæ•°æ®æ·˜æ±°ç­–ç•¥ï¼ˆå›æ”¶ç­–ç•¥ï¼‰ã€‚</em></p></blockquote><p><strong>redis æä¾› 6ç§æ•°æ®æ·˜æ±°ç­–ç•¥ï¼š</strong></p><ol><li>volatile-lruï¼šä»å·²è®¾ç½®è¿‡æœŸæ—¶é—´çš„æ•°æ®é›†ï¼ˆserver.db[i].expiresï¼‰ä¸­æŒ‘é€‰æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„æ•°æ®æ·˜æ±°</li><li>volatile-ttlï¼šä»å·²è®¾ç½®è¿‡æœŸæ—¶é—´çš„æ•°æ®é›†ï¼ˆserver.db[i].expiresï¼‰ä¸­æŒ‘é€‰å°†è¦è¿‡æœŸçš„æ•°æ®æ·˜æ±°</li><li>volatile-randomï¼šä»å·²è®¾ç½®è¿‡æœŸæ—¶é—´çš„æ•°æ®é›†ï¼ˆserver.db[i].expiresï¼‰ä¸­ä»»æ„é€‰æ‹©æ•°æ®æ·˜æ±°</li><li>allkeys-lruï¼šä»æ•°æ®é›†ï¼ˆserver.db[i].dictï¼‰ä¸­æŒ‘é€‰æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„æ•°æ®æ·˜æ±°</li><li>allkeys-randomï¼šä»æ•°æ®é›†ï¼ˆserver.db[i].dictï¼‰ä¸­ä»»æ„é€‰æ‹©æ•°æ®æ·˜æ±°</li><li>no-envictionï¼ˆé©±é€ï¼‰ï¼šç¦æ­¢é©±é€æ•°æ®</li></ol><h3 id="ä¸ºä»€ä¹ˆrediséœ€è¦æŠŠæ‰€æœ‰æ•°æ®æ”¾åˆ°å†…å­˜ä¸­"><a href="#ä¸ºä»€ä¹ˆrediséœ€è¦æŠŠæ‰€æœ‰æ•°æ®æ”¾åˆ°å†…å­˜ä¸­" class="headerlink" title="ä¸ºä»€ä¹ˆrediséœ€è¦æŠŠæ‰€æœ‰æ•°æ®æ”¾åˆ°å†…å­˜ä¸­"></a>ä¸ºä»€ä¹ˆrediséœ€è¦æŠŠæ‰€æœ‰æ•°æ®æ”¾åˆ°å†…å­˜ä¸­</h3><p>Redisä¸ºäº†è¾¾åˆ°æœ€å¿«çš„è¯»å†™é€Ÿåº¦å°†æ•°æ®éƒ½è¯»åˆ°å†…å­˜ä¸­ï¼Œå¹¶é€šè¿‡å¼‚æ­¥çš„æ–¹å¼å°†æ•°æ®å†™å…¥ç£ç›˜ã€‚æ‰€ä»¥rediså…·æœ‰å¿«é€Ÿå’Œæ•°æ®æŒä¹…åŒ–çš„ç‰¹å¾ã€‚å¦‚æœä¸å°†æ•°æ®æ”¾åœ¨å†…å­˜ä¸­ï¼Œç£ç›˜I/Oé€Ÿåº¦ä¸ºä¸¥é‡å½±å“redisçš„æ€§èƒ½ã€‚åœ¨å†…å­˜è¶Šæ¥è¶Šä¾¿å®œçš„ä»Šå¤©ï¼Œrediså°†ä¼šè¶Šæ¥è¶Šå—æ¬¢è¿ã€‚</p><p><strong>å¦‚æœè®¾ç½®äº†æœ€å¤§ä½¿ç”¨çš„å†…å­˜ï¼Œåˆ™æ•°æ®å·²æœ‰è®°å½•æ•°è¾¾åˆ°å†…å­˜é™å€¼åä¸èƒ½ç»§ç»­æ’å…¥æ–°å€¼ã€‚</strong></p><h3 id="Redisæ˜¯å•è¿›ç¨‹å•çº¿ç¨‹çš„"><a href="#Redisæ˜¯å•è¿›ç¨‹å•çº¿ç¨‹çš„" class="headerlink" title="Redisæ˜¯å•è¿›ç¨‹å•çº¿ç¨‹çš„"></a>Redisæ˜¯å•è¿›ç¨‹å•çº¿ç¨‹çš„</h3><p>redisåˆ©ç”¨é˜Ÿåˆ—æŠ€æœ¯å°†å¹¶å‘è®¿é—®å˜ä¸ºä¸²è¡Œè®¿é—®ï¼Œæ¶ˆé™¤äº†ä¼ ç»Ÿæ•°æ®åº“ä¸²è¡Œæ§åˆ¶çš„å¼€é”€</p><h3 id="redisçš„å¹¶å‘ç«äº‰é—®é¢˜å¦‚ä½•è§£å†³"><a href="#redisçš„å¹¶å‘ç«äº‰é—®é¢˜å¦‚ä½•è§£å†³" class="headerlink" title="redisçš„å¹¶å‘ç«äº‰é—®é¢˜å¦‚ä½•è§£å†³"></a>redisçš„å¹¶å‘ç«äº‰é—®é¢˜å¦‚ä½•è§£å†³</h3><p>Redisä¸ºå•è¿›ç¨‹å•çº¿ç¨‹æ¨¡å¼ï¼Œé‡‡ç”¨é˜Ÿåˆ—æ¨¡å¼å°†å¹¶å‘è®¿é—®å˜ä¸ºä¸²è¡Œè®¿é—®ã€‚Redisæœ¬èº«æ²¡æœ‰é”çš„æ¦‚å¿µï¼ŒRediså¯¹äºå¤šä¸ªå®¢æˆ·ç«¯è¿æ¥å¹¶ä¸å­˜åœ¨ç«äº‰ï¼Œä½†æ˜¯åœ¨Jediså®¢æˆ·ç«¯å¯¹Redisè¿›è¡Œå¹¶å‘è®¿é—®æ—¶ä¼šå‘ç”Ÿè¿æ¥è¶…æ—¶ã€æ•°æ®è½¬æ¢é”™è¯¯ã€é˜»å¡ã€å®¢æˆ·ç«¯å…³é—­è¿æ¥ç­‰é—®é¢˜ï¼Œè¿™äº›é—®é¢˜å‡æ˜¯ç”±äºå®¢æˆ·ç«¯è¿æ¥æ··ä¹±é€ æˆã€‚</p><p><strong>å¯¹æ­¤æœ‰2ç§è§£å†³æ–¹æ³•ï¼š</strong></p><p>1.å®¢æˆ·ç«¯è§’åº¦ï¼Œä¸ºä¿è¯æ¯ä¸ªå®¢æˆ·ç«¯é—´æ­£å¸¸æœ‰åºä¸Redisè¿›è¡Œé€šä¿¡ï¼Œå¯¹è¿æ¥è¿›è¡Œæ± åŒ–ï¼ŒåŒæ—¶å¯¹å®¢æˆ·ç«¯è¯»å†™Redisæ“ä½œé‡‡ç”¨å†…éƒ¨é”synchronizedã€‚</p><p>2.æœåŠ¡å™¨è§’åº¦ï¼Œåˆ©ç”¨setnxå®ç°é”ã€‚</p><blockquote><p> <em>æ³¨ï¼šå¯¹äºç¬¬ä¸€ç§ï¼Œéœ€è¦åº”ç”¨ç¨‹åºè‡ªå·±å¤„ç†èµ„æºçš„åŒæ­¥ï¼Œå¯ä»¥ä½¿ç”¨çš„æ–¹æ³•æ¯”è¾ƒé€šä¿—ï¼Œå¯ä»¥ä½¿ç”¨synchronizedä¹Ÿå¯ä»¥ä½¿ç”¨lockï¼›ç¬¬äºŒç§éœ€è¦ç”¨åˆ°Redisçš„setnxå‘½ä»¤ï¼Œä½†æ˜¯éœ€è¦æ³¨æ„ä¸€äº›é—®é¢˜ã€‚</em></p></blockquote><h3 id="redisæŒä¹…åŒ–çš„å‡ ç§æ–¹å¼"><a href="#redisæŒä¹…åŒ–çš„å‡ ç§æ–¹å¼" class="headerlink" title="redisæŒä¹…åŒ–çš„å‡ ç§æ–¹å¼"></a>redisæŒä¹…åŒ–çš„å‡ ç§æ–¹å¼</h3><h4 id="å¿«ç…§ï¼ˆsnapshotsï¼‰"><a href="#å¿«ç…§ï¼ˆsnapshotsï¼‰" class="headerlink" title="å¿«ç…§ï¼ˆsnapshotsï¼‰"></a><strong>å¿«ç…§ï¼ˆsnapshotsï¼‰</strong></h4><p>ç¼ºçœæƒ…å†µæƒ…å†µä¸‹ï¼ŒRedisæŠŠæ•°æ®å¿«ç…§å­˜æ”¾åœ¨ç£ç›˜ä¸Šçš„äºŒè¿›åˆ¶æ–‡ä»¶ä¸­ï¼Œæ–‡ä»¶åä¸ºdump.rdbã€‚ä½ å¯ä»¥é…ç½®Redisçš„æŒä¹…åŒ–ç­–ç•¥ï¼Œä¾‹å¦‚æ•°æ®é›†ä¸­æ¯Nç§’é’Ÿæœ‰è¶…è¿‡Mæ¬¡æ›´æ–°ï¼Œå°±å°†æ•°æ®å†™å…¥ç£ç›˜ï¼›æˆ–è€…ä½ å¯ä»¥æ‰‹å·¥è°ƒç”¨å‘½ä»¤SAVEæˆ–BGSAVEã€‚</p><p><strong>å·¥ä½œåŸç†</strong></p><ul><li>Redis forks.</li><li>å­è¿›ç¨‹å¼€å§‹å°†æ•°æ®å†™åˆ°ä¸´æ—¶RDBæ–‡ä»¶ä¸­ã€‚</li><li>å½“å­è¿›ç¨‹å®Œæˆå†™RDBæ–‡ä»¶ï¼Œç”¨æ–°æ–‡ä»¶æ›¿æ¢è€æ–‡ä»¶ã€‚</li><li>è¿™ç§æ–¹å¼å¯ä»¥ä½¿Redisä½¿ç”¨copy-on-writeæŠ€æœ¯ã€‚</li></ul><h4 id="AOF"><a href="#AOF" class="headerlink" title="AOF"></a><strong>AOF</strong></h4><p>å¿«ç…§æ¨¡å¼å¹¶ä¸ååˆ†å¥å£®ï¼Œå½“ç³»ç»Ÿåœæ­¢ï¼Œæˆ–è€…æ— æ„ä¸­Redisè¢«killæ‰ï¼Œæœ€åå†™å…¥Redisçš„æ•°æ®å°±ä¼šä¸¢å¤±ã€‚</p><p>è¿™å¯¹æŸäº›åº”ç”¨ä¹Ÿè®¸ä¸æ˜¯å¤§é—®é¢˜ï¼Œä½†å¯¹äºè¦æ±‚é«˜å¯é æ€§çš„åº”ç”¨æ¥è¯´ï¼ŒRediså°±ä¸æ˜¯ä¸€ä¸ªåˆé€‚çš„é€‰æ‹©ã€‚Append-onlyæ–‡ä»¶æ¨¡å¼æ˜¯å¦ä¸€ç§é€‰æ‹©ã€‚ä½ å¯ä»¥åœ¨é…ç½®æ–‡ä»¶ä¸­æ‰“å¼€AOFæ¨¡å¼</p><h4 id="è™šæ‹Ÿå†…å­˜æ–¹å¼"><a href="#è™šæ‹Ÿå†…å­˜æ–¹å¼" class="headerlink" title="è™šæ‹Ÿå†…å­˜æ–¹å¼"></a><strong>è™šæ‹Ÿå†…å­˜æ–¹å¼</strong></h4><p>å½“ä½ çš„keyå¾ˆå°è€Œvalueå¾ˆå¤§æ—¶,ä½¿ç”¨VMçš„æ•ˆæœä¼šæ¯”è¾ƒå¥½.å› ä¸ºè¿™æ ·èŠ‚çº¦çš„å†…å­˜æ¯”è¾ƒå¤§.</p><p>å½“ä½ çš„keyä¸å°æ—¶,å¯ä»¥è€ƒè™‘ä½¿ç”¨ä¸€äº›éå¸¸æ–¹æ³•å°†å¾ˆå¤§çš„keyå˜æˆå¾ˆå¤§çš„value,æ¯”å¦‚ä½ å¯ä»¥è€ƒè™‘å°†key,valueç»„åˆæˆä¸€ä¸ªæ–°çš„value.</p><p>vm-max-threadsè¿™ä¸ªå‚æ•°,å¯ä»¥è®¾ç½®è®¿é—®swapæ–‡ä»¶çš„çº¿ç¨‹æ•°,è®¾ç½®æœ€å¥½ä¸è¦è¶…è¿‡æœºå™¨çš„æ ¸æ•°,å¦‚æœè®¾ç½®ä¸º0,é‚£ä¹ˆæ‰€æœ‰å¯¹swapæ–‡ä»¶çš„æ“ä½œéƒ½æ˜¯ä¸²è¡Œçš„.å¯èƒ½ä¼šé€ æˆæ¯”è¾ƒé•¿æ—¶é—´çš„å»¶è¿Ÿ,ä½†æ˜¯å¯¹æ•°æ®å®Œæ•´æ€§æœ‰å¾ˆå¥½çš„ä¿è¯.</p><p>è‡ªå·±æµ‹è¯•çš„æ—¶å€™å‘ç°ç”¨è™šæ‹Ÿå†…å­˜æ€§èƒ½ä¹Ÿä¸é”™ã€‚å¦‚æœæ•°æ®é‡å¾ˆå¤§ï¼Œå¯ä»¥è€ƒè™‘åˆ†å¸ƒå¼æˆ–è€…å…¶ä»–æ•°æ®åº“ã€‚</p><h3 id="redisçš„ç¼“å­˜å¤±æ•ˆç­–ç•¥å’Œä¸»é”®å¤±æ•ˆæœºåˆ¶"><a href="#redisçš„ç¼“å­˜å¤±æ•ˆç­–ç•¥å’Œä¸»é”®å¤±æ•ˆæœºåˆ¶" class="headerlink" title="redisçš„ç¼“å­˜å¤±æ•ˆç­–ç•¥å’Œä¸»é”®å¤±æ•ˆæœºåˆ¶"></a><strong>redisçš„ç¼“å­˜å¤±æ•ˆç­–ç•¥å’Œä¸»é”®å¤±æ•ˆæœºåˆ¶</strong></h3><p>ä½œä¸ºç¼“å­˜ç³»ç»Ÿéƒ½è¦å®šæœŸæ¸…ç†æ— æ•ˆæ•°æ®ï¼Œå°±éœ€è¦ä¸€ä¸ªä¸»é”®å¤±æ•ˆå’Œæ·˜æ±°ç­–ç•¥.</p><p>åœ¨Rediså½“ä¸­ï¼Œæœ‰ç”Ÿå­˜æœŸçš„keyè¢«ç§°ä¸ºvolatileã€‚åœ¨åˆ›å»ºç¼“å­˜æ—¶ï¼Œè¦ä¸ºç»™å®šçš„keyè®¾ç½®ç”Ÿå­˜æœŸï¼Œå½“keyè¿‡æœŸçš„æ—¶å€™ï¼ˆç”Ÿå­˜æœŸä¸º0ï¼‰ï¼Œå®ƒå¯èƒ½ä¼šè¢«åˆ é™¤ã€‚</p><h4 id="1ã€å½±å“ç”Ÿå­˜æ—¶é—´çš„ä¸€äº›æ“ä½œ"><a href="#1ã€å½±å“ç”Ÿå­˜æ—¶é—´çš„ä¸€äº›æ“ä½œ" class="headerlink" title="1ã€å½±å“ç”Ÿå­˜æ—¶é—´çš„ä¸€äº›æ“ä½œ"></a><strong>1ã€å½±å“ç”Ÿå­˜æ—¶é—´çš„ä¸€äº›æ“ä½œ</strong></h4><p>ç”Ÿå­˜æ—¶é—´å¯ä»¥é€šè¿‡ä½¿ç”¨ DEL å‘½ä»¤æ¥åˆ é™¤æ•´ä¸ª key æ¥ç§»é™¤ï¼Œæˆ–è€…è¢« SET å’Œ GETSET å‘½ä»¤è¦†ç›–åŸæ¥çš„æ•°æ®ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä¿®æ”¹keyå¯¹åº”çš„valueå’Œä½¿ç”¨å¦å¤–ç›¸åŒçš„keyå’Œvalueæ¥è¦†ç›–ä»¥åï¼Œå½“å‰æ•°æ®çš„ç”Ÿå­˜æ—¶é—´ä¸åŒã€‚</p><p>æ¯”å¦‚è¯´ï¼Œå¯¹ä¸€ä¸ª key æ‰§è¡ŒINCRå‘½ä»¤ï¼Œå¯¹ä¸€ä¸ªåˆ—è¡¨è¿›è¡ŒLPUSHå‘½ä»¤ï¼Œæˆ–è€…å¯¹ä¸€ä¸ªå“ˆå¸Œè¡¨æ‰§è¡ŒHSETå‘½ä»¤ï¼Œè¿™ç±»æ“ä½œéƒ½ä¸ä¼šä¿®æ”¹ key æœ¬èº«çš„ç”Ÿå­˜æ—¶é—´ã€‚å¦ä¸€æ–¹é¢ï¼Œå¦‚æœä½¿ç”¨RENAMEå¯¹ä¸€ä¸ª key è¿›è¡Œæ”¹åï¼Œé‚£ä¹ˆæ”¹ååçš„ keyçš„ç”Ÿå­˜æ—¶é—´å’Œæ”¹åå‰ä¸€æ ·ã€‚</p><p>RENAMEå‘½ä»¤çš„å¦ä¸€ç§å¯èƒ½æ˜¯ï¼Œå°è¯•å°†ä¸€ä¸ªå¸¦ç”Ÿå­˜æ—¶é—´çš„ key æ”¹åæˆå¦ä¸€ä¸ªå¸¦ç”Ÿå­˜æ—¶é—´çš„ another_key ï¼Œè¿™æ—¶æ—§çš„ another_key (ä»¥åŠå®ƒçš„ç”Ÿå­˜æ—¶é—´)ä¼šè¢«åˆ é™¤ï¼Œç„¶åæ—§çš„ key ä¼šæ”¹åä¸º another_key ï¼Œå› æ­¤ï¼Œæ–°çš„ another_key çš„ç”Ÿå­˜æ—¶é—´ä¹Ÿå’ŒåŸæœ¬çš„ key ä¸€æ ·ã€‚ä½¿ç”¨PERSISTå‘½ä»¤å¯ä»¥åœ¨ä¸åˆ é™¤ key çš„æƒ…å†µä¸‹ï¼Œç§»é™¤ key çš„ç”Ÿå­˜æ—¶é—´ï¼Œè®© key é‡æ–°æˆä¸ºä¸€ä¸ªpersistent key ã€‚</p><h4 id="å¦‚ä½•æ›´æ–°ç”Ÿå­˜æ—¶é—´"><a href="#å¦‚ä½•æ›´æ–°ç”Ÿå­˜æ—¶é—´" class="headerlink" title="å¦‚ä½•æ›´æ–°ç”Ÿå­˜æ—¶é—´"></a><strong>å¦‚ä½•æ›´æ–°ç”Ÿå­˜æ—¶é—´</strong></h4><p>å¯ä»¥å¯¹ä¸€ä¸ªå·²ç»å¸¦æœ‰ç”Ÿå­˜æ—¶é—´çš„ key æ‰§è¡ŒEXPIREå‘½ä»¤ï¼Œæ–°æŒ‡å®šçš„ç”Ÿå­˜æ—¶é—´ä¼šå–ä»£æ—§çš„ç”Ÿå­˜æ—¶é—´ã€‚è¿‡æœŸæ—¶é—´çš„ç²¾åº¦å·²ç»è¢«æ§åˆ¶åœ¨1msä¹‹å†…ï¼Œä¸»é”®å¤±æ•ˆçš„æ—¶é—´å¤æ‚åº¦æ˜¯Oï¼ˆ1ï¼‰ï¼ŒEXPIREå’ŒTTLå‘½ä»¤æ­é…ä½¿ç”¨ï¼ŒTTLå¯ä»¥æŸ¥çœ‹keyçš„å½“å‰ç”Ÿå­˜æ—¶é—´ã€‚è®¾ç½®æˆåŠŸè¿”å› 1ï¼›å½“ key ä¸å­˜åœ¨æˆ–è€…ä¸èƒ½ä¸º key è®¾ç½®ç”Ÿå­˜æ—¶é—´æ—¶ï¼Œè¿”å› 0 ã€‚</p><h4 id="æœ€å¤§ç¼“å­˜é…ç½®ï¼š"><a href="#æœ€å¤§ç¼“å­˜é…ç½®ï¼š" class="headerlink" title="æœ€å¤§ç¼“å­˜é…ç½®ï¼š"></a><strong>æœ€å¤§ç¼“å­˜é…ç½®ï¼š</strong></h4><p>åœ¨ redis ä¸­ï¼Œå…è®¸ç”¨æˆ·è®¾ç½®æœ€å¤§ä½¿ç”¨å†…å­˜å¤§å°ï¼Œserver.maxmemoryé»˜è®¤ä¸º0ï¼Œæ²¡æœ‰æŒ‡å®šæœ€å¤§ç¼“å­˜ï¼Œå¦‚æœæœ‰æ–°çš„æ•°æ®æ·»åŠ ï¼Œè¶…è¿‡æœ€å¤§å†…å­˜ï¼Œåˆ™ä¼šä½¿rediså´©æºƒï¼Œæ‰€ä»¥ä¸€å®šè¦è®¾ç½®ã€‚redis å†…å­˜æ•°æ®é›†å¤§å°ä¸Šå‡åˆ°ä¸€å®šå¤§å°çš„æ—¶å€™ï¼Œå°±ä¼šå®è¡Œæ•°æ®æ·˜æ±°ç­–ç•¥ã€‚</p><p><strong>redis æä¾› 6ç§æ•°æ®æ·˜æ±°ç­–ç•¥ï¼š</strong></p><ol><li>volatile-lruï¼šä»å·²è®¾ç½®è¿‡æœŸæ—¶é—´çš„æ•°æ®é›†ï¼ˆserver.db[i].expiresï¼‰ä¸­æŒ‘é€‰æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„æ•°æ®æ·˜æ±°</li><li>volatile-ttlï¼šä»å·²è®¾ç½®è¿‡æœŸæ—¶é—´çš„æ•°æ®é›†ï¼ˆserver.db[i].expiresï¼‰ä¸­æŒ‘é€‰å°†è¦è¿‡æœŸçš„æ•°æ®æ·˜æ±°</li><li> volatile-randomï¼šä»å·²è®¾ç½®è¿‡æœŸæ—¶é—´çš„æ•°æ®é›†ï¼ˆserver.db[i].expiresï¼‰ä¸­ä»»æ„é€‰æ‹©æ•°æ®æ·˜æ±°</li><li>allkeys-lruï¼šä»æ•°æ®é›†ï¼ˆserver.db[i].dictï¼‰ä¸­æŒ‘é€‰æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„æ•°æ®æ·˜æ±°</li><li>allkeys-randomï¼šä»æ•°æ®é›†ï¼ˆserver.db[i].dictï¼‰ä¸­ä»»æ„é€‰æ‹©æ•°æ®æ·˜æ±°</li><li>no-envictionï¼ˆé©±é€ï¼‰ï¼šç¦æ­¢é©±é€æ•°æ®</li></ol><p>æ³¨æ„è¿™é‡Œçš„6ç§æœºåˆ¶ï¼Œvolatileå’Œallkeysè§„å®šäº†æ˜¯å¯¹å·²è®¾ç½®è¿‡æœŸæ—¶é—´çš„æ•°æ®é›†æ·˜æ±°æ•°æ®è¿˜æ˜¯ä»å…¨éƒ¨æ•°æ®é›†æ·˜æ±°æ•°æ®ï¼Œåé¢çš„lruã€ttlä»¥åŠrandomæ˜¯ä¸‰ç§ä¸åŒçš„æ·˜æ±°ç­–ç•¥ï¼Œå†åŠ ä¸Šä¸€ç§no-envictionæ°¸ä¸å›æ”¶çš„ç­–ç•¥ã€‚</p><p><strong>ä½¿ç”¨ç­–ç•¥è§„åˆ™ï¼š</strong></p><ol><li>å¦‚æœæ•°æ®å‘ˆç°å¹‚å¾‹åˆ†å¸ƒï¼Œä¹Ÿå°±æ˜¯ä¸€éƒ¨åˆ†æ•°æ®è®¿é—®é¢‘ç‡é«˜ï¼Œä¸€éƒ¨åˆ†æ•°æ®è®¿é—®é¢‘ç‡ä½ï¼Œåˆ™ä½¿ç”¨allkeys-lru</li><li>å¦‚æœæ•°æ®å‘ˆç°å¹³ç­‰åˆ†å¸ƒï¼Œä¹Ÿå°±æ˜¯æ‰€æœ‰çš„æ•°æ®è®¿é—®é¢‘ç‡éƒ½ç›¸åŒï¼Œåˆ™ä½¿ç”¨allkeys-random</li></ol><h4 id="ä¸‰ç§æ•°æ®æ·˜æ±°ç­–ç•¥ï¼š"><a href="#ä¸‰ç§æ•°æ®æ·˜æ±°ç­–ç•¥ï¼š" class="headerlink" title="ä¸‰ç§æ•°æ®æ·˜æ±°ç­–ç•¥ï¼š"></a><strong>ä¸‰ç§æ•°æ®æ·˜æ±°ç­–ç•¥ï¼š</strong></h4><p>ttlå’Œrandomæ¯”è¾ƒå®¹æ˜“ç†è§£ï¼Œå®ç°ä¹Ÿä¼šæ¯”è¾ƒç®€å•ã€‚ä¸»è¦æ˜¯Lruæœ€è¿‘æœ€å°‘ä½¿ç”¨æ·˜æ±°ç­–ç•¥ï¼Œè®¾è®¡ä¸Šä¼šå¯¹key æŒ‰å¤±æ•ˆæ—¶é—´æ’åºï¼Œç„¶åå–æœ€å…ˆå¤±æ•ˆçš„keyè¿›è¡Œæ·˜æ±°</p><h3 id="redis-é€‚åˆçš„åœºæ™¯"><a href="#redis-é€‚åˆçš„åœºæ™¯" class="headerlink" title="redis é€‚åˆçš„åœºæ™¯"></a><strong>redis é€‚åˆçš„åœºæ™¯</strong></h3><p>Redisæœ€é€‚åˆæ‰€æœ‰æ•°æ®in-momoryçš„åœºæ™¯ï¼Œè™½ç„¶Redisä¹Ÿæä¾›æŒä¹…åŒ–åŠŸèƒ½ï¼Œä½†å®é™…æ›´å¤šçš„æ˜¯ä¸€ä¸ªdisk-backedçš„åŠŸèƒ½ï¼Œè·Ÿä¼ ç»Ÿæ„ä¹‰ä¸Šçš„æŒä¹…åŒ–æœ‰æ¯”è¾ƒå¤§çš„å·®åˆ«ï¼Œé‚£ä¹ˆå¯èƒ½å¤§å®¶å°±ä¼šæœ‰ç–‘é—®ï¼Œä¼¼ä¹Redisæ›´åƒä¸€ä¸ªåŠ å¼ºç‰ˆçš„Memcachedï¼Œé‚£ä¹ˆä½•æ—¶ä½¿ç”¨Memcachedï¼Œä½•æ—¶ä½¿ç”¨Rediså‘¢?</p><p>å¦‚æœç®€å•åœ°æ¯”è¾ƒRedisä¸Memcachedçš„åŒºåˆ«ï¼Œå¤§å¤šæ•°éƒ½ä¼šå¾—åˆ°ä»¥ä¸‹è§‚ç‚¹ï¼š</p><ol><li>Redisä¸ä»…ä»…æ”¯æŒç®€å•çš„k/vç±»å‹çš„æ•°æ®ï¼ŒåŒæ—¶è¿˜æä¾›listï¼Œsetï¼Œzsetï¼Œhashç­‰æ•°æ®ç»“æ„çš„å­˜å‚¨ã€‚</li><li>Redisæ”¯æŒæ•°æ®çš„å¤‡ä»½ï¼Œå³master-slaveæ¨¡å¼çš„æ•°æ®å¤‡ä»½ã€‚</li><li>Redisæ”¯æŒæ•°æ®çš„æŒä¹…åŒ–ï¼Œå¯ä»¥å°†å†…å­˜ä¸­çš„æ•°æ®ä¿æŒåœ¨ç£ç›˜ä¸­ï¼Œé‡å¯çš„æ—¶å€™å¯ä»¥å†æ¬¡åŠ è½½è¿›è¡Œä½¿ç”¨ã€‚</li></ol><h4 id="ä¼šè¯ç¼“å­˜ï¼ˆSession-Cacheï¼‰"><a href="#ä¼šè¯ç¼“å­˜ï¼ˆSession-Cacheï¼‰" class="headerlink" title="ä¼šè¯ç¼“å­˜ï¼ˆSession Cacheï¼‰"></a><strong>ä¼šè¯ç¼“å­˜ï¼ˆSession Cacheï¼‰</strong></h4><p>æœ€å¸¸ç”¨çš„ä¸€ç§ä½¿ç”¨Redisçš„æƒ…æ™¯æ˜¯ä¼šè¯ç¼“å­˜ï¼ˆsession cacheï¼‰ã€‚ç”¨Redisç¼“å­˜ä¼šè¯æ¯”å…¶ä»–å­˜å‚¨ï¼ˆå¦‚Memcachedï¼‰çš„ä¼˜åŠ¿åœ¨äºï¼šRedisæä¾›æŒä¹…åŒ–ã€‚å½“ç»´æŠ¤ä¸€ä¸ªä¸æ˜¯ä¸¥æ ¼è¦æ±‚ä¸€è‡´æ€§çš„ç¼“å­˜æ—¶ï¼Œå¦‚æœç”¨æˆ·çš„è´­ç‰©è½¦ä¿¡æ¯å…¨éƒ¨ä¸¢å¤±ï¼Œå¤§éƒ¨åˆ†äººéƒ½ä¼šä¸é«˜å…´çš„ï¼Œç°åœ¨ï¼Œä»–ä»¬è¿˜ä¼šè¿™æ ·å—ï¼Ÿ</p><p>å¹¸è¿çš„æ˜¯ï¼Œéšç€ Redis è¿™äº›å¹´çš„æ”¹è¿›ï¼Œå¾ˆå®¹æ˜“æ‰¾åˆ°æ€ä¹ˆæ°å½“çš„ä½¿ç”¨Redisæ¥ç¼“å­˜ä¼šè¯çš„æ–‡æ¡£ã€‚ç”šè‡³å¹¿ä¸ºäººçŸ¥çš„å•†ä¸šå¹³å°Magentoä¹Ÿæä¾›Redisçš„æ’ä»¶ã€‚</p><h4 id="å…¨é¡µç¼“å­˜ï¼ˆFPCï¼‰"><a href="#å…¨é¡µç¼“å­˜ï¼ˆFPCï¼‰" class="headerlink" title="å…¨é¡µç¼“å­˜ï¼ˆFPCï¼‰"></a><strong>å…¨é¡µç¼“å­˜ï¼ˆFPCï¼‰</strong></h4><p>é™¤åŸºæœ¬çš„ä¼šè¯tokenä¹‹å¤–ï¼ŒRedisè¿˜æä¾›å¾ˆç®€ä¾¿çš„FPCå¹³å°ã€‚å›åˆ°ä¸€è‡´æ€§é—®é¢˜ï¼Œå³ä½¿é‡å¯äº†Rediså®ä¾‹ï¼Œå› ä¸ºæœ‰ç£ç›˜çš„æŒä¹…åŒ–ï¼Œç”¨æˆ·ä¹Ÿä¸ä¼šçœ‹åˆ°é¡µé¢åŠ è½½é€Ÿåº¦çš„ä¸‹é™ï¼Œè¿™æ˜¯ä¸€ä¸ªæå¤§æ”¹è¿›ï¼Œç±»ä¼¼PHPæœ¬åœ°FPCã€‚</p><p>å†æ¬¡ä»¥Magentoä¸ºä¾‹ï¼ŒMagentoæä¾›ä¸€ä¸ªæ’ä»¶æ¥ä½¿ç”¨Redisä½œä¸ºå…¨é¡µç¼“å­˜åç«¯ã€‚</p><p>æ­¤å¤–ï¼Œå¯¹WordPressçš„ç”¨æˆ·æ¥è¯´ï¼ŒPantheonæœ‰ä¸€ä¸ªéå¸¸å¥½çš„æ’ä»¶ wp-redisï¼Œè¿™ä¸ªæ’ä»¶èƒ½å¸®åŠ©ä½ ä»¥æœ€å¿«é€Ÿåº¦åŠ è½½ä½ æ›¾æµè§ˆè¿‡çš„é¡µé¢ã€‚</p><h4 id="é˜Ÿåˆ—"><a href="#é˜Ÿåˆ—" class="headerlink" title="é˜Ÿåˆ—"></a><strong>é˜Ÿåˆ—</strong></h4><p>Reidsåœ¨å†…å­˜å­˜å‚¨å¼•æ“é¢†åŸŸçš„ä¸€å¤§ä¼˜ç‚¹æ˜¯æä¾› list å’Œ set æ“ä½œï¼Œè¿™ä½¿å¾—Redisèƒ½ä½œä¸ºä¸€ä¸ªå¾ˆå¥½çš„æ¶ˆæ¯é˜Ÿåˆ—å¹³å°æ¥ä½¿ç”¨ã€‚Redisä½œä¸ºé˜Ÿåˆ—ä½¿ç”¨çš„æ“ä½œï¼Œå°±ç±»ä¼¼äºæœ¬åœ°ç¨‹åºè¯­è¨€ï¼ˆå¦‚Pythonï¼‰å¯¹ list çš„ push/pop æ“ä½œã€‚</p><p>å¦‚æœä½ å¿«é€Ÿçš„åœ¨Googleä¸­æœç´¢â€œRedis queuesâ€ï¼Œä½ é©¬ä¸Šå°±èƒ½æ‰¾åˆ°å¤§é‡çš„å¼€æºé¡¹ç›®ï¼Œè¿™äº›é¡¹ç›®çš„ç›®çš„å°±æ˜¯åˆ©ç”¨Redisåˆ›å»ºéå¸¸å¥½çš„åç«¯å·¥å…·ï¼Œä»¥æ»¡è¶³å„ç§é˜Ÿåˆ—éœ€æ±‚ã€‚ä¾‹å¦‚ï¼ŒCeleryæœ‰ä¸€ä¸ªåå°å°±æ˜¯ä½¿ç”¨Redisä½œä¸ºbrokerï¼Œä½ å¯ä»¥ä»è¿™é‡Œå»æŸ¥çœ‹ã€‚</p><h4 id="æ’è¡Œæ¦œ-è®¡æ•°å™¨"><a href="#æ’è¡Œæ¦œ-è®¡æ•°å™¨" class="headerlink" title="æ’è¡Œæ¦œ/è®¡æ•°å™¨"></a><strong>æ’è¡Œæ¦œ/è®¡æ•°å™¨</strong></h4><p>Redisåœ¨å†…å­˜ä¸­å¯¹æ•°å­—è¿›è¡Œé€’å¢æˆ–é€’å‡çš„æ“ä½œå®ç°çš„éå¸¸å¥½ã€‚é›†åˆï¼ˆSetï¼‰å’Œæœ‰åºé›†åˆï¼ˆSorted Setï¼‰ä¹Ÿä½¿å¾—æˆ‘ä»¬åœ¨æ‰§è¡Œè¿™äº›æ“ä½œçš„æ—¶å€™å˜çš„éå¸¸ç®€å•ï¼ŒRedisåªæ˜¯æ­£å¥½æä¾›äº†è¿™ä¸¤ç§æ•°æ®ç»“æ„ã€‚</p><p>æ‰€ä»¥ï¼Œæˆ‘ä»¬è¦ä»æ’åºé›†åˆä¸­è·å–åˆ°æ’åæœ€é å‰çš„10ä¸ªç”¨æˆ·â€“æˆ‘ä»¬ç§°ä¹‹ä¸ºâ€œuser_scoresâ€ï¼Œæˆ‘ä»¬åªéœ€è¦åƒä¸‹é¢ä¸€æ ·æ‰§è¡Œå³å¯ï¼š</p><p>å½“ç„¶ï¼Œè¿™æ˜¯å‡å®šä½ æ˜¯æ ¹æ®ä½ ç”¨æˆ·çš„åˆ†æ•°åšé€’å¢çš„æ’åºã€‚å¦‚æœä½ æƒ³è¿”å›ç”¨æˆ·åŠç”¨æˆ·çš„åˆ†æ•°ï¼Œä½ éœ€è¦è¿™æ ·æ‰§è¡Œï¼š</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ZRANGE user_scores 0 10 WITHSCORES</span><br></pre></td></tr></table></figure><p>Agora Gameså°±æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„ä¾‹å­ï¼Œç”¨Rubyå®ç°çš„ï¼Œå®ƒçš„æ’è¡Œæ¦œå°±æ˜¯ä½¿ç”¨Redisæ¥å­˜å‚¨æ•°æ®çš„ï¼Œä½ å¯ä»¥åœ¨è¿™é‡Œçœ‹åˆ°ã€‚</p><h4 id="å‘å¸ƒ-è®¢é˜…"><a href="#å‘å¸ƒ-è®¢é˜…" class="headerlink" title="å‘å¸ƒ/è®¢é˜…"></a><strong>å‘å¸ƒ/è®¢é˜…</strong></h4><p>æœ€åï¼ˆä½†è‚¯å®šä¸æ˜¯æœ€ä¸é‡è¦çš„ï¼‰æ˜¯Redisçš„å‘å¸ƒ/è®¢é˜…åŠŸèƒ½ã€‚å‘å¸ƒ/è®¢é˜…çš„ä½¿ç”¨åœºæ™¯ç¡®å®éå¸¸å¤šã€‚æˆ‘å·²çœ‹è§äººä»¬åœ¨ç¤¾äº¤ç½‘ç»œè¿æ¥ä¸­ä½¿ç”¨ï¼Œè¿˜å¯ä½œä¸ºåŸºäºå‘å¸ƒ/è®¢é˜…çš„è„šæœ¬è§¦å‘å™¨ï¼Œç”šè‡³ç”¨Redisçš„å‘å¸ƒ/è®¢é˜…åŠŸèƒ½æ¥å»ºç«‹èŠå¤©ç³»ç»Ÿï¼</p><p>Redisæä¾›çš„æ‰€æœ‰ç‰¹æ€§ä¸­ï¼Œæˆ‘æ„Ÿè§‰è¿™ä¸ªæ˜¯å–œæ¬¢çš„äººæœ€å°‘çš„ä¸€ä¸ªï¼Œè™½ç„¶å®ƒä¸ºç”¨æˆ·æä¾›å¦‚æœæ­¤å¤šåŠŸèƒ½ã€‚</p><h3 id="å‚è€ƒæ–‡çŒ®"><a href="#å‚è€ƒæ–‡çŒ®" class="headerlink" title="å‚è€ƒæ–‡çŒ®"></a>å‚è€ƒæ–‡çŒ®</h3><ul><li><a href="https://juejin.im/entry/5b7cfe976fb9a01a13366d95?utm_source=gold_browser_extension">https://juejin.im/entry/5b7cfe976fb9a01a13366d95?utm_source=gold_browser_extension</a></li><li><a href="https://mp.weixin.qq.com/s?__biz=MzI4Njc5NjM1NQ==&mid=2247486252&idx=1&sn=d72ee144765b3b16964dc4ce0f54ccd7&chksm=ebd63400dca1bd16fada25e175c052fc7528f85750d2e0c4bfd9bd561c8aa49fe019f32c21ae&mpshare=1&scene=24&srcid=09020vky9fT4UYZG8JpeePdz#rd">Redisçš„é‚£äº›æœ€å¸¸è§é¢è¯•é—®é¢˜</a></li><li><a href="https://www.cnblogs.com/whcwkw1314/p/8922031.html">javaä¸­Redis5å¤§åŸºæœ¬ç±»å‹çš„ç”¨æ³•</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®°æœ¬ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> Redis </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Springäº‹åŠ¡ç®¡ç†</title>
      <link href="post/762945f0/"/>
      <url>post/762945f0/</url>
      
        <content type="html"><![CDATA[<blockquote><p>äº‹åŠ¡æ˜¯é€»è¾‘ä¸Šçš„ä¸€ç»„æ“ä½œï¼Œè¦ä¹ˆéƒ½æ‰§è¡Œï¼Œè¦ä¹ˆéƒ½ä¸æ‰§è¡Œ.</p></blockquote><h3 id="äº‹åŠ¡çš„ç‰¹æ€§-ACID"><a href="#äº‹åŠ¡çš„ç‰¹æ€§-ACID" class="headerlink" title="äº‹åŠ¡çš„ç‰¹æ€§(ACID)"></a>äº‹åŠ¡çš„ç‰¹æ€§(ACID)</h3><p><img src="https://github.com/cayzlh/git-img-repository/raw/master/blog/2018090301/1.png" alt="ACID"></p><p><strong>åŸå­æ€§ï¼š</strong> äº‹åŠ¡æ˜¯æœ€å°çš„æ‰§è¡Œå•ä½ï¼Œä¸å…è®¸åˆ†å‰²ã€‚äº‹åŠ¡çš„åŸå­æ€§ç¡®ä¿åŠ¨ä½œè¦ä¹ˆå…¨éƒ¨å®Œæˆï¼Œè¦ä¹ˆå®Œå…¨ä¸èµ·ä½œç”¨ï¼›</p><p><strong>ä¸€è‡´æ€§ï¼š</strong> æ‰§è¡Œäº‹åŠ¡å‰åï¼Œæ•°æ®ä¿æŒä¸€è‡´ï¼›</p><p><strong>éš”ç¦»æ€§ï¼š</strong> å¹¶å‘è®¿é—®æ•°æ®åº“æ—¶ï¼Œä¸€ä¸ªç”¨æˆ·çš„äº‹ç‰©ä¸è¢«å…¶ä»–äº‹ç‰©æ‰€å¹²æ‰°ï¼Œå„å¹¶å‘äº‹åŠ¡ä¹‹é—´æ•°æ®åº“æ˜¯ç‹¬ç«‹çš„ï¼›</p><p><strong>æŒä¹…æ€§:</strong>  ä¸€ä¸ªäº‹åŠ¡è¢«æäº¤ä¹‹åã€‚å®ƒå¯¹æ•°æ®åº“ä¸­æ•°æ®çš„æ”¹å˜æ˜¯æŒä¹…çš„ï¼Œå³ä½¿æ•°æ®åº“å‘ç”Ÿæ•…éšœä¹Ÿä¸åº”è¯¥å¯¹å…¶æœ‰ä»»ä½•å½±å“ã€‚</p><h3 id="Springäº‹åŠ¡ç®¡ç†æ¥å£"><a href="#Springäº‹åŠ¡ç®¡ç†æ¥å£" class="headerlink" title="Springäº‹åŠ¡ç®¡ç†æ¥å£"></a>Springäº‹åŠ¡ç®¡ç†æ¥å£</h3><h4 id="PlatformTransactionManagerï¼š-ï¼ˆå¹³å°ï¼‰äº‹åŠ¡ç®¡ç†å™¨"><a href="#PlatformTransactionManagerï¼š-ï¼ˆå¹³å°ï¼‰äº‹åŠ¡ç®¡ç†å™¨" class="headerlink" title="PlatformTransactionManagerï¼š ï¼ˆå¹³å°ï¼‰äº‹åŠ¡ç®¡ç†å™¨"></a><strong>PlatformTransactionManagerï¼š</strong> ï¼ˆå¹³å°ï¼‰äº‹åŠ¡ç®¡ç†å™¨</h4><p><strong>Springå¹¶ä¸ç›´æ¥ç®¡ç†äº‹åŠ¡ï¼Œè€Œæ˜¯æä¾›äº†å¤šç§äº‹åŠ¡ç®¡ç†å™¨</strong> ï¼Œä»–ä»¬å°†äº‹åŠ¡ç®¡ç†çš„èŒè´£å§”æ‰˜ç»™Hibernateæˆ–è€…JTAç­‰æŒä¹…åŒ–æœºåˆ¶æ‰€æä¾›çš„ç›¸å…³å¹³å°æ¡†æ¶çš„äº‹åŠ¡æ¥å®ç°ã€‚ Springäº‹åŠ¡ç®¡ç†å™¨çš„æ¥å£æ˜¯ï¼š <strong>org.springframework.transaction.PlatformTransactionManager</strong> ï¼Œé€šè¿‡è¿™ä¸ªæ¥å£ï¼ŒSpringä¸ºå„ä¸ªå¹³å°å¦‚JDBCã€Hibernateç­‰éƒ½æä¾›äº†å¯¹åº”çš„äº‹åŠ¡ç®¡ç†å™¨ï¼Œä½†æ˜¯å…·ä½“çš„å®ç°å°±æ˜¯å„ä¸ªå¹³å°è‡ªå·±çš„äº‹æƒ…äº†ã€‚</p><p>PlatformTransactionManageræ¥å£ä¸­å®šä¹‰äº†ä¸‰ä¸ªæ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function">Public interface <span class="title">PlatformTransactionManager</span><span class="params">()</span>...</span>&#123;  </span><br><span class="line">    <span class="comment">// Return a currently active transaction or create a new one, according to the specified propagation behaviorï¼ˆæ ¹æ®æŒ‡å®šçš„ä¼ æ’­è¡Œä¸ºï¼Œè¿”å›å½“å‰æ´»åŠ¨çš„äº‹åŠ¡æˆ–åˆ›å»ºä¸€ä¸ªæ–°äº‹åŠ¡ã€‚ï¼‰</span></span><br><span class="line">    <span class="function">TransactionStatus <span class="title">getTransaction</span><span class="params">(TransactionDefinition definition)</span> <span class="keyword">throws</span> TransactionException</span>; </span><br><span class="line">    <span class="comment">// Commit the given transaction, with regard to its statusï¼ˆä½¿ç”¨äº‹åŠ¡ç›®å‰çš„çŠ¶æ€æäº¤äº‹åŠ¡ï¼‰</span></span><br><span class="line">    <span class="function">Void <span class="title">commit</span><span class="params">(TransactionStatus status)</span> <span class="keyword">throws</span> TransactionException</span>;  </span><br><span class="line">    <span class="comment">// Perform a rollback of the given transactionï¼ˆå¯¹æ‰§è¡Œçš„äº‹åŠ¡è¿›è¡Œå›æ»šï¼‰</span></span><br><span class="line">    <span class="function">Void <span class="title">rollback</span><span class="params">(TransactionStatus status)</span> <span class="keyword">throws</span> TransactionException</span>;  </span><br><span class="line">    &#125; </span><br></pre></td></tr></table></figure><blockquote><p>Springä¸­PlatformTransactionManageræ ¹æ®ä¸åŒæŒä¹…å±‚æ¡†æ¶æ‰€å¯¹åº”çš„æ¥å£å®ç°ç±»</p></blockquote><p><img src="https://github.com/cayzlh/git-img-repository/raw/master/blog/2018090301/2.png" alt="ACID"></p><h4 id="TransactionDefinitionï¼š-äº‹åŠ¡å®šä¹‰ä¿¡æ¯-äº‹åŠ¡éš”ç¦»çº§åˆ«ã€ä¼ æ’­è¡Œä¸ºã€è¶…æ—¶ã€åªè¯»ã€å›æ»šè§„åˆ™"><a href="#TransactionDefinitionï¼š-äº‹åŠ¡å®šä¹‰ä¿¡æ¯-äº‹åŠ¡éš”ç¦»çº§åˆ«ã€ä¼ æ’­è¡Œä¸ºã€è¶…æ—¶ã€åªè¯»ã€å›æ»šè§„åˆ™" class="headerlink" title="TransactionDefinitionï¼š äº‹åŠ¡å®šä¹‰ä¿¡æ¯(äº‹åŠ¡éš”ç¦»çº§åˆ«ã€ä¼ æ’­è¡Œä¸ºã€è¶…æ—¶ã€åªè¯»ã€å›æ»šè§„åˆ™)"></a><strong>TransactionDefinitionï¼š</strong> äº‹åŠ¡å®šä¹‰ä¿¡æ¯(äº‹åŠ¡éš”ç¦»çº§åˆ«ã€ä¼ æ’­è¡Œä¸ºã€è¶…æ—¶ã€åªè¯»ã€å›æ»šè§„åˆ™)</h4><p>äº‹åŠ¡ç®¡ç†å™¨æ¥å£ <strong>PlatformTransactionManager</strong> é€šè¿‡ <strong>getTransaction(TransactionDefinition definition)</strong> æ–¹æ³•æ¥å¾—åˆ°ä¸€ä¸ªäº‹åŠ¡ï¼Œè¿™ä¸ªæ–¹æ³•é‡Œé¢çš„å‚æ•°æ˜¯ <strong>TransactionDefinitionç±»</strong> ï¼Œè¿™ä¸ªç±»å°±å®šä¹‰äº†ä¸€äº›åŸºæœ¬çš„äº‹åŠ¡å±æ€§ã€‚</p><p><strong>é‚£ä¹ˆä»€ä¹ˆæ˜¯äº‹åŠ¡å±æ€§å‘¢ï¼Ÿ</strong></p><p>äº‹åŠ¡å±æ€§å¯ä»¥ç†è§£æˆäº‹åŠ¡çš„ä¸€äº›åŸºæœ¬é…ç½®ï¼Œæè¿°äº†äº‹åŠ¡ç­–ç•¥å¦‚ä½•åº”ç”¨åˆ°æ–¹æ³•ä¸Šã€‚äº‹åŠ¡å±æ€§åŒ…å«äº†5ä¸ªæ–¹é¢ã€‚</p><p><img src="https://github.com/cayzlh/git-img-repository/raw/master/blog/2018090301/3.png" alt="ACID"></p><p>TransactionDefinitionæ¥å£ä¸­çš„æ–¹æ³•å¦‚ä¸‹ï¼š</p><p>TransactionDefinitionæ¥å£ä¸­å®šä¹‰äº†5ä¸ªæ–¹æ³•ä»¥åŠä¸€äº›è¡¨ç¤ºäº‹åŠ¡å±æ€§çš„å¸¸é‡æ¯”å¦‚éš”ç¦»çº§åˆ«ã€ä¼ æ’­è¡Œä¸ºç­‰ç­‰çš„å¸¸é‡ã€‚</p><p>æˆ‘ä¸‹é¢åªæ˜¯åˆ—å‡ºäº†TransactionDefinitionæ¥å£ä¸­çš„æ–¹æ³•è€Œæ²¡æœ‰ç»™å‡ºæ¥å£ä¸­å®šä¹‰çš„å¸¸é‡</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">TransactionDefinition</span> </span>&#123;</span><br><span class="line">    <span class="comment">// è¿”å›äº‹åŠ¡çš„ä¼ æ’­è¡Œä¸º</span></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">getPropagationBehavior</span><span class="params">()</span></span>; </span><br><span class="line">    <span class="comment">// è¿”å›äº‹åŠ¡çš„éš”ç¦»çº§åˆ«ï¼Œäº‹åŠ¡ç®¡ç†å™¨æ ¹æ®å®ƒæ¥æ§åˆ¶å¦å¤–ä¸€ä¸ªäº‹åŠ¡å¯ä»¥çœ‹åˆ°æœ¬äº‹åŠ¡å†…çš„å“ªäº›æ•°æ®</span></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">getIsolationLevel</span><span class="params">()</span></span>; </span><br><span class="line">    <span class="comment">// è¿”å›äº‹åŠ¡å¿…é¡»åœ¨å¤šå°‘ç§’å†…å®Œæˆ</span></span><br><span class="line">    <span class="comment">//è¿”å›äº‹åŠ¡çš„åå­—</span></span><br><span class="line">    <span class="function">String <span class="title">getName</span><span class="params">()</span>ï¼›</span></span><br><span class="line"><span class="function">    <span class="keyword">int</span> <span class="title">getTimeout</span><span class="params">()</span></span>;  </span><br><span class="line">    <span class="comment">// è¿”å›æ˜¯å¦ä¼˜åŒ–ä¸ºåªè¯»äº‹åŠ¡ã€‚</span></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">isReadOnly</span><span class="params">()</span></span>;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><h4 id="TransactionStatusï¼š-äº‹åŠ¡è¿è¡ŒçŠ¶æ€"><a href="#TransactionStatusï¼š-äº‹åŠ¡è¿è¡ŒçŠ¶æ€" class="headerlink" title="TransactionStatusï¼š äº‹åŠ¡è¿è¡ŒçŠ¶æ€"></a><strong>TransactionStatusï¼š</strong> äº‹åŠ¡è¿è¡ŒçŠ¶æ€</h4><p>TransactionStatusæ¥å£ç”¨æ¥è®°å½•äº‹åŠ¡çš„çŠ¶æ€ è¯¥æ¥å£å®šä¹‰äº†ä¸€ç»„æ–¹æ³•,ç”¨æ¥è·å–æˆ–åˆ¤æ–­äº‹åŠ¡çš„ç›¸åº”çŠ¶æ€ä¿¡æ¯.</p><p>PlatformTransactionManager.getTransaction(â€¦) æ–¹æ³•è¿”å›ä¸€ä¸ª TransactionStatus å¯¹è±¡ã€‚è¿”å›çš„TransactionStatus å¯¹è±¡å¯èƒ½ä»£è¡¨ä¸€ä¸ªæ–°çš„æˆ–å·²ç»å­˜åœ¨çš„äº‹åŠ¡ï¼ˆå¦‚æœåœ¨å½“å‰è°ƒç”¨å †æ ˆæœ‰ä¸€ä¸ªç¬¦åˆæ¡ä»¶çš„äº‹åŠ¡ï¼‰ã€‚</p><p>TransactionStatusæ¥å£æ¥å£å†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">TransactionStatus</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">isNewTransaction</span><span class="params">()</span></span>; <span class="comment">// æ˜¯å¦æ˜¯æ–°çš„äº‹ç‰©</span></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">hasSavepoint</span><span class="params">()</span></span>; <span class="comment">// æ˜¯å¦æœ‰æ¢å¤ç‚¹</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">setRollbackOnly</span><span class="params">()</span></span>;  <span class="comment">// è®¾ç½®ä¸ºåªå›æ»š</span></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">isRollbackOnly</span><span class="params">()</span></span>; <span class="comment">// æ˜¯å¦ä¸ºåªå›æ»š</span></span><br><span class="line">    <span class="keyword">boolean</span> isCompleted; <span class="comment">// æ˜¯å¦å·²å®Œæˆ</span></span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><p><strong>æ‰€è°“äº‹åŠ¡ç®¡ç†ï¼Œå…¶å®å°±æ˜¯â€œæŒ‰ç…§ç»™å®šçš„äº‹åŠ¡è§„åˆ™æ¥æ‰§è¡Œæäº¤æˆ–è€…å›æ»šæ“ä½œâ€</strong>ã€‚</p><h3 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" class="headerlink" title="å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h3><ul><li><a href="https://juejin.im/post/5b00c52ef265da0b95276091">https://juejin.im/post/5b00c52ef265da0b95276091</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹æŠ€æœ¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> è½¬è½½ </tag>
            
            <tag> Spring </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>volatile</title>
      <link href="post/fe4c9cb6/"/>
      <url>post/fe4c9cb6/</url>
      
        <content type="html"><![CDATA[<h3 id="volatileçš„ç”¨æ³•"><a href="#volatileçš„ç”¨æ³•" class="headerlink" title="volatileçš„ç”¨æ³•"></a>volatileçš„ç”¨æ³•</h3><p><code>volatile</code>é€šå¸¸è¢«æ¯”å–»æˆâ€è½»é‡çº§çš„<code>synchronized</code>â€œï¼Œä¹Ÿæ˜¯Javaå¹¶å‘ç¼–ç¨‹ä¸­æ¯”è¾ƒé‡è¦çš„ä¸€ä¸ªå…³é”®å­—ã€‚å’Œ<code>synchronized</code>ä¸åŒï¼Œ<code>volatile</code>æ˜¯ä¸€ä¸ªå˜é‡ä¿®é¥°ç¬¦ï¼Œåªèƒ½ç”¨æ¥ä¿®é¥°å˜é‡ã€‚æ— æ³•ä¿®é¥°æ–¹æ³•åŠä»£ç å—ç­‰ã€‚</p><p><code>volatile</code>çš„ç”¨æ³•æ¯”è¾ƒç®€å•ï¼Œåªéœ€è¦åœ¨å£°æ˜ä¸€ä¸ªå¯èƒ½è¢«å¤šçº¿ç¨‹åŒæ—¶è®¿é—®çš„å˜é‡æ—¶ï¼Œä½¿ç”¨<code>volatile</code>ä¿®é¥°å°±å¯ä»¥äº†ã€‚</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Singleton</span> </span>&#123;  </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">volatile</span> <span class="keyword">static</span> Singleton singleton;  </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Singleton</span> <span class="params">()</span></span>&#123;&#125;  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Singleton <span class="title">getSingleton</span><span class="params">()</span> </span>&#123;  </span><br><span class="line">    <span class="keyword">if</span> (singleton == <span class="keyword">null</span>) &#123;  </span><br><span class="line">        <span class="keyword">synchronized</span> (Singleton.class) &#123;  </span><br><span class="line">        <span class="keyword">if</span> (singleton == <span class="keyword">null</span>) &#123;  </span><br><span class="line">            singleton = <span class="keyword">new</span> Singleton();  </span><br><span class="line">        &#125;  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">return</span> singleton;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br></pre></td></tr></table></figure><p>å¦‚ä»¥ä¸Šä»£ç ï¼Œæ˜¯ä¸€ä¸ªæ¯”è¾ƒå…¸å‹çš„ä½¿ç”¨åŒé‡é”æ ¡éªŒçš„å½¢å¼å®ç°å•ä¾‹çš„ï¼Œå…¶ä¸­ä½¿ç”¨<code>volatile</code>å…³é”®å­—ä¿®é¥°å¯èƒ½è¢«å¤šä¸ªçº¿ç¨‹åŒæ—¶è®¿é—®åˆ°çš„singletonã€‚</p><h3 id="volatileçš„åŸç†"><a href="#volatileçš„åŸç†" class="headerlink" title="volatileçš„åŸç†"></a>volatileçš„åŸç†</h3><blockquote><p>ä¸ºäº†æé«˜å¤„ç†å™¨çš„æ‰§è¡Œé€Ÿåº¦ï¼Œåœ¨å¤„ç†å™¨å’Œå†…å­˜ä¹‹é—´å¢åŠ äº†å¤šçº§ç¼“å­˜æ¥æå‡ã€‚ä½†æ˜¯ç”±äºå¼•å…¥äº†å¤šçº§ç¼“å­˜ï¼Œå°±å­˜åœ¨ç¼“å­˜æ•°æ®ä¸ä¸€è‡´é—®é¢˜ã€‚</p><p>ä½†æ˜¯ï¼Œå¯¹äº<code>volatile</code>å˜é‡ï¼Œå½“å¯¹<code>volatile</code>å˜é‡è¿›è¡Œå†™æ“ä½œçš„æ—¶å€™ï¼ŒJVMä¼šå‘å¤„ç†å™¨å‘é€ä¸€æ¡lockå‰ç¼€çš„æŒ‡ä»¤ï¼Œå°†è¿™ä¸ªç¼“å­˜ä¸­çš„å˜é‡å›å†™åˆ°ç³»ç»Ÿä¸»å­˜ä¸­ã€‚</p><p>ä½†æ˜¯å°±ç®—å†™å›åˆ°å†…å­˜ï¼Œå¦‚æœå…¶ä»–å¤„ç†å™¨ç¼“å­˜çš„å€¼è¿˜æ˜¯æ—§çš„ï¼Œå†æ‰§è¡Œè®¡ç®—æ“ä½œå°±ä¼šæœ‰é—®é¢˜ï¼Œæ‰€ä»¥åœ¨å¤šå¤„ç†å™¨ä¸‹ï¼Œä¸ºäº†ä¿è¯å„ä¸ªå¤„ç†å™¨çš„ç¼“å­˜æ˜¯ä¸€è‡´çš„ï¼Œå°±ä¼šå®ç°<code>ç¼“å­˜ä¸€è‡´æ€§åè®®</code></p></blockquote><h4 id="ç¼“å­˜ä¸€è‡´æ€§åè®®"><a href="#ç¼“å­˜ä¸€è‡´æ€§åè®®" class="headerlink" title="ç¼“å­˜ä¸€è‡´æ€§åè®®"></a>ç¼“å­˜ä¸€è‡´æ€§åè®®</h4><p>æ¯ä¸ªå¤„ç†å™¨é€šè¿‡å—…æ¢åœ¨æ€»çº¿ä¸Šä¼ æ’­çš„æ•°æ®æ¥æ£€æŸ¥è‡ªå·±ç¼“å­˜çš„å€¼æ˜¯ä¸æ˜¯è¿‡æœŸäº†ï¼Œå½“å¤„ç†å™¨å‘ç°è‡ªå·±ç¼“å­˜è¡Œå¯¹åº”çš„å†…å­˜åœ°å€è¢«ä¿®æ”¹ï¼Œå°±ä¼šå°†å½“å‰å¤„ç†å™¨çš„ç¼“å­˜è¡Œè®¾ç½®æˆæ— æ•ˆçŠ¶æ€ï¼Œå½“å¤„ç†å™¨è¦å¯¹è¿™ä¸ªæ•°æ®è¿›è¡Œä¿®æ”¹æ“ä½œçš„æ—¶å€™ï¼Œä¼šå¼ºåˆ¶é‡æ–°ä»ç³»ç»Ÿå†…å­˜é‡ŒæŠŠæ•°æ®è¯»åˆ°å¤„ç†å™¨ç¼“å­˜é‡Œã€‚</p><p>æ‰€ä»¥ï¼Œå¦‚æœä¸€ä¸ªå˜é‡è¢«<code>volatile</code>æ‰€ä¿®é¥°çš„è¯ï¼Œåœ¨æ¯æ¬¡æ•°æ®å˜åŒ–ä¹‹åï¼Œå…¶å€¼éƒ½ä¼šè¢«å¼ºåˆ¶åˆ·å…¥ä¸»å­˜ã€‚è€Œå…¶ä»–å¤„ç†å™¨çš„ç¼“å­˜ç”±äºéµå®ˆäº†ç¼“å­˜ä¸€è‡´æ€§åè®®ï¼Œä¹Ÿä¼šæŠŠè¿™ä¸ªå˜é‡çš„å€¼ä»ä¸»å­˜åŠ è½½åˆ°è‡ªå·±çš„ç¼“å­˜ä¸­ã€‚è¿™å°±ä¿è¯äº†ä¸€ä¸ª<code>volatile</code>åœ¨å¹¶å‘ç¼–ç¨‹ä¸­ï¼Œå…¶å€¼åœ¨å¤šä¸ªç¼“å­˜ä¸­æ˜¯å¯è§çš„ã€‚</p><h3 id="volatileä¸å¯è§æ€§"><a href="#volatileä¸å¯è§æ€§" class="headerlink" title="volatileä¸å¯è§æ€§"></a>volatileä¸å¯è§æ€§</h3><p><strong>å¯è§æ€§æ˜¯æŒ‡å½“å¤šä¸ªçº¿ç¨‹è®¿é—®åŒä¸€ä¸ªå˜é‡æ—¶ï¼Œä¸€ä¸ªçº¿ç¨‹ä¿®æ”¹äº†è¿™ä¸ªå˜é‡çš„å€¼ï¼Œå…¶ä»–çº¿ç¨‹èƒ½å¤Ÿç«‹å³çœ‹å¾—åˆ°ä¿®æ”¹çš„å€¼ã€‚</strong></p><p><a href="https://blog.cayzlh.com/2018/08/28/2018082801/">Javaå†…å­˜æ¨¡å‹</a>è§„å®šäº†æ‰€æœ‰çš„å˜é‡éƒ½å­˜å‚¨åœ¨ä¸»å†…å­˜ä¸­ï¼Œæ¯æ¡çº¿ç¨‹è¿˜æœ‰è‡ªå·±çš„å·¥ä½œå†…å­˜ï¼Œçº¿ç¨‹çš„å·¥ä½œå†…å­˜ä¸­ä¿å­˜äº†è¯¥çº¿ç¨‹ä¸­æ˜¯ç”¨åˆ°çš„å˜é‡çš„ä¸»å†…å­˜å‰¯æœ¬æ‹·è´ï¼Œçº¿ç¨‹å¯¹å˜é‡çš„æ‰€æœ‰æ“ä½œéƒ½å¿…é¡»åœ¨å·¥ä½œå†…å­˜ä¸­è¿›è¡Œï¼Œè€Œä¸èƒ½ç›´æ¥è¯»å†™ä¸»å†…å­˜ã€‚ä¸åŒçš„çº¿ç¨‹ä¹‹é—´ä¹Ÿæ— æ³•ç›´æ¥è®¿é—®å¯¹æ–¹å·¥ä½œå†…å­˜ä¸­çš„å˜é‡ï¼Œçº¿ç¨‹é—´å˜é‡çš„ä¼ é€’å‡éœ€è¦è‡ªå·±çš„å·¥ä½œå†…å­˜å’Œä¸»å­˜ä¹‹é—´è¿›è¡Œæ•°æ®åŒæ­¥è¿›è¡Œã€‚æ‰€ä»¥ï¼Œå°±å¯èƒ½å‡ºç°çº¿ç¨‹1æ”¹äº†æŸä¸ªå˜é‡çš„å€¼ï¼Œä½†æ˜¯çº¿ç¨‹2ä¸å¯è§çš„æƒ…å†µã€‚</p><blockquote><p>Javaä¸­çš„<code>volatile</code>å…³é”®å­—æä¾›äº†ä¸€ä¸ªåŠŸèƒ½ï¼Œé‚£å°±æ˜¯è¢«å…¶ä¿®é¥°çš„å˜é‡åœ¨è¢«ä¿®æ”¹åå¯ä»¥ç«‹å³åŒæ­¥åˆ°ä¸»å†…å­˜ï¼Œè¢«å…¶ä¿®é¥°çš„å˜é‡åœ¨æ¯æ¬¡æ˜¯ç”¨ä¹‹å‰éƒ½ä»ä¸»å†…å­˜åˆ·æ–°ã€‚å› æ­¤ï¼Œå¯ä»¥ä½¿ç”¨<code>volatile</code>æ¥ä¿è¯å¤šçº¿ç¨‹æ“ä½œæ—¶å˜é‡çš„å¯è§æ€§ã€‚</p></blockquote><p>volatileå¯¹äºå¯è§æ€§çš„å®ç°ï¼Œ<strong>å†…å­˜å±éšœ</strong>ä¹Ÿèµ·ç€è‡³å…³é‡è¦çš„ä½œç”¨ã€‚å› ä¸ºå†…å­˜å±éšœç›¸å½“äºä¸€ä¸ªæ•°æ®åŒæ­¥ç‚¹ï¼Œä»–è¦ä¿è¯åœ¨è¿™ä¸ªåŒæ­¥ç‚¹ä¹‹åçš„è¯»å†™æ“ä½œå¿…é¡»åœ¨è¿™ä¸ªç‚¹ä¹‹å‰çš„è¯»å†™æ“ä½œéƒ½æ‰§è¡Œå®Œä¹‹åæ‰å¯ä»¥æ‰§è¡Œã€‚å¹¶ä¸”åœ¨é‡åˆ°å†…å­˜å±éšœçš„æ—¶å€™ï¼Œç¼“å­˜æ•°æ®ä¼šå’Œä¸»å­˜è¿›è¡ŒåŒæ­¥ï¼Œæˆ–è€…æŠŠç¼“å­˜æ•°æ®å†™å…¥ä¸»å­˜ã€æˆ–è€…ä»ä¸»å­˜æŠŠæ•°æ®è¯»å–åˆ°ç¼“å­˜ã€‚</p><p><em>å†…å­˜ä¸€è‡´æ€§æ¨¡å‹çš„å®ç°å¯ä»¥é€šè¿‡ç¼“å­˜ä¸€è‡´æ€§åè®®æ¥å®ç°ã€‚åŒæ—¶ï¼Œç•™äº†ä¸€ä¸ªé—®é¢˜ï¼šå·²ç»æœ‰äº†ç¼“å­˜ä¸€è‡´æ€§åè®®ï¼Œä¸ºä»€ä¹ˆè¿˜éœ€è¦volatileï¼Ÿ</em></p><blockquote><p>1ã€å¹¶ä¸æ˜¯æ‰€æœ‰çš„ç¡¬ä»¶æ¶æ„éƒ½æä¾›äº†ç›¸åŒçš„ä¸€è‡´æ€§ä¿è¯ï¼ŒJavaä½œä¸ºä¸€é—¨è·¨å¹³å°è¯­è¨€ï¼ŒJVMéœ€è¦æä¾›ä¸€ä¸ªç»Ÿä¸€çš„è¯­ä¹‰ã€‚</p><p>2ã€æ“ä½œç³»ç»Ÿä¸­çš„ç¼“å­˜å’ŒJVMä¸­çº¿ç¨‹çš„æœ¬åœ°å†…å­˜å¹¶ä¸æ˜¯ä¸€å›äº‹ï¼Œé€šå¸¸æˆ‘ä»¬å¯ä»¥è®¤ä¸ºï¼šMESIå¯ä»¥è§£å†³ç¼“å­˜å±‚é¢çš„å¯è§æ€§é—®é¢˜ã€‚ä½¿ç”¨volatileå…³é”®å­—ï¼Œå¯ä»¥è§£å†³JVMå±‚é¢çš„å¯è§æ€§é—®é¢˜ã€‚</p><p>3ã€ç¼“å­˜å¯è§æ€§é—®é¢˜çš„å»¶ä¼¸ï¼šç”±äºä¼ ç»Ÿçš„MESIåè®®çš„æ‰§è¡Œæˆæœ¬æ¯”è¾ƒå¤§ã€‚æ‰€ä»¥CPUé€šè¿‡Store Bufferå’ŒInvalidate Queueç»„ä»¶æ¥è§£å†³ï¼Œä½†æ˜¯ç”±äºè¿™ä¸¤ä¸ªç»„ä»¶çš„å¼•å…¥ï¼Œä¹Ÿå¯¼è‡´ç¼“å­˜å’Œä¸»å­˜ä¹‹é—´çš„é€šä¿¡å¹¶ä¸æ˜¯å®æ—¶çš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œ<strong>ç¼“å­˜ä¸€è‡´æ€§æ¨¡å‹åªèƒ½ä¿è¯ç¼“å­˜å˜æ›´å¯ä»¥ä¿è¯å…¶ä»–ç¼“å­˜ä¹Ÿè·Ÿç€æ”¹å˜ï¼Œä½†æ˜¯ä¸èƒ½ä¿è¯ç«‹åˆ»ã€é©¬ä¸Šæ‰§è¡Œã€‚</strong></p></blockquote><p><em>å†™å†…å­˜å±éšœï¼ˆStore Memory Barrierï¼‰</em>å¯ä»¥ä¿ƒä½¿å¤„ç†å™¨å°†å½“å‰store bufferï¼ˆå­˜å‚¨ç¼“å­˜ï¼‰çš„å€¼å†™å›ä¸»å­˜ã€‚</p><p><em>è¯»å†…å­˜å±éšœï¼ˆLoad Memory Barrierï¼‰</em>å¯ä»¥ä¿ƒä½¿å¤„ç†å™¨å¤„ç†invalidate queueï¼ˆå¤±æ•ˆé˜Ÿåˆ—ï¼‰ã€‚</p><p><strong>æ‰€ä»¥ï¼Œå†…å­˜å±éšœä¹Ÿæ˜¯ä¿è¯å¯è§æ€§çš„é‡è¦æ‰‹æ®µï¼Œæ“ä½œç³»ç»Ÿé€šè¿‡å†…å­˜å±éšœä¿è¯ç¼“å­˜é—´çš„å¯è§æ€§ï¼ŒJVMé€šè¿‡ç»™volatileå˜é‡åŠ å…¥å†…å­˜å±éšœä¿è¯çº¿ç¨‹ä¹‹é—´çš„å¯è§æ€§ã€‚</strong>è¿›è€Œé¿å…ç”±äºStore Bufferå’ŒInvalidate Queueçš„éå®æ—¶æ€§å¸¦æ¥çš„é—®é¢˜ã€‚</p><h4 id="å†…å­˜å±éšœ"><a href="#å†…å­˜å±éšœ" class="headerlink" title="å†…å­˜å±éšœ"></a>å†…å­˜å±éšœ</h4><p>Javaä¸­çš„å†…å­˜å±éšœï¼šç”¨äºæ§åˆ¶ç‰¹å®šæ¡ä»¶ä¸‹çš„é‡æ’åºå’Œå†…å­˜å¯è§æ€§é—®é¢˜ã€‚Javaç¼–è¯‘å™¨ä¹Ÿä¼šæ ¹æ®å†…å­˜å±éšœçš„è§„åˆ™ç¦æ­¢é‡æ’åºã€‚</p><h3 id="volatileä¸æœ‰åºæ€§"><a href="#volatileä¸æœ‰åºæ€§" class="headerlink" title="volatileä¸æœ‰åºæ€§"></a>volatileä¸æœ‰åºæ€§</h3><blockquote><p>æœ‰åºæ€§å³ç¨‹åºæ‰§è¡Œçš„é¡ºåºæŒ‰ç…§ä»£ç çš„å…ˆåé¡ºåºæ‰§è¡Œã€‚ </p></blockquote><p><a href="https://blog.cayzlh.com/2018/08/28/2018082801/">é™¤äº†å¼•å…¥äº†æ—¶é—´ç‰‡ä»¥å¤–ï¼Œç”±äºå¤„ç†å™¨ä¼˜åŒ–å’ŒæŒ‡ä»¤é‡æ’ç­‰ï¼ŒCPUè¿˜å¯èƒ½å¯¹è¾“å…¥ä»£ç è¿›è¡Œä¹±åºæ‰§è¡Œï¼Œæ¯”å¦‚<code>load-&gt;add-&gt;save</code> æœ‰å¯èƒ½è¢«ä¼˜åŒ–æˆ<code>load-&gt;save-&gt;add</code> ã€‚è¿™å°±æ˜¯å¯èƒ½å­˜åœ¨æœ‰åºæ€§é—®é¢˜</a>ã€‚</p><p>è€Œ<code>volatile</code>é™¤äº†å¯ä»¥ä¿è¯æ•°æ®çš„å¯è§æ€§ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªå¼ºå¤§çš„åŠŸèƒ½ï¼Œé‚£å°±æ˜¯ä»–å¯ä»¥<strong>ç¦æ­¢æŒ‡ä»¤é‡æ’ä¼˜åŒ–</strong>ç­‰ã€‚</p><p>æ™®é€šçš„å˜é‡ä»…ä»…ä¼šä¿è¯åœ¨è¯¥æ–¹æ³•çš„æ‰§è¡Œè¿‡ç¨‹ä¸­æ‰€ä¾èµ–çš„èµ‹å€¼ç»“æœçš„åœ°æ–¹éƒ½èƒ½è·å¾—æ­£ç¡®çš„ç»“æœï¼Œè€Œä¸èƒ½ä¿è¯å˜é‡çš„èµ‹å€¼æ“ä½œçš„é¡ºåºä¸ç¨‹åºä»£ç ä¸­çš„æ‰§è¡Œé¡ºåºä¸€è‡´ã€‚</p><p>volatileå¯ä»¥ç¦æ­¢æŒ‡ä»¤é‡æ’ï¼Œè¿™å°±ä¿è¯äº†ä»£ç çš„ç¨‹åºä¼šä¸¥æ ¼æŒ‰ç…§ä»£ç çš„å…ˆåé¡ºåºæ‰§è¡Œã€‚è¿™å°±ä¿è¯äº†æœ‰åºæ€§ã€‚è¢«<code>volatile</code>ä¿®é¥°çš„å˜é‡çš„æ“ä½œï¼Œä¼šä¸¥æ ¼æŒ‰ç…§ä»£ç é¡ºåºæ‰§è¡Œï¼Œ<code>load-&gt;add-&gt;save</code> çš„æ‰§è¡Œé¡ºåºå°±æ˜¯ï¼šloadã€addã€saveã€‚</p><p><strong>volatileæ˜¯é€šè¿‡<em>å†…å­˜å±éšœ</em>æ¥æ¥ç¦æ­¢æŒ‡ä»¤é‡æ’çš„ã€‚</strong></p><p><strong>å†…å­˜å±éšœï¼ˆMemory Barrierï¼‰</strong>æ˜¯ä¸€ç±»åŒæ­¥å±éšœæŒ‡ä»¤ï¼Œæ˜¯CPUæˆ–ç¼–è¯‘å™¨åœ¨å¯¹å†…å­˜éšæœºè®¿é—®çš„æ“ä½œä¸­çš„ä¸€ä¸ªåŒæ­¥ç‚¹ï¼Œä½¿å¾—æ­¤ç‚¹ä¹‹å‰çš„æ‰€æœ‰è¯»å†™æ“ä½œéƒ½æ‰§è¡Œåæ‰å¯ä»¥å¼€å§‹æ‰§è¡Œæ­¤ç‚¹ä¹‹åçš„æ“ä½œã€‚ä¸‹è¡¨æè¿°äº†å’Œvolatileæœ‰å…³çš„æŒ‡ä»¤é‡æ’ç¦æ­¢è¡Œä¸ºï¼š</p><p><img src="https://github.com/cayzlh/git-img-repository/raw/master/blog/2018083001/1.png" alt="å†…å­˜å±éšœ"></p><p>å¯ä»¥çœ‹å‡ºï¼š</p><blockquote><p>å½“ç¬¬äºŒä¸ªæ“ä½œæ˜¯volatileå†™æ—¶ï¼Œä¸ç®¡ç¬¬ä¸€ä¸ªæ“ä½œæ˜¯ä»€ä¹ˆï¼Œéƒ½ä¸èƒ½é‡æ’åºã€‚è¿™ä¸ªè§„åˆ™ç¡®ä¿volatileå†™ä¹‹å‰çš„æ“ä½œä¸ä¼šè¢«ç¼–è¯‘å™¨é‡æ’åºåˆ°volatileå†™ä¹‹åã€‚</p><p>å½“ç¬¬ä¸€ä¸ªæ“ä½œæ˜¯volatileè¯»æ—¶ï¼Œä¸ç®¡ç¬¬äºŒä¸ªæ“ä½œæ˜¯ä»€ä¹ˆï¼Œéƒ½ä¸èƒ½é‡æ’åºã€‚è¿™ä¸ªè§„åˆ™ç¡®ä¿volatileè¯»ä¹‹åçš„æ“ä½œä¸ä¼šè¢«ç¼–è¯‘å™¨é‡æ’åºåˆ°volatileè¯»ä¹‹å‰ã€‚</p><p>å½“ç¬¬ä¸€ä¸ªæ“ä½œæ˜¯volatileå†™ï¼Œç¬¬äºŒä¸ªæ“ä½œæ˜¯volatileè¯»æ—¶ï¼Œä¸èƒ½é‡æ’åºã€‚</p></blockquote><p>å…·ä½“å®ç°æ–¹å¼æ˜¯åœ¨ç¼–è¯‘æœŸç”Ÿæˆå­—èŠ‚ç æ—¶ï¼Œä¼šåœ¨æŒ‡ä»¤åºåˆ—ä¸­å¢åŠ å†…å­˜å±éšœæ¥ä¿è¯ï¼Œä¸‹é¢æ˜¯åŸºäºä¿å®ˆç­–ç•¥çš„JMMå†…å­˜å±éšœæ’å…¥ç­–ç•¥ï¼š</p><ul><li><p>åœ¨æ¯ä¸ªvolatileå†™æ“ä½œçš„å‰é¢æ’å…¥ä¸€ä¸ª<code>StoreStore</code>å±éšœã€‚</p></li><li><ul><li>å¯¹äºè¿™æ ·çš„è¯­å¥Store1; StoreLoad; Store2ï¼Œåœ¨Store2åŠåç»­å†™å…¥æ“ä½œæ‰§è¡Œå‰ï¼Œä¿è¯Store1çš„å†™å…¥æ“ä½œå¯¹å…¶å®ƒå¤„ç†å™¨å¯è§ã€‚</li></ul></li><li><p>åœ¨æ¯ä¸ªvolatileå†™æ“ä½œçš„åé¢æ’å…¥ä¸€ä¸ª<code>StoreLoad</code>å±éšœã€‚</p></li><li><ul><li>å¯¹äºè¿™æ ·çš„è¯­å¥Store1; StoreLoad; Load2ï¼Œåœ¨Load2åŠåç»­æ‰€æœ‰è¯»å–æ“ä½œæ‰§è¡Œå‰ï¼Œä¿è¯Store1çš„å†™å…¥å¯¹æ‰€æœ‰å¤„ç†å™¨å¯è§ã€‚</li></ul></li><li><p>åœ¨æ¯ä¸ªvolatileè¯»æ“ä½œçš„åé¢æ’å…¥ä¸€ä¸ª<code>LoadLoad</code>å±éšœã€‚</p></li><li><ul><li>å¯¹äºè¿™æ ·çš„è¯­å¥Load1;LoadLoad; Load2ï¼Œåœ¨Load2åŠåç»­è¯»å–æ“ä½œè¦è¯»å–çš„æ•°æ®è¢«è®¿é—®å‰ï¼Œä¿è¯Load1è¦è¯»å–çš„æ•°æ®è¢«è¯»å–å®Œæ¯•ã€‚</li></ul></li><li><p>åœ¨æ¯ä¸ªvolatileè¯»æ“ä½œçš„åé¢æ’å…¥ä¸€ä¸ª<code>LoadStore</code>å±éšœã€‚</p></li><li><ul><li>å¯¹äºè¿™æ ·çš„è¯­å¥Load1; LoadStore; Store2ï¼Œåœ¨Store2åŠåç»­å†™å…¥æ“ä½œè¢«åˆ·å‡ºå‰ï¼Œä¿è¯Load1è¦è¯»å–çš„æ•°æ®è¢«è¯»å–å®Œæ¯•ã€‚</li></ul></li></ul><p><img src="https://github.com/cayzlh/git-img-repository/raw/master/blog/2018083001/2.png" alt="å†…å­˜å±éšœ"></p><p>æ‰€ä»¥ï¼Œvolatileé€šè¿‡åœ¨volatileå˜é‡çš„æ“ä½œå‰åæ’å…¥å†…å­˜å±éšœçš„æ–¹å¼ï¼Œæ¥ç¦æ­¢æŒ‡ä»¤é‡æ’ï¼Œè¿›è€Œä¿è¯å¤šçº¿ç¨‹æƒ…å†µä¸‹å¯¹å…±äº«å˜é‡çš„æœ‰åºæ€§ã€‚</p><h3 id="volatileä¸åŸå­æ€§"><a href="#volatileä¸åŸå­æ€§" class="headerlink" title="volatileä¸åŸå­æ€§"></a>volatileä¸åŸå­æ€§</h3><blockquote><p>åŸå­æ€§æ˜¯æŒ‡ä¸€ä¸ªæ“ä½œæ˜¯ä¸å¯ä¸­æ–­çš„ï¼Œè¦å…¨éƒ¨æ‰§è¡Œå®Œæˆï¼Œè¦ä¸å°±éƒ½ä¸æ‰§è¡Œã€‚ </p></blockquote><p><strong>çº¿ç¨‹æ˜¯CPUè°ƒåº¦çš„åŸºæœ¬å•ä½ã€‚CPUæœ‰æ—¶é—´ç‰‡çš„æ¦‚å¿µï¼Œä¼šæ ¹æ®ä¸åŒçš„è°ƒåº¦ç®—æ³•è¿›è¡Œçº¿ç¨‹è°ƒåº¦ã€‚å½“ä¸€ä¸ªçº¿ç¨‹è·å¾—æ—¶é—´ç‰‡ä¹‹åå¼€å§‹æ‰§è¡Œï¼Œåœ¨æ—¶é—´ç‰‡è€—å°½ä¹‹åï¼Œå°±ä¼šå¤±å»CPUä½¿ç”¨æƒã€‚æ‰€ä»¥åœ¨å¤šçº¿ç¨‹åœºæ™¯ä¸‹ï¼Œç”±äºæ—¶é—´ç‰‡åœ¨çº¿ç¨‹é—´è½®æ¢ï¼Œå°±ä¼šå‘ç”ŸåŸå­æ€§é—®é¢˜ã€‚</strong></p><p><a href="https://blog.cayzlh.com/2018/08/28/2018082802/">synchronized</a>æåˆ°è¿‡ï¼Œä¸ºäº†ä¿è¯åŸå­æ€§ï¼Œéœ€è¦é€šè¿‡å­—èŠ‚ç æŒ‡ä»¤<code>monitorenter</code>å’Œ<code>monitorexit</code>ï¼Œä½†æ˜¯<code>volatile</code>å’Œè¿™ä¸¤ä¸ªæŒ‡ä»¤ä¹‹é—´æ˜¯æ²¡æœ‰ä»»ä½•å…³ç³»çš„ã€‚</p><p><strong>æ‰€ä»¥ï¼Œvolatileæ˜¯ä¸èƒ½ä¿è¯åŸå­æ€§çš„ã€‚</strong></p><p>åœ¨ä»¥ä¸‹ä¸¤ä¸ªåœºæ™¯ä¸­å¯ä»¥ä½¿ç”¨<code>volatile</code>æ¥ä»£æ›¿<code>synchronized</code>ï¼š</p><blockquote><p>1ã€è¿ç®—ç»“æœå¹¶ä¸ä¾èµ–å˜é‡çš„å½“å‰å€¼ï¼Œæˆ–è€…èƒ½å¤Ÿç¡®ä¿åªæœ‰å•ä¸€çš„çº¿ç¨‹ä¼šä¿®æ”¹å˜é‡çš„å€¼ã€‚</p><p>2ã€å˜é‡ä¸éœ€è¦ä¸å…¶ä»–çŠ¶æ€å˜é‡å…±åŒå‚ä¸ä¸å˜çº¦æŸã€‚</p></blockquote><p>é™¤ä»¥ä¸Šåœºæ™¯å¤–ï¼Œéƒ½éœ€è¦ä½¿ç”¨å…¶ä»–æ–¹å¼æ¥ä¿è¯åŸå­æ€§ï¼Œå¦‚<code>synchronized</code>æˆ–è€…<code>concurrentåŒ…</code>ã€‚ </p><p>çœ‹å¦‚ä¸‹ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">volatile</span> <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">increase</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        i++;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">final</span> Test test = <span class="keyword">new</span> Test();</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">10</span>;i++)&#123;</span><br><span class="line">            <span class="keyword">new</span> Thread()&#123;</span><br><span class="line">                <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                    <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;<span class="number">1000</span>;j++)</span><br><span class="line">                        test.increase();</span><br><span class="line">                &#125;;</span><br><span class="line">            &#125;.start();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span>(Thread.activeCount()&gt;<span class="number">1</span>)  <span class="comment">//ä¿è¯å‰é¢çš„çº¿ç¨‹éƒ½æ‰§è¡Œå®Œ</span></span><br><span class="line">            Thread.yield();</span><br><span class="line">        System.out.println(test.i);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»¥ä¸Šä»£ç æ¯”è¾ƒç®€å•ï¼Œå°±æ˜¯åˆ›å»º10ä¸ªçº¿ç¨‹ï¼Œç„¶ååˆ†åˆ«æ‰§è¡Œ1000æ¬¡<code>i++</code>æ“ä½œã€‚æ­£å¸¸æƒ…å†µä¸‹ï¼Œç¨‹åºçš„è¾“å‡ºç»“æœåº”è¯¥æ˜¯10000ï¼Œä½†æ˜¯ï¼Œå¤šæ¬¡æ‰§è¡Œçš„ç»“æœéƒ½å°äº10000ã€‚è¿™å…¶å®å°±æ˜¯<code>volatile</code>æ— æ³•æ»¡è¶³åŸå­æ€§çš„åŸå› ã€‚</p><p>ä¸ºä»€ä¹ˆä¼šå‡ºç°è¿™ç§æƒ…å†µå‘¢ï¼Œé‚£å°±æ˜¯å› ä¸ºè™½ç„¶volatileå¯ä»¥ä¿è¯<code>i</code>åœ¨å¤šä¸ªçº¿ç¨‹ä¹‹é—´çš„å¯è§æ€§ã€‚ä½†æ˜¯æ— æ³•ä¿è¯<code>i++</code>çš„åŸå­æ€§ã€‚</p><p><code>i++</code>æ“ä½œï¼Œä¸€å…±æœ‰ä¸‰ä¸ªæ­¥éª¤ï¼š<code>load i</code> ï¼Œ<code>add i</code> ,<code>save i</code>ã€‚åœ¨å¤šçº¿ç¨‹åœºæ™¯ä¸­ï¼Œå¦‚æœè¿™ä¸‰ä¸ªæ­¥éª¤æ— æ³•æŒ‰ç…§é¡ºåºæ‰§è¡Œçš„è¯ï¼Œé‚£ä¹ˆå°±ä¼šå‡ºç°é—®é¢˜ã€‚</p><h4 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h4><p>ç”±äºCPUæŒ‰ç…§æ—¶é—´ç‰‡æ¥è¿›è¡Œçº¿ç¨‹è°ƒåº¦çš„ï¼Œåªè¦æ˜¯åŒ…å«å¤šä¸ªæ­¥éª¤çš„æ“ä½œçš„æ‰§è¡Œï¼Œå¤©ç„¶å°±æ˜¯æ— æ³•ä¿è¯åŸå­æ€§çš„ã€‚å› ä¸ºè¿™ç§çº¿ç¨‹æ‰§è¡Œï¼Œåˆä¸åƒæ•°æ®åº“ä¸€æ ·å¯ä»¥å›æ»šã€‚å¦‚æœä¸€ä¸ªçº¿ç¨‹è¦æ‰§è¡Œçš„æ­¥éª¤æœ‰5æ­¥ï¼Œæ‰§è¡Œå®Œ3æ­¥å°±å¤±å»äº†CPUäº†ï¼Œå¤±å»åå°±å¯èƒ½å†ä¹Ÿä¸ä¼šè¢«è°ƒåº¦ï¼Œè¿™æ€ä¹ˆå¯èƒ½ä¿è¯åŸå­æ€§å‘¢ã€‚</p><p>ä¸ºä»€ä¹ˆ<code>synchronized</code>å¯ä»¥ä¿è¯åŸå­æ€§ ï¼Œå› ä¸ºè¢«<code>synchronized</code>ä¿®é¥°çš„ä»£ç ç‰‡æ®µï¼Œåœ¨è¿›å…¥ä¹‹å‰åŠ äº†é”ï¼Œåªè¦ä»–æ²¡æ‰§è¡Œå®Œï¼Œå…¶ä»–çº¿ç¨‹æ˜¯æ— æ³•è·å¾—é”æ‰§è¡Œè¿™æ®µä»£ç ç‰‡æ®µçš„ï¼Œå°±å¯ä»¥ä¿è¯ä»–å†…éƒ¨çš„ä»£ç å¯ä»¥å…¨éƒ¨è¢«æ‰§è¡Œã€‚è¿›è€Œä¿è¯åŸå­æ€§ã€‚</p><p>ä½†æ˜¯<code>synchronized</code>å¯¹åŸå­æ€§ä¿è¯ä¹Ÿä¸ç»å¯¹ï¼Œä¸€æ—¦ä»£ç è¿è¡Œå¼‚å¸¸ï¼Œä¹Ÿæ²¡åŠæ³•å›æ»šã€‚æ‰€ä»¥å‘¢ï¼Œåœ¨å¹¶å‘ç¼–ç¨‹ä¸­ï¼ŒåŸå­æ€§çš„å®šä¹‰ä¸åº”è¯¥å’Œäº‹åŠ¡ä¸­çš„åŸå­æ€§ä¸€æ ·ã€‚ä»–åº”è¯¥å®šä¹‰ä¸ºï¼š<strong>ä¸€æ®µä»£ç ï¼Œæˆ–è€…ä¸€ä¸ªå˜é‡çš„æ“ä½œï¼Œåœ¨æ²¡æœ‰æ‰§è¡Œå®Œä¹‹å‰ï¼Œä¸èƒ½è¢«å…¶ä»–çº¿ç¨‹æ‰§è¡Œã€‚</strong></p><p>é‚£ä¹ˆï¼Œä¸ºä»€ä¹ˆ<code>volatile</code>ä¸èƒ½ä¿è¯åŸå­æ€§å‘¢ï¼Ÿå› ä¸ºä»–ä¸æ˜¯é”ï¼Œä»–æ²¡åšä»»ä½•å¯ä»¥ä¿è¯åŸå­æ€§çš„å¤„ç†ã€‚å½“ç„¶å°±ä¸èƒ½ä¿è¯åŸå­æ€§äº†ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹æŠ€æœ¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> JVM </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>synchronized</title>
      <link href="post/edea11bc/"/>
      <url>post/edea11bc/</url>
      
        <content type="html"><![CDATA[<blockquote><p>Javaè¯­è¨€ä¸ºäº†è§£å†³å¹¶å‘ç¼–ç¨‹ä¸­å­˜åœ¨çš„åŸå­æ€§ã€å¯è§æ€§å’Œæœ‰åºæ€§é—®é¢˜ï¼Œæä¾›äº†ä¸€ç³»åˆ—å’Œå¹¶å‘å¤„ç†ç›¸å…³çš„å…³é”®å­—ï¼Œæ¯”å¦‚synchronizedã€volatileã€finalã€concurrenåŒ…ç­‰ã€‚</p></blockquote><p>åœ¨ã€Šæ·±å…¥ç†è§£Javaè™šæ‹Ÿæœºã€‹ä¸­ï¼Œæœ‰è¿™æ ·ä¸€æ®µè¯ï¼š</p><blockquote><p><code>synchronized</code>å…³é”®å­—åœ¨éœ€è¦åŸå­æ€§ã€å¯è§æ€§å’Œæœ‰åºæ€§è¿™ä¸‰ç§ç‰¹æ€§çš„æ—¶å€™éƒ½å¯ä»¥ä½œä¸ºå…¶ä¸­ä¸€ç§è§£å†³æ–¹æ¡ˆï¼Œçœ‹èµ·æ¥æ˜¯â€œä¸‡èƒ½â€çš„ã€‚çš„ç¡®ï¼Œå¤§éƒ¨åˆ†å¹¶å‘æ§åˆ¶æ“ä½œéƒ½èƒ½ä½¿ç”¨synchronizedæ¥å®Œæˆã€‚</p></blockquote><p><code>synchronized</code>åªæ˜¯ä¸ªå…³é”®å­—è€Œå·²ï¼Œç”¨èµ·æ¥å¾ˆç®€å•ã€‚ä¹‹æ‰€ä»¥æˆ‘ä»¬å¯ä»¥åœ¨å¤„ç†å¤šçº¿ç¨‹é—®é¢˜æ—¶å¯ä»¥ä¸ç”¨è€ƒè™‘å¤ªå¤šï¼Œå°±æ˜¯å› ä¸ºè¿™ä¸ªå…³é”®å­—å¸®æˆ‘ä»¬å±è”½äº†å¾ˆå¤šç»†èŠ‚ã€‚</p><p>æœ¬æ–‡ä¸»è¦ä»‹ç»<code>synchronized</code>çš„ç”¨æ³•ã€åŸç†ï¼Œä»¥åŠå¦‚ä½•æä¾›åŸå­æ€§ã€å¯è§æ€§å’Œæœ‰åºæ€§ä¿éšœçš„ç­‰ã€‚</p><h3 id="synchronizedçš„ç”¨æ³•"><a href="#synchronizedçš„ç”¨æ³•" class="headerlink" title="synchronizedçš„ç”¨æ³•"></a>synchronizedçš„ç”¨æ³•</h3><p><code>synchronized</code>æ˜¯Javaæä¾›çš„ä¸€ä¸ªå¹¶å‘æ§åˆ¶çš„å…³é”®å­—ã€‚ä¸»è¦æœ‰ä¸¤ç§ç”¨æ³•ï¼Œåˆ†åˆ«æ˜¯åŒæ­¥æ–¹æ³•å’ŒåŒæ­¥ä»£ç å—ã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œ<code>synchronized</code>æ—¢å¯ä»¥ä¿®é¥°æ–¹æ³•ä¹Ÿå¯ä»¥ä¿®é¥°ä»£ç å—ã€‚ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SynchronizedDemo</span> </span>&#123;</span><br><span class="line">     <span class="comment">//åŒæ­¥æ–¹æ³•</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">doSomeThing</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Hello World&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//åŒæ­¥ä»£ç å—</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doOtherThing</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">synchronized</span> (SynchronizedDemo.class)&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;Hello World&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¢«<code>synchronized</code>ä¿®é¥°çš„ä»£ç å—åŠæ–¹æ³•ï¼Œåœ¨åŒä¸€æ—¶é—´ï¼Œåªèƒ½è¢«å•ä¸ªçº¿ç¨‹è®¿é—®ã€‚ </p><h3 id="synchronizedçš„å®ç°åŸç†"><a href="#synchronizedçš„å®ç°åŸç†" class="headerlink" title="synchronizedçš„å®ç°åŸç†"></a>synchronizedçš„å®ç°åŸç†</h3><blockquote><p><code>synchronized</code>ï¼Œæ˜¯Javaä¸­ç”¨äºè§£å†³å¹¶å‘æƒ…å†µä¸‹æ•°æ®åŒæ­¥è®¿é—®çš„ä¸€ä¸ªå¾ˆé‡è¦çš„å…³é”®å­—ã€‚å½“æˆ‘ä»¬æƒ³è¦ä¿è¯ä¸€ä¸ªå…±äº«èµ„æºåœ¨åŒä¸€æ—¶é—´åªä¼šè¢«ä¸€ä¸ªçº¿ç¨‹è®¿é—®åˆ°æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ä»£ç ä¸­ä½¿ç”¨<code>synchronized</code>å…³é”®å­—å¯¹ç±»æˆ–è€…å¯¹è±¡åŠ é”ã€‚</p></blockquote><p>æˆ‘ä»¬å¯¹ä¸Šé¢çš„ä»£ç è¿›è¡Œåç¼–è¯‘ï¼Œå¯ä»¥å¾—åˆ°å¦‚ä¸‹ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">com</span>.<span class="title">cayzlh</span>.<span class="title">SynchronizedDemo</span> </span>&#123;</span><br><span class="line">  <span class="keyword">public</span> com.cayzlh.SynchronizedDemo();</span><br><span class="line">    Code:</span><br><span class="line">       <span class="number">0</span>: aload_0</span><br><span class="line">       1: invokespecial #1                  // Method java/lang/Object.&quot;&lt;init&gt;&quot;:()V</span><br><span class="line">       <span class="number">4</span>: <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">doSomeThing</span><span class="params">()</span></span>;</span><br><span class="line">    Code:</span><br><span class="line">       0: getstatic     #2                  // Field java/lang/System.out:Ljava/io/PrintStream;</span><br><span class="line">       3: ldc           #3                  // String Hello World</span><br><span class="line">       5: invokevirtual #4                  // Method java/io/PrintStream.println:(Ljava/lang/String;)V</span><br><span class="line">       <span class="number">8</span>: <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doOtherThing</span><span class="params">()</span></span>;</span><br><span class="line">    Code:</span><br><span class="line">       0: ldc           #5                  // class com/cayzlh/SynchronizedDemo</span><br><span class="line">       <span class="number">2</span>: dup</span><br><span class="line">       <span class="number">3</span>: astore_1</span><br><span class="line">       <span class="number">4</span>: monitorenter</span><br><span class="line">       5: getstatic     #2                  // Field java/lang/System.out:Ljava/io/PrintStream;</span><br><span class="line">       8: ldc           #3                  // String Hello World</span><br><span class="line">      10: invokevirtual #4                  // Method java/io/PrintStream.println:(Ljava/lang/String;)V</span><br><span class="line">      <span class="number">13</span>: aload_1</span><br><span class="line">      <span class="number">14</span>: monitorexit</span><br><span class="line">      <span class="number">15</span>: goto          <span class="number">23</span></span><br><span class="line">      <span class="number">18</span>: astore_2</span><br><span class="line">      <span class="number">19</span>: aload_1</span><br><span class="line">      <span class="number">20</span>: monitorexit</span><br><span class="line">      <span class="number">21</span>: aload_2</span><br><span class="line">      <span class="number">22</span>: athrow</span><br><span class="line">      <span class="number">23</span>: <span class="keyword">return</span></span><br><span class="line">    Exception table:</span><br><span class="line">       from    to  target type</span><br><span class="line">           <span class="number">5</span>    <span class="number">15</span>    <span class="number">18</span>   any</span><br><span class="line">          <span class="number">18</span>    <span class="number">21</span>    <span class="number">18</span>   any</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹å‡ºï¼š</p><p>å¯¹äºåŒæ­¥æ–¹æ³•ï¼ŒJVMé‡‡ç”¨<code>ACC_SYNCHRONIZED</code>æ ‡è®°ç¬¦æ¥å®ç°åŒæ­¥ã€‚ </p><p>å¯¹äºåŒæ­¥ä»£ç å—ã€‚JVMé‡‡ç”¨<code>monitorenter</code>ã€<code>monitorexit</code>ä¸¤ä¸ªæŒ‡ä»¤æ¥å®ç°åŒæ­¥ã€‚</p><p>åœ¨The JavaÂ® Virtual Machine Specificationä¸­æœ‰å…³äºåŒæ­¥æ–¹æ³•å’ŒåŒæ­¥ä»£ç å—çš„å®ç°åŸç†çš„ä»‹ç»:</p><blockquote><p>Method-level synchronization is performed implicitly, as part of method invocation and return. A synchronized method is distinguished in the run-time constant poolâ€™s method<em>info structure by the ACC</em>SYNCHRONIZED flag, which is checked by the method invocation instructions. When invoking a method for which ACC_SYNCHRONIZED is set, the executing thread enters a monitor, invokes the method itself, and exits the monitor whether the method invocation completes normally or abruptly. During the time the executing thread owns the monitor, no other thread may enter it. If an exception is thrown during invocation of the synchronized method and the synchronized method does not handle the exception, the monitor for the method is automatically exited before the exception is rethrown out of the synchronized method.</p><p>æ–¹æ³•çº§çš„åŒæ­¥æ˜¯éšå¼çš„ã€‚åŒæ­¥æ–¹æ³•çš„å¸¸é‡æ± ä¸­ä¼šæœ‰ä¸€ä¸ª<code>ACC_SYNCHRONIZED</code>æ ‡å¿—ã€‚å½“æŸä¸ªçº¿ç¨‹è¦è®¿é—®æŸä¸ªæ–¹æ³•çš„æ—¶å€™ï¼Œä¼šæ£€æŸ¥æ˜¯å¦æœ‰<code>ACC_SYNCHRONIZED</code>ï¼Œå¦‚æœæœ‰è®¾ç½®ï¼Œåˆ™éœ€è¦å…ˆè·å¾—ç›‘è§†å™¨é”ï¼Œç„¶åå¼€å§‹æ‰§è¡Œæ–¹æ³•ï¼Œæ–¹æ³•æ‰§è¡Œä¹‹åå†é‡Šæ”¾ç›‘è§†å™¨é”ã€‚è¿™æ—¶å¦‚æœå…¶ä»–çº¿ç¨‹æ¥è¯·æ±‚æ‰§è¡Œæ–¹æ³•ï¼Œä¼šå› ä¸ºæ— æ³•è·å¾—ç›‘è§†å™¨é”è€Œè¢«é˜»æ–­ä½ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œ<strong>å¦‚æœåœ¨æ–¹æ³•æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œå‘ç”Ÿäº†å¼‚å¸¸ï¼Œå¹¶ä¸”æ–¹æ³•å†…éƒ¨å¹¶æ²¡æœ‰å¤„ç†è¯¥å¼‚å¸¸ï¼Œé‚£ä¹ˆåœ¨å¼‚å¸¸è¢«æŠ›åˆ°æ–¹æ³•å¤–é¢ä¹‹å‰ç›‘è§†å™¨é”ä¼šè¢«è‡ªåŠ¨é‡Šæ”¾ã€‚</strong></p><p>åŒæ­¥ä»£ç å—ä½¿ç”¨<code>monitorenter</code>å’Œ<code>monitorexit</code>ä¸¤ä¸ªæŒ‡ä»¤å®ç°ã€‚å¯ä»¥æŠŠæ‰§è¡Œ<code>monitorenter</code>æŒ‡ä»¤ç†è§£ä¸ºåŠ é”ï¼Œæ‰§è¡Œ<code>monitorexit</code>ç†è§£ä¸ºé‡Šæ”¾é”ã€‚ æ¯ä¸ªå¯¹è±¡ç»´æŠ¤ç€ä¸€ä¸ªè®°å½•ç€è¢«é”æ¬¡æ•°çš„è®¡æ•°å™¨ã€‚æœªè¢«é”å®šçš„å¯¹è±¡çš„è¯¥è®¡æ•°å™¨ä¸º0ï¼Œå½“ä¸€ä¸ªçº¿ç¨‹è·å¾—é”ï¼ˆæ‰§è¡Œ<code>monitorenter</code>ï¼‰åï¼Œè¯¥è®¡æ•°å™¨è‡ªå¢å˜ä¸º 1 ï¼Œå½“åŒä¸€ä¸ªçº¿ç¨‹å†æ¬¡è·å¾—è¯¥å¯¹è±¡çš„é”çš„æ—¶å€™ï¼Œè®¡æ•°å™¨å†æ¬¡è‡ªå¢ã€‚å½“åŒä¸€ä¸ªçº¿ç¨‹é‡Šæ”¾é”ï¼ˆæ‰§è¡Œ<code>monitorexit</code>æŒ‡ä»¤ï¼‰çš„æ—¶å€™ï¼Œè®¡æ•°å™¨å†è‡ªå‡ã€‚å½“è®¡æ•°å™¨ä¸º0çš„æ—¶å€™ã€‚é”å°†è¢«é‡Šæ”¾ï¼Œå…¶ä»–çº¿ç¨‹ä¾¿å¯ä»¥è·å¾—é”ã€‚</p></blockquote><p>æ— è®ºæ˜¯<code>ACC_SYNCHRONIZED</code>è¿˜æ˜¯<code>monitorenter</code>ã€<code>monitorexit</code>éƒ½æ˜¯åŸºäºMonitorå®ç°çš„ï¼Œåœ¨Javaè™šæ‹Ÿæœº(HotSpot)ä¸­ï¼ŒMonitoræ˜¯åŸºäºC++å®ç°çš„ï¼Œç”±ObjectMonitorå®ç°ã€‚</p><p><code>ObjectMonitor</code>ç±»ä¸­æä¾›äº†å‡ ä¸ªæ–¹æ³•ï¼Œå¦‚<code>enter</code>ã€<code>exit</code>ã€<code>wait</code>ã€<code>notify</code>ã€<code>notifyAll</code>ç­‰ã€‚<code>sychronized</code>åŠ é”çš„æ—¶å€™ï¼Œä¼šè°ƒç”¨<code>objectMonitor</code>çš„<code>enter</code>æ–¹æ³•ï¼Œè§£é”çš„æ—¶å€™ä¼šè°ƒç”¨<code>exit</code>æ–¹æ³•ã€‚</p><h3 id="synchronizedä¸æœ‰åºæ€§"><a href="#synchronizedä¸æœ‰åºæ€§" class="headerlink" title="synchronizedä¸æœ‰åºæ€§"></a>synchronizedä¸æœ‰åºæ€§</h3><p>æœ‰åºæ€§å³ç¨‹åºæ‰§è¡Œçš„é¡ºåºæŒ‰ç…§ä»£ç çš„å…ˆåé¡ºåºæ‰§è¡Œã€‚</p><blockquote><p>ç”±äºå¤„ç†å™¨ä¼˜åŒ–å’ŒæŒ‡ä»¤é‡æ’ç­‰ï¼ŒCPUè¿˜å¯èƒ½å¯¹è¾“å…¥ä»£ç è¿›è¡Œä¹±åºæ‰§è¡Œï¼Œæ¯”å¦‚load-&gt;add-&gt;save æœ‰å¯èƒ½è¢«ä¼˜åŒ–æˆload-&gt;save-&gt;add ã€‚è¿™å°±æ˜¯å¯èƒ½å­˜åœ¨æœ‰åºæ€§é—®é¢˜ã€‚</p></blockquote><p>è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ<code>synchronized</code>æ˜¯æ— æ³•ç¦æ­¢æŒ‡ä»¤é‡æ’å’Œå¤„ç†å™¨ä¼˜åŒ–çš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œ<code>synchronized</code>æ— æ³•é¿å…ä¸Šè¿°æåˆ°çš„é—®é¢˜ã€‚</p><p><em>é‚£ä¹ˆï¼Œä¸ºä»€ä¹ˆè¿˜è¯´<code>synchronized</code>ä¹Ÿæä¾›äº†æœ‰åºæ€§ä¿è¯å‘¢ï¼Ÿ</em></p><p><strong>Javaç¨‹åºä¸­å¤©ç„¶çš„æœ‰åºæ€§å¯ä»¥æ€»ç»“ä¸ºä¸€å¥è¯ï¼šå¦‚æœåœ¨æœ¬çº¿ç¨‹å†…è§‚å¯Ÿï¼Œæ‰€æœ‰æ“ä½œéƒ½æ˜¯å¤©ç„¶æœ‰åºçš„ã€‚å¦‚æœåœ¨ä¸€ä¸ªçº¿ç¨‹ä¸­è§‚å¯Ÿå¦ä¸€ä¸ªçº¿ç¨‹ï¼Œæ‰€æœ‰æ“ä½œéƒ½æ˜¯æ— åºçš„ã€‚</strong></p><p>ä»¥ä¸Šè¿™å¥è¯ä¹Ÿæ˜¯ã€Šæ·±å…¥ç†è§£Javaè™šæ‹Ÿæœºã€‹ä¸­çš„åŸå¥ï¼Œè¿™å’Œ<code>as-if-serialè¯­ä¹‰</code>æœ‰å…³ã€‚</p><p><code>as-if-serial</code>è¯­ä¹‰çš„æ„æ€æŒ‡ï¼šä¸ç®¡æ€ä¹ˆé‡æ’åºï¼ˆç¼–è¯‘å™¨å’Œå¤„ç†å™¨ä¸ºäº†æé«˜å¹¶è¡Œåº¦ï¼‰ï¼Œå•çº¿ç¨‹ç¨‹åºçš„æ‰§è¡Œç»“æœéƒ½ä¸èƒ½è¢«æ”¹å˜ã€‚ç¼–è¯‘å™¨å’Œå¤„ç†å™¨æ— è®ºå¦‚ä½•ä¼˜åŒ–ï¼Œéƒ½å¿…é¡»éµå®ˆ<code>as-if-serial</code>è¯­ä¹‰ã€‚</p><p>ç®€å•è¯´å°±æ˜¯ï¼Œ<code>as-if-serialè¯­ä¹‰</code>ä¿è¯äº†å•çº¿ç¨‹ä¸­ï¼ŒæŒ‡ä»¤é‡æ’æ˜¯æœ‰ä¸€å®šçš„é™åˆ¶çš„ï¼Œè€Œåªè¦ç¼–è¯‘å™¨å’Œå¤„ç†å™¨éƒ½éµå®ˆäº†è¿™ä¸ªè¯­ä¹‰ï¼Œé‚£ä¹ˆå°±å¯ä»¥è®¤ä¸ºå•çº¿ç¨‹ç¨‹åºæ˜¯æŒ‰ç…§é¡ºåºæ‰§è¡Œçš„ã€‚å½“ç„¶ï¼Œå®é™…ä¸Šè¿˜æ˜¯æœ‰é‡æ’çš„ï¼Œåªä¸è¿‡æˆ‘ä»¬æ— é¡»å…³å¿ƒè¿™ç§é‡æ’çš„å¹²æ‰°ã€‚</p><p><strong>æ‰€ä»¥å‘¢ï¼Œç”±äºsynchronizedä¿®é¥°çš„ä»£ç ï¼ŒåŒä¸€æ—¶é—´åªèƒ½è¢«åŒä¸€çº¿ç¨‹è®¿é—®ã€‚é‚£ä¹ˆä¹Ÿå°±æ˜¯å•çº¿ç¨‹æ‰§è¡Œçš„ã€‚æ‰€ä»¥ï¼Œå¯ä»¥ä¿è¯å…¶æœ‰åºæ€§ã€‚</strong></p><h3 id="synchronizedä¸é”ä¼˜åŒ–"><a href="#synchronizedä¸é”ä¼˜åŒ–" class="headerlink" title="synchronizedä¸é”ä¼˜åŒ–"></a><strong>synchronizedä¸é”ä¼˜åŒ–</strong></h3><p><code>synchronized</code>å…¶å®æ˜¯å€ŸåŠ©Monitorå®ç°çš„ï¼Œåœ¨åŠ é”æ—¶ä¼šè°ƒç”¨objectMonitorçš„<code>enter</code>æ–¹æ³•ï¼Œè§£é”çš„æ—¶å€™ä¼šè°ƒç”¨<code>exit</code>æ–¹æ³•ã€‚äº‹å®ä¸Šï¼Œåªæœ‰åœ¨JDK1.6ä¹‹å‰ï¼Œsynchronizedçš„å®ç°æ‰ä¼šç›´æ¥è°ƒç”¨ObjectMonitorçš„<code>enter</code>å’Œ<code>exit</code>ï¼Œè¿™ç§é”è¢«ç§°ä¹‹ä¸ºé‡é‡çº§é”ã€‚</p><p>æ‰€ä»¥ï¼Œåœ¨JDK1.6ä¸­å‡ºç°å¯¹é”è¿›è¡Œäº†å¾ˆå¤šçš„ä¼˜åŒ–ï¼Œè¿›è€Œå‡ºç°è½»é‡çº§é”ï¼Œåå‘é”ï¼Œé”æ¶ˆé™¤ï¼Œé€‚åº”æ€§è‡ªæ—‹é”ï¼Œé”ç²—åŒ–(è‡ªæ—‹é”åœ¨1.4å°±æœ‰ï¼Œåªä¸è¿‡é»˜è®¤çš„æ˜¯å…³é—­çš„ï¼Œjdk1.6æ˜¯é»˜è®¤å¼€å¯çš„)ï¼Œè¿™äº›æ“ä½œéƒ½æ˜¯ä¸ºäº†åœ¨çº¿ç¨‹ä¹‹é—´æ›´é«˜æ•ˆçš„å…±äº«æ•°æ® ï¼Œè§£å†³ç«äº‰é—®é¢˜ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹æŠ€æœ¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> JVM </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Javaå†…å­˜æ¨¡å‹çš„å®ç°</title>
      <link href="post/2e82a2db/"/>
      <url>post/2e82a2db/</url>
      
        <content type="html"><![CDATA[<blockquote><p>åœ¨Javaä¸­æä¾›äº†ä¸€ç³»åˆ—å’Œå¹¶å‘å¤„ç†ç›¸å…³çš„å…³é”®å­—ï¼Œæ¯”å¦‚<code>volatile</code>ã€<code>synchronized</code>ã€<code>final</code>ã€<code>concurren</code>åŒ…ç­‰ã€‚å…¶å®è¿™äº›å°±æ˜¯Javaå†…å­˜æ¨¡å‹å°è£…äº†åº•å±‚çš„å®ç°åæä¾›ç»™ç¨‹åºå‘˜ä½¿ç”¨çš„ä¸€äº›å…³é”®å­—ã€‚</p></blockquote><h3 id="ä»€ä¹ˆæ˜¯å†…å­˜æ¨¡å‹-ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯å†…å­˜æ¨¡å‹-ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯å†…å­˜æ¨¡å‹ ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯å†…å­˜æ¨¡å‹ ï¼Ÿ</h3><p>ç¼“å­˜ä¸€è‡´æ€§é—®é¢˜ã€å¤„ç†å™¨å™¨ä¼˜åŒ–çš„æŒ‡ä»¤é‡æ’é—®é¢˜æ˜¯ç¡¬ä»¶çš„ä¸æ–­å‡çº§å¯¼è‡´çš„ã€‚é‚£ä¹ˆï¼Œæœ‰æ²¡æœ‰ä»€ä¹ˆæœºåˆ¶å¯ä»¥å¾ˆå¥½çš„è§£å†³ä¸Šé¢çš„è¿™äº›é—®é¢˜å‘¢ï¼Ÿ</p><p>æœ€ç®€å•ç›´æ¥çš„åšæ³•å°±æ˜¯åºŸé™¤å¤„ç†å™¨å’Œå¤„ç†å™¨çš„ä¼˜åŒ–æŠ€æœ¯ã€åºŸé™¤CPUç¼“å­˜ï¼Œè®©CPUç›´æ¥å’Œä¸»å­˜äº¤äº’ã€‚ä½†æ˜¯ï¼Œè¿™ä¹ˆåšè™½ç„¶å¯ä»¥ä¿è¯å¤šçº¿ç¨‹ä¸‹çš„å¹¶å‘é—®é¢˜ã€‚ä½†æ˜¯ï¼Œè¿™å°±æœ‰ç‚¹å› å™åºŸé£Ÿäº†ã€‚</p><p>æ‰€ä»¥ï¼Œä¸ºäº†ä¿è¯å¹¶å‘ç¼–ç¨‹ä¸­å¯ä»¥æ»¡è¶³åŸå­æ€§ã€å¯è§æ€§åŠæœ‰åºæ€§ã€‚æœ‰ä¸€ä¸ªé‡è¦çš„æ¦‚å¿µï¼Œé‚£å°±æ˜¯â€”â€”å†…å­˜æ¨¡å‹ã€‚</p><p><strong>ä¸ºäº†ä¿è¯å…±äº«å†…å­˜çš„æ­£ç¡®æ€§ï¼ˆå¯è§æ€§ã€æœ‰åºæ€§ã€åŸå­æ€§ï¼‰ï¼Œå†…å­˜æ¨¡å‹å®šä¹‰äº†å…±äº«å†…å­˜ç³»ç»Ÿä¸­å¤šçº¿ç¨‹ç¨‹åºè¯»å†™æ“ä½œè¡Œä¸ºçš„è§„èŒƒã€‚</strong>é€šè¿‡è¿™äº›è§„åˆ™æ¥è§„èŒƒå¯¹å†…å­˜çš„è¯»å†™æ“ä½œï¼Œä»è€Œä¿è¯æŒ‡ä»¤æ‰§è¡Œçš„æ­£ç¡®æ€§ã€‚å®ƒä¸å¤„ç†å™¨æœ‰å…³ã€ä¸ç¼“å­˜æœ‰å…³ã€ä¸å¹¶å‘æœ‰å…³ã€ä¸ç¼–è¯‘å™¨ä¹Ÿæœ‰å…³ã€‚ä»–è§£å†³äº†CPUå¤šçº§ç¼“å­˜ã€å¤„ç†å™¨ä¼˜åŒ–ã€æŒ‡ä»¤é‡æ’ç­‰å¯¼è‡´çš„å†…å­˜è®¿é—®é—®é¢˜ï¼Œä¿è¯äº†å¹¶å‘åœºæ™¯ä¸‹çš„ä¸€è‡´æ€§ã€åŸå­æ€§å’Œæœ‰åºæ€§ã€‚</p><hr><p>åœ¨å¼€å‘å¤šçº¿ç¨‹çš„ä»£ç çš„æ—¶å€™ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨<code>synchronized</code>ç­‰å…³é”®å­—æ¥æ§åˆ¶å¹¶å‘ï¼Œä»æ¥å°±ä¸éœ€è¦å…³å¿ƒåº•å±‚çš„ç¼–è¯‘å™¨ä¼˜åŒ–ã€ç¼“å­˜ä¸€è‡´æ€§ç­‰é—®é¢˜ã€‚æ‰€ä»¥ï¼Œ<strong>Javaå†…å­˜æ¨¡å‹ï¼Œé™¤äº†å®šä¹‰äº†ä¸€å¥—è§„èŒƒï¼Œè¿˜æä¾›äº†ä¸€ç³»åˆ—åŸè¯­ï¼Œå°è£…äº†åº•å±‚å®ç°åï¼Œä¾›å¼€å‘è€…ç›´æ¥ä½¿ç”¨ã€‚</strong></p><h3 id="åŸå­æ€§"><a href="#åŸå­æ€§" class="headerlink" title="åŸå­æ€§"></a>åŸå­æ€§</h3><blockquote><p>åœ¨ä¸€ä¸ªæ“ä½œä¸­å°±æ˜¯cpuä¸å¯ä»¥åœ¨ä¸­é€”æš‚åœç„¶åå†è°ƒåº¦ï¼Œæ—¢ä¸è¢«ä¸­æ–­æ“ä½œï¼Œè¦ä¸æ‰§è¡Œå®Œæˆï¼Œè¦ä¸å°±ä¸æ‰§è¡Œ</p></blockquote><p>åœ¨Javaä¸­ï¼Œä¸ºäº†ä¿è¯åŸå­æ€§ï¼Œæä¾›äº†ä¸¤ä¸ªé«˜çº§çš„å­—èŠ‚ç æŒ‡ä»¤<code>monitorenter</code>å’Œ<code>monitorexit</code>ã€‚è¿™ä¸¤ä¸ªå­—èŠ‚ç ï¼Œåœ¨Javaä¸­å¯¹åº”çš„å…³é”®å­—å°±æ˜¯<code>synchronized</code>ã€‚</p><p>å› æ­¤ï¼Œåœ¨Javaä¸­å¯ä»¥ä½¿ç”¨<code>synchronized</code>æ¥ä¿è¯æ–¹æ³•å’Œä»£ç å—å†…çš„æ“ä½œæ˜¯åŸå­æ€§çš„ã€‚</p><h3 id="å¯è§æ€§"><a href="#å¯è§æ€§" class="headerlink" title="å¯è§æ€§"></a>å¯è§æ€§</h3><blockquote><p>å½“å¤šä¸ªçº¿ç¨‹è®¿é—®åŒä¸€ä¸ªå˜é‡æ—¶ï¼Œä¸€ä¸ªçº¿ç¨‹ä¿®æ”¹äº†è¿™ä¸ªå˜é‡çš„å€¼ï¼Œå…¶ä»–çº¿ç¨‹èƒ½å¤Ÿç«‹å³çœ‹å¾—åˆ°ä¿®æ”¹çš„å€¼</p></blockquote><p>Javaå†…å­˜æ¨¡å‹æ˜¯é€šè¿‡åœ¨å˜é‡ä¿®æ”¹åå°†æ–°å€¼åŒæ­¥å›ä¸»å†…å­˜ï¼Œåœ¨å˜é‡è¯»å–å‰ä»ä¸»å†…å­˜åˆ·æ–°å˜é‡å€¼çš„è¿™ç§ä¾èµ–ä¸»å†…å­˜ä½œä¸ºä¼ é€’åª’ä»‹çš„æ–¹å¼æ¥å®ç°çš„ã€‚</p><p>Javaä¸­çš„<code>volatile</code>å…³é”®å­—æä¾›äº†ä¸€ä¸ªåŠŸèƒ½ï¼Œé‚£å°±æ˜¯<strong>è¢«å…¶ä¿®é¥°çš„å˜é‡åœ¨è¢«ä¿®æ”¹åå¯ä»¥ç«‹å³åŒæ­¥åˆ°ä¸»å†…å­˜</strong>ï¼Œè¢«å…¶ä¿®é¥°çš„å˜é‡åœ¨æ¯æ¬¡æ˜¯ç”¨ä¹‹å‰éƒ½ä»ä¸»å†…å­˜åˆ·æ–°ã€‚å› æ­¤ï¼Œå¯ä»¥ä½¿ç”¨<code>volatile</code>æ¥ä¿è¯å¤šçº¿ç¨‹æ“ä½œæ—¶å˜é‡çš„å¯è§æ€§ã€‚</p><p>é™¤äº†<code>volatile</code>ï¼ŒJavaä¸­çš„<code>synchronized</code>å’Œ<code>final</code>ä¸¤ä¸ªå…³é”®å­—ä¹Ÿå¯ä»¥å®ç°å¯è§æ€§ã€‚åªä¸è¿‡å®ç°æ–¹å¼ä¸åŒï¼Œè¿™é‡Œä¸å†å±•å¼€äº†ã€‚</p><h3 id="æœ‰åºæ€§"><a href="#æœ‰åºæ€§" class="headerlink" title="æœ‰åºæ€§"></a>æœ‰åºæ€§</h3><blockquote><p>ç¨‹åºæ‰§è¡Œçš„é¡ºåºæŒ‰ç…§ä»£ç çš„å…ˆåé¡ºåºæ‰§è¡Œ</p></blockquote><p>åœ¨Javaä¸­ï¼Œå¯ä»¥ä½¿ç”¨<code>synchronized</code>å’Œ<code>volatile</code>æ¥ä¿è¯å¤šçº¿ç¨‹ä¹‹é—´æ“ä½œçš„æœ‰åºæ€§ã€‚å®ç°æ–¹å¼æœ‰æ‰€åŒºåˆ«ï¼š</p><p><code>volatile</code>å…³é”®å­—ä¼šç¦æ­¢æŒ‡ä»¤é‡æ’ã€‚<code>synchronized</code>å…³é”®å­—ä¿è¯åŒä¸€æ—¶åˆ»åªå…è®¸ä¸€æ¡çº¿ç¨‹æ“ä½œã€‚</p><h3 id="END"><a href="#END" class="headerlink" title="END"></a>END</h3><p><a href="https://blog.cayzlh.com/2018/08/28/2018082802/">synchronizedçš„ä¸€äº›è®°å½•</a>ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹æŠ€æœ¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> è½¬è½½ </tag>
            
            <tag> JVM </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Redisä¸ºä»€ä¹ˆè¿™ä¹ˆå¿«</title>
      <link href="post/2337557361/"/>
      <url>post/2337557361/</url>
      
        <content type="html"><![CDATA[<h3 id="Redisç®€ä»‹"><a href="#Redisç®€ä»‹" class="headerlink" title="Redisç®€ä»‹"></a>Redisç®€ä»‹</h3><p><code>Redis</code>æ˜¯ä¸€ä¸ªå¼€æºçš„å†…å­˜ä¸­çš„æ•°æ®ç»“æ„å­˜å‚¨ç³»ç»Ÿï¼Œå®ƒå¯ä»¥ç”¨ä½œï¼šæ•°æ®åº“ã€ç¼“å­˜å’Œæ¶ˆæ¯ä¸­é—´ä»¶ã€‚</p><p>å®ƒæ”¯æŒå¤šç§ç±»å‹çš„æ•°æ®ç»“æ„ï¼Œå¦‚å­—ç¬¦ä¸²ï¼ˆ<code>String</code>ï¼‰ï¼Œæ•£åˆ—ï¼ˆ<code>Hash</code>ï¼‰ï¼Œåˆ—è¡¨ï¼ˆ<code>List</code>ï¼‰ï¼Œé›†åˆï¼ˆ<code>Set</code>ï¼‰ï¼Œ<br>æœ‰åºé›†åˆï¼ˆ<code>Sorted Set</code>æˆ–è€…æ˜¯<code>ZSet</code>ï¼‰ä¸èŒƒå›´æŸ¥è¯¢ï¼Œ<code>Bitmaps</code>ï¼Œ<code>Hyperloglogs</code> å’Œåœ°ç†ç©ºé—´ï¼ˆGeospatialï¼‰ç´¢å¼•åŠå¾„æŸ¥è¯¢ã€‚<br>å…¶ä¸­å¸¸è§çš„æ•°æ®ç»“æ„ç±»å‹æœ‰ï¼š<code>String</code>ã€<code>List</code>ã€<code>Set</code>ã€<code>Hash</code>ã€<code>ZSet</code>è¿™5ç§ã€‚</p><p>Redis å†…ç½®äº†å¤åˆ¶ï¼ˆReplicationï¼‰ï¼ŒLUAè„šæœ¬ï¼ˆLua scriptingï¼‰ï¼Œ LRUé©±åŠ¨äº‹ä»¶ï¼ˆLRU evictionï¼‰ï¼Œ<br>äº‹åŠ¡ï¼ˆTransactionsï¼‰ å’Œä¸åŒçº§åˆ«çš„ç£ç›˜æŒä¹…åŒ–ï¼ˆPersistenceï¼‰ï¼Œ<br>å¹¶é€šè¿‡ Rediså“¨å…µï¼ˆSentinelï¼‰å’Œè‡ªåŠ¨åˆ†åŒºï¼ˆClusterï¼‰æä¾›é«˜å¯ç”¨æ€§ï¼ˆHigh Availabilityï¼‰ã€‚</p><blockquote><p>Redisä¹Ÿæä¾›äº†æŒä¹…åŒ–çš„é€‰é¡¹ï¼Œè¿™äº›é€‰é¡¹å¯ä»¥è®©ç”¨æˆ·å°†è‡ªå·±çš„æ•°æ®ä¿å­˜åˆ°ç£ç›˜ä¸Šé¢è¿›è¡Œå­˜å‚¨ã€‚<br>æ ¹æ®å®é™…æƒ…å†µï¼Œå¯ä»¥æ¯éš”ä¸€å®šæ—¶é—´å°†æ•°æ®é›†å¯¼å‡ºåˆ°ç£ç›˜ï¼ˆå¿«ç…§ï¼‰ï¼Œæˆ–è€…è¿½åŠ åˆ°å‘½ä»¤æ—¥å¿—ä¸­ï¼ˆAOFåªè¿½åŠ æ–‡ä»¶ï¼‰ï¼Œ<br>ä»–ä¼šåœ¨æ‰§è¡Œå†™å‘½ä»¤æ—¶ï¼Œå°†è¢«æ‰§è¡Œçš„å†™å‘½ä»¤å¤åˆ¶åˆ°ç¡¬ç›˜é‡Œé¢ã€‚æ‚¨ä¹Ÿå¯ä»¥å…³é—­æŒä¹…åŒ–åŠŸèƒ½ï¼Œå°†Redisä½œä¸ºä¸€ä¸ªé«˜æ•ˆçš„ç½‘ç»œçš„ç¼“å­˜æ•°æ®åŠŸèƒ½ä½¿ç”¨ã€‚</p></blockquote><p>Redisä¸ä½¿ç”¨è¡¨ï¼Œä»–çš„æ•°æ®åº“ä¸ä¼šé¢„å®šä¹‰æˆ–è€…å¼ºåˆ¶å»è¦æ±‚ç”¨æˆ·å¯¹Rediså­˜å‚¨çš„ä¸åŒæ•°æ®è¿›è¡Œå…³è”ã€‚</p><p>æ•°æ®åº“çš„å·¥ä½œæ¨¡å¼æŒ‰å­˜å‚¨æ–¹å¼å¯åˆ†ä¸ºï¼šç¡¬ç›˜æ•°æ®åº“å’Œå†…å­˜æ•°æ®åº“ã€‚<code>Redis å°†æ•°æ®å‚¨å­˜åœ¨å†…å­˜é‡Œé¢ï¼Œè¯»å†™æ•°æ®çš„æ—¶å€™éƒ½ä¸ä¼šå—åˆ°ç¡¬ç›˜ I/O é€Ÿåº¦çš„é™åˆ¶ï¼Œæ‰€ä»¥é€Ÿåº¦æå¿«</code>ã€‚</p><h3 id="Redisä¸ºä»€ä¹ˆè¿™ä¹ˆå¿«"><a href="#Redisä¸ºä»€ä¹ˆè¿™ä¹ˆå¿«" class="headerlink" title="Redisä¸ºä»€ä¹ˆè¿™ä¹ˆå¿«"></a>Redisä¸ºä»€ä¹ˆè¿™ä¹ˆå¿«</h3><ul><li><ol><li>å®Œå…¨åŸºäºå†…å­˜ï¼Œç»å¤§éƒ¨åˆ†è¯·æ±‚æ˜¯çº¯ç²¹çš„å†…å­˜æ“ä½œï¼Œéå¸¸å¿«é€Ÿã€‚æ•°æ®å­˜åœ¨å†…å­˜ä¸­ï¼Œç±»ä¼¼äºHashMapï¼ŒHashMapçš„ä¼˜åŠ¿å°±æ˜¯æŸ¥æ‰¾å’Œæ“ä½œçš„æ—¶é—´å¤æ‚åº¦éƒ½æ˜¯O(1)ï¼›</li></ol></li><li><ol start="2"><li>æ•°æ®ç»“æ„ç®€å•ï¼Œå¯¹æ•°æ®æ“ä½œä¹Ÿç®€å•ï¼ŒRedisä¸­çš„æ•°æ®ç»“æ„æ˜¯ä¸“é—¨è¿›è¡Œè®¾è®¡çš„ï¼›</li></ol></li><li><ol start="3"><li>é‡‡ç”¨å•çº¿ç¨‹ï¼Œé¿å…äº†ä¸å¿…è¦çš„ä¸Šä¸‹æ–‡åˆ‡æ¢å’Œç«äº‰æ¡ä»¶ï¼Œä¹Ÿä¸å­˜åœ¨å¤šè¿›ç¨‹æˆ–è€…å¤šçº¿ç¨‹å¯¼è‡´çš„åˆ‡æ¢è€Œæ¶ˆè€— CPUï¼Œä¸ç”¨å»è€ƒè™‘å„ç§é”çš„é—®é¢˜ï¼Œä¸å­˜åœ¨åŠ é”é‡Šæ”¾é”æ“ä½œï¼Œæ²¡æœ‰å› ä¸ºå¯èƒ½å‡ºç°æ­»é”è€Œå¯¼è‡´çš„æ€§èƒ½æ¶ˆè€—ï¼›</li></ol></li><li><ol start="4"><li>ä½¿ç”¨å¤šè·¯I/Oå¤ç”¨æ¨¡å‹ï¼Œéé˜»å¡IOï¼›</li></ol></li><li><ol start="5"><li>ä½¿ç”¨åº•å±‚æ¨¡å‹ä¸åŒï¼Œå®ƒä»¬ä¹‹é—´åº•å±‚å®ç°æ–¹å¼ä»¥åŠä¸å®¢æˆ·ç«¯ä¹‹é—´é€šä¿¡çš„åº”ç”¨åè®®ä¸ä¸€æ ·ï¼ŒRedisç›´æ¥è‡ªå·±æ„å»ºäº†VM æœºåˆ¶ ï¼Œå› ä¸ºä¸€èˆ¬çš„ç³»ç»Ÿè°ƒç”¨ç³»ç»Ÿå‡½æ•°çš„è¯ï¼Œä¼šæµªè´¹ä¸€å®šçš„æ—¶é—´å»ç§»åŠ¨å’Œè¯·æ±‚ï¼›</li></ol></li></ul><h4 id="å¤šè·¯-I-O-å¤ç”¨æ¨¡å‹"><a href="#å¤šè·¯-I-O-å¤ç”¨æ¨¡å‹" class="headerlink" title="å¤šè·¯ I/O å¤ç”¨æ¨¡å‹"></a>å¤šè·¯ I/O å¤ç”¨æ¨¡å‹</h4><p>å¤šè·¯I/Oå¤ç”¨æ¨¡å‹æ˜¯åˆ©ç”¨ selectã€pollã€epoll å¯ä»¥åŒæ—¶ç›‘å¯Ÿå¤šä¸ªæµçš„ I/O äº‹ä»¶çš„èƒ½åŠ›ï¼Œåœ¨ç©ºé—²çš„æ—¶å€™ï¼Œä¼šæŠŠå½“å‰çº¿ç¨‹é˜»å¡æ‰ï¼Œå½“æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªæµæœ‰ I/O äº‹ä»¶æ—¶ï¼Œå°±ä»é˜»å¡æ€ä¸­å”¤é†’ï¼Œäºæ˜¯ç¨‹åºå°±ä¼šè½®è¯¢ä¸€éæ‰€æœ‰çš„æµï¼ˆepoll æ˜¯åªè½®è¯¢é‚£äº›çœŸæ­£å‘å‡ºäº†äº‹ä»¶çš„æµï¼‰ï¼Œå¹¶ä¸”åªä¾æ¬¡é¡ºåºçš„å¤„ç†å°±ç»ªçš„æµï¼Œè¿™ç§åšæ³•å°±é¿å…äº†å¤§é‡çš„æ— ç”¨æ“ä½œã€‚</p><p>è¿™é‡Œâ€œå¤šè·¯â€æŒ‡çš„æ˜¯å¤šä¸ªç½‘ç»œè¿æ¥ï¼Œâ€œå¤ç”¨â€æŒ‡çš„æ˜¯å¤ç”¨åŒä¸€ä¸ªçº¿ç¨‹ã€‚</p><p>é‡‡ç”¨å¤šè·¯ I/O å¤ç”¨æŠ€æœ¯å¯ä»¥è®©å•ä¸ªçº¿ç¨‹é«˜æ•ˆçš„å¤„ç†å¤šä¸ªè¿æ¥è¯·æ±‚ï¼ˆå°½é‡å‡å°‘ç½‘ç»œ IO çš„æ—¶é—´æ¶ˆè€—ï¼‰ï¼Œä¸” Redis åœ¨å†…å­˜ä¸­æ“ä½œæ•°æ®çš„é€Ÿåº¦éå¸¸å¿«ï¼Œä¹Ÿå°±æ˜¯è¯´å†…å­˜å†…çš„æ“ä½œä¸ä¼šæˆä¸ºå½±å“Redisæ€§èƒ½çš„ç“¶é¢ˆï¼Œä¸»è¦ç”±ä»¥ä¸Šå‡ ç‚¹é€ å°±äº† Redis å…·æœ‰å¾ˆé«˜çš„ååé‡ã€‚</p><h3 id="Redisä¸ºä»€ä¹ˆæ˜¯å•çº¿ç¨‹çš„"><a href="#Redisä¸ºä»€ä¹ˆæ˜¯å•çº¿ç¨‹çš„" class="headerlink" title="Redisä¸ºä»€ä¹ˆæ˜¯å•çº¿ç¨‹çš„"></a>Redisä¸ºä»€ä¹ˆæ˜¯å•çº¿ç¨‹çš„</h3><blockquote><p>å®˜æ–¹FAQè¡¨ç¤ºï¼Œå› ä¸ºRedisæ˜¯åŸºäºå†…å­˜çš„æ“ä½œï¼ŒCPUä¸æ˜¯Redisçš„ç“¶é¢ˆï¼ŒRedisçš„ç“¶é¢ˆæœ€æœ‰å¯èƒ½æ˜¯æœºå™¨å†…å­˜çš„å¤§å°æˆ–è€…ç½‘ç»œå¸¦å®½ã€‚æ—¢ç„¶å•çº¿ç¨‹å®¹æ˜“å®ç°ï¼Œè€Œä¸”CPUä¸ä¼šæˆä¸ºç“¶é¢ˆï¼Œé‚£å°±é¡ºç†æˆç« åœ°é‡‡ç”¨å•çº¿ç¨‹çš„æ–¹æ¡ˆäº†ï¼ˆæ¯•ç«Ÿé‡‡ç”¨å¤šçº¿ç¨‹ä¼šæœ‰å¾ˆå¤šéº»çƒ¦ï¼ï¼‰ã€‚</p></blockquote><p><code>æ³¨1</code>ï¼šè¿™é‡Œæˆ‘ä»¬ä¸€ç›´åœ¨å¼ºè°ƒçš„å•çº¿ç¨‹ï¼Œåªæ˜¯åœ¨<code>å¤„ç†æˆ‘ä»¬çš„ç½‘ç»œè¯·æ±‚</code>çš„æ—¶å€™åªæœ‰ä¸€ä¸ªçº¿ç¨‹æ¥å¤„ç†ï¼Œä¸€ä¸ªæ­£å¼çš„Redis Serverè¿è¡Œçš„æ—¶å€™è‚¯å®šæ˜¯ä¸æ­¢ä¸€ä¸ªçº¿ç¨‹çš„ï¼Œè¿™é‡Œéœ€è¦å¤§å®¶æ˜ç¡®çš„æ³¨æ„ä¸€ä¸‹ï¼<br>ä¾‹å¦‚Redisè¿›è¡ŒæŒä¹…åŒ–çš„æ—¶å€™ä¼šä»¥å­è¿›ç¨‹æˆ–è€…å­çº¿ç¨‹çš„æ–¹å¼æ‰§è¡Œï¼ˆå…·ä½“æ˜¯å­çº¿ç¨‹è¿˜æ˜¯å­è¿›ç¨‹å¾…è¯»è€…æ·±å…¥ç ”ç©¶ï¼‰</p><p><code>æ³¨2</code>ï¼šä»Redis 4.0ç‰ˆæœ¬å¼€å§‹ä¼šæ”¯æŒå¤šçº¿ç¨‹çš„æ–¹å¼ï¼Œä½†æ˜¯ï¼Œåªæ˜¯åœ¨æŸä¸€äº›æ“ä½œä¸Šè¿›è¡Œå¤šçº¿ç¨‹çš„æ“ä½œï¼ä»¥åçš„ç‰ˆæœ¬ä¸­æ˜¯å¦è¿˜æ˜¯å•çº¿ç¨‹çš„æ–¹å¼éœ€è¦è€ƒè¯ï¼</p>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®°æœ¬ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Redis </tag>
            
            <tag> åŸç† </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åˆ©ç”¨GitHubåšå›¾åºŠ</title>
      <link href="post/669728936/"/>
      <url>post/669728936/</url>
      
        <content type="html"><![CDATA[<blockquote><p>å…³äº<code>GitHub</code>çš„éªšæ“ä½œä¸€ç›´ä»¥æ¥éƒ½æœ‰å¾ˆå¤šï¼Œè¿™ç¯‡æ–‡ç« è®°å½•ä¸€ä¸‹ä½¿ç”¨<code>github</code>çš„<code>raw</code>åšä¸€ä¸ªåŸºäºGitHubçš„<code>MarkDown</code>å›¾åºŠï¼Œå…è´¹è¿˜ä¸é™æµé‡ï¼Œè¿˜å¾ˆ<code>Geek</code></p></blockquote><h3 id="åœ¨GitHubä¸Šæ–°å»ºä¸€ä¸ªrepository"><a href="#åœ¨GitHubä¸Šæ–°å»ºä¸€ä¸ªrepository" class="headerlink" title="åœ¨GitHubä¸Šæ–°å»ºä¸€ä¸ªrepository"></a>åœ¨GitHubä¸Šæ–°å»ºä¸€ä¸ªrepository</h3><p>é¦–å…ˆï¼Œåœ¨<code>Github</code>ä¸Šæ–°å»ºä¸€ä¸ªä¸“é—¨ç”¨æ¥æ”¾å›¾ç‰‡çš„<code>repository</code>ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/cayzlh/git-img-repository@master/2020/04/25/s7Rw7W.png" alt="æ–°å»ºä¸€ä¸ªrepository"></p><h3 id="åˆ©ç”¨GitHub-Desktopä¸Šä¼ å›¾ç‰‡"><a href="#åˆ©ç”¨GitHub-Desktopä¸Šä¼ å›¾ç‰‡" class="headerlink" title="åˆ©ç”¨GitHub Desktopä¸Šä¼ å›¾ç‰‡"></a>åˆ©ç”¨GitHub Desktopä¸Šä¼ å›¾ç‰‡</h3><p><img src="https://gitee.com/cayzlh/img-repo/raw/master/2020/04/25/EWnrnY.png" alt="æ–°å»ºä¸€ä¸ªrepository"></p><h3 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h3><p>ä¸Šä¼ åˆ°GitHubä¸Šä¹‹åçš„å›¾ç‰‡è¿æ¥å¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line">https://github.com/yourname/imgRepository/raw/master/youDirectory/1.png</span><br></pre></td></tr></table></figure><h3 id="é…åˆuPicä½¿ç”¨"><a href="#é…åˆuPicä½¿ç”¨" class="headerlink" title="é…åˆuPicä½¿ç”¨"></a>é…åˆuPicä½¿ç”¨</h3><p>ä½¿ç”¨<code>uPic</code>(Mac)å¿«é€Ÿä¸Šä¼ åˆ°<code>GitHub</code>å›¾åºŠã€‚</p><blockquote><p>é™¤äº†GitHubè¿˜æ”¯æŒå…¶ä»–å¤šç§å›¾åºŠ</p></blockquote><p><img src="https://gitee.com/cayzlh/img-repo/raw/master/2020/04/25/JBNFMM.png" alt="image-20200425074922010"></p><p>è®¾ç½®å¥½å›¾åºŠä¹‹åï¼Œåªéœ€è¦æ ¹æ®å¿«æ·é”®æˆ–é€‰æ‹©æ–‡ä»¶ä¸Šä¼ ï¼Œå³å¯è·å¾—<code>markdown</code>æ ¼å¼çš„é“¾æ¥æˆ–å…¶ä»–æ ¼å¼çš„é“¾æ¥ï¼Œéå¸¸æ–¹ä¾¿ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/cayzlh/git-img-repository@master/2020/04/25/7HnlRK.png" alt="image-20200425075205584"></p><p>ä¸Šä¼ å®Œæˆä¹‹åï¼ŒMarkdownæ ¼å¼çš„é“¾æ¥å°±è‡ªåŠ¨çš„ä¿å­˜åˆ°ä½ çš„å‰ªè´´æ¿å½“ä¸­ã€‚</p><h3 id="é…åˆtyporaä½¿ç”¨"><a href="#é…åˆtyporaä½¿ç”¨" class="headerlink" title="é…åˆtyporaä½¿ç”¨"></a>é…åˆtyporaä½¿ç”¨</h3><p>åœ¨<code>typora</code>çš„è®¾ç½®ä¸­å¼€å¯å›¾ç‰‡è‡ªåŠ¨ä¸Šä¼ ï¼Œå½“åœ¨typoraæ’å…¥å›¾ç‰‡ä¹‹åï¼Œè‡ªåŠ¨å°†å›¾ç‰‡ä¸Šä¼ åˆ°å›¾åºŠã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/cayzlh/git-img-repository@master/2020/04/25/iQMV0z.png" alt="image-20200425075355415"></p>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®°æœ¬ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Github </tag>
            
            <tag> Git </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JVM (å†…å­˜åŒºåŸŸæ§åˆ¶å‚æ•°åŠå¯¹åº”æº¢å‡ºå¼‚å¸¸)</title>
      <link href="post/95c0309a/"/>
      <url>post/95c0309a/</url>
      
        <content type="html"><![CDATA[<blockquote><p>å¼€å‘è¿‡ç¨‹ä¸­ï¼Œæˆ–ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­æ¯æ¬¡é‡åˆ°OutOfMemoryå¼‚å¸¸æˆ–GCå¼‚å¸¸æˆ–StackOverflowErrorå¼‚å¸¸æˆ‘ä»¬éƒ½æ˜¯ä¸€å †å‚æ•°ä¹±é…ï¼Œ<br>éƒ½æŠŠå€¼è°ƒå¤§ï¼Œåªæ˜¯å¤§ä½“çŸ¥é“æ˜¯è·Ÿjvmå†…å­˜åˆ†é…æœ‰å…³, å…·ä½“åº”è¯¥æ€ä¹ˆè°ƒï¼Œå¯¹åº”çš„å¼‚å¸¸åº”è¯¥è°ƒæ•´é‚£äº›å‚æ•°ï¼Œ<br>æˆ–è€…æ¢å¥è¯è¯´ï¼Œjvmå†…å­˜åˆ†é…åŒºåŸŸä¸­éƒ½åˆ†åˆ«å¯¹åº”é‚£äº›å‚æ•°å¤§å¤šæ•°æƒ…å†µä¸‹éƒ½æ˜¯ä¸çŸ¥é“çš„ï¼Œåªæ˜¯æŠŠç›¸å…³çš„å‚æ•°è·³ä¸Šå»ï¼Œé¢„æœŸç»“æœéƒ½æ˜¯åº”è¯¥èµ·ä½œç”¨ï¼Œåˆ°åº•èƒ½ä¸èƒ½èµ·ä½œç”¨ï¼Œè‡ªå·±å¿ƒé‡Œä¹Ÿæ²¡åº•ã€‚<br>ä¸‹é¢å°±æ¥è¯´ä¸€ä¸‹jvmå †ã€æ ˆã€æ–¹æ³•åŒºç­‰å†…å­˜åŒºåŸŸå¯¹åº”çš„å‚æ•°ï¼ŒåŠæ¯ä¸ªåŒºåŸŸå¯èƒ½æŠ›å‡ºçš„å¼‚å¸¸ç±»å‹ï¼Œå‘ç”Ÿå¼‚å¸¸çš„åœºæ™¯åˆ†æã€‚ </p></blockquote><h3 id="å‚æ•°ç±»å‹"><a href="#å‚æ•°ç±»å‹" class="headerlink" title="å‚æ•°ç±»å‹"></a>å‚æ•°ç±»å‹</h3><ul><li>å †ç©ºé—´å‚æ•°</li><li>æ ˆç©ºé—´å‚æ•°</li><li>æ–¹æ³•åŒºç©ºé—´å‚æ•°</li><li>æœ¬æœºç›´æ¥å†…å­˜å‚æ•°</li></ul><h3 id="å¼‚å¸¸ç±»å‹"><a href="#å¼‚å¸¸ç±»å‹" class="headerlink" title="å¼‚å¸¸ç±»å‹"></a>å¼‚å¸¸ç±»å‹</h3><ul><li>1.OutOfMemoryå¼‚å¸¸</li><li>2.StackOverflowErrorå¼‚å¸¸</li></ul><h3 id="è¾…åŠ©å‚æ•°è¯´æ˜"><a href="#è¾…åŠ©å‚æ•°è¯´æ˜" class="headerlink" title="è¾…åŠ©å‚æ•°è¯´æ˜"></a>è¾…åŠ©å‚æ•°è¯´æ˜</h3><ul><li>-XX:+HeapDumpOnOutOfMemoryError æ‰“å°å †å†…å­˜å¼‚å¸¸æ—¶æ‰“å°å‡ºå¿«ç…§ä¿¡æ¯</li><li>-XX:+HeapDumpPath å¿«ç…§è¾“å‡ºè·¯å¾„</li><li>-XmnæŒ‡å®šedenåŒºçš„å¤§å°</li><li>-XX:SurvirorRationæ¥è°ƒæ•´å¹¸å­˜åŒºçš„å¤§å°</li><li>-XX:PretenureSizeThresholdè®¾ç½®è¿›å…¥è€å¹´ä»£çš„é˜€å€¼</li></ul><h3 id="å‚æ•°è¯´æ˜ã€å¯¹åº”åœºæ™¯çš„å¼‚å¸¸"><a href="#å‚æ•°è¯´æ˜ã€å¯¹åº”åœºæ™¯çš„å¼‚å¸¸" class="headerlink" title="å‚æ•°è¯´æ˜ã€å¯¹åº”åœºæ™¯çš„å¼‚å¸¸"></a>å‚æ•°è¯´æ˜ã€å¯¹åº”åœºæ™¯çš„å¼‚å¸¸</h3><h4 id="å †å†…å­˜å‚æ•°"><a href="#å †å†…å­˜å‚æ•°" class="headerlink" title="å †å†…å­˜å‚æ•°"></a>å †å†…å­˜å‚æ•°</h4><p>-Xmsï¼šå †æœ€å°å€¼ï¼ˆæ–°ç”Ÿä»£å’Œè€å¹´ä»£ä¹‹å’Œï¼‰</p><p>-Xmxï¼šå †æœ€å¤§å€¼ï¼ˆæ–°ç”Ÿä»£å’Œè€å¹´ä»£ä¹‹å’Œï¼‰</p><p>å½“æœ€å°å€¼=æœ€å¤§å€¼æ—¶ï¼Œè¿™æ—¶å †å†…å­˜æ˜¯ä¸å¯æ‰©å±•çš„ã€‚</p><p>ä¾‹ï¼š-Xms80M -Xmx80M</p><p>é€šå¸¸å°†-Xmxå’Œ-Xmsè®¾ç½®ä¸ºä¸€æ ·çš„å¤§å°æ¥å‡å°‘gcçš„æ¬¡æ•°ï¼Œå †å†…å­˜ä¸è¶³æ—¶æŠ›å‡ºOutOfMemoryErrorå¼‚å¸¸ã€‚</p><h4 id="æ ˆå†…å­˜å‚æ•°"><a href="#æ ˆå†…å­˜å‚æ•°" class="headerlink" title="æ ˆå†…å­˜å‚æ•°"></a>æ ˆå†…å­˜å‚æ•°</h4><p>-Xss</p><p>ä¾‹ï¼š-Xss128k</p><p>å•çº¿ç¨‹ä¸‹æ— è®ºæ ˆå¸§å¤ªå¤§è¿˜æ˜¯æ ˆå®¹é‡å¤ªå°ï¼ŒåŠå¼•ç”¨æ·±åº¦è¶…è¿‡è™šæ‹Ÿæœºå…è®¸æ·±åº¦éƒ½ä¼šæŠ›å‡ºStackOverflowErroræ¯ä¸ªæ–¹æ³•å‹å…¥æ ˆçš„å¸§å¤§å°æ˜¯ä¸ä¸€è‡´çš„ã€‚<br>å¤šçº¿ç¨‹ä¸‹å½“æ¯ä¸ªçº¿ç¨‹åˆ†é…æ ˆå¸§å¤ªå¤§å†…å­˜ä¸èƒ½å¤Ÿæ‰©å±•æ—¶æŠ›å‡ºOutOfMemoryErrorå¼‚å¸¸çº¿ç¨‹æ ˆå¸§è¶Šå¤§ï¼Œå¯åˆ›å»ºçš„çº¿ç¨‹è¶Šå°‘ã€‚</p><h4 id="æ–¹æ³•åŒºå‚æ•°"><a href="#æ–¹æ³•åŒºå‚æ•°" class="headerlink" title="æ–¹æ³•åŒºå‚æ•°"></a>æ–¹æ³•åŒºå‚æ•°</h4><p>-XX:PermSizeæ–¹æ³•åŒºå†…å­˜æœ€å°å€¼</p><p>-XX:MaxPermSize æ–¹æ³•åŒºå†…å­˜æœ€å¤§å€¼</p><p>å„ä¸ªçº¿ç¨‹å…±äº«çš„å†…å­˜åŒºåŸŸï¼Œä¸»è¦ç”¨æ¥å­˜å‚¨ç±»çš„å…ƒæ•°æ®ã€å¸¸é‡ã€é™æ€å˜é‡ã€å³æ—¶ç¼–è¯‘å™¨ç¼–è¯‘åçš„ä»£ç ç­‰æ•°æ®</p><p>ä¾‹ï¼š-XX:PermSize=20M -XX:MaxPermSize=20M</p><p>å¼‚å¸¸ç±»å‹ OutOfMemoryError :</p><p>åŸå› ï¼šå¸¸é‡è¿‡å¤šï¼Œæˆ–ä»£ç†åå°„ç­‰ä½¿ç”¨é¢‘ç¹</p><h4 id="æœ¬æœºç›´æ¥å†…å­˜å‚æ•°"><a href="#æœ¬æœºç›´æ¥å†…å­˜å‚æ•°" class="headerlink" title="æœ¬æœºç›´æ¥å†…å­˜å‚æ•°"></a>æœ¬æœºç›´æ¥å†…å­˜å‚æ•°</h4><p>-XX:MaxDirectMemorySize</p><p>ä¾‹ï¼š-XX:MaxDirectMemorySize=10M</p><p>ä¸è¶³æ—¶æŠ›å‡ºOutOfMemoryå¼‚å¸¸</p>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹æŠ€æœ¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> JVM </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JVM (åƒåœ¾æ”¶é›†)</title>
      <link href="post/99ebe472/"/>
      <url>post/99ebe472/</url>
      
        <content type="html"><![CDATA[<h2 id="åƒåœ¾æ”¶é›†ç®—æ³•"><a href="#åƒåœ¾æ”¶é›†ç®—æ³•" class="headerlink" title="åƒåœ¾æ”¶é›†ç®—æ³•"></a>åƒåœ¾æ”¶é›†ç®—æ³•</h2><p>ç»å…¸çš„åƒåœ¾å›æ”¶ç®—æ³•ä»¥ä¸‹å‡ ç§ï¼š</p><h3 id="æ ‡è®°â€“æ¸…é™¤ç®—æ³•-Mark-Sweep"><a href="#æ ‡è®°â€“æ¸…é™¤ç®—æ³•-Mark-Sweep" class="headerlink" title="æ ‡è®°â€“æ¸…é™¤ç®—æ³•(Mark-Sweep)"></a>æ ‡è®°â€“æ¸…é™¤ç®—æ³•(Mark-Sweep)</h3><p>å›æ”¶å‰çŠ¶æ€ï¼š</p><p><img src="https://github.com/cayzlh/git-img-repository/raw/master/blog/before.png" alt="å›æ”¶å‰"></p><p>å›æ”¶åçŠ¶æ€ï¼š</p><p><img src="https://github.com/cayzlh/git-img-repository/raw/master/blog/before.png" alt="å›æ”¶å"></p><h4 id="ä¼˜ç¼ºç‚¹ï¼š"><a href="#ä¼˜ç¼ºç‚¹ï¼š" class="headerlink" title="ä¼˜ç¼ºç‚¹ï¼š"></a>ä¼˜ç¼ºç‚¹ï¼š</h4><p>ä¼˜ç‚¹ï¼šç®—æ³•æ‰§è¡Œåˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µæ ‡è®°ä¸æ¸…é™¤ï¼Œæ‰€æœ‰çš„å›æ”¶ç®—æ³•ï¼ŒåŸºæœ¬éƒ½åŸºäºæ ‡è®°å›æ”¶ç®—æ³•åšäº†æ·±åº¦ä¼˜åŒ–</p><p>ç¼ºç‚¹ï¼šæ•ˆç‡é—®é¢˜ï¼Œå†…å­˜ç©ºé—´ç¢ç‰‡ï¼ˆä¸è¿ç»­çš„ç©ºé—´ï¼‰</p><h3 id="å¤åˆ¶ç®—æ³•-Copying"><a href="#å¤åˆ¶ç®—æ³•-Copying" class="headerlink" title="å¤åˆ¶ç®—æ³•(Copying)"></a>å¤åˆ¶ç®—æ³•(Copying)</h3><p>å›æ”¶å‰çŠ¶æ€ï¼š</p><p>Edenå†…å­˜ç©ºé—´ 8</p><p><img src="https://github.com/cayzlh/git-img-repository/raw/master/blog/Eden8.png" alt="Edenå†…å­˜ç©ºé—´ 8"></p><p>Survivor1ç©ºé—´ï¼ˆFromç©ºé—´ï¼‰1</p><p><img src="https://github.com/cayzlh/git-img-repository/raw/master/blog/Survivor1.png" alt="Survivor1ç©ºé—´ï¼ˆFromç©ºé—´ï¼‰1"></p><p>Survivor2ç©ºé—´(Toç©ºé—´) 1</p><p><img src="https://github.com/cayzlh/git-img-repository/raw/master/blog/Survivor2.png" alt="Survivor2ç©ºé—´(Toç©ºé—´) 1"></p><p>Edenå†…å­˜ç©ºé—´ä¸Survivorç©ºé—´ 8:1</p><p><img src="https://github.com/cayzlh/git-img-repository/raw/master/blog/Eden_Survivor_8-1.png" alt="Edenå†…å­˜ç©ºé—´ä¸Survivorç©ºé—´ 8:1"></p><p>å›æ”¶åçŠ¶æ€ï¼š</p><p><img src="https://github.com/cayzlh/git-img-repository/raw/master/blog/aftergc.png" alt="å›æ”¶åçŠ¶æ€"></p><p>Survivor1ç©ºé—´ï¼ˆFromç©ºé—´ï¼‰1</p><p><img src="https://github.com/cayzlh/git-img-repository/raw/master/blog/Survivor11.png" alt="Survivor1ç©ºé—´ï¼ˆFromç©ºé—´ï¼‰1"></p><p>Edenå†…å­˜ç©ºé—´ä¸Survivorç©ºé—´ 8:1</p><p><img src="https://github.com/cayzlh/git-img-repository/raw/master/blog/EdenSurvivor8-1.png" alt="Edenå†…å­˜ç©ºé—´ä¸Survivorç©ºé—´ 8:1"></p><h4 id="ä¼˜ç¼ºç‚¹ï¼š-1"><a href="#ä¼˜ç¼ºç‚¹ï¼š-1" class="headerlink" title="ä¼˜ç¼ºç‚¹ï¼š"></a>ä¼˜ç¼ºç‚¹ï¼š</h4><p>ä¼˜ç‚¹æ¯”è¾ƒæ ‡è®°æ¸…é™¤ç®—æ³•ï¼Œé¿å…äº†å›æ”¶é€ æˆçš„å†…å­˜ç¢ç‰‡é—®é¢˜</p><p>ç¼ºç‚¹ï¼šä»¥å±€éƒ¨çš„å†…å­˜ç©ºé—´ç‰ºç‰²ä¸ºä»£ä»·ï¼Œä¸è¿‡ç©ºé—´çš„æµªè´¹æ¯”è¾ƒå°ï¼Œé»˜è®¤8:1çš„æ¯”ä¾‹1æ˜¯æµªè´¹çš„ã€‚å¤åˆ¶ä¹Ÿæœ‰ä¸€å®šçš„æ•ˆç‡ä¸ç©ºé—´æˆæœ¬</p><h3 id="æ ‡è®°æ•´ç†ç®—æ³•-Mark-Compact"><a href="#æ ‡è®°æ•´ç†ç®—æ³•-Mark-Compact" class="headerlink" title="æ ‡è®°æ•´ç†ç®—æ³•(Mark-Compact)"></a>æ ‡è®°æ•´ç†ç®—æ³•(Mark-Compact)</h3><p>å›æ”¶å‰çŠ¶æ€ï¼š</p><p><img src="https://github.com/cayzlh/git-img-repository/raw/master/blog/201808190401.png" alt="å›æ”¶å‰çŠ¶æ€"></p><p>å›æ”¶åçŠ¶æ€ï¼š</p><p><img src="https://github.com/cayzlh/git-img-repository/raw/master/blog/201808190402.png" alt="å›æ”¶å‰çŠ¶æ€"></p><h4 id="ä¼˜ç¼ºç‚¹ï¼š-2"><a href="#ä¼˜ç¼ºç‚¹ï¼š-2" class="headerlink" title="ä¼˜ç¼ºç‚¹ï¼š"></a>ä¼˜ç¼ºç‚¹ï¼š</h4><p>ä¼˜ç‚¹ï¼šé¿å…äº†ï¼Œç©ºé—´çš„æµªè´¹ï¼Œä¸å†…å­˜ç¢ç‰‡é—®é¢˜ã€‚</p><p>ç¼ºç‚¹ï¼šæ•´ç†æ—¶å¤åˆ¶æœ‰æ•ˆç‡æˆæœ¬ã€‚<br>â€‹     </p><h2 id="åƒåœ¾æ”¶é›†å™¨"><a href="#åƒåœ¾æ”¶é›†å™¨" class="headerlink" title="åƒåœ¾æ”¶é›†å™¨"></a>åƒåœ¾æ”¶é›†å™¨</h2><h3 id="ä¸ƒç§åƒåœ¾æ”¶é›†å™¨"><a href="#ä¸ƒç§åƒåœ¾æ”¶é›†å™¨" class="headerlink" title="ä¸ƒç§åƒåœ¾æ”¶é›†å™¨"></a>ä¸ƒç§åƒåœ¾æ”¶é›†å™¨</h3><ul><li>1ã€ Serialï¼ˆä¸²è¡ŒGCï¼‰-XX:+UseSerialGC</li><li>2ã€ ParNewï¼ˆå¹¶è¡ŒGCï¼‰-XX:+UseParNewGC</li><li>3ã€ Parallel Scavengeï¼ˆå¹¶è¡Œå›æ”¶GCï¼‰</li><li>4ã€ Serial Oldï¼ˆMSCï¼‰ï¼ˆä¸²è¡ŒGCï¼‰-XX:+UseSerialGC</li><li>5ã€ CMSï¼ˆå¹¶å‘GCï¼‰-XX:+UseConcMarkSweepGC</li><li>6ã€ Parallel Oldï¼ˆå¹¶è¡ŒGCï¼‰-XX:+UseParallelOldGC</li><li>7ã€ G1ï¼ˆJDK1.7update14æ‰å¯ä»¥æ­£å¼å•†ç”¨ï¼‰</li></ul><p><img src="https://github.com/cayzlh/git-img-repository/raw/master/blog/201808190403.png" alt="ä¸ƒç§åƒåœ¾æ”¶é›†å™¨"></p><h3 id="è°ƒä¼˜æ–¹æ³•"><a href="#è°ƒä¼˜æ–¹æ³•" class="headerlink" title="è°ƒä¼˜æ–¹æ³•"></a>è°ƒä¼˜æ–¹æ³•</h3><h4 id="æ–°å¯¹è±¡é¢„ç•™æ–°ç”Ÿä»£"><a href="#æ–°å¯¹è±¡é¢„ç•™æ–°ç”Ÿä»£" class="headerlink" title="æ–°å¯¹è±¡é¢„ç•™æ–°ç”Ÿä»£"></a>æ–°å¯¹è±¡é¢„ç•™æ–°ç”Ÿä»£</h4><p>ç”±äºfullGC(è€å¹´ä»£)çš„æˆæœ¬è¿œæ¯”minorGCï¼ˆæ–°ç”Ÿä»£å’Œè€å¹´ä»£ï¼‰çš„æˆæœ¬å¤§ï¼Œæ‰€ä»¥ç»™åº”ç”¨åˆ†é…ä¸€ä¸ªåˆç†çš„æ–°ç”Ÿä»£ç©ºé—´ï¼Œå°½é‡å°†å¯¹è±¡åˆ†é…åˆ°æ–°ç”Ÿä»£å‡å°fullGCçš„é¢‘ç‡</p><h4 id="å¤§å¯¹è±¡è¿›å…¥è€å¹´ä»£"><a href="#å¤§å¯¹è±¡è¿›å…¥è€å¹´ä»£" class="headerlink" title="å¤§å¯¹è±¡è¿›å…¥è€å¹´ä»£"></a>å¤§å¯¹è±¡è¿›å…¥è€å¹´ä»£</h4><p>å°†å¤§å¯¹è±¡ç›´æ¥åˆ†é…åˆ°è€å¹´ä»£ï¼Œä¿æŒæ–°ç”Ÿä»£å¯¹è±¡çš„ç»“æ„çš„å®Œæ•´æ€§ï¼Œä»¥æé«˜GCæ•ˆç‡ï¼Œ ä»¥é€šè¿‡-XX:PretenureSizeThresholdè®¾ç½®è¿›å…¥è€å¹´ä»£çš„é˜€å€¼</p><h4 id="ç¨³å®šä¸éœ‡è¡çš„å †å¤§å°"><a href="#ç¨³å®šä¸éœ‡è¡çš„å †å¤§å°" class="headerlink" title="ç¨³å®šä¸éœ‡è¡çš„å †å¤§å°"></a>ç¨³å®šä¸éœ‡è¡çš„å †å¤§å°</h4><p>ç¨³å®šçš„å¯¹å¤§å°æ˜¯å¯¹åƒåœ¾å›æ”¶æœ‰åˆ©çš„ï¼Œæ–¹æ³•å°†-Xmså’Œ-Xmxçš„å¤§å°ä¸€è‡´</p><h4 id="ååé‡ä¼˜å…ˆ"><a href="#ååé‡ä¼˜å…ˆ" class="headerlink" title="ååé‡ä¼˜å…ˆ"></a>ååé‡ä¼˜å…ˆ</h4><p>å°½å¯èƒ½å‡å°‘ç³»ç»Ÿæ‰§è¡Œåƒåœ¾å›æ”¶çš„æ€»æ—¶é—´ï¼Œæ•…é‡‡ç”¨å¹¶è¡Œåƒåœ¾å›æ”¶å™¨</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">-XX:+UseParallelGCæˆ–ä½¿ç”¨-XX:+UseParallelOldGC</span><br></pre></td></tr></table></figure><h4 id="é™ä½åœé¡¿"><a href="#é™ä½åœé¡¿" class="headerlink" title="é™ä½åœé¡¿"></a>é™ä½åœé¡¿</h4><p>ä½¿ç”¨CMSå›æ”¶å™¨,åŒæ—¶å‡å°‘fullGCçš„æ¬¡æ•°</p><h3 id="è·å–gcä¿¡æ¯çš„æ–¹æ³•"><a href="#è·å–gcä¿¡æ¯çš„æ–¹æ³•" class="headerlink" title="è·å–gcä¿¡æ¯çš„æ–¹æ³•"></a>è·å–gcä¿¡æ¯çš„æ–¹æ³•</h3><ul><li> <code>-verbose:gcæˆ–è€…-XX:+PrintGC</code>ã€€ã€€è·å–gcä¿¡æ¯</li><li> <code>-XX:+PrintGCDetails</code>ã€€ã€€è·å–æ›´åŠ è¯¦ç»†çš„gcä¿¡æ¯</li><li> <code>-XX:+PrintGCTimeStamps</code>ã€€ã€€è·å–GCçš„é¢‘ç‡å’Œé—´éš”</li><li> <code>-XX:+PrintHeapAtGC</code>ã€€ã€€è·å–å †çš„ä½¿ç”¨æƒ…å†µ</li><li> <code>-Xloggc:D:\gc.log</code>ã€€ã€€æŒ‡å®šæ—¥å¿—æƒ…å†µçš„ä¿å­˜è·¯å¾„</li></ul><h3 id="jvmè°ƒä¼˜å®æˆ˜-tomcatå¯åŠ¨åŠ é€Ÿ"><a href="#jvmè°ƒä¼˜å®æˆ˜-tomcatå¯åŠ¨åŠ é€Ÿ" class="headerlink" title="jvmè°ƒä¼˜å®æˆ˜-tomcatå¯åŠ¨åŠ é€Ÿ"></a>jvmè°ƒä¼˜å®æˆ˜-tomcatå¯åŠ¨åŠ é€Ÿ</h3><p>åœ¨tomcatçš„bin/catalina.batæ–‡ä»¶çš„å¼€å¤´æ·»åŠ ç›¸å…³çš„é…ç½®</p>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹æŠ€æœ¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> JVM </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JVM (å¯¹è±¡è®¿é—®å†…éƒ¨å®ç°è¿‡ç¨‹)</title>
      <link href="post/e43d0ef1/"/>
      <url>post/e43d0ef1/</url>
      
        <content type="html"><![CDATA[<blockquote><p>å¯¹è±¡è®¿é—® æ¶‰åŠåˆ°å¯¹è±¡çš„åœ°å€å˜æ›´çŠ¶æ€å˜æ›´ï¼Œå†…å­˜åœ°å€ç§»åŠ¨ï¼Œå˜é‡ã€æ¥å£ã€å®ç°ç±»ã€æ–¹æ³•ã€çˆ¶ç±»å‹ç­‰ã€‚</p></blockquote><h3 id="å¥æŸ„æ–¹å¼-è®¿é—®"><a href="#å¥æŸ„æ–¹å¼-è®¿é—®" class="headerlink" title="å¥æŸ„æ–¹å¼ (è®¿é—®)"></a>å¥æŸ„æ–¹å¼ (è®¿é—®)</h3><p><img src="https://github.com/cayzlh/git-img-repository/raw/master/blog/jubing.png" alt="å¥æŸ„æ–¹å¼"></p><h3 id="æŒ‡é’ˆæ–¹å¼-è®¿é—®"><a href="#æŒ‡é’ˆæ–¹å¼-è®¿é—®" class="headerlink" title="æŒ‡é’ˆæ–¹å¼ (è®¿é—®)"></a>æŒ‡é’ˆæ–¹å¼ (è®¿é—®)</h3><p><img src="https://github.com/cayzlh/git-img-repository/raw/master/blog/zhizhen.png" alt="æŒ‡é’ˆæ–¹å¼"></p><h3 id="ä¼˜ç¼ºç‚¹"><a href="#ä¼˜ç¼ºç‚¹" class="headerlink" title="ä¼˜ç¼ºç‚¹"></a>ä¼˜ç¼ºç‚¹</h3><p>å¥æŸ„è®¿é—®æ–¹å¼ï¼šreferenceä¸­å­˜å‚¨çš„æ˜¯ç¨³å®šçš„åœ°å€ï¼Œå¯¹è±¡å˜æ›´æ—¶åªä¼šæ”¹å˜å¥æŸ„å®ä¾‹æ•°æ®æŒ‡é’ˆï¼Œå¼•ç”¨æœ¬èº«ä¸éœ€è¦ä¿®æ”¹ã€‚</p><p>æŒ‡é’ˆè®¿é—®æ–¹å¼ï¼šä¼˜ç‚¹é€Ÿåº¦å¿«ï¼ŒèŠ‚çœäº†æŒ‡é’ˆå®šä½æ—¶é—´å¼€é”€ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹æŠ€æœ¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> JVM </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JVM (è™šæ‹Ÿæœºå†…å­˜)</title>
      <link href="post/b8276f2d/"/>
      <url>post/b8276f2d/</url>
      
        <content type="html"><![CDATA[<blockquote><p>JAVAç¨‹åºè¿è¡Œä¸è™šæ‹Ÿæœºä¹‹ä¸Šï¼Œè¿è¡Œæ—¶éœ€è¦å†…å­˜ç©ºé—´ã€‚è™šæ‹Ÿæœºæ‰§è¡ŒJAVAç¨‹åºçš„è¿‡ç¨‹ä¸­ä¼šæŠŠå®ƒç®¡ç†çš„å†…å­˜åˆ’åˆ†ä¸ºä¸åŒçš„æ•°æ®åŒºåŸŸæ–¹ä¾¿ç®¡ç†ã€‚</p></blockquote><p>è™šæ‹Ÿæœºç®¡ç†å†…å­˜æ•°æ®åŒºåŸŸåˆ’åˆ†å¦‚ä¸‹å›¾ï¼š</p><p><img src="https://github.com/cayzlh/git-img-repository/raw/master/blog/Runtime-data-area.png" alt="è™šæ‹Ÿæœºç®¡ç†å†…å­˜æ•°æ®åŒºåŸŸåˆ’åˆ†"></p><h3 id="æ•°æ®åŒºåŸŸåˆ†ç±»"><a href="#æ•°æ®åŒºåŸŸåˆ†ç±»" class="headerlink" title="æ•°æ®åŒºåŸŸåˆ†ç±»:"></a>æ•°æ®åŒºåŸŸåˆ†ç±»:</h3><ul><li>æ–¹æ³•åŒºï¼š(Method Area)</li><li>è™šæ‹Ÿæœºæ ˆï¼š(VM Stack)</li><li>æœ¬åœ°æ–¹æ³•æ ˆ ï¼š(Native Method Stack)</li><li>å †ï¼š(Heap)</li><li>ç¨‹åºè®¡æ•°å™¨ ï¼š(Program Counter Register)</li><li>ç›´æ¥å†…å­˜ï¼š(Direct Memory)</li></ul><p>è¯´æ˜ï¼š</p><h4 id="ç¨‹åºè®¡æ•°å™¨"><a href="#ç¨‹åºè®¡æ•°å™¨" class="headerlink" title="ç¨‹åºè®¡æ•°å™¨"></a>ç¨‹åºè®¡æ•°å™¨</h4><p>è¡Œå·æŒ‡ç¤ºå™¨ï¼Œå­—èŠ‚ç æŒ‡ä»¤çš„åˆ†æ”¯ã€å¾ªç¯ã€è·³è½¬ã€å¼‚å¸¸å¤„ç†ã€çº¿ç¨‹æ¢å¤(CPUåˆ‡æ¢)ï¼Œæ¯æ¡çº¿ç¨‹éƒ½éœ€è¦ä¸€ä¸ªç‹¬ç«‹çš„è®¡æ•°å™¨ï¼Œçº¿ç¨‹ç§æœ‰å†…å­˜äº’ä¸å½±å“,è¯¥åŒºåŸŸä¸ä¼šå‘ç”Ÿå†…å­˜æº¢å‡ºå¼‚å¸¸ã€‚</p><h4 id="è™šæ‹Ÿæœºæ ˆ"><a href="#è™šæ‹Ÿæœºæ ˆ" class="headerlink" title="è™šæ‹Ÿæœºæ ˆ"></a>è™šæ‹Ÿæœºæ ˆ</h4><p>æ˜¯çº¿ç¨‹ç§æœ‰çš„ï¼Œå£°æ˜å‘¨æœŸä¸çº¿ç¨‹ç›¸åŒï¼Œè™šæ‹Ÿæœºæ ˆæ˜¯Javaæ–¹æ³•æ‰§è¡Œçš„å†…å­˜æ¨¡å‹ï¼Œæ¯ä¸ªæ–¹æ³•è¢«æ‰§è¡Œæ—¶éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ ˆå¸§ï¼Œå³æ–¹æ³•è¿è¡ŒæœŸé—´çš„åŸºç¡€æ•°æ®ç»“æ„ã€‚<br>æ ˆå¸§ç”¨äºå­˜å‚¨ï¼šå±€éƒ¨å˜é‡è¡¨ã€æ“ä½œæ•°æ ˆã€åŠ¨æ€é“¾æ¥ã€æ–¹æ³•å‡ºå£ç­‰ï¼Œæ¯ä¸ªæ–¹æ³•æ‰§è¡Œä¸­éƒ½å¯¹åº”è™šæ‹Ÿæœºæ ˆå¸§ä»å…¥æ ˆåˆ°å¤„æ ˆçš„è¿‡ç¨‹ã€‚</p><p>æ˜¯ä¸€ç§æ•°æ®ç»“æ„ï¼Œæ˜¯è™šæ‹Ÿæœºä¸­çš„å±€éƒ¨å˜é‡è¡¨ï¼Œå¯¹åº”ç‰©ç†å±‚ä¹‹ä¸Šçš„ç¨‹åºæ•°æ®æ¨¡å‹ã€‚</p><p>å±€éƒ¨å˜é‡è¡¨ï¼Œæ˜¯ä¸€ç§ç¨‹åºè¿è¡Œæ•°æ®æ¨¡å‹ï¼Œå­˜æ”¾äº†ç¼–è¯‘æœŸå¯çŸ¥çš„å„ç§æ•°æ®ç±»å‹ä¾‹å¦‚ï¼š</p><p>Booleanã€byteã€charã€shortã€intã€floatã€longã€doubleã€å¯¹è±¡å¼•ç”¨ç±»å‹(å¯¹è±¡å†…å­˜åœ°å€å˜é‡ï¼ŒæŒ‡é’ˆæˆ–å¥æŸ„)ã€‚<br>ç¨‹åºè¿è¡Œæ—¶ï¼Œæ ¹æ®å±€éƒ¨å˜é‡è¡¨åˆ†é…æ ˆå¸§ç©ºé—´å¤§å°ï¼Œåœ¨è¿è¡Œä¸­ï¼Œå¤§å°æ˜¯ä¸å˜çš„å¼‚å¸¸ç±»å‹ï¼šstackOverFlowError çº¿ç¨‹è¯·æ±‚æ ˆæ·±åº¦å¤§äºè™šæ‹Ÿæœºå…è®¸æ·±åº¦ OutOfMemory å†…å­˜ç©ºé—´è€—å°½æ— æ³•è¿›è¡Œæ‰©å±•ã€‚</p><h4 id="æœ¬åœ°æ–¹æ³•æ ˆ"><a href="#æœ¬åœ°æ–¹æ³•æ ˆ" class="headerlink" title="æœ¬åœ°æ–¹æ³•æ ˆ"></a>æœ¬åœ°æ–¹æ³•æ ˆ</h4><p>ä¸è™šæ‹Ÿæœºæ ˆç±»ä¼¼ï¼Œè™šæ‹Ÿæœºæ ˆä¸ºJavaç¨‹åºæœåŠ¡ï¼Œæœ¬åœ°æ–¹æ³•æ ˆæ”¯æŒè™šæ‹Ÿæœºçš„è¿è¡ŒæœåŠ¡ï¼Œå…·ä½“å®ç°ç”±è™šæ‹Ÿæœºå‚å•†å†³å®šï¼Œä¹Ÿä¼šæŠ›å‡º stackOverFlowErrorã€OutOfMemoryå¼‚å¸¸ã€‚</p><h4 id="å †"><a href="#å †" class="headerlink" title="å †"></a>å †</h4><p>æ˜¯è™šæ‹Ÿæœºç®¡ç†å†…å­˜ä¸­æœ€å¤§çš„ä¸€éƒ¨åˆ†ï¼Œè¢«æ‰€æœ‰çº¿ç¨‹å…±äº«ï¼Œç”¨äºå­˜æ”¾å¯¹è±¡å®ä¾‹(å¯¹è±¡ã€æ•°ç»„)ï¼Œç‰©ç†ä¸Šä¸è¿ç»­çš„å†…å­˜ç©ºé—´ï¼Œç”±äºGCæ”¶é›†å™¨ï¼Œåˆ†ä»£æ”¶é›†ã€‚<br>æ‰€ä»¥åˆ’åˆ†ä¸ºï¼šæ–°ç”Ÿä»£ Edenã€From SurVivorç©ºé—´ã€To SurVivorç©ºé—´ï¼Œallot buffer(åˆ†é…ç©ºé—´)ï¼Œå¯èƒ½ä¼šåˆ’åˆ†å‡ºå¤šä¸ªçº¿ç¨‹ç§æœ‰çš„ç¼“å†²åŒºï¼Œè€å¹´ä»£ã€‚</p><h4 id="æ–¹æ³•åŒº"><a href="#æ–¹æ³•åŒº" class="headerlink" title="æ–¹æ³•åŒº"></a>æ–¹æ³•åŒº</h4><p>ä¸å †ä¸€æ ·å±äºçº¿ç¨‹å…±äº«çš„å†…å­˜åŒºåŸŸï¼Œç”¨äºå­˜å‚¨è™šæ‹ŸæœºåŠ è½½çš„ç±»ä¿¡æ¯ã€å¸¸é‡ã€é™æ€å˜é‡ã€å³æ—¶ç¼–è¯‘å™¨ç¼–è¯‘åçš„ä»£ç ï¼ˆåŠ¨æ€åŠ è½½OSGIï¼‰ç­‰æ•°æ®ã€‚ç†è®ºä¸Šå±äºjavaè™šæ‹Ÿæœºçš„ä¸€éƒ¨åˆ†ï¼Œä¸ºäº†åŒºåˆ†å¼€æ¥å«åš Non-Heapéå †ã€‚</p><p>è¿™ä¸ªåŒºåŸŸå¯ä»¥é€‰æ‹©ä¸è¿›è¡Œåƒåœ¾å›æ”¶ï¼Œè¯¥åŒºåŸŸå›æ”¶ç›®çš„ä¸»è¦æ˜¯å¸¸é‡æ± çš„å›æ”¶ï¼ŒåŠç±»å‹çš„å¸è½½class,å†…å­˜åŒºä¸è¶³æ—¶ä¼šæŠ›å‡ºOutOfMemoryå¼‚å¸¸</p><p>è¿è¡Œæ—¶å¸¸é‡æ± ï¼š</p><p>æ–¹æ³•åŒºçš„ä¸€éƒ¨åˆ†ï¼ŒClassçš„ç‰ˆæœ¬ã€å­—æ®µã€æ¥å£ã€æ–¹æ³•ç­‰ï¼ŒåŠç¼–è¯‘æœŸç”Ÿæˆçš„å„ç§å­—é¢é‡ã€ç¬¦å·å¼•ç”¨ï¼Œç¼–è¯‘ç±»åŠ è½½åå­˜æ”¾åœ¨è¯¥åŒºåŸŸã€‚ä¼šæŠ›å‡ºOutOfMemoryå¼‚å¸¸ã€‚</p><h4 id="ç›´æ¥å†…å­˜"><a href="#ç›´æ¥å†…å­˜" class="headerlink" title="ç›´æ¥å†…å­˜"></a>ç›´æ¥å†…å­˜</h4><p>ç›´æ¥å†…å­˜ä¸å±äºè™šæ‹Ÿå†…å­˜åŒºåŸŸï¼Œæ˜¯ä¸€ç§åŸºäºé€šé“ä¸ç¼“å†²åŒºçš„IOæ–¹å¼ï¼Œå¯ä»¥ä½¿ç”¨æœ¬åœ°å‡½æ•°ç›´æ¥åˆ†é…å †å¤–å†…å­˜ï¼Œåœ¨å †ä¸­å­˜å‚¨å¼•ç”¨çš„å¤–éƒ¨å†…å­˜åœ°å€ï¼Œé€šè¿‡å¼•ç”¨å®Œæˆå¯¹ç›´æ¥å¼•ç”¨å†…å­˜çš„æ“ä½œã€‚<br>1.4ä¹‹åæä¾›çš„NIOæ˜¾è‘—æé«˜æ•ˆç‡ï¼Œé¿å…äº†å †å†…å­˜ä¸Nativeå†…å­˜çš„æ¥å›å¤åˆ¶æ“ä½œï¼Œä¸å—è™šæ‹Ÿæœºå†…å­˜æ§åˆ¶ï¼Œä¼šæŠ›å‡ºOUtOfMemoryå¼‚å¸¸ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹æŠ€æœ¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> JVM </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Tomcatçš„ä¸‰ç§æ¥æ”¶è¯·æ±‚å¤„ç†æ–¹å¼</title>
      <link href="post/2815697354/"/>
      <url>post/2815697354/</url>
      
        <content type="html"><![CDATA[<blockquote><p>Tomcatçš„ä¸‰ç§æ¥æ”¶è¯·æ±‚æ–¹å¼å¤„ç†: BIOã€NIOã€APR</p></blockquote><h3 id="BIOæ¨¡å¼"><a href="#BIOæ¨¡å¼" class="headerlink" title="BIOæ¨¡å¼"></a>BIOæ¨¡å¼</h3><p>é˜»å¡å¼I/Oæ“ä½œï¼Œè¡¨ç¤ºTomcatä½¿ç”¨çš„æ˜¯ä¼ ç»ŸJava I/Oæ“ä½œ(å³java.ioåŒ…åŠå…¶å­åŒ…)ã€‚Tomcat7ä»¥ä¸‹ç‰ˆæœ¬é»˜è®¤æƒ…å†µä¸‹æ˜¯ä»¥bioæ¨¡å¼è¿è¡Œçš„ï¼Œç”±äºæ¯ä¸ªè¯·æ±‚éƒ½è¦åˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ¥å¤„ç†ï¼Œçº¿ç¨‹å¼€é”€è¾ƒå¤§ï¼Œä¸èƒ½å¤„ç†é«˜å¹¶å‘çš„åœºæ™¯ï¼Œåœ¨ä¸‰ç§æ¨¡å¼ä¸­æ€§èƒ½ä¹Ÿæœ€ä½.<br>å¯åŠ¨tomcatçœ‹åˆ°å¦‚ä¸‹æ—¥å¿—ï¼Œè¡¨ç¤ºä½¿ç”¨çš„æ˜¯BIOæ¨¡å¼ï¼š</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">06-Jul-2018 06:04:38.909 INFO [main] org.apache.coyote.AbstractProtocol.start Starting ProtocolHandler [&quot;http-bio-8080&quot;]</span><br><span class="line">06-Jul-2018 06:04:38.939 INFO [main] org.apache.coyote.AbstractProtocol.start Starting ProtocolHandler [&quot;ajp-bio-8009&quot;]</span><br></pre></td></tr></table></figure><h3 id="NIO"><a href="#NIO" class="headerlink" title="NIO"></a>NIO</h3><p>æ˜¯Java SE 1.4åŠåç»­ç‰ˆæœ¬æä¾›çš„ä¸€ç§æ–°çš„I/Oæ“ä½œæ–¹å¼(å³java.nioåŒ…åŠå…¶å­åŒ…)ã€‚æ˜¯ä¸€ä¸ªåŸºäºç¼“å†²åŒºã€å¹¶èƒ½æä¾›éé˜»å¡I/Oæ“ä½œçš„Java APIï¼Œå®ƒæ‹¥æœ‰æ¯”ä¼ ç»ŸI/Oæ“ä½œ(bio)æ›´å¥½çš„å¹¶å‘è¿è¡Œæ€§èƒ½ã€‚è¦è®©Tomcatä»¥nioæ¨¡å¼æ¥è¿è¡Œæ¯”è¾ƒç®€å•ï¼Œåªéœ€è¦åœ¨Tomcatå®‰è£…ç›®å½•/conf/server.xmlæ–‡ä»¶ä¸­å°†å¦‚ä¸‹é…ç½®ï¼š</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Connector</span> <span class="attr">port</span>=<span class="string">&quot;8080&quot;</span> <span class="attr">protocol</span>=<span class="string">&quot;HTTP/1.1&quot;</span> <span class="attr">connectionTimeout</span>=<span class="string">&quot;20000&quot;</span> <span class="attr">redirectPort</span>=<span class="string">&quot;8443&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure><p>ä¿®æ”¹æˆ:</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Connector</span> <span class="attr">port</span>=<span class="string">&quot;8080&quot;</span> <span class="attr">protocol</span>=<span class="string">&quot;org.apache.coyote.http11.Http11NioProtocol&quot;</span> <span class="attr">connectionTimeout</span>=<span class="string">&quot;20000&quot;</span> <span class="attr">redirectPort</span>=<span class="string">&quot;8443&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼šTomcat8ä»¥ä¸Šç‰ˆæœ¬ï¼Œé»˜è®¤ä½¿ç”¨çš„å°±æ˜¯NIOæ¨¡å¼ï¼Œä¸éœ€è¦é¢å¤–ä¿®æ”¹Â </p><h3 id="APRæ¨¡å¼"><a href="#APRæ¨¡å¼" class="headerlink" title="APRæ¨¡å¼"></a>APRæ¨¡å¼</h3><p>ç®€å•ç†è§£ï¼Œå°±æ˜¯ä»æ“ä½œç³»ç»Ÿçº§åˆ«è§£å†³å¼‚æ­¥IOé—®é¢˜ï¼Œå¤§å¹…åº¦çš„æé«˜æœåŠ¡å™¨çš„å¤„ç†å’Œå“åº”æ€§èƒ½ï¼Œ ä¹Ÿæ˜¯Tomcatè¿è¡Œé«˜å¹¶å‘åº”ç”¨çš„é¦–é€‰æ¨¡å¼ã€‚</p><p>å¯ç”¨è¿™ç§æ¨¡å¼ç¨å¾®éº»çƒ¦ä¸€äº›ï¼Œéœ€è¦å®‰è£…ä¸€äº›ä¾èµ–åº“: </p><ul><li>APR 1.2+ development headers (libapr1-dev package) </li><li>OpenSSL 0.9.7+ development headers (libssl-dev package) </li><li>JNI headers from Java compatible JDK 1.4+ </li><li>GNU development environment (gcc, make)</li></ul><h4 id="å¯ç”¨APRæ¨¡å¼æ­¥éª¤"><a href="#å¯ç”¨APRæ¨¡å¼æ­¥éª¤" class="headerlink" title="å¯ç”¨APRæ¨¡å¼æ­¥éª¤"></a>å¯ç”¨APRæ¨¡å¼æ­¥éª¤</h4><h5 id="å› ä¸ºapræ¨¡å¼æœ¬è´¨æ˜¯ä½¿ç”¨JNIæŠ€æœ¯è°ƒç”¨æ“ä½œç³»ç»ŸIOæ¥å£ï¼Œéœ€è¦ç”¨åˆ°ç›¸å…³APIçš„å¤´æ–‡ä»¶"><a href="#å› ä¸ºapræ¨¡å¼æœ¬è´¨æ˜¯ä½¿ç”¨JNIæŠ€æœ¯è°ƒç”¨æ“ä½œç³»ç»ŸIOæ¥å£ï¼Œéœ€è¦ç”¨åˆ°ç›¸å…³APIçš„å¤´æ–‡ä»¶" class="headerlink" title="å› ä¸ºapræ¨¡å¼æœ¬è´¨æ˜¯ä½¿ç”¨JNIæŠ€æœ¯è°ƒç”¨æ“ä½œç³»ç»ŸIOæ¥å£ï¼Œéœ€è¦ç”¨åˆ°ç›¸å…³APIçš„å¤´æ–‡ä»¶"></a>å› ä¸ºapræ¨¡å¼æœ¬è´¨æ˜¯ä½¿ç”¨JNIæŠ€æœ¯è°ƒç”¨æ“ä½œç³»ç»ŸIOæ¥å£ï¼Œéœ€è¦ç”¨åˆ°ç›¸å…³APIçš„å¤´æ–‡ä»¶</h5><p>CentOS:</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">yum install apr-devel </span><br><span class="line">yum install openssl-devel </span><br><span class="line">yum install gcc </span><br><span class="line">yum install make</span><br></pre></td></tr></table></figure><p>Ubuntu:</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo apt-get install libapr1 libapr1-dev</span><br><span class="line">sudo apt-get install openssl </span><br><span class="line">sudo apt-get install libssl-dev</span><br><span class="line">sudo apt-get install gcc</span><br><span class="line">sudo apt-get install make</span><br></pre></td></tr></table></figure><h5 id="å®‰è£…apråŠ¨æ€åº“"><a href="#å®‰è£…apråŠ¨æ€åº“" class="headerlink" title="å®‰è£…apråŠ¨æ€åº“"></a>å®‰è£…apråŠ¨æ€åº“</h5><p>è¿›å…¥<code>tomcat</code>çš„<code>bin</code>ç›®å½•ï¼Œè§£å‹<code>tomcat-native.tar.gz</code>æ–‡ä»¶ï¼Œå¹¶è¿›å…¥<code>tomcat-native-1.2.7-src/native</code>ç›®å½•ï¼Œ<br>æ‰§è¡Œ<code>./configure &amp;&amp; make &amp;&amp; make install</code> å‘½ä»¤ï¼ŒåŠ¨æ€åº“é»˜è®¤å®‰è£…åœ¨<code>/usr/local/apr/lib</code>ç›®å½•ä¸‹</p><h5 id="é…ç½®apråŠ¨æ€åº“åˆ°ç³»ç»Ÿå…±äº«åº“æœç´¢è·¯å¾„ä¸­"><a href="#é…ç½®apråŠ¨æ€åº“åˆ°ç³»ç»Ÿå…±äº«åº“æœç´¢è·¯å¾„ä¸­" class="headerlink" title="é…ç½®apråŠ¨æ€åº“åˆ°ç³»ç»Ÿå…±äº«åº“æœç´¢è·¯å¾„ä¸­"></a>é…ç½®apråŠ¨æ€åº“åˆ°ç³»ç»Ÿå…±äº«åº“æœç´¢è·¯å¾„ä¸­</h5><ul><li>æ–¹å¼1:</li></ul><p>è®¾ç½®<code>LD_LIBRARY_PATH</code>å’Œ<code>LD_RUN_PATH</code>ç¯å¢ƒå˜é‡ï¼ŒæŒ‡å‘<code>/usr/local/apr/lib</code>ç›®å½•ï¼Œå¯é…ç½®åˆ°<code>$HOME/.profile</code>æ–‡ä»¶ä¸­</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:/usr/local/apr/lib </span><br><span class="line">export LD_RUN_PATH=$LD_RUN_PATH:/usr/local/apr/lib</span><br></pre></td></tr></table></figure><ul><li>æ–¹å¼2:</li></ul><p>æ‹·è´<code>/usr/local/apr/lib</code>ç›®å½•ä¸‹æ‰€æœ‰åŠ¨æ€åº“åˆ°<code>/usr/lib</code>æˆ–<code>/lib</code>ç³»ç»Ÿå…±äº«åº“æœç´¢ç›®å½•ä¸‹å³å¯ã€‚</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cp /usr/local/apr/lib/libtcnative* /usr/lib/</span><br></pre></td></tr></table></figure><ul><li>æ–¹å¼3(æ¨è):</li></ul><p>ç¼–è¾‘<code>$TOMCAT_HOME/bin/catalina.sh</code>æ–‡ä»¶ï¼Œåœ¨è™šæ‹Ÿæœºå¯åŠ¨å‚æ•°<code>JAVA_OPTS</code>ä¸­æ·»åŠ <code>java.library.path</code>å‚æ•°ï¼ŒæŒ‡å®š<code>apr</code>åº“çš„è·¯å¾„:</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">JAVA_OPTS=&quot;$JAVA_OPTS -Djava.library.path=/usr/local/apr/lib&quot;</span><br></pre></td></tr></table></figure><p>Tomcat8ä»¥ä¸‹ç‰ˆæœ¬ï¼Œéœ€è¦æŒ‡å®šè¿è¡Œæ¨¡å¼ï¼Œå°†protocolä»HTTP/1.1æ”¹æˆorg.apache.coyote.http11.Http11AprProtocol</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">&lt;Connector port=&quot;8080&quot; protocol=&quot;org.apache.coyote.http11.Http11AprProtocol&quot; connectionTimeout=&quot;20000&quot; redirectPort=&quot;8443&quot; /&gt;</span><br></pre></td></tr></table></figure><p><code>æ³¨æ„</code>:</p><p>å¦‚æœæ²¡æœ‰é…ç½®<code>SSL</code>ç›¸å…³å‚æ•°ï¼Œå¹¶ä¸”å¼€å¯äº†<code>SSL</code>ï¼Œå¯åŠ¨æ—¶ä¼šå‘ç”Ÿ<code>org.apache.tomcat.jni.Error: 70023: This function has not been implemented on this platform</code>å¼‚å¸¸ã€‚</p><p>è¿™æ—¶:</p><p>å¦‚æœä¸æƒ³å¯ç”¨<code>SSL</code>ï¼Œå°†<code>server.xml</code>ä¸­<code>apr</code>æ¨¡å¼ä¸‹<code>ssl</code>å…³é—­å³å¯ï¼š</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">&lt;Listener className=&quot;org.apache.catalina.core.AprLifecycleListener&quot; SSLEngine=&quot;on&quot; /&gt;</span><br></pre></td></tr></table></figure><p>å°†<code>SSLEngine</code>çš„å€¼ä»<code>on</code>æ”¹æˆ<code>off</code>å³å¯ï¼š</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">&lt;Listener className=&quot;org.apache.catalina.core.AprLifecycleListener&quot; SSLEngine=&quot;off&quot; /&gt;</span><br></pre></td></tr></table></figure><h3 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h3><p>Tomcat 6.xç‰ˆæœ¬ä»6.0.32å¼€å§‹å°±é»˜è®¤æ”¯æŒaprã€‚<br>Tomcat 7.xç‰ˆæœ¬ä»7.0.30å¼€å§‹å°±é»˜è®¤æ”¯æŒaprã€‚ </p>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®°æœ¬ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> Tomcat </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Dockerä½¿ç”¨MySQL</title>
      <link href="post/58787038/"/>
      <url>post/58787038/</url>
      
        <content type="html"><![CDATA[<blockquote><p>MySQLæ˜¯ä¸€ä¸ªå¹¿æ³›ä½¿ç”¨çš„å¼€æºå…³ç³»æ•°æ®åº“ç®¡ç†ç³»ç»Ÿï¼ˆRDBMSï¼‰ã€‚<br>è®°å½•Dockeré‡Œé¢ä½¿ç”¨MySQLçš„æ–¹æ³•</p></blockquote><h3 id="é•œåƒ"><a href="#é•œåƒ" class="headerlink" title="é•œåƒ"></a>é•œåƒ</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker pull mysql</span><br></pre></td></tr></table></figure><h3 id="å¯ç”¨ä¸€ä¸ªMySQLæœåŠ¡å™¨å®ä¾‹"><a href="#å¯ç”¨ä¸€ä¸ªMySQLæœåŠ¡å™¨å®ä¾‹" class="headerlink" title="å¯ç”¨ä¸€ä¸ªMySQLæœåŠ¡å™¨å®ä¾‹"></a>å¯ç”¨ä¸€ä¸ªMySQLæœåŠ¡å™¨å®ä¾‹</h3><p>å¯åŠ¨ä¸€ä¸ª<code>MySQL</code>å®ä¾‹å¾ˆç®€å•:</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker run --name some-mysql -e MYSQL_ROOT_PASSWORD=my-secret-pw -d mysql:tag</span><br></pre></td></tr></table></figure><p>some-mysqlæ‚¨æƒ³è¦åˆ†é…ç»™æ‚¨çš„å®¹å™¨çš„åç§°åœ¨å“ªé‡Œï¼Œ<code>my-secret-pw</code>æ˜¯ä¸º<code>MySQL</code>æ ¹ç”¨æˆ·è®¾ç½®çš„å¯†ç ï¼Œæ˜¯<code>tag</code>æŒ‡å®šæ‚¨æƒ³è¦çš„<code>MySQL</code>ç‰ˆæœ¬çš„æ ‡è®°ã€‚</p><p>è¿™é‡Œå¯ä»¥åŠ ä¸Š<code>-p</code>å‚æ•°æŠŠç«¯å£æ˜ å°„åˆ°ä¸»æœºç«¯å£:</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker run --name some-mysql -p 3306:3306 -e MYSQL_ROOT_PASSWORD=my-secret-pw -d mysql:tag</span><br></pre></td></tr></table></figure><p>è¿™æ ·, å°±æŠŠå®¹å™¨çš„3306ç«¯å£æ˜ å°„åˆ°å®¿ä¸»æœºå™¨çš„3306ç«¯å£ä¸Šäº†, å¹¶ä¸”å¯ä»¥ä½¿ç”¨<code>Navicat</code>ç­‰å·¥å…·æ¥è¿æ¥<code>MySQL</code>æ•°æ®åº“(<code>127.0.0.1:3306</code>).</p><h3 id="ä»å¦ä¸€ä¸ªDockerå®¹å™¨ä¸­çš„åº”ç”¨ç¨‹åºè¿æ¥åˆ°MySQL"><a href="#ä»å¦ä¸€ä¸ªDockerå®¹å™¨ä¸­çš„åº”ç”¨ç¨‹åºè¿æ¥åˆ°MySQL" class="headerlink" title="ä»å¦ä¸€ä¸ªDockerå®¹å™¨ä¸­çš„åº”ç”¨ç¨‹åºè¿æ¥åˆ°MySQL"></a>ä»å¦ä¸€ä¸ªDockerå®¹å™¨ä¸­çš„åº”ç”¨ç¨‹åºè¿æ¥åˆ°MySQL</h3><p>è¯¥æ˜ åƒå…¬å¼€äº†æ ‡å‡†çš„MySQLç«¯å£ï¼ˆ3306ï¼‰ï¼Œå› æ­¤å®¹å™¨é“¾æ¥ä½¿MySQLå®ä¾‹å¯ç”¨äºå…¶ä»–åº”ç”¨ç¨‹åºå®¹å™¨ã€‚åƒè¿™æ ·å¯åŠ¨æ‚¨çš„åº”ç”¨ç¨‹åºå®¹å™¨ï¼Œä»¥ä¾¿å°†å…¶é“¾æ¥åˆ°MySQLå®¹å™¨ï¼š</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker run --name some-app --link some-mysql:mysql -d application-that-uses-mysql</span><br></pre></td></tr></table></figure><h3 id="ä»MySQLå‘½ä»¤è¡Œå®¢æˆ·ç«¯è¿æ¥åˆ°MySQL"><a href="#ä»MySQLå‘½ä»¤è¡Œå®¢æˆ·ç«¯è¿æ¥åˆ°MySQL" class="headerlink" title="ä»MySQLå‘½ä»¤è¡Œå®¢æˆ·ç«¯è¿æ¥åˆ°MySQL"></a>ä»MySQLå‘½ä»¤è¡Œå®¢æˆ·ç«¯è¿æ¥åˆ°MySQL</h3><p>ä»¥ä¸‹å‘½ä»¤å°†å¯åŠ¨å¦ä¸€ä¸ª<code>MySQL</code>å®¹å™¨å®ä¾‹ï¼Œå¹¶<code>MySQL</code>é’ˆå¯¹åŸå§‹<code>MySQL</code>å®¹å™¨è¿è¡Œå‘½ä»¤è¡Œå®¢æˆ·ç«¯ï¼Œä»è€Œå…è®¸æ‚¨é’ˆå¯¹æ•°æ®åº“å®ä¾‹æ‰§è¡Œ<code>SQL</code>è¯­å¥ï¼š</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker run -it --link some-mysql:mysql --rm mysql sh \</span><br><span class="line">-c &#x27;exec mysql -h&quot;$MYSQL_PORT_3306_TCP_ADDR&quot; -P&quot;$MYSQL_PORT_3306_TCP_PORT&quot; \</span><br><span class="line">-uroot -p&quot;$MYSQL_ENV_MYSQL_ROOT_PASSWORD&quot;&#x27;</span><br></pre></td></tr></table></figure><p><code>some-mysql</code>æ˜¯ä½ æŒ‡å®šçš„<code>MySQL</code>å®¹å™¨å.</p><p>è¯¥æ˜ åƒä¹Ÿå¯ä»¥ç”¨ä½œéDockeræˆ–è¿œç¨‹MySQLå®ä¾‹çš„å®¢æˆ·ç«¯ï¼š</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker run -it --rm mysql mysql -hsome.mysql.host -usome-mysql-user -p</span><br></pre></td></tr></table></figure><p>æœ‰å…³MySQLå‘½ä»¤è¡Œå®¢æˆ·ç«¯çš„æ›´å¤šä¿¡æ¯å¯ä»¥åœ¨<a href="https://dev.mysql.com/doc/refman/8.0/en/mysql.html">MySQLæ–‡æ¡£</a>ä¸­æ‰¾åˆ°</p><h3 id="æŸ¥çœ‹æ—¥å¿—"><a href="#æŸ¥çœ‹æ—¥å¿—" class="headerlink" title="æŸ¥çœ‹æ—¥å¿—"></a>æŸ¥çœ‹æ—¥å¿—</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker logs some-mysql</span><br></pre></td></tr></table></figure><h3 id="è¿›å…¥å®¹å™¨"><a href="#è¿›å…¥å®¹å™¨" class="headerlink" title="è¿›å…¥å®¹å™¨"></a>è¿›å…¥å®¹å™¨</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker exec -it app_mysql  bash</span><br></pre></td></tr></table></figure><h3 id="END"><a href="#END" class="headerlink" title="END"></a>END</h3><p><a href="https://hub.docker.com/_/mysql/">https://hub.docker.com/_/mysql/</a></p>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®°æœ¬ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Docker </tag>
            
            <tag> MySQL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Dockerä½¿ç”¨zookeeper</title>
      <link href="post/1403556454/"/>
      <url>post/1403556454/</url>
      
        <content type="html"><![CDATA[<blockquote><p>Apache ZooKeeperæ˜¯ä¸€ä¸ªå¼€æºçš„æœåŠ¡å™¨ï¼Œå¯ä»¥å®ç°é«˜åº¦å¯é çš„åˆ†å¸ƒå¼åè°ƒã€‚<br>è®°å½•Dockeré‡Œé¢ä½¿ç”¨zookeeperçš„æ–¹æ³•</p></blockquote><h3 id="é•œåƒ"><a href="#é•œåƒ" class="headerlink" title="é•œåƒ"></a>é•œåƒ</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker pull zookeeper</span><br></pre></td></tr></table></figure><h3 id="å¯åŠ¨ä¸€ä¸ªZookeeperæœåŠ¡å™¨å®ä¾‹"><a href="#å¯åŠ¨ä¸€ä¸ªZookeeperæœåŠ¡å™¨å®ä¾‹" class="headerlink" title="å¯åŠ¨ä¸€ä¸ªZookeeperæœåŠ¡å™¨å®ä¾‹"></a>å¯åŠ¨ä¸€ä¸ªZookeeperæœåŠ¡å™¨å®ä¾‹</h3><p>å¯åŠ¨ä¸€ä¸ª<code>zookeeper</code>å®ä¾‹å¾ˆç®€å•:</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker run --name some-zookeeper --restart always -d zookeeper</span><br></pre></td></tr></table></figure><p>ç”±äºZookeeper â€œfails fastâ€ï¼Œæœ€å¥½å§‹ç»ˆé‡æ–°å¯åŠ¨å®ƒã€‚</p><p>è¿™é‡Œå¯ä»¥åŠ ä¸Š<code>-p</code>å‚æ•°æŠŠç«¯å£æ˜ å°„åˆ°ä¸»æœºç«¯å£:</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker run --name some-zookeeper -p 2181:2181 --restart always -d zookeeper</span><br></pre></td></tr></table></figure><p>è¿™æ ·, å°±æŠŠå®¹å™¨çš„2181ç«¯å£æ˜ å°„åˆ°å®¿ä¸»æœºå™¨çš„2181ç«¯å£ä¸Šäº†, javaç¨‹åºç­‰å¯ä»¥ç›´æ¥è¿æ¥(127.0.0.1:2181)</p><h3 id="ä»å¦ä¸€ä¸ªDockerå®¹å™¨ä¸­çš„åº”ç”¨ç¨‹åºè¿æ¥åˆ°Zookeeper"><a href="#ä»å¦ä¸€ä¸ªDockerå®¹å™¨ä¸­çš„åº”ç”¨ç¨‹åºè¿æ¥åˆ°Zookeeper" class="headerlink" title="ä»å¦ä¸€ä¸ªDockerå®¹å™¨ä¸­çš„åº”ç”¨ç¨‹åºè¿æ¥åˆ°Zookeeper"></a>ä»å¦ä¸€ä¸ªDockerå®¹å™¨ä¸­çš„åº”ç”¨ç¨‹åºè¿æ¥åˆ°Zookeeper</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker run --name some-app --link some-zookeeper:zookeeper \</span><br><span class="line">-d application-that-uses-zookeeper</span><br></pre></td></tr></table></figure><h3 id="ä»Zookeeperå‘½ä»¤è¡Œå®¢æˆ·ç«¯è¿æ¥åˆ°Zookeeper"><a href="#ä»Zookeeperå‘½ä»¤è¡Œå®¢æˆ·ç«¯è¿æ¥åˆ°Zookeeper" class="headerlink" title="ä»Zookeeperå‘½ä»¤è¡Œå®¢æˆ·ç«¯è¿æ¥åˆ°Zookeeper"></a>ä»Zookeeperå‘½ä»¤è¡Œå®¢æˆ·ç«¯è¿æ¥åˆ°Zookeeper</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker run -it --rm --link some-zookeeper:zookeeper zookeeper zkCli.sh -server zookeeper</span><br></pre></td></tr></table></figure><h3 id="æŸ¥çœ‹æ—¥å¿—"><a href="#æŸ¥çœ‹æ—¥å¿—" class="headerlink" title="æŸ¥çœ‹æ—¥å¿—"></a>æŸ¥çœ‹æ—¥å¿—</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker logs -f e36790ea5c5e</span><br></pre></td></tr></table></figure><p>å…¶ä¸­<code>e36790ea5c5e</code>æ˜¯å®¹å™¨çš„<code>ID</code>, å¯ä»¥é€šè¿‡<code>docker container ls</code> æ¥æŸ¥çœ‹.</p><h3 id="END"><a href="#END" class="headerlink" title="END"></a>END</h3><p><a href="https://hub.docker.com/_/zookeeper/">https://hub.docker.com/_/zookeeper/</a></p>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®°æœ¬ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Docker </tag>
            
            <tag> zookeeper </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>DockerçŸ¥è¯†æ‰«ç›²</title>
      <link href="post/3773573700/"/>
      <url>post/3773573700/</url>
      
        <content type="html"><![CDATA[<h2 id="Dockerä¸ä¼ ç»Ÿè™šæ‹ŸæœºåŒºåˆ«"><a href="#Dockerä¸ä¼ ç»Ÿè™šæ‹ŸæœºåŒºåˆ«" class="headerlink" title="Dockerä¸ä¼ ç»Ÿè™šæ‹ŸæœºåŒºåˆ«"></a>Dockerä¸ä¼ ç»Ÿè™šæ‹ŸæœºåŒºåˆ«</h2><p>å®¹å™¨å’Œ <code>VM</code>ï¼ˆè™šæ‹Ÿæœºï¼‰çš„ä¸»è¦åŒºåˆ«æ˜¯:</p><ul><li>å®¹å™¨æä¾›äº†åŸºäºè¿›ç¨‹çš„éš”ç¦»ï¼Œè€Œè™šæ‹Ÿæœºæä¾›äº†èµ„æºçš„å®Œå…¨éš”ç¦»ã€‚</li><li>è™šæ‹Ÿæœºå¯èƒ½éœ€è¦ä¸€åˆ†é’Ÿæ¥å¯åŠ¨ï¼Œè€Œå®¹å™¨åªéœ€è¦ä¸€ç§’é’Ÿæˆ–æ›´çŸ­ã€‚</li><li>å®¹å™¨ä½¿ç”¨å®¿ä¸»æ“ä½œç³»ç»Ÿçš„å†…æ ¸ï¼Œè€Œè™šæ‹Ÿæœºä½¿ç”¨ç‹¬ç«‹çš„å†…æ ¸ã€‚</li></ul><h2 id="Dokcerå¹³å°çš„åŸºæœ¬æ„æˆ"><a href="#Dokcerå¹³å°çš„åŸºæœ¬æ„æˆ" class="headerlink" title="Dokcerå¹³å°çš„åŸºæœ¬æ„æˆ"></a>Dokcerå¹³å°çš„åŸºæœ¬æ„æˆ</h2><ul><li>å®¢æˆ·ç«¯ï¼šç”¨æˆ·ä½¿ç”¨ <code>Docker</code> æä¾›çš„å·¥å…·ï¼ˆ<code>CLI</code> ä»¥åŠ <code>API</code> ç­‰ï¼‰æ¥æ„å»ºï¼Œä¸Šä¼ é•œåƒå¹¶å‘å¸ƒå‘½ä»¤æ¥åˆ›å»ºå’Œå¯åŠ¨å®¹å™¨</li><li><code>Docker</code> ä¸»æœºï¼šä» <code>Docker registry</code> ä¸Šä¸‹è½½é•œåƒå¹¶å¯åŠ¨å®¹å™¨</li><li><code>Docker registry</code>ï¼š<code>Docker</code> é•œåƒä»“åº“ï¼Œç”¨äºä¿å­˜é•œåƒï¼Œå¹¶æä¾›é•œåƒä¸Šä¼ å’Œä¸‹è½½</li></ul><h2 id="Dockerå®¹å™¨çš„çŠ¶æ€æœº"><a href="#Dockerå®¹å™¨çš„çŠ¶æ€æœº" class="headerlink" title="Dockerå®¹å™¨çš„çŠ¶æ€æœº"></a>Dockerå®¹å™¨çš„çŠ¶æ€æœº</h2><p>ä¸€ä¸ªå®¹å™¨åœ¨æŸä¸ªæ—¶åˆ»å¯èƒ½å¤„äºä»¥ä¸‹å‡ ç§çŠ¶æ€ä¹‹ä¸€ï¼š</p><ul><li><code>created</code>ï¼šå·²ç»è¢«åˆ›å»º ï¼ˆä½¿ç”¨ docker ps -a å‘½ä»¤å¯ä»¥åˆ—å‡ºï¼‰ä½†æ˜¯è¿˜æ²¡æœ‰è¢«å¯åŠ¨ ï¼ˆä½¿ç”¨ docker ps å‘½ä»¤è¿˜æ— æ³•åˆ—å‡ºï¼‰</li><li><code>running</code>ï¼šè¿è¡Œä¸­</li><li><code>paused</code>ï¼šå®¹å™¨çš„è¿›ç¨‹è¢«æš‚åœäº†</li><li><code>restarting</code>ï¼šå®¹å™¨çš„è¿›ç¨‹æ­£åœ¨é‡å¯è¿‡ç¨‹ä¸­</li><li><code>exited</code>ï¼šä¸Šå›¾ä¸­çš„ stopped çŠ¶æ€ï¼Œè¡¨ç¤ºå®¹å™¨ä¹‹å‰è¿è¡Œè¿‡ä½†æ˜¯ç°åœ¨å¤„äºåœæ­¢çŠ¶æ€ï¼ˆè¦åŒºåˆ«äº <code>created</code> çŠ¶æ€ï¼Œå®ƒæ˜¯æŒ‡ä¸€ä¸ªæ–°åˆ›å‡ºçš„å°šæœªè¿è¡Œè¿‡çš„å®¹å™¨ï¼‰ã€‚å¯ä»¥é€šè¿‡ <code>start</code> å‘½ä»¤ä½¿å…¶é‡æ–°è¿›å…¥ <code>running</code> çŠ¶æ€</li><li><code>destroyed</code>ï¼šå®¹å™¨è¢«åˆ é™¤äº†ï¼Œå†ä¹Ÿä¸å­˜åœ¨äº†</li></ul><h2 id="Dokcerå‘½ä»¤"><a href="#Dokcerå‘½ä»¤" class="headerlink" title="Dokcerå‘½ä»¤"></a>Dokcerå‘½ä»¤</h2><p>æŠŠ<code>Docker</code>çš„å‘½ä»¤å¤§æ¦‚åˆ†ç±»ã€‚</p><h3 id="é•œåƒæ“ä½œ"><a href="#é•œåƒæ“ä½œ" class="headerlink" title="é•œåƒæ“ä½œ"></a>é•œåƒæ“ä½œ</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">build     Build an image from a Dockerfile</span><br><span class="line">commit    Create a new image from a container&#39;s changes</span><br><span class="line">images    List images</span><br><span class="line">load      Load an image from a tar archive or STDIN</span><br><span class="line">pull      Pull an image or a repository from a registry</span><br><span class="line">push      Push an image or a repository to a registry</span><br><span class="line">rmi       Remove one or more images</span><br><span class="line">search    Search the Docker Hub for images</span><br><span class="line">tag       Tag an image into a repository</span><br><span class="line">save      Save one or more images to a tar archive </span><br><span class="line">history   æ˜¾ç¤ºæŸé•œåƒçš„å†å²</span><br><span class="line">inspect   è·å–é•œåƒçš„è¯¦ç»†ä¿¡æ¯</span><br></pre></td></tr></table></figure><h3 id="å®¹å™¨åŠå…¶ä¸­åº”ç”¨çš„ç”Ÿå‘½å‘¨æœŸæ“ä½œ"><a href="#å®¹å™¨åŠå…¶ä¸­åº”ç”¨çš„ç”Ÿå‘½å‘¨æœŸæ“ä½œ" class="headerlink" title="å®¹å™¨åŠå…¶ä¸­åº”ç”¨çš„ç”Ÿå‘½å‘¨æœŸæ“ä½œ"></a>å®¹å™¨åŠå…¶ä¸­åº”ç”¨çš„ç”Ÿå‘½å‘¨æœŸæ“ä½œ</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">create    åˆ›å»ºä¸€ä¸ªå®¹å™¨</span><br><span class="line">kill      Kill one or more running containers</span><br><span class="line">inspect   Return low-level information on a container, image or task</span><br><span class="line">pause     Pause all processes within one or more containers</span><br><span class="line">ps        List containers</span><br><span class="line">rm        åˆ é™¤ä¸€ä¸ªæˆ–è€…å¤šä¸ªå®¹å™¨</span><br><span class="line">rename    Rename a container</span><br><span class="line">restart   Restart a container</span><br><span class="line">run       åˆ›å»ºå¹¶å¯åŠ¨ä¸€ä¸ªå®¹å™¨</span><br><span class="line">start     å¯åŠ¨ä¸€ä¸ªå¤„äºåœæ­¢çŠ¶æ€çš„å®¹å™¨</span><br><span class="line">stats     æ˜¾ç¤ºå®¹å™¨å®æ—¶çš„èµ„æºæ¶ˆè€—ä¿¡æ¯</span><br><span class="line">stop      åœæ­¢ä¸€ä¸ªå¤„äºè¿è¡ŒçŠ¶æ€çš„å®¹å™¨</span><br><span class="line">top       Display the running processes of a container</span><br><span class="line">unpause   Unpause all processes within one or more containers</span><br><span class="line">update    Update configuration of one or more containers</span><br><span class="line">wait      Block until a container stops, then print its exit code</span><br><span class="line">attach    Attach to a running container</span><br><span class="line">exec      Run a command in a running container</span><br><span class="line">port      List port mappings or a specific mapping for the container</span><br><span class="line">logs      è·å–å®¹å™¨çš„æ—¥å¿—</span><br></pre></td></tr></table></figure><h3 id="å®¹å™¨æ–‡ä»¶ç³»ç»Ÿæ“ä½œ"><a href="#å®¹å™¨æ–‡ä»¶ç³»ç»Ÿæ“ä½œ" class="headerlink" title="å®¹å™¨æ–‡ä»¶ç³»ç»Ÿæ“ä½œ"></a>å®¹å™¨æ–‡ä»¶ç³»ç»Ÿæ“ä½œ</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cp        Copy files&#x2F;folders between a container and the local filesystem</span><br><span class="line">diff      Inspect changes on a container&#39;s filesystem</span><br><span class="line">export    Export a container&#39;s filesystem as a tar archive</span><br><span class="line">import    Import the contents from a tarball to create a filesystem image</span><br></pre></td></tr></table></figure><h3 id="Docker-registryæ“ä½œ"><a href="#Docker-registryæ“ä½œ" class="headerlink" title="Docker registryæ“ä½œ"></a>Docker registryæ“ä½œ</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">login     Log in to a Docker registry.</span><br><span class="line">logout    Log out from a Docker registry.</span><br></pre></td></tr></table></figure><h3 id="Volumeæ“ä½œ"><a href="#Volumeæ“ä½œ" class="headerlink" title="Volumeæ“ä½œ"></a>Volumeæ“ä½œ</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">volume    Manage Docker volumes</span><br></pre></td></tr></table></figure><h3 id="ç½‘ç»œæ“ä½œ"><a href="#ç½‘ç»œæ“ä½œ" class="headerlink" title="ç½‘ç»œæ“ä½œ"></a>ç½‘ç»œæ“ä½œ</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">network   Manage Docker networks</span><br></pre></td></tr></table></figure><h3 id="Swarmç›¸å…³æ“ä½œ"><a href="#Swarmç›¸å…³æ“ä½œ" class="headerlink" title="Swarmç›¸å…³æ“ä½œ"></a>Swarmç›¸å…³æ“ä½œ</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">swarm     Manage Docker Swarm</span><br><span class="line">service   Manage Docker services</span><br><span class="line">node      Manage Docker Swarm nodes</span><br></pre></td></tr></table></figure><h3 id="ç³»ç»Ÿæ“ä½œ"><a href="#ç³»ç»Ÿæ“ä½œ" class="headerlink" title="ç³»ç»Ÿæ“ä½œ"></a>ç³»ç»Ÿæ“ä½œ</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">version   Show the Docker version information</span><br><span class="line">events    æŒç»­è¿”å›docker äº‹ä»¶</span><br><span class="line">info      æ˜¾ç¤ºDocker ä¸»æœºç³»ç»ŸèŒƒå›´å†…çš„ä¿¡æ¯</span><br></pre></td></tr></table></figure><h3 id="å®¹å™¨ç›¸å…³"><a href="#å®¹å™¨ç›¸å…³" class="headerlink" title="å®¹å™¨ç›¸å…³"></a>å®¹å™¨ç›¸å…³</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥çœ‹è¿è¡Œä¸­çš„å®¹å™¨</span></span><br><span class="line">docker ps</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥çœ‹æ‰€æœ‰å®¹å™¨</span></span><br><span class="line">docker ps -a</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> é€€å‡ºå®¹å™¨</span></span><br><span class="line">æŒ‰Ctrl+D å³å¯é€€å‡ºå½“å‰å®¹å™¨ã€ä½†é€€å‡ºåä¼šåœæ­¢å®¹å™¨ã€‘</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> é€€å‡ºä¸åœæ­¢å®¹å™¨ï¼š</span></span><br><span class="line">ç»„åˆé”®ï¼šCtrl+P+Q</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> å¯åŠ¨å®¹å™¨</span></span><br><span class="line">docker start å®¹å™¨åæˆ–ID</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> è¿›å…¥å®¹å™¨</span></span><br><span class="line">docker attach å®¹å™¨åæˆ–ID</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> åœæ­¢å®¹å™¨</span></span><br><span class="line">docker stop å®¹å™¨åæˆ–ID</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> æš‚åœå®¹å™¨</span></span><br><span class="line">docker pause å®¹å™¨åæˆ–ID</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">ç»§ç»­å®¹å™¨</span></span><br><span class="line">docker unpause å®¹å™¨åæˆ–ID</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> åˆ é™¤å®¹å™¨</span></span><br><span class="line">docker rm å®¹å™¨åæˆ–ID</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> åˆ é™¤å…¨éƒ¨å®¹å™¨--æ…ç”¨</span></span><br><span class="line">docker stop $(docker ps -q) &amp; docker rm $(docker ps -aq)</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">ä¿å­˜å®¹å™¨ï¼Œç”Ÿæˆé•œåƒ</span></span><br><span class="line">docker commit å®¹å™¨ID é•œåƒåç§°</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">ä» host æ‹·è´æ–‡ä»¶åˆ° container é‡Œé¢</span></span><br><span class="line">docker cp /home/soft centos:/webapp</span><br></pre></td></tr></table></figure><h2 id="docker-run-å’Œstartçš„åŒºåˆ«"><a href="#docker-run-å’Œstartçš„åŒºåˆ«" class="headerlink" title="docker run å’Œstartçš„åŒºåˆ«"></a>docker run å’Œstartçš„åŒºåˆ«</h2><p><code>docker run</code> åªåœ¨ç¬¬ä¸€æ¬¡è¿è¡Œæ—¶ä½¿ç”¨ï¼Œå°†é•œåƒæ”¾åˆ°å®¹å™¨ä¸­ï¼Œä»¥åå†æ¬¡å¯åŠ¨è¿™ä¸ªå®¹å™¨æ—¶ï¼Œåªéœ€è¦ä½¿ç”¨å‘½ä»¤<code>docker start</code> å³å¯ã€‚</p><ul><li><p><code>docker run</code>ç›¸å½“äºæ‰§è¡Œäº†ä¸¤æ­¥æ“ä½œï¼šå°†é•œåƒæ”¾å…¥å®¹å™¨ä¸­ï¼ˆ<code>docker create</code>ï¼‰,ç„¶åå°†å®¹å™¨å¯åŠ¨ï¼Œä½¿ä¹‹å˜æˆè¿è¡Œæ—¶å®¹å™¨ï¼ˆ<code>docker start</code>ï¼‰ã€‚</p></li><li><p><code>docker start</code>çš„ä½œç”¨æ˜¯ï¼Œé‡æ–°å¯åŠ¨å·²å­˜åœ¨çš„é•œåƒã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœä½¿ç”¨è¿™ä¸ªå‘½ä»¤ï¼Œæˆ‘ä»¬å¿…é¡»äº‹å…ˆçŸ¥é“è¿™ä¸ªå®¹å™¨çš„<code>ID</code>ï¼Œæˆ–è€…è¿™ä¸ªå®¹å™¨çš„åå­—ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>docker ps</code>æ‰¾åˆ°è¿™ä¸ªå®¹å™¨çš„ä¿¡æ¯ã€‚</p></li></ul><h2 id="dockeré…ç½®"><a href="#dockeré…ç½®" class="headerlink" title="dockeré…ç½®"></a>dockeré…ç½®</h2><p>æ›´æ”¹å­˜å‚¨ç›®å½•ï¼š</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">å¤åˆ¶dockerå­˜å‚¨ç›®å½•</span></span><br><span class="line">rsync -aXS /var/lib/docker/. /home/docker</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">æ›´æ”¹ docker å­˜å‚¨æ–‡ä»¶ç›®å½•</span></span><br><span class="line">ln -s  /home/docker  /var/lib/docker</span><br></pre></td></tr></table></figure><p>è·å–ipï¼š</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker inspect &lt;container id&gt;</span><br></pre></td></tr></table></figure><p>è¦è·å–æ‰€æœ‰å®¹å™¨åç§°åŠå…¶IPåœ°å€åªéœ€ä¸€ä¸ªå‘½ä»¤ï¼š</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker inspect -f &#x27;&#123;&#123;.Name&#125;&#125; - &#123;&#123;.NetworkSettings.IPAddress &#125;&#125;&#x27; $(docker ps -aq)</span><br><span class="line"></span><br><span class="line">docker inspect --format=&#x27;&#123;&#123;.Name&#125;&#125; - &#123;&#123;range .NetworkSettings.Networks&#125;&#125;&#123;&#123;.IPAddress&#125;&#125;&#123;&#123;end&#125;&#125;&#x27; $(docker ps -aq)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®°æœ¬ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Docker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linuxé…ç½®sshä½¿ç”¨å…¬é’¥ç™»å½•è¿œç¨‹æœåŠ¡å™¨</title>
      <link href="post/1568854505/"/>
      <url>post/1568854505/</url>
      
        <content type="html"><![CDATA[<h3 id="èµ·å› "><a href="#èµ·å› " class="headerlink" title="èµ·å› "></a>èµ·å› </h3><p><code>Windows</code>æ›´æ–°äº†<code>Ubuntu18.04</code>å­ç³»ç»Ÿ, äºæ˜¯å°±ä¸‹è½½ä¸‹æ¥ä½“éªŒä¸€æ³¢, ç»“æœå‘ç°, ç¨å¾®è®¾ç½®ä¸€ä¸‹, å¾ˆåˆæˆ‘çš„èƒƒå£â€¦</p><p>å¯¹æˆ‘æ¥è¯´, ç”¨è™šæ‹Ÿæœºæ¥åšå¼€å‘æœåŠ¡å™¨çš„, ä»€ä¹ˆ<code>Vmware</code>ã€<code>VirtureBox</code>ä¹‹ç±»çš„, ç»Ÿç»Ÿå¯ä»¥å¸è½½äº†å•Šâ€¦</p><p><img src="https://github.com/cayzlh/git-img-repository/raw/master/blog/ubuntu18.04.png" alt="Ubuntu18.04å­ç³»ç»Ÿ"></p><p>ç”¨äº†ä¸€æ®µæ—¶é—´ä¹‹å, å°±æƒ³ç€, è¿™ä¸ªç•Œé¢æŒºä¸é”™çš„, é‚£ç›´æ¥æ‹¿è¿™ä¸ªæ¥å½“<code>ssh</code>å®¢æˆ·ç«¯å¥½äº†, ä»€ä¹ˆ<code>XShell</code>ä¹‹ç±»çš„ä¹Ÿå¯ä»¥å¸è½½äº†å•Šâ€¦</p><p>ä½†æ˜¯ä¸ºé¢˜æ¥, æ¯æ¬¡ä½¿ç”¨<code>ssh</code>è¿æ¥è¿œç¨‹æœåŠ¡å™¨, éƒ½æœ‰è¾“å…¥å¯†ç , æœ‰äº›å¯†ç åŠå…¶å¤æ‚, æ ¹æœ¬ä¸å¯èƒ½è®°å¾—ä½, è¿™å’‹æ, äºæ˜¯ä¹â€¦.</p><p>æ¥æŠ˜è…¾ä¸€æ³¢<code>ssh</code>ç›´æ¥è¿æ¥è¿œç¨‹æœåŠ¡å™¨çš„é…ç½®è¿‡ç¨‹â€¦</p><h3 id="è¿‡ç¨‹"><a href="#è¿‡ç¨‹" class="headerlink" title="è¿‡ç¨‹"></a>è¿‡ç¨‹</h3><h4 id="å®‰è£…openssh-server"><a href="#å®‰è£…openssh-server" class="headerlink" title="å®‰è£…openssh-server"></a>å®‰è£…openssh-server</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get install openssh-server</span><br></pre></td></tr></table></figure><p>ä¾æ¬¡æ‰§è¡Œä»¥ä¸Šå‘½ä»¤, å®‰è£…<code>ssh</code>æœåŠ¡, é€šå¸¸æƒ…å†µä¸‹, å­ç³»ç»Ÿä¸‹å·²ç»å®‰è£…å¥½äº†è¿™ä¸ªæœåŠ¡äº†, é‚£å°±å¯ä»¥å¿½ç•¥è¿™ä¸€æ­¥.</p><h4 id="ç”Ÿæˆå…¬é’¥å’Œå¯†é’¥"><a href="#ç”Ÿæˆå…¬é’¥å’Œå¯†é’¥" class="headerlink" title="ç”Ÿæˆå…¬é’¥å’Œå¯†é’¥"></a>ç”Ÿæˆå…¬é’¥å’Œå¯†é’¥</h4><p>ä½¿ç”¨å½“å‰ç”¨æˆ·æ‰§è¡Œ</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ssh-keygen</span><br></pre></td></tr></table></figure><p>ä¸€ç›´å®‰å›è½¦,ç”Ÿæˆçš„å…¬é’¥å’Œå¯†é’¥åœ¨ç”¨æˆ·æ–‡ä»¶å¤¹ä¸‹çš„ <code>~/.ssh</code>.</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cat ~/.ssh/id_rsa.pub</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œä¸Šé¢çš„å‘½ä»¤, å°†å…¬é’¥çš„å†…å®¹å¤åˆ¶åˆ°ç²˜è´´æ¿</p><h4 id="åœ¨è¿œç¨‹æœåŠ¡å™¨ä¸Šæ“ä½œ-è¿œç¨‹æœåŠ¡å™¨sshæœåŠ¡è£…å¥½çš„æƒ…å†µ"><a href="#åœ¨è¿œç¨‹æœåŠ¡å™¨ä¸Šæ“ä½œ-è¿œç¨‹æœåŠ¡å™¨sshæœåŠ¡è£…å¥½çš„æƒ…å†µ" class="headerlink" title="åœ¨è¿œç¨‹æœåŠ¡å™¨ä¸Šæ“ä½œ(è¿œç¨‹æœåŠ¡å™¨sshæœåŠ¡è£…å¥½çš„æƒ…å†µ)"></a>åœ¨è¿œç¨‹æœåŠ¡å™¨ä¸Šæ“ä½œ(è¿œç¨‹æœåŠ¡å™¨sshæœåŠ¡è£…å¥½çš„æƒ…å†µ)</h4><h5 id="ç™»å½•è¿œç¨‹æœåŠ¡å™¨æ‰§è¡Œ"><a href="#ç™»å½•è¿œç¨‹æœåŠ¡å™¨æ‰§è¡Œ" class="headerlink" title="ç™»å½•è¿œç¨‹æœåŠ¡å™¨æ‰§è¡Œ:"></a>ç™»å½•è¿œç¨‹æœåŠ¡å™¨æ‰§è¡Œ:</h5><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">vi ~/.ssh/authorized_keys</span><br></pre></td></tr></table></figure><p>å°†ç²˜è´´æ¿çš„å†…å®¹å¤åˆ¶åˆ°æ–‡ä»¶ä¸­,æˆ–è€…åˆ©ç”¨<code>sftp</code>å·¥å…·, å°†æœ¬åœ°çš„<code>id_rsa.pub</code>ä¸Šä¼ åˆ°è¿œç¨‹æœåŠ¡å™¨,æ‰§è¡Œ</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cat id_rsa.pub &gt;&gt; ~/.ssh/authorized_keys</span><br></pre></td></tr></table></figure><h5 id="ç”¨viæ‰“å¼€-etc-ssh-sshd-configè¿™ä¸ªæ–‡ä»¶"><a href="#ç”¨viæ‰“å¼€-etc-ssh-sshd-configè¿™ä¸ªæ–‡ä»¶" class="headerlink" title="ç”¨viæ‰“å¼€/etc/ssh/sshd_configè¿™ä¸ªæ–‡ä»¶"></a>ç”¨viæ‰“å¼€/etc/ssh/sshd_configè¿™ä¸ªæ–‡ä»¶</h5><p>å°†ä¸‹é¢å‡ è¡Œå‰é¢â€œ#â€æ³¨é‡Šå–æ‰</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">RSAAuthentication yes </span><br><span class="line">PubkeyAuthentication yes </span><br><span class="line">AuthorizedKeysFile .ssh/authorized_keys</span><br></pre></td></tr></table></figure><h5 id="é‡å¯sshæœåŠ¡"><a href="#é‡å¯sshæœåŠ¡" class="headerlink" title="é‡å¯sshæœåŠ¡"></a>é‡å¯sshæœåŠ¡</h5><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">service sshd restart</span><br></pre></td></tr></table></figure><h3 id="æœ¬åœ°æ“ä½œ"><a href="#æœ¬åœ°æ“ä½œ" class="headerlink" title="æœ¬åœ°æ“ä½œ"></a>æœ¬åœ°æ“ä½œ</h3><h4 id="åœ¨-ssh-ä¸­åˆ›å»ºconfigæ–‡ä»¶"><a href="#åœ¨-ssh-ä¸­åˆ›å»ºconfigæ–‡ä»¶" class="headerlink" title="åœ¨~/.ssh/ä¸­åˆ›å»ºconfigæ–‡ä»¶"></a>åœ¨~/.ssh/ä¸­åˆ›å»ºconfigæ–‡ä»¶</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">vi ~/.ssh/config</span><br></pre></td></tr></table></figure><p>å¡«å…¥å¦‚ä¸‹å†…å®¹:</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">Host AAAAAA</span><br><span class="line">HostName youipaddress</span><br><span class="line">User root</span><br><span class="line">Port 22</span><br><span class="line">IdentityFile /home/yourusername/.ssh/id_rsa</span><br></pre></td></tr></table></figure><p>å…¶ä¸­</p><ol><li>Host æ˜¯åˆ«å</li><li>HostName ipåœ°å€</li><li>User è¿œç¨‹æœåŠ¡å™¨çš„ç™»å½•ç”¨æˆ·å</li><li>Port è¿œç¨‹ç™»å½•çš„sshç«¯å£ä¸</li><li>IdentityFile æœ¬åœ°æœåŠ¡å™¨çš„ç§é’¥åœ°å€</li></ol><p><img src="https://github.com/cayzlh/git-img-repository/raw/master/blog/sshconfig.png" alt="configé…ç½®"></p><h4 id="ä¿®æ”¹configæ–‡ä»¶çš„æƒé™"><a href="#ä¿®æ”¹configæ–‡ä»¶çš„æƒé™" class="headerlink" title="ä¿®æ”¹configæ–‡ä»¶çš„æƒé™"></a>ä¿®æ”¹configæ–‡ä»¶çš„æƒé™</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">chmod 700 ~/.ssh/config</span><br></pre></td></tr></table></figure><h3 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h3><p>è¾“å…¥ä»¥ä¸‹å‘½ä»¤, å°±å¯ä»¥ç›´æ¥è¿æ¥è¿œç¨‹æœåŠ¡å™¨äº†, å…¶ä¸­<code>AAAAAA</code>æ˜¯<code>config</code>æ–‡ä»¶ä¸­æŒ‡å®šçš„<code>Host</code>çš„å€¼â€¦</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ssh AAAAAA</span><br></pre></td></tr></table></figure><p><img src="https://github.com/cayzlh/git-img-repository/raw/master/blog/sshlink.png" alt="sshè¿æ¥"></p><h3 id="END"><a href="#END" class="headerlink" title="END"></a>END</h3><p> emmmmmmmmmmmm,  Enjoy it !!</p>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®°æœ¬ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> ssh </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åˆ©ç”¨GithubåšMavenç§æœ</title>
      <link href="post/3486685421/"/>
      <url>post/3486685421/</url>
      
        <content type="html"><![CDATA[<blockquote><p>å…³äºGitHubçš„éªšæ“ä½œä¸€ç›´ä»¥æ¥éƒ½æœ‰å¾ˆå¤šï¼Œè¿™ç¯‡æ–‡ç« è®°å½•ä¸€ä¸‹ä½¿ç”¨GitHubæ¥åšå…è´¹maven ç§æœçš„æ–¹æ³•ã€‚</p></blockquote><h2 id="å‘å¸ƒåˆ°GitHub"><a href="#å‘å¸ƒåˆ°GitHub" class="headerlink" title="å‘å¸ƒåˆ°GitHub"></a>å‘å¸ƒåˆ°GitHub</h2><h3 id="ä¿®æ”¹setting-xml"><a href="#ä¿®æ”¹setting-xml" class="headerlink" title="ä¿®æ”¹setting.xml"></a>ä¿®æ”¹setting.xml</h3><p>ä¿®æ”¹<code>maven</code>çš„<code>setting.xml</code>æ–‡ä»¶ï¼Œåœ¨<code>servers</code>èŠ‚ç‚¹ä¸‹æ·»åŠ </p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">server</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">id</span>&gt;</span>github<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">username</span>&gt;</span>yourname<span class="tag">&lt;/<span class="name">username</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">password</span>&gt;</span>yourpassword<span class="tag">&lt;/<span class="name">password</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">server</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="ä½¿ç”¨mavenæ’ä»¶"><a href="#ä½¿ç”¨mavenæ’ä»¶" class="headerlink" title="ä½¿ç”¨mavenæ’ä»¶"></a>ä½¿ç”¨mavenæ’ä»¶</h3><p>ä¿®æ”¹é¡¹ç›®å·¥ç¨‹çš„<code>pom.xml</code>æ–‡ä»¶ï¼Œæ·»åŠ ä»¥ä¸‹ä¸¤ä¸ªæ’ä»¶ï¼š</p><h4 id="maven-deploy-plugin"><a href="#maven-deploy-plugin" class="headerlink" title="maven-deploy-plugin"></a>maven-deploy-plugin</h4><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-deploy-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.8.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">altDeploymentRepository</span>&gt;</span></span><br><span class="line">      internal.repo::default::file://$&#123;project.build.directory&#125;/maven-repo</span><br><span class="line">    <span class="tag">&lt;/<span class="name">altDeploymentRepository</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="site-maven-plugin"><a href="#site-maven-plugin" class="headerlink" title="site-maven-plugin"></a>site-maven-plugin</h4><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.github<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>site-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.12<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">message</span>&gt;</span>ğŸ³ deploy maven artifacts, version: $&#123;project.version&#125;<span class="tag">&lt;/<span class="name">message</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">noJekyll</span>&gt;</span>true<span class="tag">&lt;/<span class="name">noJekyll</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">outputDirectory</span>&gt;</span>$&#123;project.build.directory&#125;/maven-repo<span class="tag">&lt;/<span class="name">outputDirectory</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--æœ¬åœ°jaråœ°å€--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">branch</span>&gt;</span>refs/heads/master<span class="tag">&lt;/<span class="name">branch</span>&gt;</span><span class="comment">&lt;!--åˆ†æ”¯çš„åç§°--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">merge</span>&gt;</span>true<span class="tag">&lt;/<span class="name">merge</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">includes</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">include</span>&gt;</span>**/*<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">includes</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">repositoryName</span>&gt;</span>maven-repo<span class="tag">&lt;/<span class="name">repositoryName</span>&gt;</span><span class="comment">&lt;!--å¯¹åº”githubä¸Šåˆ›å»ºçš„ä»“åº“åç§° name--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">repositoryOwner</span>&gt;</span>cayzlh<span class="tag">&lt;/<span class="name">repositoryOwner</span>&gt;</span><span class="comment">&lt;!--github ä»“åº“æ‰€æœ‰è€…å³ç™»å½•ç”¨æˆ·å--&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">goals</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">goal</span>&gt;</span>site<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">goals</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">phase</span>&gt;</span>deploy<span class="tag">&lt;/<span class="name">phase</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br></pre></td></tr></table></figure><p>###deploy</p><p>æ‰§è¡Œå‘½ä»¤è¿›è¡Œæ‰“åŒ…ï¼š</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">mvn clean package</span><br></pre></td></tr></table></figure><blockquote><p>å¥½åƒå¯ä»¥ä¸ç”¨æ‰“åŒ…</p></blockquote><p>åœ¨<code>idea</code>å·¦ä¾§<code>lifecycle</code>ä¸­åŒå‡»<code>deploy</code>ï¼š</p><p><img src="https://gitee.com/cayzlh/img-repo/raw/master/2020/04/23/FNGZ7J.png" alt="image-20200423221908456"></p><p>é™é™ç­‰å¾…â€¦..</p><p><img src="https://gitee.com/cayzlh/img-repo/raw/master/2020/04/23/uPEUku.png" alt="image-20200423222621366"></p><h2 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h2><p>åœ¨éœ€è¦ä½¿ç”¨åˆ°ç§æœçš„é¡¹ç›®<code>pom.xml</code>æ–‡ä»¶ä¸­æ·»åŠ ï¼š</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">repositories</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">repository</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span>&gt;</span>maven-repo<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url</span>&gt;</span>https://raw.githubusercontent.com/yourname/maven-repo/master/<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">releases</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">enabled</span>&gt;</span>true<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">releases</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">snapshots</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">enabled</span>&gt;</span>false<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">snapshots</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">repository</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">repositories</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="Enjoy-it"><a href="#Enjoy-it" class="headerlink" title="Enjoy it."></a>Enjoy it.</h3>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®°æœ¬ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Github </tag>
            
            <tag> Maven </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SpringBootå®ç°Jwtå•ç‚¹ç™»å½•</title>
      <link href="post/1568928662/"/>
      <url>post/1568928662/</url>
      
        <content type="html"><![CDATA[<blockquote><p>å®‰å…¨ç®¡ç†æ˜¯åº”ç”¨ç³»ç»Ÿä¸å¯ç¼ºå°‘çš„åŠŸèƒ½. æœ¬æ–‡ä¸»è¦åˆ†äº«å€ŸåŠ©JWTçš„tokenæŠ€æœ¯å®ç°åˆ†å¸ƒå¼ç³»ç»Ÿçš„å®‰å…¨ç®¡ç†.</p></blockquote><h3 id="åŸºæœ¬æ¦‚å¿µ"><a href="#åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="åŸºæœ¬æ¦‚å¿µ"></a>åŸºæœ¬æ¦‚å¿µ</h3><p>JSON Web Tokens(JWT)æ˜¯ä¸€ç§å¼€æ”¾çš„ã€è¡Œä¸šæ ‡å‡†(RFC 7519)ï¼Œç”¨äºç½‘ç»œåº”ç”¨ç¯å¢ƒé—´å®‰å…¨ä¼ é€’å£°æ˜ã€‚JWTçš„å£°æ˜ä¸€èˆ¬è¢«ç”¨æ¥åœ¨èº«ä»½æä¾›è€…å’ŒæœåŠ¡æä¾›è€…é—´ä¼ é€’è¢«è®¤è¯çš„ç”¨æˆ·èº«ä»½ä¿¡æ¯ï¼Œä»¥ä¾¿äºä»èµ„æºæœåŠ¡å™¨è·å–èµ„æºï¼Œä¹Ÿå¯ä»¥å¢åŠ ä¸€äº›é¢å¤–çš„ä¸šåŠ¡é€»è¾‘æ‰€é¡»çš„å£°æ˜ä¿¡æ¯ã€‚</p><h4 id="JWTç‰¹ç‚¹ï¼š"><a href="#JWTç‰¹ç‚¹ï¼š" class="headerlink" title="JWTç‰¹ç‚¹ï¼š"></a>JWTç‰¹ç‚¹ï¼š</h4><p>â–· è·¨è¯­è¨€:æ”¯æŒPythonã€Node.jsã€Javaã€Goã€cã€JavaScriptç­‰ä¸»æµè¯­è¨€</p><p>â–· è‡ªåŒ…å«ï¼šåŒ…å«äº†å¿…è¦çš„æ‰€æœ‰ä¿¡æ¯ï¼Œå¦‚ç”¨æˆ·ä¿¡æ¯å’Œç­¾åç­‰</p><p>â–· æ˜“ä¼ é€’ï¼šå¾ˆæ–¹ä¾¿é€šè¿‡HTTPå¤´éƒ¨ä¼ é€’</p><p>å®˜ç½‘ä½ç½®ï¼š<a href="https://jwt.io/">https://jwt.io</a></p><h3 id="JWTåŸç†"><a href="#JWTåŸç†" class="headerlink" title="JWTåŸç†"></a>JWTåŸç†</h3><h4 id="JWTçš„tokenç»„æˆ"><a href="#JWTçš„tokenç»„æˆ" class="headerlink" title="JWTçš„tokenç»„æˆ"></a>JWTçš„tokenç»„æˆ</h4><p> JWTçš„tokenæ˜¯ä¸‰æ®µç”±å°æ•°ç‚¹åˆ†éš”ç»„æˆçš„å­—ç¬¦ä¸²,å¦‚ aaaa.bbbb.cccccï¼Œè¿™ä¸‰éƒ¨åˆ†å«ä¹‰åˆ†åˆ«æ˜¯headerã€payloadã€signatureã€‚</p><h5 id="header"><a href="#header" class="headerlink" title="header"></a>header</h5><p>å¤´éƒ¨åŒ…å«äº†ä¸¤éƒ¨åˆ†ï¼šç±»å‹å’Œä½¿ç”¨çš„å“ˆå¸Œç®—æ³•ï¼ˆå¦‚HMAC SHA256ï¼‰ï¼š</p><figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;typ&quot;</span>: <span class="string">&quot;JWT&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;alg&quot;</span>: <span class="string">&quot;HS256&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="payload"><a href="#payload" class="headerlink" title="payload"></a>payload</h5><p>ä¹Ÿç§°ä¸ºJWT claimsï¼Œæ”¾ç½®éœ€è¦ä¼ è¾“çš„ä¿¡æ¯ï¼Œæœ‰ä¸‰ç±»ï¼šä¿ç•™claimsã€å…¬å…±claimsã€ç§æœ‰claimsã€‚</p><p>â–· ä¿ç•™claimsï¼Œä¸»è¦åŒ…æ‹¬isså‘è¡Œè€…ã€expè¿‡æœŸæ—¶é—´ã€subä¸»é¢˜ã€audç”¨æˆ·ç­‰ </p><p>â–· å…¬å…±claimsï¼Œå®šä¹‰æ–°åˆ›çš„ä¿¡æ¯ï¼Œæ¯”å¦‚ç”¨æˆ·ä¿¡æ¯å’Œå…¶ä»–é‡è¦ä¿¡æ¯</p><p>â–· ç§æœ‰claimsï¼Œç”¨äºå‘å¸ƒè€…å’Œæ¶ˆè´¹è€…éƒ½åŒæ„ä»¥ç§æœ‰çš„æ–¹å¼ä½¿ç”¨çš„ä¿¡æ¯</p><p>JWTç¤ºä¾‹ï¼š</p><figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line"><span class="attr">&quot;iss&quot;</span>: <span class="string">&quot;jwt.io&quot;</span>,</span><br><span class="line"><span class="attr">&quot;exp&quot;</span>: <span class="number">1496199995458</span>,</span><br><span class="line"><span class="attr">&quot;name&quot;</span>: <span class="string">&quot;sinwaj&quot;</span>,</span><br><span class="line"><span class="attr">&quot;role&quot;</span>: <span class="string">&quot;admin&quot;</span> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="signature"><a href="#signature" class="headerlink" title="signature"></a>signature</h5><p>  éœ€è¦é‡‡ç”¨ç¼–ç çš„headerã€ç¼–ç çš„payloadã€secretï¼Œä½¿ç”¨headerä¸­æŒ‡å®šçš„ç®—æ³•è¿›è¡Œç­¾åã€‚ </p><p>JWTæä¾›ä¸‹è¿°åŠŸèƒ½ï¼š<br>â–· æŸç§ç¨‹åº¦çš„ç”¨æˆ·èº«ä»½éªŒè¯<br>â–· ä½¿ç”¨å¯†é’¥ç­¾å<br>â–· å®¢æˆ·ç«¯æ¯ä¸ªè¯·æ±‚éƒ½å¸¦æœ‰JWT<br>â–· æœåŠ¡å™¨ä½¿ç”¨å¯†é’¥åˆ†æå’Œæ£€æŸ¥claims</p><p>ä»¥ä¸Šæ‘˜è‡ªå…¬ä¼—å·: <code>ä¸­å…´å¼€å‘è€…ç¤¾åŒº</code></p><hr><h3 id="ä»£ç å®ç°"><a href="#ä»£ç å®ç°" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h3><h4 id="é¡¹ç›®åœ°å€"><a href="#é¡¹ç›®åœ°å€" class="headerlink" title="é¡¹ç›®åœ°å€"></a>é¡¹ç›®åœ°å€</h4><p><a href="https://github.com/cayzlh/springboot-jwt-demo">https://github.com/cayzlh/springboot-jwt-demo</a></p><h4 id="è‡ªå®šä¹‰Jwtç™»å½•æ‹¦æˆªå™¨"><a href="#è‡ªå®šä¹‰Jwtç™»å½•æ‹¦æˆªå™¨" class="headerlink" title="è‡ªå®šä¹‰Jwtç™»å½•æ‹¦æˆªå™¨"></a>è‡ªå®šä¹‰Jwtç™»å½•æ‹¦æˆªå™¨</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.cayzlh.jwt.security.filter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.cayzlh.jwt.exception.BaseException;</span><br><span class="line"><span class="keyword">import</span> com.cayzlh.jwt.security.dto.AuthenticationRequest;</span><br><span class="line"><span class="keyword">import</span> com.cayzlh.jwt.security.jwt.JwtTokenUtil;</span><br><span class="line"><span class="keyword">import</span> com.cayzlh.jwt.security.service.UserDetailsServiceImpl;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line"><span class="keyword">import</span> com.google.common.base.Preconditions;</span><br><span class="line"><span class="keyword">import</span> com.google.common.collect.Lists;</span><br><span class="line"><span class="keyword">import</span> org.apache.log4j.Logger;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.authentication.AuthenticationManager;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.authentication.UsernamePasswordAuthenticationToken;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.Authentication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.AuthenticationException;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.userdetails.UserDetails;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.web.authentication.UsernamePasswordAuthenticationFilter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.FilterChain;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Description:</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * éªŒè¯ç”¨æˆ·åå¯†ç æ˜¯å¦æ­£ç¡®, ç”Ÿæˆä¸€ä¸ªtoken, å¹¶å°†tokenè¿”å›ç»™å®¢æˆ·ç«¯</span></span><br><span class="line"><span class="comment"> * è¯¥ç±»ç»§æ‰¿è‡ªUsernamePasswordAuthenticationFilterï¼Œé‡å†™äº†å…¶ä¸­çš„2ä¸ªæ–¹æ³•</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * attemptAuthentication ï¼šæ¥æ”¶å¹¶è§£æç”¨æˆ·å‡­è¯ã€‚</span></span><br><span class="line"><span class="comment"> * successfulAuthentication ï¼šç”¨æˆ·æˆåŠŸç™»å½•åï¼Œè¿™ä¸ªæ–¹æ³•ä¼šè¢«è°ƒç”¨ï¼Œæˆ‘ä»¬åœ¨è¿™ä¸ªæ–¹æ³•é‡Œç”Ÿæˆtokenã€‚</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Antä¸¶</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2018-05-11.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginFilter</span> <span class="keyword">extends</span> <span class="title">UsernamePasswordAuthenticationFilter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Logger logger = Logger.getLogger(LoginFilter.class);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> AuthenticationManager authenticationManager;</span><br><span class="line">    <span class="keyword">private</span> JwtTokenUtil jwtTokenUtil;</span><br><span class="line">    <span class="keyword">private</span> UserDetailsServiceImpl jwtUserDetailsService;</span><br><span class="line">    <span class="keyword">private</span> String tokenHeader;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">LoginFilter</span><span class="params">(AuthenticationManager authenticationManager, JwtTokenUtil jwtTokenUtil, UserDetailsServiceImpl jwtUserDetailsService, String tokenHeader)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.authenticationManager = authenticationManager;</span><br><span class="line">        <span class="keyword">this</span>.jwtTokenUtil = jwtTokenUtil;</span><br><span class="line">        <span class="keyword">this</span>.jwtUserDetailsService = jwtUserDetailsService;</span><br><span class="line">        <span class="keyword">this</span>.tokenHeader = tokenHeader;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ¥æ”¶å¹¶è§£æç”¨æˆ·å‡­è¯</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> request request</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> response response</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> AuthenticationException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Authentication <span class="title">attemptAuthentication</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> AuthenticationException </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            AuthenticationRequest user = <span class="keyword">new</span> ObjectMapper().readValue(request.getInputStream(), AuthenticationRequest.class);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> authenticationManager.authenticate(</span><br><span class="line">                    <span class="keyword">new</span> UsernamePasswordAuthenticationToken(user.getUsername(), user.getPassword(), Lists.newArrayList())</span><br><span class="line">            );</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            logger.error(<span class="string">&quot;[LoginFilter][attemptAuthentication()]&quot;</span>, e);</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> BaseException(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç”¨æˆ·æˆåŠŸç™»å½•å</span></span><br><span class="line"><span class="comment">     *      è¿™ä¸ªæ–¹æ³•ä¼šè¢«è°ƒç”¨,  åœ¨è¿™é‡Œç”Ÿæˆtoken</span></span><br><span class="line"><span class="comment"> *      è®¾ç½®åˆ°headeré‡Œé¢è¿”å›</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> request request</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> response response</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> chain chain</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> authResult authResult</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> ServletException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">successfulAuthentication</span><span class="params">(HttpServletRequest request, HttpServletResponse response, FilterChain chain, Authentication authResult)</span> <span class="keyword">throws</span> IOException, ServletException </span>&#123;</span><br><span class="line">        UserDetails userDetails = jwtUserDetailsService.loadUserByUsername(authResult.getName());</span><br><span class="line">        Preconditions.checkNotNull(userDetails);</span><br><span class="line">        String token = jwtTokenUtil.generateToken(userDetails);</span><br><span class="line">        response.addHeader(tokenHeader, <span class="string">&quot;Bearer &quot;</span> + token);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="è‡ªå®šä¹‰Jwtè®¤è¯æ‹¦æˆªå™¨"><a href="#è‡ªå®šä¹‰Jwtè®¤è¯æ‹¦æˆªå™¨" class="headerlink" title="è‡ªå®šä¹‰Jwtè®¤è¯æ‹¦æˆªå™¨"></a>è‡ªå®šä¹‰Jwtè®¤è¯æ‹¦æˆªå™¨</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.cayzlh.jwt.security.filter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.cayzlh.jwt.security.jwt.JwtTokenUtil;</span><br><span class="line"><span class="keyword">import</span> io.jsonwebtoken.ExpiredJwtException;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.lang3.StringUtils;</span><br><span class="line"><span class="keyword">import</span> org.apache.log4j.Logger;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.authentication.AuthenticationManager;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.authentication.UsernamePasswordAuthenticationToken;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.context.SecurityContextHolder;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.userdetails.UserDetails;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.userdetails.UserDetailsService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.web.AuthenticationEntryPoint;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.web.authentication.WebAuthenticationDetailsSource;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.web.authentication.www.BasicAuthenticationFilter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.FilterChain;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Description:</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> *     Jwt tokenè®¤è¯æ‹¦æˆªå™¨</span></span><br><span class="line"><span class="comment"> *          å¦‚æœæ ¡éªŒé€šè¿‡, å°±è®¤ä¸ºè¿™æ˜¯ä¸€ä¸ªåˆæ³•çš„è¯·æ±‚</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Antä¸¶</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2018-05-10.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AuthorizationTokenFilter</span> <span class="keyword">extends</span> <span class="title">BasicAuthenticationFilter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Logger logger = Logger.getLogger(AuthorizationTokenFilter.class);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> UserDetailsService userDetailsService;</span><br><span class="line">    <span class="keyword">private</span> JwtTokenUtil jwtTokenUtil;</span><br><span class="line">    <span class="keyword">private</span> String tokenHeader;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">AuthorizationTokenFilter</span><span class="params">(AuthenticationManager authenticationManager, AuthenticationEntryPoint authenticationEntryPoint, UserDetailsService userDetailsService, JwtTokenUtil jwtTokenUtil, String tokenHeader)</span> </span>&#123;</span><br><span class="line"><span class="keyword">super</span>(authenticationManager, authenticationEntryPoint);</span><br><span class="line"><span class="keyword">this</span>.userDetailsService = userDetailsService;</span><br><span class="line"><span class="keyword">this</span>.jwtTokenUtil = jwtTokenUtil;</span><br><span class="line"><span class="keyword">this</span>.tokenHeader = tokenHeader;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doFilterInternal</span><span class="params">(HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse, FilterChain filterChain)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        logger.debug(<span class="string">&quot;processing authentication for &#x27;&quot;</span>+httpServletRequest.getRequestURL()+<span class="string">&quot;&#x27;&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">final</span> String requestHeader = httpServletRequest.getHeader(<span class="keyword">this</span>.tokenHeader);</span><br><span class="line"></span><br><span class="line">        String username = <span class="keyword">null</span>;</span><br><span class="line">        String authToken = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isNotBlank(requestHeader) &amp;&amp; requestHeader.startsWith(<span class="string">&quot;Bearer &quot;</span>)) &#123;</span><br><span class="line">            authToken = requestHeader.substring(<span class="number">7</span>);</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                username = jwtTokenUtil.getUsernameFromToken(authToken);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IllegalArgumentException e) &#123;</span><br><span class="line">                logger.error(<span class="string">&quot;ä»ä»¤ç‰Œ[&quot;</span>+authToken+<span class="string">&quot;]è·å–ç”¨æˆ·åæœŸé—´å‘ç”Ÿé”™è¯¯&quot;</span>, e);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (ExpiredJwtException e) &#123;</span><br><span class="line">                logger.error(<span class="string">&quot;ä»¤ç‰Œ[&quot;</span>+authToken+<span class="string">&quot;]å·²è¿‡æœŸå¹¶ä¸”ä¸å†æœ‰æ•ˆ&quot;</span>, e);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            logger.debug(<span class="string">&quot;æ‰¾ä¸åˆ°Bearerå­—ç¬¦ä¸², å¿½ç•¥Headerç»§ç»­.&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        logger.debug(<span class="string">&quot;æ£€æŸ¥ç”¨æˆ·[&quot;</span>+username+<span class="string">&quot;]çš„èº«ä»½éªŒè¯&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isNotBlank(username) &amp;&amp; <span class="keyword">null</span> == SecurityContextHolder.getContext().getAuthentication()) &#123;</span><br><span class="line">            logger.debug(<span class="string">&quot;security contextä¸ºç©º, æˆæƒç”¨æˆ·&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä»æ•°æ®åº“åŠ è½½ä½¿ç”¨ä½¿ç”¨ç»†èŠ‚å¹¶ä¸æ˜¯å¿…éœ€çš„, ä¹Ÿå¯ä»¥å­˜å‚¨ä¿¡æ¯åœ¨ä»¤ç‰Œä¸­è¯»å–å®ƒå¹¶ä»ä¸­è¯»å–å®ƒ.</span></span><br><span class="line">            UserDetails userDetails = <span class="keyword">this</span>.userDetailsService.loadUserByUsername(username);</span><br><span class="line"></span><br><span class="line"><span class="comment">//å¯¹äºç®€å•çš„éªŒè¯ï¼Œä»…æ£€æŸ¥ä»¤ç‰Œå®Œæ•´æ€§å°±è¶³å¤Ÿäº†, ä¸éœ€è¦å¼•äººæ³¨ç›®åœ°è°ƒç”¨æ•°æ®åº“.</span></span><br><span class="line">            <span class="keyword">if</span> (jwtTokenUtil.validateToken(authToken, userDetails)) &#123;</span><br><span class="line">                UsernamePasswordAuthenticationToken authentication = <span class="keyword">new</span> UsernamePasswordAuthenticationToken(userDetails, <span class="keyword">null</span>, userDetails.getAuthorities());</span><br><span class="line">                authentication.setDetails(<span class="keyword">new</span> WebAuthenticationDetailsSource().buildDetails(httpServletRequest));</span><br><span class="line">                logger.info(<span class="string">&quot;è®¤è¯ç”¨æˆ· [&quot;</span>+username+<span class="string">&quot;], è®¾ç½® securityåˆ°contextä¸Šä¸‹æ–‡&quot;</span>);</span><br><span class="line">                SecurityContextHolder.getContext().setAuthentication(authentication);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        filterChain.doFilter(httpServletRequest, httpServletResponse);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="è‡ªå®šä¹‰èº«ä»½éªŒè¯ç»„ä»¶"><a href="#è‡ªå®šä¹‰èº«ä»½éªŒè¯ç»„ä»¶" class="headerlink" title="è‡ªå®šä¹‰èº«ä»½éªŒè¯ç»„ä»¶"></a>è‡ªå®šä¹‰èº«ä»½éªŒè¯ç»„ä»¶</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.cayzlh.jwt.security.provider;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.cayzlh.jwt.security.dto.GrantedAuthorityImpl;</span><br><span class="line"><span class="keyword">import</span> com.google.common.base.Preconditions;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.authentication.AuthenticationProvider;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.authentication.BadCredentialsException;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.authentication.UsernamePasswordAuthenticationToken;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.Authentication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.AuthenticationException;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.GrantedAuthority;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.userdetails.UserDetails;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.userdetails.UserDetailsService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.userdetails.UsernameNotFoundException;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder;</span><br><span class="line"><span class="keyword">import</span> org.springframework.util.DigestUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Description:</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> *     è‡ªå®šä¹‰èº«ä»½éªŒè¯ç»„ä»¶</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Antä¸¶</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2018-05-11.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomAuthenticationProvider</span> <span class="keyword">implements</span> <span class="title">AuthenticationProvider</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> UserDetailsService userDetailsService;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> BCryptPasswordEncoder bCryptPasswordEncoder;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CustomAuthenticationProvider</span><span class="params">(UserDetailsService userDetailsService, BCryptPasswordEncoder bCryptPasswordEncoder)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.userDetailsService = userDetailsService;</span><br><span class="line">        <span class="keyword">this</span>.bCryptPasswordEncoder = bCryptPasswordEncoder;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Authentication <span class="title">authenticate</span><span class="params">(Authentication authentication)</span> <span class="keyword">throws</span> AuthenticationException </span>&#123;</span><br><span class="line">        String name = authentication.getName();</span><br><span class="line">        String password = authentication.getCredentials().toString();</span><br><span class="line"></span><br><span class="line">        Preconditions.checkNotNull(name);</span><br><span class="line">        Preconditions.checkNotNull(password);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// TODOã€€é‡æ–°æ•´ç†é€»è¾‘</span></span><br><span class="line">        UserDetails userDetails = userDetailsService.loadUserByUsername(name);</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">null</span> != userDetails) &#123;</span><br><span class="line">            String encodePassword = DigestUtils.md5DigestAsHex((password).getBytes());</span><br><span class="line">            <span class="keyword">if</span> (userDetails.getPassword().equalsIgnoreCase(encodePassword)) &#123;</span><br><span class="line">                <span class="comment">// TODO è®¾ç½®æƒé™</span></span><br><span class="line">                ArrayList&lt;GrantedAuthority&gt; authorities = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">                authorities.add( <span class="keyword">new</span> GrantedAuthorityImpl(<span class="string">&quot;ROLE_ADMIN&quot;</span>) );</span><br><span class="line">                authorities.add( <span class="keyword">new</span> GrantedAuthorityImpl(<span class="string">&quot;AUTH_WRITE&quot;</span>) );</span><br><span class="line">                <span class="comment">// ç”Ÿæˆä»¤ç‰Œ è¿™é‡Œä»¤ç‰Œé‡Œé¢å­˜å…¥äº†:name,password,authorities, å½“ç„¶ä½ ä¹Ÿå¯ä»¥æ”¾å…¶ä»–å†…å®¹ todo ä¸è¦æ”¾å¯†ç </span></span><br><span class="line">                Authentication auth = <span class="keyword">new</span> UsernamePasswordAuthenticationToken(name, password, authorities);</span><br><span class="line">                <span class="keyword">return</span> auth;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> BadCredentialsException(<span class="string">&quot;Password verification failed.&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> UsernameNotFoundException(<span class="string">&quot;Username does not exist.&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ˜¯å¦å¯ä»¥æä¾›è¾“å…¥ç±»å‹çš„è®¤è¯æœåŠ¡</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> authentication auth</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> æ˜¯å¦å¯ä»¥æä¾›è¾“å…¥ç±»å‹çš„è®¤è¯æœåŠ¡</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">supports</span><span class="params">(Class&lt;?&gt; authentication)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> authentication.equals(UsernamePasswordAuthenticationToken.class);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">String encodePassword = DigestUtils.md5DigestAsHex((<span class="string">&quot;Aa262535636@@&quot;</span>).getBytes());</span><br><span class="line">System.out.println(encodePassword);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="é…ç½®Security"><a href="#é…ç½®Security" class="headerlink" title="é…ç½®Security"></a>é…ç½®Security</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(HttpSecurity httpSecurity)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    <span class="comment">// jwtç™»å½•æ‹¦æˆªå™¨</span></span><br><span class="line">    LoginFilter jwtLoginFilter = <span class="keyword">new</span> LoginFilter(authenticationManager(), jwtTokenUtil, jwtUserDetailsService, tokenHeader);</span><br><span class="line">    <span class="comment">// è‡ªå®šä¹‰Jwtè®¤è¯æ‹¦æˆªå™¨</span></span><br><span class="line">    AuthorizationTokenFilter authenticationTokenFilter = <span class="keyword">new</span> AuthorizationTokenFilter(authenticationManager(), unauthorizedHandler, userDetailsService(), jwtTokenUtil, tokenHeader);</span><br><span class="line"></span><br><span class="line">    httpSecurity</span><br><span class="line">            <span class="comment">// ä¸ä½¿ç”¨CSRF</span></span><br><span class="line">            .cors().and().csrf().disable()</span><br><span class="line">            <span class="comment">// ä¸åˆ›å»ºsession</span></span><br><span class="line">            .sessionManagement().sessionCreationPolicy(SessionCreationPolicy.STATELESS).and()</span><br><span class="line">            <span class="comment">// å¼‚å¸¸å¤„ç†</span></span><br><span class="line">            .exceptionHandling().authenticationEntryPoint(unauthorizedHandler).and()</span><br><span class="line"></span><br><span class="line">            .authorizeRequests()</span><br><span class="line"></span><br><span class="line">            .antMatchers(HttpMethod.POST, <span class="string">&quot;/auth/**&quot;</span>).permitAll()</span><br><span class="line"></span><br><span class="line">            .anyRequest().authenticated()</span><br><span class="line"></span><br><span class="line">            .and()</span><br><span class="line">            .addFilter(jwtLoginFilter)</span><br><span class="line">            .addFilter(authenticationTokenFilter)</span><br><span class="line"></span><br><span class="line">            .logout().logoutUrl(<span class="string">&quot;/auth/logout&quot;</span>)</span><br><span class="line">            .logoutSuccessUrl(<span class="string">&quot;/auth/login&quot;</span>)</span><br><span class="line">            .permitAll()</span><br><span class="line"></span><br><span class="line">    ;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// disable page caching</span></span><br><span class="line">    httpSecurity</span><br><span class="line">            .headers()</span><br><span class="line">            .frameOptions().sameOrigin()  <span class="comment">// required to set for H2 else H2 Console will be blank.</span></span><br><span class="line">            .cacheControl();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸»è¦ä»£ç å¦‚ä¸Š</p><hr><h3 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h3><h4 id="ç¼–å†™ä¸€ä¸ªæµ‹è¯•çš„controller"><a href="#ç¼–å†™ä¸€ä¸ªæµ‹è¯•çš„controller" class="headerlink" title="ç¼–å†™ä¸€ä¸ªæµ‹è¯•çš„controller"></a>ç¼–å†™ä¸€ä¸ªæµ‹è¯•çš„controller</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(value = &quot;/jwt&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RequestMapping(value = &quot;/test&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">restTest</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;hello .&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="ä½¿ç”¨Posmanè®¿é—®"><a href="#ä½¿ç”¨Posmanè®¿é—®" class="headerlink" title="ä½¿ç”¨Posmanè®¿é—®"></a>ä½¿ç”¨<code>Posman</code>è®¿é—®</h4><p><img src="https://github.com/cayzlh/git-img-repository/raw/master/blog/%E6%97%A0%E6%9D%83%E9%99%90.png"></p><p>å¯ä»¥çœ‹åˆ°, ç›´æ¥æŠ›å‡º<code>Unauthorized</code>é”™è¯¯</p><h4 id="ç™»å½•è·å–token"><a href="#ç™»å½•è·å–token" class="headerlink" title="ç™»å½•è·å–token"></a>ç™»å½•è·å–token</h4><p>è®¿é—® <code>http://localhost:8080/login</code>, è¿™æ˜¯<code>security</code>è‡ªå¸¦çš„ç™»å½•æ¥å£, ä¸éœ€è¦è‡ªå·±å®šä¹‰:</p><p><img src="https://github.com/cayzlh/git-img-repository/raw/master/blog/%E7%99%BB%E5%BD%95.png"></p><p>å¯ä»¥çœ‹åˆ°, åœ¨è¿”å›çš„<code>Header</code>ä¸­å¤šäº†</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Authorization â†’Bearer eyJhbGciOiJIUzUxMiJ9.eyJzdWIiOiJjaGVuYW55dSIsImV4cCI6MTU0NjA1MzExNywiaWF0IjoxNTI3OTA5MTE3fQ.N37plSdzjBMkw5BoZQWXxVA8bobdI5vPfYs5N9CZq1Y_k-LVL3WhzySJBBwjwyVeySGB8CQR0l8yJr8fbxgiFw</span><br></pre></td></tr></table></figure><p>è¿™æ ·çš„å†…å®¹, è¿™ä¸ªå°±æ˜¯<code>jwt</code>ç”Ÿæˆçš„token.</p><h4 id="å¸¦ä¸Štokenè®¿é—®testæ¥å£"><a href="#å¸¦ä¸Štokenè®¿é—®testæ¥å£" class="headerlink" title="å¸¦ä¸Štokenè®¿é—®testæ¥å£"></a>å¸¦ä¸Štokenè®¿é—®testæ¥å£</h4><p>å°†<code>token</code>æ”¾åˆ°<code>head</code>çš„<code>Authorization</code>èŠ‚ç‚¹é‡Œé¢, é‡æ–°è®¿é—®testæ¥å£</p><p><img src="https://github.com/cayzlh/git-img-repository/blob/master/raw/%E6%9C%89%E6%9D%83%E9%99%90.png"></p><p>å¯ä»¥çœ‹åˆ°, è¿™ä¸ªæ—¶å€™æ˜¯å¯ä»¥æ­£å¸¸è¿”å›ç»“æœçš„.</p><h3 id="ç»“æŸ"><a href="#ç»“æŸ" class="headerlink" title="ç»“æŸ"></a>ç»“æŸ</h3><ol><li>JWTä¸­çš„tokenæ˜¯æ˜æ–‡, ä½†æ˜¯æ˜æ–‡è¢«ç­¾åè¿‡ï¼Œç­¾åå¯ä»¥ä½¿ç”¨å¯¹ç§°æˆ–è€…éå¯¹ç§°ç§˜é’¥ï¼Œæ— è®ºä½¿ç”¨ä»€ä¹ˆç§˜é’¥ï¼Œéƒ½æ²¡äººçŸ¥é“ï¼Œæ‰€ä»¥åˆ«äººæ— æ³•ä¼ªé€ ã€‚ä¹Ÿæ— æ³•ä¿®æ”¹ã€‚</li><li>ä¸éœ€è¦é€€å‡ºçš„æ¥å£, <code>token</code>å·²ç»æˆæƒç»™å®¢æˆ·ç«¯äº†ï¼Œæœ‰è¿‡æœŸæ—¶é—´ï¼Œé€€å‡ºçš„è¯, åªéœ€å®¢æˆ·ç«¯æŠŠtokenåˆ æ‰å³å¯.</li></ol><p>end.</p>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹æŠ€æœ¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> SpringBoot </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SpringBootå®ç°Redisåˆ†å¸ƒå¼é”</title>
      <link href="post/1639182984/"/>
      <url>post/1639182984/</url>
      
        <content type="html"><![CDATA[<blockquote><p>æœ€è¿‘é¡¹ç›®ä¸­æœ‰ç”¨åˆ°rediså®ç°çš„åˆ†å¸ƒå¼é”, ä½†æ˜¯èƒ†ç å†™èµ·æ¥æ¯”è¾ƒç¹ç, å°±æƒ³ç€æ•´ä¸€å¥—æ³¨è§£çš„æ–¹å¼å®ç°çš„åˆ†å¸ƒå¼é”</p></blockquote><h3 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h3><p>åˆ†å¸ƒå¼é”ä¸€èˆ¬æœ‰ä¸‰ç§å®ç°æ–¹å¼ï¼š1. æ•°æ®åº“ä¹è§‚é”ï¼›2. åŸºäºRedisçš„åˆ†å¸ƒå¼é”ï¼›3. åŸºäºZooKeeperçš„åˆ†å¸ƒå¼é”ã€‚æœ¬æ–‡ä»‹ç»åŸºäºRediså®ç°åˆ†å¸ƒå¼é”ã€‚</p><h3 id="ä¸ºä»€ä¹ˆéœ€è¦åˆ†å¸ƒå¼é”"><a href="#ä¸ºä»€ä¹ˆéœ€è¦åˆ†å¸ƒå¼é”" class="headerlink" title="ä¸ºä»€ä¹ˆéœ€è¦åˆ†å¸ƒå¼é”"></a>ä¸ºä»€ä¹ˆéœ€è¦åˆ†å¸ƒå¼é”</h3><p>åœ¨å•æœºæ—¶ä»£ï¼Œè™½ç„¶ä¸éœ€è¦åˆ†å¸ƒå¼é”ï¼Œä½†ä¹Ÿé¢ä¸´è¿‡ç±»ä¼¼çš„é—®é¢˜ï¼Œåªä¸è¿‡åœ¨å•æœºçš„æƒ…å†µä¸‹ï¼Œå¦‚æœæœ‰å¤šä¸ªçº¿ç¨‹è¦åŒæ—¶è®¿é—®æŸä¸ªå…±äº«èµ„æºçš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥é‡‡ç”¨çº¿ç¨‹é—´åŠ é”çš„æœºåˆ¶ï¼Œå³å½“æŸä¸ªçº¿ç¨‹è·å–åˆ°è¿™ä¸ªèµ„æºåï¼Œå°±ç«‹å³å¯¹è¿™ä¸ªèµ„æºè¿›è¡ŒåŠ é”ï¼Œå½“ä½¿ç”¨å®Œèµ„æºä¹‹åï¼Œå†è§£é”ï¼Œå…¶å®ƒçº¿ç¨‹å°±å¯ä»¥æ¥ç€ä½¿ç”¨äº†ã€‚ä¾‹å¦‚ï¼Œåœ¨JAVAä¸­ï¼Œç”šè‡³ä¸“é—¨æä¾›äº†ä¸€äº›å¤„ç†é”æœºåˆ¶çš„ä¸€äº›APIï¼ˆsynchronize/Lockç­‰ï¼‰ã€‚</p><p>ä½†æ˜¯åˆ°äº†åˆ†å¸ƒå¼ç³»ç»Ÿçš„æ—¶ä»£ï¼Œè¿™ç§çº¿ç¨‹ä¹‹é—´çš„é”æœºåˆ¶ï¼Œå°±æ²¡ä½œç”¨äº†ï¼Œç³»ç»Ÿå¯èƒ½ä¼šæœ‰å¤šä»½å¹¶ä¸”éƒ¨ç½²åœ¨ä¸åŒçš„æœºå™¨ä¸Šï¼Œè¿™äº›èµ„æºå·²ç»ä¸æ˜¯åœ¨çº¿ç¨‹ä¹‹é—´å…±äº«äº†ï¼Œè€Œæ˜¯å±äºè¿›ç¨‹ä¹‹é—´å…±äº«çš„èµ„æºã€‚</p><p>å› æ­¤ï¼Œä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å°±å¿…é¡»å¼•å…¥ã€Œåˆ†å¸ƒå¼é”ã€ã€‚</p><p>åˆ†å¸ƒå¼é”ï¼Œæ˜¯æŒ‡åœ¨åˆ†å¸ƒå¼çš„éƒ¨ç½²ç¯å¢ƒä¸‹ï¼Œé€šè¿‡é”æœºåˆ¶æ¥è®©å¤šå®¢æˆ·ç«¯äº’æ–¥çš„å¯¹å…±äº«èµ„æºè¿›è¡Œè®¿é—®ã€‚</p><p>åˆ†å¸ƒå¼é”è¦æ»¡è¶³å“ªäº›è¦æ±‚å‘¢ï¼Ÿ</p><ul><li>æ’ä»–æ€§ï¼šåœ¨åŒä¸€æ—¶é—´åªä¼šæœ‰ä¸€ä¸ªå®¢æˆ·ç«¯èƒ½è·å–åˆ°é”ï¼Œå…¶å®ƒå®¢æˆ·ç«¯æ— æ³•åŒæ—¶è·å–</li><li>é¿å…æ­»é”ï¼šè¿™æŠŠé”åœ¨ä¸€æ®µæœ‰é™çš„æ—¶é—´ä¹‹åï¼Œä¸€å®šä¼šè¢«é‡Šæ”¾ï¼ˆæ­£å¸¸é‡Šæ”¾æˆ–å¼‚å¸¸é‡Šæ”¾ï¼‰</li><li>é«˜å¯ç”¨ï¼šè·å–æˆ–é‡Šæ”¾é”çš„æœºåˆ¶å¿…é¡»é«˜å¯ç”¨ä¸”æ€§èƒ½ä½³</li></ul><h3 id="å¯é æ€§-From"><a href="#å¯é æ€§-From" class="headerlink" title="å¯é æ€§(From)"></a>å¯é æ€§(<a href="http://www.importnew.com/27477.html">From</a>)</h3><p>é¦–å…ˆï¼Œä¸ºäº†ç¡®ä¿åˆ†å¸ƒå¼é”å¯ç”¨ï¼Œæˆ‘ä»¬è‡³å°‘è¦ç¡®ä¿é”çš„å®ç°åŒæ—¶æ»¡è¶³ä»¥ä¸‹å››ä¸ªæ¡ä»¶ï¼š</p><ol><li>äº’æ–¥æ€§ã€‚åœ¨ä»»æ„æ—¶åˆ»ï¼Œåªæœ‰ä¸€ä¸ªå®¢æˆ·ç«¯èƒ½æŒæœ‰é”ã€‚</li><li>ä¸ä¼šå‘ç”Ÿæ­»é”ã€‚å³ä½¿æœ‰ä¸€ä¸ªå®¢æˆ·ç«¯åœ¨æŒæœ‰é”çš„æœŸé—´å´©æºƒè€Œæ²¡æœ‰ä¸»åŠ¨è§£é”ï¼Œä¹Ÿèƒ½ä¿è¯åç»­å…¶ä»–å®¢æˆ·ç«¯èƒ½åŠ é”ã€‚</li><li>å…·æœ‰å®¹é”™æ€§ã€‚åªè¦å¤§éƒ¨åˆ†çš„RedisèŠ‚ç‚¹æ­£å¸¸è¿è¡Œï¼Œå®¢æˆ·ç«¯å°±å¯ä»¥åŠ é”å’Œè§£é”ã€‚</li><li>è§£é“ƒè¿˜é¡»ç³»é“ƒäººã€‚åŠ é”å’Œè§£é”å¿…é¡»æ˜¯åŒä¸€ä¸ªå®¢æˆ·ç«¯ï¼Œå®¢æˆ·ç«¯è‡ªå·±ä¸èƒ½æŠŠåˆ«äººåŠ çš„é”ç»™è§£äº†</li></ol><h3 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h3><p>åŸºäº<code>Redis</code>å®ç°çš„é”æœºåˆ¶ï¼Œä¸»è¦æ˜¯ä¾èµ–<code>Redis</code>è‡ªèº«çš„åŸå­æ“ä½œï¼Œä¾‹å¦‚ï¼š</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">SET user_key user_value NX PX 100</span><br></pre></td></tr></table></figure><p>redisä»2.6.12ç‰ˆæœ¬å¼€å§‹ï¼ŒSETå‘½ä»¤æ‰æ”¯æŒè¿™äº›å‚æ•°ï¼š<br><strong>NX</strong>ï¼šåªåœ¨åœ¨é”®ä¸å­˜åœ¨æ—¶ï¼Œæ‰å¯¹é”®è¿›è¡Œè®¾ç½®æ“ä½œï¼ŒSET key value NX æ•ˆæœç­‰åŒäº SETNX key value<br><strong>PX millisecond</strong>ï¼šè®¾ç½®é”®çš„è¿‡æœŸæ—¶é—´ä¸ºmillisecondæ¯«ç§’ï¼Œå½“è¶…è¿‡è¿™ä¸ªæ—¶é—´åï¼Œè®¾ç½®çš„é”®ä¼šè‡ªåŠ¨å¤±æ•ˆ</p><p>ä¸Šè¿°ä»£ç ç¤ºä¾‹æ˜¯æŒ‡ï¼Œ<br>å½“<code>redis</code>ä¸­ä¸å­˜åœ¨<code>user_key</code>è¿™ä¸ªé”®çš„æ—¶å€™ï¼Œæ‰ä¼šå»è®¾ç½®ä¸€ä¸ª<code>user_key</code>é”®ï¼Œå¹¶ä¸”ç»™è¿™ä¸ªé”®çš„å€¼è®¾ç½®ä¸º <code>user_value</code>ï¼Œä¸”è¿™ä¸ªé”®çš„å­˜æ´»æ—¶é—´ä¸º<code>100ms</code></p><p><strong>ä¸ºä»€ä¹ˆè¿™ä¸ªå‘½ä»¤å¯ä»¥å¸®æˆ‘ä»¬å®ç°é”æœºåˆ¶å‘¢ï¼Ÿ</strong><br>å› ä¸ºè¿™ä¸ªå‘½ä»¤æ˜¯åªæœ‰åœ¨æŸä¸ªkeyä¸å­˜åœ¨çš„æ—¶å€™ï¼Œæ‰ä¼šæ‰§è¡ŒæˆåŠŸã€‚é‚£ä¹ˆå½“å¤šä¸ªè¿›ç¨‹åŒæ—¶å¹¶å‘çš„å»è®¾ç½®åŒä¸€ä¸ªkeyçš„æ—¶å€™ï¼Œå°±æ°¸è¿œåªä¼šæœ‰ä¸€ä¸ªè¿›ç¨‹æˆåŠŸã€‚<br>å½“æŸä¸ªè¿›ç¨‹è®¾ç½®æˆåŠŸä¹‹åï¼Œå°±å¯ä»¥å»æ‰§è¡Œä¸šåŠ¡é€»è¾‘äº†ï¼Œç­‰ä¸šåŠ¡é€»è¾‘æ‰§è¡Œå®Œæ¯•ä¹‹åï¼Œå†å»è¿›è¡Œè§£é”ã€‚</p><p>è§£é”å¾ˆç®€å•ï¼Œåªéœ€è¦åˆ é™¤è¿™ä¸ª<code>key</code>å°±å¯ä»¥äº†ï¼Œä¸è¿‡åˆ é™¤ä¹‹å‰éœ€è¦åˆ¤æ–­ï¼Œè¿™ä¸ª<code>key</code>å¯¹åº”çš„<code>value</code>æ˜¯å½“åˆè‡ªå·±è®¾ç½®çš„é‚£ä¸ªã€‚</p><p>å¦å¤–ï¼Œé’ˆå¯¹redisé›†ç¾¤æ¨¡å¼çš„åˆ†å¸ƒå¼é”ï¼Œå¯ä»¥é‡‡ç”¨redisçš„<code>Redlock</code>æœºåˆ¶ã€‚</p><h3 id="å®ç°"><a href="#å®ç°" class="headerlink" title="å®ç°"></a>å®ç°</h3><h4 id="åˆ›å»ºä¸€ä¸ªSpringBootå·¥ç¨‹"><a href="#åˆ›å»ºä¸€ä¸ªSpringBootå·¥ç¨‹" class="headerlink" title="åˆ›å»ºä¸€ä¸ªSpringBootå·¥ç¨‹"></a>åˆ›å»ºä¸€ä¸ªSpringBootå·¥ç¨‹</h4><p>ä¿®æ”¹<code>pom.xml</code>æ–‡ä»¶, æ·»åŠ å¦‚ä¸‹ä¾èµ–åŒ…:</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-logging<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-log4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.3.8.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-cache<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.4.7.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-aop<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="å®šä¹‰ä¸€ä¸ªæ³¨è§£ç±»"><a href="#å®šä¹‰ä¸€ä¸ªæ³¨è§£ç±»" class="headerlink" title="å®šä¹‰ä¸€ä¸ªæ³¨è§£ç±»"></a>å®šä¹‰ä¸€ä¸ªæ³¨è§£ç±»</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Target(&#123;ElementType.METHOD&#125;)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Inherited</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> DistributeLock &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * é”çš„èµ„æºï¼Œkeyã€‚</span></span><br><span class="line"><span class="comment">     *  æ”¯æŒspring Elè¡¨è¾¾å¼</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@AliasFor(&quot;name&quot;)</span></span><br><span class="line">    <span class="function">String <span class="title">name</span><span class="params">()</span> <span class="keyword">default</span> &quot;&#x27;<span class="keyword">default</span>&#x27;&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * é”çš„èµ„æºï¼Œvalueã€‚</span></span><br><span class="line"><span class="comment">     *  æ”¯æŒspring Elè¡¨è¾¾å¼</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@AliasFor(&quot;value&quot;)</span></span><br><span class="line">    <span class="function">String <span class="title">value</span><span class="params">()</span> <span class="keyword">default</span> &quot;&#x27;<span class="keyword">default</span>&#x27;&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æŒé”æ—¶é—´,å•ä½æ¯«ç§’</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">long</span> <span class="title">keepMills</span><span class="params">()</span> <span class="keyword">default</span> 5000</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å½“è·å–å¤±è´¥æ—¶å€™åŠ¨ä½œ</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">LockFailAction <span class="title">action</span><span class="params">()</span> <span class="keyword">default</span> LockFailAction.CONTINUE</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="class"><span class="keyword">enum</span> <span class="title">LockFailAction</span></span>&#123;</span><br><span class="line">        <span class="comment">/** æ”¾å¼ƒ */</span></span><br><span class="line">        GIVEUP,</span><br><span class="line">        <span class="comment">/** ç»§ç»­ */</span></span><br><span class="line">        CONTINUE;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * é‡è¯•çš„é—´éš”æ—¶é—´,è®¾ç½®GIVEUPå¿½ç•¥æ­¤é¡¹</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">long</span> <span class="title">sleepMills</span><span class="params">()</span> <span class="keyword">default</span> 200</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * é‡è¯•æ¬¡æ•°</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">retryTimes</span><span class="params">()</span> <span class="keyword">default</span> 5</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="å®šä¹‰æ¥å£"><a href="#å®šä¹‰æ¥å£" class="headerlink" title="å®šä¹‰æ¥å£"></a>å®šä¹‰æ¥å£</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">IDistributedLock</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> TIMEOUT_MILLIS = <span class="number">5000</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> RETRY_TIMES = Integer.MAX_VALUE;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> SLEEP_MILLIS = <span class="number">500</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">lock</span><span class="params">(String key)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">lock</span><span class="params">(String key, <span class="keyword">int</span> retryTimes)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">lock</span><span class="params">(String key, <span class="keyword">int</span> retryTimes, <span class="keyword">long</span> sleepMillis)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">lock</span><span class="params">(String key, <span class="keyword">long</span> expire)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">lock</span><span class="params">(String key, <span class="keyword">long</span> expire, <span class="keyword">int</span> retryTimes)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">lock</span><span class="params">(String key, <span class="keyword">long</span> expire, <span class="keyword">int</span> retryTimes, <span class="keyword">long</span> sleepMillis)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">releaseLock</span><span class="params">(String key)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="å®šä¹‰æŠ½è±¡ç±»"><a href="#å®šä¹‰æŠ½è±¡ç±»" class="headerlink" title="å®šä¹‰æŠ½è±¡ç±»"></a>å®šä¹‰æŠ½è±¡ç±»</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">AbstractDistributedLockImpl</span> <span class="keyword">implements</span> <span class="title">IDistributedLock</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">lock</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> lock(key, TIMEOUT_MILLIS, RETRY_TIMES, SLEEP_MILLIS);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">lock</span><span class="params">(String key, <span class="keyword">int</span> retryTimes)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> lock(key, TIMEOUT_MILLIS, retryTimes, SLEEP_MILLIS);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">lock</span><span class="params">(String key, <span class="keyword">int</span> retryTimes, <span class="keyword">long</span> sleepMillis)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> lock(key, TIMEOUT_MILLIS, retryTimes, sleepMillis);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">lock</span><span class="params">(String key, <span class="keyword">long</span> expire)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> lock(key, expire, RETRY_TIMES, SLEEP_MILLIS);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">lock</span><span class="params">(String key, <span class="keyword">long</span> expire, <span class="keyword">int</span> retryTimes)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> lock(key, expire, retryTimes, SLEEP_MILLIS);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="å®šä¹‰Redisåˆ†å¸ƒå¼é”å®ç°ç±»"><a href="#å®šä¹‰Redisåˆ†å¸ƒå¼é”å®ç°ç±»" class="headerlink" title="å®šä¹‰Redisåˆ†å¸ƒå¼é”å®ç°ç±»"></a>å®šä¹‰Redisåˆ†å¸ƒå¼é”å®ç°ç±»</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RedisDistributedLock</span> <span class="keyword">extends</span> <span class="title">AbstractDistributedLockImpl</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Logger logger = getLogger(RedisDistributedLock.class);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> RedisTemplate&lt;Object, Object&gt; redisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> ThreadLocal&lt;String&gt; lockFlag = <span class="keyword">new</span> ThreadLocal&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String UNLOCK_LUA;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String SET_IF_NOT_EXIST = <span class="string">&quot;NX&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String SET_WITH_EXPIRE_TIME = <span class="string">&quot;PX&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        UNLOCK_LUA = <span class="string">&quot;if redis.call(&#x27;get&#x27;, KEYS[1]) == ARGV[1] then return redis.call(&#x27;del&#x27;, KEYS[1]) else return 0 end&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">RedisDistributedLock</span><span class="params">(RedisTemplate&lt;Object, Object&gt; redisTemplate)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>();</span><br><span class="line">        <span class="keyword">this</span>.redisTemplate = redisTemplate;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">lock</span><span class="params">(String key, <span class="keyword">long</span> expire, <span class="keyword">int</span> retryTimes, <span class="keyword">long</span> sleepMillis)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">boolean</span> result = setRedis(key, expire);</span><br><span class="line">        <span class="comment">// å¦‚æœè·å–é”å¤±è´¥ï¼ŒæŒ‰ç…§ä¼ å…¥çš„é‡è¯•æ¬¡æ•°è¿›è¡Œé‡è¯•</span></span><br><span class="line">        <span class="keyword">while</span>((!result) &amp;&amp; retryTimes-- &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                logger.debug(<span class="string">&quot;lock failed, retrying...&quot;</span> + retryTimes);</span><br><span class="line">                Thread.sleep(sleepMillis);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            result = setRedis(key, expire);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">releaseLock</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// é‡Šæ”¾é”çš„æ—¶å€™ï¼Œæœ‰å¯èƒ½å› ä¸ºæŒé”ä¹‹åæ–¹æ³•æ‰§è¡Œæ—¶é—´å¤§äºé”çš„æœ‰æ•ˆæœŸï¼Œæ­¤æ—¶æœ‰å¯èƒ½å·²ç»è¢«å¦å¤–ä¸€ä¸ªçº¿ç¨‹æŒæœ‰é”ï¼Œæ‰€ä»¥ä¸èƒ½ç›´æ¥åˆ é™¤</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            List&lt;String&gt; keys = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">            keys.add(key);</span><br><span class="line">            List&lt;String&gt; args = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">            args.add(lockFlag.get());</span><br><span class="line"></span><br><span class="line">            <span class="comment">// ä½¿ç”¨luaè„šæœ¬åˆ é™¤redisä¸­åŒ¹é…valueçš„keyï¼Œå¯ä»¥é¿å…ç”±äºæ–¹æ³•æ‰§è¡Œæ—¶é—´è¿‡é•¿è€Œredisé”è‡ªåŠ¨è¿‡æœŸå¤±æ•ˆçš„æ—¶å€™è¯¯åˆ å…¶ä»–çº¿ç¨‹çš„é”</span></span><br><span class="line">            <span class="comment">// springè‡ªå¸¦çš„æ‰§è¡Œè„šæœ¬æ–¹æ³•ä¸­ï¼Œé›†ç¾¤æ¨¡å¼ç›´æ¥æŠ›å‡ºä¸æ”¯æŒæ‰§è¡Œè„šæœ¬çš„å¼‚å¸¸ï¼Œæ‰€ä»¥åªèƒ½æ‹¿åˆ°åŸredisçš„connectionæ¥æ‰§è¡Œè„šæœ¬</span></span><br><span class="line"></span><br><span class="line">            Long result = redisTemplate.execute((RedisCallback&lt;Long&gt;) redisConnection -&gt; &#123;</span><br><span class="line">                Object nativeConnection = redisConnection.getNativeConnection();</span><br><span class="line">                <span class="comment">// é›†ç¾¤æ¨¡å¼å’Œå•æœºæ¨¡å¼è™½ç„¶æ‰§è¡Œè„šæœ¬çš„æ–¹æ³•ä¸€æ ·ï¼Œä½†æ˜¯æ²¡æœ‰å…±åŒçš„æ¥å£ï¼Œæ‰€ä»¥åªèƒ½åˆ†å¼€æ‰§è¡Œ</span></span><br><span class="line">                <span class="comment">// é›†ç¾¤æ¨¡å¼</span></span><br><span class="line">                <span class="keyword">if</span> (nativeConnection <span class="keyword">instanceof</span> JedisCluster) &#123;</span><br><span class="line">                    <span class="keyword">return</span> (Long) ((JedisCluster) nativeConnection).eval(UNLOCK_LUA, keys, args);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// å•æœºæ¨¡å¼</span></span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> (nativeConnection <span class="keyword">instanceof</span> Jedis) &#123;</span><br><span class="line">                    <span class="keyword">return</span> (Long) ((Jedis) nativeConnection).eval(UNLOCK_LUA, keys, args);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> <span class="number">0L</span>;</span><br><span class="line">            &#125;);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> result != <span class="keyword">null</span> &amp;&amp; result &gt; <span class="number">0</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            logger.error(<span class="string">&quot;release lock occured an exception&quot;</span>, e);</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="comment">// æ¸…é™¤æ‰ThreadLocalä¸­çš„æ•°æ®ï¼Œé¿å…å†…å­˜æº¢å‡º</span></span><br><span class="line">            lockFlag.remove();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">setRedis</span><span class="params">(String key, <span class="keyword">long</span> expire)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            String result = redisTemplate.execute((RedisCallback&lt;String&gt;) redisConnection -&gt; &#123;</span><br><span class="line">                JedisCommands commands = (JedisCommands) redisConnection.getNativeConnection();</span><br><span class="line">                String uuid = UUID.randomUUID().toString();</span><br><span class="line">                lockFlag.set(uuid);</span><br><span class="line">                <span class="keyword">return</span> commands.set(key, uuid, SET_IF_NOT_EXIST, SET_WITH_EXPIRE_TIME, expire);</span><br><span class="line">            &#125;);</span><br><span class="line">            <span class="keyword">return</span> !StringUtils.isEmpty(result);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            logger.error(<span class="string">&quot;set redis occured an exception&quot;</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="è£…é…DistributeLock"><a href="#è£…é…DistributeLock" class="headerlink" title="è£…é…DistributeLock"></a>è£…é…DistributeLock</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@AutoConfigureAfter(RedisAutoConfiguration.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DistributedLockAutoConfiguration</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@ConditionalOnBean(RedisTemplate.class)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> IDistributedLock <span class="title">redisDistributedLock</span><span class="params">(RedisTemplate&lt;Object, Object&gt; redisTemplate)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> RedisDistributedLock(redisTemplate);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="å®šä¹‰åˆ‡é¢"><a href="#å®šä¹‰åˆ‡é¢" class="headerlink" title="å®šä¹‰åˆ‡é¢"></a>å®šä¹‰åˆ‡é¢</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ConditionalOnClass(IDistributedLock.class)</span></span><br><span class="line"><span class="meta">@AutoConfigureAfter(DistributedLockAutoConfiguration.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DistributedLockAspectConfiguration</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Logger logger = getLogger(DistributedLockAspectConfiguration.class);</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> IDistributedLock distributedLock;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> ExpressionParser parser = <span class="keyword">new</span> SpelExpressionParser();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> LocalVariableTableParameterNameDiscoverer discoverer = <span class="keyword">new</span> LocalVariableTableParameterNameDiscoverer();</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å®šä¹‰åˆ‡å…¥ç‚¹</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Pointcut(&quot;@annotation(com.cayzlh.distributedlock.annotations.DistributeLock)&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">lockPoint</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç¯ç»•é€šçŸ¥</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> pjp pjp</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span>  æ–¹æ³•è¿”å›ç»“æœ</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Throwable throwable</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Around(&quot;lockPoint()&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">around</span><span class="params">(ProceedingJoinPoint pjp)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">        Method method = ((MethodSignature) pjp.getSignature()).getMethod();</span><br><span class="line">        DistributeLock lockAction = method.getAnnotation(DistributeLock.class);</span><br><span class="line">        String logKey = getLogKey(lockAction, pjp, method);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> retryTimes = lockAction.action().equals(DistributeLock.LockFailAction.CONTINUE) ? lockAction.retryTimes() : <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">boolean</span> lock = distributedLock.lock(logKey, lockAction.keepMills(), retryTimes, lockAction.sleepMills());</span><br><span class="line">        <span class="keyword">if</span> (!lock) &#123;</span><br><span class="line">            logger.debug(<span class="string">&quot;get lock failed : &quot;</span> + logKey);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//å¾—åˆ°é”,æ‰§è¡Œæ–¹æ³•ï¼Œé‡Šæ”¾é”</span></span><br><span class="line">        logger.debug(<span class="string">&quot;get lock success : &quot;</span> + logKey);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> pjp.proceed();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            logger.error(<span class="string">&quot;execute locked method occured an exception&quot;</span>, e);</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="keyword">boolean</span> releaseResult = distributedLock.releaseLock(logKey);</span><br><span class="line">            logger.debug(<span class="string">&quot;release lock : &quot;</span> + logKey + (releaseResult ? <span class="string">&quot; success&quot;</span> : <span class="string">&quot; failed&quot;</span>));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å¾—åˆ†å¸ƒå¼ç¼“å­˜çš„key</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> lockAction æ³¨è§£å¯¹è±¡</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> pjp        pjp</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> method     method</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> String</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> String <span class="title">getLogKey</span><span class="params">(DistributeLock lockAction, ProceedingJoinPoint pjp, Method method)</span> </span>&#123;</span><br><span class="line">        String name = lockAction.name();</span><br><span class="line">        String value = lockAction.value();</span><br><span class="line">        Object[] args = pjp.getArgs();</span><br><span class="line">        <span class="keyword">return</span> parse(name, method, args) + <span class="string">&quot;_&quot;</span> + parse(value, method, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è§£æspring ELè¡¨è¾¾å¼</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key    key</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> method method</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> args   args</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> parse result</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> String <span class="title">parse</span><span class="params">(String key, Method method, Object[] args)</span> </span>&#123;</span><br><span class="line">        String[] params = discoverer.getParameterNames(method);</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">null</span> == params || params.length == <span class="number">0</span> || !key.contains(<span class="string">&quot;#&quot;</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> key;</span><br><span class="line">        &#125;</span><br><span class="line">        EvaluationContext context = <span class="keyword">new</span> StandardEvaluationContext();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; params.length; i++) &#123;</span><br><span class="line">            context.setVariable(params[i], args[i]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> parser.parseExpression(key).getValue(context, String.class);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="é…ç½®æ–‡ä»¶"><a href="#é…ç½®æ–‡ä»¶" class="headerlink" title="é…ç½®æ–‡ä»¶"></a>é…ç½®æ–‡ä»¶</h4><figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="meta">server.port</span>=<span class="string">8080</span></span><br><span class="line"></span><br><span class="line"><span class="meta">spring.redis.host</span>=<span class="string">127.0.0.1</span></span><br><span class="line"><span class="meta">spring.redis.port</span>=<span class="string">6379</span></span><br><span class="line"><span class="meta">spring.redis.jedis.pool.max-idle</span>=<span class="string">8</span></span><br><span class="line"><span class="meta">spring.redis.jedis.pool.min-idle</span>=<span class="string">0</span></span><br><span class="line"><span class="meta">spring.redis.jedis.pool.max-active</span>=<span class="string">8</span></span><br><span class="line"><span class="meta">spring.redis.jedis.pool.max-wait</span>=<span class="string">-1ms</span></span><br><span class="line"><span class="meta">spring.redis.timeout</span>=<span class="string">20ms</span></span><br><span class="line"><span class="meta">spring.redis.password</span>=<span class="string"></span></span><br></pre></td></tr></table></figure><h4 id="é…ç½®log4jé…ç½®æ–‡ä»¶"><a href="#é…ç½®log4jé…ç½®æ–‡ä»¶" class="headerlink" title="é…ç½®log4jé…ç½®æ–‡ä»¶"></a>é…ç½®log4jé…ç½®æ–‡ä»¶</h4><figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="comment"># serveré»˜è®¤ä¸ºç©º</span></span><br><span class="line"><span class="attr">server</span>=<span class="string"></span></span><br><span class="line"><span class="comment"># æ—¥å¿—è¾“å‡ºç›®å½•</span></span><br><span class="line"><span class="attr">logFilePath</span>=<span class="string">logs</span></span><br><span class="line"><span class="meta">log4j.rootCategory</span>=<span class="string">DEBUG,stdout,debugLog,infoLog,errorLog</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ§åˆ¶å°æ—¥å¿—è¾“å‡º</span></span><br><span class="line"><span class="meta">log4j.logger.consoleLogger</span>=<span class="string">stdout</span></span><br><span class="line"></span><br><span class="line"><span class="meta">log4j.appender.stdout</span>=<span class="string">org.apache.log4j.ConsoleAppender</span></span><br><span class="line"><span class="meta">log4j.appender.stdout.Threshold</span>=<span class="string">DEBUG</span></span><br><span class="line"><span class="meta">log4j.appender.stdout.layout</span>=<span class="string">org.apache.log4j.PatternLayout</span></span><br><span class="line"><span class="meta">log4j.appender.stdout.layout.ConversionPattern</span>=<span class="string">[%p] %d %c - %m%n</span></span><br><span class="line"><span class="meta">log4j.appender.stdout.ImmediateFlush</span>=<span class="string">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># debugæ—¥å¿—è¾“å‡º</span></span><br><span class="line"><span class="meta">log4j.logger.debugLog</span>=<span class="string">DEBUG, debugLog</span></span><br><span class="line"></span><br><span class="line"><span class="meta">log4j.appender.debugLog</span>=<span class="string">org.apache.log4j.DailyRollingFileAppender</span></span><br><span class="line"><span class="meta">log4j.appender.debugLog.File</span>=<span class="string">$&#123;logFilePath&#125;/debug.log</span></span><br><span class="line"><span class="meta">log4j.appender.debugLog.layout</span>=<span class="string">org.apache.log4j.PatternLayout</span></span><br><span class="line"><span class="meta">log4j.appender.debugLog.layout.ConversionPattern</span>=<span class="string">%d&#123;yyyy-MM-dd HH:mm:ss,SSS&#125; %5p %c&#123;1&#125;:%L - %m%n</span></span><br><span class="line"><span class="meta">log4j.appender.debugLog.DatePattern</span>=<span class="string">&#x27;.&#x27;yyyy-MM-dd</span></span><br><span class="line"><span class="meta">log4j.appender.debugLog.ImmediateFlush</span>=<span class="string">true</span></span><br><span class="line"><span class="meta">log4j.appender.debugLog.Threshold</span>=<span class="string">DEBUG</span></span><br><span class="line"><span class="meta">log4j.appender.debugLog.encoding</span>=<span class="string">UTF-8</span></span><br><span class="line"><span class="meta">log4j.appender.debugLog.filter.debugFilter</span>=<span class="string">org.apache.log4j.varia.LevelRangeFilter</span></span><br><span class="line"><span class="meta">log4j.appender.debugLog.filter.debugFilter.LevelMin</span>=<span class="string">DEBUG</span></span><br><span class="line"><span class="meta">log4j.appender.debugLog.filter.debugFilter.LevelMax</span>=<span class="string">DEBUG</span></span><br></pre></td></tr></table></figure><h3 id="å®Œ"><a href="#å®Œ" class="headerlink" title="å®Œ"></a>å®Œ</h3><p>æºç <a href="https://github.com/cayzlh/springboot-distributedlock-demo">åœ¨è¿™</a>.</p>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹æŠ€æœ¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> Redis </tag>
            
            <tag> SpringBoot </tag>
            
            <tag> åˆ†å¸ƒå¼é” </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SpringBootå°è£…JedisUtilså·¥å…·ç±»</title>
      <link href="post/3717925105/"/>
      <url>post/3717925105/</url>
      
        <content type="html"><![CDATA[<blockquote><p>SpringBootå·²ç»å®ç°äº†å¾ˆå¤šå®ç”¨çš„ç¼“å­˜ç»„ä»¶;ä½†æ˜¯ç”±äºå·¥ä½œä¸­ä¹ æƒ¯äº†è¯•ç”¨JedisUtilså·¥å…·ç±»æ¥è¿›è¡Œç¼“å­˜æ“ä½œ, è¿™é‡Œè®°å½•ä¸€ä¸‹SpringBootä¸­å¯¹äºJedisUtilsçš„å°è£…</p></blockquote><h3 id="æ“ä½œ"><a href="#æ“ä½œ" class="headerlink" title="æ“ä½œ"></a>æ“ä½œ</h3><h4 id="æ–°å»ºä¸€ä¸ªSpringBooté¡¹ç›®"><a href="#æ–°å»ºä¸€ä¸ªSpringBooté¡¹ç›®" class="headerlink" title="æ–°å»ºä¸€ä¸ªSpringBooté¡¹ç›®"></a>æ–°å»ºä¸€ä¸ªSpringBooté¡¹ç›®</h4><p>ä¿®æ”¹<code>pom.xml</code>å¢åŠ :</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-cache<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.4.7.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="æ–°å»ºJedisConfiguration-javaç”¨äºé…ç½®JedisPool-Bean"><a href="#æ–°å»ºJedisConfiguration-javaç”¨äºé…ç½®JedisPool-Bean" class="headerlink" title="æ–°å»ºJedisConfiguration.javaç”¨äºé…ç½®JedisPool Bean"></a>æ–°å»ºJedisConfiguration.javaç”¨äºé…ç½®JedisPool Bean</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Value;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cache.annotation.EnableCaching;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> redis.clients.jedis.JedisPool;</span><br><span class="line"><span class="keyword">import</span> redis.clients.jedis.JedisPoolConfig;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableCaching</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JedisConfiguration</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;spring.redis.host&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String host;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;spring.redis.port&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> port;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;spring.redis.timeout&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String timeouts;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;spring.redis.jedis.pool.min-idle&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> maxIdle;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;spring.redis.jedis.pool.max-wait&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String maxWaitMilliss;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;spring.redis.password&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean(name = &quot;jedisPool&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> JedisPool <span class="title">redisPoolFactory</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        JedisPoolConfig jedisPoolConfig = <span class="keyword">new</span> JedisPoolConfig();</span><br><span class="line">        jedisPoolConfig.setMaxIdle(maxIdle);</span><br><span class="line">        <span class="keyword">long</span> maxWaitMillis = Long.parseLong(maxWaitMilliss.replace(<span class="string">&quot;ms&quot;</span>, <span class="string">&quot;&quot;</span>));</span><br><span class="line">        jedisPoolConfig.setMaxWaitMillis(maxWaitMillis);</span><br><span class="line">        <span class="keyword">int</span> timeout = Integer.parseInt(timeouts.replace(<span class="string">&quot;ms&quot;</span>, <span class="string">&quot;&quot;</span>));</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> JedisPool(jedisPoolConfig, host, port, timeout);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="åˆ›å»ºJedisUtils-java"><a href="#åˆ›å»ºJedisUtils-java" class="headerlink" title="åˆ›å»ºJedisUtils.java"></a>åˆ›å»ºJedisUtils.java</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.log4j.Logger;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.BeansException;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.ApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.ApplicationContextAware;</span><br><span class="line"><span class="keyword">import</span> redis.clients.jedis.Jedis;</span><br><span class="line"><span class="keyword">import</span> redis.clients.jedis.JedisPool;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JedisUtils</span> <span class="keyword">implements</span> <span class="title">ApplicationContextAware</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> ApplicationContext applicationContext = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> JedisPool jedisPool = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">volatile</span> Jedis jedis = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Logger logger = Logger.getLogger(<span class="string">&quot;JedisUtils&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">JedisUtils</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setApplicationContext</span><span class="params">(ApplicationContext applicationContext)</span> <span class="keyword">throws</span> BeansException </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (JedisUtils.applicationContext == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="comment">//åˆå§‹åŒ– spring applicationContext</span></span><br><span class="line">            JedisUtils.applicationContext = applicationContext;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Jedis <span class="title">getJedis</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (jedis == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (Jedis.class) &#123;</span><br><span class="line">                <span class="keyword">if</span> (jedis == <span class="keyword">null</span>) &#123;</span><br><span class="line">                    jedis = getJedisPool().getResource();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> jedis;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> JedisPool <span class="title">getJedisPool</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (jedisPool == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (JedisPool.class) &#123;</span><br><span class="line">                <span class="keyword">if</span> (jedisPool == <span class="keyword">null</span>) &#123;</span><br><span class="line">                    jedisPool = applicationContext.getBean(<span class="string">&quot;jedisPool&quot;</span>, JedisPool.class);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> jedisPool;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ ¹æ®keyæŸ¥çœ‹æ˜¯å¦å­˜åœ¨</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">hasKey</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> getJedis().exists(key);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è®¾ç½®key -value å½¢å¼æ•°æ®</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">set</span><span class="params">(String key, String value)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">boolean</span> result = <span class="keyword">false</span>;</span><br><span class="line">        Jedis jedis = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            jedis = getJedis();</span><br><span class="line">            result = <span class="string">&quot;OK&quot;</span>.equals(jedis.set(key, value));</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            closeBrokenJedis(jedis);</span><br><span class="line">            logger.error(<span class="string">&quot;JedisCache.set falid&quot;</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è®¾ç½® ä¸€ä¸ªè¿‡æœŸæ—¶é—´</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key key</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value value</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> timeOut å•ä½ç§’</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">set</span><span class="params">(String key, String value, <span class="keyword">int</span> timeOut)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">boolean</span> result = <span class="keyword">false</span>;</span><br><span class="line">        Jedis jedis = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            jedis = getJedis();</span><br><span class="line">            result = <span class="string">&quot;OK&quot;</span>.equals(jedis.setex(key, timeOut, value));</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            closeBrokenJedis(jedis);</span><br><span class="line">            logger.error(<span class="string">&quot;JedisCache.set falid&quot;</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ ¹æ®keyè·å–value</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">get</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line">        String result = <span class="keyword">null</span>;</span><br><span class="line">        Jedis jedis = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            jedis = getJedis();</span><br><span class="line">            result = jedis.get(key);</span><br><span class="line">            closeJedis(jedis);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            closeBrokenJedis(jedis);</span><br><span class="line">            logger.error(<span class="string">&quot;JedisCache.get falid&quot;</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ ¹æ®keyåˆ é™¤</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">del</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line">        getJedis().del(key);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…¶ä¸­çš„<code>getJedisPool()</code>å¯ä»¥ä»beanè·å–<code>JedisPool</code>å¯¹è±¡, ç”¨äºåç»­çš„æ“ä½œ, ä¸Šé¢ç»™å‡ºäº†éƒ¨åˆ†ä»£ç , <a href="https://gist.github.com/cayzlh/98eafbb5ed71966e2ac603b55c479f3a">å®Œæ•´ç‰ˆ</a>åœ¨è¿™.</p><h4 id="åœ¨springbootçš„ä¸»ç±»ä¸Šæ·»åŠ æ³¨è§£"><a href="#åœ¨springbootçš„ä¸»ç±»ä¸Šæ·»åŠ æ³¨è§£" class="headerlink" title="åœ¨springbootçš„ä¸»ç±»ä¸Šæ·»åŠ æ³¨è§£"></a>åœ¨springbootçš„ä¸»ç±»ä¸Šæ·»åŠ æ³¨è§£</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableCaching</span></span><br><span class="line"><span class="meta">@Import(&#123;JedisUtils.class, JedisPool.class&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DemoApplication</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(DemoApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ç»“æŸ"><a href="#ç»“æŸ" class="headerlink" title="ç»“æŸ"></a>ç»“æŸ</h3><p>è‡³æ­¤, å°±å¯ä»¥æ„‰å¿«çš„ä½¿ç”¨JedisUtilsç›´æ¥æ“ä½œRedisç¼“å­˜äº†.</p>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹æŠ€æœ¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> Spring </tag>
            
            <tag> SpringBoot </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Tomcatå•æœºå¤šå®ä¾‹éƒ¨ç½²</title>
      <link href="post/1347652223/"/>
      <url>post/1347652223/</url>
      
        <content type="html"><![CDATA[<h3 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h3><blockquote><p>å•æœºå¤šå®ä¾‹éƒ¨ç½²tomcat, å¯ä»¥å……åˆ†åˆ©ç”¨ç³»ç»Ÿèµ„æº, å‘¨æœŸæ€§åœ°æ›´æ–°Tomcatï¼Œä½¿ç”¨æœ€æ–°ç‰ˆçš„Tomcat, ç»Ÿä¸€ç®¡ç†ï¼Œè®©Tomcatç‰ˆæœ¬ç»Ÿä¸€, å®ä¾‹çš„é…ç½®ç»Ÿä¸€.</p></blockquote><p>æœ¬æ–‡ä»‹ç»Linuxä¸‹Tomcatå•æœºå¤šå®ä¾‹çš„éƒ¨ç½²æ­¥éª¤.</p><h3 id="å®ç°å››è·¯"><a href="#å®ç°å››è·¯" class="headerlink" title="å®ç°å››è·¯"></a>å®ç°å››è·¯</h3><p>1ã€Tomcatè¿è¡Œæ—¶ï¼Œç³»ç»Ÿä¼šä»confåŠwebappsç›®å½•ä¸­è¯»å–é…ç½®æ–‡ä»¶ï¼Œå¹¶ä¸”å†™å…¥logsã€tempå’Œworkç›®å½•ä¸­<br>2ã€ä¸€äº›jaræ–‡ä»¶å’Œclassæ–‡ä»¶éœ€è¦ä»å…¬å…±ç›®å½•ä¾‹å¦‚lib/ä¸­åŠ è½½ï¼Œåªéœ€è¦åŠ è½½ä¸€æ¬¡å°±å¯ä»¥ã€‚<br>3ã€ä¸ºäº†å¤šä¸ªå®ä¾‹èƒ½åŒæ—¶è¿è¡Œï¼Œæ¯ä¸€ä¸ªTomcatå®ä¾‹å¿…é¡»æœ‰è‡ªå·±çš„ç›®å½•é›†</p><h3 id="ä¼ ç»Ÿå®ç°æ–¹å¼ï¼šç®€å•çš„å¤åˆ¶å‡ºä¸€ä¸ªæ–°çš„Tomcatç›®å½•åæ”¹ä¸€ä¸‹ç«¯å£"><a href="#ä¼ ç»Ÿå®ç°æ–¹å¼ï¼šç®€å•çš„å¤åˆ¶å‡ºä¸€ä¸ªæ–°çš„Tomcatç›®å½•åæ”¹ä¸€ä¸‹ç«¯å£" class="headerlink" title="ä¼ ç»Ÿå®ç°æ–¹å¼ï¼šç®€å•çš„å¤åˆ¶å‡ºä¸€ä¸ªæ–°çš„Tomcatç›®å½•åæ”¹ä¸€ä¸‹ç«¯å£"></a>ä¼ ç»Ÿå®ç°æ–¹å¼ï¼šç®€å•çš„å¤åˆ¶å‡ºä¸€ä¸ªæ–°çš„Tomcatç›®å½•åæ”¹ä¸€ä¸‹ç«¯å£</h3><p>ç¼ºç‚¹ï¼š<br>1ã€èµ„æºæµªè´¹ï¼Œå…¬ç”¨èµ„æºè¢«å¤šæ¬¡åŠ è½½ï¼Œé€ æˆåœ¨å†…å­˜ä¸­ä¸å¿…è¦çš„é‡ç”¨<br>2ã€é’ˆå¯¹ä¸åŒwebæœåŠ¡åšé…ç½®èƒ½åšä½†æ˜¯å¼‚å¸¸éº»çƒ¦<br>3ã€å¯¹Tomcatè¿›è¡Œç‰ˆæœ¬å‡çº§æ—¶èƒ½åšä½†æ˜¯å¼‚å¸¸éº»çƒ¦ï¼Œæ¯ä¸ªç›®å½•éƒ½éœ€è¦æ›¿æ¢ï¼Œä¸å¿…è¦çš„å¤§é‡å·¥ä½œ</p><hr><h3 id="å®ç°æ­¥éª¤"><a href="#å®ç°æ­¥éª¤" class="headerlink" title="å®ç°æ­¥éª¤"></a>å®ç°æ­¥éª¤</h3><h4 id="ä¸‹è½½å¹¶è§£å‹å®‰è£…åŒ…åˆ°ç›®å½•"><a href="#ä¸‹è½½å¹¶è§£å‹å®‰è£…åŒ…åˆ°ç›®å½•" class="headerlink" title="ä¸‹è½½å¹¶è§£å‹å®‰è£…åŒ…åˆ°ç›®å½•"></a>ä¸‹è½½å¹¶è§£å‹å®‰è£…åŒ…åˆ°ç›®å½•</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cd /usr/local/path/tomcat</span><br></pre></td></tr></table></figure><h4 id="ç¼–è¾‘-etc-profile-æ–‡ä»¶"><a href="#ç¼–è¾‘-etc-profile-æ–‡ä»¶" class="headerlink" title="ç¼–è¾‘ /etc/profile æ–‡ä»¶"></a>ç¼–è¾‘ <code>/etc/profile</code> æ–‡ä»¶</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo vi /etc/profile</span><br></pre></td></tr></table></figure><h4 id="æ·»åŠ Tomcat"><a href="#æ·»åŠ Tomcat" class="headerlink" title="æ·»åŠ Tomcat"></a>æ·»åŠ Tomcat</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">export CATALINA_HOME=/usr/local/path/tomcat/apache-tomcat-7.0.85</span><br></pre></td></tr></table></figure><p>ä»¥ä¸Šä»£ç æ·»åŠ åˆ°<code>profile</code>ä¸­</p><h4 id="å°†åœ¨-data-service-ä¸­åˆ›å»ºä¸¤ä¸ªå®ä¾‹æ–‡ä»¶å¤¹"><a href="#å°†åœ¨-data-service-ä¸­åˆ›å»ºä¸¤ä¸ªå®ä¾‹æ–‡ä»¶å¤¹" class="headerlink" title="å°†åœ¨ /data/service/ä¸­åˆ›å»ºä¸¤ä¸ªå®ä¾‹æ–‡ä»¶å¤¹"></a>å°†åœ¨ <code>/data/service/</code>ä¸­åˆ›å»ºä¸¤ä¸ªå®ä¾‹æ–‡ä»¶å¤¹</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cd /data/service</span><br><span class="line">mkdir tomcat1</span><br><span class="line">mkdir tomcat2</span><br></pre></td></tr></table></figure><h4 id="tomcatçš„é…ç½®æ–‡ä»¶å¤åˆ¶åˆ°å®ä¾‹æ–‡ä»¶å¤¹å†…"><a href="#tomcatçš„é…ç½®æ–‡ä»¶å¤åˆ¶åˆ°å®ä¾‹æ–‡ä»¶å¤¹å†…" class="headerlink" title="tomcatçš„é…ç½®æ–‡ä»¶å¤åˆ¶åˆ°å®ä¾‹æ–‡ä»¶å¤¹å†…"></a>tomcatçš„é…ç½®æ–‡ä»¶å¤åˆ¶åˆ°å®ä¾‹æ–‡ä»¶å¤¹å†…</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cd tomcat1/</span><br><span class="line">cp -a /usr/local/path/tomcat/* ./</span><br><span class="line">rm -rf lib/ bin/</span><br><span class="line"></span><br><span class="line">cd ..</span><br><span class="line">cp -a tomcat1/* tomcat2/</span><br><span class="line"></span><br><span class="line">cd /usr/local/path/tomcat</span><br><span class="line">rm -rf work/ webapps/ logs/ conf/</span><br></pre></td></tr></table></figure><h4 id="æ­¤æ—¶"><a href="#æ­¤æ—¶" class="headerlink" title="æ­¤æ—¶"></a>æ­¤æ—¶</h4><p><code>/usr/local/path/tomcat</code> å†…å‰©ä¸‹æ–‡ä»¶ä¸º: <code>bin/</code>, <code>lib/</code>;<br>ä¸¤ä¸ªå®ä¾‹æ–‡ä»¶å¤¹ä¸­å‰©ä¸‹çš„æ–‡ä»¶ä¸º; <code>work/</code> <code>webapps/</code> <code>logs/</code> <code>conf/</code></p><h4 id="åˆ›å»ºè¿è¡Œè„šæœ¬"><a href="#åˆ›å»ºè¿è¡Œè„šæœ¬" class="headerlink" title="åˆ›å»ºè¿è¡Œè„šæœ¬"></a>åˆ›å»ºè¿è¡Œè„šæœ¬</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cd /data/service/tomcat1</span><br><span class="line">mkdir bin</span><br><span class="line">cd bin/</span><br><span class="line">touch startup.sh</span><br><span class="line">touch shutdown.sh</span><br></pre></td></tr></table></figure><h4 id="ç¼–è¾‘startup-shå’Œshutdown-sh"><a href="#ç¼–è¾‘startup-shå’Œshutdown-sh" class="headerlink" title="ç¼–è¾‘startup.shå’Œshutdown.sh"></a>ç¼–è¾‘<code>startup.sh</code>å’Œ<code>shutdown.sh</code></h4><p>startup.sh :</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line"></span><br><span class="line">export CATALINA_BASE=/data/service/tomcat1</span><br><span class="line"></span><br><span class="line">echo $CATALINA_BASE</span><br><span class="line"></span><br><span class="line">TOMCAT_ID=`ps aux |grep &quot;java&quot;|grep &quot;Dcatalina.base=$CATALINA_BASE &quot;|grep -v &quot;grep&quot;|awk &#x27;&#123; print $2&#125;&#x27;`</span><br><span class="line"></span><br><span class="line">if [ -n &quot;$TOMCAT_ID&quot; ] ; then</span><br><span class="line">echo &quot;tomcat($&#123;TOMCAT_ITOMCAT_ID&#125;) still running now , please shutdown it firest&quot;;</span><br><span class="line">    exit 2;</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">TOMCAT_START_LOG=`$CATALINA_HOME/bin/startup.sh`</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if [ &quot;$?&quot; = &quot;0&quot; ]; then</span><br><span class="line">    echo &quot;$0 $&#123;1%/&#125; start succeed&quot;</span><br><span class="line">else</span><br><span class="line">    echo &quot;$0 $&#123;1%/&#125; start failed&quot;</span><br><span class="line">    echo $TOMCAT_START_LOG</span><br><span class="line">fi</span><br></pre></td></tr></table></figure><p>shutdown.sh :</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">rt CATALINA_BASE=/data/service/tomcat-1</span><br><span class="line"></span><br><span class="line">echo $CATALINA_BASE</span><br><span class="line"></span><br><span class="line">TOMCAT_ID=`ps aux |grep &quot;java&quot;|grep &quot;[D]catalina.base=$CATALINA_BASE &quot;|awk &#x27;&#123; print $2&#125;&#x27;`</span><br><span class="line"></span><br><span class="line">if [ -n &quot;$TOMCAT_ID&quot; ] ; then</span><br><span class="line">TOMCAT_STOP_LOG=`$CATALINA_HOME/bin/shutdown.sh`</span><br><span class="line">else</span><br><span class="line">    echo &quot;Tomcat instance not found : $&#123;1%/&#125;&quot;</span><br><span class="line">    exit</span><br><span class="line"></span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if [ &quot;$?&quot; = &quot;0&quot; ]; then</span><br><span class="line">    echo &quot;$0 $&#123;1%/&#125; stop succeed&quot;</span><br><span class="line">else</span><br><span class="line">    echo &quot;$0 $&#123;1%/&#125; stop failed&quot;</span><br><span class="line">    echo $TOMCAT_STOP_LOG</span><br><span class="line">fi</span><br></pre></td></tr></table></figure><p>è‡³æ­¤, å•æœºå¤šå®ä¾‹çš„tomcatå·²ç»åŸºæœ¬ä¸Šé…ç½®å¥½äº†. </p><p>è¿è¡Œ: </p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">/data/service/tomcat1/bin/startup.sh</span><br></pre></td></tr></table></figure><p>å³å¯.</p><p>å½“ç„¶, è¦è¿è¡Œä¸¤ä¸ªä»¥ä¸Šå®ä¾‹çš„è¯, è¿˜å¾—é…ç½® <code>server.xml</code>, è¿™é‡Œå°±ä¸è®¨è®ºäº†.</p><p>ä¸¤ä¸ªtomcatå®ä¾‹è¿è¡Œèµ·æ¥ä¹‹å, å¯ä»¥çœ‹åˆ°2ä¸ªtomcatå®ä¾‹çš„PIDæ˜¯ä¸åŒçš„ï¼Œä¹Ÿå°±æ˜¯è¯´å¯¹æŸä¸ªå®ä¾‹è¿›è¡Œæ“ä½œæ˜¯ä¸ä¼šå½±å“åˆ°å¦å¤–ä¸€ä¸ªå®ä¾‹çš„.</p><hr>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹æŠ€æœ¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> Tomcat </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linuxæ­å»ºGitæœåŠ¡å™¨</title>
      <link href="post/71240450/"/>
      <url>post/71240450/</url>
      
        <content type="html"><![CDATA[<blockquote><p>Ubuntuç¯å¢ƒæ­å»º<code>Git</code>æœåŠ¡å™¨</p></blockquote><h4 id="ç¬¬ä¸€æ­¥ï¼Œå®‰è£…git"><a href="#ç¬¬ä¸€æ­¥ï¼Œå®‰è£…git" class="headerlink" title="ç¬¬ä¸€æ­¥ï¼Œå®‰è£…git"></a>ç¬¬ä¸€æ­¥ï¼Œå®‰è£…<code>git</code></h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sudo apt-get install git</span><br></pre></td></tr></table></figure><h4 id="ç¬¬äºŒæ­¥ï¼Œåˆ›å»ºä¸€ä¸ªgitç”¨æˆ·"><a href="#ç¬¬äºŒæ­¥ï¼Œåˆ›å»ºä¸€ä¸ªgitç”¨æˆ·" class="headerlink" title="ç¬¬äºŒæ­¥ï¼Œåˆ›å»ºä¸€ä¸ªgitç”¨æˆ·"></a>ç¬¬äºŒæ­¥ï¼Œåˆ›å»ºä¸€ä¸ª<code>git</code>ç”¨æˆ·</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sudo adduser git</span><br></pre></td></tr></table></figure><h4 id="ç¬¬ä¸‰æ­¥ï¼Œåˆ›å»ºè¯ä¹¦ç™»å½•"><a href="#ç¬¬ä¸‰æ­¥ï¼Œåˆ›å»ºè¯ä¹¦ç™»å½•" class="headerlink" title="ç¬¬ä¸‰æ­¥ï¼Œåˆ›å»ºè¯ä¹¦ç™»å½•"></a>ç¬¬ä¸‰æ­¥ï¼Œåˆ›å»ºè¯ä¹¦ç™»å½•</h4><p>å®¢æˆ·ç«¯åœ¨å‘½ä»¤è¡Œä¸­è¾“å…¥ä»¥ä¸‹æŒ‡ä»¤ç”Ÿæˆ<code>ssh key</code>ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ssh-keygen -t rsa -C &quot;your_email@example.com&quot;</span><br></pre></td></tr></table></figure><p>æ”¶é›†æ‰€æœ‰éœ€è¦ç™»å½•çš„ç”¨æˆ·çš„å…¬é’¥ï¼Œå°±æ˜¯ä»–ä»¬è‡ªå·±çš„<code>id_rsa.pub</code>æ–‡ä»¶ï¼ŒæŠŠæ‰€æœ‰å…¬é’¥å¯¼å…¥åˆ°<code>/home/git/.ssh/authorized_keys</code>æ–‡ä»¶é‡Œï¼Œä¸€è¡Œä¸€ä¸ªã€‚</p><h4 id="ç¬¬å››æ­¥ï¼Œåˆå§‹åŒ–Gitä»“åº“"><a href="#ç¬¬å››æ­¥ï¼Œåˆå§‹åŒ–Gitä»“åº“" class="headerlink" title="ç¬¬å››æ­¥ï¼Œåˆå§‹åŒ–Gitä»“åº“"></a>ç¬¬å››æ­¥ï¼Œåˆå§‹åŒ–Gitä»“åº“</h4><p>å…ˆé€‰å®šä¸€ä¸ªç›®å½•ä½œä¸ºGitä»“åº“ï¼Œå‡å®šæ˜¯<code>/srv/sample.git</code>ï¼Œåœ¨<code>/srv</code>ç›®å½•ä¸‹è¾“å…¥å‘½ä»¤ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ sudo git init --bare sample.git</span><br></pre></td></tr></table></figure><h4 id="ç¬¬äº”æ­¥ï¼Œç¦ç”¨shellç™»å½•"><a href="#ç¬¬äº”æ­¥ï¼Œç¦ç”¨shellç™»å½•" class="headerlink" title="ç¬¬äº”æ­¥ï¼Œç¦ç”¨shellç™»å½•"></a>ç¬¬äº”æ­¥ï¼Œç¦ç”¨shellç™»å½•</h4><p>å‡ºäºå®‰å…¨è€ƒè™‘ï¼Œç¬¬äºŒæ­¥åˆ›å»ºçš„gitç”¨æˆ·ä¸å…è®¸ç™»å½•shellï¼Œè¿™å¯ä»¥é€šè¿‡ç¼–è¾‘<code>/etc/passwd</code>æ–‡ä»¶å®Œæˆã€‚æ‰¾åˆ°ç±»ä¼¼ä¸‹é¢çš„ä¸€è¡Œï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">git:x:1001:1001:,,,:&#x2F;home&#x2F;git:&#x2F;bin&#x2F;bash</span><br></pre></td></tr></table></figure><p>æ”¹ä¸ºï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">git:x:1001:1001:,,,:&#x2F;home&#x2F;git:&#x2F;usr&#x2F;bin&#x2F;git-shell</span><br></pre></td></tr></table></figure><p>è¿™æ ·ï¼Œ<code>git</code>ç”¨æˆ·å¯ä»¥æ­£å¸¸é€šè¿‡sshä½¿ç”¨gitï¼Œä½†æ— æ³•ç™»å½•shellï¼Œå› ä¸ºæˆ‘ä»¬ä¸º<code>git</code>ç”¨æˆ·æŒ‡å®šçš„<code>git-shell</code>æ¯æ¬¡ä¸€ç™»å½•å°±è‡ªåŠ¨é€€å‡ºã€‚</p><h4 id="ç¬¬å…­æ­¥ï¼Œå…‹éš†è¿œç¨‹ä»“åº“ï¼š"><a href="#ç¬¬å…­æ­¥ï¼Œå…‹éš†è¿œç¨‹ä»“åº“ï¼š" class="headerlink" title="ç¬¬å…­æ­¥ï¼Œå…‹éš†è¿œç¨‹ä»“åº“ï¼š"></a>ç¬¬å…­æ­¥ï¼Œå…‹éš†è¿œç¨‹ä»“åº“ï¼š</h4><p>ç°åœ¨ï¼Œå¯ä»¥é€šè¿‡<code>git clone</code>å‘½ä»¤å…‹éš†è¿œç¨‹ä»“åº“äº†ï¼Œåœ¨å„è‡ªçš„ç”µè„‘ä¸Šè¿è¡Œï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ git clone git@server:&#x2F;srv&#x2F;sample.git</span><br><span class="line">Cloning into &#39;sample&#39;...</span><br><span class="line">warning: You appear to have cloned an empty repository.</span><br></pre></td></tr></table></figure><p>å‰©ä¸‹çš„æ¨é€å°±ç®€å•äº†ã€‚</p><h4 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h4><p>å¦‚æœæ²¡æœ‰è£…sshæœåŠ¡ï¼Œåˆ™éœ€è¦å®‰è£…sshæœåŠ¡ï¼Œä¸ç„¶æ— æ³•æ­£å¸¸ä½¿ç”¨git glone æŒ‡ä»¤</p><p>å®‰è£…<code>sshd</code>ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sudo apt-get install openssh-server</span><br></pre></td></tr></table></figure><p>å¯åŠ¨<code>sshd</code>ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sudo net start sshd</span><br></pre></td></tr></table></figure><p>æ£€æŸ¥é˜²ç«å¢™è®¾ç½®ï¼Œå…³é—­é˜²ç«å¢™</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sudo ufw disable</span><br></pre></td></tr></table></figure><p>è¿è¡Œä»¥ä¸‹ä»£ç æŸ¥çœ‹æ˜¯å¦æœ‰<code>sshd</code>è¿›ç¨‹</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ps -e|grep ssh</span><br></pre></td></tr></table></figure><hr><h4 id="ç®¡ç†å…¬é’¥"><a href="#ç®¡ç†å…¬é’¥" class="headerlink" title="ç®¡ç†å…¬é’¥"></a>ç®¡ç†å…¬é’¥</h4><p>å¦‚æœå›¢é˜Ÿå¾ˆå°ï¼ŒæŠŠæ¯ä¸ªäººçš„å…¬é’¥æ”¶é›†èµ·æ¥æ”¾åˆ°æœåŠ¡å™¨çš„<code>/home/git/.ssh/authorized_keys</code>æ–‡ä»¶é‡Œå°±æ˜¯å¯è¡Œçš„ã€‚å¦‚æœå›¢é˜Ÿæœ‰å‡ ç™¾å·äººï¼Œå°±æ²¡æ³•è¿™ä¹ˆç©äº†ï¼Œè¿™æ—¶ï¼Œå¯ä»¥ç”¨<a href="https://github.com/res0nat0r/gitosis">Gitosis</a>æ¥ç®¡ç†å…¬é’¥ã€‚</p><p>è¿™é‡Œæˆ‘ä»¬ä¸ä»‹ç»æ€ä¹ˆç©<a href="https://github.com/res0nat0r/gitosis">Gitosis</a>äº†ï¼Œå‡ ç™¾å·äººçš„å›¢é˜ŸåŸºæœ¬éƒ½åœ¨500å¼ºäº†ï¼Œç›¸ä¿¡æ‰¾ä¸ªé«˜æ°´å¹³çš„Linuxç®¡ç†å‘˜é—®é¢˜ä¸å¤§ã€‚</p><h4 id="ç®¡ç†æƒé™"><a href="#ç®¡ç†æƒé™" class="headerlink" title="ç®¡ç†æƒé™"></a>ç®¡ç†æƒé™</h4><p>æœ‰å¾ˆå¤šä¸ä½†è§†æºä»£ç å¦‚ç”Ÿå‘½ï¼Œè€Œä¸”è§†å‘˜å·¥ä¸ºçªƒè´¼çš„å…¬å¸ï¼Œä¼šåœ¨ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿé‡Œè®¾ç½®ä¸€å¥—å®Œå–„çš„æƒé™æ§åˆ¶ï¼Œæ¯ä¸ªäººæ˜¯å¦æœ‰è¯»å†™æƒé™ä¼šç²¾ç¡®åˆ°æ¯ä¸ªåˆ†æ”¯ç”šè‡³æ¯ä¸ªç›®å½•ä¸‹ã€‚å› ä¸ºGitæ˜¯ä¸ºLinuxæºä»£ç æ‰˜ç®¡è€Œå¼€å‘çš„ï¼Œæ‰€ä»¥Gitä¹Ÿç»§æ‰¿äº†å¼€æºç¤¾åŒºçš„ç²¾ç¥ï¼Œä¸æ”¯æŒæƒé™æ§åˆ¶ã€‚ä¸è¿‡ï¼Œå› ä¸ºGitæ”¯æŒé’©å­ï¼ˆhookï¼‰ï¼Œæ‰€ä»¥ï¼Œå¯ä»¥åœ¨æœåŠ¡å™¨ç«¯ç¼–å†™ä¸€ç³»åˆ—è„šæœ¬æ¥æ§åˆ¶æäº¤ç­‰æ“ä½œï¼Œè¾¾åˆ°æƒé™æ§åˆ¶çš„ç›®çš„ã€‚<a href="https://github.com/sitaramc/gitolite">Gitolite</a>å°±æ˜¯è¿™ä¸ªå·¥å…·ã€‚</p><p>è¿™é‡Œæˆ‘ä»¬ä¹Ÿä¸ä»‹ç»<a href="https://github.com/sitaramc/gitolite">Gitolite</a>äº†ï¼Œä¸è¦æŠŠæœ‰é™çš„ç”Ÿå‘½æµªè´¹åˆ°æƒé™æ–—äº‰ä¸­ã€‚</p><h4 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h4><ul><li>æ­å»ºGitæœåŠ¡å™¨éå¸¸ç®€å•ï¼Œé€šå¸¸10åˆ†é’Ÿå³å¯å®Œæˆï¼›</li><li>è¦æ–¹ä¾¿ç®¡ç†å…¬é’¥ï¼Œç”¨<a href="https://github.com/sitaramc/gitolite">Gitosis</a>ï¼›</li><li>è¦åƒSVNé‚£æ ·å˜æ€åœ°æ§åˆ¶æƒé™ï¼Œç”¨<a href="https://github.com/sitaramc/gitolite">Gitolite</a>ã€‚</li></ul>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®°æœ¬ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Git </tag>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
